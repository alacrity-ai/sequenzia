<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sequenzia</title>
  <!-- Tailwind via CDN -->
  <link rel="stylesheet" href="./css/styles.css" />
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
</head>


<body class="bg-black text-gray-200 font-sans pb-36">
  <!-- Modal Mount -->
  <div id="modal-mount-root" class="content-hidden"></div>
  <div id="content-main" class="flex flex-col items-center mt-10 space-y-6 content-hidden">
    <!-- MAIN CONTAINER -->
    <div class="flex flex-col w-[1260px] space-y-4 relative">

      <!-- Interactive Piano -->
      <div class="flex items-start gap-2">
      <!-- Left Side Button Column (ABSOLUTE) -->
      <div class="absolute left-[-46px] flex flex-col gap-2 z-10">
        <button id="piano-toggle-btn"
                class="side-button side-button-info"
                title="Toggle Piano View">
          üéπ
        </button>
        <button id="mixer-toggle-btn"
                class="side-button side-button-info"
                title="Toggle Mixer View">
          üéõÔ∏è
        </button>
        <button id="ai-toggle-btn"
                class="side-button side-button-info"
                title="Toggle AI View">
          ü§ñ
        </button>
      </div>

        <!-- Piano Canvas -->
        <canvas id="piano" width="1260" height="200"
                class="rounded shadow-lg border border-purple-700"></canvas>
        
        <!-- Existing Right-side Controls -->
        <div class="flex flex-col gap-2">
          <!-- Piano Controls -->
          <div class="flex flex-col gap-2">
            <button id="octave-up"
                    class="side-button side-button-primary"
                    title="Octave Up">
              <svg class="w-6 h-6" aria-hidden="true">
                <use href="#icon-arrow-up"></use>
              </svg>
            </button>
            <button id="octave-down"
                    class="side-button side-button-primary"
                    title="Octave Down">
              <svg class="w-6 h-6" aria-hidden="true">
                <use href="#icon-arrow-down"></use>
              </svg>
            </button>
            <button id="global-instrument-select-btn"
                    class="side-button side-button-primary"
                    title="Select Instrument">
              <svg class="w-6 h-6" aria-hidden="true">
                <use href="#icon-list-instrument"></use>
              </svg>
            </button>
            <button id="disable-keyboard-inputs"
                    class="side-button side-button-secondary"
                    title="Toggle Keyboard Input">
              <svg class="w-6 h-6" aria-hidden="true">
                <use href="#icon-keyboard"></use>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Waveform Visualizer + Mode Button -->
      <div class="flex items-start gap-2">
        <canvas
          id="waveform"
          width="1260"
          height="100"
          class="rounded border border-purple-800 bg-gray-900"
        ></canvas>
        <div class="flex flex-col gap-2">
          <!-- Visualizer Controls -->
          <div class="flex flex-col gap-2">
            <button id="visualizer-mode"
                    class="side-button side-button-primary"
                    title="Change visualizer mode">üìä</button>
          </div>
        </div>
      </div>

      <!-- Sequencer Container -->
      <div id="sequencers-container" class="flex flex-col space-y-4 mb-[320px]">
        <template id="sequencer-template">
          <div class="sequencer flex flex-col space-y-2 p-4 bg-gradient-to-br from-gray-800 to-gray-900 rounded">
            
            <!-- Header -->
            <div class="sequencer-header flex justify-between items-center">
              
              <!-- Left Group: Instrument Button + Track Name -->
              <div class="flex items-center gap-2">
                <button class="side-button-primary cursor-pointer instrument-select-btn px-2 py-1 rounded text-white w-8 flex items-center justify-center" title="Change Instrument">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-list-instrument"></use>
                  </svg>
                </button>
                <span class="track-name text-white font-semibold">Track</span>
              </div>
        
              <!-- Right Group: Volume, Pan, Zoom, Mute, Solo, Collapse, Delete -->
              <div class="flex items-center gap-3">
                <!-- Volume Bar -->
                <div class="volume-bar relative w-[140px] h-[16px] rounded-full bg-gray-700 overflow-hidden shadow-inner border border-purple-700 group cursor-pointer">
                  <!-- Fill -->
                  <div class="volume-fill absolute top-0 left-0 h-full bg-gradient-to-r from-purple-500 to-purple-300" style="width: 60%;"></div>
                
                  <!-- Snap Line -->
                  <div class="volume-snap-marker absolute top-0 bottom-0 w-[2px] bg-pink-500/50 pointer-events-none" style="left: 78.74%;"></div>
                
                  <!-- Thumb -->
                  <div class="volume-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px] border-purple-700 bg-purple-700 rounded-full shadow-md border group-hover:scale-110"
                       style="left: calc(60% - 5px);"></div>
                </div>
                
                <!-- Pan Bar -->
                <div class="pan-bar relative w-[140px] h-[16px] rounded-full bg-gray-700 overflow-hidden shadow-inner border border-blue-700 group cursor-pointer">
                  <!-- Fill -->
                  <div class="pan-fill absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-blue-300" style="width: 50%;"></div>

                  <!-- Snap Line (center) -->
                  <div class="pan-snap-marker absolute top-0 bottom-0 w-[2px] bg-cyan-400/50 pointer-events-none" style="left: 50%;"></div>

                  <!-- Thumb -->
                  <div class="pan-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px] border-blue-700 bg-blue-700 rounded-full shadow-md border group-hover:scale-110"
                      style="left: calc(50% - 5px);"></div>
                </div>

                <div class="border-l border-purple-800 mx-2 h-6"></div>

                <!-- Zoom Buttons (hidden until expanded) -->
                <button class="zoom-in-btn cursor-pointer side-button-secondary px-2 py-1 rounded text-white w-8 flex items-center justify-center hidden" title="Zoom In">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-zoom-in"></use>
                  </svg>
                </button>
                <button class="zoom-out-btn cursor-pointer side-button-secondary px-2 py-1 rounded text-white w-8 flex items-center justify-center hidden" title="Zoom Out">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-zoom-out"></use>
                  </svg>
                </button>
                <button class="zoom-reset-btn cursor-pointer side-button-secondary px-2 py-1 rounded text-white w-8 flex items-center justify-center hidden" title="Reset Zoom">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-reset"></use>
                  </svg>
                </button>
        
                <div class="zoom-button-divider border-l border-purple-800 mx-2 h-6 hidden"></div>
        
                <!-- Mute / Solo / Collapse / Delete -->
                <button class="side-button-secondary cursor-pointer mute-btn px-2 py-1 rounded text-white w-8 flex items-center justify-center" title="Mute Track">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-volume-mute"></use>
                  </svg>
                </button>
                <button class="side-button-secondary cursor-pointer solo-btn px-2 py-1 rounded text-white w-8 flex items-center justify-center" title="Solo Track">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-headphones"></use>
                  </svg>
                </button>
                <button class="collapse-btn cursor-pointer side-button-secondary px-2 py-1 rounded text-white w-8 flex items-center justify-center" title="Expand/Collapse Track">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-caret-down"></use>
                  </svg>
                </button>
                <button class="delete-btn cursor-pointer side-button-secondary px-2 py-1 hover:bg-red-600 rounded text-white w-8 flex items-center justify-center" title="Delete Track">
                  <svg class="w-6 h-6" aria-hidden="true">
                    <use href="#icon-close-circle"></use>
                  </svg>
                </button>
              </div>
            </div>
        
            <!-- Mini Contour (hidden by default) -->
            <canvas class="mini-contour w-full h-10 mb-2 bg-gray-800 rounded hidden"></canvas>
        
            <!-- Main Body: Scrollable canvas area -->
            <div class="sequencer-body flex border-t border-purple-700 pt-2 h-[720px]">
                <!-- Grid Matrix will be injected here -->
            </div>
        
            <!-- Grip Handle -->
            <div class="grip-handle group flex justify-center items-center h-6 cursor-grab hover:bg-gray-800 rounded">
              <svg class="w-6 h-6 text-purple-700 group-hover:text-pink-400 transition-colors duration-150" aria-hidden="true">
                <use href="#icon-grip"></use>
              </svg>
            </div>
          </div>
        </template>
        
        <!-- individual sequencers will be injected here -->
        <button id="add-sequencer" class="self-end px-3 py-1 bg-green-600 rounded" style="cursor: pointer;">Ôºã Add Track</button>
      </div>
    </div>
  </div>

  <!-- Transport Controls (sticky footer) -->
  <!-- Spacer for fixed footer height -->
  <!-- <div class="footer-spacer h-[320px]"></div>  -->

  <div id="footer-main" class="fixed bottom-0 left-0 right-0 z-40 content-hidden">
    <!--- Global Controls Injected Here -->
  </div>

  <!-- Load Modals and Icons -->
  <script type="module">
    (async () => {
      async function loadHTML(id, url) {
        const res = await fetch(url);
        const html = await res.text();
        const container = document.getElementById(id);
        container.insertAdjacentHTML('beforeend', html);
      }

      // Load icons first
      await loadHTML('modal-mount-root', './web/icons/icons.html');
      
      // Then load modals
      await loadHTML('modal-mount-root', 'web/modals/export-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/delete-confirm-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/ai-extend-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/ai-inpaint-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/ai-generate-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/openai-key-not-set.html');
      await loadHTML('modal-mount-root', 'web/modals/ai-generation-failed-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/ai-working-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/instrument-select-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/loading-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/import-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/splash-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/whats-new-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/feature-not-implemented-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/error-generic-modal.html');
      await loadHTML('modal-mount-root', 'web/modals/save-wav-menu-modal.html');

      // Only load the app after modals and icons are present
      await import('/src/main.js');
    })();
  </script>

</body>
</html>
