import{g as Ts,S as an,a as on,M as ln,D as cn,b as dn,c as un,d as hn,e as fn,f as pn,i as mn,h as yn,P as gn,z as Ge,Z as A,m as bn,O as _n,j as Is}from"./vendor-CYgQJ7h-.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function vn(){return new Date().toISOString()}function Nt(i,e=2){var s,n;if(i===null||typeof i!="object")return i;if(e<=0){const r=((s=i.constructor)==null?void 0:s.name)||"Object",a=Object.keys(i).length;return`[${r} object, ${a} keys]`}if(Array.isArray(i))return i.length>10?[...i.slice(0,10).map(r=>Nt(r,e-1)),`...(${i.length} total)`]:i.map(r=>Nt(r,e-1));const t={_type:((n=i.constructor)==null?void 0:n.name)||"Object"};for(const r in i){if(!Object.prototype.hasOwnProperty.call(i,r))continue;const a=i[r];if(a instanceof HTMLElement)t[r]=`[HTMLElement: ${a.tagName}]`;else if(a instanceof AudioContext||a instanceof AudioNode)t[r]="[AudioNode]";else if(typeof a=="function")t[r]="[Function]";else if(typeof a=="object"){const c=Object.keys(a).length>3?e-1:e;t[r]=Nt(a,c)}else t[r]=a}return t}function Sn(i){try{const e=Nt(i,2);return JSON.stringify(e,null,2)}catch(e){return JSON.stringify({error:"Could not serialize log payload",reason:e.message,type:typeof i},null,2)}}function Rs(i,e,t="log"){const n={timestamp:vn(),level:t,message:i};e!==void 0&&(n.data=e);const r=Sn(n);switch(t){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;case"debug":console.debug(r);break;case"log":default:console.log(r);break}}const Ci="SEQUENZIA_DEV";let ot=!1;typeof window<"u"&&(ot=localStorage.getItem(Ci)==="true");function zi(){ot=!0,typeof window<"u"&&localStorage.setItem(Ci,"true")}function Cn(){ot=!1,typeof window<"u"&&localStorage.removeItem(Ci)}function Ht(){return ot}function T(i,e,t="log"){ot&&Rs(i,e,t)}class be{constructor(){this.reloadCallbacks=[]}static getInstance(){return be.instance||(be.instance=new be),be.instance}registerReloadable(e){this.reloadCallbacks.push(e)}unregisterReloadable(e){this.reloadCallbacks=this.reloadCallbacks.filter(t=>t!==e)}reloadAll(){this.reloadCallbacks.forEach(e=>e())}}function Nn(){const i=document.getElementById("splash-modal");return i?!i.classList.contains("hidden"):!1}function Os(i){const e=[];for(const t of i)Array.isArray(t)?e.push(...Os(t)):t!=null&&t!==!1&&e.push(t);return e}function m(i,e={},...t){const s=document.createElement(i);for(const[r,a]of Object.entries(e))if(!(a==null||a===!1))if(r==="class"||r==="className")s.className=a;else if(r==="style"&&typeof a=="object")for(const[o,c]of Object.entries(a))c!=null&&(s.style[o]=c);else if(r==="dataset"&&typeof a=="object")for(const[o,c]of Object.entries(a))s.dataset[o]=String(c);else r.startsWith("data-")?s.setAttribute(r,String(a)):r.startsWith("on")&&typeof a=="function"?s.addEventListener(r.slice(2).toLowerCase(),a):r in s?s[r]=a:s.setAttribute(r,String(a));const n=Os(t);for(const r of n)s.appendChild(typeof r=="string"?document.createTextNode(r):r);return s}const wn={global:{noteToolMode:"express"},theme:{gridColorScheme:"Darkroom",noteColorScheme:"Track Color",skin:"Default"},ai:{openaiApiKey:"",openaiModel:"gpt-4o"}},Fs={name:"Default",appBackground:"bg-black",menuBackground:"bg-gradient-to-br from-gray-800 to-gray-900",surfaceBackground:"bg-gray-900",accentColor:"bg-purple-700",textColor:"text-white",borderColor:"border-purple-950",buttonPrimaryColor:"bg-purple-700",buttonPrimaryColorHover:"hover:bg-purple-600",buttonSecondaryColor:"bg-gray-800",buttonSecondaryColorHover:"hover:bg-gray-700",buttonTertiaryColor:"bg-blue-700",buttonTertiaryColorHover:"hover:bg-blue-600",toggleTrackBase:"bg-gray-700",toggleTrackChecked:"peer-checked:bg-purple-600",toggleKnobBase:"after:border-gray-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#a6a09b",whiteKeyColor:"#292524",volumeGradientFrom:"from-purple-600",volumeGradientTo:"to-purple-400",volumeThumbColor:"bg-purple-500",panGradientFrom:"from-indigo-600",panGradientTo:"to-indigo-400",panThumbColor:"bg-indigo-500",snapMarkerColor:"bg-purple-300/50"},Mn={name:"Blue Dream",appBackground:"bg-gradient-to-b from-blue-900 to-gray-900",menuBackground:"bg-gradient-to-br from-blue-800 to-blue-900",surfaceBackground:"bg-blue-950/80",accentColor:"bg-cyan-400",textColor:"text-white",borderColor:"border-cyan-400",buttonPrimaryColor:"bg-cyan-600",buttonPrimaryColorHover:"hover:bg-cyan-500",buttonSecondaryColor:"bg-blue-800",buttonSecondaryColorHover:"hover:bg-blue-700",buttonTertiaryColor:"bg-indigo-600",buttonTertiaryColorHover:"hover:bg-indigo-500",toggleTrackBase:"bg-blue-700",toggleTrackChecked:"peer-checked:bg-cyan-400",toggleKnobBase:"after:border-blue-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#1b1f5f",whiteKeyColor:"#c0e7ff",volumeGradientFrom:"from-cyan-500",volumeGradientTo:"to-cyan-300",volumeThumbColor:"bg-cyan-400",panGradientFrom:"from-indigo-500",panGradientTo:"to-indigo-300",panThumbColor:"bg-indigo-400",snapMarkerColor:"bg-cyan-400/50"},xn={name:"Modern Light",appBackground:"bg-white",menuBackground:"bg-gray-100",surfaceBackground:"bg-gray-200",accentColor:"bg-blue-600",textColor:"text-gray-900",borderColor:"border-blue-600",buttonPrimaryColor:"bg-blue-600",buttonPrimaryColorHover:"hover:bg-blue-500",buttonSecondaryColor:"bg-gray-200",buttonSecondaryColorHover:"hover:bg-gray-300",buttonTertiaryColor:"bg-gray-300",buttonTertiaryColorHover:"hover:bg-gray-400",toggleTrackBase:"bg-gray-300",toggleTrackChecked:"peer-checked:bg-blue-600",toggleKnobBase:"after:border-gray-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#111111",whiteKeyColor:"#ffffff",volumeGradientFrom:"from-blue-500",volumeGradientTo:"to-blue-300",volumeThumbColor:"bg-blue-400",panGradientFrom:"from-sky-500",panGradientTo:"to-sky-300",panThumbColor:"bg-sky-400",snapMarkerColor:"bg-blue-400/50"},Ln={name:"Synthwave",appBackground:"bg-gradient-to-br from-black via-gray-900 to-purple-950",menuBackground:"bg-gradient-to-br from-purple-800 to-pink-900",surfaceBackground:"bg-gray-900/80",accentColor:"bg-fuchsia-500",textColor:"text-neon-green",borderColor:"border-fuchsia-500",buttonPrimaryColor:"bg-pink-700",buttonPrimaryColorHover:"hover:bg-pink-600",buttonSecondaryColor:"bg-purple-800",buttonSecondaryColorHover:"hover:bg-purple-700",buttonTertiaryColor:"bg-gray-800",buttonTertiaryColorHover:"hover:bg-gray-700",toggleTrackBase:"bg-pink-800",toggleTrackChecked:"peer-checked:bg-fuchsia-500",toggleKnobBase:"after:border-pink-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#d946ef",whiteKeyColor:"#f5d0fe",volumeGradientFrom:"from-fuchsia-500",volumeGradientTo:"to-pink-400",volumeThumbColor:"bg-fuchsia-400",panGradientFrom:"from-purple-600",panGradientTo:"to-purple-400",panThumbColor:"bg-purple-500",snapMarkerColor:"bg-fuchsia-300/50"},kn={name:"Verdant Alloy",appBackground:"bg-gradient-to-b from-gray-900 to-green-950",menuBackground:"bg-gradient-to-tr from-emerald-800 to-lime-700",surfaceBackground:"bg-emerald-950/70",accentColor:"bg-lime-400",textColor:"text-lime-100",borderColor:"border-lime-400",buttonPrimaryColor:"bg-emerald-600",buttonPrimaryColorHover:"hover:bg-emerald-500",buttonSecondaryColor:"bg-lime-700",buttonSecondaryColorHover:"hover:bg-lime-600",buttonTertiaryColor:"bg-gray-700",buttonTertiaryColorHover:"hover:bg-gray-600",toggleTrackBase:"bg-emerald-700",toggleTrackChecked:"peer-checked:bg-lime-400",toggleKnobBase:"after:border-lime-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#143016",whiteKeyColor:"#dbf4dc",volumeGradientFrom:"from-emerald-500",volumeGradientTo:"to-emerald-300",volumeThumbColor:"bg-emerald-400",panGradientFrom:"from-lime-500",panGradientTo:"to-lime-300",panThumbColor:"bg-lime-400",snapMarkerColor:"bg-lime-300/50"},Gn={name:"Sunset",appBackground:"bg-gradient-to-br from-orange-900 via-red-800 to-purple-900",menuBackground:"bg-gradient-to-bl from-rose-800 to-orange-700",surfaceBackground:"bg-orange-950/70",accentColor:"bg-yellow-400",textColor:"text-yellow-100",borderColor:"border-yellow-400",buttonPrimaryColor:"bg-amber-600",buttonPrimaryColorHover:"hover:bg-amber-500",buttonSecondaryColor:"bg-red-700",buttonSecondaryColorHover:"hover:bg-red-600",buttonTertiaryColor:"bg-purple-700",buttonTertiaryColorHover:"hover:bg-purple-600",toggleTrackBase:"bg-red-700",toggleTrackChecked:"peer-checked:bg-yellow-400",toggleKnobBase:"after:border-orange-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#45122c",whiteKeyColor:"#fff3e0",volumeGradientFrom:"from-amber-500",volumeGradientTo:"to-amber-300",volumeThumbColor:"bg-amber-400",panGradientFrom:"from-rose-500",panGradientTo:"to-rose-300",panThumbColor:"bg-rose-400",snapMarkerColor:"bg-amber-300/50"},Bn={Default:Fs,"Blue Dream":Mn,"Modern Light":xn,Synthwave:Ln,"Verdant Alloy":kn,Sunset:Gn};function En(i){return Bn[i]||Fs}const lt=structuredClone(wn);lt.theme.skin;function W(){return lt}function Ps(){return lt.ai.openaiApiKey}function U(){return En(lt.theme.skin)}function fe(i){Ds(lt,i);try{const e=z();if(e.length>0)for(const t of e)t.redraw()}catch(e){console.warn("[updateUserConfig] Skipped sequencer UI refresh (store not ready yet).",e)}}function Ds(i,e){for(const t in e)e[t]&&typeof e[t]=="object"&&!Array.isArray(e[t])?(i[t]||(i[t]={}),Ds(i[t],e[t])):i[t]=e[t]}const An={sm:{widthClass:"w-[300px]",maxWidthClass:"max-w-sm"},md:{widthClass:"w-[500px]",maxWidthClass:"max-w-md"},lg:{widthClass:"w-[700px]",maxWidthClass:"max-w-lg"},xl:{widthClass:"w-[900px]",maxWidthClass:"max-w-xl"},full:{widthClass:"w-full",maxWidthClass:"max-w-full"}};function ae(i,e,t={}){const s=U(),n=t.sizePreset?An[t.sizePreset]:void 0,r=t.widthClass||(n==null?void 0:n.widthClass)||"w-[500px]",a=t.maxWidthClass||(n==null?void 0:n.maxWidthClass)||"max-w-full",o=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),c=m("div",{class:["relative flex flex-col",s.menuBackground,"border border-purple-700 shadow-2xl rounded-2xl","px-10 py-8 animate-fade-in text-white",r,a].join(" ")},o,...Array.isArray(e)?e:[e]);return m("div",{id:i,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},c)}function K({id:i,text:e,kind:t="primary",onClick:s,additionalClasses:n=""}){const r=U(),a={primary:r.buttonPrimaryColor,secondary:r.buttonSecondaryColor,tertiary:r.buttonTertiaryColor}[t],o={primary:r.buttonPrimaryColorHover,secondary:r.buttonSecondaryColorHover,tertiary:r.buttonTertiaryColorHover}[t];return m("button",{id:i,class:["cursor-pointer flex-1 py-2 rounded-lg transition-all text-sm",a,o,r.textColor,n].join(" "),textContent:e,onclick:s})}function Tn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("h2",{class:"text-xl font-semibold mb-4 text-center tracking-wide z-10",textContent:"Oops!"}),t=m("div",{id:"error-message-content",class:["bg-gray-700 text-gray-100 rounded-xl px-4 py-3 text-sm whitespace-pre-wrap","z-10 max-h-[240px] overflow-y-auto text-center"].join(" ")}),s=K({id:"error-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"});return ae("error-modal",[i,e,t,s],{widthClass:"w-[420px]",maxWidthClass:"max-w-full"})}function In(i){const e=i.querySelector("#error-close-btn"),t=i.querySelector("div.relative"),s=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=r=>{t&&(t.contains(r.target)||s())};return e==null||e.addEventListener("click",s),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",s),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class Rn{constructor(){this.detachFn=null,this.modal=Tn(),this.messageBox=this.modal.querySelector("#error-message-content"),document.body.appendChild(this.modal);const e=In(this.modal);this.detachFn=e.detach}show(e){this.messageBox.textContent=e,this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function On(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"text-[100px] mb-4 z-10 animate-bounce text-center",textContent:"🛠️"}),t=m("div",{class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Feature Not Implemented"}),s=m("div",{class:"text-sm text-gray-400 mt-2 z-10 text-center",innerHTML:"This part of Sequenzia is still under construction.<br />Check back soon!"}),n=K({id:"feature-modal-close-btn",text:"Got it",kind:"primary",additionalClasses:"mt-6 self-center z-10 px-6 py-2 text-base"});return ae("feature-not-implemented-modal",[i,e,t,s,n],{widthClass:"w-[400px]",maxWidthClass:"max-w-full"})}function Fn(i){const e=i.querySelector("#feature-modal-close-btn"),t=i.querySelector("div.relative"),s=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=r=>{t&&(t.contains(r.target)||s())};return e==null||e.addEventListener("click",s),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",s),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class Pn{constructor(){this.detachFn=null,this.modal=On(),document.body.appendChild(this.modal);const e=Fn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Dn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"flex justify-center items-center space-x-3 mb-6 z-10"},m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=m("div",{id:"loading-modal-title",class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Loading Sounds..."}),s=m("div",{id:"loading-modal-subtext",class:"text-sm text-gray-400 mt-2 z-10 text-center",textContent:"Please wait while we dial it in."}),n=m("button",{id:"loading-modal-cancel",class:"cursor-pointer mt-6 z-10 text-sm text-purple-400 hover:text-purple-300 underline hidden",textContent:"Cancel"});return ae("loading-modal",[i,e,t,s,n],{widthClass:"w-[360px]",maxWidthClass:"max-w-full"})}function Un(i,e){const t=i.querySelector("#loading-modal-cancel"),s=()=>{e()};return t==null||t.addEventListener("click",s),{detach:()=>{t==null||t.removeEventListener("click",s)},refreshUI:()=>{}}}class qn{constructor(e){this.detachFn=null,this.modal=Dn(),this.titleEl=this.modal.querySelector("#loading-modal-title"),this.subtextEl=this.modal.querySelector("#loading-modal-subtext"),this.cancelBtn=this.modal.querySelector("#loading-modal-cancel"),document.body.appendChild(this.modal);const t=Un(this.modal,e);this.detachFn=t.detach}show(e){e!=null&&e.title&&(this.titleEl.textContent=e.title),e!=null&&e.subtext&&(this.subtextEl.textContent=e.subtext),this.cancelBtn.classList.toggle("hidden",!(e!=null&&e.cancelable)),this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function oe(i){const e=i.startsWith("/")?i.substring(1):i;return(window.location.pathname.startsWith("/sequenzia")?"/sequenzia/":"./")+e}function Kn(){const i=m("div",{class:"mb-8"},m("img",{id:"splash-logo",src:oe("static/svg/sequenzia-logo.svg"),alt:"Sequenzia",class:"w-[300px] h-auto animate-fade-in rounded-xl"})),e=m("div",{class:"flex items-center space-x-2 mb-4"},m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=m("div",{class:"text-white text-xl font-medium"},"Loading Sequenzia ",m("span",{class:"animate-pulse"},"...")),s=m("div",{class:"relative flex flex-col items-center"},i,e,t);return m("div",{id:"splash-modal",class:"fixed inset-0 bg-black/90 flex items-center justify-center z-[9999] hidden"},s)}function $n(i){return{detach:()=>{},refreshUI:()=>{}}}class Hn{constructor(){this.detachFn=null,this.modal=Kn(),document.body.appendChild(this.modal);const e=$n(this.modal);this.detachFn=e.detach,this.footerMain=document.getElementById("footer-main"),this.contentMain=document.getElementById("content-main"),this.splashLogo=this.modal.querySelector("#splash-logo")}show(){var e,t,s,n;this.splashLogo&&(this.splashLogo.src=oe("static/logo.png")),this.modal.classList.remove("hidden"),this.modal.style.opacity="1",(e=this.footerMain)==null||e.classList.remove("content-visible"),(t=this.footerMain)==null||t.classList.add("content-hidden"),(s=this.contentMain)==null||s.classList.remove("content-visible"),(n=this.contentMain)==null||n.classList.add("content-hidden")}hide(e=1e3){setTimeout(()=>{this.modal.style.opacity="0",this.modal.style.transition="opacity 0.5s ease-out",setTimeout(()=>{var t,s,n,r;this.modal.classList.add("hidden"),this.modal.style.opacity="1",(t=this.footerMain)==null||t.classList.remove("content-hidden"),(s=this.footerMain)==null||s.classList.add("content-visible"),(n=this.contentMain)==null||n.classList.remove("content-hidden"),(r=this.contentMain)==null||r.classList.add("content-visible")},500)},e)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function zn(){const i=m("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"API Key Required"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"In order to use AI Features, you must add an OpenAI API Key in the config."}),t=K({id:"key-not-set-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),s=m("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return m("div",{id:"openai-key-not-set-modal",class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"},s)}function Jn(i){const e=i.querySelector("#key-not-set-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class jn{constructor(){this.detachFn=null,this.modal=zn(),document.body.appendChild(this.modal);const e=Jn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Wn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"text-[100px] mb-6 animate-bounce z-10",textContent:"🤖"}),t=m("div",{class:"flex items-center space-x-3 mb-6 z-10"},m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),s=m("div",{class:"text-sm text-gray-400 mt-4 z-10 text-center",textContent:"AI is Generating..."}),n=m("div",{class:"relative flex flex-col items-center bg-gradient-to-br from-gray-800 to-gray-900 border border-purple-700 shadow-2xl rounded-2xl px-10 py-8 animate-fade-in w-[360px] max-w-full"},i,e,t,s);return m("div",{id:"ai-working-modal",class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},n)}function Xn(i){return{detach:()=>{},refreshUI:()=>{}}}class Vn{constructor(){this.detachFn=null,this.modal=Wn(),document.body.appendChild(this.modal);const e=Xn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Yn(){const i=m("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"AI Generation Failed"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"Unable to generate AI content. Please try again."}),t=K({id:"generation-failed-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),s=m("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return m("div",{id:"ai-generation-failed-modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"},s)}function Zn(i){const e=i.querySelector("#generation-failed-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class Qn{constructor(){this.detachFn=null,this.modal=Yn(),document.body.appendChild(this.modal);const e=Zn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class ea{constructor(e){this.onCancelLoading=e,this.initialize()}initialize(){this.errorModal=new Rn,this.featureModal=new Pn,this.loadingModal=new qn(this.onCancelLoading),this.splashModal=new Hn,this.openAIKeyNotSetModal=new jn,this.aiWorkingModal=new Vn,this.aiGenerationFailedModal=new Qn}showError(e){this.errorModal.show(e)}showFeatureBlocked(){this.featureModal.show()}showOpenAIKeyNotSet(){this.openAIKeyNotSetModal.show()}showAIWorking(){this.aiWorkingModal.show()}hideAIWorking(){this.aiWorkingModal.hide()}showAIGenerationFailed(){this.aiGenerationFailedModal.show()}showLoading(e){this.loadingModal.show(e)}hideLoading(){this.loadingModal.hide()}showSplashScreen(){this.splashModal.show()}hideSplashScreen(){this.splashModal.hide()}destroy(){var e,t,s,n,r,a,o;(e=this.errorModal)==null||e.destroy(),(t=this.featureModal)==null||t.destroy(),(s=this.loadingModal)==null||s.destroy(),(n=this.splashModal)==null||n.destroy(),(r=this.openAIKeyNotSetModal)==null||r.destroy(),(a=this.aiWorkingModal)==null||a.destroy(),(o=this.aiGenerationFailedModal)==null||o.destroy()}reload(){this.destroy(),this.initialize()}}let zt=null;function V(){return zt||(zt=new ea(()=>{console.warn("User cancelled loading.")})),zt}let Us=!1;function Ye(i="Loading Sounds...",e="Please wait while we dial it in.",t,s){if(Nn()||Ks()&&!s)return;s&&(Ni(),qs(!0));const n=V();n.showLoading({title:i,subtext:e,cancelable:!!t}),t&&(n.destroy(),n.reload())}function Ni(i){i&&qs(!1),Ks()||V().hideLoading()}function qs(i){Us=i}function Ks(){return Us}let Qe=0;function $s(){Qe++,Qe===1&&Ye()}function Hs(){Qe--,Qe<=0&&(Qe=0,Ni())}async function ta(i){$s();try{return await i}finally{Hs()}}const Jt=new Map;async function ia(i,e){e?await i.load:await oa(i.load)}async function Bt(i,e=Z(),t=null,s,n,r,a=!0){var C;const o=i.split("/");let c="sf2",d="musyngkite",l="acoustic_grand_piano";o.length===3?[c,d,l]=o:o.length===2?[d,l]=o:o.length===1&&(l=o[0]);const u=e instanceof OfflineAudioContext;Jt.has(e)||Jt.set(e,new Map);const h=Jt.get(e),f=String(e??Z()),y=`${d}/${l}@${f}`;if(a&&h.has(y))return h.get(y);const b=Math.max(0,Math.min(127,Math.round((s??1)*127))),g=e.createStereoPanner();n!==void 0&&(g.pan.value=n);const p=e.createGain();p.connect(g),t&&t.context!==e&&(console.warn("[loadInstrument] Ignoring mismatched destination from different context"),t=null),g.connect(t||De(e));const v={instrument:l,volume:b,destination:p,disableScheduler:u};let S;if(d==="smolken")S=new an(e,v);else if(d==="splendidgrandpiano")S=new on(e,v);else if(d==="mallets")S=new ln(e,v);else if(d==="drummachines")S=new cn(e,v);else{const w={"fluidr3-gm":"FluidR3_GM",fatboy:"FatBoy",musyngkite:"MusyngKite"}[d.toLowerCase()]||"MusyngKite",G=`https://gleitz.github.io/midi-js-soundfonts/${w}/${l}-ogg.js`;S=new dn(e,{...v,instrumentUrl:G,kit:w})}if(await ia(S,r??!1),d==="drummachines"){const N=((C=S.getSampleNames)==null?void 0:C.call(S))??[],w=new Map;N.forEach((L,G)=>{const E=36+G;w.set(E,L)}),S.__midiMap=w}const _=S;return _.setVolume=N=>{var L;const w=Math.max(0,Math.min(127,Math.round(N*127)));"output"in _&&typeof((L=_.output)==null?void 0:L.setVolume)=="function"&&_.output.setVolume(w)},_.setPan=N=>{g.pan.value=Math.max(-1,Math.min(1,N))},a&&h.set(y,_),_}async function sa(){const e=ra().map(s=>{switch(s){case"FluidR3_GM":return"fluidr3-gm";case"FatBoy":return"fatboy";case"MusyngKite":return"musyngkite";default:return s.toLowerCase()}}),t=["splendidgrandpiano","mallets","drummachines","smolken"];return[...new Set([...e,...t])]}function ra(){const e=[...pn()];return e.includes("FatBoy")||e.push("FatBoy"),e}async function na(i){const e=i.toLowerCase();return e==="splendidgrandpiano"?["splendidgrandpiano"]:e==="mallets"?un():e==="drummachines"?Ts():e==="smolken"?hn():(await Bt(`${i}/acoustic_grand_piano`,Z(),null,0,0,!0),fn()??[])}function aa(){return Ts()}async function oa(i){$s();try{await i}finally{Hs()}}function la(){return{name:"sf2",loadInstrument:Bt,getAvailableLibraries:sa,getAvailableInstruments:na}}let jt=null,gt=null;function Ie(){return jt||(jt=new AudioContext),jt}function ca(){if(!gt){const i=Ie();gt=i.createGain(),gt.connect(i.destination)}return gt}const da={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function j(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,s,n]=e,r=t.toUpperCase(),a=da[r];if(a===void 0)return null;const o=[...s].reduce((d,l)=>l==="#"?d+1:l==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}let ce=null,ui=null;async function ua(i){if(ui===i)return;ce=await Bt(i,Ie()),ui=i}function ha(){return ui}function fa(i,e=100,t=!1){var o;if(!ce)return null;const n=Ie().currentTime,r=j(i);if(r===null)return null;const a=((o=ce.__midiMap)==null?void 0:o.get(r))??r;return ce.start({note:a,stopId:a,velocity:e,time:n,loop:t}),()=>{ce==null||ce.stop({stopId:a})}}function pa(i){var s;if(!ce)return;const e=j(i);if(e===null)return;const t=((s=ce.__midiMap)==null?void 0:s.get(e))??e;ce.stop({stopId:t})}async function ma(i,e,t,s=100,n=!1,r=null,a=null,o=null,c,d){var y;const l=a||Z(),u=await Bt(i,l,o,c,d);c!==void 0&&u.setVolume&&u.setVolume(c),d!==void 0&&u.setPan&&u.setPan(d);const h=j(e);if(h===null)return null;const f=((y=u.__midiMap)==null?void 0:y.get(h))??h;return u.start({note:f,duration:t,velocity:s,loop:n,time:r??l.currentTime}),null}function ya(){return{name:"sf2",setActiveInstrument:ua,getActiveInstrumentName:ha,playNote:fa,stopNoteByPitch:pa,loadAndPlayNote:ma}}const it=[{id:"0000_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Grand Piano"},{id:"0000_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Grand Piano"},{id:"0000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Grand Piano"},{id:"0000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Grand Piano"},{id:"0000_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Grand Piano"},{id:"0000_SBLive_sf2",library:"SBLive",displayName:"Acoustic Grand Piano"},{id:"0000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Grand Piano"},{id:"0010_Aspirin_sf2_file",library:"Aspirin",displayName:"Bright Acoustic Piano"},{id:"0010_Chaos_sf2_file",library:"Chaos",displayName:"Bright Acoustic Piano"},{id:"0010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bright Acoustic Piano"},{id:"0010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bright Acoustic Piano"},{id:"0010_JCLive_sf2_file",library:"JCLive",displayName:"Bright Acoustic Piano"},{id:"0010_SBLive_sf2",library:"SBLive",displayName:"Bright Acoustic Piano"},{id:"0010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bright Acoustic Piano"},{id:"0020_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Grand Piano"},{id:"0020_Chaos_sf2_file",library:"Chaos",displayName:"Electric Grand Piano"},{id:"0020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Grand Piano"},{id:"0020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Grand Piano"},{id:"0020_JCLive_sf2_file",library:"JCLive",displayName:"Electric Grand Piano"},{id:"0020_SBLive_sf2",library:"SBLive",displayName:"Electric Grand Piano"},{id:"0020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Grand Piano"},{id:"0050_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Piano 2"},{id:"0050_Chaos_sf2_file",library:"Chaos",displayName:"Electric Piano 2"},{id:"0050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Piano 2"},{id:"0050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Piano 2"},{id:"0050_JCLive_sf2_file",library:"JCLive",displayName:"Electric Piano 2"},{id:"0050_SBLive_sf2",library:"SBLive",displayName:"Electric Piano 2"},{id:"0050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Piano 2"},{id:"0060_Aspirin_sf2_file",library:"Aspirin",displayName:"Harpsichord"},{id:"0060_Chaos_sf2_file",library:"Chaos",displayName:"Harpsichord"},{id:"0060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harpsichord"},{id:"0060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harpsichord"},{id:"0060_JCLive_sf2_file",library:"JCLive",displayName:"Harpsichord"},{id:"0060_SBLive_sf2",library:"SBLive",displayName:"Harpsichord"},{id:"0060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harpsichord"},{id:"0070_Aspirin_sf2_file",library:"Aspirin",displayName:"Clavinet"},{id:"0070_Chaos_sf2_file",library:"Chaos",displayName:"Clavinet"},{id:"0070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clavinet"},{id:"0070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clavinet"},{id:"0070_JCLive_sf2_file",library:"JCLive",displayName:"Clavinet"},{id:"0070_SBLive_sf2",library:"SBLive",displayName:"Clavinet"},{id:"0070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clavinet"},{id:"0080_Aspirin_sf2_file",library:"Aspirin",displayName:"Celesta"},{id:"0080_Chaos_sf2_file",library:"Chaos",displayName:"Celesta"},{id:"0080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Celesta"},{id:"0080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Celesta"},{id:"0080_JCLive_sf2_file",library:"JCLive",displayName:"Celesta"},{id:"0080_SBLive_sf2",library:"SBLive",displayName:"Celesta"},{id:"0080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Celesta"},{id:"0090_Aspirin_sf2_file",library:"Aspirin",displayName:"Glockenspiel"},{id:"0090_Chaos_sf2_file",library:"Chaos",displayName:"Glockenspiel"},{id:"0090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Glockenspiel"},{id:"0090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Glockenspiel"},{id:"0090_JCLive_sf2_file",library:"JCLive",displayName:"Glockenspiel"},{id:"0090_SBLive_sf2",library:"SBLive",displayName:"Glockenspiel"},{id:"0090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Glockenspiel"},{id:"0100_Aspirin_sf2_file",library:"Aspirin",displayName:"Music Box"},{id:"0100_Chaos_sf2_file",library:"Chaos",displayName:"Music Box"},{id:"0100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Music Box"},{id:"0100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Music Box"},{id:"0100_JCLive_sf2_file",library:"JCLive",displayName:"Music Box"},{id:"0100_SBLive_sf2",library:"SBLive",displayName:"Music Box"},{id:"0100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Music Box"},{id:"0110_Aspirin_sf2_file",library:"Aspirin",displayName:"Vibraphone"},{id:"0110_Chaos_sf2_file",library:"Chaos",displayName:"Vibraphone"},{id:"0110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Vibraphone"},{id:"0110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Vibraphone"},{id:"0110_JCLive_sf2_file",library:"JCLive",displayName:"Vibraphone"},{id:"0110_SBLive_sf2",library:"SBLive",displayName:"Vibraphone"},{id:"0110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Vibraphone"},{id:"0120_Aspirin_sf2_file",library:"Aspirin",displayName:"Marimba"},{id:"0120_Chaos_sf2_file",library:"Chaos",displayName:"Marimba"},{id:"0120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Marimba"},{id:"0120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Marimba"},{id:"0120_JCLive_sf2_file",library:"JCLive",displayName:"Marimba"},{id:"0120_SBLive_sf2",library:"SBLive",displayName:"Marimba"},{id:"0120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Marimba"},{id:"0130_Aspirin_sf2_file",library:"Aspirin",displayName:"Xylophone"},{id:"0130_Chaos_sf2_file",library:"Chaos",displayName:"Xylophone"},{id:"0130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Xylophone"},{id:"0130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Xylophone"},{id:"0130_JCLive_sf2_file",library:"JCLive",displayName:"Xylophone"},{id:"0130_SBLive_sf2",library:"SBLive",displayName:"Xylophone"},{id:"0130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Xylophone"},{id:"0140_Aspirin_sf2_file",library:"Aspirin",displayName:"Tubular Bells"},{id:"0140_Chaos_sf2_file",library:"Chaos",displayName:"Tubular Bells"},{id:"0140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tubular Bells"},{id:"0140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tubular Bells"},{id:"0140_JCLive_sf2_file",library:"JCLive",displayName:"Tubular Bells"},{id:"0140_SBLive_sf2",library:"SBLive",displayName:"Tubular Bells"},{id:"0140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tubular Bells"},{id:"0150_Aspirin_sf2_file",library:"Aspirin",displayName:"Dulcimer"},{id:"0150_Chaos_sf2_file",library:"Chaos",displayName:"Dulcimer"},{id:"0150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Dulcimer"},{id:"0150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Dulcimer"},{id:"0150_JCLive_sf2_file",library:"JCLive",displayName:"Dulcimer"},{id:"0150_SBLive_sf2",library:"SBLive",displayName:"Dulcimer"},{id:"0150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Dulcimer"},{id:"0160_Aspirin_sf2_file",library:"Aspirin",displayName:"Drawbar Organ"},{id:"0160_Chaos_sf2_file",library:"Chaos",displayName:"Drawbar Organ"},{id:"0160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drawbar Organ"},{id:"0160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Drawbar Organ"},{id:"0160_JCLive_sf2_file",library:"JCLive",displayName:"Drawbar Organ"},{id:"0160_SBLive_sf2",library:"SBLive",displayName:"Drawbar Organ"},{id:"0160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Drawbar Organ"},{id:"0170_Aspirin_sf2_file",library:"Aspirin",displayName:"Percussive Organ"},{id:"0170_Chaos_sf2_file",library:"Chaos",displayName:"Percussive Organ"},{id:"0170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Percussive Organ"},{id:"0170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Percussive Organ"},{id:"0170_JCLive_sf2_file",library:"JCLive",displayName:"Percussive Organ"},{id:"0170_SBLive_sf2",library:"SBLive",displayName:"Percussive Organ"},{id:"0170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Percussive Organ"},{id:"0180_Aspirin_sf2_file",library:"Aspirin",displayName:"Rock Organ"},{id:"0180_Chaos_sf2_file",library:"Chaos",displayName:"Rock Organ"},{id:"0180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Rock Organ"},{id:"0180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Rock Organ"},{id:"0180_JCLive_sf2_file",library:"JCLive",displayName:"Rock Organ"},{id:"0180_SBLive_sf2",library:"SBLive",displayName:"Rock Organ"},{id:"0180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Rock Organ"},{id:"0190_Aspirin_sf2_file",library:"Aspirin",displayName:"Church Organ"},{id:"0190_Chaos_sf2_file",library:"Chaos",displayName:"Church Organ"},{id:"0190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Church Organ"},{id:"0190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Church Organ"},{id:"0190_JCLive_sf2_file",library:"JCLive",displayName:"Church Organ"},{id:"0190_SBLive_sf2",library:"SBLive",displayName:"Church Organ"},{id:"0190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Church Organ"},{id:"0200_Aspirin_sf2_file",library:"Aspirin",displayName:"Reed Organ"},{id:"0200_Chaos_sf2_file",library:"Chaos",displayName:"Reed Organ"},{id:"0200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reed Organ"},{id:"0200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reed Organ"},{id:"0200_JCLive_sf2_file",library:"JCLive",displayName:"Reed Organ"},{id:"0200_SBLive_sf2",library:"SBLive",displayName:"Reed Organ"},{id:"0200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reed Organ"},{id:"0210_Aspirin_sf2_file",library:"Aspirin",displayName:"Accordion"},{id:"0210_Chaos_sf2_file",library:"Chaos",displayName:"Accordion"},{id:"0210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Accordion"},{id:"0210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Accordion"},{id:"0210_JCLive_sf2_file",library:"JCLive",displayName:"Accordion"},{id:"0210_SBLive_sf2",library:"SBLive",displayName:"Accordion"},{id:"0210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Accordion"},{id:"0220_Aspirin_sf2_file",library:"Aspirin",displayName:"Harmonica"},{id:"0220_Chaos_sf2_file",library:"Chaos",displayName:"Harmonica"},{id:"0220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harmonica"},{id:"0220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harmonica"},{id:"0220_JCLive_sf2_file",library:"JCLive",displayName:"Harmonica"},{id:"0220_SBLive_sf2",library:"SBLive",displayName:"Harmonica"},{id:"0220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harmonica"},{id:"0230_Aspirin_sf2_file",library:"Aspirin",displayName:"Tango Accordion"},{id:"0230_Chaos_sf2_file",library:"Chaos",displayName:"Tango Accordion"},{id:"0230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tango Accordion"},{id:"0230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tango Accordion"},{id:"0230_JCLive_sf2_file",library:"JCLive",displayName:"Tango Accordion"},{id:"0230_SBLive_sf2",library:"SBLive",displayName:"Tango Accordion"},{id:"0230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tango Accordion"},{id:"0240_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (nylon)"},{id:"0240_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (nylon)"},{id:"0240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (nylon)"},{id:"0240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (nylon)"},{id:"0240_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (nylon)"},{id:"0250_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (steel)"},{id:"0250_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (steel)"},{id:"0250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (steel)"},{id:"0250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (steel)"},{id:"0250_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (steel)"},{id:"0260_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (jazz)"},{id:"0260_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (jazz)"},{id:"0260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (jazz)"},{id:"0260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (jazz)"},{id:"0260_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (jazz)"},{id:"0270_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (clean)"},{id:"0270_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (clean)"},{id:"0270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (clean)"},{id:"0270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (clean)"},{id:"0270_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (clean)"},{id:"0270_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (clean)"},{id:"0270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (clean)"},{id:"0280_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (muted)"},{id:"0280_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (muted)"},{id:"0280_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (muted)"},{id:"0280_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (muted)"},{id:"0280_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (muted)"},{id:"0280_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (muted)"},{id:"0280_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (muted)"},{id:"0290_Aspirin_sf2_file",library:"Aspirin",displayName:"Overdriven Guitar"},{id:"0290_Chaos_sf2_file",library:"Chaos",displayName:"Overdriven Guitar"},{id:"0290_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Overdriven Guitar"},{id:"0290_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Overdriven Guitar"},{id:"0290_JCLive_sf2_file",library:"JCLive",displayName:"Overdriven Guitar"},{id:"0290_SBLive_sf2",library:"SBLive",displayName:"Overdriven Guitar"},{id:"0290_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Overdriven Guitar"},{id:"0300_Aspirin_sf2_file",library:"Aspirin",displayName:"Distortion Guitar"},{id:"0300_Chaos_sf2_file",library:"Chaos",displayName:"Distortion Guitar"},{id:"0300_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Distortion Guitar"},{id:"0300_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Distortion Guitar"},{id:"0300_JCLive_sf2_file",library:"JCLive",displayName:"Distortion Guitar"},{id:"0300_SBLive_sf2",library:"SBLive",displayName:"Distortion Guitar"},{id:"0300_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Distortion Guitar"},{id:"0310_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Harmonics"},{id:"0310_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Harmonics"},{id:"0310_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Harmonics"},{id:"0310_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Harmonics"},{id:"0310_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Harmonics"},{id:"0310_SBLive_sf2",library:"SBLive",displayName:"Guitar Harmonics"},{id:"0310_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Harmonics"},{id:"0320_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Bass"},{id:"0320_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Bass"},{id:"0320_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Bass"},{id:"0320_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Bass"},{id:"0320_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Bass"},{id:"0320_SBLive_sf2",library:"SBLive",displayName:"Acoustic Bass"},{id:"0320_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Bass"},{id:"0330_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (finger)"},{id:"0330_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (finger)"},{id:"0330_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (finger)"},{id:"0330_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (finger)"},{id:"0330_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (finger)"},{id:"0330_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (finger)"},{id:"0330_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (finger)"},{id:"0340_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (pick)"},{id:"0340_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (pick)"},{id:"0340_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (pick)"},{id:"0340_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (pick)"},{id:"0340_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (pick)"},{id:"0340_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (pick)"},{id:"0340_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (pick)"},{id:"0350_Aspirin_sf2_file",library:"Aspirin",displayName:"Fretless Bass"},{id:"0350_Chaos_sf2_file",library:"Chaos",displayName:"Fretless Bass"},{id:"0350_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fretless Bass"},{id:"0350_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fretless Bass"},{id:"0350_JCLive_sf2_file",library:"JCLive",displayName:"Fretless Bass"},{id:"0350_SBLive_sf2",library:"SBLive",displayName:"Fretless Bass"},{id:"0350_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fretless Bass"},{id:"0360_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 1"},{id:"0360_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 1"},{id:"0360_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 1"},{id:"0360_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 1"},{id:"0360_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 1"},{id:"0360_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 1"},{id:"0360_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 1"},{id:"0370_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 2"},{id:"0370_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 2"},{id:"0370_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 2"},{id:"0370_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 2"},{id:"0370_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 2"},{id:"0370_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 2"},{id:"0370_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 2"},{id:"0380_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 1"},{id:"0380_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 1"},{id:"0380_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 1"},{id:"0380_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 1"},{id:"0380_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 1"},{id:"0380_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 1"},{id:"0380_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 1"},{id:"0390_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 2"},{id:"0390_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 2"},{id:"0390_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 2"},{id:"0390_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 2"},{id:"0390_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 2"},{id:"0390_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 2"},{id:"0390_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 2"},{id:"0400_Aspirin_sf2_file",library:"Aspirin",displayName:"Violin"},{id:"0400_Chaos_sf2_file",library:"Chaos",displayName:"Violin"},{id:"0400_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Violin"},{id:"0400_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Violin"},{id:"0400_JCLive_sf2_file",library:"JCLive",displayName:"Violin"},{id:"0400_SBLive_sf2",library:"SBLive",displayName:"Violin"},{id:"0400_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Violin"},{id:"0410_Aspirin_sf2_file",library:"Aspirin",displayName:"Viola"},{id:"0410_Chaos_sf2_file",library:"Chaos",displayName:"Viola"},{id:"0410_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Viola"},{id:"0410_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Viola"},{id:"0410_JCLive_sf2_file",library:"JCLive",displayName:"Viola"},{id:"0410_SBLive_sf2",library:"SBLive",displayName:"Viola"},{id:"0410_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Viola"},{id:"0420_Aspirin_sf2_file",library:"Aspirin",displayName:"Cello"},{id:"0420_Chaos_sf2_file",library:"Chaos",displayName:"Cello"},{id:"0420_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Cello"},{id:"0420_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Cello"},{id:"0420_JCLive_sf2_file",library:"JCLive",displayName:"Cello"},{id:"0420_SBLive_sf2",library:"SBLive",displayName:"Cello"},{id:"0420_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Cello"},{id:"0430_Aspirin_sf2_file",library:"Aspirin",displayName:"Contrabass"},{id:"0430_Chaos_sf2_file",library:"Chaos",displayName:"Contrabass"},{id:"0430_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Contrabass"},{id:"0430_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Contrabass"},{id:"0430_JCLive_sf2_file",library:"JCLive",displayName:"Contrabass"},{id:"0430_SBLive_sf2",library:"SBLive",displayName:"Contrabass"},{id:"0430_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Contrabass"},{id:"0440_Aspirin_sf2_file",library:"Aspirin",displayName:"Tremolo Strings"},{id:"0440_Chaos_sf2_file",library:"Chaos",displayName:"Tremolo Strings"},{id:"0440_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tremolo Strings"},{id:"0440_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tremolo Strings"},{id:"0440_JCLive_sf2_file",library:"JCLive",displayName:"Tremolo Strings"},{id:"0440_SBLive_sf2",library:"SBLive",displayName:"Tremolo Strings"},{id:"0440_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tremolo Strings"},{id:"0450_Aspirin_sf2_file",library:"Aspirin",displayName:"Pizzicato Strings"},{id:"0450_Chaos_sf2_file",library:"Chaos",displayName:"Pizzicato Strings"},{id:"0450_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pizzicato Strings"},{id:"0450_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pizzicato Strings"},{id:"0450_JCLive_sf2_file",library:"JCLive",displayName:"Pizzicato Strings"},{id:"0450_SBLive_sf2",library:"SBLive",displayName:"Pizzicato Strings"},{id:"0450_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pizzicato Strings"},{id:"0460_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestral Harp"},{id:"0460_Chaos_sf2_file",library:"Chaos",displayName:"Orchestral Harp"},{id:"0460_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestral Harp"},{id:"0460_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestral Harp"},{id:"0460_JCLive_sf2_file",library:"JCLive",displayName:"Orchestral Harp"},{id:"0460_SBLive_sf2",library:"SBLive",displayName:"Orchestral Harp"},{id:"0460_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestral Harp"},{id:"0470_Aspirin_sf2_file",library:"Aspirin",displayName:"Timpani"},{id:"0470_Chaos_sf2_file",library:"Chaos",displayName:"Timpani"},{id:"0470_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Timpani"},{id:"0470_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Timpani"},{id:"0470_JCLive_sf2_file",library:"JCLive",displayName:"Timpani"},{id:"0470_SBLive_sf2",library:"SBLive",displayName:"Timpani"},{id:"0470_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Timpani"},{id:"0480_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 1"},{id:"0480_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 1"},{id:"0480_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 1"},{id:"0480_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 1"},{id:"0480_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 1"},{id:"0480_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 1"},{id:"0480_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 1"},{id:"0490_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 2"},{id:"0490_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 2"},{id:"0490_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 2"},{id:"0490_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 2"},{id:"0490_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 2"},{id:"0490_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 2"},{id:"0490_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 2"},{id:"0500_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 1"},{id:"0500_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 1"},{id:"0500_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 1"},{id:"0500_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 1"},{id:"0500_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 1"},{id:"0500_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 1"},{id:"0500_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 1"},{id:"0510_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 2"},{id:"0510_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 2"},{id:"0510_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 2"},{id:"0510_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 2"},{id:"0510_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 2"},{id:"0510_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 2"},{id:"0510_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 2"},{id:"0520_Aspirin_sf2_file",library:"Aspirin",displayName:"Choir Aahs"},{id:"0520_Chaos_sf2_file",library:"Chaos",displayName:"Choir Aahs"},{id:"0520_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Choir Aahs"},{id:"0520_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Choir Aahs"},{id:"0520_JCLive_sf2_file",library:"JCLive",displayName:"Choir Aahs"},{id:"0520_SBLive_sf2",library:"SBLive",displayName:"Choir Aahs"},{id:"0520_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Choir Aahs"},{id:"0530_Aspirin_sf2_file",library:"Aspirin",displayName:"Voice Oohs"},{id:"0530_Chaos_sf2_file",library:"Chaos",displayName:"Voice Oohs"},{id:"0530_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Voice Oohs"},{id:"0530_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Voice Oohs"},{id:"0530_JCLive_sf2_file",library:"JCLive",displayName:"Voice Oohs"},{id:"0530_SBLive_sf2",library:"SBLive",displayName:"Voice Oohs"},{id:"0530_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Voice Oohs"},{id:"0540_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Choir"},{id:"0540_Chaos_sf2_file",library:"Chaos",displayName:"Synth Choir"},{id:"0540_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Choir"},{id:"0540_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Choir"},{id:"0540_JCLive_sf2_file",library:"JCLive",displayName:"Synth Choir"},{id:"0540_SBLive_sf2",library:"SBLive",displayName:"Synth Choir"},{id:"0540_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Choir"},{id:"0550_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestra Hit"},{id:"0550_Chaos_sf2_file",library:"Chaos",displayName:"Orchestra Hit"},{id:"0550_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestra Hit"},{id:"0550_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestra Hit"},{id:"0550_JCLive_sf2_file",library:"JCLive",displayName:"Orchestra Hit"},{id:"0550_SBLive_sf2",library:"SBLive",displayName:"Orchestra Hit"},{id:"0550_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestra Hit"},{id:"0560_Aspirin_sf2_file",library:"Aspirin",displayName:"Trumpet"},{id:"0560_Chaos_sf2_file",library:"Chaos",displayName:"Trumpet"},{id:"0560_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trumpet"},{id:"0560_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trumpet"},{id:"0560_JCLive_sf2_file",library:"JCLive",displayName:"Trumpet"},{id:"0560_SBLive_sf2",library:"SBLive",displayName:"Trumpet"},{id:"0560_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trumpet"},{id:"0570_Aspirin_sf2_file",library:"Aspirin",displayName:"Trombone"},{id:"0570_Chaos_sf2_file",library:"Chaos",displayName:"Trombone"},{id:"0570_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trombone"},{id:"0570_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trombone"},{id:"0570_JCLive_sf2_file",library:"JCLive",displayName:"Trombone"},{id:"0570_SBLive_sf2",library:"SBLive",displayName:"Trombone"},{id:"0570_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trombone"},{id:"0580_Aspirin_sf2_file",library:"Aspirin",displayName:"Tuba"},{id:"0580_Chaos_sf2_file",library:"Chaos",displayName:"Tuba"},{id:"0580_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tuba"},{id:"0580_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tuba"},{id:"0580_JCLive_sf2_file",library:"JCLive",displayName:"Tuba"},{id:"0580_SBLive_sf2",library:"SBLive",displayName:"Tuba"},{id:"0580_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tuba"},{id:"0590_Aspirin_sf2_file",library:"Aspirin",displayName:"Muted Trumpet"},{id:"0590_Chaos_sf2_file",library:"Chaos",displayName:"Muted Trumpet"},{id:"0590_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Muted Trumpet"},{id:"0590_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Muted Trumpet"},{id:"0590_JCLive_sf2_file",library:"JCLive",displayName:"Muted Trumpet"},{id:"0590_SBLive_sf2",library:"SBLive",displayName:"Muted Trumpet"},{id:"0590_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Muted Trumpet"},{id:"0600_Aspirin_sf2_file",library:"Aspirin",displayName:"French Horn"},{id:"0600_Chaos_sf2_file",library:"Chaos",displayName:"French Horn"},{id:"0600_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"French Horn"},{id:"0600_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"French Horn"},{id:"0600_JCLive_sf2_file",library:"JCLive",displayName:"French Horn"},{id:"0600_SBLive_sf2",library:"SBLive",displayName:"French Horn"},{id:"0600_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"French Horn"},{id:"0610_Aspirin_sf2_file",library:"Aspirin",displayName:"Brass Section"},{id:"0610_Chaos_sf2_file",library:"Chaos",displayName:"Brass Section"},{id:"0610_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Brass Section"},{id:"0610_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Brass Section"},{id:"0610_JCLive_sf2_file",library:"JCLive",displayName:"Brass Section"},{id:"0610_SBLive_sf2",library:"SBLive",displayName:"Brass Section"},{id:"0610_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Brass Section"},{id:"0620_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 1"},{id:"0620_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 1"},{id:"0620_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 1"},{id:"0620_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 1"},{id:"0620_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 1"},{id:"0620_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 1"},{id:"0620_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 1"},{id:"0630_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 2"},{id:"0630_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 2"},{id:"0630_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 2"},{id:"0630_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 2"},{id:"0630_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 2"},{id:"0630_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 2"},{id:"0630_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 2"},{id:"0640_Aspirin_sf2_file",library:"Aspirin",displayName:"Soprano Sax"},{id:"0640_Chaos_sf2_file",library:"Chaos",displayName:"Soprano Sax"},{id:"0640_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Soprano Sax"},{id:"0640_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Soprano Sax"},{id:"0640_JCLive_sf2_file",library:"JCLive",displayName:"Soprano Sax"},{id:"0640_SBLive_sf2",library:"SBLive",displayName:"Soprano Sax"},{id:"0640_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Soprano Sax"},{id:"0650_Aspirin_sf2_file",library:"Aspirin",displayName:"Alto Sax"},{id:"0650_Chaos_sf2_file",library:"Chaos",displayName:"Alto Sax"},{id:"0650_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Alto Sax"},{id:"0650_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Alto Sax"},{id:"0650_JCLive_sf2_file",library:"JCLive",displayName:"Alto Sax"},{id:"0650_SBLive_sf2",library:"SBLive",displayName:"Alto Sax"},{id:"0650_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Alto Sax"},{id:"0660_Aspirin_sf2_file",library:"Aspirin",displayName:"Tenor Sax"},{id:"0660_Chaos_sf2_file",library:"Chaos",displayName:"Tenor Sax"},{id:"0660_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tenor Sax"},{id:"0660_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tenor Sax"},{id:"0660_JCLive_sf2_file",library:"JCLive",displayName:"Tenor Sax"},{id:"0660_SBLive_sf2",library:"SBLive",displayName:"Tenor Sax"},{id:"0660_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tenor Sax"},{id:"0670_Aspirin_sf2_file",library:"Aspirin",displayName:"Baritone Sax"},{id:"0670_Chaos_sf2_file",library:"Chaos",displayName:"Baritone Sax"},{id:"0670_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Baritone Sax"},{id:"0670_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Baritone Sax"},{id:"0670_JCLive_sf2_file",library:"JCLive",displayName:"Baritone Sax"},{id:"0670_SBLive_sf2",library:"SBLive",displayName:"Baritone Sax"},{id:"0670_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Baritone Sax"},{id:"0680_Aspirin_sf2_file",library:"Aspirin",displayName:"Oboe"},{id:"0680_Chaos_sf2_file",library:"Chaos",displayName:"Oboe"},{id:"0680_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Oboe"},{id:"0680_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Oboe"},{id:"0680_JCLive_sf2_file",library:"JCLive",displayName:"Oboe"},{id:"0680_SBLive_sf2",library:"SBLive",displayName:"Oboe"},{id:"0680_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Oboe"},{id:"0690_Aspirin_sf2_file",library:"Aspirin",displayName:"English Horn"},{id:"0690_Chaos_sf2_file",library:"Chaos",displayName:"English Horn"},{id:"0690_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"English Horn"},{id:"0690_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"English Horn"},{id:"0690_JCLive_sf2_file",library:"JCLive",displayName:"English Horn"},{id:"0690_SBLive_sf2",library:"SBLive",displayName:"English Horn"},{id:"0690_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"English Horn"},{id:"0700_Aspirin_sf2_file",library:"Aspirin",displayName:"Bassoon"},{id:"0700_Chaos_sf2_file",library:"Chaos",displayName:"Bassoon"},{id:"0700_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bassoon"},{id:"0700_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bassoon"},{id:"0700_JCLive_sf2_file",library:"JCLive",displayName:"Bassoon"},{id:"0700_SBLive_sf2",library:"SBLive",displayName:"Bassoon"},{id:"0700_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bassoon"},{id:"0710_Aspirin_sf2_file",library:"Aspirin",displayName:"Clarinet"},{id:"0710_Chaos_sf2_file",library:"Chaos",displayName:"Clarinet"},{id:"0710_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clarinet"},{id:"0710_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clarinet"},{id:"0710_JCLive_sf2_file",library:"JCLive",displayName:"Clarinet"},{id:"0710_SBLive_sf2",library:"SBLive",displayName:"Clarinet"},{id:"0710_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clarinet"},{id:"0720_Aspirin_sf2_file",library:"Aspirin",displayName:"Piccolo"},{id:"0720_Chaos_sf2_file",library:"Chaos",displayName:"Piccolo"},{id:"0720_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Piccolo"},{id:"0720_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Piccolo"},{id:"0720_JCLive_sf2_file",library:"JCLive",displayName:"Piccolo"},{id:"0720_SBLive_sf2",library:"SBLive",displayName:"Piccolo"},{id:"0720_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Piccolo"},{id:"0730_Aspirin_sf2_file",library:"Aspirin",displayName:"Flute"},{id:"0730_Chaos_sf2_file",library:"Chaos",displayName:"Flute"},{id:"0730_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Flute"},{id:"0730_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Flute"},{id:"0730_JCLive_sf2_file",library:"JCLive",displayName:"Flute"},{id:"0730_SBLive_sf2",library:"SBLive",displayName:"Flute"},{id:"0730_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Flute"},{id:"0740_Aspirin_sf2_file",library:"Aspirin",displayName:"Recorder"},{id:"0740_Chaos_sf2_file",library:"Chaos",displayName:"Recorder"},{id:"0740_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Recorder"},{id:"0740_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Recorder"},{id:"0740_JCLive_sf2_file",library:"JCLive",displayName:"Recorder"},{id:"0740_SBLive_sf2",library:"SBLive",displayName:"Recorder"},{id:"0740_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Recorder"},{id:"0750_Aspirin_sf2_file",library:"Aspirin",displayName:"Pan Flute"},{id:"0750_Chaos_sf2_file",library:"Chaos",displayName:"Pan Flute"},{id:"0750_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pan Flute"},{id:"0750_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pan Flute"},{id:"0750_JCLive_sf2_file",library:"JCLive",displayName:"Pan Flute"},{id:"0750_SBLive_sf2",library:"SBLive",displayName:"Pan Flute"},{id:"0750_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pan Flute"},{id:"0760_Aspirin_sf2_file",library:"Aspirin",displayName:"Blown Bottle"},{id:"0760_Chaos_sf2_file",library:"Chaos",displayName:"Blown Bottle"},{id:"0760_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Blown Bottle"},{id:"0760_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Blown Bottle"},{id:"0760_JCLive_sf2_file",library:"JCLive",displayName:"Blown Bottle"},{id:"0760_SBLive_sf2",library:"SBLive",displayName:"Blown Bottle"},{id:"0760_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Blown Bottle"},{id:"0770_Aspirin_sf2_file",library:"Aspirin",displayName:"Shakuhachi"},{id:"0770_Chaos_sf2_file",library:"Chaos",displayName:"Shakuhachi"},{id:"0770_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shakuhachi"},{id:"0770_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shakuhachi"},{id:"0770_JCLive_sf2_file",library:"JCLive",displayName:"Shakuhachi"},{id:"0770_SBLive_sf2",library:"SBLive",displayName:"Shakuhachi"},{id:"0770_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shakuhachi"},{id:"0780_Aspirin_sf2_file",library:"Aspirin",displayName:"Whistle"},{id:"0780_Chaos_sf2_file",library:"Chaos",displayName:"Whistle"},{id:"0780_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Whistle"},{id:"0780_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Whistle"},{id:"0780_JCLive_sf2_file",library:"JCLive",displayName:"Whistle"},{id:"0780_SBLive_sf2",library:"SBLive",displayName:"Whistle"},{id:"0780_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Whistle"},{id:"0790_Aspirin_sf2_file",library:"Aspirin",displayName:"Ocarina"},{id:"0790_Chaos_sf2_file",library:"Chaos",displayName:"Ocarina"},{id:"0790_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Ocarina"},{id:"0790_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Ocarina"},{id:"0790_JCLive_sf2_file",library:"JCLive",displayName:"Ocarina"},{id:"0790_SBLive_sf2",library:"SBLive",displayName:"Ocarina"},{id:"0790_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Ocarina"},{id:"0800_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 1 (square)"},{id:"0800_Chaos_sf2_file",library:"Chaos",displayName:"Lead 1 (square)"},{id:"0800_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 1 (square)"},{id:"0800_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 1 (square)"},{id:"0800_JCLive_sf2_file",library:"JCLive",displayName:"Lead 1 (square)"},{id:"0800_SBLive_sf2",library:"SBLive",displayName:"Lead 1 (square)"},{id:"0800_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 1 (square)"},{id:"0810_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 2 (sawtooth)"},{id:"0810_Chaos_sf2_file",library:"Chaos",displayName:"Lead 2 (sawtooth)"},{id:"0810_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 2 (sawtooth)"},{id:"0810_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 2 (sawtooth)"},{id:"0810_JCLive_sf2_file",library:"JCLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SBLive_sf2",library:"SBLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 2 (sawtooth)"},{id:"0820_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 3 (calliope)"},{id:"0820_Chaos_sf2_file",library:"Chaos",displayName:"Lead 3 (calliope)"},{id:"0820_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 3 (calliope)"},{id:"0820_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 3 (calliope)"},{id:"0820_JCLive_sf2_file",library:"JCLive",displayName:"Lead 3 (calliope)"},{id:"0820_SBLive_sf2",library:"SBLive",displayName:"Lead 3 (calliope)"},{id:"0820_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 3 (calliope)"},{id:"0830_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 4 (chiff)"},{id:"0830_Chaos_sf2_file",library:"Chaos",displayName:"Lead 4 (chiff)"},{id:"0830_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 4 (chiff)"},{id:"0830_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 4 (chiff)"},{id:"0830_JCLive_sf2_file",library:"JCLive",displayName:"Lead 4 (chiff)"},{id:"0830_SBLive_sf2",library:"SBLive",displayName:"Lead 4 (chiff)"},{id:"0830_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 4 (chiff)"},{id:"0840_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 5 (charang)"},{id:"0840_Chaos_sf2_file",library:"Chaos",displayName:"Lead 5 (charang)"},{id:"0840_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 5 (charang)"},{id:"0840_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 5 (charang)"},{id:"0840_JCLive_sf2_file",library:"JCLive",displayName:"Lead 5 (charang)"},{id:"0840_SBLive_sf2",library:"SBLive",displayName:"Lead 5 (charang)"},{id:"0840_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 5 (charang)"},{id:"0850_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 6 (voice)"},{id:"0850_Chaos_sf2_file",library:"Chaos",displayName:"Lead 6 (voice)"},{id:"0850_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 6 (voice)"},{id:"0850_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 6 (voice)"},{id:"0850_JCLive_sf2_file",library:"JCLive",displayName:"Lead 6 (voice)"},{id:"0850_SBLive_sf2",library:"SBLive",displayName:"Lead 6 (voice)"},{id:"0850_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 6 (voice)"},{id:"0860_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 7 (fifths)"},{id:"0860_Chaos_sf2_file",library:"Chaos",displayName:"Lead 7 (fifths)"},{id:"0860_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 7 (fifths)"},{id:"0860_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 7 (fifths)"},{id:"0860_JCLive_sf2_file",library:"JCLive",displayName:"Lead 7 (fifths)"},{id:"0860_SBLive_sf2",library:"SBLive",displayName:"Lead 7 (fifths)"},{id:"0860_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 7 (fifths)"},{id:"0870_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 8 (bass + lead)"},{id:"0870_Chaos_sf2_file",library:"Chaos",displayName:"Lead 8 (bass + lead)"},{id:"0870_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 8 (bass + lead)"},{id:"0870_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 8 (bass + lead)"},{id:"0870_JCLive_sf2_file",library:"JCLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SBLive_sf2",library:"SBLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 8 (bass + lead)"},{id:"0880_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 1 (new age)"},{id:"0880_Chaos_sf2_file",library:"Chaos",displayName:"Pad 1 (new age)"},{id:"0880_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 1 (new age)"},{id:"0880_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 1 (new age)"},{id:"0880_JCLive_sf2_file",library:"JCLive",displayName:"Pad 1 (new age)"},{id:"0880_SBLive_sf2",library:"SBLive",displayName:"Pad 1 (new age)"},{id:"0880_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 1 (new age)"},{id:"0890_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 2 (warm)"},{id:"0890_Chaos_sf2_file",library:"Chaos",displayName:"Pad 2 (warm)"},{id:"0890_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 2 (warm)"},{id:"0890_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 2 (warm)"},{id:"0890_JCLive_sf2_file",library:"JCLive",displayName:"Pad 2 (warm)"},{id:"0890_SBLive_sf2",library:"SBLive",displayName:"Pad 2 (warm)"},{id:"0890_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 2 (warm)"},{id:"0900_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 3 (polysynth)"},{id:"0900_Chaos_sf2_file",library:"Chaos",displayName:"Pad 3 (polysynth)"},{id:"0900_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 3 (polysynth)"},{id:"0900_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 3 (polysynth)"},{id:"0900_JCLive_sf2_file",library:"JCLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SBLive_sf2",library:"SBLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 3 (polysynth)"},{id:"0910_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 4 (choir)"},{id:"0910_Chaos_sf2_file",library:"Chaos",displayName:"Pad 4 (choir)"},{id:"0910_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 4 (choir)"},{id:"0910_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 4 (choir)"},{id:"0910_JCLive_sf2_file",library:"JCLive",displayName:"Pad 4 (choir)"},{id:"0910_SBLive_sf2",library:"SBLive",displayName:"Pad 4 (choir)"},{id:"0910_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 4 (choir)"},{id:"0920_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 5 (bowed)"},{id:"0920_Chaos_sf2_file",library:"Chaos",displayName:"Pad 5 (bowed)"},{id:"0920_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 5 (bowed)"},{id:"0920_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 5 (bowed)"},{id:"0920_JCLive_sf2_file",library:"JCLive",displayName:"Pad 5 (bowed)"},{id:"0920_SBLive_sf2",library:"SBLive",displayName:"Pad 5 (bowed)"},{id:"0920_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 5 (bowed)"},{id:"0930_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 6 (metallic)"},{id:"0930_Chaos_sf2_file",library:"Chaos",displayName:"Pad 6 (metallic)"},{id:"0930_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 6 (metallic)"},{id:"0930_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 6 (metallic)"},{id:"0930_JCLive_sf2_file",library:"JCLive",displayName:"Pad 6 (metallic)"},{id:"0930_SBLive_sf2",library:"SBLive",displayName:"Pad 6 (metallic)"},{id:"0930_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 6 (metallic)"},{id:"0940_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 7 (halo)"},{id:"0940_Chaos_sf2_file",library:"Chaos",displayName:"Pad 7 (halo)"},{id:"0940_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 7 (halo)"},{id:"0940_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 7 (halo)"},{id:"0940_JCLive_sf2_file",library:"JCLive",displayName:"Pad 7 (halo)"},{id:"0940_SBLive_sf2",library:"SBLive",displayName:"Pad 7 (halo)"},{id:"0940_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 7 (halo)"},{id:"0950_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 8 (sweep)"},{id:"0950_Chaos_sf2_file",library:"Chaos",displayName:"Pad 8 (sweep)"},{id:"0950_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 8 (sweep)"},{id:"0950_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 8 (sweep)"},{id:"0950_JCLive_sf2_file",library:"JCLive",displayName:"Pad 8 (sweep)"},{id:"0950_SBLive_sf2",library:"SBLive",displayName:"Pad 8 (sweep)"},{id:"0950_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 8 (sweep)"},{id:"0960_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 1 (rain)"},{id:"0960_Chaos_sf2_file",library:"Chaos",displayName:"FX 1 (rain)"},{id:"0960_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 1 (rain)"},{id:"0960_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 1 (rain)"},{id:"0960_JCLive_sf2_file",library:"JCLive",displayName:"FX 1 (rain)"},{id:"0960_SBLive_sf2",library:"SBLive",displayName:"FX 1 (rain)"},{id:"0960_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 1 (rain)"},{id:"0970_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 2 (soundtrack)"},{id:"0970_Chaos_sf2_file",library:"Chaos",displayName:"FX 2 (soundtrack)"},{id:"0970_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 2 (soundtrack)"},{id:"0970_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 2 (soundtrack)"},{id:"0970_JCLive_sf2_file",library:"JCLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SBLive_sf2",library:"SBLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 2 (soundtrack)"},{id:"0980_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 3 (crystal)"},{id:"0980_Chaos_sf2_file",library:"Chaos",displayName:"FX 3 (crystal)"},{id:"0980_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 3 (crystal)"},{id:"0980_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 3 (crystal)"},{id:"0980_JCLive_sf2_file",library:"JCLive",displayName:"FX 3 (crystal)"},{id:"0980_SBLive_sf2",library:"SBLive",displayName:"FX 3 (crystal)"},{id:"0980_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 3 (crystal)"},{id:"0990_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 4 (atmosphere)"},{id:"0990_Chaos_sf2_file",library:"Chaos",displayName:"FX 4 (atmosphere)"},{id:"0990_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 4 (atmosphere)"},{id:"0990_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 4 (atmosphere)"},{id:"0990_JCLive_sf2_file",library:"JCLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SBLive_sf2",library:"SBLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 4 (atmosphere)"},{id:"1000_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 5 (brightness)"},{id:"1000_Chaos_sf2_file",library:"Chaos",displayName:"FX 5 (brightness)"},{id:"1000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 5 (brightness)"},{id:"1000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 5 (brightness)"},{id:"1000_JCLive_sf2_file",library:"JCLive",displayName:"FX 5 (brightness)"},{id:"1000_SBLive_sf2",library:"SBLive",displayName:"FX 5 (brightness)"},{id:"1000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 5 (brightness)"},{id:"1010_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 6 (goblins)"},{id:"1010_Chaos_sf2_file",library:"Chaos",displayName:"FX 6 (goblins)"},{id:"1010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 6 (goblins)"},{id:"1010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 6 (goblins)"},{id:"1010_JCLive_sf2_file",library:"JCLive",displayName:"FX 6 (goblins)"},{id:"1010_SBLive_sf2",library:"SBLive",displayName:"FX 6 (goblins)"},{id:"1010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 6 (goblins)"},{id:"1020_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 7 (echoes)"},{id:"1020_Chaos_sf2_file",library:"Chaos",displayName:"FX 7 (echoes)"},{id:"1020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 7 (echoes)"},{id:"1020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 7 (echoes)"},{id:"1020_JCLive_sf2_file",library:"JCLive",displayName:"FX 7 (echoes)"},{id:"1020_SBLive_sf2",library:"SBLive",displayName:"FX 7 (echoes)"},{id:"1020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 7 (echoes)"},{id:"1030_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 8 (sci-fi)"},{id:"1030_Chaos_sf2_file",library:"Chaos",displayName:"FX 8 (sci-fi)"},{id:"1030_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 8 (sci-fi)"},{id:"1030_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 8 (sci-fi)"},{id:"1030_JCLive_sf2_file",library:"JCLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SBLive_sf2",library:"SBLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 8 (sci-fi)"},{id:"1040_Aspirin_sf2_file",library:"Aspirin",displayName:"Sitar"},{id:"1040_Chaos_sf2_file",library:"Chaos",displayName:"Sitar"},{id:"1040_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Sitar"},{id:"1040_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Sitar"},{id:"1040_JCLive_sf2_file",library:"JCLive",displayName:"Sitar"},{id:"1040_SBLive_sf2",library:"SBLive",displayName:"Sitar"},{id:"1040_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Sitar"},{id:"1050_Aspirin_sf2_file",library:"Aspirin",displayName:"Banjo"},{id:"1050_Chaos_sf2_file",library:"Chaos",displayName:"Banjo"},{id:"1050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Banjo"},{id:"1050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Banjo"},{id:"1050_JCLive_sf2_file",library:"JCLive",displayName:"Banjo"},{id:"1050_SBLive_sf2",library:"SBLive",displayName:"Banjo"},{id:"1050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Banjo"},{id:"1060_Aspirin_sf2_file",library:"Aspirin",displayName:"Shamisen"},{id:"1060_Chaos_sf2_file",library:"Chaos",displayName:"Shamisen"},{id:"1060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shamisen"},{id:"1060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shamisen"},{id:"1060_JCLive_sf2_file",library:"JCLive",displayName:"Shamisen"},{id:"1060_SBLive_sf2",library:"SBLive",displayName:"Shamisen"},{id:"1060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shamisen"},{id:"1070_Aspirin_sf2_file",library:"Aspirin",displayName:"Koto"},{id:"1070_Chaos_sf2_file",library:"Chaos",displayName:"Koto"},{id:"1070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Koto"},{id:"1070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Koto"},{id:"1070_JCLive_sf2_file",library:"JCLive",displayName:"Koto"},{id:"1070_SBLive_sf2",library:"SBLive",displayName:"Koto"},{id:"1070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Koto"},{id:"1080_Aspirin_sf2_file",library:"Aspirin",displayName:"Kalimba"},{id:"1080_Chaos_sf2_file",library:"Chaos",displayName:"Kalimba"},{id:"1080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Kalimba"},{id:"1080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Kalimba"},{id:"1080_JCLive_sf2_file",library:"JCLive",displayName:"Kalimba"},{id:"1080_SBLive_sf2",library:"SBLive",displayName:"Kalimba"},{id:"1080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Kalimba"},{id:"1090_Aspirin_sf2_file",library:"Aspirin",displayName:"Bagpipe"},{id:"1090_Chaos_sf2_file",library:"Chaos",displayName:"Bagpipe"},{id:"1090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bagpipe"},{id:"1090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bagpipe"},{id:"1090_JCLive_sf2_file",library:"JCLive",displayName:"Bagpipe"},{id:"1090_SBLive_sf2",library:"SBLive",displayName:"Bagpipe"},{id:"1090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bagpipe"},{id:"1100_Aspirin_sf2_file",library:"Aspirin",displayName:"Fiddle"},{id:"1100_Chaos_sf2_file",library:"Chaos",displayName:"Fiddle"},{id:"1100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fiddle"},{id:"1100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fiddle"},{id:"1100_JCLive_sf2_file",library:"JCLive",displayName:"Fiddle"},{id:"1100_SBLive_sf2",library:"SBLive",displayName:"Fiddle"},{id:"1100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fiddle"},{id:"1110_Aspirin_sf2_file",library:"Aspirin",displayName:"Shanai"},{id:"1110_Chaos_sf2_file",library:"Chaos",displayName:"Shanai"},{id:"1110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shanai"},{id:"1110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shanai"},{id:"1110_JCLive_sf2_file",library:"JCLive",displayName:"Shanai"},{id:"1110_SBLive_sf2",library:"SBLive",displayName:"Shanai"},{id:"1110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shanai"},{id:"1120_Aspirin_sf2_file",library:"Aspirin",displayName:"Tinkle Bell"},{id:"1120_Chaos_sf2_file",library:"Chaos",displayName:"Tinkle Bell"},{id:"1120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tinkle Bell"},{id:"1120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tinkle Bell"},{id:"1120_JCLive_sf2_file",library:"JCLive",displayName:"Tinkle Bell"},{id:"1120_SBLive_sf2",library:"SBLive",displayName:"Tinkle Bell"},{id:"1120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tinkle Bell"},{id:"1130_Aspirin_sf2_file",library:"Aspirin",displayName:"Agogo"},{id:"1130_Chaos_sf2_file",library:"Chaos",displayName:"Agogo"},{id:"1130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Agogo"},{id:"1130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Agogo"},{id:"1130_JCLive_sf2_file",library:"JCLive",displayName:"Agogo"},{id:"1130_SBLive_sf2",library:"SBLive",displayName:"Agogo"},{id:"1130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Agogo"},{id:"1140_Aspirin_sf2_file",library:"Aspirin",displayName:"Steel Drums"},{id:"1140_Chaos_sf2_file",library:"Chaos",displayName:"Steel Drums"},{id:"1140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Steel Drums"},{id:"1140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Steel Drums"},{id:"1140_JCLive_sf2_file",library:"JCLive",displayName:"Steel Drums"},{id:"1140_SBLive_sf2",library:"SBLive",displayName:"Steel Drums"},{id:"1140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Steel Drums"},{id:"1150_Aspirin_sf2_file",library:"Aspirin",displayName:"Woodblock"},{id:"1150_Chaos_sf2_file",library:"Chaos",displayName:"Woodblock"},{id:"1150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Woodblock"},{id:"1150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Woodblock"},{id:"1150_JCLive_sf2_file",library:"JCLive",displayName:"Woodblock"},{id:"1150_SBLive_sf2",library:"SBLive",displayName:"Woodblock"},{id:"1150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Woodblock"},{id:"1160_Aspirin_sf2_file",library:"Aspirin",displayName:"Taiko Drum"},{id:"1160_Chaos_sf2_file",library:"Chaos",displayName:"Taiko Drum"},{id:"1160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Taiko Drum"},{id:"1160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Taiko Drum"},{id:"1160_JCLive_sf2_file",library:"JCLive",displayName:"Taiko Drum"},{id:"1160_SBLive_sf2",library:"SBLive",displayName:"Taiko Drum"},{id:"1160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Taiko Drum"},{id:"1170_Aspirin_sf2_file",library:"Aspirin",displayName:"Melodic Tom"},{id:"1170_Chaos_sf2_file",library:"Chaos",displayName:"Melodic Tom"},{id:"1170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Melodic Tom"},{id:"1170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Melodic Tom"},{id:"1170_JCLive_sf2_file",library:"JCLive",displayName:"Melodic Tom"},{id:"1170_SBLive_sf2",library:"SBLive",displayName:"Melodic Tom"},{id:"1170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Melodic Tom"},{id:"1180_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Drum"},{id:"1180_Chaos_sf2_file",library:"Chaos",displayName:"Synth Drum"},{id:"1180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Drum"},{id:"1180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Drum"},{id:"1180_JCLive_sf2_file",library:"JCLive",displayName:"Synth Drum"},{id:"1180_SBLive_sf2",library:"SBLive",displayName:"Synth Drum"},{id:"1180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Drum"},{id:"1190_Aspirin_sf2_file",library:"Aspirin",displayName:"Reverse Cymbal"},{id:"1190_Chaos_sf2_file",library:"Chaos",displayName:"Reverse Cymbal"},{id:"1190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reverse Cymbal"},{id:"1190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reverse Cymbal"},{id:"1190_JCLive_sf2_file",library:"JCLive",displayName:"Reverse Cymbal"},{id:"1190_SBLive_sf2",library:"SBLive",displayName:"Reverse Cymbal"},{id:"1190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reverse Cymbal"},{id:"1200_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Fret Noise"},{id:"1200_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Fret Noise"},{id:"1200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Fret Noise"},{id:"1200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Fret Noise"},{id:"1200_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Fret Noise"},{id:"1200_SBLive_sf2",library:"SBLive",displayName:"Guitar Fret Noise"},{id:"1200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Fret Noise"},{id:"1210_Aspirin_sf2_file",library:"Aspirin",displayName:"Breath Noise"},{id:"1210_Chaos_sf2_file",library:"Chaos",displayName:"Breath Noise"},{id:"1210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Breath Noise"},{id:"1210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Breath Noise"},{id:"1210_JCLive_sf2_file",library:"JCLive",displayName:"Breath Noise"},{id:"1210_SBLive_sf2",library:"SBLive",displayName:"Breath Noise"},{id:"1210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Breath Noise"},{id:"1220_Aspirin_sf2_file",library:"Aspirin",displayName:"Seashore"},{id:"1220_Chaos_sf2_file",library:"Chaos",displayName:"Seashore"},{id:"1220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Seashore"},{id:"1220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Seashore"},{id:"1220_JCLive_sf2_file",library:"JCLive",displayName:"Seashore"},{id:"1220_SBLive_sf2",library:"SBLive",displayName:"Seashore"},{id:"1220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Seashore"},{id:"1230_Aspirin_sf2_file",library:"Aspirin",displayName:"Bird Tweet"},{id:"1230_Chaos_sf2_file",library:"Chaos",displayName:"Bird Tweet"},{id:"1230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bird Tweet"},{id:"1230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bird Tweet"},{id:"1230_JCLive_sf2_file",library:"JCLive",displayName:"Bird Tweet"},{id:"1230_SBLive_sf2",library:"SBLive",displayName:"Bird Tweet"},{id:"1230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bird Tweet"},{id:"1240_Aspirin_sf2_file",library:"Aspirin",displayName:"Telephone Ring"},{id:"1240_Chaos_sf2_file",library:"Chaos",displayName:"Telephone Ring"},{id:"1240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Telephone Ring"},{id:"1240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Telephone Ring"},{id:"1240_JCLive_sf2_file",library:"JCLive",displayName:"Telephone Ring"},{id:"1240_SBLive_sf2",library:"SBLive",displayName:"Telephone Ring"},{id:"1240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Telephone Ring"},{id:"1250_Aspirin_sf2_file",library:"Aspirin",displayName:"Helicopter"},{id:"1250_Chaos_sf2_file",library:"Chaos",displayName:"Helicopter"},{id:"1250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Helicopter"},{id:"1250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Helicopter"},{id:"1250_JCLive_sf2_file",library:"JCLive",displayName:"Helicopter"},{id:"1250_SBLive_sf2",library:"SBLive",displayName:"Helicopter"},{id:"1250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Helicopter"},{id:"1260_Aspirin_sf2_file",library:"Aspirin",displayName:"Applause"},{id:"1260_Chaos_sf2_file",library:"Chaos",displayName:"Applause"},{id:"1260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Applause"},{id:"1260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Applause"},{id:"1260_JCLive_sf2_file",library:"JCLive",displayName:"Applause"},{id:"1260_SBLive_sf2",library:"SBLive",displayName:"Applause"},{id:"1260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Applause"},{id:"1270_Aspirin_sf2_file",library:"Aspirin",displayName:"Gunshot"},{id:"1270_Chaos_sf2_file",library:"Chaos",displayName:"Gunshot"},{id:"1270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Gunshot"},{id:"1270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Gunshot"},{id:"1270_JCLive_sf2_file",library:"JCLive",displayName:"Gunshot"},{id:"1270_SBLive_sf2",library:"SBLive",displayName:"Gunshot"},{id:"1270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Gunshot"},{id:"12835_1_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 1"},{id:"12835_1_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 1"},{id:"12835_1_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 1"},{id:"12835_1_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 1"},{id:"12835_2_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 2"},{id:"12835_2_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 2"},{id:"12835_2_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 2"},{id:"12835_2_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 2"},{id:"12835_3_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 3"},{id:"12835_3_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 3"},{id:"12835_3_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 3"},{id:"12835_3_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 3"},{id:"12835_4_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 4"},{id:"12835_4_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 4"},{id:"12835_4_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 4"},{id:"12835_4_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 4"},{id:"12835_5_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 5"},{id:"12835_5_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 5"},{id:"12835_5_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 5"},{id:"12835_5_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 5"},{id:"12835_6_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 6"},{id:"12835_6_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 6"},{id:"12835_6_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 6"},{id:"12835_6_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 6"},{id:"12835_7_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 7"},{id:"12835_7_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 7"},{id:"12835_7_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 7"},{id:"12835_7_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 7"},{id:"12835_8_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 8"},{id:"12835_8_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 8"},{id:"12835_8_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 8"},{id:"12835_8_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 8"},{id:"12835_9_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 9"},{id:"12835_9_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 9"},{id:"12835_9_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 9"},{id:"12835_10_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 10"},{id:"12835_10_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 10"},{id:"12835_10_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 10"},{id:"12835_11_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 11"},{id:"12835_11_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 11"},{id:"12835_11_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 11"},{id:"12835_12_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 12"},{id:"12835_12_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 12"},{id:"12835_13_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 13"},{id:"12835_13_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 13"},{id:"12835_14_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 14"},{id:"12835_14_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 14"},{id:"12835_15_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 15"},{id:"12835_15_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 15"},{id:"12835_16_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 16"},{id:"12835_16_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 16"},{id:"12835_17_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 17"},{id:"12835_17_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 17"},{id:"12835_18_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 18"},{id:"12835_18_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 18"}];function ga(i){const e=1+i%18,t=it.find(n=>n.id.startsWith(`12835_${e}_`)&&n.library==="FluidR3_GM");if(t)return{library:t.library,displayName:t.displayName};const s=it.find(n=>n.id.startsWith(`12835_${e}_`));return s?{library:s.library,displayName:s.displayName}:null}const ba=Array.from({length:47},(i,e)=>35+e),_a={35:"kick2",36:"kick1",37:"rim",38:"snare1",39:"clap",40:"snare2",41:"lowtom2",42:"hh_closed",43:"lowtom1",44:"hh_pedal",45:"midtom2",46:"hh_open",47:"midtom1",48:"hitom2",49:"crash1",50:"hitom1",51:"ride1",52:"china",53:"ride_bell",54:"tamb",55:"splash",56:"cowbell",57:"crash2",58:"vibraslap",59:"ride2",60:"bongo_hi",61:"bongo_lo",62:"conga_hi_mute",63:"conga_hi_open",64:"conga_lo",65:"timbale_hi",66:"timbale_lo",67:"agogo_hi",68:"agogo_lo",69:"cabasa",70:"maracas",71:"whistle_short",72:"whistle_long",73:"guiro_short",74:"guiro_long",75:"claves",76:"woodblock_hi",77:"woodblock_lo",78:"cuica_mute",79:"cuica_open",80:"triangle_mute",81:"triangle_open"},Ji=ta,Wt=new Map;let le=null;function ji(i){return Math.max(i,1e-4)}async function wt(i){return new Promise((e,t)=>{const s=document.createElement("script");s.src=i,s.onload=()=>e(),s.onerror=()=>t(new Error(`Failed to load script: ${i}`)),document.body.appendChild(s)})}async function va(){le||(await wt("https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"),le=new window.WebAudioFontPlayer)}async function wi(i,e=Z(),t=null,s,n,r,a=!0){const[o,c]=i.split("/"),d=String(e),l=`${o}/${c}@${d}`;Wt.has(e)||Wt.set(e,new Map);const u=Wt.get(e);if(a&&u.has(l))return u.get(l);if(await va(),le.resumeContext){const w=le.resumeContext;le.resumeContext=L=>{if(!(L instanceof OfflineAudioContext))return w.call(le,L)}}const h=it.find(w=>w.library===o&&w.displayName===c);if(!h)throw new Error(`Could not find WebAudioFont entry for library=${o} and instrument=${c}`);t&&t.context!==e&&(console.warn("[WebAudioFont] Ignoring mismatched destination from another context"),t=null);const f=t||De(e),y=e.createStereoPanner();if(y.pan.value=n??0,y.connect(f),!h.displayName.startsWith("Drum Kit")){const w=`_tone_${h.id}`,L=`https://surikov.github.io/webaudiofontdata/sound/${h.id}.js`;r?await wt(L):await Ji(wt(L));const G=window[w];if(!G)throw new Error(`Missing preset: ${w}`);if(le.loader.decodeAfterLoading(e,w),e instanceof OfflineAudioContext){const M=(G==null?void 0:G.zones)??[];for(const x of M)if(x.file&&!x.buffer){const B=atob(x.file),O=new ArrayBuffer(B.length),P=new Uint8Array(O);for(let H=0;H<B.length;H++)P[H]=B.charCodeAt(H);x.buffer=await new Promise((H,ie)=>e.decodeAudioData(O,H,ie))}}const E={_preset:G,_volume:s??1,_activeEnvelopes:[],start({note:M,duration:x=1,velocity:B=100,time:O}){const P=typeof M=="string"?j(M):M;if(P==null||typeof P!="number")return;const H=typeof O=="number"?O:0,ie=Math.max(.01,Math.min(1,B/127)),we=ji(E._volume),$t=Math.max(.01,Math.min(1,we*ie)),yt=le.queueWaveTable(e,y||De(),G,H,P,x,$t);E._activeEnvelopes.push(yt)},stop(){var M;for(const x of E._activeEnvelopes)try{x.cancel?x.cancel():(M=x.audioBufferSourceNode)!=null&&M.stop&&x.audioBufferSourceNode.stop()}catch(B){console.warn("Failed to stop envelope:",B)}E._activeEnvelopes=[]},setVolume(M){E._volume=Math.max(0,Math.min(1,M))},setPan(M){y.pan.value=Math.max(-1,Math.min(1,M))},load:Promise.resolve()};return a&&u.set(l,E),E}const g=h.id.match(/^12835_(\d+)_([A-Za-z0-9_]+)_sf2_file$/);if(!g)throw new Error(`Invalid drum ID format in catalogue: ${h.id}`);const[,p,v]=g,S=parseInt(p,10),_={},C=async()=>{for(const w of ba){const L=`_drum_${w}_${S}_${v}_sf2_file`,G=`https://surikov.github.io/webaudiofontdata/sound/${12800+w}_${S}_${v}_sf2_file.js`;try{await wt(G);const E=window[L];if(!E){console.warn(`Missing drum preset: ${L}`);continue}le.loader.decodeAfterLoading(e,L),_[w]=E}catch(E){console.warn(`Failed to load drum preset ${w}: ${E}`)}}};r??!1?await C():await Ji(C());const N={_preset:_,_volume:s??1,_activeEnvelopes:[],start({note:w,duration:L=1,velocity:G=100,time:E}){const M=typeof w=="string"?j(w):w;if(M==null||typeof M!="number"){console.warn(`Invalid MIDI pitch: ${w}`);return}const x=_[M];if(!x){console.warn(`No drum preset loaded for MIDI ${M}`);return}const B=typeof E=="number"?E:0,O=ji(N._volume),P=le.queueWaveTable(e,y||De(),x,B,M,L,O);N._activeEnvelopes.push(P)},stop(){var w;for(const L of N._activeEnvelopes)try{L.cancel?L.cancel():(w=L.audioBufferSourceNode)!=null&&w.stop&&L.audioBufferSourceNode.stop()}catch(G){console.warn("Failed to stop envelope:",G)}N._activeEnvelopes=[]},load:Promise.resolve(),setVolume(w){N._volume=Math.max(0,Math.min(1,w))},setPan(w){y.pan.value=Math.max(-1,Math.min(1,w))}};return a&&u.set(l,N),N}async function Sa(){const i=new Set;for(const e of it)i.add(e.library);return Array.from(i)}async function Ca(i){return it.filter(e=>e.library===i).map(e=>e.displayName)}function Na(){return{name:"webaudiofont",loadInstrument:wi,getAvailableLibraries:Sa,getAvailableInstruments:Ca}}let hi=null,fi=null;async function wa(i){if(fi===i)return;const[,e,t]=i.split("/");hi=await wi(`${e}/${t}`,Ie()),fi=i}function Ma(){return fi}function xa(i,e=100,t=!1){if(!hi)return null;const n=Ie().currentTime,r=j(i);return r===null?null:(hi.start({note:r,velocity:e,time:n,duration:1.5,loop:t}),()=>{})}function La(i){}async function ka(i,e,t,s=100,n=!1,r=null,a=null,o=null,c,d){const l=a||Z(),[,u,h]=i.split("/"),f=await wi(`${u}/${h}`,l,o,c,d);c!==void 0&&f.setVolume&&f.setVolume(c),d!==void 0&&f.setPan&&f.setPan(d);const y=j(e);return y===null||f.start({note:y,duration:t,velocity:s,loop:n,time:r??l.currentTime}),null}function Ga(){return{name:"webaudiofont",setActiveInstrument:wa,getActiveInstrumentName:Ma,playNote:xa,stopNoteByPitch:La,loadAndPlayNote:ka}}function zs(i=3){const r=["C","D","E","F","G","A","B"],a=["C#","D#","","F#","G#","A#",""],o=[i,i+1,i+2],c={};let d=0;for(const l of o)r.forEach(u=>{const h=`${u}${l}`;c[h]={note:h,x:d,width:60,height:200,isBlack:!1},d+=60});d=0;for(const l of o)a.forEach((u,h)=>{if(u===""){d+=60;return}const f=`${u}${l}`;c[f]={note:f,x:d+60-40/2,width:40,height:120,isBlack:!0},d+=60});return c}let Mt="sf2/fluidr3-gm/acoustic_grand_piano",Mi=3,Js=!1,js=zs(Mi);function Ba(){Mt="sf2/fluidr3-gm/acoustic_grand_piano",Li(Mt)}function Ea(i){Li(i),Mt=i}function xi(){return Mt}function Aa(){const i=document.getElementById("instrument-loop-toggle");return(i==null?void 0:i.checked)??!1}function Xt(){return Mi}function Wi(i){Mi=i}function Be(){return Js}function Ta(i){Js=i}function Pe(){return js}function Ia(i){js=i}const ct={sf2:ya(),webaudiofont:Ga()};async function Li(i){if(!i.includes("/"))throw new Error(`Invalid instrument name: "${i}". Expected "<engine>/<library>/<instrument>"`);const e=i.split("/")[0],t=ct[e];if(!t)throw new Error(`Engine "${e}" not available`);await t.setActiveInstrument(i)}function Ws(i,e=100,t=!1){const s=xi();if(!s)return null;const n=s.split("/")[0],r=ct[n];if(!r)throw new Error(`Engine "${n}" not available`);return r.playNote(i,e,t)}function Ra(i){const e=xi();if(!e)return;const t=e.split("/")[0],s=ct[t];if(!s)throw new Error(`Engine "${t}" not available`);s.stopNoteByPitch(i)}async function Oa(i,e,t=1,s=100,n=!1,r=null,a=null,o=null,c,d){const l=i.split("/")[0],u=ct[l];if(!u)throw new Error(`Engine "${l}" not available`);let h=a??Z(),f=o;return h.state==="suspended"&&(console.warn("[loadAndPlayNote] Using preview context due to suspended main context"),h=Ie(),f=ca()),await u.loadAndPlayNote(i,e,t,s,n,r,h,f,c,d)}let Vt=null;function Z(){return Vt||(Vt=new(window.AudioContext||window.webkitAudioContext)),Vt}const Yt=new WeakMap,Zt=new WeakMap;function Xs(i=Z()){if(!Zt.has(i)){const e=i.createAnalyser();e.fftSize=2048,Zt.set(i,e)}return Zt.get(i)}function De(i=Z()){if(!Yt.has(i)){const e=i.createGain(),t=Xs(i);e.connect(t),t.connect(i.destination),Yt.set(i,e)}return Yt.get(i)}function Fa(i){try{const e=Ws(i,100,!1);return e?{stop:e,forceStop:e}:null}catch(e){return console.error("[playNote] Failed to play note",i,e),null}}function Pa(i,e){const t=structuredClone(i);return t.tempo=e.bpm,t}function Vs(i){return{type:"CHANGE_TEMPO",bpm:i}}function Da(i){return Vs(i)}function Ua(i,e){const t=structuredClone(i);return t.timeSignature=[e.beats,4],t}function Ys(i){return{type:"SET_TIME_SIGNATURE",beats:i}}function qa(i){return Ys(i)}function Ka(i,e){const t=structuredClone(i);return t.totalMeasures=e.measures,t}function Zs(i){return{type:"SET_TOTAL_MEASURES",measures:i}}function $a(i){return Zs(i)}const Ha=new Set(["C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#","Cb"]),za=new Set(["M","m"]);function Ja(i){const e=i.slice(0,-1),t=i.slice(-1);if(!Ha.has(e)||!za.has(t))return null;const s=t==="M"?"major":"minor",n=mn.get(`${e} ${s}`);return n.empty?null:n.notes}const ja=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],Wa=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Qs={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function Xa(i){return i.includes("#")}function X(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,s,n]=e,r=t.toUpperCase(),a=Qs[r];if(a===void 0)return null;const o=[...s].reduce((d,l)=>l==="#"?d+1:l==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}function de(i){return X(i)}const Va=i=>{const e=X(i);return e!==null?e%12:0};function ki(i,e=21,t){const s=X(i);if(s===null)return null;const n=t-e+1,r=s-e,a=n-1-r;return a>=0&&a<n?a:null}function te(i,e,t){const n=t-e+1-1-i,r=e+n;return qe(r)}function qe(i,e=!1){const s=(e?Wa:ja)[i%12],n=Math.floor(i/12)-1;return`${s}${n}`}function er(i,e){const t=new Map;for(let s=i;s<=e;s++)t.set(s,Xa(qe(s)));return t}function Ya(i,e){const t=X(i),s=X(e);if(t===null||s===null)throw new Error(`Invalid pitches provided: ${i}, ${e}`);return t-s}function tr(i){const e=Ja(i),t=new Map;if(!e)return t;const s=new Set(e.map(n=>Qs[n]%12));for(let n=0;n<=127;n++){const r=n%12;t.set(n,s.has(r))}return t}function ir(){return typeof window<"u"&&typeof localStorage<"u"}function Et(i,e){ir()&&localStorage.setItem(i,JSON.stringify(e))}function dt(i){if(!ir())return null;const e=localStorage.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error(`Error parsing localStorage key "${i}":`,t),null}}const sr="grid-key-highlighting",rr="grid-snap-enabled",nr="snap-to-in-key",Za="CM";let ar=dt(sr)??!1,or=dt(rr)??!0,lr=dt(nr)??!1,cr=tr(Za),dr=!1;function ur(){return ar}function Qa(i){ar=i,Et(sr,i)}function hr(){return or}function eo(i){or=i,Et(rr,i)}function At(){return lr}function to(i){lr=i,Et(nr,i)}function Tt(){return cr}function io(i){cr=tr(i)}function st(){return dr}function Xi(i){dr=i}function so(i,e){const t=structuredClone(i);return t.songKey=e.songKey,io(e.songKey),t}function fr(i){return{type:"CHANGE_SONG_KEY",songKey:i}}function ro(i){return fr(i)}function no(i,e){const t=structuredClone(i);return t.snapResolution=e.snapResolution,t}function pr(i){return{type:"CHANGE_SNAP_RESOLUTION",snapResolution:i}}function ao(i){return pr(i)}function oo(i,e){const t=structuredClone(i);return t.noteDuration=e.noteDuration,t}function mr(i){return{type:"CHANGE_NOTE_DURATION",noteDuration:i}}function lo(i){return mr(i)}function co(i,e){const t=structuredClone(i);return t.isTripletMode=e.triplet,t.isDottedMode=e.dotted,t}function yr(i,e){return{type:"SET_NOTE_MODIFIER_MODE",triplet:i,dotted:e}}function uo(i,e){return yr(i,e)}const Gi={sf2:la(),webaudiofont:Na()},gr="sf2";async function br(i,e,t,s,n,r,a=!0){const o=i.split("/");if(o.length!==3)throw new Error(`Invalid instrument fullName format: "${i}". Expected format "engine/library/instrument"`);const[c,d,l]=o,u=Gi[c];if(!u)throw new Error(`Engine "${c}" not available`);return await u.loadInstrument(`${d}/${l}`,e,t,s,n,r,a)}async function ho(i,e,t,s,n,r,a){if(!s||s.length===0)return;const o=60/me();if(a!=null&&a.aborted)return;const c=await br(i,e,t,n,r);if(!(a!=null&&a.aborted))for(const d of s){if(a!=null&&a.aborted)return;const l=d.start*o,u=Math.max(.01,l),h=d.duration*o,f=d.velocity??100,y=X(d.pitch);if(y==null)continue;const b=i.split("/"),p=(b.length>=3?b[1]:b[0])==="drummachines"&&c.__midiMap?c.__midiMap.get(y)??y:y;try{c.start({note:p,duration:h,velocity:f,time:u,loop:!1})}catch(v){console.warn("[exportNotesToOffline] Failed to start note:",d,v)}}}function Vi(i){if(!i.container)return;const e=i.container.querySelector(".mute-btn"),t=i.container.querySelector(".solo-btn"),s=i.container.querySelector(".sequencer-body"),n=i.container.querySelector(".mini-contour");e==null||e.classList.toggle("bg-red-600",i.mute),e==null||e.classList.toggle("bg-gray-700",!i.mute),t==null||t.classList.toggle("bg-yellow-200",i.solo),t==null||t.classList.toggle("bg-gray-700",!i.solo);const r=i.mute&&!i.solo;s==null||s.classList.toggle("opacity-40",r),s==null||s.classList.toggle("opacity-100",!r),n==null||n.classList.toggle("opacity-40",r),n==null||n.classList.toggle("opacity-100",!r)}const Ke=["#ff006e","#3a86ff","#ffbe0b","#8338ec","#06d6a0","#ef476f","#118ab2","#ffd166","#073b4c","#8ac926","#0077b6","#00b4d8","#005f73","#03045e","#023e8a"];function It(i,e,t,s=0){const n=i.getContext("2d");if(!n)return;n.imageSmoothingEnabled=!1;const r=i.width,a=i.height;if(n.clearRect(0,0,r,a),!e.length)return;const o=Ke[s%Ke.length];n.fillStyle=o;const c=pe(),d=e.map(p=>j(p.pitch)).filter(p=>p!==null);if(!d.length)return;let l=Math.min(...d),u=Math.max(...d),h=Math.max(1,u-l);for(;a%h!==0;)u++,h=u-l;const f=a/h;for(const p of e){const v=j(p.pitch);if(v==null)continue;const S=p.start/c*r,_=p.duration/c*r,C=(v-l)/h,N=a-C*a-f/2,w=Math.round(S),L=Math.max(1,Math.round(_)),G=Math.round(N);n.fillRect(w,G,L,f)}const y=Te(),b=qi();n.save();let g=1;b>256?g=16:b>128?g=8:b>32&&(g=4);for(let p=0;p<=b;p++){if(p%g!==0)continue;const S=p*y/c*r,_=Math.round(S)+.5;n.beginPath(),n.moveTo(_,0),n.lineTo(_,a);const C=g===1||p%(g*2)===0;n.strokeStyle=C?"rgba(255, 255, 255, 0.12)":"rgba(255, 255, 255, 0.04)",n.lineWidth=.2,n.stroke()}n.restore()}function pi(i,e){const{config:t,container:s,matrix:n,colorIndex:r,getNotes:a}=i,[o,c]=e,d=X(o),l=X(c);if(d===null||l===null){console.warn(`Invalid note range: ${e}`);return}if(d>=l){console.warn("Invalid note range: low note must be lower than high note");return}t.noteRange=e,t.visibleNotes=Ya(c,o)+1;const u=s==null?void 0:s.querySelector(".mini-contour");u&&It(u,a(),t,r),n.setNoteRange(d,l)}function fo(i){i.instrumentName.toLowerCase().includes("drum kit")?(pi(i,["B1","A5"]),i.matrix.setCustomLabels(_a)):(pi(i,["A0","C9"]),i.matrix.setCustomLabels(null))}const Rt=new Map;function po(){Rt.clear()}function mo(i,e){Rt.set(i,e)}function yo(i){Rt.delete(i)}function _r(i){return Rt.get(i)}function xt(i,e=!0,t=null){var o;const s=_r(i.id);if(!s)return;const n=J.getInstance(),r=s.getMatrixContainer(),a=s.getMiniContourCanvas();if(!(!r||!a)){if(i.collapsed=e,s.collapsed=e,r.classList.toggle("hidden",e),a.classList.toggle("hidden",!e),t){const c=t.querySelector("img");if(c){const d=e?"icon-caret-up":"icon-caret-down";c.src=oe(`static/svg/${d}.svg`)}}if(e){s.toggleZoomControls(!1),s.toggleGripHandle(!1);for(const c of i.scheduledAnimations)clearTimeout(c);i.scheduledAnimations=[],It(a,i.notes,i.config,i.colorIndex)}else s.toggleZoomControls(!0),s.toggleGripHandle(!0),(o=i.matrix)==null||o.resize(),n.isActive()&&i.resumeAnimationsFromCurrentTime(n.getStartTime(),n.getStartBeat())}}function go(){for(const i of z())xt(i,!0)}const bo={totalMeasures:16,beatsPerMeasure:4,layout:{labelWidthColumns:1,headerHeightRows:2,footerHeightRows:1,labelWidth:80,headerHeight:40,footerHeight:40,baseCellWidth:70,minCellWidth:10,maxCellWidth:200,verticalCellRatio:4,highestMidi:108,lowestMidi:21},display:{showMeasureLines:!0,showBeatLines:!0,showHoveredCell:!0,highlightCurrentMeasure:!0},behavior:{zoom:1,scrollMargin:48,enableSnapping:!0,snapDivisions:4,maxZoom:1.6,minZoom:.5}};function _o(){return structuredClone(bo)}function vo(i,e){return{...i,...e,layout:{...i.layout,...e.layout??{}},display:{...i.display,...e.display??{}},behavior:{...i.behavior,...e.behavior??{}}}}const Bi={Midnight:{whiteKey:"#1e1e1e",blackKey:"#2a103b",labelWhite:"#2c2c2c",labelBlack:"#3a1d4d",textWhite:"#cfcfcf",textBlack:"#e6d9ff",gridLine:"#333",beatLine:"#4e3d63",measureLine:"#8561c2",outOfKey:"rgb(255, 1, 1)"},Seashell:{whiteKey:"#fefefe",blackKey:"#f1e7dc",labelWhite:"#dddddd",labelBlack:"#d4cfc9",textWhite:"#444",textBlack:"#663300",gridLine:"#ccc",beatLine:"#bbb",measureLine:"#999",outOfKey:"rgba(255, 255, 255, 0.05)"},Cyberpunk:{whiteKey:"#162447",blackKey:"#1b1b2f",labelWhite:"#1f4068",labelBlack:"#1f4068",textWhite:"#e43f5a",textBlack:"#e43f5a",gridLine:"#1f4068",beatLine:"#e43f5a",measureLine:"#ffcc00",outOfKey:"rgba(255, 255, 255, 0.05)"},"Classic Blue":{whiteKey:"#f5faff",blackKey:"#dceeff",labelWhite:"#aaccee",labelBlack:"#88bbdd",textWhite:"#002244",textBlack:"#001122",gridLine:"#99bbdd",beatLine:"#88aacc",measureLine:"#336699",outOfKey:"rgba(255, 255, 255, 0.05)"},Darkroom:{whiteKey:"#2c2c2c",blackKey:"#1e1e1e",labelWhite:"#2a2a2a",labelBlack:"#383838",textWhite:"#e0e0e0",textBlack:"#a0a0a0",gridLine:"#404040",beatLine:"#606060",measureLine:"#808080",outOfKey:"rgba(255, 255, 255, 0.05)"}};class So{constructor(e,t,s,n,r){this.getBlackKeyMap=n,this.getInKeyMap=r,this.scroll=e,this.config=t,this.interactionStore=s}draw(e){const{totalMeasures:t,beatsPerMeasure:s,layout:{baseCellWidth:n,verticalCellRatio:r,labelWidth:a,headerHeight:o},behavior:{zoom:c}}=this.config,{gridColorScheme:d}=W().theme,l=Bi[d],u=this.config.layout.highestMidi-this.config.layout.lowestMidi+1,h=n*c,f=h/r,y=this.scroll.getX(),b=this.scroll.getY();(e.canvas.width-a)/h;const g=t*s;e.save(),e.translate(a-y,o-b);const p=Math.max(0,Math.floor((y-a)/h)),v=ur(),S=this.getInKeyMap();for(let _=0;_<u;_++){const C=_*f,N=this.config.layout.highestMidi-_;let w;v?w=S.get(N)?l.whiteKey:l.blackKey:w=this.getBlackKeyMap().get(N)?l.blackKey:l.whiteKey,e.fillStyle=w,e.fillRect(0,C,g*h,f),e.strokeStyle=l.gridLine,e.beginPath(),e.moveTo(0,C),e.lineTo(g*h,C),e.stroke()}for(let _=p;_<=g;_++){if(_<0)continue;const C=_*h;e.strokeStyle=_%s===0?l.measureLine:l.beatLine,e.beginPath(),e.moveTo(C,0),e.lineTo(C,u*f),e.stroke()}e.restore()}}function Co(i){const{layout:{labelWidth:e,baseCellWidth:t},totalMeasures:s,beatsPerMeasure:n,behavior:{zoom:r}}=i,a=t*r;return e+s*n*a}function No(i){const{layout:{baseCellWidth:e,verticalCellRatio:t,highestMidi:s,lowestMidi:n,headerHeight:r},behavior:{zoom:a}}=i,o=s-n+1,c=e*a/t;return o*c+r}class wo{constructor(e,t){this.scrollX=0,this.scrollY=0,this.canvas=e,this.config=t}getX(){return this.scrollX}getY(){return this.scrollY}setScroll(e,t){this.scrollX=this.clampX(e),this.scrollY=this.clampY(t)}recalculateBounds(){}getMaxScrollX(){const e=this.canvas.offsetWidth;return Math.max(0,this.getContentWidth()-e)}getMaxScrollY(){const e=this.canvas.offsetHeight-this.config.layout.headerHeight;return Math.max(0,this.getContentHeight()-e)}clampX(e){return Math.max(0,Math.min(e,this.getMaxScrollX()))}clampY(e){return Math.max(0,Math.min(e,this.getMaxScrollY()))}getContentWidth(){return Co(this.config)}getContentHeight(){return No(this.config)}}function ut(i,e){const t=e.getBoundingClientRect();return{x:i.clientX-t.left,y:i.clientY-t.top}}function vr(i,e,t,s){const n=e.getBoundingClientRect();return{x:i.clientX-n.left+t.getX()-s.layout.labelWidth,y:i.clientY-n.top+t.getY()-s.layout.headerHeight}}function Mo(i,e,t,s,n){const r=t.getBoundingClientRect();return{x:i-r.left+s.getX()-n.layout.labelWidth,y:e-r.top+s.getY()-n.layout.headerHeight}}function ht(i,e,t,s,n=!1){const{layout:{labelWidth:r,headerHeight:a,baseCellWidth:o,verticalCellRatio:c,highestMidi:d,lowestMidi:l},behavior:{zoom:u}}=t,h=d-l+1,f=o*u,y=f/c,b=(i.x+e.getX()-r)/f;let g=Math.floor((i.y+e.getY()-a)/y);const p=n?s*(2/3):s,v=Math.floor(b/p)*p;if(v<0||g<0||g>=h)return null;if(At()&&!st()){const S=Tt(),_=d-g;let C=null,N=1/0;for(let w=-12;w<=12;w++){const L=_+w;if(L<l||L>d||!S.get(L))continue;const G=d-L,E=Math.abs(G-g);if(E<N&&(N=E,C=G),E===0)break}C!==null&&(g=C)}return{x:v,y:g}}class xo{constructor(e,t){this.notes=[],this.noteIndex=new Map,this.pitchIndex=new Map,this.config=e,this.playNote=t}set(e){this.notes=e}getAll(){return this.notes}add(e){this.notes.push(e)}getTrackedNotes(e){const t=e.getHoveredNoteKey(),s=r=>e.isNoteHighlighted(r),n=new Set(e.getSelectedNotes().map(r=>`${r.pitch}:${r.start}`));return this.notes.map(r=>{const a=`${r.pitch}:${r.start}`;return{note:r,state:{hovered:a===t,selected:n.has(a),highlighted:s(r)}}})}remove(e){const t=`${e.pitch}:${e.start}`;this.notes=this.notes.filter(s=>!(s.pitch===e.pitch&&s.start===e.start)),this.noteIndex.delete(t)}removeAll(e){const t=new Set(e.map(s=>`${s.pitch}:${s.start}`));this.notes=this.notes.filter(s=>!t.has(`${s.pitch}:${s.start}`));for(const s of t)this.noteIndex.delete(s)}rebuildIndex(){this.noteIndex.clear(),this.pitchIndex.clear();for(const e of this.notes){const t=`${e.pitch}:${e.start}`;this.noteIndex.set(t,e),this.pitchIndex.has(e.pitch)||this.pitchIndex.set(e.pitch,[]),this.pitchIndex.get(e.pitch).push(e)}for(const e of this.pitchIndex.values())e.sort((t,s)=>t.start-s.start)}findNoteAtMousePosition(e,t,s,n,r){const a=ut(e,t);T("Raw mouse pos (grid-relative)",a);const o=qt(),c=ht(a,s,n,o);if(!c){T("Snapped position is invalid",{mouse:a,snap:o});return}const d=te(c.y,n.layout.lowestMidi,n.layout.highestMidi),l=c.x;T("Snapped grid position",c),T("Computed pitch and beat",{pitch:d,beat:l});const u=r.findNoteUnderCursor(d,l);return T("Note under cursor (if any)",u),u}findAtPosition(e,t){return this.noteIndex.get(`${e}:${t}`)}findNoteUnderCursor(e,t){const s=this.pitchIndex.get(e);if(!s||s.length===0)return;let n=0,r=s.length-1,a=-1;for(;n<=r;){const o=Math.floor((n+r)/2);s[o].start<=t?(a=o,n=o+1):r=o-1}if(a!==-1)for(let o=a;o>=0;o--){const c=s[o];if(t>=c.start&&t<c.start+c.duration)return c;if(c.start+c.duration<t)break}}findNoteEdgeAtCursor(e,t,s=.25){const n=this.pitchIndex.get(e);if(!n||n.length===0)return;let r=0,a=n.length-1,o=-1;for(;r<=a;){const c=Math.floor((r+a)/2);n[c].start<=t?(o=c,r=c+1):a=c-1}if(o!==-1)for(let c=o;c>=0;c--){const d=n[c],l=d.start+d.duration*(1-s),u=d.start+d.duration;if(t>=l&&t<=u)return d;if(d.start+d.duration<t)break}}mergeSelections(e,t){const s=new Set,n=[];for(const r of[...e,...t]){const a=`${r.pitch}:${r.start}`;s.has(a)||(s.add(a),n.push(r))}return n}previewNote(e,t,s=100,n=!1){this.playNote(e,t,s,n)}}function $e(i,e,t,s,n,r=4){i.beginPath(),i.moveTo(e+r,t),i.lineTo(e+s-r,t),i.quadraticCurveTo(e+s,t,e+s,t+r),i.lineTo(e+s,t+n-r),i.quadraticCurveTo(e+s,t+n,e+s-r,t+n),i.lineTo(e+r,t+n),i.quadraticCurveTo(e,t+n,e,t+n-r),i.lineTo(e,t+r),i.quadraticCurveTo(e,t,e+r,t),i.closePath()}function Lo(i,e,t,s){const{layout:{baseCellWidth:n,verticalCellRatio:r,highestMidi:a,lowestMidi:o},behavior:{zoom:c}}=t,d=a-o+1,l=n*c,u=l/r,h=s.offsetWidth,f=s.offsetHeight,y=0,b=i/l-y,g=(i+h)/l+y,p=Math.floor(e/u),v=Math.min(d-1,Math.ceil((e+f)/u)+y),S=new Map;return _=>_.filter(({note:C})=>{if(C.start+C.duration<b||C.start>g)return!1;let w=S.get(C.pitch);if(w==null){const L=ki(C.pitch,o,a);if(L==null||L<0||L>=d)return!1;w=L,S.set(C.pitch,w)}return w>=p&&w<=v})}function ko(i){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;i=i.replace(e,(u,h,f,y)=>h+h+f+f+y+y);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(!t)return null;const s=parseInt(t[1],16)/255,n=parseInt(t[2],16)/255,r=parseInt(t[3],16)/255,a=Math.max(s,n,r),o=Math.min(s,n,r);let c=0,d=0,l=(a+o)/2;if(a!==o){const u=a-o;switch(d=l>.5?u/(2-a-o):u/(a+o),a){case s:c=(n-r)/u+(n<r?6:0);break;case n:c=(r-s)/u+2;break;case r:c=(s-n)/u+4;break}c*=60}return{h:Math.round(c),s:Math.round(d*100),l:Math.round(l*100)}}const Go=["#FF0000","#9400D3","#FFFF00","#FF69B4","#00FF00","#00FFFF","#0000FF","#8A2BE2","#FF8C00","#FFD700","#ADFF2F","#DC143C"];function Bo(i,e){const t=ko(i);if(!t)return"#999";const n=10+(e??100)/127*50;return`hsl(${t.h}, ${t.s}%, ${n}%)`}function bt(i){return(e,t)=>{const s=i(e,t);return Bo(s,e.velocity)}}function Eo(i){const e=X(i.pitch);if(e==null)return"#999";const t=e*3%360,s=100,n=60,a=.2+(i.velocity??100)/127*.8;return`hsla(${t}, ${s}%, ${n}%, ${a})`}const Ao={Scriabin:bt((i,{getPitchClass:e}={})=>{const t=e?e(i.pitch):0;return Go[t]||"#999"}),"Track Color":bt((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#999"),"Note Velocity":bt((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#ff0000"),"Octave Bands":Eo,"Pitch Class Contrast":bt((i,{getPitchClass:e}={})=>{const t=X(i.pitch);if(t==null)return"#999";const s=t%12;return["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"][s]||"#999"})};function To(i){return i<0&&(console.error(`Invalid trackId: ${i}. Using default color.`),i=0),Ke[i%Ke.length]}class Io{constructor(e,t,s,n,r){this.scroll=e,this.config=t,this.noteManager=s,this.interactionStore=n,this.sequencerId=r}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r},behavior:{zoom:a}}=this.config,{noteColorScheme:o}=W().theme,c=Ao[o]||(()=>"#999"),d={getPitchClass:Va,getTrackColor:()=>To(this.sequencerId)},l=t*a,u=l/s,h=this.scroll.getX(),f=this.scroll.getY(),y=e.canvas,b=this.noteManager.getTrackedNotes(this.interactionStore);e.save(),e.translate(n-h,r-f);const p=Lo(h,f,this.config,y)(b);for(const{note:v,state:S}of p){const C=ki(v.pitch,this.config.layout.lowestMidi,this.config.layout.highestMidi)*u,N=v.start*l,w=v.duration*l,L=u,G=c(v,d);e.fillStyle=G,$e(e,N,C,w,L,4),e.fill(),(S.selected||S.hovered||S.highlighted)&&(e.lineWidth=2,e.strokeStyle=S.selected?"#ffffff":S.hovered?"#ff9933":"#33ff99",$e(e,N,C,w,L,4),e.stroke())}e.restore()}}class Ro{constructor(e,t,s,n){this.scroll=e,this.config=t,this.store=s,this.getNoteDuration=n}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:c}}=this.config,d=t*c,l=d/s;e.save(),e.translate(n-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(100, 180, 255, 0.5)";const u=this.store.getPreviewNotes();if(u.length>0){const p=o-a+1;for(const v of u){const S=de(v.pitch);if(S===null)continue;const _=p-1-(S-a),C=v.start*d,N=_*l,w=v.duration*d;$e(e,C,N,w,l,3),e.fill()}e.restore();return}const h=this.store.getSnappedCursorGridPosition();if(!h){e.restore();return}const f=this.getNoteDuration(),y=h.x*d,b=h.y*l,g=d*f;$e(e,y,b,g,l,3),e.fill(),e.restore()}}let Ze=!1,Ei=[];const mi=new Set;function Yi(){return Ze=!Ze,mi.forEach(i=>i(Ze)),Ze}function Oo(i){return mi.add(i),i(Ze),()=>mi.delete(i)}function Fo(i){Ei=i}function rt(){return Ei}function Ai(){Ei=[]}class Po{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:c}}=this.config,d=t*c,l=d/s;e.save(),e.translate(n-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(255, 100, 180, 0.4)";const u=rt();if(u.length>0){const h=o-a+1;for(const f of u){const y=de(f.pitch);if(y===null)continue;const b=h-1-(y-a),g=f.start*d,p=b*l,v=f.duration*d;$e(e,g,p,v,l,3),e.fill()}e.restore();return}e.restore()}}class Do{constructor(e,t){this.scroll=e,this.config=t,this.animations=[]}playNote(e){const t=performance.now(),s=me();let n=e.duration*6e4/s;n=Math.max(100,Math.min(n,1600));const a=(X(e.pitch)||0)*5%360;this.animations.push({note:e,startTime:t,duration:n,hue:a})}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:c}}=this.config,d=this.scroll.getX(),l=this.scroll.getY(),u=t*c,h=u/s,f=performance.now();e.clearRect(0,0,e.canvas.width,e.canvas.height),this.animations=this.animations.filter(y=>{const b=(f-y.startTime)/y.duration;if(b>1)return!1;const{note:g,hue:p}=y,v=X(g.pitch);if(v==null||v<a||v>o)return!0;const S=o-v,_=g.start*u+n-d,C=S*h+r-l,N=g.duration*u,w=h-1,L=_+N/2,G=C+w/2,E=Math.sin(b*Math.PI),M=`hsla(${p}, 100%, 70%, ${.4*E})`;e.save(),e.globalAlpha=1,e.fillStyle=M,e.beginPath(),e.roundRect(_,C,N,w,4),e.fill();const x=2,B=50;for(let O=0;O<x;O++){const P=O*B,H=Math.max(0,Math.min(1,(f-y.startTime-P)/(y.duration-P))),ie=Math.sin(H*Math.PI),we=1+(.1+O*.1)*ie,$t=(1-H)*.3;e.globalAlpha=$t,e.strokeStyle=`hsl(${p}, 100%, 65%)`,e.lineWidth=1.5;const yt=N*we,Hi=w*we;e.beginPath(),e.roundRect(L-yt/2,G-Hi/2,yt,Hi,4),e.stroke()}return e.restore(),!0}),this.animations.length>0&&requestAnimationFrame(()=>this.draw(e))}}class Uo{constructor(e,t,s){this.scroll=e,this.config=t,this.ctx=s,this.isAnimating=!1,this.acceptanceAnimations=[],this.activeBarIndex=null,this.renderFrame=n=>{if(!this.isAnimating)return;this.draw(n);const r=this.acceptanceAnimations.length>0,a=rt().length>0,o=this.activeBarIndex!==null;r||a||o?requestAnimationFrame(this.renderFrame):this.isAnimating=!1}}start(){this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}stop(){this.isAnimating=!1}setActiveAutocompleteBar(e){this.activeBarIndex=e}invalidate(){this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}playNoteAcceptance(e){const t=performance.now();for(const s of e){const r=(X(s.pitch)||0)*5%360;this.acceptanceAnimations.push({note:s,startTime:t,duration:800,hue:r})}this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:c}}=this.config,d=this.scroll.getX(),l=this.scroll.getY(),u=t*c,h=u/s,f=this.ctx;f.clearRect(0,0,f.canvas.width,f.canvas.height);const y=o-a+1;if(this.activeBarIndex!==null){const p=.5+.5*Math.sin(e*.005),{layout:{baseCellWidth:v,verticalCellRatio:S,labelWidth:_,headerHeight:C,lowestMidi:N,highestMidi:w},behavior:{zoom:L}}=this.config,G=this.scroll.getX(),E=this.scroll.getY(),M=v*L,x=M/S,B=this.activeBarIndex*M*(Te()??4)+_-G,O=B+(Te()??4)*M,P=C-E,H=(w-N+1)*x;this.ctx.save(),this.ctx.globalAlpha=.2*p,this.ctx.fillStyle="rgba(180, 255, 255, 1)",this.ctx.fillRect(B,P,O-B,H),this.ctx.restore()}const b=rt();if(b.length>0){const p=.5+.5*Math.sin(e*.005);f.save(),f.translate(n-d,r-l);for(const v of b){const S=de(v.pitch);if(S===null)continue;const _=y-1-(S-a),C=v.start*u,N=_*h,w=v.duration*u;f.fillStyle=`rgba(255, 100, 180, ${.2*p})`,f.beginPath(),f.roundRect(C,N,w,h,3),f.fill(),f.lineWidth=1.5,f.strokeStyle=`rgba(255, 100, 180, ${.3*p})`,f.beginPath(),f.roundRect(C,N,w,h,3),f.stroke()}f.restore()}const g=performance.now();this.acceptanceAnimations=this.acceptanceAnimations.filter(p=>{const v=(g-p.startTime)/p.duration;if(v>1)return!1;const{note:S,hue:_}=p,C=de(S.pitch);if(C===null||C<a||C>o)return!0;const N=y-1-(C-a),w=S.start*u+n-d,L=N*h+r-l,G=S.duration*u,E=h-1,M=w+G/2,x=L+E/2,O=1+.5*Math.sin(v*Math.PI),P=(1-v)*.5;f.save(),f.globalAlpha=P,f.strokeStyle=`hsl(${_}, 100%, 65%)`,f.lineWidth=2.5;const H=G*O,ie=E*O;return f.beginPath(),f.roundRect(M-H/2,x-ie/2,H,ie,4),f.stroke(),f.restore(),!0})}}class qo{constructor(e,t){this.scroll=e,this.config=t,this.x=null}setPlayheadX(e){this.x=e}clear(){this.x=null}draw(e){if(this.x==null)return;const{layout:{verticalCellRatio:t,baseCellWidth:s,labelWidth:n,headerHeight:r,highestMidi:a,lowestMidi:o},behavior:{zoom:c}}=this.config,d=a-o+1,l=this.scroll.getX(),u=this.scroll.getY(),h=s*c/t,f=d*h+r,y=this.x;e.save(),e.translate(n-l,-u),e.lineWidth=2,e.strokeStyle="rgba(168, 85, 247, 1.0)",e.shadowColor="rgba(168, 85, 247, 0.5)",e.shadowBlur=6,e.beginPath(),e.moveTo(y,0),e.lineTo(y,f),e.stroke(),e.restore()}}class Re{constructor(e,t=!0){this.canvas=e,this.dpr=t&&window.devicePixelRatio||1;const s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.ctx=s}resize(){const e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,s=Math.floor(e*this.dpr),n=Math.floor(t*this.dpr);(this.canvas.width!==s||this.canvas.height!==n)&&(this.canvas.width=s,this.canvas.height=n,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr))}getContext(){return this.ctx}withContext(e){e(this.ctx)}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}destroy(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Zi{constructor(e,t,s,n,r){this.thumb=e,this.isHorizontal=t,this.scroll=s,this.interactionStore=n,this.requestRedraw=r,this.onMouseEnter=()=>this.interactionStore.setIsOnScrollbar(!0),this.onMouseLeave=()=>this.interactionStore.setIsOnScrollbar(!1),this.onThumbMouseDown=o=>this.handleMouseDown(o),this.onMouseMove=null,this.onMouseUp=null;const a=this.thumb.parentElement;if(!a)throw new Error("Scrollbar thumb must have a parent track element.");this.track=a,this.attachDragHandler()}attachDragHandler(){this.track.addEventListener("mouseenter",this.onMouseEnter),this.track.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mouseenter",this.onMouseEnter),this.thumb.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mousedown",this.onThumbMouseDown)}handleMouseDown(e){e.preventDefault(),this.interactionStore.setIsScrolling(!0),this.onMouseMove=t=>{const s=this.track.getBoundingClientRect(),n=this.isHorizontal?this.track.offsetWidth:this.track.offsetHeight,a=(this.isHorizontal?t.clientX:t.clientY)-(this.isHorizontal?s.left:s.top),o=this.isHorizontal?this.thumb.offsetWidth:this.thumb.offsetHeight,c=n-o,d=Math.max(0,Math.min(a-o/2,c)),l=c>0?d/c:0,u=this.isHorizontal?this.scroll.getMaxScrollX():this.scroll.getMaxScrollY(),h=l*u;this.isHorizontal?this.scroll.setScroll(h,this.scroll.getY()):this.scroll.setScroll(this.scroll.getX(),h),this.requestRedraw()},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.interactionStore.setIsScrolling(!1),this.onMouseMove=null,this.onMouseUp=null},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){this.track.removeEventListener("mouseenter",this.onMouseEnter),this.track.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mouseenter",this.onMouseEnter),this.thumb.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mousedown",this.onThumbMouseDown),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&document.removeEventListener("mouseup",this.onMouseUp),this.onMouseMove=null,this.onMouseUp=null}}let Qi=!1;function Ko(){if(Qi)return;const i=document.createElement("style");i.textContent=`
    .grid-scrollbars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .grid-scrollbar {
      position: absolute;
      background: #1f1f1f;
      pointer-events: all;
    }

    .grid-scrollbar-thumb {
      position: absolute;
      background: #888;
      border-radius: 6px;
      cursor: pointer;
    }

    .grid-scrollbar-corner {
      position: absolute;
      width: 12px;
      height: 12px;
      bottom: 0;
      right: 0;
      background: #1f1f1f;
      z-index: 2;
      pointer-events: none;
    }
  `,document.head.appendChild(i),Qi=!0}class $o{constructor(e,t,s,n,r){this.container=e,this.scroll=t,this.config=s,this.interactionStore=n,this.requestRedraw=r,this.trackThickness=16,Ko(),this.createDOM(),this.attachEvents(),this.config=this.config,this.interactionStore=n}createDOM(){const e=this.hScrollbar=document.createElement("div"),t=this.hThumb=document.createElement("div"),s=this.vScrollbar=document.createElement("div"),n=this.vThumb=document.createElement("div"),r=this.corner=document.createElement("div");e.className="grid-scrollbar",s.className="grid-scrollbar",t.className="grid-scrollbar-thumb",n.className="grid-scrollbar-thumb",r.className="grid-scrollbar-corner",e.style.position=s.style.position=r.style.position="absolute",e.style.zIndex=s.style.zIndex=r.style.zIndex="5",e.style.bottom="0",e.style.left="0",e.style.right=`${this.trackThickness}px`,e.style.height=`${this.trackThickness}px`,s.style.top="0",s.style.right="0",s.style.bottom=`${this.trackThickness}px`,s.style.width=`${this.trackThickness}px`,r.style.width=`${this.trackThickness}px`,r.style.height=`${this.trackThickness}px`,r.style.right="0",r.style.bottom="0",r.style.background="#333",r.style.position="absolute",t.style.zIndex=n.style.zIndex="6",t.style.position=n.style.position="absolute",t.style.background="#7e22ce",n.style.background="#7e22ce",t.style.borderRadius=n.style.borderRadius="8px",t.style.height="100%",n.style.width="100%",e.appendChild(t),s.appendChild(n),this.container.appendChild(e),this.container.appendChild(s),this.container.appendChild(r)}attachEvents(){this.hDragHandler=new Zi(this.hThumb,!0,this.scroll,this.interactionStore,this.requestRedraw),this.vDragHandler=new Zi(this.vThumb,!1,this.scroll,this.interactionStore,this.requestRedraw)}update(){const{width:e,height:t}=this.container.getBoundingClientRect(),s=this.scroll.getContentWidth(),n=this.scroll.getContentHeight(),r=this.scroll.getX(),a=this.scroll.getY(),o=this.scroll.getMaxScrollX(),c=this.scroll.getMaxScrollY(),d=e-this.trackThickness,l=this.config.layout.labelWidth,u=Math.max(40,(e-l)/s*d),h=r/o*(d-u);this.hThumb.style.width=`${u}px`,this.hThumb.style.left=`${Math.max(0,h)}px`;const f=t-this.trackThickness,y=this.config.layout.headerHeight,b=Math.max(40,(t-y)/n*f),g=a/c*(f-b);this.vThumb.style.height=`${b}px`,this.vThumb.style.top=`${Math.max(0,g)}px`}destroy(){this.hDragHandler.destroy(),this.vDragHandler.destroy(),this.hScrollbar.remove(),this.vScrollbar.remove(),this.corner.remove(),this.hScrollbar=null,this.vScrollbar=null,this.corner=null}}var k=(i=>(i[i.NoteTool=0]="NoteTool",i[i.Selecting=1]="Selecting",i[i.SelectedIdle=2]="SelectedIdle",i[i.Dragging=3]="Dragging",i[i.Pasting=4]="Pasting",i[i.Sizing=5]="Sizing",i))(k||{});function Ae(i,e,t,s,n){const r=ut(i,e),a=t.getSnapResolution(),o=t.isTripletMode();return ht(r,s,n,a,o)}function Ce(i,e,t,s){const{baseCellWidth:n}=s.layout,{zoom:r}=s.behavior,a=vr(i,e,t,s),o=n*r;return a.x/o}var q=(i=>(i.Default="default",i.Pointer="pointer",i.Crosshair="crosshair",i.Grabbing="grabbing",i.Grab="grab",i.ResizeHorizontal="ew-resize",i.ResizeVertical="ns-resize",i.Move="move",i.NotAllowed="not-allowed",i.Custom="url(cursor.png), auto",i))(q||{});function nt(i,e,t,s){return!i||i.x>=pe()?(e.setSnappedCursorGridPosition(null),e.setHoveredNoteKey(null),t.set(q.Default),s(),!0):!1}function Ho(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),Ne(e.sequencerId),t):i}function Ot(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}function Ft(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function zo(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),Ne(e.sequencerId),t}function ue(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function he(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}class Jo{constructor(e,t,s,n,r,a,o,c,d,l,u,h){this.canvas=e,this.noteManager=t,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(nt(t,this.store,this.cursorController,this.requestRedraw))return;const s=Ce(e,this.canvas,this.scroll,this.config);if(t){const n=te(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s),a=this.store.getHoveredNoteKey();if(r&&a===`${r.pitch}:${r.start}`){this.store.setSelectedNotes([r]),this.controller.transitionTo(k.Sizing);return}}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()){const l=this.store.getHoveredNoteKey();if(l&&n>=this.dragThreshold){const[u,h]=l.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}}if(n>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const r=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(!r||nt(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=te(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=Ce(e,this.canvas,this.scroll,this.config),c=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(c){const l=`${c.pitch}:${c.start}`;this.store.setHoveredNoteKey(l),this.store.setSnappedCursorGridPosition(null),d===c?this.cursorController.set(q.ResizeHorizontal):this.cursorController.set(q.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set(q.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0)return;if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}this.store.isDraggingToSelect()&&this.store.endSelectionDrag();const t=this.store.getHoveredNoteKey();if(t){if(performance.now()-this.store.getLastDeletionTime()<100)return;const[d,l]=t.split(":"),u=this.noteManager.findAtPosition(d,Number(l));if(u){this.noteManager.previewNote(u.pitch,.25),this.store.setSelectedNotes([u]),this.controller.transitionTo(k.SelectedIdle);return}}const s=this.store.getSnappedCursorGridPosition();if(!s)return;const{layout:n}=this.config,r=this.grid.getNoteDuration(),a=te(s.y,n.lowestMidi,n.highestMidi);if(!a||this.noteManager.findAtPosition(a,s.x))return;const c={start:s.x,duration:r,pitch:a,velocity:100};R(Ot(this.getSequencerId(),[c]),Ft(this.getSequencerId(),[c])),this.noteManager.previewNote(a,r),this.playNoteAnimation({start:s.x,duration:r,pitch:a,velocity:100})}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(R(ue(this.getSequencerId(),[a]),he(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting)}}onEnter(){T("DefaultNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}function es(i,e,t,s,n){const{layout:{baseCellWidth:r,verticalCellRatio:a,lowestMidi:o,highestMidi:c},behavior:{zoom:d}}=s,l=r*d,u=l/a,h=Math.min(e.startX,e.currentX+l/2),f=Math.max(e.startX,e.currentX+l/2),y=Math.min(e.startY,e.currentY),b=Math.max(e.startY,e.currentY),g=n.getSnapResolution(),p=Math.floor(h/l/g)*g,v=Math.floor(f/l/g)*g,S=Math.floor(y/u),_=Math.floor(b/u),C=Math.min(S,_),N=Math.max(S,_);return i.filter(w=>{const L=ki(w.pitch,o,c);if(L==null)return!1;const G=L>=C&&L<=N,E=w.start+w.duration,M=w.start>=p&&E<=v;return G&&M})}class jo{constructor(e,t,s,n,r,a,o,c){this.canvas=e,this.config=t,this.scroll=s,this.grid=n,this.store=r,this.controller=a,this.noteManager=o,this.requestRedraw=c}onEnter(){const e=Mo(this.controller.getLastMouseX(),this.controller.getLastMouseY(),this.canvas,this.scroll,this.config);this.store.setMarqueeBox({startX:e.x,startY:e.y,currentX:e.x,currentY:e.y})}onMouseMove(e){const t=this.store.getMarqueeBox();if(!t)return;const s=vr(e,this.canvas,this.scroll,this.config);t.currentX=s.x,t.currentY=s.y,this.store.setMarqueeBox({...t});const n=es(this.noteManager.getAll(),t,this.scroll,this.config,this.grid);this.store.setHighlightedNotes(n),this.requestRedraw()}onMouseUp(e){const t=this.store.getMarqueeBox();if(!t){this.controller.transitionTo(k.NoteTool);return}const s=es(this.noteManager.getAll(),t,this.scroll,this.config,this.grid),r=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(s.length>0){const a=this.store.getSelectedNotes(),o=r?this.noteManager.mergeSelections(a,s):s;this.store.setSelectedNotes(o),this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(k.SelectedIdle)}else this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(k.NoteTool)}onExit(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.requestRedraw()}}class Wo{constructor(e,t,s,n,r,a,o,c,d,l,u,h){this.canvas=e,this.config=t,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(!t)return;const s=Ce(e,this.canvas,this.scroll,this.config),n=te(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s);if(r){const a=`${r.pitch}:${r.start}`;new Set(this.store.getSelectedNotes().map(c=>`${c.pitch}:${c.start}`)).has(a)||this.store.setSelectedNotes([r]),this.controller.transitionTo(k.Sizing);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),g=parseFloat(b),p=this.noteManager.findAtPosition(y,g);if(!p)return;this.store.getSelectedNotes().some(_=>_.pitch===p.pitch&&_.start===p.start)||this.store.setSelectedNotes([p]),this.store.setDragAnchorNoteKey(`${p.pitch}:${p.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}if(!f&&n>=this.dragThreshold){!e.ctrlKey&&!e.metaKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const r=ut(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),c=ht(r,this.scroll,this.config,a,o);if(!c){this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default),this.requestRedraw();return}const d=Ce(e,this.canvas,this.scroll,this.config),l=te(c.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(l,d),h=this.noteManager.findNoteEdgeAtCursor(l,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(q.ResizeHorizontal):this.cursorController.set(q.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const s=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),r=n.some(c=>`${c.pitch}:${c.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const c=n.filter(d=>`${d.pitch}:${d.start}`!==s);this.store.setSelectedNotes(c)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(k.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(k.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),c=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&c?R(ue(this.getSequencerId(),o),he(this.getSequencerId(),o)):R(ue(this.getSequencerId(),[a]),he(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),R(ue(this.getSequencerId(),t),he(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting);return}if(e.key==="Delete"){if(!t.length)return;R(ue(this.getSequencerId(),t),he(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}}}function Xo({notes:i,anchorBeat:e,anchorMidi:t,targetBeat:s,targetMidi:n,lowestMidi:r,highestMidi:a}){const o=s-e,c=i.map(g=>g.start+o),d=i.map(g=>g.start+o+g.duration),l=Math.min(...c),u=Math.max(...d),h=Math.min(0,l),f=Math.max(0,u-pe()),y=o-h-f;if(!At()||st()){const g=n-t;return i.flatMap(p=>{const v=de(p.pitch);if(v==null)return[];let S=v+g;S<r&&(S=r),S>a&&(S=a);const _=qe(S);return _?[{pitch:_,start:p.start+y,duration:p.duration,velocity:p.velocity??100}]:[]})}else{const g=Tt(),p=[];for(let C=a;C>=r;C--)g.get(C)&&p.push(C);const v=p.indexOf(t),S=p.indexOf(n);if(v===-1||S===-1)return[];const _=S-v;return i.flatMap(C=>{const N=de(C.pitch);if(N==null)return[];const w=p.indexOf(N);if(w===-1)return[];const L=w+_;if(L<0||L>=p.length)return[];const G=p[L],E=qe(G);return E?[{pitch:E,start:C.start+y,duration:C.duration,velocity:C.velocity??100}]:[]})}}class Vo{constructor(e,t,s,n,r,a,o,c,d,l){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.grid=r,this.requestRedraw=a,this.getSequencerId=o,this.controller=c,this.cursorController=d,this.getClipboard=l}onMouseMove(e){const t=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(!t||nt(t,this.store,this.cursorController,this.requestRedraw))return;const s=this.getClipboard();if(!s.notes.length)return;const{lowestMidi:n,highestMidi:r}=this.config.layout,a=r-n+1,o=n+(a-1-t.y),c=t.x,d=Xo({notes:s.notes,anchorBeat:s.anchorBeat,anchorMidi:s.anchorMidi,targetBeat:c,targetMidi:o,lowestMidi:n,highestMidi:r});this.store.setPreviewNotes(d),this.cursorController.set(q.Pointer),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=this.store.getPreviewNotes();t.length&&(R(Ot(this.getSequencerId(),t),Ft(this.getSequencerId(),t)),this.store.clearPreviewNotes(),this.controller.transitionTo(k.NoteTool))}onMouseLeave(){this.store.clearPreviewNotes(),this.controller.transitionTo(k.NoteTool)}onExit(){this.store.clearPreviewNotes(),this.requestRedraw()}}function Yo({originalNotes:i,anchorNote:e,targetPitch:t,targetBeat:s,lowestMidi:n,highestMidi:r}){const a=de(t),o=de(e.pitch);if(a==null||o==null)return[];const c=s-e.start,d=i.map(p=>p.start+c),l=i.map(p=>p.start+c+p.duration),u=Math.min(...d),h=Math.max(...l),f=Math.min(0,u),y=Math.max(0,h-pe()),b=c-f-y;if(!At()||st()){const p=a-o;return i.flatMap(v=>{const S=de(v.pitch);if(S==null)return[];let _=S+p;_<n&&(_=n),_>r&&(_=r);const C=qe(_);return C?[{pitch:C,start:v.start+b,duration:v.duration,velocity:v.velocity??100}]:[]})}else{const p=Tt(),v=[];for(let N=r;N>=n;N--)p.get(N)&&v.push(N);const S=v.indexOf(o),_=v.indexOf(a);if(S===-1||_===-1)return[];const C=_-S;return i.flatMap(N=>{const w=de(N.pitch);if(w==null)return[];const L=v.indexOf(w);if(L===-1)return[];const G=L+C;if(G<0||G>=v.length)return[];const E=v[G],M=qe(E);return M?[{pitch:M,start:N.start+b,duration:N.duration,velocity:N.velocity??100}]:[]})}}function Zo(i,e){const t=structuredClone(i),s=t.sequencers.find(a=>a.id===e.sequencerId);if(!s)return i;const n=e.from,r=e.to;for(let a=0;a<n.length;a++){const o=n[a],c=r[a],d=s.notes.findIndex(l=>l.pitch===o.pitch&&l.start===o.start&&l.duration===o.duration);d!==-1&&(s.notes[d].pitch=c.pitch,s.notes[d].start=c.start)}return Ne(e.sequencerId),t}function Sr(i,e,t){return{type:"MOVE_NOTES",sequencerId:i,from:structuredClone(e),to:structuredClone(t)}}function Qo(i,e,t){return Sr(i,t,e)}class el{constructor(e,t,s,n,r,a,o,c,d,l){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=c,this.cursorController=d,this.getSequencerId=l,this.originalNotes=[],this.anchorNote=null,this.hasMoved=!1,this.lastPreviewedPitch=null}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(k.NoteTool);return}this.originalNotes=e.map(n=>({...n}));const t=this.store.getDragAnchorNoteKey(),s=t?e.find(n=>`${n.pitch}:${n.start}`===t):e[0];this.anchorNote=s??e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasMoved=!1,this.requestRedraw()}onMouseMove(e){const t=ut(e,this.canvas),s=this.grid.getSnapResolution(),n=this.grid.isTripletMode(),r=ht(t,this.scroll,this.config,s,n);if(!r||!this.anchorNote)return;const{layout:a}=this.config,o=te(r.y,a.lowestMidi,a.highestMidi);if(!o)return;const c=Yo({originalNotes:this.originalNotes,anchorNote:this.anchorNote,targetPitch:o,targetBeat:r.x,lowestMidi:a.lowestMidi,highestMidi:a.highestMidi});this.store.setPreviewNotes(c),this.hasMoved=!0,this.cursorController.set(q.Grabbing),o!==this.lastPreviewedPitch&&(this.noteManager.previewNote(o,.25),this.lastPreviewedPitch=o),this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote)return;const t=this.store.getPreviewNotes();if(this.hasMoved&&t.some((n,r)=>n.start!==this.originalNotes[r].start||n.pitch!==this.originalNotes[r].pitch))R(Sr(this.getSequencerId(),this.originalNotes,t),Qo(this.getSequencerId(),this.originalNotes,t));else for(const n of this.originalNotes)this.noteManager.add(n);this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.hasMoved=!1,this.controller.transitionTo(k.NoteTool)}onExit(){if(!this.hasMoved&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.store.setDragAnchorNoteKey(null),this.requestRedraw()}}function tl(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=e.resizes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start);a&&(a.duration=r.newDuration)}return Ne(e.sequencerId),t}function il(i,e){return{type:"RESIZE_NOTES",sequencerId:i,resizes:structuredClone(e)}}function sl(i,e){const t=e.map(s=>({pitch:s.pitch,start:s.start,newDuration:s.oldDuration}));return{type:"RESIZE_NOTES",sequencerId:i,resizes:t}}class rl{constructor(e,t,s,n,r,a,o,c,d,l){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=c,this.cursorController=d,this.getSequencerId=l,this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.hasResized=!1,this.hasMoved=!1,this.initialMouseX=0,this.accumulatedDelta=0}onEnter(){const e=this.store.getSelectedNotes();if(this.cursorController.set(q.ResizeHorizontal),!e.length){this.controller.transitionTo(k.NoteTool);return}this.originalNotes=e.map(s=>({...s}));const t=this.store.getHoveredNoteKey();this.anchorNote=t?e.find(s=>`${s.pitch}:${s.start}`===t)??null:e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasResized=!1,this.hasMoved=!1,this.accumulatedDelta=0,this.initialMouseX=this.controller.getLastMouseX(),this.requestRedraw()}onMouseMove(e){if(!this.anchorNote)return;const t=this.grid.getSnapResolution(),n=this.grid.isTripletMode()?t*(2/3):t,r=e.clientX-this.initialMouseX,o=this.config.layout.baseCellWidth*this.config.behavior.zoom*n,c=r/o,d=Math.round(c);if(d===this.accumulatedDelta)return;this.accumulatedDelta=d;const l=d*n,u=this.originalNotes.map(h=>{const f=Math.max(n,h.duration+l);return{...h,duration:f}});this.previewNotes=u,this.store.setPreviewNotes(u),this.hasResized=!0,this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote||!this.hasResized)return;const t=this.originalNotes,n=this.previewNotes.map((a,o)=>({pitch:a.pitch,start:a.start,newDuration:a.duration})),r=t.map((a,o)=>({pitch:a.pitch,start:a.start,oldDuration:a.duration}));R(il(this.getSequencerId(),n),sl(this.getSequencerId(),r)),this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.controller.transitionTo(k.NoteTool)}onExit(){if(!this.hasResized&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.cursorController.set(q.Default),this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.requestRedraw()}}class nl{constructor(e,t,s,n,r,a,o,c,d,l,u,h){this.canvas=e,this.noteManager=t,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(!this.store.isOnNonGridElement())if(e.button!==0)this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;else{const t=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(nt(t,this.store,this.cursorController,this.requestRedraw)||!t)return;const s=Ce(e,this.canvas,this.scroll,this.config),n=te(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!n)return;const r=this.noteManager.findNoteUnderCursor(n,s),a=this.noteManager.findNoteEdgeAtCursor(n,s);if(a&&r&&`${r.pitch}:${r.start}`==`${a.pitch}:${a.start}`){this.store.setSelectedNotes([a]),this.controller.transitionTo(k.Sizing);return}if(r){this.noteManager.previewNote(r.pitch,.25),this.store.setSelectedNotes([r]),this.store.suppressNextMouseUpEvent(),this.controller.transitionTo(k.SelectedIdle);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;const o=this.grid.getNoteDuration();if(this.noteManager.findAtPosition(n,t.x))return;const d={start:t.x,duration:o,pitch:n,velocity:100};R(Ot(this.getSequencerId(),[d]),Ft(this.getSequencerId(),[d])),this.noteManager.previewNote(n,o),this.playNoteAnimation(d)}}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(e.buttons===1&&this.store.isDraggingToSelect()){const l=this.store.getHoveredNoteKey();if(l&&n>=this.dragThreshold){const[u,h]=l.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(k.Sizing);return}}}if(e.buttons===2&&this.store.isDraggingToSelect()){const l=e.clientX-this.initialMouseX,u=e.clientY-this.initialMouseY;if(Math.sqrt(l*l+u*u)>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const r=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(!r||nt(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=te(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=Ce(e,this.canvas,this.scroll,this.config),c=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(c){const l=`${c.pitch}:${c.start}`;this.store.setHoveredNoteKey(l),this.store.setSnappedCursorGridPosition(null),d===c?this.cursorController.set(q.ResizeHorizontal):this.cursorController.set(q.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set(q.Default);this.requestRedraw()}onMouseUp(e){this.store.endSelectionDrag()}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(R(ue(this.getSequencerId(),[a]),he(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting)}}onEnter(){T("ExpressNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}class al{constructor(e,t,s,n,r,a,o,c,d,l,u,h){this.canvas=e,this.config=t,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){var e;if(window&&((e=window.event)==null?void 0:e.buttons)&1){this.store.beginSelectionDrag();const t=window.event;this.initialMouseX=t.clientX,this.initialMouseY=t.clientY}}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(this.store.isOnNonGridElement())return;const t=e.button===0,s=e.button===2,n=Ae(e,this.canvas,this.grid,this.scroll,this.config);if(!n){s&&this.beginSelectionDrag(e);return}const r=te(n.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!r){s&&this.beginSelectionDrag(e);return}const a=Ce(e,this.canvas,this.scroll,this.config),o=this.noteManager.findNoteUnderCursor(r,a);if(t){const c=this.noteManager.findNoteEdgeAtCursor(r,a);if(c){const d=`${c.pitch}:${c.start}`;new Set(this.store.getSelectedNotes().map(u=>`${u.pitch}:${u.start}`)).has(d)||this.store.setSelectedNotes([c]),this.controller.transitionTo(k.Sizing);return}o&&(this.beginSelectionDrag(e),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY)}if(s)if(o){const c=`${o.pitch}:${o.start}`;this.store.setHoveredNoteKey(c)}else this.store.setHoveredNoteKey(null),this.beginSelectionDrag(e)}beginSelectionDrag(e){this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()&&e.buttons&1){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),g=parseFloat(b),p=this.noteManager.findAtPosition(y,g);if(!p)return;this.store.getSelectedNotes().some(_=>_.pitch===p.pitch&&_.start===p.start)||this.store.setSelectedNotes([p]),this.store.setDragAnchorNoteKey(`${p.pitch}:${p.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}}else if(this.store.isDraggingToSelect()&&e.buttons&2&&!this.store.getHoveredNoteKey()&&n>=this.dragThreshold){!e.metaKey&&!e.shiftKey&&!e.ctrlKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}const r=ut(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),c=ht(r,this.scroll,this.config,a,o);if(!c){this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default),this.requestRedraw();return}const d=Ce(e,this.canvas,this.scroll,this.config),l=te(c.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(l,d),h=this.noteManager.findNoteEdgeAtCursor(l,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(q.ResizeHorizontal):this.cursorController.set(q.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(q.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement()||this.store.consumeSuppressMouseUpFlag())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const s=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),r=n.some(c=>`${c.pitch}:${c.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const c=n.filter(d=>`${d.pitch}:${d.start}`!==s);this.store.setSelectedNotes(c)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(k.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(k.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),c=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&c?R(ue(this.getSequencerId(),o),he(this.getSequencerId(),o)):R(ue(this.getSequencerId(),[a]),he(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),R(ue(this.getSequencerId(),t),he(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting);return}if(e.key==="Delete"){if(!t.length)return;R(ue(this.getSequencerId(),t),he(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}}}class ol{constructor(e){this.data=e,this.mode=k.NoteTool,this.activeHandler=null,this.lastMouseX=0,this.lastMouseY=0,this.transitionTo(k.NoteTool)}handleMouseDown(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseDown)==null||s.call(t,e)}handleMouseMove(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseMove)==null||s.call(t,e)}handleMouseUp(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseUp)==null||s.call(t,e)}handleContextMenu(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onContextMenu)==null||s.call(t,e)}handleMouseLeave(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onMouseLeave)==null||t.call(e)}handleMouseEnter(e){var t,s;(s=(t=this.activeHandler)==null?void 0:t.onMouseEnter)==null||s.call(t,e)}handleKeyDown(e){var t,s;(s=(t=this.activeHandler)==null?void 0:t.onKeyDown)==null||s.call(t,e)}transitionTo(e){var t,s,n,r;T(`Transitioning to mode: ${k[e]} from ${k[this.mode]}`),(s=(t=this.activeHandler)==null?void 0:t.onExit)==null||s.call(t),this.mode=e,this.activeHandler=this.createHandlerForMode(e),(r=(n=this.activeHandler)==null?void 0:n.onEnter)==null||r.call(n)}reset(){this.transitionTo(k.NoteTool)}createHandlerForMode(e){const t={transitionTo:s=>this.transitionTo(s),getLastMouseX:()=>this.lastMouseX,getLastMouseY:()=>this.lastMouseY};switch(e){case k.NoteTool:{const{global:{noteToolMode:s}}=W(),n=s==="express"?nl:Jo,r=[this.data.canvas,this.data.noteManager,this.data.scroll,this.data.config,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard,this.data.playNoteAnimation];return new n(...r)}case k.Selecting:return new jo(this.data.canvas,this.data.config,this.data.scroll,this.data.grid,this.data.store,t,this.data.noteManager,this.data.requestRedraw);case k.SelectedIdle:{const{global:{noteToolMode:s}}=W(),n=s==="express"?al:Wo,r=[this.data.canvas,this.data.config,this.data.scroll,this.data.noteManager,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.setClipboard,this.data.getClipboard];return new n(...r)}case k.Pasting:return new Vo(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard);case k.Dragging:return new el(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());case k.Sizing:return new rl(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());default:return{}}}destroy(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onExit)==null||t.call(e),this.activeHandler=null}}class ll{constructor(e){this.current=q.Default,this.canvas=e}set(e){this.current!==e&&(this.canvas.style.cursor=e,this.current=e)}reset(){this.set(q.Default)}}class cl{constructor(e,t){this.context=e,this.canvas=t,this.onMouseMove=s=>{this.context.handleMouseMove(s)},this.onMouseDown=s=>{this.context.handleMouseDown(s)},this.onMouseUp=s=>{this.context.handleMouseUp(s)},this.onMouseLeave=()=>{this.context.handleMouseLeave()},this.onMouseEnter=s=>{var n,r;(r=(n=this.context).handleMouseEnter)==null||r.call(n,s)},this.onContextMenu=s=>{this.context.handleContextMenu(s)},this.onKeyDown=s=>{this.context.handleKeyDown(s)},this.attachListeners(),this.canvas.style.pointerEvents="auto"}attachListeners(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("contextmenu",this.onContextMenu),window.addEventListener("keydown",this.onKeyDown)}destroy(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("keydown",this.onKeyDown)}}class dl{constructor(e,t,s){this.canvas=e,this.scroll=t,this.requestRedraw=s,this.SCROLL_SPEED_X=1,this.SCROLL_SPEED_Y=1,this.onWheel=n=>{n.preventDefault();const r=n.shiftKey||Math.abs(n.deltaX)>Math.abs(n.deltaY),a=n.deltaX||n.deltaY;if(r){const o=this.scroll.getX()+a*this.SCROLL_SPEED_X;this.scroll.setScroll(o,this.scroll.getY())}else{const o=this.scroll.getY()+n.deltaY*this.SCROLL_SPEED_Y;this.scroll.setScroll(this.scroll.getX(),o)}this.requestRedraw()},this.attachListeners()}attachListeners(){this.canvas.addEventListener("wheel",this.onWheel,{passive:!1})}destroy(){this.canvas.removeEventListener("wheel",this.onWheel)}}class ul{constructor(){this.snappedCursorGridPosition=null,this.previewNotes=[],this.hoveredNoteKey=null,this.marqueeBox=null,this.highlightedNoteKeys=new Set,this.suppressNextMouseUp=!1,this.selectedNotes=[],this.dragAnchorNoteKey=null,this.isOnScrollbar=!1,this.isScrolling=!1,this.isInitiatingSelectionDrag=!1,this.isDraggingNotes=!1,this.lastDeletionTime=0}setSnappedCursorGridPosition(e){this.snappedCursorGridPosition=e}getSnappedCursorGridPosition(){return this.snappedCursorGridPosition}setPreviewNotes(e){this.previewNotes=e}getPreviewNotes(){return this.previewNotes}clearPreviewNotes(){this.previewNotes=[]}setHoveredNoteKey(e){this.hoveredNoteKey=e}getHoveredNoteKey(){return this.hoveredNoteKey}setMarqueeBox(e){this.marqueeBox=e}getMarqueeBox(){return this.marqueeBox}hasMarquee(){return this.marqueeBox!==null}setHighlightedNotes(e){this.highlightedNoteKeys=new Set(e.map(t=>`${t.pitch}:${t.start}`))}clearHighlightedNotes(){this.highlightedNoteKeys.clear()}isNoteHighlighted(e){return this.highlightedNoteKeys.has(`${e.pitch}:${e.start}`)}suppressNextMouseUpEvent(){this.suppressNextMouseUp=!0}consumeSuppressMouseUpFlag(){const e=this.suppressNextMouseUp;return this.suppressNextMouseUp=!1,e}getSelectedNotes(){return this.selectedNotes}setSelectedNotes(e){this.selectedNotes=e}clearSelection(){this.selectedNotes=[]}hasSelection(){return this.selectedNotes.length>0}setDragAnchorNoteKey(e){this.dragAnchorNoteKey=e}getDragAnchorNoteKey(){return this.dragAnchorNoteKey}setIsOnScrollbar(e){this.isOnScrollbar=e}getIsOnScrollbar(){return this.isOnScrollbar}setIsScrolling(e){this.isScrolling=e}isOnNonGridElement(){return this.isOnScrollbar||this.isScrolling}beginSelectionDrag(){this.isInitiatingSelectionDrag=!0}endSelectionDrag(){this.isInitiatingSelectionDrag=!1}isDraggingToSelect(){return this.isInitiatingSelectionDrag}setIsDraggingNotes(e){this.isDraggingNotes=e}getIsDraggingNotes(){return this.isDraggingNotes}isActivelyDragging(){return this.isDraggingNotes||this.isInitiatingSelectionDrag}setLastDeletionTime(){this.lastDeletionTime=performance.now()}getLastDeletionTime(){return this.lastDeletionTime}}class hl{constructor(e){this.container=this.createContainer(),e.appendChild(this.container),this.gridCanvas=this.createCanvas("gridCanvas"),this.noteCanvas=this.createCanvas("noteCanvas"),this.animationCanvas=this.createCanvas("animationCanvas"),this.playheadCanvas=this.createCanvas("playheadCanvas"),this.aipreviewCanvas=this.createCanvas("aipreviewCanvas"),this.aiAnimationCanvas=this.createCanvas("aiAnimationCanvas"),this.container.appendChild(this.gridCanvas),this.container.appendChild(this.noteCanvas),this.container.appendChild(this.animationCanvas),this.container.appendChild(this.playheadCanvas),this.container.appendChild(this.aipreviewCanvas),this.container.appendChild(this.aiAnimationCanvas),this.gridCtx=this.getCtx(this.gridCanvas),this.noteCtx=this.getCtx(this.noteCanvas),this.animationCtx=this.getCtx(this.animationCanvas),this.playheadCtx=this.getCtx(this.playheadCanvas),this.aipreviewCtx=this.getCtx(this.aipreviewCanvas),this.aiAnimationCtx=this.getCtx(this.aiAnimationCanvas),this.injectContainerStyles(),this.injectCanvasStyles()}createContainer(){const e=document.createElement("div");return e.id="grid-container",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="#222",e.style.border="1px solid #333",e.style.overflow="hidden",e.style.boxShadow="0 0 20px rgba(0,0,0,0.4)",e.style.borderRadius="6px",e}createCanvas(e){const t=document.createElement("canvas");return t.id=e,t.style.display="block",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t}getCtx(e){const t=e.getContext("2d");if(!t)throw new Error(`2D context not available for canvas with id: ${e.id}`);return t}injectContainerStyles(){const e=document.createElement("style");e.textContent=`
        #grid-container canvas {
          z-index: 0;
        }
        #grid-container canvas#noteCanvas {
          z-index: 1;
        }
        #grid-container canvas#aipreviewCanvas {
          z-index: 2;
        }
        #grid-container canvas#aiAnimationCanvas {
          z-index: 3;
        }
        #grid-container canvas#animationCanvas {
          z-index: 4;
        }
        #grid-container canvas#playheadCanvas {
          z-index: 5;
        }
      `,document.head.appendChild(e)}injectCanvasStyles(){}}class fl{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,headerHeight:s,labelWidth:n},totalMeasures:r,beatsPerMeasure:a,behavior:{zoom:o}}=this.config,{gridColorScheme:c}=W().theme,d=Bi[c],l=t*o,u=this.scroll.getX(),h=e.canvas.offsetWidth;e.save(),e.translate(n-u,0);const f=e.createLinearGradient(0,0,0,s);f.addColorStop(0,d.labelWhite),f.addColorStop(1,d.labelBlack),e.fillStyle=f,e.fillRect(-n+u,0,h,s);for(let y=0;y<=r;y++){const g=y*a*l,p=y%4===0;e.strokeStyle=p?d.measureLine:d.beatLine,e.lineWidth=p?2:1,e.beginPath(),e.moveTo(g,0),e.lineTo(g,s),e.stroke(),e.textAlign="center",e.textBaseline="top",e.fillStyle=p?d.textWhite:d.textBlack,e.font=`${p?"bold":""} ${Math.floor(s*.5)}px 'Inter', sans-serif`;const v=g+a*l/2;e.fillText(`${y+1}`,v,4)}e.restore()}}class pl{constructor(e,t,s,n){this.scroll=e,this.config=t,this.getCustomLabels=s,this.getBlackKeyMap=n;const{lowestMidi:r,highestMidi:a}=t.layout;this.blackKeyMap=er(r,a)}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,headerHeight:n,labelWidth:r,highestMidi:a,lowestMidi:o},behavior:{zoom:c}}=this.config,{gridColorScheme:d}=W().theme,l=Bi[d],u=a-o+1,h=this.scroll.getY(),y=t*c/s,b=e.canvas.offsetHeight??u*y+n;e.save(),e.translate(0,-h);const g=e.createLinearGradient(0,0,0,b);g.addColorStop(0,l.labelWhite),g.addColorStop(1,l.labelBlack),e.fillStyle=g,e.fillRect(0,h,r,b),e.font=`${Math.floor(y*.6)}px 'Inter', sans-serif`,e.textAlign="right",e.textBaseline="middle",e.strokeStyle=l.gridLine,e.lineWidth=1,e.beginPath(),e.moveTo(r-.5,h),e.lineTo(r-.5,h+b),e.stroke();const p=this.getCustomLabels();for(let v=0;v<u;v++){const S=v*y+n,_=a-v,C=(p==null?void 0:p[_])??te(v,o,a),N=this.getBlackKeyMap().get(_)??!1;e.fillStyle=N?l.textBlack:l.textWhite,e.fillText(C,r-8,S+y/2)}e.restore()}}class ml{constructor(e,t,s){this.scroll=e,this.config=t,this.interactionStore=s}draw(e){const t=this.interactionStore.getMarqueeBox();if(!t)return;const{layout:{baseCellWidth:s,verticalCellRatio:n},behavior:{zoom:r}}=this.config,a=this.scroll.getX(),o=this.scroll.getY(),c=Math.min(t.startX,t.currentX),d=Math.min(t.startY,t.currentY),l=Math.abs(t.currentX-t.startX),u=Math.abs(t.currentY-t.startY);l<1||u<1||(e.save(),e.translate(this.config.layout.labelWidth-a,this.config.layout.headerHeight-o),e.strokeStyle="rgba(128, 90, 213, 1.0)",e.lineWidth=2,e.setLineDash([5,5]),$e(e,c,d,l,u,3),e.stroke(),e.restore())}}const ft={cellWidth:40,cellHeight:20,visibleNotes:36,noteRange:["C1","B9"],currentDuration:1,snapResolution:1,isTripletMode:!1,loopEnabled:!1,useEqualTemperament:!0};let Cr={notes:[],anchorBeat:0,anchorMidi:0};function yl(i){if(i.length===0)return;const e=i[0],t=e.start,s=j(e.pitch)??0;Cr={notes:i.map(n=>({pitch:n.pitch,start:n.start,duration:n.duration,velocity:n.velocity??100})),anchorBeat:t,anchorMidi:s}}function gl(){return Cr}class bl{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t)}off(e,t){var s;(s=this.listeners[e])==null||s.delete(t)}emit(e,t){var s;(s=this.listeners[e])==null||s.forEach(n=>n(t))}clear(e){var t;(t=this.listeners[e])==null||t.clear()}removeAllListeners(){var e;for(const t in this.listeners)(e=this.listeners[t])==null||e.clear()}}class _l{constructor(e,t={},s){this.sequencerConfig=ft,this.needsRedraw=!0,this.customLabels=null,this.blackKeyMap=new Map,this.isDestroyed=!1,this.onWindowResize=()=>this.resize(),this.config=vo(_o(),t),this.sequencerContext=s,this.recalculateLabelAndHeader(),this.gridManager=new hl(e);const{gridCanvas:n,noteCanvas:r,animationCanvas:a,playheadCanvas:o,aipreviewCanvas:c,aiAnimationCanvas:d}=this.gridManager;this.gridCanvasManager=new Re(n),this.noteCanvasManager=new Re(r),this.animationCanvasManager=new Re(a),this.playheadCanvasManager=new Re(o),this.aipreviewCanvasManager=new Re(c),this.aiAnimationCanvasManager=new Re(d);const l=this.gridManager.container;this.noteManager=new xo(this.config,this.sequencerContext.playNote),this.interactionStore=new ul,this.emitter=new bl,this.scroll=new wo(l,this.config),this.scrollbars=new $o(l,this.scroll,this.config,this.interactionStore,()=>this.requestRedraw()),this.wheelHandler=new dl(l,this.scroll,()=>this.requestRedraw()),this.cursorController=new ll(l);const u={canvas:r,noteManager:this.noteManager,scroll:this.scroll,config:this.config,store:this.interactionStore,grid:this,addNote:h=>this.noteManager.add(h),requestRedraw:()=>this.requestRedraw(),sequencerContext:s,cursorController:this.cursorController,setClipboard:yl,getClipboard:gl,playNoteAnimation:h=>this.playNoteAnimation(h)};this.interactionContext=new ol(u),this.inputTracker=new cl(this.interactionContext,l),this.gridRenderer=new So(this.scroll,this.config,this.interactionStore,()=>this.getBlackKeyMap(),()=>Tt()),this.noteRenderer=new Io(this.scroll,this.config,this.noteManager,this.interactionStore,this.sequencerContext.getId()),this.notePreviewRenderer=new Ro(this.scroll,this.config,this.interactionStore,()=>this.getNoteDuration()),this.animationRenderer=new Do(this.scroll,this.config),this.headerRenderer=new fl(this.scroll,this.config),this.labelRenderer=new pl(this.scroll,this.config,()=>this.customLabels,()=>this.getBlackKeyMap()),this.playheadRenderer=new qo(this.scroll,this.config),this.marqueeRenderer=new ml(this.scroll,this.config,this.interactionStore),this.aiAutocompletePreviewRenderer=new Po(this.scroll,this.config),this.aiAnimationRenderer=new Uo(this.scroll,this.config,this.aiAnimationCanvasManager.getContext()),this.initialZoom=this.zoom,this.customLabels=null,requestAnimationFrame(()=>this.resize()),this.playheadRenderer.setPlayheadX(0),this.attachListeners(),this.renderLoop()}attachListeners(){window.addEventListener("resize",this.onWindowResize)}detachListeners(){window.removeEventListener("resize",this.onWindowResize)}renderLoop(){this.isDestroyed||(this.needsRedraw&&(this.render(),this.needsRedraw=!1),requestAnimationFrame(()=>this.renderLoop()))}recalculateLabelAndHeader(){const{baseCellWidth:e,verticalCellRatio:t,labelWidthColumns:s,headerHeightRows:n}=this.config.layout,r=this.zoom,a=e*r,o=a/t;this.config.layout.labelWidth=s*a,this.config.layout.headerHeight=n*o}get zoom(){return this.config.behavior.zoom}set zoom(e){this.config.behavior.zoom=e}get notes(){const e=this.noteManager.getAll();return e||[]}render(){this.gridCanvasManager.clear(),this.noteCanvasManager.clear(),this.animationCanvasManager.clear(),this.playheadCanvasManager.clear(),this.aipreviewCanvasManager.clear();const e=this.gridCanvasManager.getContext(),t=this.noteCanvasManager.getContext(),s=this.animationCanvasManager.getContext(),n=this.playheadCanvasManager.getContext(),r=this.aipreviewCanvasManager.getContext();this.gridRenderer.draw(e),this.noteRenderer.draw(t),this.notePreviewRenderer.draw(t),this.animationRenderer.draw(s),this.labelRenderer.draw(e),this.headerRenderer.draw(e),this.playheadRenderer.draw(n),this.aiAutocompletePreviewRenderer.draw(r),this.interactionStore.hasMarquee()&&this.marqueeRenderer.draw(s),this.scrollbars.update()}requestRedraw(){this.needsRedraw=!0}resize(){this.gridCanvasManager.resize(),this.noteCanvasManager.resize(),this.animationCanvasManager.resize(),this.playheadCanvasManager.resize(),this.aipreviewCanvasManager.resize(),this.aiAnimationCanvasManager.resize(),this.scroll.recalculateBounds(),this.scrollbars.update(),this.requestRedraw()}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}setPlayheadPixelX(e){this.playheadRenderer.setPlayheadX(e),this.requestRedraw()}getPixelsPerBeat(){return this.config.layout.baseCellWidth*this.config.behavior.zoom}setNotes(e){this.noteManager.set(e),this.requestRedraw()}playNoteAnimation(e){this.animationRenderer.playNote(e)}invalidateAIAutocompleteRenderer(){this.aiAnimationRenderer.invalidate()}startAIAutocompleteAnimationLoop(){this.aiAnimationRenderer.start()}stopAIAutocompleteAnimationLoop(){this.aiAnimationRenderer.stop()}setActiveAutocompleteBar(e){this.aiAnimationRenderer.setActiveAutocompleteBar(e),requestAnimationFrame(this.aiAnimationRenderer.renderFrame)}playNoteAcceptanceAnimation(e){this.aiAnimationRenderer.playNoteAcceptance(e)}getTrackedNotes(){return this.noteManager.getTrackedNotes(this.interactionStore)}scrollTo(e,t){this.scroll.setScroll(e,t),this.scrollbars.update(),this.requestRedraw()}setZoom(e){this.zoom=e,this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.requestRedraw()}getZoom(){return this.zoom}resetZoom(){this.setZoom(this.initialZoom)}zoomIn(){this.setZoom(Math.min(this.config.behavior.maxZoom,this.zoom+.1))}zoomOut(){this.setZoom(Math.max(this.config.behavior.minZoom,this.zoom-.1))}setCustomLabels(e){this.customLabels=e,this.requestRedraw()}getMeasures(){return this.config.totalMeasures}setMeasures(e){this.config.totalMeasures=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getBeatsPerMeasure(){return this.config.beatsPerMeasure}setBeatsPerMeasure(e){this.config.beatsPerMeasure=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getTotalBeats(){return this.config.totalMeasures*this.config.beatsPerMeasure}setNoteRange(e,t){this.config.layout.lowestMidi=e,this.config.layout.highestMidi=t,this.blackKeyMap=er(e,t),this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.resize(),this.requestRedraw()}refreshNoteRange(){this.setNoteRange(this.config.layout.lowestMidi,this.config.layout.highestMidi)}getBlackKeyMap(){return this.blackKeyMap}isTripletMode(){return bi()}getNoteDuration(){return this.sequencerConfig.currentDuration}getSnapResolution(){return qt()}getInteractionStore(){return this.interactionStore}getNoteManager(){return this.noteManager}getInteractionContext(){return this.interactionContext}emit(e,t){this.emitter.emit(e,t)}destroy(){this.inputTracker.destroy(),this.wheelHandler.destroy(),this.scrollbars.destroy(),this.aiAnimationRenderer.stop(),this.gridManager.container.remove(),this.gridCanvasManager.destroy(),this.noteCanvasManager.destroy(),this.animationCanvasManager.destroy(),this.playheadCanvasManager.destroy(),this.aipreviewCanvasManager.destroy(),this.aiAnimationCanvasManager.destroy(),this.detachListeners(),this.emitter.removeAllListeners(),this.interactionContext.destroy(),this.isDestroyed=!0}}function vl(i,e,t){return new _l(i,e,t)}function Nr({instrument:i,midi:e,time:t,duration:s,velocity:n}){var a;const r=((a=i.__midiMap)==null?void 0:a.get(e))??e;if(!(i!=null&&i.start)){console.warn("[startInstrumentNote] Instrument missing start() method");return}try{i.start({note:r,time:t,duration:s,velocity:n})}catch(o){console.warn("[startInstrumentNote] Failed to start instrument note",{midi:e,resolved:r,err:o})}}function Ti(i,e){var t;(t=i==null?void 0:i.stop)==null||t.call(i);for(const s of e)clearTimeout(s);e.length=0}async function Sl(i,e,t,s,n,r,a,o=0){if(!n)return;if(i||await e(),Ti(i,r),!(i!=null&&i.start)){console.warn("[playback] Instrument does not support scheduled playback.");return}const d=60/me(),l=performance.now();t.sort((h,f)=>h.start-f.start);let u=0;for(;u<t.length&&t[u].start<o;)u++;for(;u<t.length;u++){const h=t[u],f=X(h.pitch);if(f==null)continue;const y=h.start-o,b=a+y*d,g=h.duration*d,p=h.velocity??100;if(Nr({instrument:i,midi:f,time:b,duration:g,velocity:p}),!s){const v=l+y*d*1e3,S=Math.max(0,v-performance.now()),_=setTimeout(()=>{n==null||n.playNoteAnimation(h)},S);r.push(_)}}}function Cl(i,e,t,s,n,r){if(!s||n)return;const o=60/me();performance.now();const l=(Z().currentTime-e)/o,u=t+l;for(const h of i){if(h.start<u)continue;const y=(h.start-u)*o*1e3;if(y>=0){const b=setTimeout(()=>{s==null||s.playNoteAnimation(h)},y);r.push(b)}}}async function Nl(i,e,t,s,n,r,a,o,c,d=0){if(!s||(Ti(i,o),i||await e(),r||!a||!(i!=null&&i.start)))return;const u=60/me(),h=performance.now(),f=Z().currentTime,y=t.filter(b=>b.start>=d);for(const b of y){const g=X(b.pitch);if(g==null)continue;const p=b.start-d,v=c+p*u;if(v<=f+.01)continue;const S=b.duration*u,_=b.velocity??100;if(Nr({instrument:i,midi:g,time:v,duration:S,velocity:_}),!n){const C=h+p*u*1e3,N=Math.max(0,C-performance.now()),w=setTimeout(()=>{s==null||s.playNoteAnimation(b)},N);o.push(w)}}}class wr{constructor(e,t,s=Z(),n=De(),r="sf2/fluidr3-gm/acoustic_grand_piano",a=!1,o=0){if(this.colorIndex=0,this.id=0,this.mute=!1,this.solo=!1,this.collapsed=!1,this.miniContour=null,this.body=null,this.collapseIcon=null,this._scheduledAnimations=[],this._volume=100/127,this._pan=0,this._instrument=null,this.id=o,this.container=e,this.config={...t},this.context=s,this.destination=n,this.instrumentName=r,this.squelchLoadingScreen=a,this.container){const c=this.container.querySelector(".sequencer-body");this.matrix=vl(c,{},{playNote:this.playNote.bind(this),getId:()=>this.id}),this.matrix.refreshNoteRange()}}async initInstrument(){try{this._instrument=await br(this.instrumentName,this.context,this.destination,this._volume,this._pan,!1,!1),this.updateToDrumNoteRange()}catch(e){console.warn(`[SEQ:${this.id}] Failed to load instrument '${this.instrumentName}':`,e)}}setInstrument(e){this.instrumentName=e,this.updateTrackLabel(),this.initInstrument()}updateTrackLabel(){var t;const e=(t=this.container)==null?void 0:t.querySelector(".track-name");e&&(e.textContent=`${this.id+1}: ${this.instrumentName}`)}get notes(){var e;return((e=this.matrix)==null?void 0:e.notes)??[]}get volume(){return this._volume}set volume(e){var t;this._volume=Math.max(0,Math.min(1,e)),(t=this._instrument)!=null&&t.setVolume&&this._instrument.setVolume(this._volume)}get pan(){return this._pan}set pan(e){var t;this._pan=Math.max(-1,Math.min(1,e)),(t=this._instrument)!=null&&t.setPan&&this._instrument.setPan(this._pan)}get shouldPlay(){return zc()?this.solo:!this.mute}get scheduledAnimations(){return this._scheduledAnimations}set scheduledAnimations(e){this._scheduledAnimations=e}toggleMute(){const e=J.getInstance();this.mute=!this.mute,this.mute&&(this.solo=!1),this.stopScheduledNotes(),Vi(this),e.isActive()&&_s()}toggleSolo(){const e=J.getInstance();this.solo=!this.solo,this.solo&&(this.mute=!1),Vi(this),e.isActive()&&_s()}setCollapsed(e){this.collapsed=e}resetInteractionMode(){var e;(e=this.matrix)==null||e.getInteractionContext().reset()}async preparePlayback(e,t=0){var s;await Sl(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.collapsed,this.matrix??null,this._scheduledAnimations,e,t)}stopScheduledNotes(){Ti(this._instrument,this._scheduledAnimations)}resumeAnimationsFromCurrentTime(e,t){var s;Cl(((s=this.matrix)==null?void 0:s.notes)??[],e,t,this.matrix??null,this.collapsed,this._scheduledAnimations)}async reschedulePlayback(e,t=0){var s;await Nl(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.matrix??null,this.collapsed,this.mute,this.shouldPlay,this._scheduledAnimations,e,t)}async exportToOffline(e,t){var n;const s=t??((n=this.matrix)==null?void 0:n.notes);!s||s.length===0||await ho(this.instrumentName,this.context,this.destination,s,this._volume,this._pan,e)}playNote(e,t,s=100,n=!1){return Oa(this.instrumentName,e,t,s,n,null,Ie(),this.destination,this.volume,this.pan)}updateTotalMeasures(){this.matrix&&this.matrix.setMeasures(qi())}updateBeatsPerMeasure(){this.matrix&&this.matrix.setBeatsPerMeasure(Te())}redraw(){var e;(e=this.matrix)==null||e.requestRedraw()}getState(){return this.matrix?{notes:[...this.matrix.notes],config:{...this.config},instrument:this.instrumentName}:{notes:[],config:this.config,instrument:this.instrumentName}}setState({notes:e,config:t,instrument:s,volume:n,pan:r,collapsed:a}){this.matrix&&(this.matrix.setNotes(e),Object.assign(this.config,t),typeof n=="number"&&(this.volume=n),typeof r=="number"&&(this.pan=r),xt(this,a),s&&(this.instrumentName=s),this.redraw())}updateNotesFromTrackMap(e){this.matrix&&this.matrix.notes.splice(0,this.matrix.notes.length,...e.n.map(([t,s,n,r=100])=>({pitch:t,start:s,duration:n,velocity:r})))}updateNoteRange(e){pi({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var t;return((t=this.matrix)==null?void 0:t.notes)??[]}},e)}updateToDrumNoteRange(){fo({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var e;return((e=this.matrix)==null?void 0:e.notes)??[]}})}destroy(){var e,t;this.stopScheduledNotes(),(e=this.matrix)==null||e.destroy(),(t=this.container)==null||t.remove(),$c(this.id),J.getInstance().removeSequencer(this),this._instrument=null,this.matrix=void 0,this.container=null,this.refreshPanUI=void 0,this.refreshVolumeUI=void 0}}function wl(i,e){const t=structuredClone(i);t.sequencers=t.sequencers.filter(n=>n.id!==e.id);const s=_r(e.id);return s?s.destroy():console.warn(`DELETE_SEQUENCER: No controller found for id ${e.id}`),Ne(null),t}function Mr(i,e,t=[],s,n,r){return{type:"DELETE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:s,pan:n,collapsed:r}}function xr(i,e,t=[],s,n,r){return{type:"CREATE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:s,pan:n,collapsed:r}}function Ml(i,e,t){const s={id:t,...ft},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",r=new wr(i,s,Z(),De(),n,!0,t);r.id=t,r.colorIndex=t,r.mute=!1,r.solo=!1,r.volume=100/127,e.notes&&r.matrix&&r.matrix.setNotes(e.notes),e&&r.setState({notes:e.notes,config:{},instrument:e.instrument,volume:e.volume,pan:e.pan,collapsed:e.collapsed});const a=i.querySelector("canvas.mini-contour");return r.miniContour=a,It(a,r.notes,r.config,r.colorIndex),r.updateTrackLabel(),r.initInstrument(),Kc(r.id,r),J.getInstance().addSequencer(r),{seq:r}}function xl(){var i,e;for(const t of z().slice())R(Mr(t.id,t.instrumentName,((i=t.matrix)==null?void 0:i.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed),xr(t.id,t.instrumentName,((e=t.matrix)==null?void 0:e.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed));Hc(),po(),J.getInstance().clearSequencers()}function I(i,e){return m("img",{src:oe(`static/svg/${i}.svg`),class:"w-6 h-6",alt:e})}function Ll(){const i=U(),e=m("div",{class:`sequencer-header flex justify-between items-center ${i.textColor}`}),t=m("canvas",{class:"mini-contour w-full h-10 mb-2 bg-gray-800 rounded hidden"}),s=m("div",{class:`sequencer-body flex pt-2 h-[720px] border-t ${i.borderColor}`}),n=m("div",{class:"grip-handle group flex justify-center items-center h-6 cursor-grab hover:bg-gray-800 rounded"},I("icon-grip","Drag Track"));return{element:m("div",{class:`sequencer flex flex-col space-y-2 p-4 rounded ${i.surfaceBackground}`},e,t,s,n),topBarContainer:e,miniContourCanvas:t,matrixContainer:s,gripHandleContainer:n}}function kl(){const i=U(),e=m("div",{class:"sequencer-left-group-wrapper flex items-center gap-2"}),t=m("div",{class:"sequencer-volume-wrapper"}),s=m("div",{class:"sequencer-pan-wrapper"}),n=m("div",{class:"sequencer-zoom-wrapper flex items-center gap-2"}),r=m("div",{class:"sequencer-right-controls-wrapper flex items-center gap-2"}),a=m("div",{class:"sequencer-right-group-container flex items-center gap-3"},t,s,n,r);return{element:m("div",{class:`sequencer-header flex justify-between items-center w-full px-2 ${i.textColor}`},e,a),leftGroup:e,volumeWrapper:t,panWrapper:s,zoomWrapper:n,rightControlsWrapper:r}}function Gl(){const i=U(),e=m("button",{class:["instrument-select-btn","side-button-primary","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonPrimaryColor,i.buttonPrimaryColorHover,i.textColor].join(" "),title:"Change Instrument"},I("icon-list-instrument","Change Instrument")),t=m("button",{draggable:"true",class:["copy-midi-btn","side-button-secondary","cursor-grab select-none","px-2 py-1 rounded w-8 flex items-center justify-center","transition-transform transition-opacity duration-150","hover:scale-105 hover:brightness-110 active:cursor-grabbing",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Export MIDI Track (Drag to Desktop)"},I("icon-copy","Export MIDI")),s=m("span",{class:`track-name font-semibold ${i.textColor}`},"Track");return{instrumentButton:e,copyMidiButton:t,label:s}}function Bl(){const i=U(),e=m("div",{class:`volume-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.volumeGradientFrom} ${i.volumeGradientTo}`,style:"width: 60%;"}),t=m("div",{class:`volume-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 78.74%;"}),s=m("div",{class:["volume-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.volumeThumbColor].join(" "),style:"left: calc(60% - 5px);"});return{element:m("div",{class:`volume-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,s),fill:e,snapMarker:t,thumb:s}}function El(){const i=U(),e=m("div",{class:`pan-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.panGradientFrom} ${i.panGradientTo}`,style:"width: 50%;"}),t=m("div",{class:`pan-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 50%;"}),s=m("div",{class:["pan-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.panThumbColor].join(" "),style:"left: calc(50% - 5px);"});return{element:m("div",{class:`pan-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,s),fill:e,snapMarker:t,thumb:s}}function Al(){const i=U(),e=m("button",{class:["zoom-in-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom In"},I("icon-zoom-in","Zoom In")),t=m("button",{class:["zoom-out-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom Out"},I("icon-zoom-out","Zoom Out")),s=m("button",{class:["zoom-reset-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Reset Zoom"},I("icon-reset","Reset Zoom")),n=m("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`}),r=m("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`});return{element:m("div",{class:"flex items-center gap-2"},n,e,t,s,r),leadingDivider:n,zoomInBtn:e,zoomOutBtn:t,zoomResetBtn:s,trailingDivider:r}}function Tl(){const i=U(),e=["side-button-secondary cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor],t=m("button",{class:[...e,"mute-btn"].join(" "),title:"Mute Track"},I("icon-volume-mute","Mute Track")),s=m("button",{class:[...e,"solo-btn"].join(" "),title:"Solo Track"},I("icon-headphones","Solo Track")),n=m("button",{class:[...e,"collapse-btn"].join(" "),title:"Expand/Collapse Track"},I("icon-caret-down","Expand/Collapse")),r=m("button",{class:[...e,"delete-btn hover:bg-red-600"].join(" "),title:"Delete Track"},I("icon-close-circle","Delete Track"));return{element:m("div",{class:"flex items-center gap-2"},t,s,n,r),muteBtn:t,soloBtn:s,collapseBtn:n,deleteBtn:r}}function Il(i,e,t){let s=!1,n=0,r=0;const a=150,o=1e3,c=u=>{s=!0,n=u.clientY,r=e.offsetHeight,i.classList.replace("cursor-grab","cursor-grabbing"),document.body.style.userSelect="none"},d=u=>{if(!s)return;const h=u.clientY-n;let f=r+h;f=Math.max(a,Math.min(o,f)),e.style.height=`${f}px`,t.resize()},l=()=>{s&&(s=!1,i.classList.replace("cursor-grabbing","cursor-grab"),document.body.style.userSelect="")};return i.addEventListener("mousedown",c),window.addEventListener("mousemove",d),window.addEventListener("mouseup",l),{detach:()=>{i.removeEventListener("mousedown",c),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",l)},refreshUI:()=>{}}}const Rl={sm:"text-base",md:"text-lg",lg:"text-xl",xl:"text-2xl"};function ve(i){const e=U();if(typeof i=="string")return m("h2",{class:["text-lg font-semibold mb-4",e.textColor].join(" "),textContent:i});const{text:t,size:s="md",additionalClasses:n=""}=i;return m("h2",{class:[Rl[s],"font-semibold mb-4",e.textColor,n].join(" "),textContent:t})}function Ol(){const i=ve({text:"Delete Track",size:"lg",additionalClasses:"text-center mb-4"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"Are you sure you want to delete this track?"}),t=K({id:"delete-confirm",text:"Delete",kind:"tertiary",additionalClasses:"flex-1 py-2"}),s=K({id:"delete-cancel",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2"}),n=m("div",{class:"flex gap-3 w-full"},t,s);return ae("delete-confirm-modal",[i,e,n],{sizePreset:"sm"})}function Fl(i,e,t){const s=i.querySelector("#delete-confirm"),n=i.querySelector("#delete-cancel"),r=()=>{e(),i.classList.add("hidden")},a=()=>{t(),i.classList.add("hidden")};return s==null||s.addEventListener("click",r),n==null||n.addEventListener("click",a),{detach:()=>{s==null||s.removeEventListener("click",r),n==null||n.removeEventListener("click",a)},refreshUI:()=>{}}}class Pl{constructor(){this.detachFn=null,this.modal=Ol(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const s=Fl(this.modal,e,t);this.detachFn=s.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Ee(i){const{id:e,label:t,stateA:s,stateB:n,tooltipTrigger:r,inline:a}=i,o=U(),c=s?m("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:s}):null,d=m("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:n}),l=m("input",{id:e,type:"checkbox",class:"sr-only peer"}),u=m("div",{class:["w-11 h-6 rounded-full peer relative",o.toggleTrackBase,o.toggleTrackChecked,'after:content-[""] after:absolute after:top-[2px] after:left-[2px]',"after:bg-white after:border after:rounded-full","after:h-5 after:w-5 after:transition-all",o.toggleKnobBase,o.toggleKnobChecked,"peer-checked:after:translate-x-full"].join(" ")}),h=()=>{const g=l.checked;c&&(c.style.opacity=g?"0.5":"1"),d.style.opacity=g?"1":"0.5"};l.addEventListener("change",h);const f=[];c&&f.push(c),f.push(m("label",{class:"relative inline-flex items-center cursor-pointer"},l,u)),f.push(d),r&&f.push(r);const y=m("div",{class:"flex items-center gap-3"},...f),b=a?y:m("div",{class:"mb-6"},t?m("label",{class:`block text-sm font-medium mb-2 ${o.textColor}`,textContent:t}):null,y);return requestAnimationFrame(h),{element:b,input:l,setChecked:g=>{l.checked=g,h()},getChecked:()=>l.checked,update:h}}function ee(i,e){const t=U();if(typeof i=="string")return m("label",{class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},i,e??null);const{text:s,for:n,trailingElement:r}=i;return m("label",{...n?{htmlFor:n}:{},class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},s,r??null)}function Dl(){const i=U(),e=ve({text:"Select Instrument",size:"xl",additionalClasses:"text-center mb-6 z-10"}),t=(h,f)=>{const y=m("select",{id:h,class:["w-full bg-gray-700 border border-gray-600 rounded px-3 py-2","focus:outline-none focus:border-purple-500 cursor-pointer",i.textColor].join(" ")});return m("div",{class:"mb-4 z-10 w-full"},ee({text:f,for:h}),y)},s=t("instrument-engine-select","Engine"),n=t("instrument-library-select","Instrument Library"),r=t("instrument-select","Instrument"),a=Ee({id:"instrument-loop-toggle",label:"Loop instrument sound",stateB:"On"}),o=K({id:"instrument-select-confirm",text:"Select",kind:"primary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),c=K({id:"instrument-cancel-btn",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),d=m("div",{class:"flex gap-3 z-10 w-full"},o,c),l=[e,s,n,r,a.element,d];return ae("instrument-select-modal",l,{sizePreset:"md"})}function Ul(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s&&e.instrument&&(s.instrument=e.instrument),t}function ql(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}function Kl(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}async function $l(i,e){if(e!=null){const t=mt(e);t?(R(ql(t.id,i),Kl(t.id,t.instrumentName)),t.setInstrument(i)):console.warn(`Failed to find sequencer with ID ${e}`)}else try{await Li(i),Ea(i),window.dispatchEvent(new CustomEvent("global-instrument-selected",{detail:{fullName:i}}))}catch(t){console.error("Failed to load global instrument:",i,t)}}function Hl(){return Object.keys(ct)}async function zl(i=gr){const e=Gi[i];if(!e)throw new Error(`Engine "${i}" not available`);return await e.getAvailableLibraries()}async function Jl(i,e=gr){const t=Gi[e];if(!t)throw new Error(`Engine "${e}" not available`);return await t.getAvailableInstruments(i)}function jl(i,e){const t=i.querySelector("#instrument-engine-select"),s=i.querySelector("#instrument-library-select"),n=i.querySelector("#instrument-select"),r=i.querySelector("#instrument-loop-toggle"),a=i.querySelector("#instrument-select-confirm"),o=i.querySelector("#instrument-cancel-btn"),{currentInstrument:c}=e;let d=null,l=null,u=null;if(c){const S=c.split("/");d=S[0]||null,l=S[1]||null,u=S[2]||null}const h=()=>{const S=Hl();t&&(t.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,t.appendChild(C)}),d&&S.includes(d)&&(t.value=d))},f=async()=>{if(!t)return;const S=await zl(t.value);s&&(s.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,s.appendChild(C)}),l&&S.includes(l)?s.value=l:S.length>0&&(s.value=S[0]))},y=async()=>{if(!t||!s)return;const S=await Jl(s.value,t.value);n&&(n.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,n.appendChild(C)}),u&&S.includes(u)&&(n.value=u))},b=async()=>{await f(),await y()},g=()=>{y()},p=async()=>{if(!t||!s||!n||!r)return;const S=`${t.value}/${s.value}/${n.value}`;await $l(S,e.sequencerId),e.hide()},v=()=>{e.hide()};return(async()=>(h(),await f(),await y()))(),t==null||t.addEventListener("change",b),s==null||s.addEventListener("change",g),a==null||a.addEventListener("click",p),o==null||o.addEventListener("click",v),{detach:()=>{t==null||t.removeEventListener("change",b),s==null||s.removeEventListener("change",g),a==null||a.removeEventListener("click",p),o==null||o.removeEventListener("click",v)},refreshUI:async()=>{h(),await f(),await y()}}}class Wl{constructor(){this.detachFn=null,this.modal=Dl(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const s=jl(this.modal,{sequencerId:e,currentInstrument:t,hide:()=>this.hide()});this.detachFn=s.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class Xl{constructor(){this.initialize()}initialize(){this.deleteConfirmModal=new Pl,this.instrumentSelectModal=new Wl}showInstrumentSelectModal(e,t){this.instrumentSelectModal.show(e,t)}showDeleteConfirmModal(e,t){this.deleteConfirmModal.show(e,t)}destroy(){var e,t;(e=this.deleteConfirmModal)==null||e.destroy(),(t=this.instrumentSelectModal)==null||t.destroy()}reload(){this.destroy(),this.initialize()}}let Qt=null;function Pt(){return Qt||(Qt=new Xl),Qt}function Vl(i,e){const t=()=>{Pt().showInstrumentSelectModal(e.id,e.instrumentName)};return i.addEventListener("click",t),{detach:()=>{i.removeEventListener("click",t)},refreshUI:()=>{}}}function Yl(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var n=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return i[s]}})}),t}var Me={},_t={},ei,ts;function Zl(){if(ts)return ei;ts=1;function i(n){var r=new s(n),a=r.readChunk();if(a.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var o=e(a.data),c=[],d=0;!r.eof()&&d<o.numTracks;d++){var l=r.readChunk();if(l.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var u=t(l.data);c.push(u)}return{header:o,tracks:c}}function e(n){var r=new s(n),a=r.readUInt16(),o=r.readUInt16(),c={format:a,numTracks:o},d=r.readUInt16();return d&32768?(c.framesPerSecond=256-(d>>8),c.ticksPerFrame=d&255):c.ticksPerBeat=d,c}function t(n){for(var r=new s(n),a=[];!r.eof();){var o=d();a.push(o)}return a;var c;function d(){var l={};l.deltaTime=r.readVarInt();var u=r.readUInt8();if((u&240)===240)if(u===255){l.meta=!0;var h=r.readUInt8(),f=r.readVarInt();switch(h){case 0:if(l.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return l.number=r.readUInt16(),l;case 1:return l.type="text",l.text=r.readString(f),l;case 2:return l.type="copyrightNotice",l.text=r.readString(f),l;case 3:return l.type="trackName",l.text=r.readString(f),l;case 4:return l.type="instrumentName",l.text=r.readString(f),l;case 5:return l.type="lyrics",l.text=r.readString(f),l;case 6:return l.type="marker",l.text=r.readString(f),l;case 7:return l.type="cuePoint",l.text=r.readString(f),l;case 32:if(l.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return l.channel=r.readUInt8(),l;case 33:if(l.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return l.port=r.readUInt8(),l;case 47:if(l.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return l;case 81:if(l.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return l.microsecondsPerBeat=r.readUInt24(),l;case 84:if(l.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var y=r.readUInt8(),b={0:24,32:25,64:29,96:30};return l.frameRate=b[y&96],l.hour=y&31,l.min=r.readUInt8(),l.sec=r.readUInt8(),l.frame=r.readUInt8(),l.subFrame=r.readUInt8(),l;case 88:if(l.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return l.numerator=r.readUInt8(),l.denominator=1<<r.readUInt8(),f===4?(l.metronome=r.readUInt8(),l.thirtyseconds=r.readUInt8()):(l.metronome=36,l.thirtyseconds=8),l;case 89:if(l.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return l.key=r.readInt8(),l.scale=r.readUInt8(),l;case 127:return l.type="sequencerSpecific",l.data=r.readBytes(f),l;default:return l.type="unknownMeta",l.data=r.readBytes(f),l.metatypeByte=h,l}}else if(u==240){l.type="sysEx";var f=r.readVarInt();return l.data=r.readBytes(f),l}else if(u==247){l.type="endSysEx";var f=r.readVarInt();return l.data=r.readBytes(f),l}else throw"Unrecognised MIDI event type byte: "+u;else{var g;if((u&128)===0){if(c===null)throw"Running status byte encountered before status byte";g=u,u=c,l.running=!0}else g=r.readUInt8(),c=u;var p=u>>4;switch(l.channel=u&15,p){case 8:return l.type="noteOff",l.noteNumber=g,l.velocity=r.readUInt8(),l;case 9:var v=r.readUInt8();return l.type=v===0?"noteOff":"noteOn",l.noteNumber=g,l.velocity=v,v===0&&(l.byte9=!0),l;case 10:return l.type="noteAftertouch",l.noteNumber=g,l.amount=r.readUInt8(),l;case 11:return l.type="controller",l.controllerType=g,l.value=r.readUInt8(),l;case 12:return l.type="programChange",l.programNumber=g,l;case 13:return l.type="channelAftertouch",l.amount=g,l;case 14:return l.type="pitchBend",l.value=g+(r.readUInt8()<<7)-8192,l;default:throw"Unrecognised MIDI event type: "+p}}}}function s(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},s.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},s.prototype.readUInt16=function(){var n=this.readUInt8(),r=this.readUInt8();return(n<<8)+r},s.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},s.prototype.readUInt24=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8();return(n<<16)+(r<<8)+a},s.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},s.prototype.readUInt32=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8(),o=this.readUInt8();return(n<<24)+(r<<16)+(a<<8)+o},s.prototype.readBytes=function(n){var r=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,r},s.prototype.readString=function(n){var r=this.readBytes(n);return String.fromCharCode.apply(null,r)},s.prototype.readVarInt=function(){for(var n=0;!this.eof();){var r=this.readUInt8();if(r&128)n+=r&127,n<<=7;else return n+r}return n},s.prototype.readChunk=function(){var n=this.readString(4),r=this.readUInt32(),a=this.readBytes(r);return{id:n,length:r,data:a}},ei=i,ei}var ti,is;function Ql(){if(is)return ti;is=1;function i(r,a){if(typeof r!="object")throw"Invalid MIDI data";a=a||{};var o=r.header||{},c=r.tracks||[],d,l=c.length,u=new n;for(e(u,o,l),d=0;d<l;d++)t(u,c[d],a);return u.buffer}function e(r,a,o){var c=a.format==null?1:a.format,d=128;a.timeDivision?d=a.timeDivision:a.ticksPerFrame&&a.framesPerSecond?d=-(a.framesPerSecond&255)<<8|a.ticksPerFrame&255:a.ticksPerBeat&&(d=a.ticksPerBeat&32767);var l=new n;l.writeUInt16(c),l.writeUInt16(o),l.writeUInt16(d),r.writeChunk("MThd",l.buffer)}function t(r,a,o){var c=new n,d,l=a.length,u=null;for(d=0;d<l;d++)(o.running===!1||!o.running&&!a[d].running)&&(u=null),u=s(c,a[d],u,o.useByte9ForNoteOff);r.writeChunk("MTrk",c.buffer)}function s(r,a,o,c){var d=a.type,l=a.deltaTime,u=a.text||"",h=a.data||[],f=null;switch(r.writeVarInt(l),d){case"sequenceNumber":r.writeUInt8(255),r.writeUInt8(0),r.writeVarInt(2),r.writeUInt16(a.number);break;case"text":r.writeUInt8(255),r.writeUInt8(1),r.writeVarInt(u.length),r.writeString(u);break;case"copyrightNotice":r.writeUInt8(255),r.writeUInt8(2),r.writeVarInt(u.length),r.writeString(u);break;case"trackName":r.writeUInt8(255),r.writeUInt8(3),r.writeVarInt(u.length),r.writeString(u);break;case"instrumentName":r.writeUInt8(255),r.writeUInt8(4),r.writeVarInt(u.length),r.writeString(u);break;case"lyrics":r.writeUInt8(255),r.writeUInt8(5),r.writeVarInt(u.length),r.writeString(u);break;case"marker":r.writeUInt8(255),r.writeUInt8(6),r.writeVarInt(u.length),r.writeString(u);break;case"cuePoint":r.writeUInt8(255),r.writeUInt8(7),r.writeVarInt(u.length),r.writeString(u);break;case"channelPrefix":r.writeUInt8(255),r.writeUInt8(32),r.writeVarInt(1),r.writeUInt8(a.channel);break;case"portPrefix":r.writeUInt8(255),r.writeUInt8(33),r.writeVarInt(1),r.writeUInt8(a.port);break;case"endOfTrack":r.writeUInt8(255),r.writeUInt8(47),r.writeVarInt(0);break;case"setTempo":r.writeUInt8(255),r.writeUInt8(81),r.writeVarInt(3),r.writeUInt24(a.microsecondsPerBeat);break;case"smpteOffset":r.writeUInt8(255),r.writeUInt8(84),r.writeVarInt(5);var y={24:0,25:32,29:64,30:96},b=a.hour&31|y[a.frameRate];r.writeUInt8(b),r.writeUInt8(a.min),r.writeUInt8(a.sec),r.writeUInt8(a.frame),r.writeUInt8(a.subFrame);break;case"timeSignature":r.writeUInt8(255),r.writeUInt8(88),r.writeVarInt(4),r.writeUInt8(a.numerator);var g=Math.floor(Math.log(a.denominator)/Math.LN2)&255;r.writeUInt8(g),r.writeUInt8(a.metronome),r.writeUInt8(a.thirtyseconds||8);break;case"keySignature":r.writeUInt8(255),r.writeUInt8(89),r.writeVarInt(2),r.writeInt8(a.key),r.writeUInt8(a.scale);break;case"sequencerSpecific":r.writeUInt8(255),r.writeUInt8(127),r.writeVarInt(h.length),r.writeBytes(h);break;case"unknownMeta":a.metatypeByte!=null&&(r.writeUInt8(255),r.writeUInt8(a.metatypeByte),r.writeVarInt(h.length),r.writeBytes(h));break;case"sysEx":r.writeUInt8(240),r.writeVarInt(h.length),r.writeBytes(h);break;case"endSysEx":r.writeUInt8(247),r.writeVarInt(h.length),r.writeBytes(h);break;case"noteOff":var p=c!==!1&&a.byte9||c&&a.velocity==0?144:128;f=p|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteOn":f=144|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteAftertouch":f=160|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.amount);break;case"controller":f=176|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.controllerType),r.writeUInt8(a.value);break;case"programChange":f=192|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.programNumber);break;case"channelAftertouch":f=208|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.amount);break;case"pitchBend":f=224|a.channel,f!==o&&r.writeUInt8(f);var v=8192+a.value,S=v&127,_=v>>7&127;r.writeUInt8(S),r.writeUInt8(_);break;default:throw"Unrecognized event type: "+d}return f}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(r){this.buffer.push(r&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(r){var a=r>>8&255,o=r&255;this.writeUInt8(a),this.writeUInt8(o)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(r){var a=r>>16&255,o=r>>8&255,c=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(c)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(r){var a=r>>24&255,o=r>>16&255,c=r>>8&255,d=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(c),this.writeUInt8(d)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(r){this.buffer=this.buffer.concat(Array.prototype.slice.call(r,0))},n.prototype.writeString=function(r){var a,o=r.length,c=[];for(a=0;a<o;a++)c.push(r.codePointAt(a));this.writeBytes(c)},n.prototype.writeVarInt=function(r){if(r<0)throw"Cannot write negative variable-length integer";if(r<=127)this.writeUInt8(r);else{var a=r,o=[];for(o.push(a&127),a>>=7;a;){var c=a&127|128;o.push(c),a>>=7}this.writeBytes(o.reverse())}},n.prototype.writeChunk=function(r,a){this.writeString(r),this.writeUInt32(a.length),this.writeBytes(a)},ti=i,ti}var ss;function Lr(){return ss||(ss=1,_t.parseMidi=Zl(),_t.writeMidi=Ql()),_t}var ii={},xe={},rs;function kr(){if(rs)return xe;rs=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.insert=xe.search=void 0;function i(t,s,n){n===void 0&&(n="ticks");var r=0,a=t.length,o=a;if(a>0&&t[a-1][n]<=s)return a-1;for(;r<o;){var c=Math.floor(r+(o-r)/2),d=t[c],l=t[c+1];if(d[n]===s){for(var u=c;u<t.length;u++){var h=t[u];h[n]===s&&(c=u)}return c}else{if(d[n]<s&&l[n]>s)return c;d[n]>s?o=c:d[n]<s&&(r=c+1)}}return-1}xe.search=i;function e(t,s,n){if(n===void 0&&(n="ticks"),t.length){var r=i(t,s[n],n);t.splice(r+1,0,s)}else t.push(s)}return xe.insert=e,xe}var ns;function yi(){return ns||(ns=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.keySignatureKeys=void 0;var e=kr(),t=new WeakMap;i.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function n(r){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",t.set(this,480),r){t.set(this,r.header.ticksPerBeat),r.tracks.forEach(function(c){c.forEach(function(d){d.meta&&(d.type==="timeSignature"?a.timeSignatures.push({ticks:d.absoluteTime,timeSignature:[d.numerator,d.denominator]}):d.type==="setTempo"?a.tempos.push({bpm:6e7/d.microsecondsPerBeat,ticks:d.absoluteTime}):d.type==="keySignature"&&a.keySignatures.push({key:i.keySignatureKeys[d.key+7],scale:d.scale===0?"major":"minor",ticks:d.absoluteTime}))})});var o=0;r.tracks[0].forEach(function(c){o+=c.deltaTime,c.meta&&(c.type==="trackName"?a.name=c.text:(c.type==="text"||c.type==="cuePoint"||c.type==="marker"||c.type==="lyrics")&&a.meta.push({text:c.text,ticks:o,type:c.type}))}),this.update()}}return n.prototype.update=function(){var r=this,a=0,o=0;this.tempos.sort(function(c,d){return c.ticks-d.ticks}),this.tempos.forEach(function(c,d){var l=d>0?r.tempos[d-1].bpm:r.tempos[0].bpm,u=c.ticks/r.ppq-o,h=60/l*u;c.time=h+a,a=c.time,o+=u}),this.timeSignatures.sort(function(c,d){return c.ticks-d.ticks}),this.timeSignatures.forEach(function(c,d){var l=d>0?r.timeSignatures[d-1]:r.timeSignatures[0],u=(c.ticks-l.ticks)/r.ppq,h=u/l.timeSignature[0]/(l.timeSignature[1]/4);l.measures=l.measures||0,c.measures=h+l.measures})},n.prototype.ticksToSeconds=function(r){var a=(0,e.search)(this.tempos,r);if(a!==-1){var o=this.tempos[a],c=o.time,d=(r-o.ticks)/this.ppq;return c+60/o.bpm*d}else{var l=r/this.ppq;return 60/120*l}},n.prototype.ticksToMeasures=function(r){var a=(0,e.search)(this.timeSignatures,r);if(a!==-1){var o=this.timeSignatures[a],c=(r-o.ticks)/this.ppq;return o.measures+c/(o.timeSignature[0]/o.timeSignature[1])/4}else return r/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(r){var a=(0,e.search)(this.tempos,r,"time");if(a!==-1){var o=this.tempos[a],c=o.time,d=r-c,l=d/(60/o.bpm);return Math.round(o.ticks+l*this.ppq)}else{var u=r/.5;return Math.round(u*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(r){return{bpm:r.bpm,ticks:r.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(r){this.name=r.name,this.tempos=r.tempos.map(function(a){return Object.assign({},a)}),this.timeSignatures=r.timeSignatures.map(function(a){return Object.assign({},a)}),this.keySignatures=r.keySignatures.map(function(a){return Object.assign({},a)}),this.meta=r.meta.map(function(a){return Object.assign({},a)}),t.set(this,r.ppq),this.update()},n.prototype.setTempo=function(r){this.tempos=[{bpm:r,ticks:0}],this.update()},n}();i.Header=s}(ii)),ii}var ze={},si={},as;function Gr(){return as||(as=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ControlChange=i.controlChangeIds=i.controlChangeNames=void 0,i.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},i.controlChangeIds=Object.keys(i.controlChangeNames).reduce(function(n,r){return n[i.controlChangeNames[r]]=r,n},{});var e=new WeakMap,t=new WeakMap,s=function(){function n(r,a){e.set(this,a),t.set(this,r.controllerType),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(n.prototype,"number",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return i.controlChangeNames[this.number]?i.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var r=e.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var a=e.get(this);this.ticks=a.secondsToTicks(r)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();i.ControlChange=s}(si)),si}var Je={},os;function ec(){if(os)return Je;os=1,Object.defineProperty(Je,"__esModule",{value:!0}),Je.createControlChanges=void 0;var i=Gr();function e(){return new Proxy({},{get:function(t,s){if(t[s])return t[s];if(i.controlChangeIds.hasOwnProperty(s))return t[i.controlChangeIds[s]]},set:function(t,s,n){return i.controlChangeIds.hasOwnProperty(s)?t[i.controlChangeIds[s]]=n:t[s]=n,!0}})}return Je.createControlChanges=e,Je}var je={},ls;function tc(){if(ls)return je;ls=1,Object.defineProperty(je,"__esModule",{value:!0}),je.PitchBend=void 0;var i=new WeakMap,e=function(){function t(s,n){i.set(this,n),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(t.prototype,"time",{get:function(){var s=i.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=i.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return je.PitchBend=e,je}var We={},ye={},cs;function ic(){return cs||(cs=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.DrumKitByPatchID=ye.InstrumentFamilyByID=ye.instrumentByPatchID=void 0,ye.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],ye.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],ye.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),ye}var ds;function sc(){if(ds)return We;ds=1,Object.defineProperty(We,"__esModule",{value:!0}),We.Instrument=void 0;var i=ic(),e=new WeakMap,t=function(){function s(n,r){if(this.number=0,e.set(this,r),this.number=0,n){var a=n.find(function(o){return o.type==="programChange"});a&&(this.number=a.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?i.DrumKitByPatchID[this.number]:i.instrumentByPatchID[this.number]},set:function(n){var r=i.instrumentByPatchID.indexOf(n);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":i.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var n=e.get(this);return n.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(n){this.number=n.number},s}();return We.Instrument=t,We}var Xe={},us;function rc(){if(us)return Xe;us=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Note=void 0;function i(a){var o=Math.floor(a/12)-1;return e(a)+o.toString()}function e(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],c=a%12;return o[c]}function t(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(a)}var s=function(){var a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(c){var d=a.exec(c),l=d[1],u=d[2],h=o[l.toLowerCase()];return h+(parseInt(u,10)+1)*12}}(),n=new WeakMap,r=function(){function a(o,c,d){n.set(this,d),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=c.velocity,this.ticks=o.ticks,this.durationTicks=c.ticks-o.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return i(this.midi)},set:function(o){this.midi=s(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var c=o-this.octave;this.midi+=c*12},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(o){this.midi=12*(this.octave+1)+t(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var c=n.get(this),d=c.secondsToTicks(this.time+o);this.durationTicks=d-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var c=n.get(this);this.ticks=c.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){var o=n.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return Xe.Note=r,Xe}var hs;function fs(){if(hs)return ze;hs=1,Object.defineProperty(ze,"__esModule",{value:!0}),ze.Track=void 0;var i=kr(),e=Gr(),t=ec(),s=tc(),n=sc(),r=rc(),a=new WeakMap,o=function(){function c(d,l){var u=this;if(this.name="",this.notes=[],this.controlChanges=(0,t.createControlChanges)(),this.pitchBends=[],a.set(this,l),d){var h=d.find(function(_){return _.type==="trackName"});this.name=h?h.text:""}if(this.instrument=new n.Instrument(d,this),this.channel=0,d){for(var f=d.filter(function(_){return _.type==="noteOn"}),y=d.filter(function(_){return _.type==="noteOff"}),b=function(){var _=f.shift();g.channel=_.channel;var C=y.findIndex(function(w){return w.noteNumber===_.noteNumber&&w.absoluteTime>=_.absoluteTime});if(C!==-1){var N=y.splice(C,1)[0];g.addNote({durationTicks:N.absoluteTime-_.absoluteTime,midi:_.noteNumber,noteOffVelocity:N.velocity/127,ticks:_.absoluteTime,velocity:_.velocity/127})}},g=this;f.length;)b();var p=d.filter(function(_){return _.type==="controller"});p.forEach(function(_){u.addCC({number:_.controllerType,ticks:_.absoluteTime,value:_.value/127})});var v=d.filter(function(_){return _.type==="pitchBend"});v.forEach(function(_){u.addPitchBend({ticks:_.absoluteTime,value:_.value/Math.pow(2,13)})});var S=d.find(function(_){return _.type==="endOfTrack"});this.endOfTrackTicks=S!==void 0?S.absoluteTime:void 0}}return c.prototype.addNote=function(d){var l=a.get(this),u=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},l);return Object.assign(u,d),(0,i.insert)(this.notes,u,"ticks"),this},c.prototype.addCC=function(d){var l=a.get(this),u=new e.ControlChange({controllerType:d.number},l);return delete d.number,Object.assign(u,d),Array.isArray(this.controlChanges[u.number])||(this.controlChanges[u.number]=[]),(0,i.insert)(this.controlChanges[u.number],u,"ticks"),this},c.prototype.addPitchBend=function(d){var l=a.get(this),u=new s.PitchBend({},l);return Object.assign(u,d),(0,i.insert)(this.pitchBends,u,"ticks"),this},Object.defineProperty(c.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,l=0;l<this.notes.length-1;l++){var u=this.notes[l].time+this.notes[l].duration;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,l=0;l<this.notes.length-1;l++){var u=this.notes[l].ticks+this.notes[l].durationTicks;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),c.prototype.fromJSON=function(d){var l=this;this.name=d.name,this.channel=d.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(d.instrument),d.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=d.endOfTrackTicks);for(var u in d.controlChanges)d.controlChanges[u]&&d.controlChanges[u].forEach(function(h){l.addCC({number:h.number,ticks:h.ticks,value:h.value})});d.notes.forEach(function(h){l.addNote({durationTicks:h.durationTicks,midi:h.midi,ticks:h.ticks,velocity:h.velocity})})},c.prototype.toJSON=function(){for(var d={},l=0;l<127;l++)this.controlChanges.hasOwnProperty(l)&&(d[l]=this.controlChanges[l].map(function(h){return h.toJSON()}));var u={channel:this.channel,controlChanges:d,pitchBends:this.pitchBends.map(function(h){return h.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(h){return h.toJSON()})};return this.endOfTrackTicks!==void 0&&(u.endOfTrackTicks=this.endOfTrackTicks),u},c}();return ze.Track=o,ze}var Le={};function nc(i){var e=[];return Br(i,e),e}function Br(i,e){for(var t=0;t<i.length;t++){var s=i[t];Array.isArray(s)?Br(s,e):e.push(s)}}const ac=Object.freeze(Object.defineProperty({__proto__:null,flatten:nc},Symbol.toStringTag,{value:"Module"})),oc=Yl(ac);var ps;function lc(){if(ps)return Le;ps=1;var i=Le&&Le.__spreadArray||function(p,v,S){if(S||arguments.length===2)for(var _=0,C=v.length,N;_<C;_++)(N||!(_ in v))&&(N||(N=Array.prototype.slice.call(v,0,_)),N[_]=v[_]);return p.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(Le,"__esModule",{value:!0}),Le.encode=void 0;var e=Lr(),t=yi(),s=oc;function n(p,v){return[{absoluteTime:p.ticks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOn",velocity:Math.floor(p.velocity*127)},{absoluteTime:p.ticks+p.durationTicks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOff",velocity:Math.floor(p.noteOffVelocity*127)}]}function r(p){return(0,s.flatten)(p.notes.map(function(v){return n(v,p.channel)}))}function a(p,v){return{absoluteTime:p.ticks,channel:v,controllerType:p.number,deltaTime:0,type:"controller",value:Math.floor(p.value*127)}}function o(p){for(var v=[],S=0;S<127;S++)p.controlChanges.hasOwnProperty(S)&&p.controlChanges[S].forEach(function(_){v.push(a(_,p.channel))});return v}function c(p,v){return{absoluteTime:p.ticks,channel:v,deltaTime:0,type:"pitchBend",value:p.value}}function d(p){var v=[];return p.pitchBends.forEach(function(S){v.push(c(S,p.channel))}),v}function l(p){return{absoluteTime:0,channel:p.channel,deltaTime:0,programNumber:p.instrument.number,type:"programChange"}}function u(p){return{absoluteTime:0,deltaTime:0,meta:!0,text:p,type:"trackName"}}function h(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/p.bpm),type:"setTempo"}}function f(p){return{absoluteTime:p.ticks,deltaTime:0,denominator:p.timeSignature[1],meta:!0,metronome:24,numerator:p.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function y(p){var v=t.keySignatureKeys.indexOf(p.key);return{absoluteTime:p.ticks,deltaTime:0,key:v+7,meta:!0,scale:p.scale==="major"?0:1,type:"keySignature"}}function b(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,text:p.text,type:p.type}}function g(p){var v={header:{format:1,numTracks:p.tracks.length+1,ticksPerBeat:p.header.ppq},tracks:i([i(i(i(i([{absoluteTime:0,deltaTime:0,meta:!0,text:p.header.name,type:"trackName"}],p.header.keySignatures.map(function(S){return y(S)}),!0),p.header.meta.map(function(S){return b(S)}),!0),p.header.tempos.map(function(S){return h(S)}),!0),p.header.timeSignatures.map(function(S){return f(S)}),!0)],p.tracks.map(function(S){return i(i(i([u(S.name),l(S)],r(S),!0),o(S),!0),d(S),!0)}),!0)};return v.tracks=v.tracks.map(function(S){S=S.sort(function(C,N){return C.absoluteTime-N.absoluteTime});var _=0;return S.forEach(function(C){C.deltaTime=C.absoluteTime-_,_=C.absoluteTime,delete C.absoluteTime}),S.push({deltaTime:0,meta:!0,type:"endOfTrack"}),S}),new Uint8Array((0,e.writeMidi)(v))}return Le.encode=g,Le}var ms;function cc(){return ms||(ms=1,function(i){var e=Me&&Me.__awaiter||function(u,h,f,y){function b(g){return g instanceof f?g:new f(function(p){p(g)})}return new(f||(f=Promise))(function(g,p){function v(C){try{_(y.next(C))}catch(N){p(N)}}function S(C){try{_(y.throw(C))}catch(N){p(N)}}function _(C){C.done?g(C.value):b(C.value).then(v,S)}_((y=y.apply(u,h||[])).next())})},t=Me&&Me.__generator||function(u,h){var f={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},y,b,g,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(_){return function(C){return S([_,C])}}function S(_){if(y)throw new TypeError("Generator is already executing.");for(;f;)try{if(y=1,b&&(g=_[0]&2?b.return:_[0]?b.throw||((g=b.return)&&g.call(b),0):b.next)&&!(g=g.call(b,_[1])).done)return g;switch(b=0,g&&(_=[_[0]&2,g.value]),_[0]){case 0:case 1:g=_;break;case 4:return f.label++,{value:_[1],done:!1};case 5:f.label++,b=_[1],_=[0];continue;case 7:_=f.ops.pop(),f.trys.pop();continue;default:if(g=f.trys,!(g=g.length>0&&g[g.length-1])&&(_[0]===6||_[0]===2)){f=0;continue}if(_[0]===3&&(!g||_[1]>g[0]&&_[1]<g[3])){f.label=_[1];break}if(_[0]===6&&f.label<g[1]){f.label=g[1],g=_;break}if(g&&f.label<g[2]){f.label=g[2],f.ops.push(_);break}g[2]&&f.ops.pop(),f.trys.pop();continue}_=h.call(u,f)}catch(C){_=[6,C],b=0}finally{y=g=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.Track=i.Midi=void 0;var s=Lr(),n=yi(),r=fs(),a=lc(),o=function(){function u(h){var f=this,y=null;if(h){var b=h instanceof ArrayBuffer?new Uint8Array(h):h;y=(0,s.parseMidi)(b),y.tracks.forEach(function(g){var p=0;g.forEach(function(v){p+=v.deltaTime,v.absoluteTime=p})}),y.tracks=l(y.tracks)}this.header=new n.Header(y),this.tracks=[],h&&(this.tracks=y.tracks.map(function(g){return new r.Track(g,f.header)}),y.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return u.fromUrl=function(h){return e(this,void 0,void 0,function(){var f,y;return t(this,function(b){switch(b.label){case 0:return[4,fetch(h)];case 1:return f=b.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return y=b.sent(),[2,new u(y)];case 3:throw new Error("Could not load '".concat(h,"'"))}})})},Object.defineProperty(u.prototype,"name",{get:function(){return this.header.name},set:function(h){this.header.name=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var h=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){var h=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),u.prototype.addTrack=function(){var h=new r.Track(void 0,this.header);return this.tracks.push(h),h},u.prototype.toArray=function(){return(0,a.encode)(this)},u.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(h){return h.toJSON()})}},u.prototype.fromJSON=function(h){var f=this;this.header=new n.Header,this.header.fromJSON(h.header),this.tracks=h.tracks.map(function(y){var b=new r.Track(void 0,f.header);return b.fromJSON(y),b})},u.prototype.clone=function(){var h=new u;return h.fromJSON(this.toJSON()),h},u}();i.Midi=o;var c=fs();Object.defineProperty(i,"Track",{enumerable:!0,get:function(){return c.Track}});var d=yi();Object.defineProperty(i,"Header",{enumerable:!0,get:function(){return d.Header}});function l(u){for(var h=[],f=0;f<u.length;f++)for(var y=h.length,b=new Map,g=Array(16).fill(0),p=0,v=u[f];p<v.length;p++){var S=v[p],_=y,C=S.channel;if(C!==void 0){S.type==="programChange"&&(g[C]=S.programNumber);var N=g[C],w="".concat(N," ").concat(C);b.has(w)?_=b.get(w):(_=y+b.size,b.set(w,_))}h[_]||h.push([]),h[_].push(S)}return h}}(Me)),Me}var Ii=cc();const Er=["acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honkytonk_piano","electric_piano_1","electric_piano_2","harpsichord","clavinet","celesta","glockenspiel","music_box","vibraphone","marimba","xylophone","tubular_bells","dulcimer","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","guitar_harmonics","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass","slap_bass_1","slap_bass_2","synth_bass_1","synth_bass_2","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synth_strings_1","synth_strings_2","choir_aahs","voice_oohs","synth_choir","orchestra_hit","trumpet","trombone","tuba","muted_trumpet","french_horn","brass_section","synth_brass_1","synth_brass_2","soprano_sax","alto_sax","tenor_sax","baritone_sax","oboe","english_horn","bassoon","clarinet","piccolo","flute","recorder","pan_flute","blown_bottle","shakuhachi","whistle","ocarina","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","sitar","banjo","shamisen","koto","kalimba","bagpipe","fiddle","shanai","tinkle_bell","agogo","steel_drums","woodblock","taiko_drum","melodic_tom","synth_drum","reverse_cymbal","guitar_fret_noise","breath_noise","seashore","bird_tweet","telephone_ring","helicopter","applause","gunshot"];function Ar(i){const e=i.split("/"),s=e[e.length-1].trim().toLowerCase().replace(/\s+/g,"_"),n=Er.findIndex(r=>r===s);return n!==-1?n:(s.includes("drum")||s.includes("drummachine"),0)}async function dc(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=new Ii.Midi;e.header.setTempo(i.tempo),e.header.timeSignatures.push({ticks:0,timeSignature:i.timeSignature});for(const[n,r]of i.sequencers.entries()){const a=e.addTrack(),o=r.instrument.toLowerCase().includes("drum");a.channel=o?9:n%16;const c=Ar(r.instrument);if(a.instrument.number=c,typeof r.volume=="number"&&a.addCC({number:7,time:0,value:Math.max(0,Math.min(1,r.volume))}),typeof r.pan=="number"){const d=(r.pan+1)/2;a.addCC({number:10,time:0,value:Math.max(0,Math.min(1,d))})}for(const d of r.notes){const l=j(d.pitch),u=Math.max(.01,Math.min(1,(d.velocity??100)/127));if(l===null)continue;const h=Lt(d.start,i.tempo),f=Lt(d.duration,i.tempo);a.addNote({midi:l,time:h,duration:f,velocity:u})}}const t=new Blob([e.toArray()],{type:"audio/midi"});return{url:URL.createObjectURL(t),filename:`session-${Date.now()}.mid`}}function uc(i){if(!i.length)throw new Error("No sequencers to export.");const e=new Ii.Midi,t=me(),s=Te();e.header.setTempo(t),e.header.timeSignatures.push({ticks:0,timeSignature:[s,4]});for(const[a,o]of i.entries()){const c=e.addTrack(),d=o.instrumentName.toLowerCase().includes("drum");c.channel=d?9:a%16;const l=Ar(o.instrumentName);if(c.instrument.number=l,typeof o.volume=="number"&&c.addCC({number:7,time:0,value:Math.max(0,Math.min(1,o.volume))}),typeof o.pan=="number"){const u=(o.pan+1)/2;c.addCC({number:10,time:0,value:Math.max(0,Math.min(1,u))})}for(const u of o.notes){const h=j(u.pitch),f=Math.max(.01,Math.min(1,(u.velocity??100)/127));if(h===null)continue;const y=Lt(u.start,t),b=Lt(u.duration,t);c.addNote({midi:h,time:y,duration:b,velocity:f})}T(`[ExportMidi] Track ${a} (${o.instrumentName}) added with ${c.notes.length} notes.`)}const n=new Blob([e.toArray()],{type:"audio/midi"}),r=`session-${Date.now()}.mid`;return T(`[ExportMidi] MIDI session file created: ${r}, size: ${n.size} bytes`),{filename:r,blob:n}}function Lt(i,e){return 60/e*i}function Tr(i,e){const{filename:t,blob:s}=uc(e),n=URL.createObjectURL(s);if(i.dataTransfer){i.dataTransfer.clearData(),i.dataTransfer.setData("DownloadURL",`audio/midi:${t}:${n}`),i.dataTransfer.effectAllowed="copy";const r=document.createElement("div");return r.textContent=t,r.style.padding="10px 16px",r.style.background="#000000",r.style.color="#ffffff",r.style.fontFamily="sans-serif",r.style.fontSize="12px",r.style.border="1px solid #555",r.style.borderRadius="6px",r.style.boxShadow="0 2px 6px rgba(0, 0, 0, 0.5)",r.style.position="absolute",r.style.top="-1000px",r.style.pointerEvents="none",document.body.appendChild(r),i.dataTransfer.setDragImage(r,0,0),T("[ExportMidiDrag] dataTransfer populated with MIDI file via DownloadURL"),()=>{T("[ExportMidiDrag] cleaning up URL and drag image"),setTimeout(()=>{URL.revokeObjectURL(n),T(`[ExportMidiDrag] URL revoked: ${n}`)},100),r.parentNode&&r.parentNode.removeChild(r)}}else return console.warn("Drag event has no dataTransfer"),()=>{}}function hc(i,e){let t=null;const s=r=>{i.classList.add("dragging"),T(`[ExportMidiDrag] dragstart fired for sequencer ${e.id}`),t=Tr(r,[e])},n=()=>{T(`[ExportMidiDrag] dragend for sequencer ${e.id}`),i.classList.remove("dragging"),t&&(t(),t=null)};return i.addEventListener("dragstart",s),i.addEventListener("dragend",n),{detach:()=>{i.removeEventListener("dragstart",s),i.removeEventListener("dragend",n)},refreshUI:()=>{}}}function fc(i,e){var n;const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.id);if(s&&typeof e.volume=="number"){s.volume=e.volume;const a=z().find(o=>o.id===e.id);a&&(a.volume=e.volume,(n=a.refreshVolumeUI)==null||n.call(a))}return t}function pc(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function mc(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function yc(i,e){const{element:t,fill:s,thumb:n}=i;let r=!1,a=!1,o=!1,c=null;const d=100/127,l=.1;function u(){const p=Math.max(0,Math.min(1,e.volume)),v=t.clientWidth,S=14,_=0,C=v-S,N=p*v,w=Math.max(_,Math.min(C,N-S/2));s.style.width=`${Math.round(p*100)}%`,n.style.left=`${w}px`;const L=Math.round(p/d*100);t.setAttribute("title",`Volume: ${L}%`);const G=p>d;s.classList.toggle("overdrive",G),n.classList.toggle("overdrive",G)}function h(){s.classList.toggle("precise",a),n.classList.toggle("precise",a)}function f(p){const v=t.getBoundingClientRect(),S=p-v.left;let _=Math.max(0,Math.min(1,S/v.width));return!a&&Math.abs(_-d)<l?(_=d,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.volume=_,u(),_}const y=p=>{r=!0,a=p.shiftKey,c=e.volume,h(),f(p.clientX),p.preventDefault()},b=p=>{r&&(a=p.shiftKey,h(),f(p.clientX))},g=p=>{if(!r)return;r=!1;const v=f(p.clientX);c!==null&&v!==c&&R(pc(e.id,v),mc(e.id,c)),c=null,a=!1,o=!1,h(),u()};return t.addEventListener("mousedown",y),window.addEventListener("mousemove",b),window.addEventListener("mouseup",g),{detach:()=>{t.removeEventListener("mousedown",y),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",g)},refreshUI:u}}function gc(i,e){var n;const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.id);if(s&&typeof e.pan=="number"){s.pan=e.pan;const a=z().find(o=>o.id===e.id);a&&(a.pan=e.pan,(n=a.refreshPanUI)==null||n.call(a))}return t}function bc(i,e){return{type:"SET_PAN",id:i,pan:e}}function _c(i,e){return{type:"SET_PAN",id:i,pan:e}}function vc(i,e){const{element:t,fill:s,thumb:n}=i;let r=!1,a=!1,o=!1,c=null;function d(){const b=Math.max(-1,Math.min(1,e.pan)),g=(b+1)/2,p=t.clientWidth,v=14,S=0,_=p-v,C=g*p,N=Math.max(S,Math.min(_,C-v/2));s.style.width=`${Math.round(g*100)}%`,n.style.left=`${N}px`;const w=Math.round(b*100);t.setAttribute("title",`Pan: ${w}%`)}function l(){s.classList.toggle("precise",a),n.classList.toggle("precise",a)}function u(b){const g=t.getBoundingClientRect(),p=b-g.left;let S=Math.max(0,Math.min(1,p/g.width))*2-1;const _=0;return!a&&Math.abs(S-_)<.05?(S=_,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.pan=S,d(),S}const h=b=>{r=!0,a=b.shiftKey,c=e.pan,l(),u(b.clientX),b.preventDefault()},f=b=>{r&&(a=b.shiftKey,l(),u(b.clientX))},y=b=>{if(!r)return;r=!1;const g=u(b.clientX);c!==null&&g!==c&&R(bc(e.id,g),_c(e.id,c)),c=null,a=!1,o=!1,l(),d()};return t.addEventListener("mousedown",h),window.addEventListener("mousemove",f),window.addEventListener("mouseup",y),{detach:()=>{t.removeEventListener("mousedown",h),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",y)},refreshUI:d}}function Sc(i,{onZoomIn:e,onZoomOut:t,onResetZoom:s}){const{zoomInBtn:n,zoomOutBtn:r,zoomResetBtn:a,trailingDivider:o}=i,c=()=>{n.classList.toggle("hidden",!0),r.classList.toggle("hidden",!0),a.classList.toggle("hidden",!0),o.classList.toggle("hidden",!0)};return n.addEventListener("click",e),r.addEventListener("click",t),a.addEventListener("click",s),{detach:()=>{n.removeEventListener("click",e),r.removeEventListener("click",t),a.removeEventListener("click",s)},refreshUI:c}}function Cc(i,e,t,s,n){const{muteBtn:r,soloBtn:a,collapseBtn:o,deleteBtn:c}=i,d=()=>{r.classList.toggle("side-button-activated",e.mute),a.classList.toggle("side-button-activated",e.solo)},l=()=>{e.toggleMute(),d()},u=()=>{e.toggleSolo(),d()},h=()=>{s(!n())},f=()=>{Pt().showDeleteConfirmModal(()=>{R(Mr(e.id,e.instrumentName,e.notes,e.volume,e.pan),xr(e.id,e.instrumentName,e.notes,e.volume,e.pan)),e.destroy()},()=>{console.log("Delete cancelled")})};return r.addEventListener("click",l),a.addEventListener("click",u),o.addEventListener("click",h),c.addEventListener("click",f),{detach:()=>{r.removeEventListener("click",l),a.removeEventListener("click",u),o.removeEventListener("click",h),c.removeEventListener("click",f)},refreshUI:()=>{d()}}}class Nc{constructor(e,t,s){this.id=null,this.zoomUI=null,this._collapsed=!1,this.detachFns=[],this.refreshFns=[],this.id=s??null,this.initializeUI(e,t),this.toggleZoomControls(!0),this.boundReload=this.reload.bind(this)}initializeUI(e,t){const s=Ll(),n=kl();this.rootEl=s.element,s.topBarContainer.appendChild(n.element),e.appendChild(this.rootEl);const r=Gl(),a=Bl(),o=El(),c=Al(),d=Tl();this.collapseBtn=d.collapseBtn,n.leftGroup.appendChild(r.instrumentButton),n.leftGroup.appendChild(r.copyMidiButton),n.leftGroup.appendChild(r.label),n.volumeWrapper.appendChild(a.element),n.panWrapper.appendChild(o.element),n.zoomWrapper.appendChild(c.element),n.rightControlsWrapper.appendChild(d.element);const{seq:l}=Ml(this.rootEl,t,this.id);this.body=s,this.zoomUI=c,this.sequencer=l,this.grid=l.matrix;const u=Il(s.gripHandleContainer,s.matrixContainer,this.grid),h=hc(r.copyMidiButton,this.sequencer),f=Vl(r.instrumentButton,this.sequencer),y=yc(a,this.sequencer),b=vc(o,this.sequencer),g=Sc(c,{onZoomIn:()=>this.grid.zoomIn(),onZoomOut:()=>this.grid.zoomOut(),onResetZoom:()=>this.grid.resetZoom()}),p=Cc(d,this.sequencer,s.matrixContainer,v=>this.collapse(v),()=>this.collapsed);this.detachFns=[u.detach,f.detach,h.detach,y.detach,b.detach,g.detach,p.detach],this.refreshFns=[u.refreshUI,f.refreshUI,h.refreshUI,y.refreshUI,b.refreshUI,g.refreshUI,p.refreshUI],xt(this.sequencer,t.collapsed),this.refreshUI()}get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e}collapse(e=!0){return xt(this.sequencer,e,this.collapseBtn),this._collapsed}getMiniContourCanvas(){return this.body.miniContourCanvas}getMatrixContainer(){return this.body.matrixContainer}getElement(){return this.rootEl}refreshUI(){this.refreshFns.forEach(e=>e())}destroy(){this.detachFns.forEach(e=>e()),this.rootEl.remove(),this.sequencer.destroy(),yo(this.sequencer.id),be.getInstance().unregisterReloadable(this.boundReload)}reload(){if(this.id===null||this.id===void 0){console.error("[SequencerController] Cannot reload without a valid ID.");return}const e={id:this.sequencer.id,instrument:this.sequencer.instrumentName,notes:structuredClone(this.sequencer.notes),volume:this.sequencer.volume,pan:this.sequencer.pan,collapsed:this._collapsed};this.detachFns.forEach(s=>s()),this.rootEl.remove(),this.sequencer.destroy();const t=document.getElementById("sequencers-container");if(!t){console.error("[SequencerController] Cannot reload - parent container missing.");return}this.initializeUI(t,e)}toggleZoomControls(e){if(!this.zoomUI)return;const{leadingDivider:t,zoomInBtn:s,zoomOutBtn:n,zoomResetBtn:r,trailingDivider:a}=this.zoomUI;t.classList.toggle("hidden",!e),s.classList.toggle("hidden",!e),n.classList.toggle("hidden",!e),r.classList.toggle("hidden",!e),a.classList.toggle("hidden",!e)}toggleGripHandle(e){const t=this.body.gripHandleContainer;t==null||t.classList.toggle("hidden",!e)}}function Ir(i,e){const t=e.id,s=new Nc(i,e,t);return mo(t,s),be.getInstance().registerReloadable(s.boundReload),s}function wc(i,e){const t=structuredClone(i);if(t.sequencers.push({id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed}),!mt(e.id)){const n={id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed},r=document.getElementById("sequencers-container");if(!r)return console.error("Sequencer container not found!"),t;Ir(r,n)}return t}function Rr(i,e,t,s,n){return{type:"CREATE_SEQUENCER",id:i,instrument:e,volume:t,pan:s,collapsed:n}}function Ri(i){return{type:"DELETE_SEQUENCER",id:i}}function Mc(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),Ne(e.sequencerId),t}function xc(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),Ne(e.sequencerId),t):i}function Lc(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=e.notes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start&&o.duration===r.duration);a&&(a.velocity=r.velocity)}return Ne(e.sequencerId),t}function kc(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function Gc(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function Bc(i,e){return structuredClone(i)}function Oi(i=""){return{type:"CHECKPOINT",label:i}}function Or(i=""){return Oi(i)}const Ec=Object.freeze(Object.defineProperty({__proto__:null,CHANGE_NOTE_DURATION:oo,CHANGE_SNAP_RESOLUTION:no,CHANGE_SONG_KEY:so,CHANGE_TEMPO:Pa,CHECKPOINT:Bc,CREATE_SEQUENCER:wc,CUT_NOTES:Mc,DELETE_NOTES:zo,DELETE_SEQUENCER:wl,MOVE_NOTES:Zo,PASTE_NOTES:xc,PLACE_NOTES:Ho,RESIZE_NOTES:tl,SET_INSTRUMENT:Ul,SET_NOTE_MODIFIER_MODE:co,SET_NOTE_VELOCITY:Lc,SET_PAN:gc,SET_TIME_SIGNATURE:Ua,SET_TOTAL_MEASURES:Ka,SET_VOLUME:fc},Symbol.toStringTag,{value:"Module"}));function Fi(i){const e=Ec[i.type];if(!e)throw new Error(`Unknown diff type: ${i.type}`);const t=e($(),i);Oc(t)}const gi=new Set;function Dt(i){return gi.add(i),()=>gi.delete(i)}function Ut(i){for(const e of gi)e(i)}const Se=[];let _e=-1;const Ac=100;function Tc({forwardDiff:i,reverseDiff:e}){Se.splice(_e+1),Se.push({forwardDiff:i,reverseDiff:e}),_e=Se.length-1,Se.length>Ac&&(Se.shift(),_e--)}function Ic(){var i;if(_e<0)return null;for(let e=_e;e>=0;e--){const t=Se[e];if(((i=t==null?void 0:t.forwardDiff)==null?void 0:i.type)==="CHECKPOINT")return null;if(t!=null&&t.reverseDiff)return _e=e-1,Fi(t.reverseDiff),Ut($()),t.reverseDiff}return null}function Rc(){if(_e>=Se.length-1)return null;_e++;const i=Se[_e];return!i||!i.forwardDiff?null:(Fi(i.forwardDiff),Ut($()),i.forwardDiff)}let kt={tempo:120,timeSignature:[4,4],totalMeasures:8,sequencers:[],songKey:"CM",snapResolution:1,noteDuration:1,isTripletMode:!1,isDottedMode:!1};function $(){return kt}function Oc(i){kt=structuredClone(i),Ut(kt)}function R(i,e){Fi(i),Tc({forwardDiff:i,reverseDiff:e}),Ut(kt)}let Fr=500,Pr=!1;function pe(){return $().totalMeasures*$().timeSignature[0]}function me(){return 60/(Fr/1e3)}function Pi(i,e=!0){const t=me();if(e){R(Vs(i),Da(t));return}const s=J.getInstance();performance.now(),s.getCurrentBeat(),Fr=60/i*1e3,s.isActive()&&s.syncAfterTempoChange(t)}function Di(i,e=!0){const t=$().timeSignature[0];if(e){R(Ys(i),qa(t));return}z().forEach(s=>s.updateBeatsPerMeasure())}function Ui(i,e=!0){const t=$().totalMeasures;if(e){R(Zs(i),$a(t));return}}function Dr(i,e=!0){const t=$().songKey;e&&R(fr(i),ro(t))}function qt(){return hr()?$().snapResolution:.001}function ys(i,e=!0){const t=qt();if(e){R(pr(i),ao(t));return}}function Fc(i,e=!0){const t=$().noteDuration;if(e){R(mr(i),lo(t));return}}function gs(i,e,t=!0){const s=$(),n=s.isTripletMode,r=s.isDottedMode;if(t){R(yr(i,e),uo(n,r));return}}function bi(){return $().isTripletMode}function bs(){return $().isDottedMode}function Pc(){return $().noteDuration}function Te(){return $().timeSignature[0]}function qi(){return $().totalMeasures}function Ki(){return $().songKey}function Dc(i){Pr=i}function Uc(){return Pr}let vt=null;function qc(){return J.getInstance()}class J{constructor(e){this.startTime=0,this.startBeat=0,this.isPlaying=!1,this.animationFrameId=null,this.onResumeCallback=null,this.onStopCallback=null,this.tick=()=>{var n;if(!this.isPlaying)return;const t=this.getCurrentBeat(),s=pe();if(t>=s)if(Uc())this.seek(0),this.start();else{this.stop(),(n=this.onStopCallback)==null||n.call(this);return}this.animationFrameId=requestAnimationFrame(this.tick)},this.context=Z(),this.sequencers=e}static initialize(e){if(vt){console.warn("[PlaybackEngine] Instance already exists. Ignoring re-initialization.");return}vt=new J(e)}static getInstance(){if(!vt)throw new Error("[PlaybackEngine] Instance not initialized. Call initialize() first.");return vt}setOnResumeCallback(e){this.onResumeCallback=e}setOnStopCallback(e){this.onStopCallback=e}getCurrentBeat(){if(!this.isPlaying)return this.startBeat;const e=60/me();return(this.context.currentTime-this.startTime)/e+this.startBeat}async start(){const e=this.context.currentTime+.1;this.startTime=e,this.startBeat=0,this.isPlaying=!0,await this.scheduleAll(e,this.startBeat),this.context.state==="suspended"&&await this.context.resume(),this.animationFrameId=requestAnimationFrame(this.tick)}async pause(){if(!this.isPlaying)return;const e=this.getCurrentBeat();for(const t of this.sequencers)t.stopScheduledNotes();await this.context.suspend(),this.startBeat=e,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}async resume(){var s;if(this.isPlaying)return;await this.context.resume();const t=this.context.currentTime+.05;this.startTime=t,await this.scheduleAll(t,this.startBeat),this.isPlaying=!0,(s=this.onResumeCallback)==null||s.call(this),this.animationFrameId=requestAnimationFrame(this.tick)}stop(){for(const e of this.sequencers)e.stopScheduledNotes();this.isPlaying=!1,this.startBeat=0,this.startTime=0,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}seek(e){this.startBeat=e,this.startTime=this.context.currentTime;const t=this.isPlaying;if(this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t){const s=this.context.currentTime+.05;this.startTime=s,this.scheduleAll(s,this.startBeat).then(()=>{this.animationFrameId=requestAnimationFrame(this.tick)}),this.context.state==="suspended"&&this.context.resume(),this.isPlaying=!0}else this.isPlaying=!1}syncAfterTempoChange(e){const t=this.context.currentTime,s=60/e,n=(t-this.startTime)/s+this.startBeat;this.startBeat=n,this.startTime=t}setSequencers(e){this.sequencers=e}addSequencer(e){this.sequencers.includes(e)||this.sequencers.push(e)}removeSequencer(e){this.sequencers=this.sequencers.filter(t=>t!==e)}clearSequencers(){this.stop(),this.sequencers=[]}isActive(){return this.isPlaying}getStartTime(){return this.startTime}getStartBeat(){return this.startBeat}async scheduleAll(e,t){for(const s of this.sequencers)s.shouldPlay?await s.preparePlayback(e,t):s.stopScheduledNotes()}}const pt=new Map;let Ur=null;function Kc(i,e){pt.set(i,e)}function $c(i){pt.delete(i)}function mt(i){return pt.get(i)}function z(){return Array.from(pt.values())}function qr(){return Ur}function Ne(i){Ai(),Ur=i}function Hc(){pt.clear()}function zc(){return z().some(i=>i.solo)}function _s(){const i=J.getInstance();if(!i.isActive())return;const e=i.getStartTime(),t=i.getStartBeat();for(const s of z())s.stopScheduledNotes(),s.shouldPlay&&(s.reschedulePlayback(e,t),s.resumeAnimationsFromCurrentTime(e,t))}function Kr(){return z()}function Jc(){T("Sequencer Dump",Kr())}const jc=Object.freeze(Object.defineProperty({__proto__:null,dumpSequencers:Jc,getSequencers:Kr},Symbol.toStringTag,{value:"Module"}));function $r(){return $()}function Wc(){T("App State Dump",$r())}const Xc=Object.freeze(Object.defineProperty({__proto__:null,dumpState:Wc,getAppState:$r},Symbol.toStringTag,{value:"Module"}));function Vc(){return structuredClone(W())}function Yc(i,e){const t=i.split(".");if(t.length===0){console.warn("Invalid path provided to setUserConfigProperty.");return}let s={},n=s;for(let a=0;a<t.length-1;a++){const o=t[a];n[o]={},n=n[o]}const r=t[t.length-1];n[r]=e,fe(s),T(`[UserConfig] Set ${i} =`,e)}function Zc(i){const e=i.split(".");let t=W();for(const s of e)if(t&&typeof t=="object"&&s in t)t=t[s];else{console.warn(`getUserConfigProperty: Path "${i}" not found.`);return}return t}const Qc=Object.freeze(Object.defineProperty({__proto__:null,getUserConfigProperty:Zc,getUserConfigSnapshot:Vc,setUserConfigProperty:Yc},Symbol.toStringTag,{value:"Module"}));function ed(){const i=Object.create(null);return Object.assign(i,jc,Xc,Qc),i}const td="SEQUENZIA_DEV";function id(){if(typeof window>"u")return;localStorage.getItem(td)==="true"&&!Ht()&&(zi(),console.info("[SEQUENZIA] Dev mode re-enabled from localStorage")),window.toggleDevMode=()=>{const e=!Ht();e?zi():Cn(),console.info(`[SEQUENZIA] Dev mode ${e?"enabled":"disabled"}`),e?vs():delete window.DEVTOOLS},Ht()&&vs()}function vs(){window.DEVTOOLS=ed()}function sd(){window.addEventListener("contextmenu",i=>i.preventDefault()),window.addEventListener("dragstart",i=>{const e=i.target;e.closest(".copy-midi-btn")||e.closest(".drag-midi-btn")||i.preventDefault()}),window.addEventListener("selectstart",i=>i.preventDefault()),window.addEventListener("drop",i=>i.preventDefault()),window.addEventListener("dragover",i=>i.preventDefault()),window.addEventListener("keydown",i=>{const e=[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Home","End","PageUp","PageDown"],t=i.metaKey,s=i.ctrlKey;(e.includes(i.key)||(t||s)&&["s","p"].includes(i.key.toLowerCase()))&&i.preventDefault()})}function Hr(i,e){const t=i.getContext("2d");if(!t)return;const s=window.devicePixelRatio||1,n=i.width/s,r=i.height/s;t.clearRect(0,0,n,r);const a=pe();for(const o of e){const{notes:c,config:d}=o;if(!(c!=null&&c.length))continue;const l=Ke[e.indexOf(o)%Ke.length];t.fillStyle=l;const u=j(d.noteRange[0]),h=j(d.noteRange[1]);if(u==null||h==null)continue;const f=h-u||1,y=Math.max(2,r/f);for(const b of c){const g=j(b.pitch);if(g==null)continue;const p=b.start/a*n,v=Math.max(1,b.duration/a*n),S=(g-u)/f,_=r-S*r-y/2;t.fillRect(p,_,v,y)}}}function rd(i,e){Hr(i,e)}function zr(){const i=document.getElementById("global-mini-contour");if(!i)return;const e=z();Hr(i,e)}function nd(i,e,t,s=!0){const n=i.getInteractionStore();let r=new Set;if(s){const o=n.getSelectedNotes();r=new Set(o.map(c=>`${c.pitch}:${c.start}:${c.duration}:${c.velocity}`))}if(i.setNotes(structuredClone(e)),i.getNoteManager().rebuildIndex(),s&&r.size>0){const o=i.notes.filter(c=>r.has(`${c.pitch}:${c.start}:${c.duration}:${c.velocity}`));n.setSelectedNotes(o)}const a=J.getInstance();if(a!=null&&a.isActive()){const o=a.getStartTime(),c=a.getStartBeat();t.reschedulePlayback(o,c)}i.requestRedraw()}function ad(i,e){return i!==void 0&&e!==void 0&&i===e}function od(i=$()){var n;Pi(i.tempo,!1),Di(i.timeSignature[0],!1),Ui(i.totalMeasures,!1);const e=z();for(const r of e)r.updateTotalMeasures();const t=document.getElementById("sequencers-container");if(!t){console.error("resyncFromState: Missing #sequencers-container");return}console.log("State.sequencers length is: ",i.sequencers.length);for(const r of i.sequencers){const a=e.find(o=>ad(o.id,r.id));if(console.log("Live sequencer ID: and serialized ID: ",a==null?void 0:a.id,r.id),a){a.instrumentName=r.instrument,typeof r.volume=="number"&&(a.volume=r.volume),typeof r.pan=="number"&&(a.pan=r.pan);const o=(n=a.container)==null?void 0:n.querySelector("canvas.mini-contour");o&&It(o,r.notes,a.config,a.colorIndex),a.matrix&&nd(a.matrix,r.notes,a,!0)}else{const o={id:r.id,instrument:r.instrument,notes:structuredClone(r.notes),volume:r.volume,pan:r.pan,collapsed:r.collapsed};console.log("No sequencer found, creating one with ID: ",r.id),Ir(t,o)}}document.getElementById("global-mini-contour")&&zr()}const Jr="userConfig";function ld(){const i=W();Et(Jr,i)}function cd(){const i=dt(Jr);i&&fe(i)}function dd(i,e=[],t="w-[1276px]"){const s=i.id||"bottom-drawer",n=i.ariaLabel||"Bottom drawer",r=i.edgeOffsetClass||"bottom-[60px]",a=i.drawerClassOverride||"",o=t.toString(),c=U(),d=m("div",{id:s,class:["fixed bottom-0 left-1/2 translate-x-[-50%] z-40",o,"overflow-y-auto","rounded-t-lg",c.menuBackground,c.textColor,"transition-transform","translate-y-0","border-t border-gray-200 dark:border-gray-700 pb-[20px]",r,a].join(" "),"aria-labelledby":`${s}-label`,"data-drawer-placement":"bottom","data-drawer-edge":"true","data-drawer-edge-offset":r}),l=m("div",{class:[i.toggleHandleHeightClass,"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"].join(" ")},m("span",{class:"absolute w-8 h-1 -translate-x-1/2 bg-gray-300 rounded-lg top-3 left-1/2 dark:bg-gray-600"}),m("h5",{id:`${s}-label`,class:"inline-flex items-center text-base text-gray-500 dark:text-gray-400 font-medium"},n));d.appendChild(l),e.forEach(h=>d.appendChild(h));const u=new yn(d,{placement:"bottom",edge:!0,edgeOffset:r,backdrop:!1,bodyScrolling:!0},{id:s,override:!0});return u.show(),l.addEventListener("click",()=>{u.toggle()}),d}const ud="w-[1260px]",ri=1100,hd=[{value:"4",label:"𝅝",title:"Whole"},{value:"2",label:"𝅗𝅥",title:"Half"},{value:"1",label:"𝅘𝅥",title:"Quarter"},{value:"0.5",label:"♪",title:"Eighth"},{value:"0.25",label:"♬",title:"Sixteenth"},{value:"0.125",label:"𝅘𝅥𝅰",title:"32nd"}];class fd{constructor(){this.globalPlayheadRow=m("div",{id:"global-playhead-row",class:"w-full mb-2"}),this.globalToolsRow=m("div",{id:"global-tools-row",class:"w-full mb-2"}),this.globalTransportRow=m("div",{id:"global-transport-row",class:"w-full"});const e=dd({id:"global-controls-drawer",ariaLabel:" ",edgeOffsetClass:"bottom-[40px]",toggleHandleHeightClass:"py-2"},[this.globalPlayheadRow,this.globalToolsRow,this.globalTransportRow],ud);this.drawer=e;const t=document.getElementById("footer-main");t?t.appendChild(this.drawer):console.warn("footer-main container not found. GlobalControls not injected.")}render(){return this.drawer}destroy(){this.drawer.remove()}getGlobalPlayheadRow(){return this.globalPlayheadRow}getGlobalToolsRow(){return this.globalToolsRow}getGlobalTransportRow(){return this.globalTransportRow}}function St(i,e,t){const s=window.devicePixelRatio||1;i.width=e*s,i.height=t*s,i.style.width=`${e}px`,i.style.height=`${t}px`;const n=i.getContext("2d");n&&n.scale(s,s)}const pd=oe("static/svg/icon-caret-up.svg");function md(){const i=`w-[${ri}px]`,e="h-[75px]",t=m("div",{class:"relative flex justify-center w-full mt-4"}),s=m("canvas",{id:"global-mini-contour",class:`absolute top-0 left-0 ${i} ${e} z-0`}),n=m("canvas",{id:"global-mini-playhead",class:`absolute top-0 left-0 ${i} ${e} z-10`,style:"cursor: pointer;"}),r=m("div",{class:`relative ${i} ${e} bg-gray-900/80 backdrop-blur-sm shadow-md rounded-xl`},s,n);St(s,ri,75),St(n,ri,75),new ResizeObserver(()=>{const d=r.getBoundingClientRect(),l=Math.round(d.width),u=Math.round(d.height);St(s,l,u),St(n,l,u),zr()}).observe(r);const o=m("img",{id:"global-mini-collapse-icon",src:pd,class:"w-4 h-4",alt:"Expand Mini Contour"}),c=m("button",{id:"global-mini-collapse-btn",class:"absolute right-[calc(50%-600px)] bottom-0 mb-2 p-2 bg-purple-700 text-white text-sm rounded hover:bg-purple-600 transition-colors",style:"cursor: pointer;",title:"Expand Mini Contour"},o);return t.appendChild(r),t.appendChild(c),m("div",{id:"globalControls-miniContour-body",class:"w-full max-w-[1260px] mx-auto"},t)}let Y=null;function yd(){return(Y==null?void 0:Y.disabled)??!1}function gd(i){Y=i}function bd(){Y&&(Y.disabled=!0,Y.classList.add("opacity-50","cursor-not-allowed"),vd())}function _d(){Y&&(Y.disabled=!1,Y.classList.remove("opacity-50","cursor-not-allowed"),Sd())}function vd(){if(!Y)return;const i=Y.querySelector("img");i&&(i.src=oe("static/svg/icon-cog.svg"),i.classList.add("img-spin"),i.alt="Generating...")}function Sd(){if(!Y)return;const i=Y.querySelector("img");i&&(i.src=oe("static/svg/icon-cursor-arrow-rays.svg"),i.classList.remove("img-spin"),i.alt="Toggle Autocomplete")}function $i(i,e=[],t={}){const s=U(),n=t.id||`popover-${Math.random().toString(36).slice(2,9)}`,r=m("div",{id:n,"data-popover":"",role:"tooltip",class:["absolute z-[9999] inline-block w-64 text-sm transition-opacity duration-300","border rounded-lg shadow-xs opacity-0 invisible",s.menuBackground,s.textColor,s.borderColor,"bg-white dark:bg-gray-800"].join(" ")});if(t.title){const u=m("div",{class:["px-3 py-2 border-b rounded-t-lg","bg-gray-100 dark:bg-gray-700","border-gray-200 dark:border-gray-600"].join(" ")},m("h3",{class:"font-semibold text-gray-900 dark:text-white",textContent:t.title}));r.appendChild(u)}const a=m("div",{class:"px-3 py-2"},...e);r.appendChild(a),document.body.appendChild(r);const o={placement:t.placement||"bottom",triggerType:t.triggerType||"click",offset:t.offset??10,onShow:t.onShow??(()=>{}),onHide:t.onHide??(()=>{}),onToggle:t.onToggle??(()=>{})},c={id:n,override:t.overrideInstance??!0},d=new gn(r,i,o,c);let l=null;return d.updateOnShow(()=>{var u;l=h=>{(h.key==="Escape"||h.key.length===1)&&d.hide()},document.addEventListener("keydown",l,{once:!0}),(u=o.onShow)==null||u.call(o,d)}),d.updateOnHide(()=>{var u;l&&(document.removeEventListener("keydown",l),l=null),(u=o.onHide)==null||u.call(o,d)}),{trigger:i,content:r,instance:d}}const Cd=[{id:"velocity-tool",label:"Velocity Tool",iconName:"icon-cog",hotkey:"V"},{id:"quantize-tool",label:"Quantize Tool",iconName:"icon-cog",hotkey:"Q",disabled:!0},{id:"transpose-tool",label:"Transpose Tool",iconName:"icon-cog",hotkey:"T",disabled:!0},{id:"chordifier",label:"Chordifier",iconName:"icon-adjustments-vertical",hotkey:"Shift+C",disabled:!0},{id:"humanizer",label:"Humanizer",iconName:"icon-adjustments-vertical",hotkey:"Shift+H",disabled:!0}];function Nd(){const i=U(),e=m("button",{id:"note-editing-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Tools"},I("icon-chart-bar","Editing"));let t;const s=[m("div",{class:"max-h-72 overflow-y-auto flex flex-col gap-1"},...Cd.flatMap((a,o)=>{const c=o===2,d=m("button",{class:["flex items-center justify-between gap-2 px-3 py-2 text-sm rounded text-left transition-colors",a.disabled?"text-gray-500 bg-gray-700/30 cursor-not-allowed opacity-50":"text-white hover:bg-purple-700 cursor-pointer"].join(" "),...a.disabled?{}:{onClick:()=>{const l=new CustomEvent("editor-invoke",{detail:{editorId:a.id},bubbles:!0});e.dispatchEvent(l),requestAnimationFrame(()=>{t==null||t.hide()})}}},m("div",{class:"flex items-center gap-2"},I(a.iconName,a.label),m("span",{textContent:a.label})),a.hotkey?m("span",{class:"text-xs text-gray-400 font-mono",textContent:a.hotkey}):null);return c?[d,m("div",{class:`my-2 border-t ${i.borderColor} mx-2`})]:[d]}))];t=$i(e,s,{title:"Tools",placement:"bottom",triggerType:"click"}).instance;let r=null;return t.updateOnShow(()=>{r=a=>{(a.key==="Escape"||a.key.length===1)&&(t==null||t.hide())},document.addEventListener("keydown",r,{once:!0})}),t.updateOnHide(()=>{r&&(document.removeEventListener("keydown",r),r=null)}),e}function Fe(i){const e=U();return m("span",{class:`font-semibold ${e.accentColor} rounded text-xs`,textContent:i})}function Q(...i){const e=U();return m("p",{class:`text-sm leading-relaxed ${e.textColor}`},...i)}function Ue(i,e="?",t){const s=U(),n=m("span",{"data-tooltip-target":i,tabIndex:-1,class:[`${s.textColor} border border-white/40`,"hover:bg-white/10","font-medium rounded-full text-xs px-2 py-[2px]","pointer-events-auto select-none","cursor-default","focus:outline-none focus:ring-0","aria-hidden"].join(" ")},e),r=Array.isArray(t)?t.map(o=>typeof o=="string"?Q(o):o):[typeof t=="string"?Q(t):t],a=m("div",{id:i,role:"tooltip",class:["absolute z-10 invisible inline-block max-w-xs px-4 py-3 text-sm",`${s.textColor} transition-opacity duration-300 ${s.surfaceBackground} rounded-lg shadow-xs`,"opacity-0 tooltip"].join(" ")},m("div",{class:"space-y-2"},...r),m("div",{class:"tooltip-arrow","data-popper-arrow":""}));return{trigger:n,tooltip:a}}function wd(){const i=U(),e=m("button",{id:"note-placement-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",title:"Grid Settings",style:"cursor: pointer;"},I("icon-music","Placement")),t=Ue("tooltip-grid-guides","?",[Q(Fe("Key Grid Highlighting:")," colors each piano roll row based on the current song key."),Q("In-key notes are shown as white rows. Out-of-key notes are shown as black rows.")]),s=Ee({id:"toggle-grid-guides",stateA:"Off",stateB:"Transpose Grid to Key",inline:!0,tooltipTrigger:t.trigger});s.input.addEventListener("change",()=>{Qa(s.getChecked())});const n=Ue("tooltip-snap-to-key","?",[Q(Fe("Snap to Key:")," constrains vertical note placement to notes in the current key."),Q("Hold ",Fe("CTRL")," while placing notes to temporarily allow chromatic input.")]),r=Ee({id:"toggle-snap-key",stateA:"Off",stateB:"Snap Notes to Key",inline:!0,tooltipTrigger:n.trigger});r.input.addEventListener("change",()=>{to(r.getChecked())});const a=Ue("tooltip-snap-to-grid","?",[Q(Fe("Snap to Grid:")," constrains horizontal note placement to musical durations."),Q("Notes will align to the selected beat value (e.g. quarter, eighth, sixteenth).")]),o=Ee({id:"toggle-snap-grid",stateA:"Off",stateB:"Snap Notes to Grid",inline:!0,tooltipTrigger:a.trigger});o.input.addEventListener("change",()=>{eo(o.getChecked())});const c=()=>{s.setChecked(ur()),r.setChecked(At()),o.setChecked(hr())},d=[m("div",{class:"mb-1"},s.element),t.tooltip,m("div",{class:`my-2 border-t ${i.borderColor} mb-3 mx-2`}),m("div",{class:"mb-1"},r.element),n.tooltip,m("div",{class:"mt-1"},o.element),a.tooltip];return $i(e,d,{title:"Grid Settings",placement:"bottom",triggerType:"click",onShow:()=>requestAnimationFrame(c)}),{trigger:e,refreshToggles:c}}function Md(){const i=wd(),e=m("div",{class:"flex flex-wrap justify-center items-center gap-4 p-4"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},m("button",{id:"note-mode-btn",class:"bg-blue-600 px-3 py-1 rounded text-white hover:bg-blue-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Drawing Toolbar (Q)"},I("icon-pen","Note Mode")),m("button",{id:"ai-mode-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"AI Toolbar (W)"},I("icon-brain-white","AI Mode")))),t=m("div",{class:"flex gap-4"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},i.trigger,Nd()),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},...hd.map((r,a)=>m("button",{class:["bg-transparent hover:bg-gray-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl","w-[52px] h-[42px] flex items-center justify-center"].join(" "),"data-value":r.value,title:`${r.title} (${a+1} or Shift+${a+1})`},r.label))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"dotted-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Dotted Note (.)"},"•"),m("button",{id:"triplet-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Triplet (/)"},"³"))),s=m("button",{id:"autocomplete-toggle-btn",class:"bg-transparent hover:bg-purple-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Autocomplete (G/Shift+G)"},I("icon-cursor-arrow-rays","Toggle Autocomplete"));gd(s);const n=m("div",{class:"flex gap-4 hidden"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-tools-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Tools"},I("icon-chip","AI Tools"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},s,m("button",{id:"autocomplete-approve-btn",class:"bg-transparent hover:bg-green-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"Approve (Tab)"},I("icon-thumbs-up","Approve Autocomplete"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-extend-before-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Extend Before (SHIFT+1)"},I("icon-double-arrow-left","AI Extend Before")),m("button",{id:"ai-paint-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Paint Tool (SHIFT+2)"},I("icon-paint-brush","AI Paint")),m("button",{id:"ai-extend-after-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Extend After (SHIFT+3)"},I("icon-double-arrow-right","AI Extend After"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-adjust-prompt-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"Adjust AI Prompt Settings"},I("icon-adjust-ai-prompt","Adjust AI Prompt")),m("button",{id:"ai-debugger-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Debugger"},I("icon-command-line","AI Debugger"))));return e.appendChild(t),e.appendChild(n),{element:e,refreshGridSettings:i.refreshToggles,noteOptionsGroup:t,aiOptionsGroup:n}}function xd(){const i=m("div",{class:"fixed left-[calc(50%-678px)] bottom-[20px] flex flex-col gap-2 z-[9999]"},m("button",{id:"footer-help-btn",class:"side-button side-button-info",title:"Help / Documentation"},I("icon-lightbulb","Help")),m("button",{id:"footer-whats-new-btn",class:"side-button side-button-info",title:"What's New / Release Notes"},I("icon-circle-plus","What's New")));return document.body.appendChild(i),i}function Ss(){const i=U();return m("div",{class:["h-12 w-px",i.accentColor,"shadow-inner","rounded-full"].join(" ")})}function Oe(i,e,t,s,n){return m("button",{id:i,title:e,class:["w-12 h-12 flex items-center justify-center rounded-full cursor-pointer shadow transition-all hover:scale-110","text-white",s,n].join(" ")},t)}function ni(i){const{id:e,value:t,min:s,max:n,onInput:r}=i,a=U();return m("input",{id:e,type:"number",value:String(t),min:s==null?void 0:s.toString(),max:n==null?void 0:n.toString(),class:["w-[72px] h-[40px] px-2 rounded text-sm font-semibold",a.surfaceBackground,a.textColor,a.borderColor].join(" "),oninput:r})}function Ve(i="4"){return m("div",{class:`inline-block w-${i}`})}function Ld(){const i=U();return m("div",{class:["w-full h-px",i.accentColor,"shadow-inner","rounded-full","my-2"].join(" ")})}const kd=["C","D","E","F","G","A","B"],Gd=["C#","D#","","F#","G#","A#",""];function Bd(){return Ki()??"CM"}function ai(i){const e=i.endsWith("m")?"m":"M";return[i.slice(0,i.length-1),e]}function Ed(){U();let[i,e]=ai(Bd());const t=K({id:"key-selector-trigger",text:`${i}${e}`,kind:"secondary",additionalClasses:"w-14 px-2 py-[10px] text-center truncate"}),s=(l,u)=>{if(l==="")return;i=l,e=u;const h=`${l}${u}`;Dr(h),t.textContent=h,c()},n=m("div",{class:"flex w-full mt-2 gap-[6px]"},...kd.map(l=>m("button",{class:oi(l,i),onClick:()=>s(l,e)},l))),r=m("div",{class:"flex w-full mb-1 gap-[6px] translate-x-[22px]"},...Gd.map(l=>l===""?m("div",{class:"w-8"}):m("button",{class:oi(l,i),onClick:()=>s(l,e)},l))),a=Ee({id:"key-mode-toggle",stateA:"Major",stateB:"Minor",inline:!0});a.setChecked(e==="m"),a.input.addEventListener("change",()=>{const l=a.getChecked()?"m":"M";s(i,l)});const o=[r,n,Ld(),a.element],c=()=>{[...n.children,...r.children].forEach(u=>{if(!(u instanceof HTMLButtonElement))return;const h=u.textContent||"";u.className=oi(h,i)}),a.setChecked(e==="m")};return $i(t,o,{title:"Key Selector",placement:"bottom",triggerType:"click"}),Dt(l=>{const[u,h]=ai(l.songKey);i=u,e=h,t.textContent=l.songKey,c()}),{trigger:t,refreshUI:()=>{const[l,u]=ai(Ki());i=l,e=u,t.textContent=`${l}${u}`,c()}}}function oi(i,e){return["w-8 h-8 rounded-full text-xs flex items-center justify-center","transition-all duration-150","cursor-pointer focus:outline-none","text-white",i===e?"bg-cyan-600 ring-2 ring-white":"bg-gray-600 hover:bg-gray-500 hover:ring-1 hover:ring-white"].join(" ")}function Ad(){const i=Ee({id:"loop-toggle",stateB:"Loop",inline:!0}),e=Ed();return{element:m("div",{class:"flex justify-center items-center gap-4 flex-wrap"},m("div",{class:"flex items-center gap-2"},Oe("play-button","Play/Pause",I("icon-play","Play"),"bg-blue-600","hover:bg-blue-700"),Oe("stop-button","Stop",I("icon-stop","Stop"),"bg-blue-600","hover:bg-blue-700"),Ve("4"),Oe("record-button","Record",I("icon-record","Record"),"bg-red-600","hover:bg-red-700"),Ve("4"),i.element,Ve("4"),Ss()),m("div",{class:"flex items-center gap-4 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("div",{class:"flex flex-col items-start gap-1"},ee("Key"),e.trigger),m("div",{class:"flex flex-col items-start gap-1"},ee("Tempo"),ni({id:"tempo-input",min:20,max:300,value:120})),m("div",{class:"flex flex-col items-start gap-1"},ee("Measures"),ni({id:"measures-input",min:1,max:1e3,value:8})),m("div",{class:"flex flex-col items-start gap-1"},ee("Beats"),ni({id:"beats-per-measure-input",min:1,max:16,value:4}))),Ss(),m("div",{class:"flex items-center gap-2"},Ve("4"),Oe("save-button","Save",I("icon-save","Save"),"bg-green-600","hover:bg-green-700"),Oe("load-button","Load",I("icon-load","Load"),"bg-yellow-600","hover:bg-yellow-700"),Ve("4"),Oe("config-button","User Settings",I("icon-user-settings","Settings"),"bg-purple-600","hover:bg-purple-700"))),refreshToggles:()=>{e.refreshUI()}}}const Td=oe("static/svg/icon-caret-up.svg"),Id=oe("static/svg/icon-caret-down.svg");function Rd(i){var d;const e=()=>{},t=(d=i.querySelector("#global-mini-contour"))==null?void 0:d.parentElement,s=i.querySelector("#global-mini-collapse-btn"),n=i.querySelector("#global-mini-collapse-icon"),r=300,a=75;let o=!0;const c=()=>{if(!t||!s||!n)return;o=!o,t.style.height=o?`${a}px`:`${r}px`,t.querySelectorAll("canvas").forEach(u=>{u.style.height=o?`${a}px`:`${r}px`}),n.src=o?Td:Id,s.title=o?"Expand Mini Contour":"Collapse Mini Contour"};return s==null||s.addEventListener("click",c),{detach:()=>{s==null||s.removeEventListener("click",c)},refreshUI:e}}function Cs(i,e={}){const{beatsPerBar:t=4,stepsPerBeat:s=4,quantizeDurations:n=!0,ignoreVelocity:r=!1}=e,a=[],o=[...i].sort((d,l)=>d.start-l.start);let c=-1;for(const d of o){const l=Math.floor(d.start/t),u=d.start%t,h=Math.round(u*s);l!==c&&(a.push({type:"Bar",value:l}),c=l),a.push({type:"Position",value:h}),a.push({type:"Pitch",value:d.pitch});const f=n?Math.max(1,Math.round(d.duration*s)):d.duration;if(a.push({type:"Duration",value:f}),!r){const y=d.velocity??100;a.push({type:"Velocity",value:y})}}return a}function Od(i,e={}){const{beatsPerBar:t=4,stepsPerBeat:s=4,quantizeDurations:n=!0,ignoreVelocity:r=!1}=e;let a=0,o=0,c=!1;const d=[];for(let l=0;l<i.length;l++){const u=i[l];switch(u.type){case"Bar":a=u.value;break;case"Position":o=u.value,c=!0;break;case"Pitch":{if(!c){T(`REMI decode: Pitch token at index ${l} has no preceding Position`,u,"warn");continue}const h=i[l+1],f=p=>typeof p=="number"&&!Number.isNaN(p)&&Number.isFinite(p);if(!h||h.type!=="Duration"||!f(h.value)){T(`REMI decode: Missing or invalid Duration token after Pitch at index ${l}`,{pitchToken:u,durationToken:h},"warn");continue}let y=100;if(!r){const p=i[l+2];if(!p||p.type!=="Velocity"||!f(p.value)){T(`REMI decode: Missing or invalid Velocity token after Duration at index ${l}`,{pitchToken:u,velocityToken:p},"warn");continue}y=p.value}const b=a*t+o/s,g=n?h.value/s:h.value;d.push({pitch:u.value,start:b,duration:g,velocity:y}),c=!1,l+=r?1:2;break}}}return d}function Fd(i,e,t,s,n){const r=l=>l.start>=t&&l.start<s,a=e.find(l=>l.id===i);if(!a)throw new Error(`Sequencer with id ${i} not found.`);const o=a.notes.filter(r),c=Cs(o,n),d=e.filter(l=>l.id!==i).map(l=>{const u=l.notes.filter(r);return Cs(u,n)});return T("[AutoComplete] Extracted Context:",{primaryTrackRemi:c,otherTracksRemi:d,startBeat:t,endBeat:s}),{primaryTrackRemi:c,otherTracksRemi:d,startBeat:t,endBeat:s}}function Pd(i,e,t){const s=[];let n=0,r=null,a=!1;T("[AutoComplete] Clipping LLM Continuation:",{llmContinuationRemi:i,clipAfterBar:e,clipAfterPosition:t});for(const o of i){if(o.type==="Bar"){r=o,n=o.value;continue}if(o.type==="Position"){a=n>e||n===e&&o.value>=t,a&&(r&&(s.push(r),r=null),s.push(o));continue}a&&s.push(o)}return T("[AutoComplete] Clipped LLM Continuation:",s),s}function Dd(i,e,t){const s=e*t,n=[];let r=0;for(const a of i){if(a.type==="Bar"){r=a.value,n.push(a);continue}if(a.type==="Position"){const o=a.value,c=Math.floor(o/s),d=o%s,l=r+c,u=n[n.length-1];(!u||u.type!=="Bar"||u.value!==l)&&n.push({type:"Bar",value:l}),n.push({type:"Position",value:d})}else n.push(a)}return n}const Ud="llmSettings",qd={promptTuning:{styleInstruction:"",additionalInstructions:"",avoidStyles:""},context:{useMultiTrackContext:!0,contextBeats:32}};let Kd=dt(Ud)??qd;function _i(){return Kd}function jr(){return{beatsPerBar:Te(),stepsPerBeat:4,quantizeDurations:!0,ignoreVelocity:!0}}function Wr(i){const t=_i().context.contextBeats,s=i.notes;if(s.length===0)return[0,t];const n=s.reduce((c,d)=>{const l=c.start+c.duration;return d.start+d.duration>l?d:c}),r=n.start+n.duration,a=Math.ceil(r);return[Math.max(0,a-t),a]}function $d(i,e,t){const s=Math.floor(i/e),n=Math.round(i%e*t);return T("[AutoComplete] Computed Clip Boundary:",{endBeat:i,beatsPerBar:e,stepsPerBeat:t,clipAfterBar:s,clipAfterPosition:n}),{clipAfterBar:s,clipAfterPosition:n}}function Hd(i){const[,e]=Wr(i),t=jr(),s=(t==null?void 0:t.beatsPerBar)??4;return Math.floor(e/s)}function zd(i){if(!i||typeof i!="string"||!i.trim())return"Unknown Key";const e=i.trim();if(e.length===1)return`${e.toUpperCase()} Major`;const t=e.slice(-1),s=e.slice(0,-1);return s?t==="m"?`${s.toUpperCase()} Minor`:`${s.toUpperCase()} Major`:"Unknown Key"}class Jd{logPrompt(e){T(`[${this.name}] Generated Prompt:`,e)}}class jd extends Jd{constructor(){super(...arguments),this.name="Remi Autocomplete Prompt"}buildPrompt(e,t){const{continuationBeats:s,llmSettings:n}=t,{styleInstruction:r}=n.promptTuning,{primaryTrackRemi:a,otherTracksRemi:o}=e,c=f=>f.map(y=>`${y.type} ${y.value}`).join(" "),d=o.map((f,y)=>`Track ${y+1}: ${c(f)}`).join(`
`),l=`Primary Track: ${c(a)}`,h=["Song Key:",zd(Ki()),...r?["","STYLE INSTRUCTION:",r]:[],"Background Tracks Context (Can be empty):",d,"","Track to continue from:",l,"",`${s} beat PRIMARY TRACK CONTINUATION:`].join(`
`);return this.logPrompt(h),h}}const Wd=Ge.object({type:Ge.enum(["Bar","Position","Pitch","Duration","Velocity"],{description:"The REMI token type"}),value:Ge.union([Ge.string(),Ge.number()],{description:"The token value (Pitch is string, others are numbers)"})}),Xd=Ge.object({result:Ge.array(Wd,{description:"REMI token sequence"})}),Vd={name:"remi_tokens",schema:Xd};function Yd(i){const e=[];for(const n of i){const r=n.trim();if(r.includes("_")){const d=eu(r);if(d.length>0){e.push(...d);continue}}if(r.includes("|")){const d=Qd(r);if(d.length>0){e.push(...d);continue}}const a=Zd(n);if(a.length>0){e.push(...a);continue}const o=r.match(/^([A-Za-z]+)=(.+)$/);if(o){const[,d,l]=o;e.push(`${d.trim()} ${l.trim()}`);continue}const c=r.match(/^([A-Ga-g])[:](\d)$/);if(c){const[,d,l]=c;e.push(`Pitch ${d.toUpperCase()}${l}`);continue}if(r.includes(":")){const d=r.split(":");if(d.length===2&&d[0]&&d[1]){e.push(`${d[0].trim()} ${d[1].trim()}`);continue}}if(n.match(/(Bar_|Position_|Pitch_|Duration_|Velocity_|Pos_|Vel_|Dur_)/i)){const d=n.split(/(?=Bar_|Position_|Pitch_|Duration_|Velocity_|Pos_|Vel_|Dur_)/i);e.push(...d.map(l=>l.replace(/_/g," ").trim()).filter(Boolean));continue}if(n.match(/(Bar\s|Position\s|Pitch\s|Duration\s|Velocity\s|Pos\s|Vel\s|Dur\s)/i)&&n.split(" ").length>2){const d=n.split(/(?=Bar\s|Position\s|Pitch\s|Duration\s|Velocity\s|Pos\s|Vel\s|Dur\s)/i);e.push(...d.map(l=>l.trim()).filter(Boolean));continue}e.push(r)}const t={pos:"Position",vel:"Velocity",dur:"Duration"},s=[];for(let n=0;n<e.length;n++){const r=e[n],a=r.match(/^(pos|vel|dur|bar|position|pitch|duration|velocity)\s+(.+)$/i);if(a){const[,h,f]=a,y=t[h.toLowerCase()]||null,b=y||h[0].toUpperCase()+h.slice(1).toLowerCase();s.push(`${b} ${f}`);continue}const o=r,c=e[n+1],d=t[o.toLowerCase()]||null,l=o.match(/^(bar|position|pitch|duration|velocity)$/i),u=d||(l?l[0][0].toUpperCase()+l[0].slice(1).toLowerCase():null);if(u&&c!==void 0){s.push(`${u} ${c}`),n++;continue}s.push(r)}return s}function Zd(i){const e=[],t=i.trim(),s=t.match(/^([\d\.]+),(\d+),(\d+)/);if(s){const[,r,a,o]=s,c=Math.round(Number(r)*16);e.push(`Position ${c}`),e.push(`Velocity ${a}`),e.push(`Duration ${o}`)}const n=t.split("//");if(n.length>1){const a=n[1].trim().split(",").map(o=>o.trim()).filter(Boolean);e.push(...a)}return e}function Qd(i){const e=[],t=i.split("|").map(s=>s.trim()).filter(Boolean);for(let s=0;s<t.length;s+=2){const n=t[s],r=t[s+1];r&&(n.toLowerCase()==="track_info"||n.toLowerCase()==="inst"||e.push(`${n} ${r}`))}return e}function eu(i){const e=[],t=["bar","position","pos","pitch","duration","dur","velocity","vel"],s=i.split("_").filter(Boolean);for(let n=0;n<s.length-1;n++){const r=s[n].toLowerCase(),a=s[n+1];t.includes(r)&&(e.push(`${r} ${a}`),n++)}return e}function tu(i){const e=Array.isArray(i)?i:i.split(/\s*[\n,]\s*/).filter(Boolean),t=[],s=Yd(e);for(const n of s){const r=n.match(/^(\w+)\s+(.+)$/);if(!r){if(/^\d+$/.test(n)){t.push({type:"Duration",value:Number(n)});continue}console.warn(`Invalid REMI token format: '${n}'`);continue}const[,a,o]=r;let c=a.charAt(0).toUpperCase()+a.slice(1).toLowerCase();if(!["Key","Inst","Tempo","Start","End"].includes(c))switch(c==="Note"&&(c="Pitch"),c){case"Bar":case"Position":case"Duration":case"Velocity":{const d=Number(o);if(isNaN(d)){console.warn(`Invalid numeric value in REMI token: '${n}'`);continue}t.push({type:c,value:d});break}case"Pitch":t.push({type:c,value:o});break;default:console.warn(`Unknown REMI token type: '${c}' in token '${n}'`);break}}return T("[RemiTokenParser] Parsed RemiEvents:",t),t}const Xr={parse(i){if(!i)throw new Error("REMI parse failed: result is null or undefined.");if(Array.isArray(i))return i;if(typeof i=="string")return tu(i);throw new Error(`Unsupported REMI result type: ${typeof i}`)}},iu={provider:"openai",tasks:{remi:{schema:Vd,adapter:Xr.parse},chords:{schema:void 0,adapter:i=>i}}},su={provider:"anthropic",tasks:{remi:{schema:void 0,adapter:Xr.parse},chords:{schema:void 0,adapter:i=>i}}},ru={openai:iu,anthropic:su},nu={"gpt-4o":"openai","gpt-4o-mini":"openai","gpt-4.1":"openai","o3-mini":"openai","o4-mini":"openai","claude-3":"anthropic","claude-3-opus":"anthropic","mistral-7b":"local","gemini-1.5":"google"},au=Symbol("Let zodToJsonSchema decide on which parser to use"),Ns={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ou=i=>typeof i=="string"?{...Ns,basePath:["#"],definitions:{},name:i}:{...Ns,basePath:["#"],definitions:{},...i},vi=i=>"_def"in i?i._def:i;function lu(i){if(!i)return!0;for(const e in i)return!1;return!0}const cu=i=>{const e=ou(i),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([s,n])=>[vi(n),{def:vi(n),path:[...e.basePath,e.definitionPath,s],jsonSchema:void 0}]))}};function Vr(i,e,t,s){s!=null&&s.errorMessages&&t&&(i.errorMessage={...i.errorMessage,[e]:t})}function D(i,e,t,s,n){i[e]=t,Vr(i,e,s,n)}function du(){return{}}function uu(i,e){var s,n;const t={type:"array"};return((n=(s=i.type)==null?void 0:s._def)==null?void 0:n.typeName)!==A.ZodAny&&(t.items=F(i.type._def,{...e,currentPath:[...e.currentPath,"items"]})),i.minLength&&D(t,"minItems",i.minLength.value,i.minLength.message,e),i.maxLength&&D(t,"maxItems",i.maxLength.value,i.maxLength.message,e),i.exactLength&&(D(t,"minItems",i.exactLength.value,i.exactLength.message,e),D(t,"maxItems",i.exactLength.value,i.exactLength.message,e)),t}function hu(i,e){const t={type:"integer",format:"int64"};if(!i.checks)return t;for(const s of i.checks)switch(s.kind){case"min":e.target==="jsonSchema7"?s.inclusive?D(t,"minimum",s.value,s.message,e):D(t,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(t.exclusiveMinimum=!0),D(t,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?D(t,"maximum",s.value,s.message,e):D(t,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(t.exclusiveMaximum=!0),D(t,"maximum",s.value,s.message,e));break;case"multipleOf":D(t,"multipleOf",s.value,s.message,e);break}return t}function fu(){return{type:"boolean"}}function pu(i,e){return F(i.type._def,e)}const mu=(i,e)=>F(i.innerType._def,e);function Yr(i,e,t){const s=t??e.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((n,r)=>Yr(i,e,n))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return yu(i,e)}}const yu=(i,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const s of i.checks)switch(s.kind){case"min":D(t,"minimum",s.value,s.message,e);break;case"max":D(t,"maximum",s.value,s.message,e);break}return t};function gu(i,e){return{...F(i.innerType._def,e),default:i.defaultValue()}}function bu(i,e,t){return e.effectStrategy==="input"?F(i.schema._def,e,t):{}}function _u(i){return{type:"string",enum:[...i.values]}}const vu=i=>"type"in i&&i.type==="string"?!1:"allOf"in i;function Su(i,e){const t=[F(i.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),F(i.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(r=>!!r);let s=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const n=[];return t.forEach(r=>{if(vu(r))n.push(...r.allOf),r.unevaluatedProperties===void 0&&(s=void 0);else{let a=r;if("additionalProperties"in r&&r.additionalProperties===!1){const{additionalProperties:o,...c}=r;a=c}else s=void 0;n.push(a)}}),n.length?{allOf:n,...s}:void 0}function Cu(i,e){const t=typeof i.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(i.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[i.value]}:{type:t==="bigint"?"integer":t,const:i.value}}let li;const ke={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(li===void 0&&(li=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),li),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function Zr(i,e){const t={type:"string"};function s(n){return e.patternStrategy==="escape"?Nu(n):n}if(i.checks)for(const n of i.checks)switch(n.kind){case"min":D(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e);break;case"max":D(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"email":switch(e.emailStrategy){case"format:email":se(t,"email",n.message,e);break;case"format:idn-email":se(t,"idn-email",n.message,e);break;case"pattern:zod":re(t,ke.email,n.message,e);break}break;case"url":se(t,"uri",n.message,e);break;case"uuid":se(t,"uuid",n.message,e);break;case"regex":re(t,n.regex,n.message,e);break;case"cuid":re(t,ke.cuid,n.message,e);break;case"cuid2":re(t,ke.cuid2,n.message,e);break;case"startsWith":re(t,RegExp(`^${s(n.value)}`),n.message,e);break;case"endsWith":re(t,RegExp(`${s(n.value)}$`),n.message,e);break;case"datetime":se(t,"date-time",n.message,e);break;case"date":se(t,"date",n.message,e);break;case"time":se(t,"time",n.message,e);break;case"duration":se(t,"duration",n.message,e);break;case"length":D(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,n.value):n.value,n.message,e),D(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,n.value):n.value,n.message,e);break;case"includes":{re(t,RegExp(s(n.value)),n.message,e);break}case"ip":{n.version!=="v6"&&se(t,"ipv4",n.message,e),n.version!=="v4"&&se(t,"ipv6",n.message,e);break}case"emoji":re(t,ke.emoji,n.message,e);break;case"ulid":{re(t,ke.ulid,n.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{se(t,"binary",n.message,e);break}case"contentEncoding:base64":{D(t,"contentEncoding","base64",n.message,e);break}case"pattern:zod":{re(t,ke.base64,n.message,e);break}}break}case"nanoid":re(t,ke.nanoid,n.message,e)}return t}const Nu=i=>Array.from(i).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),se=(i,e,t,s)=>{var n;i.format||(n=i.anyOf)!=null&&n.some(r=>r.format)?(i.anyOf||(i.anyOf=[]),i.format&&(i.anyOf.push({format:i.format,...i.errorMessage&&s.errorMessages&&{errorMessage:{format:i.errorMessage.format}}}),delete i.format,i.errorMessage&&(delete i.errorMessage.format,Object.keys(i.errorMessage).length===0&&delete i.errorMessage)),i.anyOf.push({format:e,...t&&s.errorMessages&&{errorMessage:{format:t}}})):D(i,"format",e,t,s)},re=(i,e,t,s)=>{var n;i.pattern||(n=i.allOf)!=null&&n.some(r=>r.pattern)?(i.allOf||(i.allOf=[]),i.pattern&&(i.allOf.push({pattern:i.pattern,...i.errorMessage&&s.errorMessages&&{errorMessage:{pattern:i.errorMessage.pattern}}}),delete i.pattern,i.errorMessage&&(delete i.errorMessage.pattern,Object.keys(i.errorMessage).length===0&&delete i.errorMessage)),i.allOf.push({pattern:ws(e,s),...t&&s.errorMessages&&{errorMessage:{pattern:t}}})):D(i,"pattern",ws(e,s),t,s)},ws=(i,e)=>{var d;const t=typeof i=="function"?i():i;if(!e.applyRegexFlags||!t.flags)return t.source;const s={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},n=s.i?t.source.toLowerCase():t.source;let r="",a=!1,o=!1,c=!1;for(let l=0;l<n.length;l++){if(a){r+=n[l],a=!1;continue}if(s.i){if(o){if(n[l].match(/[a-z]/)){c?(r+=n[l],r+=`${n[l-2]}-${n[l]}`.toUpperCase(),c=!1):n[l+1]==="-"&&((d=n[l+2])!=null&&d.match(/[a-z]/))?(r+=n[l],c=!0):r+=`${n[l]}${n[l].toUpperCase()}`;continue}}else if(n[l].match(/[a-z]/)){r+=`[${n[l]}${n[l].toUpperCase()}]`;continue}}if(s.m){if(n[l]==="^"){r+=`(^|(?<=[\r
]))`;continue}else if(n[l]==="$"){r+=`($|(?=[\r
]))`;continue}}if(s.s&&n[l]==="."){r+=o?`${n[l]}\r
`:`[${n[l]}\r
]`;continue}r+=n[l],n[l]==="\\"?a=!0:o&&n[l]==="]"?o=!1:!o&&n[l]==="["&&(o=!0)}try{const l=new RegExp(r)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return r};function Qr(i,e){var s,n,r,a;if(e.target==="openApi3"&&((s=i.keyType)==null?void 0:s._def.typeName)===A.ZodEnum)return{type:"object",required:i.keyType._def.values,properties:i.keyType._def.values.reduce((o,c)=>({...o,[c]:F(i.valueType._def,{...e,currentPath:[...e.currentPath,"properties",c]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:F(i.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((n=i.keyType)==null?void 0:n._def.typeName)===A.ZodString&&((r=i.keyType._def.checks)!=null&&r.length)){const o=Object.entries(Zr(i.keyType._def,e)).reduce((c,[d,l])=>d==="type"?c:{...c,[d]:l},{});return{...t,propertyNames:o}}else if(((a=i.keyType)==null?void 0:a._def.typeName)===A.ZodEnum)return{...t,propertyNames:{enum:i.keyType._def.values}};return t}function wu(i,e){if(e.mapStrategy==="record")return Qr(i,e);const t=F(i.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},s=F(i.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,s],minItems:2,maxItems:2}}}function Mu(i){const e=i.values,s=Object.keys(i.values).filter(r=>typeof e[e[r]]!="number").map(r=>e[r]),n=Array.from(new Set(s.map(r=>typeof r)));return{type:n.length===1?n[0]==="string"?"string":"number":["string","number"],enum:s}}function xu(){return{not:{}}}function Lu(i){return i.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Gt={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function ku(i,e){if(e.target==="openApi3")return Ms(i,e);const t=i.options instanceof Map?Array.from(i.options.values()):i.options;if(t.every(s=>s._def.typeName in Gt&&(!s._def.checks||!s._def.checks.length))){const s=t.reduce((n,r)=>{const a=Gt[r._def.typeName];return a&&!n.includes(a)?[...n,a]:n},[]);return{type:s.length>1?s:s[0]}}else if(t.every(s=>s._def.typeName==="ZodLiteral"&&!s.description)){const s=t.reduce((n,r)=>{const a=typeof r._def.value;switch(a){case"string":case"number":case"boolean":return[...n,a];case"bigint":return[...n,"integer"];case"object":if(r._def.value===null)return[...n,"null"];case"symbol":case"undefined":case"function":default:return n}},[]);if(s.length===t.length){const n=s.filter((r,a,o)=>o.indexOf(r)===a);return{type:n.length>1?n:n[0],enum:t.reduce((r,a)=>r.includes(a._def.value)?r:[...r,a._def.value],[])}}}else if(t.every(s=>s._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((s,n)=>[...s,...n._def.values.filter(r=>!s.includes(r))],[])};return Ms(i,e)}const Ms=(i,e)=>{const t=(i.options instanceof Map?Array.from(i.options.values()):i.options).map((s,n)=>F(s._def,{...e,currentPath:[...e.currentPath,"anyOf",`${n}`]})).filter(s=>!!s&&(!e.strictUnions||typeof s=="object"&&Object.keys(s).length>0));return t.length?{anyOf:t}:void 0};function Gu(i,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(i.innerType._def.typeName)&&(!i.innerType._def.checks||!i.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:Gt[i.innerType._def.typeName],nullable:!0}:{type:[Gt[i.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const s=F(i.innerType._def,{...e,currentPath:[...e.currentPath]});return s&&"$ref"in s?{allOf:[s],nullable:!0}:s&&{...s,nullable:!0}}const t=F(i.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Bu(i,e){const t={type:"number"};if(!i.checks)return t;for(const s of i.checks)switch(s.kind){case"int":t.type="integer",Vr(t,"type",s.message,e);break;case"min":e.target==="jsonSchema7"?s.inclusive?D(t,"minimum",s.value,s.message,e):D(t,"exclusiveMinimum",s.value,s.message,e):(s.inclusive||(t.exclusiveMinimum=!0),D(t,"minimum",s.value,s.message,e));break;case"max":e.target==="jsonSchema7"?s.inclusive?D(t,"maximum",s.value,s.message,e):D(t,"exclusiveMaximum",s.value,s.message,e):(s.inclusive||(t.exclusiveMaximum=!0),D(t,"maximum",s.value,s.message,e));break;case"multipleOf":D(t,"multipleOf",s.value,s.message,e);break}return t}function Eu(i,e){return e.removeAdditionalStrategy==="strict"?i.catchall._def.typeName==="ZodNever"?i.unknownKeys!=="strict":F(i.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:i.catchall._def.typeName==="ZodNever"?i.unknownKeys==="passthrough":F(i.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function Au(i,e){const t={type:"object",...Object.entries(i.shape()).reduce((s,[n,r])=>{if(r===void 0||r._def===void 0)return s;const a=[...e.currentPath,"properties",n],o=F(r._def,{...e,currentPath:a,propertyPath:a});return o===void 0?s:(e.openaiStrictMode&&r.isOptional()&&!r.isNullable()&&console.warn(`Zod field at \`${a.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required
This will become an error in a future version of the SDK.`),{properties:{...s.properties,[n]:o},required:r.isOptional()&&!e.openaiStrictMode?s.required:[...s.required,n]})},{properties:{},required:[]}),additionalProperties:Eu(i,e)};return t.required.length||delete t.required,t}const Tu=(i,e)=>{var s;if(e.currentPath.toString()===((s=e.propertyPath)==null?void 0:s.toString()))return F(i.innerType._def,e);const t=F(i.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},Iu=(i,e)=>{if(e.pipeStrategy==="input")return F(i.in._def,e);if(e.pipeStrategy==="output")return F(i.out._def,e);const t=F(i.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),s=F(i.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,s].filter(n=>n!==void 0)}};function Ru(i,e){return F(i.type._def,e)}function Ou(i,e){const s={type:"array",uniqueItems:!0,items:F(i.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return i.minSize&&D(s,"minItems",i.minSize.value,i.minSize.message,e),i.maxSize&&D(s,"maxItems",i.maxSize.value,i.maxSize.message,e),s}function Fu(i,e){return i.rest?{type:"array",minItems:i.items.length,items:i.items.map((t,s)=>F(t._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((t,s)=>s===void 0?t:[...t,s],[]),additionalItems:F(i.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:i.items.length,maxItems:i.items.length,items:i.items.map((t,s)=>F(t._def,{...e,currentPath:[...e.currentPath,"items",`${s}`]})).reduce((t,s)=>s===void 0?t:[...t,s],[])}}function Pu(){return{not:{}}}function Du(){return{}}const Uu=(i,e)=>F(i.innerType._def,e);function F(i,e,t=!1){var a;const s=e.seen.get(i);if(e.override){const o=(a=e.override)==null?void 0:a.call(e,i,e,s,t);if(o!==au)return o}if(s&&!t){const o=qu(s,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const n={def:i,path:e.currentPath,jsonSchema:void 0};e.seen.set(i,n);const r=$u(i,i.typeName,e,t);return r&&Hu(i,e,r),n.jsonSchema=r,r}const qu=(i,e)=>{switch(e.$refStrategy){case"root":return{$ref:i.path.join("/")};case"extract-to-root":const t=i.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=i.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:Ku(e.currentPath,i.path)};case"none":case"seen":return i.path.length<e.currentPath.length&&i.path.every((s,n)=>e.currentPath[n]===s)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},Ku=(i,e)=>{let t=0;for(;t<i.length&&t<e.length&&i[t]===e[t];t++);return[(i.length-t).toString(),...e.slice(t)].join("/")},$u=(i,e,t,s)=>{switch(e){case A.ZodString:return Zr(i,t);case A.ZodNumber:return Bu(i,t);case A.ZodObject:return Au(i,t);case A.ZodBigInt:return hu(i,t);case A.ZodBoolean:return fu();case A.ZodDate:return Yr(i,t);case A.ZodUndefined:return Pu();case A.ZodNull:return Lu(t);case A.ZodArray:return uu(i,t);case A.ZodUnion:case A.ZodDiscriminatedUnion:return ku(i,t);case A.ZodIntersection:return Su(i,t);case A.ZodTuple:return Fu(i,t);case A.ZodRecord:return Qr(i,t);case A.ZodLiteral:return Cu(i,t);case A.ZodEnum:return _u(i);case A.ZodNativeEnum:return Mu(i);case A.ZodNullable:return Gu(i,t);case A.ZodOptional:return Tu(i,t);case A.ZodMap:return wu(i,t);case A.ZodSet:return Ou(i,t);case A.ZodLazy:return F(i.getter()._def,t);case A.ZodPromise:return Ru(i,t);case A.ZodNaN:case A.ZodNever:return xu();case A.ZodEffects:return bu(i,t,s);case A.ZodAny:return du();case A.ZodUnknown:return Du();case A.ZodDefault:return gu(i,t);case A.ZodBranded:return pu(i,t);case A.ZodReadonly:return Uu(i,t);case A.ZodCatch:return mu(i,t);case A.ZodPipeline:return Iu(i,t);case A.ZodFunction:case A.ZodVoid:case A.ZodSymbol:return;default:return(n=>{})()}},Hu=(i,e,t)=>(i.description&&(t.description=i.description,e.markdownDescription&&(t.markdownDescription=i.description)),t),zu=(i,e)=>{const t=cu(e),s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=F(i._def,s===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,s]},!1)??{},r=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;r!==void 0&&(n.title=r);const a=(()=>{if(lu(t.definitions))return;const c={},d=new Set;for(let l=0;l<500;l++){const u=Object.entries(t.definitions).filter(([h])=>!d.has(h));if(u.length===0)break;for(const[h,f]of u)c[h]=F(vi(f),{...t,currentPath:[...t.basePath,t.definitionPath,h]},!0)??{},d.add(h)}return c})(),o=s===void 0?a?{...n,[t.definitionPath]:a}:n:t.nameStrategy==="duplicate-ref"?{...n,...a||t.seenRefs.size?{[t.definitionPath]:{...a,...t.seenRefs.size?{[s]:n}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,s].join("/"),[t.definitionPath]:{...a,[s]:n}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function Ju(i,e){return zu(i,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function ju(i,e,t){return bn({type:"json_schema",...t,name:e,strict:!0,schema:Ju(i,{name:e})},s=>i.parse(JSON.parse(s)))}async function Wu(i,e,t){const s=Ps();if(!s)throw new Error("OpenAI API key is not set.");const r=await new _n({apiKey:s,dangerouslyAllowBrowser:!0}).responses.parse({model:e,input:[{role:"user",content:i}],text:{format:ju(t.schema,t.name)}});return T("[OpenAI] Raw Output:",r),r.output_parsed}async function Xu(i,e){return T("[Anthropic] Simulated call:",{model:e,prompt:i}),{result:[{type:"Bar",value:1},{type:"Pitch",value:"C4"},{type:"Duration",value:4}]}}function Vu(i){return typeof i=="object"&&i!==null&&"result"in i}async function Yu(i,e,t){const s=nu[i];if(!s)throw new Error(`Unknown provider for model: ${i}`);const n=ru[s],r=n.tasks[t];if(!r)throw new Error(`Provider ${n.provider} does not support task: ${t}`);let a;switch(n.provider){case"openai":if(!r.schema)throw new Error(`Task ${t} requires a schema for OpenAI models.`);a=await Wu(e,i,r.schema);break;case"anthropic":a=await Xu(e,i);break;default:throw new Error(`Provider ${n.provider} not implemented.`)}const o=Vu(a)?a.result:a;return r.adapter(o)}async function Zu(i,e){return Yu(i,e,"remi")}async function xs(i="unknown"){var a,o,c,d,l;const e=qr();if(e===null){console.warn("No active sequencer to apply autocomplete to.");return}const t=mt(e);if(!t){console.error(`Sequencer with id ${e} not found.`);return}bd(),Ai(),(a=t.matrix)==null||a.invalidateAIAutocompleteRenderer();const[s,n]=Wr(t);T(`[AutoComplete] Running autocomplete for beats ${s} to ${n} on sequencer ${e} via ${i}`);const r=Hd(t);(o=t.matrix)==null||o.setActiveAutocompleteBar(r),(c=t.matrix)==null||c.startAIAutocompleteAnimationLoop();try{await Qu(e,z(),s,n)}catch(u){console.error("Autocomplete failed:",u)}finally{_d(),rt().length===0&&(T("[AutoComplete] No preview notes generated. Stopping animation loop."),(d=t.matrix)==null||d.stopAIAutocompleteAnimationLoop()),(l=t.matrix)==null||l.setActiveAutocompleteBar(null)}}async function Qu(i,e,t,s,n="gpt-4o",r=4){const a=jr();T("[AutoComplete] Running REMI Continuation Pipeline with LLM settings:",_i());const o=Fd(i,e,t,s,a),d=new jd().buildPrompt(o,{continuationBeats:r,llmSettings:_i()}),l=a.beatsPerBar??4,u=a.stepsPerBeat??4,{clipAfterBar:h,clipAfterPosition:f}=$d(s,l,u),y=2;for(let b=1;b<=y;b++){const g=await Zu(n,d),p=Dd(g,l,u),v=Pd(p,h,f),S=Od(v,a);if(T(`[AutoComplete] Attempt ${b}: Decoded Notes:`,S),S.length>0){T("[AutoComplete] Final Decoded Notes:",S),Fo(S);const _=mt(i);_&&_.redraw();return}T(`[AutoComplete] Attempt ${b}: No new notes after clip boundary. Retrying...`)}T("[AutoComplete] All retry attempts failed to generate new continuation notes.")}function eh(i){var s,n;const e=rt();R(Ot(i,e),Ft(i,e)),Ai();const t=mt(i);t?((s=t.matrix)==null||s.stopAIAutocompleteAnimationLoop(),(n=t.matrix)==null||n.playNoteAcceptanceAnimation(e)):console.warn(`Could not stop AI animation: sequencer ${i} not found.`)}const Ls={Digit1:4,Digit2:2,Digit3:1,Digit4:.5,Digit5:.25,Digit6:.125};function th(i){const{rootElement:e,noteOptionsGroup:t,aiOptionsGroup:s}=i,n=e.querySelectorAll("button[data-value]"),r=e.querySelector("#dotted-note-btn"),a=e.querySelector("#triplet-note-btn"),o=e.querySelector("#note-mode-btn"),c=e.querySelector("#ai-mode-btn"),d=e.querySelector("#autocomplete-toggle-btn"),l=e.querySelector("#autocomplete-approve-btn"),u=e.querySelector("#autocomplete-reject-btn"),h=e.querySelector("#ai-tools-btn"),f=e.querySelector("#ai-extend-before-btn"),y=e.querySelector("#ai-paint-btn"),b=e.querySelector("#ai-extend-after-btn"),g=e.querySelector("#ai-adjust-prompt-btn"),p=e.querySelector("#ai-debugger-btn"),v=M=>{if(M==="ai"&&!Ps()){V().showOpenAIKeyNotSet();return}const x=M==="note";t.classList.toggle("hidden",!x),s.classList.toggle("hidden",x),o==null||o.classList.toggle("bg-blue-600",x),o==null||o.classList.toggle("bg-gray-800",!x),c==null||c.classList.toggle("bg-purple-700",!x),c==null||c.classList.toggle("bg-gray-800",x)};o==null||o.addEventListener("click",()=>v("note")),c==null||c.addEventListener("click",()=>v("ai")),d==null||d.addEventListener("click",M=>{M.button===0&&xs("GlobalToolbarListeners")}),d==null||d.addEventListener("contextmenu",M=>{M.preventDefault(),Yi(),console.log("Toggled Autocomplete Mode")}),l==null||l.addEventListener("click",()=>{console.log("Approved Autocompleted Notes");const M=qr();if(M===null){console.warn("No active sequencer to apply autocomplete to.");return}eh(M)}),h==null||h.addEventListener("click",()=>{V().showFeatureBlocked(),console.log("AI Tools Popover Triggered (placeholder)")}),f==null||f.addEventListener("click",()=>{V().showFeatureBlocked(),console.log("AI Extend Before Triggered (placeholder)")}),y==null||y.addEventListener("click",()=>{V().showFeatureBlocked(),console.log("AI Paint Tool Activated (placeholder)")}),b==null||b.addEventListener("click",()=>{V().showFeatureBlocked(),console.log("AI Extend After Triggered (placeholder)")}),g==null||g.addEventListener("click",()=>{V().showFeatureBlocked(),console.log("AI Prompt Settings Modal Opened (placeholder)")}),p==null||p.addEventListener("click",()=>{V().showFeatureBlocked(),console.log("AI Debugger Panel Opened (placeholder)")});const S=()=>{const M=qt(),x=Pc();n.forEach(B=>{const O=parseFloat(B.dataset.value??"-1");B.classList.remove("bg-purple-700","bg-blue-700","bg-gray-800"),B.classList.add("bg-transparent"),O===x?(B.classList.add("bg-purple-700"),B.classList.remove("bg-transparent")):O===M?(B.classList.add("bg-blue-700"),B.classList.remove("bg-transparent")):B.classList.add("bg-gray-800")})},_=Dt(M=>{S(),r==null||r.classList.toggle("bg-purple-700",M.isDottedMode),r==null||r.classList.toggle("bg-transparent",!M.isDottedMode),a==null||a.classList.toggle("bg-purple-700",M.isTripletMode),a==null||a.classList.toggle("bg-transparent",!M.isTripletMode),N(M.noteDuration,!1)}),C=Oo(M=>{d==null||d.classList.toggle("bg-pink-400",M),d==null||d.classList.toggle("bg-transparent",!M)}),N=(M,x=!0)=>{const B=bs(),O=bi();let P=M;B?P*=1.5:O&&(P*=2/3),ft.currentDuration=P,z().forEach(ie=>{var we;ie.config.currentDuration=P,(we=ie.matrix)==null||we.requestRedraw()}),Fc(M,x)},w=(M=!0)=>{const x=e.querySelector("button[data-value].bg-purple-700");if(x){const B=parseFloat(x.dataset.value);N(B,M)}},L=()=>{S()};n.forEach(M=>{M.classList.add("note-duration-btn"),M.addEventListener("click",x=>{if(x.button===0){const B=parseFloat(M.dataset.value);N(B)}}),M.addEventListener("contextmenu",x=>{x.preventDefault();const B=parseFloat(M.dataset.value);ys(B,!0)})}),a==null||a.addEventListener("click",()=>{const M=!bi();gs(M,!1),w(!1)}),r==null||r.addEventListener("click",()=>{const M=!bs();gs(!1,M),w(!1)});const G=M=>{const x=M.target;if(!(x.tagName==="INPUT"||x.tagName==="TEXTAREA"||x.isContentEditable||Be())){if(Ls.hasOwnProperty(M.code)){M.preventDefault();const B=Ls[M.code];M.shiftKey?ys(B,!0):N(B);return}if(M.key==="."){M.preventDefault(),r==null||r.click();return}if(M.key==="/"){M.preventDefault(),a==null||a.click();return}switch(M.code){case"KeyG":M.preventDefault(),M.shiftKey?(Yi(),console.log("Toggled Autocomplete Mode via Shift+G")):yd()||xs("GlobalToolbarListeners");return;case"Tab":M.preventDefault(),l==null||l.click();return;case"KeyQ":M.preventDefault(),o==null||o.click();return;case"KeyW":M.preventDefault(),c==null||c.click();return}}};return window.addEventListener("keydown",G),L(),{detach:()=>{window.removeEventListener("keydown",G),_(),C(),[o,c,d,l,u,h,f,y,b,g,p].forEach(O=>{O&&O.replaceWith(O.cloneNode(!0))}),n.forEach(O=>{const P=O.cloneNode(!0);O.replaceWith(P)});const x=r==null?void 0:r.cloneNode(!0);x&&(r!=null&&r.parentNode)&&r.parentNode.replaceChild(x,r);const B=a==null?void 0:a.cloneNode(!0);B&&(a!=null&&a.parentNode)&&a.parentNode.replaceChild(B,a)},refreshUI:L}}function ih(i,e){const t=i.querySelector("#footer-help-btn"),s=i.querySelector("#footer-whats-new-btn"),n=()=>{},r=()=>{window.open("https://github.com/alacrity-ai/sequenzia","_blank")},a=()=>{e.show()};return t==null||t.addEventListener("click",r),s==null||s.addEventListener("click",a),{detach:()=>{t==null||t.removeEventListener("click",r),s==null||s.removeEventListener("click",a)},refreshUI:n}}function sh(i,e,t,s,n){const r=i.querySelector("#play-button"),a=i.querySelector("#stop-button"),o=i.querySelector("#record-button"),c=i.querySelector("#loop-toggle"),d=i.querySelector("#tempo-input"),l=i.querySelector("#measures-input"),u=i.querySelector("#beats-per-measure-input"),h=i.querySelector("#save-button"),f=i.querySelector("#load-button"),y=i.querySelector("#config-button"),b=x=>{if(!r)return;r.classList.toggle("bg-blue-800",x),r.classList.toggle("bg-blue-600",!x);const B=x?"icon-pause":"icon-play",O=oe(`static/svg/${B}.svg`),P=r.querySelector("img");if((P==null?void 0:P.getAttribute("src"))!==O){const H=I(B,x?"Pause":"Play");P?r.replaceChild(H,P):r.appendChild(H)}},g=()=>{b(e.isPlaying())};e.setOnStopCallback(()=>{b(!1)});const p=()=>{const x=!e.isPlaying();e.toggle(),b(x)},v=()=>{e.stop(),b(!1)},S=()=>{},_=()=>{const x=d==null?void 0:d.valueAsNumber;x&&x>=20&&x<=300&&Pi(x,!0)},C=()=>{const x=l==null?void 0:l.valueAsNumber;x&&x>=1&&x<=1e3&&Ui(x,!0)},N=()=>{const x=u==null?void 0:u.valueAsNumber;x&&x>=1&&x<=16&&Di(x,!0)};Dt(x=>{d&&(d.value=String(x.tempo)),l&&(l.value=String(x.totalMeasures)),u&&(u.value=String(x.timeSignature[0]))});const w=()=>{Dc((c==null?void 0:c.checked)??!1)},L=()=>{s.show()},G=()=>{n.show()},E=()=>{t.show()},M=x=>{var P;const B=(P=document.activeElement)==null?void 0:P.tagName,O=B==="INPUT"||B==="TEXTAREA";x.key===" "&&!O&&(x.preventDefault(),x.shiftKey?v():p())};return r==null||r.addEventListener("click",p),a==null||a.addEventListener("click",v),o==null||o.addEventListener("click",S),d==null||d.addEventListener("change",_),l==null||l.addEventListener("change",C),u==null||u.addEventListener("change",N),c==null||c.addEventListener("change",w),h==null||h.addEventListener("click",L),f==null||f.addEventListener("click",G),y==null||y.addEventListener("click",E),window.addEventListener("keydown",M),{detach:()=>{r==null||r.removeEventListener("click",p),a==null||a.removeEventListener("click",v),o==null||o.removeEventListener("click",S),d==null||d.removeEventListener("change",_),l==null||l.removeEventListener("change",C),u==null||u.removeEventListener("change",N),c==null||c.removeEventListener("change",w),h==null||h.removeEventListener("click",L),f==null||f.removeEventListener("click",G),y==null||y.removeEventListener("click",E),window.removeEventListener("keydown",M)},refreshUI:g}}function en(i,e){var t;for(const s of i.sequencers){const n=s.matrix;if(!n)continue;const r=(t=n.getPixelsPerBeat)==null?void 0:t.call(n);if(!r)continue;const a=e*r;n.setPlayheadPixelX(a)}}let ge=null,et=null;function rh(i){et=i,ge=et.getContext("2d")}function Kt(i){if(!ge||!et)return;const e=window.devicePixelRatio||1,t=et.width/e,s=et.height/e;ge.clearRect(0,0,t,s);const n=Math.round(i)+.5;ge.strokeStyle="#ff00ff",ge.lineWidth=1,ge.beginPath(),ge.moveTo(n,0),ge.lineTo(n,s),ge.stroke()}function nh(i,e){const t=e.snapResolution||.25,s=e.isTripletMode?t*(2/3):t;return Math.round(i/s)*s}let Ct=!1,ne=null,ci=!1;function ah(i){if(ne=i.querySelector("#global-mini-playhead"),!ne)throw new Error("Playhead canvas not found in container.");const e=J.getInstance(),t=(c,d=!0)=>{const l=pe(),u=nh(c,ft),h=Math.max(0,Math.min(l,u)),f=e.isActive();if(e.seek(h),d&&f&&e.resume(),en(e,h),ne){const y=window.devicePixelRatio||1,b=ne.width/y,g=h/l*b;Kt(g)}},s=c=>{if(!ne)return;const d=window.devicePixelRatio||1,l=ne.getBoundingClientRect(),u=ne.width/d;let h=(c.clientX-l.left)*(u/l.width);h=Math.max(0,Math.min(u,h));const f=pe(),y=h/u*f;t(y,!1)},n=c=>{var f;const d=(f=document.activeElement)==null?void 0:f.tagName;if(d==="INPUT"||d==="TEXTAREA"||!c.shiftKey)return;const l=pe(),u=Te();let h=e.getCurrentBeat();switch(c.key.toLowerCase()){case"a":h-=1;break;case"d":h+=1;break;case"s":{const y=Math.floor(h),b=Math.floor(y/u)*u;h=y===b?Math.max(0,b-u):b;break}case"w":{const y=Math.floor(h),g=Math.floor(y/u)*u+u;h=Math.min(l,g);break}default:return}c.preventDefault(),t(h)},r=async c=>{e.isActive()&&(await e.pause(),ci=!0),Ct=!0,s(c)},a=c=>{Ct&&s(c)},o=c=>{Ct&&(s(c),Ct=!1,ci&&(e.resume(),ci=!1))};return ne.addEventListener("mousedown",c=>void r(c)),window.addEventListener("mousemove",a),window.addEventListener("mouseup",o),window.addEventListener("keydown",n),{detach:()=>{ne==null||ne.removeEventListener("mousedown",r),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",o),window.removeEventListener("keydown",n)},refreshUI:()=>{}}}function tn(){const i=z();for(const e of i){const t=e.matrix;if(!t)continue;const s=t.getInteractionStore();if(s.hasSelection())return{sequencerId:e.id,selectedNotes:s.getSelectedNotes()}}return null}function oh(i){const e=()=>{const o=V(),c=tn();if(!c||c.selectedNotes.length===0){o.showError("No notes selected. Please select notes before adjusting velocity.");return}i.velocity.show(c.selectedNotes)},t=o=>{var u;if(o.key.toLowerCase()!=="v"||o.ctrlKey||o.metaKey||o.altKey)return;const c=(u=document.activeElement)==null?void 0:u.tagName,d=c==="INPUT"||c==="TEXTAREA",l=Be();d||l||(o.preventDefault(),e())},s=o=>{o.type==="keydown"&&o.ctrlKey&&!st()&&Xi(!0),o.type==="keyup"&&o.key==="Control"&&st()&&Xi(!1)},n=o=>{t(o),s(o)},r=o=>{s(o)},a=o=>{const{editorId:c}=o.detail;c==="velocity-tool"&&e()};return window.addEventListener("keydown",n),window.addEventListener("keyup",r),document.body.addEventListener("editor-invoke",a),{detach:()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",r),document.body.removeEventListener("editor-invoke",a)},refreshUI:()=>{}}}let tt=null;function ks(i,e){const t=pe(),s=window.devicePixelRatio||1,n=e/s;function r(){if(!i.isActive())return;const a=i.getCurrentBeat(),o=a/t*n;Kt(o),en(i,a),tt=requestAnimationFrame(r)}Si(),tt=requestAnimationFrame(r)}function Si(){tt!==null&&(cancelAnimationFrame(tt),tt=null)}function lh(i){var e;Kt(0);for(const t of i.sequencers)(e=t.matrix)==null||e.setPlayheadPixelX(0)}class ch{constructor(){this.onStop=null,this.engine=J.getInstance(),this.playheadCanvasWidth=300,this.engine.setOnResumeCallback(()=>{ks(this.engine,this.playheadCanvasWidth)}),this.engine.setOnStopCallback(()=>{var e;(e=this.onStop)==null||e.call(this)})}play(){this.engine.start(),ks(this.engine,this.playheadCanvasWidth)}stop(){this.engine.stop(),Si(),lh(this.engine)}setOnStopCallback(e){this.onStop=e}async pause(){await this.engine.pause(),Si()}async resume(){await this.engine.resume()}toggle(){this.engine.isActive()?this.pause():this.resume()}isPlaying(){return this.engine.isActive()}getEngine(){return this.engine}setSequencers(e){this.engine.setSequencers(e)}setPlayheadCanvasWidth(e){this.playheadCanvasWidth=e}}function dh(){const i=ve("💾 Export"),e=K({id:"export-json",text:"Save Project",kind:"primary"}),t=m("div",{class:"h-px bg-gray-600"}),s=K({id:"export-wav",text:"Export as WAV",kind:"secondary",additionalClasses:"bg-green-600 hover:bg-green-700"}),n=K({id:"export-midi",text:"Export as MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),r=m("button",{id:"drag-midi",draggable:"true",class:["drag-midi-btn","cursor-grab select-none","px-2 py-1 rounded w-8 flex items-center justify-center","transition-transform transition-opacity duration-150","hover:scale-105 hover:brightness-110 active:cursor-grabbing","bg-yellow-700 hover:bg-yellow-600 text-white","border border-yellow-500"].join(" "),title:"Drag entire song as MIDI file to Desktop"},"🎵"),a=m("div",{class:"flex items-center gap-2"},n,r),o=K({id:"export-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),c=m("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,s,a);return{root:ae("export-modal",[i,c,o]),dragMidiBtn:r}}let sn=0;function uh(i,e){const t=sn++,s={id:t,...ft},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",r=new wr(null,s,i,i.destination,n,!0,t);return r.id=t,r.colorIndex=t,r.mute=!1,r.solo=!1,r.volume=e.volume??100/127,r.pan=e.pan??0,e.notes&&r.matrix&&r.matrix.setNotes(e.notes),r.setState({notes:e.notes,config:e.config||{},instrument:e.instrument,volume:e.volume,pan:e.pan}),r.initInstrument(),r}function hh(){sn=0}function fh(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=i.tempo,t=i.timeSignature[0],s=i.totalMeasures,n=i.songKey,r={v:3,t:new Date().toISOString(),c:{b:e,bpm:t,tm:s,sk:n},i:i.sequencers.map(o=>o.instrument||"sf2/fluidr3-gm/acoustic_grand_piano"),vlm:i.sequencers.map(o=>o.volume??100/127),pan:i.sequencers.map(o=>o.pan??0),tr:i.sequencers.map(o=>({n:o.notes.map(c=>[c.pitch,c.start,c.duration,c.velocity??100])}))},a=new Blob([JSON.stringify(r)],{type:"application/json"});return{url:URL.createObjectURL(a),filename:`session-${Date.now()}.json`}}async function ph(i,e={sampleRate:44100,includePan:!0}){if(!i.tracks||i.tracks.length===0)throw new Error("No tracks to export.");const t=e.sampleRate,s=e.includePan?2:1,n=new AbortController;let r=!1;Ye("Exporting Session","Rendering your session offline...",()=>{r=!0,n.abort()},!0);try{const o=60/me(),c=Math.max(...i.tracks.flatMap(y=>y.notes.map(b=>(b.start+b.duration)*o+.2))),d=new OfflineAudioContext(s,Math.ceil(t*c),t);hh();for(const y of i.tracks)if(r||(await uh(d,y).exportToOffline(n.signal,y.notes),r))return;if(r)return;Ye("Rendering Audio","Rendering audio buffer…",void 0,!0);const l=await d.startRendering();Ye("Converting to WAV","Converting to WAV format…",void 0,!0);const u=mh(l);Ye("Downloading WAV","Please wait...",void 0,!0);const h=URL.createObjectURL(u),f=document.createElement("a");f.href=h,f.download=`session-${Date.now()}.wav`,f.click(),URL.revokeObjectURL(h)}catch(a){r?console.warn("Export operation was cancelled by the user."):console.error("Error during export:",a)}finally{Ni(!0)}}function mh(i){const e=i.numberOfChannels,t=i.length*e*2,s=new DataView(new ArrayBuffer(44+t)),n=(a,o)=>{for(let c=0;c<o.length;c++)s.setUint8(a+c,o.charCodeAt(c))};n(0,"RIFF"),s.setUint32(4,36+t,!0),n(8,"WAVE"),n(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,e,!0),s.setUint32(24,i.sampleRate,!0),s.setUint32(28,i.sampleRate*e*2,!0),s.setUint16(32,e*2,!0),s.setUint16(34,16,!0),n(36,"data"),s.setUint32(40,t,!0);let r=44;for(let a=0;a<i.length;a++)for(let o=0;o<e;o++){const c=i.getChannelData(o)[a],d=Math.max(-1,Math.min(1,c));s.setInt16(r,d*32767,!0),r+=2}return new Blob([s.buffer],{type:"audio/wav"})}async function yh(i){var c,d,l,u;const e=await i.text();let t;try{t=JSON.parse(e)}catch{throw new Error("Invalid JSON format.")}if(!Array.isArray(t.tr))throw new Error("Missing or invalid `tr` (tracks) array.");const s={bpm:((c=t.c)==null?void 0:c.b)??120,beatsPerMeasure:((d=t.c)==null?void 0:d.bpm)??4,totalMeasures:((l=t.c)==null?void 0:l.tm)??8,songKey:((u=t.c)==null?void 0:u.sk)??"CM"},n=Array.isArray(t.i)?t.i:[],r=Array.isArray(t.vlm)?t.vlm:[],a=Array.isArray(t.pan)?t.pan:[],o=t.tr.map((h,f)=>{if(!Array.isArray(h.n))throw new Error(`Track ${f} missing \`n\` (notes) array.`);const y=h.n.map(([v,S,_,C])=>({pitch:v,start:S,duration:_,velocity:C??100})),b=n[f]||"sf2/fluidr3-gm/acoustic_grand_piano",g=r[f],p=a[f];return{notes:y,instrument:b,volume:typeof g=="number"?g:void 0,pan:typeof p=="number"?p:void 0,config:{}}});return{globalConfig:s,tracks:o}}async function gh(i){var f;const e=await i.arrayBuffer(),t=new Ii.Midi(e),s=t.header.tempos[0],n=t.header.timeSignatures[0],r=(s==null?void 0:s.bpm)??120,a=((f=n==null?void 0:n.timeSignature)==null?void 0:f[0])??4,c=Math.max(0,...t.tracks.flatMap(y=>y.notes.map(b=>b.time+b.duration)))*(r/60),d=Math.ceil(c/a)||8,l={bpm:r,beatsPerMeasure:a,totalMeasures:d,songKey:"CM"},u=await aa(),h=t.tracks.map(y=>{const b=y.notes.map(N=>({pitch:N.name,start:N.time*(r/60),duration:N.duration*(r/60),velocity:Math.max(1,Math.min(127,Math.round(N.velocity*127)))}));let g=y.instrument.number;(g===void 0||g===0)&&(g=y.channel===9?0:y.channel%128);const p=y.controlChanges[7]||[],v=y.controlChanges[10]||[],S=p.length>0?p[0].value:void 0,_=v.length>0?v[0].value*2-1:void 0;let C;if(y.channel===9){const N=ga(g);N?C=`webaudiofont/${N.library}/${N.displayName}`:C=`sf2/drummachines/${u.includes("LM-2")?"LM-2":u[0]??"TR-808"}`}else C=`sf2/fluidr3-gm/${Er[g]||"acoustic_grand_piano"}`;return{notes:b,instrument:C,volume:S,pan:_,config:{}}});return{globalConfig:l,tracks:h}}function Gs(i,e){const t=J.getInstance();t.isActive()&&t.pause(),Pi(e.bpm),Di(e.beatsPerMeasure),Ui(e.totalMeasures),Dr(e.songKey);const s=document.getElementById("tempo-input");s&&(s.value=String(me()));const n=document.getElementById("measures-input");n&&(n.value=String(qi())),xl();for(const[o,c]of i.entries()){const d=o,l=c.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",u=c.notes||[],h=c.volume,f=c.pan;R({type:"CREATE_SEQUENCER",id:d,instrument:l,notes:structuredClone(u),volume:h,pan:f,config:{...c.config||{}}},Ri(d))}R(Oi("Session Loaded"),Or("Session Loaded"));const r=z();go();const a=document.getElementById("global-mini-contour");a&&rd(a,r),Kt(0)}class He{static async save(e){const t=$();if(e==="json"){const{url:s,filename:n}=fh(t);He.download(s,n)}else if(e==="midi"){const{url:s,filename:n}=await dc(t);He.download(s,n)}else throw new Error("Unsupported export format.")}static async saveWavWithOptions(e){const t=$(),s=z();try{const n={globalConfig:{bpm:t.tempo,beatsPerMeasure:t.timeSignature[0],totalMeasures:t.totalMeasures,songKey:t.songKey},tracks:s.map(r=>({notes:r.notes,instrument:r.instrumentName,config:r.config,volume:r.volume,pan:r.pan}))};await ph(n,e)}catch(n){alert("Failed to export WAV: "+(n instanceof Error?n.message:"Unknown error"))}}static async load(e){var t;try{const s=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();if(s==="json"){const{tracks:n,globalConfig:r}=await yh(e);Gs(n,r)}else if(s==="mid"||s==="midi"){const{tracks:n,globalConfig:r}=await gh(e);Gs(n,r)}else throw new Error("Unsupported file type.")}catch(s){alert("Failed to load file: "+(s.message||"Unknown error"))}}static download(e,t){const s=document.createElement("a");s.href=e,s.download=t,s.click(),URL.revokeObjectURL(e)}}function bh(i,e,t){const s=i.querySelector("#export-cancel"),n=i.querySelector("#export-json"),r=i.querySelector("#export-wav"),a=i.querySelector("#export-midi");let o=null;const c=()=>{i.classList.add("hidden")},d=async h=>{h==="wav"?(c(),t()):(await He.save(h),c())};s==null||s.addEventListener("click",c),n==null||n.addEventListener("click",()=>d("json")),r==null||r.addEventListener("click",()=>d("wav")),a==null||a.addEventListener("click",()=>d("midi"));const l=h=>{e.classList.add("dragging"),o=Tr(h,z())},u=()=>{e.classList.remove("dragging"),o&&(o(),o=null)};return e.addEventListener("dragstart",l),e.addEventListener("dragend",u),{detach:()=>{s==null||s.removeEventListener("click",c),n==null||n.removeEventListener("click",()=>d("json")),r==null||r.removeEventListener("click",()=>d("wav")),a==null||a.removeEventListener("click",()=>d("midi")),e.removeEventListener("dragstart",l),e.removeEventListener("dragend",u)},refreshUI:()=>{}}}class _h{constructor(e){this.detachFn=null;const{root:t,dragMidiBtn:s}=dh();this.modal=t,document.body.appendChild(this.modal);const n=bh(this.modal,s,e);this.detachFn=n.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function vh({id:i,label:e,options:t}){const s=U(),n=m("select",{id:i,class:["w-[80px] h-[40px] text-sm font-semibold rounded px-2 cursor-pointer",s.surfaceBackground,s.textColor,s.borderColor].join(" ")},...t.map(r=>m("option",{value:r.value},r.label)));return e?m("div",{class:"flex flex-col items-start gap-1"},ee(e),n):n}class Sh{constructor(){const e=U();this.sampleRateSelect=vh({id:"save-wav-sample-rate",options:[{value:"44100",label:"44,100 Hz (CD Quality)"},{value:"32000",label:"32,000 Hz"},{value:"22050",label:"22,050 Hz (Faster Export)"}]}),this.includePanCheckbox=m("input",{id:"save-wav-include-pan",type:"checkbox",checked:!0,class:"accent-purple-500"}),this.cancelButton=K({id:"save-wav-options-cancel-btn",text:"Cancel",kind:"secondary"}),this.applyButton=K({id:"save-wav-options-apply-btn",text:"Export",kind:"primary"});const t=[ve("Export Settings"),Q("Choose your WAV export parameters."),m("div",{class:"z-10 mb-4 w-full"},ee({text:"Sample Rate",for:"save-wav-sample-rate"}),this.sampleRateSelect),m("div",{class:"z-10 mb-6"},m("label",{class:`flex items-center gap-2 text-sm ${e.textColor}`},this.includePanCheckbox,"Include Panning in Export")),m("div",{class:"flex justify-end gap-4 z-10"},this.cancelButton,this.applyButton)];this.modalEl=ae("save-wav-options-modal",t,{sizePreset:"md"}),document.body.appendChild(this.modalEl),this.attachListeners()}attachListeners(){this.cancelButton.addEventListener("click",()=>this.hide()),this.applyButton.addEventListener("click",()=>{const e=parseInt(this.sampleRateSelect.value,10),t=this.includePanCheckbox.checked;this.hide(),He.saveWavWithOptions({sampleRate:e,includePan:t})})}show(){this.modalEl.classList.remove("hidden")}hide(){this.modalEl.classList.add("hidden")}destroy(){this.modalEl.remove()}}function Ch(){const i=ve("📁 Load Project"),e=K({id:"import-json",text:"Load Project",kind:"primary"}),t=m("div",{class:"h-px bg-gray-600"}),s=K({id:"import-midi",text:"Import MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),n=K({id:"import-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),r=m("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,s);return ae("import-modal",[i,r,n])}function Nh(i){const e=i.querySelector("#import-cancel"),t=i.querySelector("#import-json"),s=i.querySelector("#import-midi"),n=()=>{i.classList.add("hidden")},r=async c=>{const d=document.createElement("input");d.type="file",d.accept=c.join(","),d.onchange=async()=>{var l;(l=d.files)!=null&&l[0]&&(await He.load(d.files[0]),n())},d.click()},a=()=>r([".json"]),o=()=>r([".mid",".midi"]);return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",a),s==null||s.addEventListener("click",o),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",a),s==null||s.removeEventListener("click",o)},refreshUI:()=>{}}}class wh{constructor(){this.detachFn=null,this.modal=Ch(),document.body.appendChild(this.modal);const e=Nh(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Mh(){const i=m("h2",{class:"text-xl font-semibold mb-2 z-10 text-center",textContent:"Adjust Velocity"}),e=m("p",{class:"text-sm text-gray-400 mb-4 text-center z-10",textContent:"Apply a velocity transformation to the selected notes."}),t=m("input",{id:"velocity-set-toggle",type:"checkbox",class:"accent-purple-500",checked:!0}),s=m("label",{class:"flex items-center gap-2 text-sm mb-2"},t,"Set base velocity to"),n=m("select",{id:"velocity-action-select",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},m("option",{value:"set"},"Set Velocity To"),m("option",{value:"increase"},"Increase Velocity By"),m("option",{value:"decrease"},"Decrease Velocity By")),r=m("input",{id:"velocity-value-input",type:"number",value:"100",min:"1",max:"127",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),a=m("div",{id:"velocity-set-fields",class:"flex items-center gap-3"},n,r),o=m("div",{class:"z-10 mb-4"},s,a),c=m("input",{id:"velocity-ramp-toggle",type:"checkbox",class:"accent-purple-500"}),d=m("label",{class:"flex items-center gap-2 text-sm mb-2"},c,"Enable velocity ramp"),l=m("select",{id:"velocity-ramp-direction",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},m("option",{value:"up"},"Ramp Up"),m("option",{value:"down"},"Ramp Down")),u=m("input",{id:"velocity-ramp-amount",type:"number",value:"10",min:"1",max:"127",placeholder:"Δ per note",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),h=m("div",{class:"flex items-center gap-2 mb-4 text-sm text-gray-300"},m("label",{class:"flex items-center gap-1"},m("input",{type:"radio",name:"ramp-mode",value:"linear",checked:!0,class:"accent-purple-500"}),"Linear"),m("label",{class:"flex items-center gap-1"},m("input",{type:"radio",name:"ramp-mode",value:"exponential",class:"accent-purple-500"}),"Exponential")),f=m("div",{id:"velocity-ramp-fields",class:"opacity-50 pointer-events-none"},m("div",{class:"flex items-center gap-3 mb-2"},l,u),h),y=m("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},d,f),b=m("input",{id:"velocity-randomize-toggle",type:"checkbox",class:"accent-purple-500"}),g=m("label",{class:"flex items-center gap-2 text-sm mb-2"},b,"Add random variation"),p=m("input",{id:"velocity-random-range",type:"number",value:"5",min:"1",max:"64",class:"w-[80px] bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm focus:outline-none focus:border-purple-500"}),v=m("div",{id:"velocity-random-fields",class:"flex items-center gap-2 text-sm text-gray-300 opacity-50 pointer-events-none"},m("span",{textContent:"±"}),p),S=m("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},g,v),_=m("div",{id:"velocity-preview-summary",class:"mt-6 text-sm text-gray-400 text-center z-10"}),C=K({id:"velocity-apply-btn",text:"Apply",kind:"primary"}),N=K({id:"velocity-cancel-btn",text:"Cancel",kind:"tertiary"}),w=m("div",{class:"flex gap-3 mt-6 z-10"},C,N);return ae("velocity-modal",[i,e,o,y,S,_,w])}function xh(i){const e=tn();if(!e){console.warn("No active note selection to apply velocity changes.");return}const{sequencerId:t,selectedNotes:s}=e;if(s.length===0){console.warn("No notes selected in the active sequencer.");return}const n=z().find(p=>p.id===t);if(!(n!=null&&n.matrix)){console.warn(`Could not find matrix for sequencer ID ${t}.`);return}const r=s.map(p=>({...p})),{mode:a,value:o,rampDirection:c="none",rampAmount:d=0,rampMode:l="linear",randomize:u=!1,randomRange:h=0}=i,f=s.map((p,v)=>({note:p,originalIndex:v}));f.sort((p,v)=>p.note.start-v.note.start);const y=new Map;for(const p of f){const v=p.note.start;y.has(v)||y.set(v,[]),y.get(v).push(p)}Array.from(y.entries()).sort((p,v)=>p[0]-v[0]).map(([,p])=>p).forEach((p,v)=>{let S=l==="linear"?v:Math.pow(v,1.3),_=d*S;c==="down"&&(_=-_);for(const{note:C}of p){let N;switch(a){case"set":N=Math.max(1,o);break;case"increase":N=(C.velocity??100)+o;break;case"decrease":N=(C.velocity??100)-o;break;case"none":default:N=C.velocity??100;break}let w=N+_;if(u&&h>0){const L=(Math.random()*2-1)*h;w+=L}C.velocity=Math.max(1,Math.min(127,Math.round(w)))}});const g=f.sort((p,v)=>p.originalIndex-v.originalIndex).map(({note:p})=>({...p}));R(kc(t,g),Gc(t,r))}function Lh(i){const e=document.getElementById("velocity-modal");e&&e.classList.remove("hidden")}function di(){const i=document.getElementById("velocity-modal");i&&i.classList.add("hidden")}function kh(i){var f;const e=i.querySelector("#velocity-apply-btn"),t=i.querySelector("#velocity-cancel-btn"),s=i.querySelector("#velocity-set-toggle"),n=((f=i.querySelector("#velocity-action-select"))==null?void 0:f.parentElement)??null,r=i.querySelector("#velocity-ramp-toggle"),a=i.querySelector("#velocity-ramp-fields"),o=i.querySelector("#velocity-randomize-toggle"),c=i.querySelector("#velocity-random-fields");function d(y,b){if(!y||!b)return;const g=y.checked;b.classList.toggle("opacity-50",!g),b.classList.toggle("pointer-events-none",!g)}function l(){s==null||s.addEventListener("change",()=>d(s,n)),r==null||r.addEventListener("change",()=>d(r,a)),o==null||o.addEventListener("change",()=>d(o,c)),d(s,n),d(r,a),d(o,c)}function u(){var L,G,E,M,x,B;const y=(s==null?void 0:s.checked)??!0,b=(r==null?void 0:r.checked)??!1,g=(o==null?void 0:o.checked)??!1,p=y?(L=i.querySelector("#velocity-action-select"))==null?void 0:L.value:"none",v=parseInt(((G=i.querySelector("#velocity-value-input"))==null?void 0:G.value)??"",10),S=isNaN(v)?100:Math.max(1,Math.min(127,v)),_=b?(E=i.querySelector("#velocity-ramp-direction"))==null?void 0:E.value:"none",C=b?parseInt(((M=i.querySelector("#velocity-ramp-amount"))==null?void 0:M.value)??"0",10):0,N=b?(x=i.querySelector('input[name="ramp-mode"]:checked'))==null?void 0:x.value:"linear",w=g?parseInt(((B=i.querySelector("#velocity-random-range"))==null?void 0:B.value)??"0",10):0;xh({mode:p,value:S,rampDirection:_,rampAmount:C,rampMode:N,randomize:g,randomRange:w}),di()}const h=()=>{t==null||t.removeEventListener("click",di),e==null||e.removeEventListener("click",u),s==null||s.removeEventListener("change",()=>d(s,n)),r==null||r.removeEventListener("change",()=>d(r,a)),o==null||o.removeEventListener("change",()=>d(o,c))};return t==null||t.addEventListener("click",di),e==null||e.addEventListener("click",u),l(),{detach:h,refreshUI:()=>{}}}class Gh{constructor(){this.detachFn=null,this.modal=Mh(),document.body.appendChild(this.modal);const e=kh(this.modal);this.detachFn=e.detach}show(e){Lh()}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}const Bh="v0.1.1",Eh="May 13, 2025",Ah=["✨ New Features","- 🤖 Added AI Autocomplete for seamless melody continuation (OpenAI API Key required; more AI features rolling out soon)","- 🎨 Improved skin system with expanded customization options (available in User Settings)","- 🐛 Fixed numerous bugs and polished UI behavior for a smoother experience","🐞 Known Issues","- 🚫 Note placement during live playback of large sequences causes performance issues","🛣️ Roadmap","- 🤖 Continous enhancing and implementation of AI features"];function Th(){const i=ee({text:`${Bh} — Updated ${Eh}`});i.id="whats-new-metadata",i.classList.add("italic","text-gray-400","text-center","self-center","mb-4");const e=m("ul",{id:"whats-new-content",class:"list-disc list-inside text-left space-y-2 text-md w-full"});let t=null;for(const a of Ah)if(a.startsWith("✨")||a.startsWith("🐞")||a.startsWith("🛣️")){const o=m("li",{class:"font-bold mt-6 text-lg",textContent:a});e.appendChild(o),t=m("ul",{class:"list-disc list-inside ml-6 mt-2 space-y-1"}),e.appendChild(t)}else if(t){const o=m("li",{textContent:a.replace(/^- /,"")});t.appendChild(o)}const s=m("img",{src:oe("static/logo.png"),alt:"Sequenzia",class:"w-[180px] h-auto rounded-xl mb-6 self-center"}),n=K({id:"whats-new-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"}),r=ve({text:"🆕 What's New in Sequenzia",size:"xl",additionalClasses:"text-center self-center"});return ae("whats-new-modal",[s,r,i,e,n],{sizePreset:"xl"})}function Ih(i){const e=i.querySelector("#whats-new-close-btn"),t=()=>{i.style.opacity="0",i.style.transition="opacity 0.4s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},400)};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class Rh{constructor(){this.detachFn=null,this.modal=Th(),document.body.appendChild(this.modal);const e=Ih(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.style.opacity="0",this.modal.style.transition="opacity 0.4s ease-out",setTimeout(()=>{this.modal.classList.add("hidden"),this.modal.style.opacity="1"},400)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class Oh{constructor(e,t){this.contour=null,this.miniCanvas=null,this.sideButtons=null,this.detachFns=[],this.refreshFns=[],this.engine=e,this.userConfigModalController=t,this.playbackService=new ch,this.initializeUI()}initializeUI(){this.controls=new fd,this.wavOptionsModal=new Sh,this.saveModal=new _h(()=>this.wavOptionsModal.show()),this.loadModal=new wh,this.velocityModal=new Gh,this.whatsNewModal=new Rh;const e=md(),t=Md(),s=Ad(),n=xd();this.controls.getGlobalPlayheadRow().appendChild(e),this.controls.getGlobalToolsRow().appendChild(t.element),this.controls.getGlobalTransportRow().appendChild(s.element);const r=document.getElementById("footer-main");r&&r.appendChild(n),this.miniCanvas=this.getGlobalMiniContourCanvas(),this.sideButtons=n,this.contour=e;const a=Rd(e),o=th({rootElement:t.element,noteOptionsGroup:t.noteOptionsGroup,aiOptionsGroup:t.aiOptionsGroup}),c=sh(s.element,this.playbackService,this.userConfigModalController,this.saveModal,this.loadModal),d=ih(n,this.whatsNewModal),l=ah(this.controls.getGlobalPlayheadRow()),u=oh({velocity:this.velocityModal});this.detachFns=[a.detach,o.detach,c.detach,d.detach,l.detach,u.detach,t.refreshGridSettings],this.refreshFns=[a.refreshUI,o.refreshUI,c.refreshUI,d.refreshUI,l.refreshUI,u.refreshUI,s.refreshToggles],Is(),this.initPlayhead()}initPlayhead(){if(!this.contour)return;const e=this.contour.querySelector("#global-mini-playhead");e&&(rh(e),this.playbackService.setPlayheadCanvasWidth(e.width))}getPlaybackService(){return this.playbackService}getGlobalMiniContourCanvas(){var e;return((e=this.contour)==null?void 0:e.querySelector("#global-mini-contour"))??null}show(){this.refreshFns.forEach(e=>e()),this.controls.render().classList.remove("hidden")}hide(){this.controls.render().classList.add("hidden")}destroy(){var e,t,s,n,r,a;this.detachFns.forEach(o=>o()),this.controls.destroy(),(e=this.sideButtons)!=null&&e.parentNode&&this.sideButtons.parentNode.removeChild(this.sideButtons),this.sideButtons=null,(t=this.wavOptionsModal)==null||t.destroy(),(s=this.saveModal)==null||s.destroy(),(n=this.loadModal)==null||n.destroy(),(r=this.velocityModal)==null||r.destroy(),(a=this.whatsNewModal)==null||a.destroy()}reload(){this.destroy(),this.initializeUI()}}function Fh(i,e){window.addEventListener("keydown",t=>{const s=(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="z",n=(t.ctrlKey||t.metaKey)&&(t.key.toLowerCase()==="y"||t.shiftKey&&t.key.toLowerCase()==="z");if(!s&&!n)return;t.preventDefault(),t.target instanceof HTMLElement&&t.target.matches('input, textarea, [contenteditable="true"]')||(s?i():e())},{capture:!0})}function Ph(){const i=m("canvas",{id:"waveform",width:1260,height:100,class:"rounded border border-purple-800 bg-gray-900"}),e=m("button",{id:"visualizer-mode",class:"side-button side-button-primary",title:"Change visualizer mode",textContent:"📊"}),t=m("div",{class:"flex flex-col gap-2"},e),s=m("div",{class:"flex items-start gap-2"},i,t),n=document.getElementById("visualizer-container");return n&&n.appendChild(s),s}function Dh(i,e){const t=e.getContext("2d");if(!t)throw new Error("Canvas 2D context not available");const s=e.width,n=e.height,r=new Uint8Array(i.fftSize),a=new Uint8Array(i.frequencyBinCount),o=document.createElement("canvas");o.width=s,o.height=n;const c=o.getContext("2d");if(!c)throw new Error("Offscreen canvas 2D context not available");let d="frequency";function l(){if(!t)return;i.getByteTimeDomainData(r),t.fillStyle="#000",t.fillRect(0,0,s,n),t.lineWidth=2,t.strokeStyle="#00ffcc",t.beginPath();const y=s/r.length;let b=0;for(let g=0;g<r.length;g++){const v=r[g]/128*n/2;g===0?t.moveTo(b,v):t.lineTo(b,v),b+=y}t.lineTo(s,n/2),t.stroke()}function u(){if(i.getByteFrequencyData(a),!t)return;t.fillStyle="#000",t.fillRect(0,0,s,n),t.fillStyle="rgba(255,255,255,0.2)",t.fillRect(0,0,1,n),t.fillRect(s-1,0,1,n);const y=128,b=2,g=[];for(let p=0;p<y;p++)g.push(p*s/(y-1));g[g.length-1]=s-1;for(let p=0;p<y;p++){const v=g[p],S=p<y-1?g[p+1]:s,_=Math.max(1,S-v-b),C=20,N=2e4,w=p/(y-1),L=C*Math.pow(N/C,w),E=Math.min(a.length-1,Math.floor(L/22050*a.length)),M=a[E]/255,x=Math.max(1,M*n),B=240-w*240;t.fillStyle=`hsl(${B}, ${80+M*20}%, ${40+M*40}%)`,t.fillRect(v,n-x,_,x)}}function h(){if(i.getByteFrequencyData(a),!c)return;o.initialized||(c.fillStyle="#000",c.fillRect(0,0,s,n),o.initialized=!0),c.drawImage(o,-1,0),c.fillStyle="#000",c.fillRect(s-1,0,1,n);const y=128,b=20,g=2e4;for(let p=0;p<y;p++){const v=p/(y-1),S=b*Math.pow(g/b,v),C=Math.min(a.length-1,Math.floor(S/22050*a.length)),N=a[C]/255,w=n-1-Math.floor(p*n/y);if(N<.05)continue;const L=Math.floor(N*255),G=Math.floor(N*(255-v*200)),E=Math.floor(N*(100+v*155));c.fillStyle=`rgb(${L}, ${G}, ${E})`,c.fillRect(s-1,w,1,1)}t&&(t.fillStyle="#000",t.fillRect(0,0,s,n),t.drawImage(o,0,0))}function f(){switch(requestAnimationFrame(f),d){case"frequency":u();break;case"spectrogram":h();break;case"waveform":default:l()}}return f(),{setMode(y){["waveform","frequency","spectrogram"].includes(y)&&(d=y,t.clearRect(0,0,s,n),d==="spectrogram"&&c.clearRect(0,0,s,n))}}}function Uh(i){const e=i.querySelector("#waveform"),t=i.querySelector("#visualizer-mode");if(!e||!t)return console.warn("Visualizer setup failed: missing canvas or button"),{detach:()=>{},refreshUI:()=>{}};const s=Dh(Xs(),e),n=[{name:"waveform",emoji:"🌊"},{name:"frequency",emoji:"📊"},{name:"spectrogram",emoji:"🌈"}];let r=0;function a(){if(!t)return;r=(r+1)%n.length;const{name:o,emoji:c}=n[r];s.setMode(o),t.textContent=c,t.title=`Mode: ${o}`}return t.addEventListener("click",a),a(),{detach:()=>{t.removeEventListener("click",a)},refreshUI:()=>{t.textContent=n[r].emoji,t.title=`Mode: ${n[r].name}`}}}class qh{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=Ph();const e=Uh(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function Kh(){const i=m("div",{id:"left-sidebutton-column",class:"absolute left-[-46px] flex flex-col gap-2 z-10"},m("button",{id:"piano-toggle-btn",class:"side-button side-button-info",title:"Toggle Piano View",textContent:"🎹"}),m("button",{id:"mixer-toggle-btn",class:"side-button side-button-info",title:"Toggle Mixer View",textContent:"🎛️"}),m("button",{id:"ai-toggle-btn",class:"side-button side-button-info",title:"Toggle AI View",textContent:"🤖"})),e=document.getElementById("top-controls-container");return e?e.appendChild(i):console.warn("[SideMenuUI] #top-controls-container not found."),i}function $h(i){const e=i.querySelector("#piano-toggle-btn"),t=i.querySelector("#mixer-toggle-btn"),s=i.querySelector("#ai-toggle-btn"),n=()=>{V().showFeatureBlocked()},r=()=>{V().showFeatureBlocked()},a=()=>{V().showFeatureBlocked()};return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",r),s==null||s.addEventListener("click",a),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",r),s==null||s.removeEventListener("click",a)},refreshUI:()=>{}}}class Hh{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=Kh();const e=$h(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function zh(){const i=m("canvas",{id:"piano",width:1260,height:200,class:"rounded shadow-lg border border-purple-700"}),e=m("button",{id:"octave-up",class:"side-button side-button-primary",title:"Octave Up"},I("icon-arrow-up","Octave Up")),t=m("button",{id:"octave-down",class:"side-button side-button-primary",title:"Octave Down"},I("icon-arrow-down","Octave Down")),s=m("button",{id:"global-instrument-select-btn",class:"side-button side-button-primary",title:"Select Instrument"},I("icon-list-instrument","Instrument")),n=m("button",{id:"disable-keyboard-inputs",class:"side-button side-button-secondary",title:"Toggle Keyboard Input"},I("icon-keyboard","Keyboard Input")),r=m("div",{class:"flex flex-col gap-2"},e,t,s,n);return{wrapper:m("div",{class:"flex items-start gap-2"},i,r),canvas:i}}function Bs(i,e){const t=parseInt(i.replace("#",""),16),s=Math.round(2.55*e),n=Math.max(0,Math.min(255,(t>>16)+s)),r=Math.max(0,Math.min(255,(t>>8&255)+s)),a=Math.max(0,Math.min(255,(t&255)+s));return`rgb(${n},${r},${a})`}function at(i,e,t=new Set,s=null){i.clearRect(0,0,i.canvas.width,i.canvas.height);const{whiteKeyColor:n,blackKeyColor:r}=U(),a={};if(s)for(const[o,c]of Object.entries(s))a[c]=o;for(const o of Object.values(e))if(!o.isBlack){const c=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(c.addColorStop(0,"#99cfff"),c.addColorStop(1,"#cce0ff")):(c.addColorStop(0,Bs(n,-20)),c.addColorStop(1,n)),Es(i,{...o,fill:c,stroke:"#333",radius:6}),i.fillStyle="#333",i.font="12px sans-serif",i.textAlign="center",a[o.note]&&(i.fillStyle="#7c3aed",i.fillText(a[o.note],o.x+o.width/2,o.height-24),i.fillStyle="#333"),i.fillText(o.note,o.x+o.width/2,o.height-8)}for(const o of Object.values(e))if(o.isBlack){const c=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(c.addColorStop(0,"#3040ff"),c.addColorStop(1,"#4a60ff")):(c.addColorStop(0,Bs(r,-20)),c.addColorStop(1,r)),Es(i,{...o,fill:c,stroke:"#000000",radius:4}),a[o.note]&&(i.fillStyle="#c084fc",i.font="10px sans-serif",i.textAlign="center",i.fillText(a[o.note],o.x+o.width/2,o.height-28))}}function Es(i,e){const{x:t,width:s,height:n,fill:r,stroke:a,radius:o=8}=e;i.beginPath(),i.moveTo(t,0),i.lineTo(t,n-o),i.quadraticCurveTo(t,n,t+o,n),i.lineTo(t+s-o,n),i.quadraticCurveTo(t+s,n,t+s,n-o),i.lineTo(t+s,0),i.closePath(),i.fillStyle=r,i.fill(),i.strokeStyle=a,i.lineWidth=1,i.stroke()}function Jh(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Map,s=new Set;let n=!1;function r(f,y){const b=Pe();for(const g of Object.values(b))if(g.isBlack&&f>=g.x&&f<=g.x+g.width&&y>=0&&y<=g.height)return g.note;for(const g of Object.values(b))if(!g.isBlack&&f>=g.x&&f<=g.x+g.width&&y>=0&&y<=g.height)return g.note;return null}function a(f){if(!f||s.has(f)||!e)return;const y=Fa(f);y&&(t.set(f,y),s.add(f),at(e,Pe(),s,void 0))}function o(f){if(!s.has(f)||!e)return;const y=t.get(f);y&&(y.stop(),t.delete(f)),s.delete(f),at(e,Pe(),s,void 0)}function c(){for(const f of s)o(f)}const d=f=>{n=!0;const y=i.getBoundingClientRect(),b=f.clientX-y.left,g=f.clientY-y.top,p=r(b,g);a(p)},l=f=>{if(!n)return;const y=i.getBoundingClientRect(),b=f.clientX-y.left,g=f.clientY-y.top,p=r(b,g);a(p)},u=()=>{n=!1,c()},h=()=>{n=!1,c()};return i.addEventListener("mousedown",d),i.addEventListener("mousemove",l),i.addEventListener("mouseup",u),i.addEventListener("mouseleave",h),{detach:()=>{i.removeEventListener("mousedown",d),i.removeEventListener("mousemove",l),i.removeEventListener("mouseup",u),i.removeEventListener("mouseleave",h)},refreshUI:()=>{}}}const rn=[..."qwertyuiop[zxcvbnm,./"],nn=["2","3","5","6","7","9","0","=","s","d","g","h","k","l",";"];function jh(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Set,s=new Set,n=new Map;function r(){const l=Pe(),u=Object.values(l).filter(y=>!y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),h=Object.values(l).filter(y=>y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),f={};return rn.forEach((y,b)=>{u[b]&&(f[y]=u[b])}),nn.forEach((y,b)=>{h[b]&&(f[y]=h[b])}),f}function a(l){const u=r(),h=u[l];if(!(!h||t.has(l)||!e)){if(t.add(l),!s.has(h)){const f=Ws(h,100,Aa());f&&(n.set(h,{stop:f}),s.add(h))}at(e,Pe(),s,u)}}function o(l){const u=r(),h=u[l];!h||!e||(t.delete(l),s.has(h)&&(Ra(h),n.delete(h),s.delete(h)),at(e,Pe(),s,u))}const c=l=>{l.repeat||!Be()||a(l.key)},d=l=>{Be()&&o(l.key)};return window.addEventListener("keydown",c),window.addEventListener("keyup",d),{detach:()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",d)},refreshUI:()=>{}}}function As(i,e){e?(i.classList.remove("side-button-secondary","side-button-primary"),i.classList.add("side-button-activated")):(i.classList.remove("side-button-activated"),i.classList.add("side-button-secondary"))}function Wh(i){const e=Object.values(i).filter(n=>!n.isBlack).sort((n,r)=>n.x-r.x).map(n=>n.note),t=Object.values(i).filter(n=>n.isBlack).sort((n,r)=>n.x-r.x).map(n=>n.note),s={};return rn.forEach((n,r)=>{e[r]&&(s[n]=e[r])}),nn.forEach((n,r)=>{t[r]&&(s[n]=t[r])}),s}function Xh(i){const e=i.querySelector("#piano"),t=e==null?void 0:e.getContext("2d");if(!e||!t)throw new Error("Keyboard canvas not available");const s=i.querySelector("#octave-up"),n=i.querySelector("#octave-down"),r=i.querySelector("#disable-keyboard-inputs"),a=i.querySelector("#global-instrument-select-btn");function o(){if(!t)return;const h=Xt(),f=zs(h);Ia(f),r&&As(r,Be());const y=Be()?Wh(f):null;at(t,f,new Set,y??void 0)}const c=()=>{const h=Xt();h<7&&(Wi(h+1),o())},d=()=>{const h=Xt();h>1&&(Wi(h-1),o())},l=()=>{const h=Be();Ta(!h),o(),r&&As(r,!h)},u=()=>{const h=xi()||"sf2/fluidr3-gm/acoustic_grand_piano";Pt().showInstrumentSelectModal(null,h)};return s==null||s.addEventListener("click",c),n==null||n.addEventListener("click",d),r==null||r.addEventListener("click",l),a==null||a.addEventListener("click",u),{detach:()=>{s==null||s.removeEventListener("click",c),n==null||n.removeEventListener("click",d),r==null||r.removeEventListener("click",l),a==null||a.removeEventListener("click",u)},refreshUI:o}}class Vh{constructor(){this.detachFns=[],this.refreshFns=[];const{wrapper:e,canvas:t}=zh();this.wrapper=e,this.canvas=t}render(){return this.wrapper}initialize(){Ba();const e=Jh(this.canvas),t=jh(this.canvas),s=Xh(this.wrapper);this.detachFns=[e.detach,t.detach,s.detach],this.refreshFns=[e.refreshUI,t.refreshUI,s.refreshUI],this.refresh()}refresh(){this.refreshFns.forEach(e=>e())}hide(){this.wrapper.classList.add("hidden")}show(){this.wrapper.classList.remove("hidden"),this.refresh()}destroy(){this.detachFns.forEach(e=>e()),this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)}}class Yh{constructor(){this.activeMode="keyboard",this.activeElement=null,this.detachFns=[];const e=document.getElementById("top-controls-container");if(!e)throw new Error("#top-controls-container not found in DOM");this.container=e,this.initialize()}initialize(){this.sideMenuController=new Hh,this.keyboardController=new Vh,this.setMode("keyboard")}setMode(e){if(this.activeElement){if(this.activeMode===e)return;this.container.removeChild(this.activeElement),this.activeElement=null}switch(this.activeMode=e,e){case"keyboard":this.activeElement=this.keyboardController.render(),this.container.appendChild(this.activeElement),this.keyboardController.initialize();break;case"ai":this.activeElement=this.createStub("AI View not implemented"),this.container.appendChild(this.activeElement);break;case"mixer":this.activeElement=this.createStub("Mixer View not implemented"),this.container.appendChild(this.activeElement);break}}getCurrentMode(){return this.activeMode}destroy(){var e,t,s;this.detachFns.forEach(n=>n()),this.detachFns=[],(e=this.sideMenuController)==null||e.destroy(),(t=this.keyboardController)==null||t.destroy(),((s=this.activeElement)==null?void 0:s.parentNode)===this.container&&this.container.removeChild(this.activeElement),this.activeElement=null}reload(){this.destroy(),this.initialize()}createStub(e){const t=document.createElement("div");return t.className="text-gray-400 text-sm p-4 border border-gray-600 rounded",t.textContent=e,t}}function Zh(i){return m("div",{class:"flex justify-between items-center mb-6 border-b border-purple-700 pb-2 z-10"},m("div",{class:"flex gap-4 text-xl select-none"},...i.map(e=>m("span",{class:["settings-tab","hover:text-white hover:scale-110 transition-all duration-150 cursor-pointer",e.isActive?"text-purple-500":"text-gray-300"].join(" "),dataset:{tab:e.key},title:e.title,textContent:e.icon}))))}class Qh{constructor(){this.globalSection=m("div",{id:"userconfig-global-settings",class:"settings-section z-10"}),this.themeSection=m("div",{id:"userconfig-theme-settings",class:"settings-section hidden z-10"}),this.aiSection=m("div",{id:"userconfig-ai-settings",class:"settings-section hidden z-10"});const e=Zh([{key:"global-settings",icon:"⚙️",title:"Global Settings",isActive:!0},{key:"theme-settings",icon:"🎹",title:"Theme Settings"},{key:"ai-settings",icon:"🤖",title:"AI Settings"}]);this.saveButton=K({id:"userconfig-save",text:"Save",kind:"primary"}),this.closeButton=K({id:"userconfig-close-bottom",text:"Cancel",kind:"secondary"});const t=m("div",{class:"flex gap-3 mt-4 z-10"},this.saveButton,this.closeButton);this.modal=ae("userconfig-modal",[e,this.globalSection,this.themeSection,this.aiSection,t]),document.body.appendChild(this.modal)}render(){return this.modal}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){this.modal.remove()}getSectionContainer(e){switch(e){case"global":return this.globalSection;case"theme":return this.themeSection;case"ai":return this.aiSection}}getSaveButton(){return this.saveButton}getCloseButton(){return this.closeButton}getTabs(){return this.modal.querySelectorAll(".settings-tab")}getSections(){return this.modal.querySelectorAll(".settings-section")}}function ef(){const{trigger:i,tooltip:e}=Ue("tooltip-note-mode","?",[Q(Fe("Default Mode:")," gesture-based note placement. Allows click-and-drag selection and edit gestures."),Q(Fe("Express Mode:")," notes are placed immediately on mouse down. Holding allows drag-resizing. Right-click initiates multi-note selection.")]),t=Ee({id:"note-tool-toggle",label:"Note Placement:",stateA:"Classic",stateB:"Express",tooltipTrigger:i});t.input.addEventListener("change",()=>{const r=t.getChecked()?"express":"default";fe({global:{noteToolMode:r}})});const s=()=>{const r=W().global.noteToolMode;t.setChecked(r==="express")};return{element:m("div",{},ve("Global Settings"),t.element,e),refreshToggle:s}}const tf=["Default","Blue Dream","Modern Light","Synthwave","Verdant Alloy","Sunset"],sf=["Darkroom","Seashell","Cyberpunk","Classic Blue","Midnight"],rf=["Track Color","Note Velocity","Pitch Class Contrast","Scriabin","Octave Bands"];function nf(){const i=sf.map(s=>m("option",{value:s,textContent:s})),e=rf.map(s=>m("option",{value:s,textContent:s})),t=tf.map(s=>m("option",{value:s,textContent:s}));return m("div",{},ve("Theme Settings"),m("div",{className:"mb-6"},ee("Interface Skin"),m("select",{id:"skin-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...t)),m("div",{className:"mb-6"},ee("Grid Color Scheme"),m("select",{id:"grid-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i)),m("div",{className:"mb-6"},ee("Note Color Scheme"),m("select",{id:"note-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...e)))}const af=[{value:"gpt-4o",label:"gpt-4o"},{value:"gpt-4o-mini",label:"gpt-4o-mini"},{value:"gpt-4.1",label:"gpt-4.1"},{value:"gpt-4.1-mini",label:"gpt-4.1-mini"},{value:"o3-mini",label:"o3-mini"},{value:"o4-mini",label:"o4-mini",className:"bg-green-700 text-white"}];function of(){const i=af.map(r=>m("option",{value:r.value,className:r.className,textContent:r.label})),{trigger:e,tooltip:t}=Ue("tooltip-openai-key","?",["You must provide an OpenAI API key to use AI features.",Q("Visit ",m("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",class:"text-blue-400 underline hover:text-blue-300"},"platform.openai.com")," to manage your key.")]),{trigger:s,tooltip:n}=Ue("tooltip-openai-model","?",["Different models offer varying performance and response quality.",Q("Models marked in ",m("span",{class:"text-green-400 font-semibold"},"green")," are recommended for best results."),"We will add support for new models as they become available."]);return m("div",{},ve("AI Configuration"),m("div",{class:"mb-6"},ee("OpenAI API Key",e),m("input",{type:"password",id:"openai-key-input",placeholder:"sk-...",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500"}),t),m("div",{class:"mb-8"},ee("OpenAI Model",s),m("select",{id:"openai-model-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i),n))}function lf(i,e={}){const t=i.getTabs(),s=i.getSections(),n=i.getCloseButton(),r=i.getSaveButton(),a=l=>{s.forEach(h=>{h.classList.add("hidden")});const u=document.getElementById(`userconfig-${l}`);u&&u.classList.remove("hidden"),t.forEach(h=>{const f=h.dataset.tab===l;h.classList.toggle("text-purple-500",f),h.classList.toggle("opacity-100",f),h.classList.toggle("text-gray-300",!f),h.classList.toggle("opacity-50",!f)})},o=[];t.forEach(l=>{const u=l.dataset.tab;if(!u)return;const h=()=>a(u);l.addEventListener("click",h),o.push(()=>l.removeEventListener("click",h))});const c=()=>{var l;(l=e.onClose)==null||l.call(e),i.hide()},d=()=>{var u;(u=e.onSave)==null||u.call(e);const l=U();l.name,be.getInstance().reloadAll(),i.hide()};return n.addEventListener("click",c),r.addEventListener("click",d),(()=>{const l=Array.from(t).find(u=>u.classList.contains("text-purple-500"));l!=null&&l.dataset.tab&&a(l.dataset.tab)})(),()=>{o.forEach(l=>l()),n.removeEventListener("click",c),r.removeEventListener("click",d)}}function cf(i){const e=i.querySelector("#openai-key-input"),t=i.querySelector("#openai-model-select"),s=()=>{var o;const a=W();e&&(e.value=a.ai.openaiApiKey||""),t&&(t.value=a.ai.openaiModel||((o=t.options[0])==null?void 0:o.value)||"")},n=a=>{const o=a.target;fe({ai:{openaiApiKey:o.value}})},r=a=>{const o=a.target;fe({ai:{openaiModel:o.value}})};return e==null||e.addEventListener("input",n),t==null||t.addEventListener("change",r),s(),{detach:()=>{e==null||e.removeEventListener("input",n),t==null||t.removeEventListener("change",r)},refreshUI:s}}function df(i){const e=i.querySelector("#grid-color-select"),t=i.querySelector("#note-color-select"),s=i.querySelector("#skin-select"),n=()=>{var d,l,u;const c=W();e&&(e.value=c.theme.gridColorScheme||((d=e.options[0])==null?void 0:d.value)||""),t&&(t.value=c.theme.noteColorScheme||((l=t.options[0])==null?void 0:l.value)||""),s&&(s.value=c.theme.skin||((u=s.options[0])==null?void 0:u.value)||"")},r=c=>{const d=c.target;fe({theme:{gridColorScheme:d.value}})},a=c=>{const d=c.target;fe({theme:{noteColorScheme:d.value}})},o=c=>{const d=c.target;J.getInstance().stop(),fe({theme:{skin:d.value}})};return e==null||e.addEventListener("change",r),t==null||t.addEventListener("change",a),s==null||s.addEventListener("change",o),n(),{detach:()=>{e==null||e.removeEventListener("change",r),t==null||t.removeEventListener("change",a),s==null||s.removeEventListener("change",o)},refreshUI:n}}function uf(i){const e=i.querySelector("#note-tool-toggle");if(!e)return console.warn("[GlobalSettings] Toggle input not found."),{detach:()=>{},refreshUI:()=>{}};const t=()=>{const n=W();e.checked=n.global.noteToolMode==="express"},s=n=>{const a=n.target.checked?"express":"default";fe({global:{noteToolMode:a}}),z().forEach(o=>o.resetInteractionMode())};return e.addEventListener("change",s),t(),{detach:()=>e.removeEventListener("change",s),refreshUI:t}}class hf{constructor(){this.modal=null,this.detachFns=[],this.refreshFns=[],this.initialSnapshot=structuredClone(W()),this.initializeUI()}initializeUI(){this.modal=new Qh;const e=ef(),t=nf(),s=of();this.modal.getSectionContainer("global").appendChild(e.element),this.modal.getSectionContainer("theme").appendChild(t),this.modal.getSectionContainer("ai").appendChild(s);const n=lf(this.modal,{onSave:()=>ld(),onClose:()=>fe(this.initialSnapshot)}),r=uf(e.element),a=df(t),o=cf(s);this.detachFns.push(n,r.detach,a.detach,o.detach),this.refreshFns.push(r.refreshUI,a.refreshUI,o.refreshUI,e.refreshToggle),Is(),document.body.appendChild(this.modal.render())}show(){var e;this.initialSnapshot=structuredClone(W()),this.refreshFns.forEach(t=>t()),(e=this.modal)==null||e.show()}hide(){var e;(e=this.modal)==null||e.hide()}destroy(){var e;this.detachFns.forEach(t=>t()),(e=this.modal)==null||e.destroy(),this.modal=null,this.detachFns=[],this.refreshFns=[]}reload(){this.destroy(),this.initializeUI()}}function ff(){document.getElementById("add-sequencer").addEventListener("click",()=>{const e=z().length;R(Rr(e,"sf2/fluidr3-gm/acoustic_grand_piano"),Ri(e))})}function pf(){const i=V();i.showSplashScreen(),cd(),id(),sd(),J.initialize(z());const e=new hf,t=Pt(),s=new Yh,n=new Oh(qc(),e),r=new qh;n.show(),r.show();const a=be.getInstance();a.registerReloadable(()=>r.reload()),a.registerReloadable(()=>s.reload()),a.registerReloadable(()=>e.reload()),a.registerReloadable(()=>n.reload()),a.registerReloadable(()=>i.reload()),a.registerReloadable(()=>t.reload()),Dt(od),T("Setting up additional UI..."),Fh(Ic,Rc),ff();const o=0;R(Rr(o,"sf2/fluidr3-gm/acoustic_grand_piano"),Ri(o)),R(Oi("Initial App State"),Or("Initial App State")),i.hideSplashScreen(),Rs("Sequenzia initialized"),T("Current state: ",$())}requestAnimationFrame(()=>{pf()});
