import{g as vs,S as qr,a as Kr,M as Hr,D as $r,b as zr,c as Jr,d as Wr,e as jr,f as Xr,i as Vr,h as Yr,P as Zr,j as Ss}from"./vendor-BrbinlG8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();function Qr(){return new Date().toISOString()}function yt(i,e=2){var r,n;if(i===null||typeof i!="object")return i;if(e<=0){const s=((r=i.constructor)==null?void 0:r.name)||"Object",a=Object.keys(i).length;return`[${s} object, ${a} keys]`}if(Array.isArray(i))return i.length>10?[...i.slice(0,10).map(s=>yt(s,e-1)),`...(${i.length} total)`]:i.map(s=>yt(s,e-1));const t={_type:((n=i.constructor)==null?void 0:n.name)||"Object"};for(const s in i){if(!Object.prototype.hasOwnProperty.call(i,s))continue;const a=i[s];if(a instanceof HTMLElement)t[s]=`[HTMLElement: ${a.tagName}]`;else if(a instanceof AudioContext||a instanceof AudioNode)t[s]="[AudioNode]";else if(typeof a=="function")t[s]="[Function]";else if(typeof a=="object"){const l=Object.keys(a).length>3?e-1:e;t[s]=yt(a,l)}else t[s]=a}return t}function en(i){try{const e=yt(i,2);return JSON.stringify(e,null,2)}catch(e){return JSON.stringify({error:"Could not serialize log payload",reason:e.message,type:typeof i},null,2)}}function Cs(i,e,t="log"){const n={timestamp:Qr(),level:t,message:i};e!==void 0&&(n.data=e);const s=en(n);switch(t){case"warn":console.warn(s);break;case"error":console.error(s);break;case"info":console.info(s);break;case"debug":console.debug(s);break;case"log":default:console.log(s);break}}const hi="SEQUENZIA_DEV";let et=!1;typeof window<"u"&&(et=localStorage.getItem(hi)==="true");function Ri(){et=!0,typeof window<"u"&&localStorage.setItem(hi,"true")}function tn(){et=!1,typeof window<"u"&&localStorage.removeItem(hi)}function Ft(){return et}function A(i,e,t="log"){et&&Cs(i,e,t)}class fe{constructor(){this.reloadCallbacks=[]}static getInstance(){return fe.instance||(fe.instance=new fe),fe.instance}registerReloadable(e){this.reloadCallbacks.push(e)}unregisterReloadable(e){this.reloadCallbacks=this.reloadCallbacks.filter(t=>t!==e)}reloadAll(){this.reloadCallbacks.forEach(e=>e())}}function sn(){const i=document.getElementById("splash-modal");return i?!i.classList.contains("hidden"):!1}function Ns(i){const e=[];for(const t of i)Array.isArray(t)?e.push(...Ns(t)):t!=null&&t!==!1&&e.push(t);return e}function m(i,e={},...t){const r=document.createElement(i);for(const[s,a]of Object.entries(e))if(!(a==null||a===!1))if(s==="class"||s==="className")r.className=a;else if(s==="style"&&typeof a=="object")for(const[o,l]of Object.entries(a))l!=null&&(r.style[o]=l);else if(s==="dataset"&&typeof a=="object")for(const[o,l]of Object.entries(a))r.dataset[o]=String(l);else s.startsWith("data-")?r.setAttribute(s,String(a)):s.startsWith("on")&&typeof a=="function"?r.addEventListener(s.slice(2).toLowerCase(),a):s in r?r[s]=a:r.setAttribute(s,String(a));const n=Ns(t);for(const s of n)r.appendChild(typeof s=="string"?document.createTextNode(s):s);return r}const rn={global:{noteToolMode:"express"},theme:{gridColorScheme:"Darkroom",noteColorScheme:"Track Color",skin:"Default"},ai:{openaiApiKey:"",openaiModel:"gpt-4o"}},ws={name:"Default",appBackground:"bg-black",menuBackground:"bg-gradient-to-br from-gray-800 to-gray-900",surfaceBackground:"bg-gray-900",accentColor:"bg-purple-700",textColor:"text-white",borderColor:"border-purple-950",buttonPrimaryColor:"bg-purple-700",buttonPrimaryColorHover:"hover:bg-purple-600",buttonSecondaryColor:"bg-gray-800",buttonSecondaryColorHover:"hover:bg-gray-700",buttonTertiaryColor:"bg-blue-700",buttonTertiaryColorHover:"hover:bg-blue-600",toggleTrackBase:"bg-gray-700",toggleTrackChecked:"peer-checked:bg-purple-600",toggleKnobBase:"after:border-gray-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#a6a09b",whiteKeyColor:"#292524",volumeGradientFrom:"from-purple-600",volumeGradientTo:"to-purple-400",volumeThumbColor:"bg-purple-500",panGradientFrom:"from-indigo-600",panGradientTo:"to-indigo-400",panThumbColor:"bg-indigo-500",snapMarkerColor:"bg-purple-300/50"},nn={name:"Blue Dream",appBackground:"bg-gradient-to-b from-blue-900 to-gray-900",menuBackground:"bg-gradient-to-br from-blue-800 to-blue-900",surfaceBackground:"bg-blue-950/80",accentColor:"bg-cyan-400",textColor:"text-white",borderColor:"border-cyan-400",buttonPrimaryColor:"bg-cyan-600",buttonPrimaryColorHover:"hover:bg-cyan-500",buttonSecondaryColor:"bg-blue-800",buttonSecondaryColorHover:"hover:bg-blue-700",buttonTertiaryColor:"bg-indigo-600",buttonTertiaryColorHover:"hover:bg-indigo-500",toggleTrackBase:"bg-blue-700",toggleTrackChecked:"peer-checked:bg-cyan-400",toggleKnobBase:"after:border-blue-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#1b1f5f",whiteKeyColor:"#c0e7ff",volumeGradientFrom:"from-cyan-500",volumeGradientTo:"to-cyan-300",volumeThumbColor:"bg-cyan-400",panGradientFrom:"from-indigo-500",panGradientTo:"to-indigo-300",panThumbColor:"bg-indigo-400",snapMarkerColor:"bg-cyan-400/50"},an={name:"Modern Light",appBackground:"bg-white",menuBackground:"bg-gray-100",surfaceBackground:"bg-gray-200",accentColor:"bg-blue-600",textColor:"text-gray-900",borderColor:"border-blue-600",buttonPrimaryColor:"bg-blue-600",buttonPrimaryColorHover:"hover:bg-blue-500",buttonSecondaryColor:"bg-gray-200",buttonSecondaryColorHover:"hover:bg-gray-300",buttonTertiaryColor:"bg-gray-300",buttonTertiaryColorHover:"hover:bg-gray-400",toggleTrackBase:"bg-gray-300",toggleTrackChecked:"peer-checked:bg-blue-600",toggleKnobBase:"after:border-gray-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#111111",whiteKeyColor:"#ffffff",volumeGradientFrom:"from-blue-500",volumeGradientTo:"to-blue-300",volumeThumbColor:"bg-blue-400",panGradientFrom:"from-sky-500",panGradientTo:"to-sky-300",panThumbColor:"bg-sky-400",snapMarkerColor:"bg-blue-400/50"},on={name:"Synthwave",appBackground:"bg-gradient-to-br from-black via-gray-900 to-purple-950",menuBackground:"bg-gradient-to-br from-purple-800 to-pink-900",surfaceBackground:"bg-gray-900/80",accentColor:"bg-fuchsia-500",textColor:"text-neon-green",borderColor:"border-fuchsia-500",buttonPrimaryColor:"bg-pink-700",buttonPrimaryColorHover:"hover:bg-pink-600",buttonSecondaryColor:"bg-purple-800",buttonSecondaryColorHover:"hover:bg-purple-700",buttonTertiaryColor:"bg-gray-800",buttonTertiaryColorHover:"hover:bg-gray-700",toggleTrackBase:"bg-pink-800",toggleTrackChecked:"peer-checked:bg-fuchsia-500",toggleKnobBase:"after:border-pink-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#d946ef",whiteKeyColor:"#f5d0fe",volumeGradientFrom:"from-fuchsia-500",volumeGradientTo:"to-pink-400",volumeThumbColor:"bg-fuchsia-400",panGradientFrom:"from-purple-600",panGradientTo:"to-purple-400",panThumbColor:"bg-purple-500",snapMarkerColor:"bg-fuchsia-300/50"},ln={name:"Verdant Alloy",appBackground:"bg-gradient-to-b from-gray-900 to-green-950",menuBackground:"bg-gradient-to-tr from-emerald-800 to-lime-700",surfaceBackground:"bg-emerald-950/70",accentColor:"bg-lime-400",textColor:"text-lime-100",borderColor:"border-lime-400",buttonPrimaryColor:"bg-emerald-600",buttonPrimaryColorHover:"hover:bg-emerald-500",buttonSecondaryColor:"bg-lime-700",buttonSecondaryColorHover:"hover:bg-lime-600",buttonTertiaryColor:"bg-gray-700",buttonTertiaryColorHover:"hover:bg-gray-600",toggleTrackBase:"bg-emerald-700",toggleTrackChecked:"peer-checked:bg-lime-400",toggleKnobBase:"after:border-lime-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#143016",whiteKeyColor:"#dbf4dc",volumeGradientFrom:"from-emerald-500",volumeGradientTo:"to-emerald-300",volumeThumbColor:"bg-emerald-400",panGradientFrom:"from-lime-500",panGradientTo:"to-lime-300",panThumbColor:"bg-lime-400",snapMarkerColor:"bg-lime-300/50"},cn={name:"Sunset",appBackground:"bg-gradient-to-br from-orange-900 via-red-800 to-purple-900",menuBackground:"bg-gradient-to-bl from-rose-800 to-orange-700",surfaceBackground:"bg-orange-950/70",accentColor:"bg-yellow-400",textColor:"text-yellow-100",borderColor:"border-yellow-400",buttonPrimaryColor:"bg-amber-600",buttonPrimaryColorHover:"hover:bg-amber-500",buttonSecondaryColor:"bg-red-700",buttonSecondaryColorHover:"hover:bg-red-600",buttonTertiaryColor:"bg-purple-700",buttonTertiaryColorHover:"hover:bg-purple-600",toggleTrackBase:"bg-red-700",toggleTrackChecked:"peer-checked:bg-yellow-400",toggleKnobBase:"after:border-orange-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#45122c",whiteKeyColor:"#fff3e0",volumeGradientFrom:"from-amber-500",volumeGradientTo:"to-amber-300",volumeThumbColor:"bg-amber-400",panGradientFrom:"from-rose-500",panGradientTo:"to-rose-300",panThumbColor:"bg-rose-400",snapMarkerColor:"bg-amber-300/50"},dn={Default:ws,"Blue Dream":nn,"Modern Light":an,Synthwave:on,"Verdant Alloy":ln,Sunset:cn};function un(i){return dn[i]||ws}const tt=structuredClone(rn);tt.theme.skin;function z(){return tt}function Ms(){return tt.ai.openaiApiKey}function O(){return un(tt.theme.skin)}function le(i){xs(tt,i);try{const e=K();if(e.length>0)for(const t of e)t.redraw()}catch(e){console.warn("[updateUserConfig] Skipped sequencer UI refresh (store not ready yet).",e)}}function xs(i,e){for(const t in e)e[t]&&typeof e[t]=="object"&&!Array.isArray(e[t])?(i[t]||(i[t]={}),xs(i[t],e[t])):i[t]=e[t]}const hn={sm:{widthClass:"w-[300px]",maxWidthClass:"max-w-sm"},md:{widthClass:"w-[500px]",maxWidthClass:"max-w-md"},lg:{widthClass:"w-[700px]",maxWidthClass:"max-w-lg"},xl:{widthClass:"w-[900px]",maxWidthClass:"max-w-xl"},full:{widthClass:"w-full",maxWidthClass:"max-w-full"}};function te(i,e,t={}){const r=O(),n=t.sizePreset?hn[t.sizePreset]:void 0,s=t.widthClass||(n==null?void 0:n.widthClass)||"w-[500px]",a=t.maxWidthClass||(n==null?void 0:n.maxWidthClass)||"max-w-full",o=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),l=m("div",{class:["relative flex flex-col",r.menuBackground,"border border-purple-700 shadow-2xl rounded-2xl","px-10 py-8 animate-fade-in text-white",s,a].join(" ")},o,...Array.isArray(e)?e:[e]);return m("div",{id:i,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},l)}function U({id:i,text:e,kind:t="primary",onClick:r,additionalClasses:n=""}){const s=O(),a={primary:s.buttonPrimaryColor,secondary:s.buttonSecondaryColor,tertiary:s.buttonTertiaryColor}[t],o={primary:s.buttonPrimaryColorHover,secondary:s.buttonSecondaryColorHover,tertiary:s.buttonTertiaryColorHover}[t];return m("button",{id:i,class:["cursor-pointer flex-1 py-2 rounded-lg transition-all text-sm",a,o,s.textColor,n].join(" "),textContent:e,onclick:r})}function fn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("h2",{class:"text-xl font-semibold mb-4 text-center tracking-wide z-10",textContent:"Oops!"}),t=m("div",{id:"error-message-content",class:["bg-gray-700 text-gray-100 rounded-xl px-4 py-3 text-sm whitespace-pre-wrap","z-10 max-h-[240px] overflow-y-auto text-center"].join(" ")}),r=U({id:"error-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"});return te("error-modal",[i,e,t,r],{widthClass:"w-[420px]",maxWidthClass:"max-w-full"})}function pn(i){const e=i.querySelector("#error-close-btn"),t=i.querySelector("div.relative"),r=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=s=>{t&&(t.contains(s.target)||r())};return e==null||e.addEventListener("click",r),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",r),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class mn{constructor(){this.detachFn=null,this.modal=fn(),this.messageBox=this.modal.querySelector("#error-message-content"),document.body.appendChild(this.modal);const e=pn(this.modal);this.detachFn=e.detach}show(e){this.messageBox.textContent=e,this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function yn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"text-[100px] mb-4 z-10 animate-bounce text-center",textContent:"🛠️"}),t=m("div",{class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Feature Not Implemented"}),r=m("div",{class:"text-sm text-gray-400 mt-2 z-10 text-center",innerHTML:"This part of Sequenzia is still under construction.<br />Check back soon!"}),n=U({id:"feature-modal-close-btn",text:"Got it",kind:"primary",additionalClasses:"mt-6 self-center z-10 px-6 py-2 text-base"});return te("feature-not-implemented-modal",[i,e,t,r,n],{widthClass:"w-[400px]",maxWidthClass:"max-w-full"})}function gn(i){const e=i.querySelector("#feature-modal-close-btn"),t=i.querySelector("div.relative"),r=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=s=>{t&&(t.contains(s.target)||r())};return e==null||e.addEventListener("click",r),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",r),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class _n{constructor(){this.detachFn=null,this.modal=yn(),document.body.appendChild(this.modal);const e=gn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function bn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"flex justify-center items-center space-x-3 mb-6 z-10"},m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=m("div",{id:"loading-modal-title",class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Loading Sounds..."}),r=m("div",{id:"loading-modal-subtext",class:"text-sm text-gray-400 mt-2 z-10 text-center",textContent:"Please wait while we dial it in."}),n=m("button",{id:"loading-modal-cancel",class:"cursor-pointer mt-6 z-10 text-sm text-purple-400 hover:text-purple-300 underline hidden",textContent:"Cancel"});return te("loading-modal",[i,e,t,r,n],{widthClass:"w-[360px]",maxWidthClass:"max-w-full"})}function vn(i,e){const t=i.querySelector("#loading-modal-cancel"),r=()=>{e()};return t==null||t.addEventListener("click",r),{detach:()=>{t==null||t.removeEventListener("click",r)},refreshUI:()=>{}}}class Sn{constructor(e){this.detachFn=null,this.modal=bn(),this.titleEl=this.modal.querySelector("#loading-modal-title"),this.subtextEl=this.modal.querySelector("#loading-modal-subtext"),this.cancelBtn=this.modal.querySelector("#loading-modal-cancel"),document.body.appendChild(this.modal);const t=vn(this.modal,e);this.detachFn=t.detach}show(e){e!=null&&e.title&&(this.titleEl.textContent=e.title),e!=null&&e.subtext&&(this.subtextEl.textContent=e.subtext),this.cancelBtn.classList.toggle("hidden",!(e!=null&&e.cancelable)),this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function ie(i){const e=i.startsWith("/")?i.substring(1):i;return(window.location.pathname.startsWith("/sequenzia")?"/sequenzia/":"./")+e}function Cn(){const i=m("div",{class:"mb-8"},m("img",{id:"splash-logo",src:ie("static/svg/sequenzia-logo.svg"),alt:"Sequenzia",class:"w-[300px] h-auto animate-fade-in rounded-xl"})),e=m("div",{class:"flex items-center space-x-2 mb-4"},m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=m("div",{class:"text-white text-xl font-medium"},"Loading Sequenzia ",m("span",{class:"animate-pulse"},"...")),r=m("div",{class:"relative flex flex-col items-center"},i,e,t);return m("div",{id:"splash-modal",class:"fixed inset-0 bg-black/90 flex items-center justify-center z-[9999] hidden"},r)}function Nn(i){return{detach:()=>{},refreshUI:()=>{}}}class wn{constructor(){this.detachFn=null,this.modal=Cn(),document.body.appendChild(this.modal);const e=Nn(this.modal);this.detachFn=e.detach,this.footerMain=document.getElementById("footer-main"),this.contentMain=document.getElementById("content-main"),this.splashLogo=this.modal.querySelector("#splash-logo")}show(){var e,t,r,n;this.splashLogo&&(this.splashLogo.src=ie("static/logo.png")),this.modal.classList.remove("hidden"),this.modal.style.opacity="1",(e=this.footerMain)==null||e.classList.remove("content-visible"),(t=this.footerMain)==null||t.classList.add("content-hidden"),(r=this.contentMain)==null||r.classList.remove("content-visible"),(n=this.contentMain)==null||n.classList.add("content-hidden")}hide(e=1e3){setTimeout(()=>{this.modal.style.opacity="0",this.modal.style.transition="opacity 0.5s ease-out",setTimeout(()=>{var t,r,n,s;this.modal.classList.add("hidden"),this.modal.style.opacity="1",(t=this.footerMain)==null||t.classList.remove("content-hidden"),(r=this.footerMain)==null||r.classList.add("content-visible"),(n=this.contentMain)==null||n.classList.remove("content-hidden"),(s=this.contentMain)==null||s.classList.add("content-visible")},500)},e)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Mn(){const i=m("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"API Key Required"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"In order to use AI Features, you must add an OpenAI API Key in the config."}),t=U({id:"key-not-set-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),r=m("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return m("div",{id:"openai-key-not-set-modal",class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"},r)}function xn(i){const e=i.querySelector("#key-not-set-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class Ln{constructor(){this.detachFn=null,this.modal=Mn(),document.body.appendChild(this.modal);const e=xn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function kn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"text-[100px] mb-6 animate-bounce z-10",textContent:"🤖"}),t=m("div",{class:"flex items-center space-x-3 mb-6 z-10"},m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),r=m("div",{class:"text-sm text-gray-400 mt-4 z-10 text-center",textContent:"AI is Generating..."}),n=m("div",{class:"relative flex flex-col items-center bg-gradient-to-br from-gray-800 to-gray-900 border border-purple-700 shadow-2xl rounded-2xl px-10 py-8 animate-fade-in w-[360px] max-w-full"},i,e,t,r);return m("div",{id:"ai-working-modal",class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},n)}function Gn(i){return{detach:()=>{},refreshUI:()=>{}}}class Bn{constructor(){this.detachFn=null,this.modal=kn(),document.body.appendChild(this.modal);const e=Gn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function En(){const i=m("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"AI Generation Failed"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"Unable to generate AI content. Please try again."}),t=U({id:"generation-failed-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),r=m("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return m("div",{id:"ai-generation-failed-modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"},r)}function An(i){const e=i.querySelector("#generation-failed-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class Tn{constructor(){this.detachFn=null,this.modal=En(),document.body.appendChild(this.modal);const e=An(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class In{constructor(e){this.onCancelLoading=e,this.initialize()}initialize(){this.errorModal=new mn,this.featureModal=new _n,this.loadingModal=new Sn(this.onCancelLoading),this.splashModal=new wn,this.openAIKeyNotSetModal=new Ln,this.aiWorkingModal=new Bn,this.aiGenerationFailedModal=new Tn}showError(e){this.errorModal.show(e)}showFeatureBlocked(){this.featureModal.show()}showOpenAIKeyNotSet(){this.openAIKeyNotSetModal.show()}showAIWorking(){this.aiWorkingModal.show()}hideAIWorking(){this.aiWorkingModal.hide()}showAIGenerationFailed(){this.aiGenerationFailedModal.show()}showLoading(e){this.loadingModal.show(e)}hideLoading(){this.loadingModal.hide()}showSplashScreen(){this.splashModal.show()}hideSplashScreen(){this.splashModal.hide()}destroy(){var e,t,r,n,s,a,o;(e=this.errorModal)==null||e.destroy(),(t=this.featureModal)==null||t.destroy(),(r=this.loadingModal)==null||r.destroy(),(n=this.splashModal)==null||n.destroy(),(s=this.openAIKeyNotSetModal)==null||s.destroy(),(a=this.aiWorkingModal)==null||a.destroy(),(o=this.aiGenerationFailedModal)==null||o.destroy()}reload(){this.destroy(),this.initialize()}}let Ot=null;function W(){return Ot||(Ot=new In(()=>{console.warn("User cancelled loading.")})),Ot}let Ls=!1;function $e(i="Loading Sounds...",e="Please wait while we dial it in.",t,r){if(sn()||Gs()&&!r)return;r&&(fi(),ks(!0));const n=W();n.showLoading({title:i,subtext:e,cancelable:!!t}),t&&(n.destroy(),n.reload())}function fi(i){i&&ks(!1),Gs()||W().hideLoading()}function ks(i){Ls=i}function Gs(){return Ls}let Je=0;function Bs(){Je++,Je===1&&$e()}function Es(){Je--,Je<=0&&(Je=0,fi())}async function Rn(i){Bs();try{return await i}finally{Es()}}const Pt=new Map;async function Fn(i,e){e?await i.load:await qn(i.load)}async function Ct(i,e=X(),t=null,r,n,s,a=!0){var C;const o=i.split("/");let l="sf2",d="musyngkite",c="acoustic_grand_piano";o.length===3?[l,d,c]=o:o.length===2?[d,c]=o:o.length===1&&(c=o[0]);const u=e instanceof OfflineAudioContext;Pt.has(e)||Pt.set(e,new Map);const h=Pt.get(e),f=String(e??X()),y=`${d}/${c}@${f}`;if(a&&h.has(y))return h.get(y);const b=Math.max(0,Math.min(127,Math.round((r??1)*127))),g=e.createStereoPanner();n!==void 0&&(g.pan.value=n);const p=e.createGain();p.connect(g),t&&t.context!==e&&(console.warn("[loadInstrument] Ignoring mismatched destination from different context"),t=null),g.connect(t||Ae(e));const v={instrument:c,volume:b,destination:p,disableScheduler:u};let S;if(d==="smolken")S=new qr(e,v);else if(d==="splendidgrandpiano")S=new Kr(e,v);else if(d==="mallets")S=new Hr(e,v);else if(d==="drummachines")S=new $r(e,v);else{const w={"fluidr3-gm":"FluidR3_GM",fatboy:"FatBoy",musyngkite:"MusyngKite"}[d.toLowerCase()]||"MusyngKite",G=`https://gleitz.github.io/midi-js-soundfonts/${w}/${c}-ogg.js`;S=new zr(e,{...v,instrumentUrl:G,kit:w})}if(await Fn(S,s??!1),d==="drummachines"){const N=((C=S.getSampleNames)==null?void 0:C.call(S))??[],w=new Map;N.forEach((L,G)=>{const E=36+G;w.set(E,L)}),S.__midiMap=w}const _=S;return _.setVolume=N=>{var L;const w=Math.max(0,Math.min(127,Math.round(N*127)));"output"in _&&typeof((L=_.output)==null?void 0:L.setVolume)=="function"&&_.output.setVolume(w)},_.setPan=N=>{g.pan.value=Math.max(-1,Math.min(1,N))},a&&h.set(y,_),_}async function On(){const e=Pn().map(r=>{switch(r){case"FluidR3_GM":return"fluidr3-gm";case"FatBoy":return"fatboy";case"MusyngKite":return"musyngkite";default:return r.toLowerCase()}}),t=["splendidgrandpiano","mallets","drummachines","smolken"];return[...new Set([...e,...t])]}function Pn(){const e=[...Xr()];return e.includes("FatBoy")||e.push("FatBoy"),e}async function Un(i){const e=i.toLowerCase();return e==="splendidgrandpiano"?["splendidgrandpiano"]:e==="mallets"?Jr():e==="drummachines"?vs():e==="smolken"?Wr():(await Ct(`${i}/acoustic_grand_piano`,X(),null,0,0,!0),jr()??[])}function Dn(){return vs()}async function qn(i){Bs();try{await i}finally{Es()}}function Kn(){return{name:"sf2",loadInstrument:Ct,getAvailableLibraries:On,getAvailableInstruments:Un}}let Ut=null,dt=null;function Le(){return Ut||(Ut=new AudioContext),Ut}function Hn(){if(!dt){const i=Le();dt=i.createGain(),dt.connect(i.destination)}return dt}const $n={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function $(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,r,n]=e,s=t.toUpperCase(),a=$n[s];if(a===void 0)return null;const o=[...r].reduce((d,c)=>c==="#"?d+1:c==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}let re=null,ii=null;async function zn(i){if(ii===i)return;re=await Ct(i,Le()),ii=i}function Jn(){return ii}function Wn(i,e=100,t=!1){var o;if(!re)return null;const n=Le().currentTime,s=$(i);if(s===null)return null;const a=((o=re.__midiMap)==null?void 0:o.get(s))??s;return re.start({note:a,stopId:a,velocity:e,time:n,loop:t}),()=>{re==null||re.stop({stopId:a})}}function jn(i){var r;if(!re)return;const e=$(i);if(e===null)return;const t=((r=re.__midiMap)==null?void 0:r.get(e))??e;re.stop({stopId:t})}async function Xn(i,e,t,r=100,n=!1,s=null,a=null,o=null,l,d){var y;const c=a||X(),u=await Ct(i,c,o,l,d);l!==void 0&&u.setVolume&&u.setVolume(l),d!==void 0&&u.setPan&&u.setPan(d);const h=$(e);if(h===null)return null;const f=((y=u.__midiMap)==null?void 0:y.get(h))??h;return u.start({note:f,duration:t,velocity:r,loop:n,time:s??c.currentTime}),null}function Vn(){return{name:"sf2",setActiveInstrument:zn,getActiveInstrumentName:Jn,playNote:Wn,stopNoteByPitch:jn,loadAndPlayNote:Xn}}const Xe=[{id:"0000_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Grand Piano"},{id:"0000_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Grand Piano"},{id:"0000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Grand Piano"},{id:"0000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Grand Piano"},{id:"0000_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Grand Piano"},{id:"0000_SBLive_sf2",library:"SBLive",displayName:"Acoustic Grand Piano"},{id:"0000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Grand Piano"},{id:"0010_Aspirin_sf2_file",library:"Aspirin",displayName:"Bright Acoustic Piano"},{id:"0010_Chaos_sf2_file",library:"Chaos",displayName:"Bright Acoustic Piano"},{id:"0010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bright Acoustic Piano"},{id:"0010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bright Acoustic Piano"},{id:"0010_JCLive_sf2_file",library:"JCLive",displayName:"Bright Acoustic Piano"},{id:"0010_SBLive_sf2",library:"SBLive",displayName:"Bright Acoustic Piano"},{id:"0010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bright Acoustic Piano"},{id:"0020_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Grand Piano"},{id:"0020_Chaos_sf2_file",library:"Chaos",displayName:"Electric Grand Piano"},{id:"0020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Grand Piano"},{id:"0020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Grand Piano"},{id:"0020_JCLive_sf2_file",library:"JCLive",displayName:"Electric Grand Piano"},{id:"0020_SBLive_sf2",library:"SBLive",displayName:"Electric Grand Piano"},{id:"0020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Grand Piano"},{id:"0050_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Piano 2"},{id:"0050_Chaos_sf2_file",library:"Chaos",displayName:"Electric Piano 2"},{id:"0050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Piano 2"},{id:"0050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Piano 2"},{id:"0050_JCLive_sf2_file",library:"JCLive",displayName:"Electric Piano 2"},{id:"0050_SBLive_sf2",library:"SBLive",displayName:"Electric Piano 2"},{id:"0050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Piano 2"},{id:"0060_Aspirin_sf2_file",library:"Aspirin",displayName:"Harpsichord"},{id:"0060_Chaos_sf2_file",library:"Chaos",displayName:"Harpsichord"},{id:"0060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harpsichord"},{id:"0060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harpsichord"},{id:"0060_JCLive_sf2_file",library:"JCLive",displayName:"Harpsichord"},{id:"0060_SBLive_sf2",library:"SBLive",displayName:"Harpsichord"},{id:"0060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harpsichord"},{id:"0070_Aspirin_sf2_file",library:"Aspirin",displayName:"Clavinet"},{id:"0070_Chaos_sf2_file",library:"Chaos",displayName:"Clavinet"},{id:"0070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clavinet"},{id:"0070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clavinet"},{id:"0070_JCLive_sf2_file",library:"JCLive",displayName:"Clavinet"},{id:"0070_SBLive_sf2",library:"SBLive",displayName:"Clavinet"},{id:"0070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clavinet"},{id:"0080_Aspirin_sf2_file",library:"Aspirin",displayName:"Celesta"},{id:"0080_Chaos_sf2_file",library:"Chaos",displayName:"Celesta"},{id:"0080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Celesta"},{id:"0080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Celesta"},{id:"0080_JCLive_sf2_file",library:"JCLive",displayName:"Celesta"},{id:"0080_SBLive_sf2",library:"SBLive",displayName:"Celesta"},{id:"0080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Celesta"},{id:"0090_Aspirin_sf2_file",library:"Aspirin",displayName:"Glockenspiel"},{id:"0090_Chaos_sf2_file",library:"Chaos",displayName:"Glockenspiel"},{id:"0090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Glockenspiel"},{id:"0090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Glockenspiel"},{id:"0090_JCLive_sf2_file",library:"JCLive",displayName:"Glockenspiel"},{id:"0090_SBLive_sf2",library:"SBLive",displayName:"Glockenspiel"},{id:"0090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Glockenspiel"},{id:"0100_Aspirin_sf2_file",library:"Aspirin",displayName:"Music Box"},{id:"0100_Chaos_sf2_file",library:"Chaos",displayName:"Music Box"},{id:"0100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Music Box"},{id:"0100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Music Box"},{id:"0100_JCLive_sf2_file",library:"JCLive",displayName:"Music Box"},{id:"0100_SBLive_sf2",library:"SBLive",displayName:"Music Box"},{id:"0100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Music Box"},{id:"0110_Aspirin_sf2_file",library:"Aspirin",displayName:"Vibraphone"},{id:"0110_Chaos_sf2_file",library:"Chaos",displayName:"Vibraphone"},{id:"0110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Vibraphone"},{id:"0110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Vibraphone"},{id:"0110_JCLive_sf2_file",library:"JCLive",displayName:"Vibraphone"},{id:"0110_SBLive_sf2",library:"SBLive",displayName:"Vibraphone"},{id:"0110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Vibraphone"},{id:"0120_Aspirin_sf2_file",library:"Aspirin",displayName:"Marimba"},{id:"0120_Chaos_sf2_file",library:"Chaos",displayName:"Marimba"},{id:"0120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Marimba"},{id:"0120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Marimba"},{id:"0120_JCLive_sf2_file",library:"JCLive",displayName:"Marimba"},{id:"0120_SBLive_sf2",library:"SBLive",displayName:"Marimba"},{id:"0120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Marimba"},{id:"0130_Aspirin_sf2_file",library:"Aspirin",displayName:"Xylophone"},{id:"0130_Chaos_sf2_file",library:"Chaos",displayName:"Xylophone"},{id:"0130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Xylophone"},{id:"0130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Xylophone"},{id:"0130_JCLive_sf2_file",library:"JCLive",displayName:"Xylophone"},{id:"0130_SBLive_sf2",library:"SBLive",displayName:"Xylophone"},{id:"0130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Xylophone"},{id:"0140_Aspirin_sf2_file",library:"Aspirin",displayName:"Tubular Bells"},{id:"0140_Chaos_sf2_file",library:"Chaos",displayName:"Tubular Bells"},{id:"0140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tubular Bells"},{id:"0140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tubular Bells"},{id:"0140_JCLive_sf2_file",library:"JCLive",displayName:"Tubular Bells"},{id:"0140_SBLive_sf2",library:"SBLive",displayName:"Tubular Bells"},{id:"0140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tubular Bells"},{id:"0150_Aspirin_sf2_file",library:"Aspirin",displayName:"Dulcimer"},{id:"0150_Chaos_sf2_file",library:"Chaos",displayName:"Dulcimer"},{id:"0150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Dulcimer"},{id:"0150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Dulcimer"},{id:"0150_JCLive_sf2_file",library:"JCLive",displayName:"Dulcimer"},{id:"0150_SBLive_sf2",library:"SBLive",displayName:"Dulcimer"},{id:"0150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Dulcimer"},{id:"0160_Aspirin_sf2_file",library:"Aspirin",displayName:"Drawbar Organ"},{id:"0160_Chaos_sf2_file",library:"Chaos",displayName:"Drawbar Organ"},{id:"0160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drawbar Organ"},{id:"0160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Drawbar Organ"},{id:"0160_JCLive_sf2_file",library:"JCLive",displayName:"Drawbar Organ"},{id:"0160_SBLive_sf2",library:"SBLive",displayName:"Drawbar Organ"},{id:"0160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Drawbar Organ"},{id:"0170_Aspirin_sf2_file",library:"Aspirin",displayName:"Percussive Organ"},{id:"0170_Chaos_sf2_file",library:"Chaos",displayName:"Percussive Organ"},{id:"0170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Percussive Organ"},{id:"0170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Percussive Organ"},{id:"0170_JCLive_sf2_file",library:"JCLive",displayName:"Percussive Organ"},{id:"0170_SBLive_sf2",library:"SBLive",displayName:"Percussive Organ"},{id:"0170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Percussive Organ"},{id:"0180_Aspirin_sf2_file",library:"Aspirin",displayName:"Rock Organ"},{id:"0180_Chaos_sf2_file",library:"Chaos",displayName:"Rock Organ"},{id:"0180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Rock Organ"},{id:"0180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Rock Organ"},{id:"0180_JCLive_sf2_file",library:"JCLive",displayName:"Rock Organ"},{id:"0180_SBLive_sf2",library:"SBLive",displayName:"Rock Organ"},{id:"0180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Rock Organ"},{id:"0190_Aspirin_sf2_file",library:"Aspirin",displayName:"Church Organ"},{id:"0190_Chaos_sf2_file",library:"Chaos",displayName:"Church Organ"},{id:"0190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Church Organ"},{id:"0190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Church Organ"},{id:"0190_JCLive_sf2_file",library:"JCLive",displayName:"Church Organ"},{id:"0190_SBLive_sf2",library:"SBLive",displayName:"Church Organ"},{id:"0190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Church Organ"},{id:"0200_Aspirin_sf2_file",library:"Aspirin",displayName:"Reed Organ"},{id:"0200_Chaos_sf2_file",library:"Chaos",displayName:"Reed Organ"},{id:"0200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reed Organ"},{id:"0200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reed Organ"},{id:"0200_JCLive_sf2_file",library:"JCLive",displayName:"Reed Organ"},{id:"0200_SBLive_sf2",library:"SBLive",displayName:"Reed Organ"},{id:"0200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reed Organ"},{id:"0210_Aspirin_sf2_file",library:"Aspirin",displayName:"Accordion"},{id:"0210_Chaos_sf2_file",library:"Chaos",displayName:"Accordion"},{id:"0210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Accordion"},{id:"0210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Accordion"},{id:"0210_JCLive_sf2_file",library:"JCLive",displayName:"Accordion"},{id:"0210_SBLive_sf2",library:"SBLive",displayName:"Accordion"},{id:"0210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Accordion"},{id:"0220_Aspirin_sf2_file",library:"Aspirin",displayName:"Harmonica"},{id:"0220_Chaos_sf2_file",library:"Chaos",displayName:"Harmonica"},{id:"0220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harmonica"},{id:"0220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harmonica"},{id:"0220_JCLive_sf2_file",library:"JCLive",displayName:"Harmonica"},{id:"0220_SBLive_sf2",library:"SBLive",displayName:"Harmonica"},{id:"0220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harmonica"},{id:"0230_Aspirin_sf2_file",library:"Aspirin",displayName:"Tango Accordion"},{id:"0230_Chaos_sf2_file",library:"Chaos",displayName:"Tango Accordion"},{id:"0230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tango Accordion"},{id:"0230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tango Accordion"},{id:"0230_JCLive_sf2_file",library:"JCLive",displayName:"Tango Accordion"},{id:"0230_SBLive_sf2",library:"SBLive",displayName:"Tango Accordion"},{id:"0230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tango Accordion"},{id:"0240_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (nylon)"},{id:"0240_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (nylon)"},{id:"0240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (nylon)"},{id:"0240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (nylon)"},{id:"0240_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (nylon)"},{id:"0250_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (steel)"},{id:"0250_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (steel)"},{id:"0250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (steel)"},{id:"0250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (steel)"},{id:"0250_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (steel)"},{id:"0260_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (jazz)"},{id:"0260_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (jazz)"},{id:"0260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (jazz)"},{id:"0260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (jazz)"},{id:"0260_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (jazz)"},{id:"0270_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (clean)"},{id:"0270_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (clean)"},{id:"0270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (clean)"},{id:"0270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (clean)"},{id:"0270_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (clean)"},{id:"0270_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (clean)"},{id:"0270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (clean)"},{id:"0280_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (muted)"},{id:"0280_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (muted)"},{id:"0280_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (muted)"},{id:"0280_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (muted)"},{id:"0280_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (muted)"},{id:"0280_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (muted)"},{id:"0280_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (muted)"},{id:"0290_Aspirin_sf2_file",library:"Aspirin",displayName:"Overdriven Guitar"},{id:"0290_Chaos_sf2_file",library:"Chaos",displayName:"Overdriven Guitar"},{id:"0290_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Overdriven Guitar"},{id:"0290_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Overdriven Guitar"},{id:"0290_JCLive_sf2_file",library:"JCLive",displayName:"Overdriven Guitar"},{id:"0290_SBLive_sf2",library:"SBLive",displayName:"Overdriven Guitar"},{id:"0290_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Overdriven Guitar"},{id:"0300_Aspirin_sf2_file",library:"Aspirin",displayName:"Distortion Guitar"},{id:"0300_Chaos_sf2_file",library:"Chaos",displayName:"Distortion Guitar"},{id:"0300_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Distortion Guitar"},{id:"0300_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Distortion Guitar"},{id:"0300_JCLive_sf2_file",library:"JCLive",displayName:"Distortion Guitar"},{id:"0300_SBLive_sf2",library:"SBLive",displayName:"Distortion Guitar"},{id:"0300_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Distortion Guitar"},{id:"0310_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Harmonics"},{id:"0310_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Harmonics"},{id:"0310_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Harmonics"},{id:"0310_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Harmonics"},{id:"0310_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Harmonics"},{id:"0310_SBLive_sf2",library:"SBLive",displayName:"Guitar Harmonics"},{id:"0310_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Harmonics"},{id:"0320_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Bass"},{id:"0320_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Bass"},{id:"0320_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Bass"},{id:"0320_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Bass"},{id:"0320_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Bass"},{id:"0320_SBLive_sf2",library:"SBLive",displayName:"Acoustic Bass"},{id:"0320_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Bass"},{id:"0330_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (finger)"},{id:"0330_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (finger)"},{id:"0330_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (finger)"},{id:"0330_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (finger)"},{id:"0330_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (finger)"},{id:"0330_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (finger)"},{id:"0330_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (finger)"},{id:"0340_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (pick)"},{id:"0340_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (pick)"},{id:"0340_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (pick)"},{id:"0340_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (pick)"},{id:"0340_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (pick)"},{id:"0340_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (pick)"},{id:"0340_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (pick)"},{id:"0350_Aspirin_sf2_file",library:"Aspirin",displayName:"Fretless Bass"},{id:"0350_Chaos_sf2_file",library:"Chaos",displayName:"Fretless Bass"},{id:"0350_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fretless Bass"},{id:"0350_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fretless Bass"},{id:"0350_JCLive_sf2_file",library:"JCLive",displayName:"Fretless Bass"},{id:"0350_SBLive_sf2",library:"SBLive",displayName:"Fretless Bass"},{id:"0350_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fretless Bass"},{id:"0360_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 1"},{id:"0360_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 1"},{id:"0360_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 1"},{id:"0360_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 1"},{id:"0360_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 1"},{id:"0360_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 1"},{id:"0360_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 1"},{id:"0370_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 2"},{id:"0370_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 2"},{id:"0370_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 2"},{id:"0370_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 2"},{id:"0370_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 2"},{id:"0370_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 2"},{id:"0370_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 2"},{id:"0380_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 1"},{id:"0380_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 1"},{id:"0380_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 1"},{id:"0380_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 1"},{id:"0380_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 1"},{id:"0380_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 1"},{id:"0380_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 1"},{id:"0390_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 2"},{id:"0390_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 2"},{id:"0390_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 2"},{id:"0390_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 2"},{id:"0390_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 2"},{id:"0390_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 2"},{id:"0390_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 2"},{id:"0400_Aspirin_sf2_file",library:"Aspirin",displayName:"Violin"},{id:"0400_Chaos_sf2_file",library:"Chaos",displayName:"Violin"},{id:"0400_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Violin"},{id:"0400_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Violin"},{id:"0400_JCLive_sf2_file",library:"JCLive",displayName:"Violin"},{id:"0400_SBLive_sf2",library:"SBLive",displayName:"Violin"},{id:"0400_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Violin"},{id:"0410_Aspirin_sf2_file",library:"Aspirin",displayName:"Viola"},{id:"0410_Chaos_sf2_file",library:"Chaos",displayName:"Viola"},{id:"0410_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Viola"},{id:"0410_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Viola"},{id:"0410_JCLive_sf2_file",library:"JCLive",displayName:"Viola"},{id:"0410_SBLive_sf2",library:"SBLive",displayName:"Viola"},{id:"0410_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Viola"},{id:"0420_Aspirin_sf2_file",library:"Aspirin",displayName:"Cello"},{id:"0420_Chaos_sf2_file",library:"Chaos",displayName:"Cello"},{id:"0420_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Cello"},{id:"0420_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Cello"},{id:"0420_JCLive_sf2_file",library:"JCLive",displayName:"Cello"},{id:"0420_SBLive_sf2",library:"SBLive",displayName:"Cello"},{id:"0420_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Cello"},{id:"0430_Aspirin_sf2_file",library:"Aspirin",displayName:"Contrabass"},{id:"0430_Chaos_sf2_file",library:"Chaos",displayName:"Contrabass"},{id:"0430_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Contrabass"},{id:"0430_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Contrabass"},{id:"0430_JCLive_sf2_file",library:"JCLive",displayName:"Contrabass"},{id:"0430_SBLive_sf2",library:"SBLive",displayName:"Contrabass"},{id:"0430_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Contrabass"},{id:"0440_Aspirin_sf2_file",library:"Aspirin",displayName:"Tremolo Strings"},{id:"0440_Chaos_sf2_file",library:"Chaos",displayName:"Tremolo Strings"},{id:"0440_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tremolo Strings"},{id:"0440_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tremolo Strings"},{id:"0440_JCLive_sf2_file",library:"JCLive",displayName:"Tremolo Strings"},{id:"0440_SBLive_sf2",library:"SBLive",displayName:"Tremolo Strings"},{id:"0440_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tremolo Strings"},{id:"0450_Aspirin_sf2_file",library:"Aspirin",displayName:"Pizzicato Strings"},{id:"0450_Chaos_sf2_file",library:"Chaos",displayName:"Pizzicato Strings"},{id:"0450_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pizzicato Strings"},{id:"0450_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pizzicato Strings"},{id:"0450_JCLive_sf2_file",library:"JCLive",displayName:"Pizzicato Strings"},{id:"0450_SBLive_sf2",library:"SBLive",displayName:"Pizzicato Strings"},{id:"0450_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pizzicato Strings"},{id:"0460_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestral Harp"},{id:"0460_Chaos_sf2_file",library:"Chaos",displayName:"Orchestral Harp"},{id:"0460_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestral Harp"},{id:"0460_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestral Harp"},{id:"0460_JCLive_sf2_file",library:"JCLive",displayName:"Orchestral Harp"},{id:"0460_SBLive_sf2",library:"SBLive",displayName:"Orchestral Harp"},{id:"0460_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestral Harp"},{id:"0470_Aspirin_sf2_file",library:"Aspirin",displayName:"Timpani"},{id:"0470_Chaos_sf2_file",library:"Chaos",displayName:"Timpani"},{id:"0470_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Timpani"},{id:"0470_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Timpani"},{id:"0470_JCLive_sf2_file",library:"JCLive",displayName:"Timpani"},{id:"0470_SBLive_sf2",library:"SBLive",displayName:"Timpani"},{id:"0470_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Timpani"},{id:"0480_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 1"},{id:"0480_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 1"},{id:"0480_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 1"},{id:"0480_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 1"},{id:"0480_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 1"},{id:"0480_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 1"},{id:"0480_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 1"},{id:"0490_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 2"},{id:"0490_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 2"},{id:"0490_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 2"},{id:"0490_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 2"},{id:"0490_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 2"},{id:"0490_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 2"},{id:"0490_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 2"},{id:"0500_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 1"},{id:"0500_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 1"},{id:"0500_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 1"},{id:"0500_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 1"},{id:"0500_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 1"},{id:"0500_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 1"},{id:"0500_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 1"},{id:"0510_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 2"},{id:"0510_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 2"},{id:"0510_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 2"},{id:"0510_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 2"},{id:"0510_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 2"},{id:"0510_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 2"},{id:"0510_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 2"},{id:"0520_Aspirin_sf2_file",library:"Aspirin",displayName:"Choir Aahs"},{id:"0520_Chaos_sf2_file",library:"Chaos",displayName:"Choir Aahs"},{id:"0520_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Choir Aahs"},{id:"0520_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Choir Aahs"},{id:"0520_JCLive_sf2_file",library:"JCLive",displayName:"Choir Aahs"},{id:"0520_SBLive_sf2",library:"SBLive",displayName:"Choir Aahs"},{id:"0520_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Choir Aahs"},{id:"0530_Aspirin_sf2_file",library:"Aspirin",displayName:"Voice Oohs"},{id:"0530_Chaos_sf2_file",library:"Chaos",displayName:"Voice Oohs"},{id:"0530_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Voice Oohs"},{id:"0530_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Voice Oohs"},{id:"0530_JCLive_sf2_file",library:"JCLive",displayName:"Voice Oohs"},{id:"0530_SBLive_sf2",library:"SBLive",displayName:"Voice Oohs"},{id:"0530_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Voice Oohs"},{id:"0540_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Choir"},{id:"0540_Chaos_sf2_file",library:"Chaos",displayName:"Synth Choir"},{id:"0540_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Choir"},{id:"0540_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Choir"},{id:"0540_JCLive_sf2_file",library:"JCLive",displayName:"Synth Choir"},{id:"0540_SBLive_sf2",library:"SBLive",displayName:"Synth Choir"},{id:"0540_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Choir"},{id:"0550_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestra Hit"},{id:"0550_Chaos_sf2_file",library:"Chaos",displayName:"Orchestra Hit"},{id:"0550_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestra Hit"},{id:"0550_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestra Hit"},{id:"0550_JCLive_sf2_file",library:"JCLive",displayName:"Orchestra Hit"},{id:"0550_SBLive_sf2",library:"SBLive",displayName:"Orchestra Hit"},{id:"0550_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestra Hit"},{id:"0560_Aspirin_sf2_file",library:"Aspirin",displayName:"Trumpet"},{id:"0560_Chaos_sf2_file",library:"Chaos",displayName:"Trumpet"},{id:"0560_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trumpet"},{id:"0560_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trumpet"},{id:"0560_JCLive_sf2_file",library:"JCLive",displayName:"Trumpet"},{id:"0560_SBLive_sf2",library:"SBLive",displayName:"Trumpet"},{id:"0560_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trumpet"},{id:"0570_Aspirin_sf2_file",library:"Aspirin",displayName:"Trombone"},{id:"0570_Chaos_sf2_file",library:"Chaos",displayName:"Trombone"},{id:"0570_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trombone"},{id:"0570_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trombone"},{id:"0570_JCLive_sf2_file",library:"JCLive",displayName:"Trombone"},{id:"0570_SBLive_sf2",library:"SBLive",displayName:"Trombone"},{id:"0570_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trombone"},{id:"0580_Aspirin_sf2_file",library:"Aspirin",displayName:"Tuba"},{id:"0580_Chaos_sf2_file",library:"Chaos",displayName:"Tuba"},{id:"0580_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tuba"},{id:"0580_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tuba"},{id:"0580_JCLive_sf2_file",library:"JCLive",displayName:"Tuba"},{id:"0580_SBLive_sf2",library:"SBLive",displayName:"Tuba"},{id:"0580_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tuba"},{id:"0590_Aspirin_sf2_file",library:"Aspirin",displayName:"Muted Trumpet"},{id:"0590_Chaos_sf2_file",library:"Chaos",displayName:"Muted Trumpet"},{id:"0590_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Muted Trumpet"},{id:"0590_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Muted Trumpet"},{id:"0590_JCLive_sf2_file",library:"JCLive",displayName:"Muted Trumpet"},{id:"0590_SBLive_sf2",library:"SBLive",displayName:"Muted Trumpet"},{id:"0590_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Muted Trumpet"},{id:"0600_Aspirin_sf2_file",library:"Aspirin",displayName:"French Horn"},{id:"0600_Chaos_sf2_file",library:"Chaos",displayName:"French Horn"},{id:"0600_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"French Horn"},{id:"0600_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"French Horn"},{id:"0600_JCLive_sf2_file",library:"JCLive",displayName:"French Horn"},{id:"0600_SBLive_sf2",library:"SBLive",displayName:"French Horn"},{id:"0600_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"French Horn"},{id:"0610_Aspirin_sf2_file",library:"Aspirin",displayName:"Brass Section"},{id:"0610_Chaos_sf2_file",library:"Chaos",displayName:"Brass Section"},{id:"0610_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Brass Section"},{id:"0610_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Brass Section"},{id:"0610_JCLive_sf2_file",library:"JCLive",displayName:"Brass Section"},{id:"0610_SBLive_sf2",library:"SBLive",displayName:"Brass Section"},{id:"0610_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Brass Section"},{id:"0620_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 1"},{id:"0620_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 1"},{id:"0620_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 1"},{id:"0620_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 1"},{id:"0620_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 1"},{id:"0620_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 1"},{id:"0620_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 1"},{id:"0630_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 2"},{id:"0630_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 2"},{id:"0630_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 2"},{id:"0630_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 2"},{id:"0630_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 2"},{id:"0630_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 2"},{id:"0630_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 2"},{id:"0640_Aspirin_sf2_file",library:"Aspirin",displayName:"Soprano Sax"},{id:"0640_Chaos_sf2_file",library:"Chaos",displayName:"Soprano Sax"},{id:"0640_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Soprano Sax"},{id:"0640_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Soprano Sax"},{id:"0640_JCLive_sf2_file",library:"JCLive",displayName:"Soprano Sax"},{id:"0640_SBLive_sf2",library:"SBLive",displayName:"Soprano Sax"},{id:"0640_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Soprano Sax"},{id:"0650_Aspirin_sf2_file",library:"Aspirin",displayName:"Alto Sax"},{id:"0650_Chaos_sf2_file",library:"Chaos",displayName:"Alto Sax"},{id:"0650_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Alto Sax"},{id:"0650_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Alto Sax"},{id:"0650_JCLive_sf2_file",library:"JCLive",displayName:"Alto Sax"},{id:"0650_SBLive_sf2",library:"SBLive",displayName:"Alto Sax"},{id:"0650_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Alto Sax"},{id:"0660_Aspirin_sf2_file",library:"Aspirin",displayName:"Tenor Sax"},{id:"0660_Chaos_sf2_file",library:"Chaos",displayName:"Tenor Sax"},{id:"0660_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tenor Sax"},{id:"0660_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tenor Sax"},{id:"0660_JCLive_sf2_file",library:"JCLive",displayName:"Tenor Sax"},{id:"0660_SBLive_sf2",library:"SBLive",displayName:"Tenor Sax"},{id:"0660_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tenor Sax"},{id:"0670_Aspirin_sf2_file",library:"Aspirin",displayName:"Baritone Sax"},{id:"0670_Chaos_sf2_file",library:"Chaos",displayName:"Baritone Sax"},{id:"0670_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Baritone Sax"},{id:"0670_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Baritone Sax"},{id:"0670_JCLive_sf2_file",library:"JCLive",displayName:"Baritone Sax"},{id:"0670_SBLive_sf2",library:"SBLive",displayName:"Baritone Sax"},{id:"0670_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Baritone Sax"},{id:"0680_Aspirin_sf2_file",library:"Aspirin",displayName:"Oboe"},{id:"0680_Chaos_sf2_file",library:"Chaos",displayName:"Oboe"},{id:"0680_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Oboe"},{id:"0680_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Oboe"},{id:"0680_JCLive_sf2_file",library:"JCLive",displayName:"Oboe"},{id:"0680_SBLive_sf2",library:"SBLive",displayName:"Oboe"},{id:"0680_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Oboe"},{id:"0690_Aspirin_sf2_file",library:"Aspirin",displayName:"English Horn"},{id:"0690_Chaos_sf2_file",library:"Chaos",displayName:"English Horn"},{id:"0690_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"English Horn"},{id:"0690_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"English Horn"},{id:"0690_JCLive_sf2_file",library:"JCLive",displayName:"English Horn"},{id:"0690_SBLive_sf2",library:"SBLive",displayName:"English Horn"},{id:"0690_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"English Horn"},{id:"0700_Aspirin_sf2_file",library:"Aspirin",displayName:"Bassoon"},{id:"0700_Chaos_sf2_file",library:"Chaos",displayName:"Bassoon"},{id:"0700_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bassoon"},{id:"0700_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bassoon"},{id:"0700_JCLive_sf2_file",library:"JCLive",displayName:"Bassoon"},{id:"0700_SBLive_sf2",library:"SBLive",displayName:"Bassoon"},{id:"0700_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bassoon"},{id:"0710_Aspirin_sf2_file",library:"Aspirin",displayName:"Clarinet"},{id:"0710_Chaos_sf2_file",library:"Chaos",displayName:"Clarinet"},{id:"0710_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clarinet"},{id:"0710_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clarinet"},{id:"0710_JCLive_sf2_file",library:"JCLive",displayName:"Clarinet"},{id:"0710_SBLive_sf2",library:"SBLive",displayName:"Clarinet"},{id:"0710_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clarinet"},{id:"0720_Aspirin_sf2_file",library:"Aspirin",displayName:"Piccolo"},{id:"0720_Chaos_sf2_file",library:"Chaos",displayName:"Piccolo"},{id:"0720_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Piccolo"},{id:"0720_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Piccolo"},{id:"0720_JCLive_sf2_file",library:"JCLive",displayName:"Piccolo"},{id:"0720_SBLive_sf2",library:"SBLive",displayName:"Piccolo"},{id:"0720_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Piccolo"},{id:"0730_Aspirin_sf2_file",library:"Aspirin",displayName:"Flute"},{id:"0730_Chaos_sf2_file",library:"Chaos",displayName:"Flute"},{id:"0730_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Flute"},{id:"0730_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Flute"},{id:"0730_JCLive_sf2_file",library:"JCLive",displayName:"Flute"},{id:"0730_SBLive_sf2",library:"SBLive",displayName:"Flute"},{id:"0730_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Flute"},{id:"0740_Aspirin_sf2_file",library:"Aspirin",displayName:"Recorder"},{id:"0740_Chaos_sf2_file",library:"Chaos",displayName:"Recorder"},{id:"0740_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Recorder"},{id:"0740_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Recorder"},{id:"0740_JCLive_sf2_file",library:"JCLive",displayName:"Recorder"},{id:"0740_SBLive_sf2",library:"SBLive",displayName:"Recorder"},{id:"0740_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Recorder"},{id:"0750_Aspirin_sf2_file",library:"Aspirin",displayName:"Pan Flute"},{id:"0750_Chaos_sf2_file",library:"Chaos",displayName:"Pan Flute"},{id:"0750_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pan Flute"},{id:"0750_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pan Flute"},{id:"0750_JCLive_sf2_file",library:"JCLive",displayName:"Pan Flute"},{id:"0750_SBLive_sf2",library:"SBLive",displayName:"Pan Flute"},{id:"0750_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pan Flute"},{id:"0760_Aspirin_sf2_file",library:"Aspirin",displayName:"Blown Bottle"},{id:"0760_Chaos_sf2_file",library:"Chaos",displayName:"Blown Bottle"},{id:"0760_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Blown Bottle"},{id:"0760_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Blown Bottle"},{id:"0760_JCLive_sf2_file",library:"JCLive",displayName:"Blown Bottle"},{id:"0760_SBLive_sf2",library:"SBLive",displayName:"Blown Bottle"},{id:"0760_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Blown Bottle"},{id:"0770_Aspirin_sf2_file",library:"Aspirin",displayName:"Shakuhachi"},{id:"0770_Chaos_sf2_file",library:"Chaos",displayName:"Shakuhachi"},{id:"0770_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shakuhachi"},{id:"0770_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shakuhachi"},{id:"0770_JCLive_sf2_file",library:"JCLive",displayName:"Shakuhachi"},{id:"0770_SBLive_sf2",library:"SBLive",displayName:"Shakuhachi"},{id:"0770_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shakuhachi"},{id:"0780_Aspirin_sf2_file",library:"Aspirin",displayName:"Whistle"},{id:"0780_Chaos_sf2_file",library:"Chaos",displayName:"Whistle"},{id:"0780_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Whistle"},{id:"0780_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Whistle"},{id:"0780_JCLive_sf2_file",library:"JCLive",displayName:"Whistle"},{id:"0780_SBLive_sf2",library:"SBLive",displayName:"Whistle"},{id:"0780_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Whistle"},{id:"0790_Aspirin_sf2_file",library:"Aspirin",displayName:"Ocarina"},{id:"0790_Chaos_sf2_file",library:"Chaos",displayName:"Ocarina"},{id:"0790_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Ocarina"},{id:"0790_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Ocarina"},{id:"0790_JCLive_sf2_file",library:"JCLive",displayName:"Ocarina"},{id:"0790_SBLive_sf2",library:"SBLive",displayName:"Ocarina"},{id:"0790_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Ocarina"},{id:"0800_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 1 (square)"},{id:"0800_Chaos_sf2_file",library:"Chaos",displayName:"Lead 1 (square)"},{id:"0800_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 1 (square)"},{id:"0800_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 1 (square)"},{id:"0800_JCLive_sf2_file",library:"JCLive",displayName:"Lead 1 (square)"},{id:"0800_SBLive_sf2",library:"SBLive",displayName:"Lead 1 (square)"},{id:"0800_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 1 (square)"},{id:"0810_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 2 (sawtooth)"},{id:"0810_Chaos_sf2_file",library:"Chaos",displayName:"Lead 2 (sawtooth)"},{id:"0810_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 2 (sawtooth)"},{id:"0810_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 2 (sawtooth)"},{id:"0810_JCLive_sf2_file",library:"JCLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SBLive_sf2",library:"SBLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 2 (sawtooth)"},{id:"0820_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 3 (calliope)"},{id:"0820_Chaos_sf2_file",library:"Chaos",displayName:"Lead 3 (calliope)"},{id:"0820_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 3 (calliope)"},{id:"0820_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 3 (calliope)"},{id:"0820_JCLive_sf2_file",library:"JCLive",displayName:"Lead 3 (calliope)"},{id:"0820_SBLive_sf2",library:"SBLive",displayName:"Lead 3 (calliope)"},{id:"0820_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 3 (calliope)"},{id:"0830_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 4 (chiff)"},{id:"0830_Chaos_sf2_file",library:"Chaos",displayName:"Lead 4 (chiff)"},{id:"0830_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 4 (chiff)"},{id:"0830_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 4 (chiff)"},{id:"0830_JCLive_sf2_file",library:"JCLive",displayName:"Lead 4 (chiff)"},{id:"0830_SBLive_sf2",library:"SBLive",displayName:"Lead 4 (chiff)"},{id:"0830_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 4 (chiff)"},{id:"0840_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 5 (charang)"},{id:"0840_Chaos_sf2_file",library:"Chaos",displayName:"Lead 5 (charang)"},{id:"0840_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 5 (charang)"},{id:"0840_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 5 (charang)"},{id:"0840_JCLive_sf2_file",library:"JCLive",displayName:"Lead 5 (charang)"},{id:"0840_SBLive_sf2",library:"SBLive",displayName:"Lead 5 (charang)"},{id:"0840_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 5 (charang)"},{id:"0850_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 6 (voice)"},{id:"0850_Chaos_sf2_file",library:"Chaos",displayName:"Lead 6 (voice)"},{id:"0850_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 6 (voice)"},{id:"0850_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 6 (voice)"},{id:"0850_JCLive_sf2_file",library:"JCLive",displayName:"Lead 6 (voice)"},{id:"0850_SBLive_sf2",library:"SBLive",displayName:"Lead 6 (voice)"},{id:"0850_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 6 (voice)"},{id:"0860_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 7 (fifths)"},{id:"0860_Chaos_sf2_file",library:"Chaos",displayName:"Lead 7 (fifths)"},{id:"0860_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 7 (fifths)"},{id:"0860_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 7 (fifths)"},{id:"0860_JCLive_sf2_file",library:"JCLive",displayName:"Lead 7 (fifths)"},{id:"0860_SBLive_sf2",library:"SBLive",displayName:"Lead 7 (fifths)"},{id:"0860_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 7 (fifths)"},{id:"0870_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 8 (bass + lead)"},{id:"0870_Chaos_sf2_file",library:"Chaos",displayName:"Lead 8 (bass + lead)"},{id:"0870_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 8 (bass + lead)"},{id:"0870_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 8 (bass + lead)"},{id:"0870_JCLive_sf2_file",library:"JCLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SBLive_sf2",library:"SBLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 8 (bass + lead)"},{id:"0880_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 1 (new age)"},{id:"0880_Chaos_sf2_file",library:"Chaos",displayName:"Pad 1 (new age)"},{id:"0880_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 1 (new age)"},{id:"0880_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 1 (new age)"},{id:"0880_JCLive_sf2_file",library:"JCLive",displayName:"Pad 1 (new age)"},{id:"0880_SBLive_sf2",library:"SBLive",displayName:"Pad 1 (new age)"},{id:"0880_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 1 (new age)"},{id:"0890_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 2 (warm)"},{id:"0890_Chaos_sf2_file",library:"Chaos",displayName:"Pad 2 (warm)"},{id:"0890_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 2 (warm)"},{id:"0890_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 2 (warm)"},{id:"0890_JCLive_sf2_file",library:"JCLive",displayName:"Pad 2 (warm)"},{id:"0890_SBLive_sf2",library:"SBLive",displayName:"Pad 2 (warm)"},{id:"0890_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 2 (warm)"},{id:"0900_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 3 (polysynth)"},{id:"0900_Chaos_sf2_file",library:"Chaos",displayName:"Pad 3 (polysynth)"},{id:"0900_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 3 (polysynth)"},{id:"0900_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 3 (polysynth)"},{id:"0900_JCLive_sf2_file",library:"JCLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SBLive_sf2",library:"SBLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 3 (polysynth)"},{id:"0910_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 4 (choir)"},{id:"0910_Chaos_sf2_file",library:"Chaos",displayName:"Pad 4 (choir)"},{id:"0910_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 4 (choir)"},{id:"0910_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 4 (choir)"},{id:"0910_JCLive_sf2_file",library:"JCLive",displayName:"Pad 4 (choir)"},{id:"0910_SBLive_sf2",library:"SBLive",displayName:"Pad 4 (choir)"},{id:"0910_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 4 (choir)"},{id:"0920_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 5 (bowed)"},{id:"0920_Chaos_sf2_file",library:"Chaos",displayName:"Pad 5 (bowed)"},{id:"0920_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 5 (bowed)"},{id:"0920_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 5 (bowed)"},{id:"0920_JCLive_sf2_file",library:"JCLive",displayName:"Pad 5 (bowed)"},{id:"0920_SBLive_sf2",library:"SBLive",displayName:"Pad 5 (bowed)"},{id:"0920_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 5 (bowed)"},{id:"0930_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 6 (metallic)"},{id:"0930_Chaos_sf2_file",library:"Chaos",displayName:"Pad 6 (metallic)"},{id:"0930_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 6 (metallic)"},{id:"0930_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 6 (metallic)"},{id:"0930_JCLive_sf2_file",library:"JCLive",displayName:"Pad 6 (metallic)"},{id:"0930_SBLive_sf2",library:"SBLive",displayName:"Pad 6 (metallic)"},{id:"0930_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 6 (metallic)"},{id:"0940_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 7 (halo)"},{id:"0940_Chaos_sf2_file",library:"Chaos",displayName:"Pad 7 (halo)"},{id:"0940_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 7 (halo)"},{id:"0940_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 7 (halo)"},{id:"0940_JCLive_sf2_file",library:"JCLive",displayName:"Pad 7 (halo)"},{id:"0940_SBLive_sf2",library:"SBLive",displayName:"Pad 7 (halo)"},{id:"0940_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 7 (halo)"},{id:"0950_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 8 (sweep)"},{id:"0950_Chaos_sf2_file",library:"Chaos",displayName:"Pad 8 (sweep)"},{id:"0950_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 8 (sweep)"},{id:"0950_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 8 (sweep)"},{id:"0950_JCLive_sf2_file",library:"JCLive",displayName:"Pad 8 (sweep)"},{id:"0950_SBLive_sf2",library:"SBLive",displayName:"Pad 8 (sweep)"},{id:"0950_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 8 (sweep)"},{id:"0960_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 1 (rain)"},{id:"0960_Chaos_sf2_file",library:"Chaos",displayName:"FX 1 (rain)"},{id:"0960_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 1 (rain)"},{id:"0960_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 1 (rain)"},{id:"0960_JCLive_sf2_file",library:"JCLive",displayName:"FX 1 (rain)"},{id:"0960_SBLive_sf2",library:"SBLive",displayName:"FX 1 (rain)"},{id:"0960_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 1 (rain)"},{id:"0970_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 2 (soundtrack)"},{id:"0970_Chaos_sf2_file",library:"Chaos",displayName:"FX 2 (soundtrack)"},{id:"0970_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 2 (soundtrack)"},{id:"0970_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 2 (soundtrack)"},{id:"0970_JCLive_sf2_file",library:"JCLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SBLive_sf2",library:"SBLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 2 (soundtrack)"},{id:"0980_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 3 (crystal)"},{id:"0980_Chaos_sf2_file",library:"Chaos",displayName:"FX 3 (crystal)"},{id:"0980_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 3 (crystal)"},{id:"0980_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 3 (crystal)"},{id:"0980_JCLive_sf2_file",library:"JCLive",displayName:"FX 3 (crystal)"},{id:"0980_SBLive_sf2",library:"SBLive",displayName:"FX 3 (crystal)"},{id:"0980_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 3 (crystal)"},{id:"0990_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 4 (atmosphere)"},{id:"0990_Chaos_sf2_file",library:"Chaos",displayName:"FX 4 (atmosphere)"},{id:"0990_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 4 (atmosphere)"},{id:"0990_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 4 (atmosphere)"},{id:"0990_JCLive_sf2_file",library:"JCLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SBLive_sf2",library:"SBLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 4 (atmosphere)"},{id:"1000_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 5 (brightness)"},{id:"1000_Chaos_sf2_file",library:"Chaos",displayName:"FX 5 (brightness)"},{id:"1000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 5 (brightness)"},{id:"1000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 5 (brightness)"},{id:"1000_JCLive_sf2_file",library:"JCLive",displayName:"FX 5 (brightness)"},{id:"1000_SBLive_sf2",library:"SBLive",displayName:"FX 5 (brightness)"},{id:"1000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 5 (brightness)"},{id:"1010_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 6 (goblins)"},{id:"1010_Chaos_sf2_file",library:"Chaos",displayName:"FX 6 (goblins)"},{id:"1010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 6 (goblins)"},{id:"1010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 6 (goblins)"},{id:"1010_JCLive_sf2_file",library:"JCLive",displayName:"FX 6 (goblins)"},{id:"1010_SBLive_sf2",library:"SBLive",displayName:"FX 6 (goblins)"},{id:"1010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 6 (goblins)"},{id:"1020_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 7 (echoes)"},{id:"1020_Chaos_sf2_file",library:"Chaos",displayName:"FX 7 (echoes)"},{id:"1020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 7 (echoes)"},{id:"1020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 7 (echoes)"},{id:"1020_JCLive_sf2_file",library:"JCLive",displayName:"FX 7 (echoes)"},{id:"1020_SBLive_sf2",library:"SBLive",displayName:"FX 7 (echoes)"},{id:"1020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 7 (echoes)"},{id:"1030_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 8 (sci-fi)"},{id:"1030_Chaos_sf2_file",library:"Chaos",displayName:"FX 8 (sci-fi)"},{id:"1030_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 8 (sci-fi)"},{id:"1030_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 8 (sci-fi)"},{id:"1030_JCLive_sf2_file",library:"JCLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SBLive_sf2",library:"SBLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 8 (sci-fi)"},{id:"1040_Aspirin_sf2_file",library:"Aspirin",displayName:"Sitar"},{id:"1040_Chaos_sf2_file",library:"Chaos",displayName:"Sitar"},{id:"1040_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Sitar"},{id:"1040_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Sitar"},{id:"1040_JCLive_sf2_file",library:"JCLive",displayName:"Sitar"},{id:"1040_SBLive_sf2",library:"SBLive",displayName:"Sitar"},{id:"1040_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Sitar"},{id:"1050_Aspirin_sf2_file",library:"Aspirin",displayName:"Banjo"},{id:"1050_Chaos_sf2_file",library:"Chaos",displayName:"Banjo"},{id:"1050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Banjo"},{id:"1050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Banjo"},{id:"1050_JCLive_sf2_file",library:"JCLive",displayName:"Banjo"},{id:"1050_SBLive_sf2",library:"SBLive",displayName:"Banjo"},{id:"1050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Banjo"},{id:"1060_Aspirin_sf2_file",library:"Aspirin",displayName:"Shamisen"},{id:"1060_Chaos_sf2_file",library:"Chaos",displayName:"Shamisen"},{id:"1060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shamisen"},{id:"1060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shamisen"},{id:"1060_JCLive_sf2_file",library:"JCLive",displayName:"Shamisen"},{id:"1060_SBLive_sf2",library:"SBLive",displayName:"Shamisen"},{id:"1060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shamisen"},{id:"1070_Aspirin_sf2_file",library:"Aspirin",displayName:"Koto"},{id:"1070_Chaos_sf2_file",library:"Chaos",displayName:"Koto"},{id:"1070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Koto"},{id:"1070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Koto"},{id:"1070_JCLive_sf2_file",library:"JCLive",displayName:"Koto"},{id:"1070_SBLive_sf2",library:"SBLive",displayName:"Koto"},{id:"1070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Koto"},{id:"1080_Aspirin_sf2_file",library:"Aspirin",displayName:"Kalimba"},{id:"1080_Chaos_sf2_file",library:"Chaos",displayName:"Kalimba"},{id:"1080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Kalimba"},{id:"1080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Kalimba"},{id:"1080_JCLive_sf2_file",library:"JCLive",displayName:"Kalimba"},{id:"1080_SBLive_sf2",library:"SBLive",displayName:"Kalimba"},{id:"1080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Kalimba"},{id:"1090_Aspirin_sf2_file",library:"Aspirin",displayName:"Bagpipe"},{id:"1090_Chaos_sf2_file",library:"Chaos",displayName:"Bagpipe"},{id:"1090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bagpipe"},{id:"1090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bagpipe"},{id:"1090_JCLive_sf2_file",library:"JCLive",displayName:"Bagpipe"},{id:"1090_SBLive_sf2",library:"SBLive",displayName:"Bagpipe"},{id:"1090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bagpipe"},{id:"1100_Aspirin_sf2_file",library:"Aspirin",displayName:"Fiddle"},{id:"1100_Chaos_sf2_file",library:"Chaos",displayName:"Fiddle"},{id:"1100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fiddle"},{id:"1100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fiddle"},{id:"1100_JCLive_sf2_file",library:"JCLive",displayName:"Fiddle"},{id:"1100_SBLive_sf2",library:"SBLive",displayName:"Fiddle"},{id:"1100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fiddle"},{id:"1110_Aspirin_sf2_file",library:"Aspirin",displayName:"Shanai"},{id:"1110_Chaos_sf2_file",library:"Chaos",displayName:"Shanai"},{id:"1110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shanai"},{id:"1110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shanai"},{id:"1110_JCLive_sf2_file",library:"JCLive",displayName:"Shanai"},{id:"1110_SBLive_sf2",library:"SBLive",displayName:"Shanai"},{id:"1110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shanai"},{id:"1120_Aspirin_sf2_file",library:"Aspirin",displayName:"Tinkle Bell"},{id:"1120_Chaos_sf2_file",library:"Chaos",displayName:"Tinkle Bell"},{id:"1120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tinkle Bell"},{id:"1120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tinkle Bell"},{id:"1120_JCLive_sf2_file",library:"JCLive",displayName:"Tinkle Bell"},{id:"1120_SBLive_sf2",library:"SBLive",displayName:"Tinkle Bell"},{id:"1120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tinkle Bell"},{id:"1130_Aspirin_sf2_file",library:"Aspirin",displayName:"Agogo"},{id:"1130_Chaos_sf2_file",library:"Chaos",displayName:"Agogo"},{id:"1130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Agogo"},{id:"1130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Agogo"},{id:"1130_JCLive_sf2_file",library:"JCLive",displayName:"Agogo"},{id:"1130_SBLive_sf2",library:"SBLive",displayName:"Agogo"},{id:"1130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Agogo"},{id:"1140_Aspirin_sf2_file",library:"Aspirin",displayName:"Steel Drums"},{id:"1140_Chaos_sf2_file",library:"Chaos",displayName:"Steel Drums"},{id:"1140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Steel Drums"},{id:"1140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Steel Drums"},{id:"1140_JCLive_sf2_file",library:"JCLive",displayName:"Steel Drums"},{id:"1140_SBLive_sf2",library:"SBLive",displayName:"Steel Drums"},{id:"1140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Steel Drums"},{id:"1150_Aspirin_sf2_file",library:"Aspirin",displayName:"Woodblock"},{id:"1150_Chaos_sf2_file",library:"Chaos",displayName:"Woodblock"},{id:"1150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Woodblock"},{id:"1150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Woodblock"},{id:"1150_JCLive_sf2_file",library:"JCLive",displayName:"Woodblock"},{id:"1150_SBLive_sf2",library:"SBLive",displayName:"Woodblock"},{id:"1150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Woodblock"},{id:"1160_Aspirin_sf2_file",library:"Aspirin",displayName:"Taiko Drum"},{id:"1160_Chaos_sf2_file",library:"Chaos",displayName:"Taiko Drum"},{id:"1160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Taiko Drum"},{id:"1160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Taiko Drum"},{id:"1160_JCLive_sf2_file",library:"JCLive",displayName:"Taiko Drum"},{id:"1160_SBLive_sf2",library:"SBLive",displayName:"Taiko Drum"},{id:"1160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Taiko Drum"},{id:"1170_Aspirin_sf2_file",library:"Aspirin",displayName:"Melodic Tom"},{id:"1170_Chaos_sf2_file",library:"Chaos",displayName:"Melodic Tom"},{id:"1170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Melodic Tom"},{id:"1170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Melodic Tom"},{id:"1170_JCLive_sf2_file",library:"JCLive",displayName:"Melodic Tom"},{id:"1170_SBLive_sf2",library:"SBLive",displayName:"Melodic Tom"},{id:"1170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Melodic Tom"},{id:"1180_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Drum"},{id:"1180_Chaos_sf2_file",library:"Chaos",displayName:"Synth Drum"},{id:"1180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Drum"},{id:"1180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Drum"},{id:"1180_JCLive_sf2_file",library:"JCLive",displayName:"Synth Drum"},{id:"1180_SBLive_sf2",library:"SBLive",displayName:"Synth Drum"},{id:"1180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Drum"},{id:"1190_Aspirin_sf2_file",library:"Aspirin",displayName:"Reverse Cymbal"},{id:"1190_Chaos_sf2_file",library:"Chaos",displayName:"Reverse Cymbal"},{id:"1190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reverse Cymbal"},{id:"1190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reverse Cymbal"},{id:"1190_JCLive_sf2_file",library:"JCLive",displayName:"Reverse Cymbal"},{id:"1190_SBLive_sf2",library:"SBLive",displayName:"Reverse Cymbal"},{id:"1190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reverse Cymbal"},{id:"1200_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Fret Noise"},{id:"1200_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Fret Noise"},{id:"1200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Fret Noise"},{id:"1200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Fret Noise"},{id:"1200_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Fret Noise"},{id:"1200_SBLive_sf2",library:"SBLive",displayName:"Guitar Fret Noise"},{id:"1200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Fret Noise"},{id:"1210_Aspirin_sf2_file",library:"Aspirin",displayName:"Breath Noise"},{id:"1210_Chaos_sf2_file",library:"Chaos",displayName:"Breath Noise"},{id:"1210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Breath Noise"},{id:"1210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Breath Noise"},{id:"1210_JCLive_sf2_file",library:"JCLive",displayName:"Breath Noise"},{id:"1210_SBLive_sf2",library:"SBLive",displayName:"Breath Noise"},{id:"1210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Breath Noise"},{id:"1220_Aspirin_sf2_file",library:"Aspirin",displayName:"Seashore"},{id:"1220_Chaos_sf2_file",library:"Chaos",displayName:"Seashore"},{id:"1220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Seashore"},{id:"1220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Seashore"},{id:"1220_JCLive_sf2_file",library:"JCLive",displayName:"Seashore"},{id:"1220_SBLive_sf2",library:"SBLive",displayName:"Seashore"},{id:"1220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Seashore"},{id:"1230_Aspirin_sf2_file",library:"Aspirin",displayName:"Bird Tweet"},{id:"1230_Chaos_sf2_file",library:"Chaos",displayName:"Bird Tweet"},{id:"1230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bird Tweet"},{id:"1230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bird Tweet"},{id:"1230_JCLive_sf2_file",library:"JCLive",displayName:"Bird Tweet"},{id:"1230_SBLive_sf2",library:"SBLive",displayName:"Bird Tweet"},{id:"1230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bird Tweet"},{id:"1240_Aspirin_sf2_file",library:"Aspirin",displayName:"Telephone Ring"},{id:"1240_Chaos_sf2_file",library:"Chaos",displayName:"Telephone Ring"},{id:"1240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Telephone Ring"},{id:"1240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Telephone Ring"},{id:"1240_JCLive_sf2_file",library:"JCLive",displayName:"Telephone Ring"},{id:"1240_SBLive_sf2",library:"SBLive",displayName:"Telephone Ring"},{id:"1240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Telephone Ring"},{id:"1250_Aspirin_sf2_file",library:"Aspirin",displayName:"Helicopter"},{id:"1250_Chaos_sf2_file",library:"Chaos",displayName:"Helicopter"},{id:"1250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Helicopter"},{id:"1250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Helicopter"},{id:"1250_JCLive_sf2_file",library:"JCLive",displayName:"Helicopter"},{id:"1250_SBLive_sf2",library:"SBLive",displayName:"Helicopter"},{id:"1250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Helicopter"},{id:"1260_Aspirin_sf2_file",library:"Aspirin",displayName:"Applause"},{id:"1260_Chaos_sf2_file",library:"Chaos",displayName:"Applause"},{id:"1260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Applause"},{id:"1260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Applause"},{id:"1260_JCLive_sf2_file",library:"JCLive",displayName:"Applause"},{id:"1260_SBLive_sf2",library:"SBLive",displayName:"Applause"},{id:"1260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Applause"},{id:"1270_Aspirin_sf2_file",library:"Aspirin",displayName:"Gunshot"},{id:"1270_Chaos_sf2_file",library:"Chaos",displayName:"Gunshot"},{id:"1270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Gunshot"},{id:"1270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Gunshot"},{id:"1270_JCLive_sf2_file",library:"JCLive",displayName:"Gunshot"},{id:"1270_SBLive_sf2",library:"SBLive",displayName:"Gunshot"},{id:"1270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Gunshot"},{id:"12835_1_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 1"},{id:"12835_1_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 1"},{id:"12835_1_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 1"},{id:"12835_1_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 1"},{id:"12835_2_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 2"},{id:"12835_2_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 2"},{id:"12835_2_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 2"},{id:"12835_2_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 2"},{id:"12835_3_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 3"},{id:"12835_3_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 3"},{id:"12835_3_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 3"},{id:"12835_3_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 3"},{id:"12835_4_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 4"},{id:"12835_4_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 4"},{id:"12835_4_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 4"},{id:"12835_4_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 4"},{id:"12835_5_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 5"},{id:"12835_5_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 5"},{id:"12835_5_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 5"},{id:"12835_5_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 5"},{id:"12835_6_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 6"},{id:"12835_6_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 6"},{id:"12835_6_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 6"},{id:"12835_6_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 6"},{id:"12835_7_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 7"},{id:"12835_7_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 7"},{id:"12835_7_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 7"},{id:"12835_7_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 7"},{id:"12835_8_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 8"},{id:"12835_8_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 8"},{id:"12835_8_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 8"},{id:"12835_8_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 8"},{id:"12835_9_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 9"},{id:"12835_9_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 9"},{id:"12835_9_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 9"},{id:"12835_10_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 10"},{id:"12835_10_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 10"},{id:"12835_10_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 10"},{id:"12835_11_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 11"},{id:"12835_11_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 11"},{id:"12835_11_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 11"},{id:"12835_12_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 12"},{id:"12835_12_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 12"},{id:"12835_13_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 13"},{id:"12835_13_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 13"},{id:"12835_14_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 14"},{id:"12835_14_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 14"},{id:"12835_15_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 15"},{id:"12835_15_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 15"},{id:"12835_16_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 16"},{id:"12835_16_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 16"},{id:"12835_17_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 17"},{id:"12835_17_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 17"},{id:"12835_18_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 18"},{id:"12835_18_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 18"}];function Yn(i){const e=1+i%18,t=Xe.find(n=>n.id.startsWith(`12835_${e}_`)&&n.library==="FluidR3_GM");if(t)return{library:t.library,displayName:t.displayName};const r=Xe.find(n=>n.id.startsWith(`12835_${e}_`));return r?{library:r.library,displayName:r.displayName}:null}const Zn=Array.from({length:47},(i,e)=>35+e),Qn={35:"kick2",36:"kick1",37:"rim",38:"snare1",39:"clap",40:"snare2",41:"lowtom2",42:"hh_closed",43:"lowtom1",44:"hh_pedal",45:"midtom2",46:"hh_open",47:"midtom1",48:"hitom2",49:"crash1",50:"hitom1",51:"ride1",52:"china",53:"ride_bell",54:"tamb",55:"splash",56:"cowbell",57:"crash2",58:"vibraslap",59:"ride2",60:"bongo_hi",61:"bongo_lo",62:"conga_hi_mute",63:"conga_hi_open",64:"conga_lo",65:"timbale_hi",66:"timbale_lo",67:"agogo_hi",68:"agogo_lo",69:"cabasa",70:"maracas",71:"whistle_short",72:"whistle_long",73:"guiro_short",74:"guiro_long",75:"claves",76:"woodblock_hi",77:"woodblock_lo",78:"cuica_mute",79:"cuica_open",80:"triangle_mute",81:"triangle_open"},Fi=Rn,Dt=new Map;let se=null;function Oi(i){return Math.max(i,1e-4)}async function gt(i){return new Promise((e,t)=>{const r=document.createElement("script");r.src=i,r.onload=()=>e(),r.onerror=()=>t(new Error(`Failed to load script: ${i}`)),document.body.appendChild(r)})}async function ea(){se||(await gt("https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"),se=new window.WebAudioFontPlayer)}async function pi(i,e=X(),t=null,r,n,s,a=!0){const[o,l]=i.split("/"),d=String(e),c=`${o}/${l}@${d}`;Dt.has(e)||Dt.set(e,new Map);const u=Dt.get(e);if(a&&u.has(c))return u.get(c);if(await ea(),se.resumeContext){const w=se.resumeContext;se.resumeContext=L=>{if(!(L instanceof OfflineAudioContext))return w.call(se,L)}}const h=Xe.find(w=>w.library===o&&w.displayName===l);if(!h)throw new Error(`Could not find WebAudioFont entry for library=${o} and instrument=${l}`);t&&t.context!==e&&(console.warn("[WebAudioFont] Ignoring mismatched destination from another context"),t=null);const f=t||Ae(e),y=e.createStereoPanner();if(y.pan.value=n??0,y.connect(f),!h.displayName.startsWith("Drum Kit")){const w=`_tone_${h.id}`,L=`https://surikov.github.io/webaudiofontdata/sound/${h.id}.js`;s?await gt(L):await Fi(gt(L));const G=window[w];if(!G)throw new Error(`Missing preset: ${w}`);if(se.loader.decodeAfterLoading(e,w),e instanceof OfflineAudioContext){const M=(G==null?void 0:G.zones)??[];for(const x of M)if(x.file&&!x.buffer){const B=atob(x.file),R=new ArrayBuffer(B.length),F=new Uint8Array(R);for(let q=0;q<B.length;q++)F[q]=B.charCodeAt(q);x.buffer=await new Promise((q,Q)=>e.decodeAudioData(R,q,Q))}}const E={_preset:G,_volume:r??1,_activeEnvelopes:[],start({note:M,duration:x=1,velocity:B=100,time:R}){const F=typeof M=="string"?$(M):M;if(F==null||typeof F!="number")return;const q=typeof R=="number"?R:0,Q=Math.max(.01,Math.min(1,B/127)),be=Oi(E._volume),Rt=Math.max(.01,Math.min(1,be*Q)),ct=se.queueWaveTable(e,y||Ae(),G,q,F,x,Rt);E._activeEnvelopes.push(ct)},stop(){var M;for(const x of E._activeEnvelopes)try{x.cancel?x.cancel():(M=x.audioBufferSourceNode)!=null&&M.stop&&x.audioBufferSourceNode.stop()}catch(B){console.warn("Failed to stop envelope:",B)}E._activeEnvelopes=[]},setVolume(M){E._volume=Math.max(0,Math.min(1,M))},setPan(M){y.pan.value=Math.max(-1,Math.min(1,M))},load:Promise.resolve()};return a&&u.set(c,E),E}const g=h.id.match(/^12835_(\d+)_([A-Za-z0-9_]+)_sf2_file$/);if(!g)throw new Error(`Invalid drum ID format in catalogue: ${h.id}`);const[,p,v]=g,S=parseInt(p,10),_={},C=async()=>{for(const w of Zn){const L=`_drum_${w}_${S}_${v}_sf2_file`,G=`https://surikov.github.io/webaudiofontdata/sound/${12800+w}_${S}_${v}_sf2_file.js`;try{await gt(G);const E=window[L];if(!E){console.warn(`Missing drum preset: ${L}`);continue}se.loader.decodeAfterLoading(e,L),_[w]=E}catch(E){console.warn(`Failed to load drum preset ${w}: ${E}`)}}};s??!1?await C():await Fi(C());const N={_preset:_,_volume:r??1,_activeEnvelopes:[],start({note:w,duration:L=1,velocity:G=100,time:E}){const M=typeof w=="string"?$(w):w;if(M==null||typeof M!="number"){console.warn(`Invalid MIDI pitch: ${w}`);return}const x=_[M];if(!x){console.warn(`No drum preset loaded for MIDI ${M}`);return}const B=typeof E=="number"?E:0,R=Oi(N._volume),F=se.queueWaveTable(e,y||Ae(),x,B,M,L,R);N._activeEnvelopes.push(F)},stop(){var w;for(const L of N._activeEnvelopes)try{L.cancel?L.cancel():(w=L.audioBufferSourceNode)!=null&&w.stop&&L.audioBufferSourceNode.stop()}catch(G){console.warn("Failed to stop envelope:",G)}N._activeEnvelopes=[]},load:Promise.resolve(),setVolume(w){N._volume=Math.max(0,Math.min(1,w))},setPan(w){y.pan.value=Math.max(-1,Math.min(1,w))}};return a&&u.set(c,N),N}async function ta(){const i=new Set;for(const e of Xe)i.add(e.library);return Array.from(i)}async function ia(i){return Xe.filter(e=>e.library===i).map(e=>e.displayName)}function sa(){return{name:"webaudiofont",loadInstrument:pi,getAvailableLibraries:ta,getAvailableInstruments:ia}}let si=null,ri=null;async function ra(i){if(ri===i)return;const[,e,t]=i.split("/");si=await pi(`${e}/${t}`,Le()),ri=i}function na(){return ri}function aa(i,e=100,t=!1){if(!si)return null;const n=Le().currentTime,s=$(i);return s===null?null:(si.start({note:s,velocity:e,time:n,duration:1.5,loop:t}),()=>{})}function oa(i){}async function la(i,e,t,r=100,n=!1,s=null,a=null,o=null,l,d){const c=a||X(),[,u,h]=i.split("/"),f=await pi(`${u}/${h}`,c,o,l,d);l!==void 0&&f.setVolume&&f.setVolume(l),d!==void 0&&f.setPan&&f.setPan(d);const y=$(e);return y===null||f.start({note:y,duration:t,velocity:r,loop:n,time:s??c.currentTime}),null}function ca(){return{name:"webaudiofont",setActiveInstrument:ra,getActiveInstrumentName:na,playNote:aa,stopNoteByPitch:oa,loadAndPlayNote:la}}function As(i=3){const s=["C","D","E","F","G","A","B"],a=["C#","D#","","F#","G#","A#",""],o=[i,i+1,i+2],l={};let d=0;for(const c of o)s.forEach(u=>{const h=`${u}${c}`;l[h]={note:h,x:d,width:60,height:200,isBlack:!1},d+=60});d=0;for(const c of o)a.forEach((u,h)=>{if(u===""){d+=60;return}const f=`${u}${c}`;l[f]={note:f,x:d+60-40/2,width:40,height:120,isBlack:!0},d+=60});return l}let _t="sf2/fluidr3-gm/acoustic_grand_piano",mi=3,Ts=!1,Is=As(mi);function da(){_t="sf2/fluidr3-gm/acoustic_grand_piano",gi(_t)}function ua(i){gi(i),_t=i}function yi(){return _t}function ha(){const i=document.getElementById("instrument-loop-toggle");return(i==null?void 0:i.checked)??!1}function qt(){return mi}function Pi(i){mi=i}function Ne(){return Ts}function fa(i){Ts=i}function Ee(){return Is}function pa(i){Is=i}const it={sf2:Vn(),webaudiofont:ca()};async function gi(i){if(!i.includes("/"))throw new Error(`Invalid instrument name: "${i}". Expected "<engine>/<library>/<instrument>"`);const e=i.split("/")[0],t=it[e];if(!t)throw new Error(`Engine "${e}" not available`);await t.setActiveInstrument(i)}function Rs(i,e=100,t=!1){const r=yi();if(!r)return null;const n=r.split("/")[0],s=it[n];if(!s)throw new Error(`Engine "${n}" not available`);return s.playNote(i,e,t)}function ma(i){const e=yi();if(!e)return;const t=e.split("/")[0],r=it[t];if(!r)throw new Error(`Engine "${t}" not available`);r.stopNoteByPitch(i)}async function ya(i,e,t=1,r=100,n=!1,s=null,a=null,o=null,l,d){const c=i.split("/")[0],u=it[c];if(!u)throw new Error(`Engine "${c}" not available`);let h=a??X(),f=o;return h.state==="suspended"&&(console.warn("[loadAndPlayNote] Using preview context due to suspended main context"),h=Le(),f=Hn()),await u.loadAndPlayNote(i,e,t,r,n,s,h,f,l,d)}let Kt=null;function X(){return Kt||(Kt=new(window.AudioContext||window.webkitAudioContext)),Kt}const Ht=new WeakMap,$t=new WeakMap;function Fs(i=X()){if(!$t.has(i)){const e=i.createAnalyser();e.fftSize=2048,$t.set(i,e)}return $t.get(i)}function Ae(i=X()){if(!Ht.has(i)){const e=i.createGain(),t=Fs(i);e.connect(t),t.connect(i.destination),Ht.set(i,e)}return Ht.get(i)}function ga(i){try{const e=Rs(i,100,!1);return e?{stop:e,forceStop:e}:null}catch(e){return console.error("[playNote] Failed to play note",i,e),null}}function _a(i,e){const t=structuredClone(i);return t.tempo=e.bpm,t}function Os(i){return{type:"CHANGE_TEMPO",bpm:i}}function ba(i){return Os(i)}function va(i,e){const t=structuredClone(i);return t.timeSignature=[e.beats,4],t}function Ps(i){return{type:"SET_TIME_SIGNATURE",beats:i}}function Sa(i){return Ps(i)}function Ca(i,e){const t=structuredClone(i);return t.totalMeasures=e.measures,t}function Us(i){return{type:"SET_TOTAL_MEASURES",measures:i}}function Na(i){return Us(i)}const wa=new Set(["C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#","Cb"]),Ma=new Set(["M","m"]);function xa(i){const e=i.slice(0,-1),t=i.slice(-1);if(!wa.has(e)||!Ma.has(t))return null;const r=t==="M"?"major":"minor",n=Vr.get(`${e} ${r}`);return n.empty?null:n.notes}const La=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ka=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ds={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function Ga(i){return i.includes("#")}function J(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,r,n]=e,s=t.toUpperCase(),a=Ds[s];if(a===void 0)return null;const o=[...r].reduce((d,c)=>c==="#"?d+1:c==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}function ne(i){return J(i)}const Ba=i=>{const e=J(i);return e!==null?e%12:0};function _i(i,e=21,t){const r=J(i);if(r===null)return null;const n=t-e+1,s=r-e,a=n-1-s;return a>=0&&a<n?a:null}function Z(i,e,t){const n=t-e+1-1-i,s=e+n;return Ie(s)}function Ie(i,e=!1){const r=(e?ka:La)[i%12],n=Math.floor(i/12)-1;return`${r}${n}`}function qs(i,e){const t=new Map;for(let r=i;r<=e;r++)t.set(r,Ga(Ie(r)));return t}function Ea(i,e){const t=J(i),r=J(e);if(t===null||r===null)throw new Error(`Invalid pitches provided: ${i}, ${e}`);return t-r}function Ks(i){const e=xa(i),t=new Map;if(!e)return t;const r=new Set(e.map(n=>Ds[n]%12));for(let n=0;n<=127;n++){const s=n%12;t.set(n,r.has(s))}return t}function Hs(){return typeof window<"u"&&typeof localStorage<"u"}function Nt(i,e){Hs()&&localStorage.setItem(i,JSON.stringify(e))}function st(i){if(!Hs())return null;const e=localStorage.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error(`Error parsing localStorage key "${i}":`,t),null}}const $s="grid-key-highlighting",zs="grid-snap-enabled",Js="snap-to-in-key",Aa="CM";let Ws=st($s)??!1,js=st(zs)??!0,Xs=st(Js)??!1,Vs=Ks(Aa),Ys=!1;function Zs(){return Ws}function Ta(i){Ws=i,Nt($s,i)}function Qs(){return js}function Ia(i){js=i,Nt(zs,i)}function wt(){return Xs}function Ra(i){Xs=i,Nt(Js,i)}function Mt(){return Vs}function Fa(i){Vs=Ks(i)}function Ve(){return Ys}function Ui(i){Ys=i}function Oa(i,e){const t=structuredClone(i);return t.songKey=e.songKey,Fa(e.songKey),t}function er(i){return{type:"CHANGE_SONG_KEY",songKey:i}}function Pa(i){return er(i)}function Ua(i,e){const t=structuredClone(i);return t.snapResolution=e.snapResolution,t}function tr(i){return{type:"CHANGE_SNAP_RESOLUTION",snapResolution:i}}function Da(i){return tr(i)}function qa(i,e){const t=structuredClone(i);return t.noteDuration=e.noteDuration,t}function ir(i){return{type:"CHANGE_NOTE_DURATION",noteDuration:i}}function Ka(i){return ir(i)}function Ha(i,e){const t=structuredClone(i);return t.isTripletMode=e.triplet,t.isDottedMode=e.dotted,t}function sr(i,e){return{type:"SET_NOTE_MODIFIER_MODE",triplet:i,dotted:e}}function $a(i,e){return sr(i,e)}const bi={sf2:Kn(),webaudiofont:sa()},rr="sf2";async function nr(i,e,t,r,n,s,a=!0){const o=i.split("/");if(o.length!==3)throw new Error(`Invalid instrument fullName format: "${i}". Expected format "engine/library/instrument"`);const[l,d,c]=o,u=bi[l];if(!u)throw new Error(`Engine "${l}" not available`);return await u.loadInstrument(`${d}/${c}`,e,t,r,n,s,a)}async function za(i,e,t,r,n,s,a){if(!r||r.length===0)return;const o=60/de();if(a!=null&&a.aborted)return;const l=await nr(i,e,t,n,s);if(!(a!=null&&a.aborted))for(const d of r){if(a!=null&&a.aborted)return;const c=d.start*o,u=Math.max(.01,c),h=d.duration*o,f=d.velocity??100,y=J(d.pitch);if(y==null)continue;const b=i.split("/"),p=(b.length>=3?b[1]:b[0])==="drummachines"&&l.__midiMap?l.__midiMap.get(y)??y:y;try{l.start({note:p,duration:h,velocity:f,time:u,loop:!1})}catch(v){console.warn("[exportNotesToOffline] Failed to start note:",d,v)}}}function Di(i){if(!i.container)return;const e=i.container.querySelector(".mute-btn"),t=i.container.querySelector(".solo-btn"),r=i.container.querySelector(".sequencer-body"),n=i.container.querySelector(".mini-contour");e==null||e.classList.toggle("bg-red-600",i.mute),e==null||e.classList.toggle("bg-gray-700",!i.mute),t==null||t.classList.toggle("bg-yellow-200",i.solo),t==null||t.classList.toggle("bg-gray-700",!i.solo);const s=i.mute&&!i.solo;r==null||r.classList.toggle("opacity-40",s),r==null||r.classList.toggle("opacity-100",!s),n==null||n.classList.toggle("opacity-40",s),n==null||n.classList.toggle("opacity-100",!s)}const Re=["#ff006e","#3a86ff","#ffbe0b","#8338ec","#06d6a0","#ef476f","#118ab2","#ffd166","#073b4c","#8ac926","#0077b6","#00b4d8","#005f73","#03045e","#023e8a"];function xt(i,e,t,r=0){const n=i.getContext("2d");if(!n)return;n.imageSmoothingEnabled=!1;const s=i.width,a=i.height;if(n.clearRect(0,0,s,a),!e.length)return;const o=Re[r%Re.length];n.fillStyle=o;const l=ce(),d=e.map(p=>$(p.pitch)).filter(p=>p!==null);if(!d.length)return;let c=Math.min(...d),u=Math.max(...d),h=Math.max(1,u-c);for(;a%h!==0;)u++,h=u-c;const f=a/h;for(const p of e){const v=$(p.pitch);if(v==null)continue;const S=p.start/l*s,_=p.duration/l*s,C=(v-c)/h,N=a-C*a-f/2,w=Math.round(S),L=Math.max(1,Math.round(_)),G=Math.round(N);n.fillRect(w,G,L,f)}const y=xe(),b=Ei();n.save();let g=1;b>256?g=16:b>128?g=8:b>32&&(g=4);for(let p=0;p<=b;p++){if(p%g!==0)continue;const S=p*y/l*s,_=Math.round(S)+.5;n.beginPath(),n.moveTo(_,0),n.lineTo(_,a);const C=g===1||p%(g*2)===0;n.strokeStyle=C?"rgba(255, 255, 255, 0.12)":"rgba(255, 255, 255, 0.04)",n.lineWidth=.2,n.stroke()}n.restore()}function ni(i,e){const{config:t,container:r,matrix:n,colorIndex:s,getNotes:a}=i,[o,l]=e,d=J(o),c=J(l);if(d===null||c===null){console.warn(`Invalid note range: ${e}`);return}if(d>=c){console.warn("Invalid note range: low note must be lower than high note");return}t.noteRange=e,t.visibleNotes=Ea(l,o)+1;const u=r==null?void 0:r.querySelector(".mini-contour");u&&xt(u,a(),t,s),n.setNoteRange(d,c)}function Ja(i){i.instrumentName.toLowerCase().includes("drum kit")?(ni(i,["B1","A5"]),i.matrix.setCustomLabels(Qn)):(ni(i,["A0","C9"]),i.matrix.setCustomLabels(null))}const Lt=new Map;function Wa(){Lt.clear()}function ja(i,e){Lt.set(i,e)}function Xa(i){Lt.delete(i)}function ar(i){return Lt.get(i)}function bt(i,e=!0,t=null){var o;const r=ar(i.id);if(!r)return;const n=H.getInstance(),s=r.getMatrixContainer(),a=r.getMiniContourCanvas();if(!(!s||!a)){if(i.collapsed=e,r.collapsed=e,s.classList.toggle("hidden",e),a.classList.toggle("hidden",!e),t){const l=t.querySelector("img");if(l){const d=e?"icon-caret-up":"icon-caret-down";l.src=ie(`static/svg/${d}.svg`)}}if(e){r.toggleZoomControls(!1),r.toggleGripHandle(!1);for(const l of i.scheduledAnimations)clearTimeout(l);i.scheduledAnimations=[],xt(a,i.notes,i.config,i.colorIndex)}else r.toggleZoomControls(!0),r.toggleGripHandle(!0),(o=i.matrix)==null||o.resize(),n.isActive()&&i.resumeAnimationsFromCurrentTime(n.getStartTime(),n.getStartBeat())}}function Va(){for(const i of K())bt(i,!0)}const Ya={totalMeasures:16,beatsPerMeasure:4,layout:{labelWidthColumns:1,headerHeightRows:2,footerHeightRows:1,labelWidth:80,headerHeight:40,footerHeight:40,baseCellWidth:70,minCellWidth:10,maxCellWidth:200,verticalCellRatio:4,highestMidi:108,lowestMidi:21},display:{showMeasureLines:!0,showBeatLines:!0,showHoveredCell:!0,highlightCurrentMeasure:!0},behavior:{zoom:1,scrollMargin:48,enableSnapping:!0,snapDivisions:4,maxZoom:1.6,minZoom:.5}};function Za(){return structuredClone(Ya)}function Qa(i,e){return{...i,...e,layout:{...i.layout,...e.layout??{}},display:{...i.display,...e.display??{}},behavior:{...i.behavior,...e.behavior??{}}}}const vi={Midnight:{whiteKey:"#1e1e1e",blackKey:"#2a103b",labelWhite:"#2c2c2c",labelBlack:"#3a1d4d",textWhite:"#cfcfcf",textBlack:"#e6d9ff",gridLine:"#333",beatLine:"#4e3d63",measureLine:"#8561c2",outOfKey:"rgb(255, 1, 1)"},Seashell:{whiteKey:"#fefefe",blackKey:"#f1e7dc",labelWhite:"#dddddd",labelBlack:"#d4cfc9",textWhite:"#444",textBlack:"#663300",gridLine:"#ccc",beatLine:"#bbb",measureLine:"#999",outOfKey:"rgba(255, 255, 255, 0.05)"},Cyberpunk:{whiteKey:"#162447",blackKey:"#1b1b2f",labelWhite:"#1f4068",labelBlack:"#1f4068",textWhite:"#e43f5a",textBlack:"#e43f5a",gridLine:"#1f4068",beatLine:"#e43f5a",measureLine:"#ffcc00",outOfKey:"rgba(255, 255, 255, 0.05)"},"Classic Blue":{whiteKey:"#f5faff",blackKey:"#dceeff",labelWhite:"#aaccee",labelBlack:"#88bbdd",textWhite:"#002244",textBlack:"#001122",gridLine:"#99bbdd",beatLine:"#88aacc",measureLine:"#336699",outOfKey:"rgba(255, 255, 255, 0.05)"},Darkroom:{whiteKey:"#2c2c2c",blackKey:"#1e1e1e",labelWhite:"#2a2a2a",labelBlack:"#383838",textWhite:"#e0e0e0",textBlack:"#a0a0a0",gridLine:"#404040",beatLine:"#606060",measureLine:"#808080",outOfKey:"rgba(255, 255, 255, 0.05)"}};class eo{constructor(e,t,r,n,s){this.getBlackKeyMap=n,this.getInKeyMap=s,this.scroll=e,this.config=t,this.interactionStore=r}draw(e){const{totalMeasures:t,beatsPerMeasure:r,layout:{baseCellWidth:n,verticalCellRatio:s,labelWidth:a,headerHeight:o},behavior:{zoom:l}}=this.config,{gridColorScheme:d}=z().theme,c=vi[d],u=this.config.layout.highestMidi-this.config.layout.lowestMidi+1,h=n*l,f=h/s,y=this.scroll.getX(),b=this.scroll.getY();(e.canvas.width-a)/h;const g=t*r;e.save(),e.translate(a-y,o-b);const p=Math.max(0,Math.floor((y-a)/h)),v=Zs(),S=this.getInKeyMap();for(let _=0;_<u;_++){const C=_*f,N=this.config.layout.highestMidi-_;let w;v?w=S.get(N)?c.whiteKey:c.blackKey:w=this.getBlackKeyMap().get(N)?c.blackKey:c.whiteKey,e.fillStyle=w,e.fillRect(0,C,g*h,f),e.strokeStyle=c.gridLine,e.beginPath(),e.moveTo(0,C),e.lineTo(g*h,C),e.stroke()}for(let _=p;_<=g;_++){if(_<0)continue;const C=_*h;e.strokeStyle=_%r===0?c.measureLine:c.beatLine,e.beginPath(),e.moveTo(C,0),e.lineTo(C,u*f),e.stroke()}e.restore()}}function to(i){const{layout:{labelWidth:e,baseCellWidth:t},totalMeasures:r,beatsPerMeasure:n,behavior:{zoom:s}}=i,a=t*s;return e+r*n*a}function io(i){const{layout:{baseCellWidth:e,verticalCellRatio:t,highestMidi:r,lowestMidi:n,headerHeight:s},behavior:{zoom:a}}=i,o=r-n+1,l=e*a/t;return o*l+s}class so{constructor(e,t){this.scrollX=0,this.scrollY=0,this.canvas=e,this.config=t}getX(){return this.scrollX}getY(){return this.scrollY}setScroll(e,t){this.scrollX=this.clampX(e),this.scrollY=this.clampY(t)}recalculateBounds(){}getMaxScrollX(){const e=this.canvas.offsetWidth;return Math.max(0,this.getContentWidth()-e)}getMaxScrollY(){const e=this.canvas.offsetHeight-this.config.layout.headerHeight;return Math.max(0,this.getContentHeight()-e)}clampX(e){return Math.max(0,Math.min(e,this.getMaxScrollX()))}clampY(e){return Math.max(0,Math.min(e,this.getMaxScrollY()))}getContentWidth(){return to(this.config)}getContentHeight(){return io(this.config)}}function rt(i,e){const t=e.getBoundingClientRect();return{x:i.clientX-t.left,y:i.clientY-t.top}}function or(i,e,t,r){const n=e.getBoundingClientRect();return{x:i.clientX-n.left+t.getX()-r.layout.labelWidth,y:i.clientY-n.top+t.getY()-r.layout.headerHeight}}function ro(i,e,t,r,n){const s=t.getBoundingClientRect();return{x:i-s.left+r.getX()-n.layout.labelWidth,y:e-s.top+r.getY()-n.layout.headerHeight}}function nt(i,e,t,r,n=!1){const{layout:{labelWidth:s,headerHeight:a,baseCellWidth:o,verticalCellRatio:l,highestMidi:d,lowestMidi:c},behavior:{zoom:u}}=t,h=d-c+1,f=o*u,y=f/l,b=(i.x+e.getX()-s)/f;let g=Math.floor((i.y+e.getY()-a)/y);const p=n?r*(2/3):r,v=Math.floor(b/p)*p;if(v<0||g<0||g>=h)return null;if(wt()&&!Ve()){const S=Mt(),_=d-g;let C=null,N=1/0;for(let w=-12;w<=12;w++){const L=_+w;if(L<c||L>d||!S.get(L))continue;const G=d-L,E=Math.abs(G-g);if(E<N&&(N=E,C=G),E===0)break}C!==null&&(g=C)}return{x:v,y:g}}class no{constructor(e,t){this.notes=[],this.noteIndex=new Map,this.pitchIndex=new Map,this.config=e,this.playNote=t}set(e){this.notes=e}getAll(){return this.notes}add(e){this.notes.push(e)}getTrackedNotes(e){const t=e.getHoveredNoteKey(),r=s=>e.isNoteHighlighted(s),n=new Set(e.getSelectedNotes().map(s=>`${s.pitch}:${s.start}`));return this.notes.map(s=>{const a=`${s.pitch}:${s.start}`;return{note:s,state:{hovered:a===t,selected:n.has(a),highlighted:r(s)}}})}remove(e){const t=`${e.pitch}:${e.start}`;this.notes=this.notes.filter(r=>!(r.pitch===e.pitch&&r.start===e.start)),this.noteIndex.delete(t)}removeAll(e){const t=new Set(e.map(r=>`${r.pitch}:${r.start}`));this.notes=this.notes.filter(r=>!t.has(`${r.pitch}:${r.start}`));for(const r of t)this.noteIndex.delete(r)}rebuildIndex(){this.noteIndex.clear(),this.pitchIndex.clear();for(const e of this.notes){const t=`${e.pitch}:${e.start}`;this.noteIndex.set(t,e),this.pitchIndex.has(e.pitch)||this.pitchIndex.set(e.pitch,[]),this.pitchIndex.get(e.pitch).push(e)}for(const e of this.pitchIndex.values())e.sort((t,r)=>t.start-r.start)}findNoteAtMousePosition(e,t,r,n,s){const a=rt(e,t);A("Raw mouse pos (grid-relative)",a);const o=Tt(),l=nt(a,r,n,o);if(!l){A("Snapped position is invalid",{mouse:a,snap:o});return}const d=Z(l.y,n.layout.lowestMidi,n.layout.highestMidi),c=l.x;A("Snapped grid position",l),A("Computed pitch and beat",{pitch:d,beat:c});const u=s.findNoteUnderCursor(d,c);return A("Note under cursor (if any)",u),u}findAtPosition(e,t){return this.noteIndex.get(`${e}:${t}`)}findNoteUnderCursor(e,t){const r=this.pitchIndex.get(e);if(!r||r.length===0)return;let n=0,s=r.length-1,a=-1;for(;n<=s;){const o=Math.floor((n+s)/2);r[o].start<=t?(a=o,n=o+1):s=o-1}if(a!==-1)for(let o=a;o>=0;o--){const l=r[o];if(t>=l.start&&t<l.start+l.duration)return l;if(l.start+l.duration<t)break}}findNoteEdgeAtCursor(e,t,r=.25){const n=this.pitchIndex.get(e);if(!n||n.length===0)return;let s=0,a=n.length-1,o=-1;for(;s<=a;){const l=Math.floor((s+a)/2);n[l].start<=t?(o=l,s=l+1):a=l-1}if(o!==-1)for(let l=o;l>=0;l--){const d=n[l],c=d.start+d.duration*(1-r),u=d.start+d.duration;if(t>=c&&t<=u)return d;if(d.start+d.duration<t)break}}mergeSelections(e,t){const r=new Set,n=[];for(const s of[...e,...t]){const a=`${s.pitch}:${s.start}`;r.has(a)||(r.add(a),n.push(s))}return n}previewNote(e,t,r=100,n=!1){this.playNote(e,t,r,n)}}function Fe(i,e,t,r,n,s=4){i.beginPath(),i.moveTo(e+s,t),i.lineTo(e+r-s,t),i.quadraticCurveTo(e+r,t,e+r,t+s),i.lineTo(e+r,t+n-s),i.quadraticCurveTo(e+r,t+n,e+r-s,t+n),i.lineTo(e+s,t+n),i.quadraticCurveTo(e,t+n,e,t+n-s),i.lineTo(e,t+s),i.quadraticCurveTo(e,t,e+s,t),i.closePath()}function ao(i,e,t,r){const{layout:{baseCellWidth:n,verticalCellRatio:s,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=t,d=a-o+1,c=n*l,u=c/s,h=r.offsetWidth,f=r.offsetHeight,y=0,b=i/c-y,g=(i+h)/c+y,p=Math.floor(e/u),v=Math.min(d-1,Math.ceil((e+f)/u)+y),S=new Map;return _=>_.filter(({note:C})=>{if(C.start+C.duration<b||C.start>g)return!1;let w=S.get(C.pitch);if(w==null){const L=_i(C.pitch,o,a);if(L==null||L<0||L>=d)return!1;w=L,S.set(C.pitch,w)}return w>=p&&w<=v})}function oo(i){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;i=i.replace(e,(u,h,f,y)=>h+h+f+f+y+y);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(!t)return null;const r=parseInt(t[1],16)/255,n=parseInt(t[2],16)/255,s=parseInt(t[3],16)/255,a=Math.max(r,n,s),o=Math.min(r,n,s);let l=0,d=0,c=(a+o)/2;if(a!==o){const u=a-o;switch(d=c>.5?u/(2-a-o):u/(a+o),a){case r:l=(n-s)/u+(n<s?6:0);break;case n:l=(s-r)/u+2;break;case s:l=(r-n)/u+4;break}l*=60}return{h:Math.round(l),s:Math.round(d*100),l:Math.round(c*100)}}const lo=["#FF0000","#9400D3","#FFFF00","#FF69B4","#00FF00","#00FFFF","#0000FF","#8A2BE2","#FF8C00","#FFD700","#ADFF2F","#DC143C"];function co(i,e){const t=oo(i);if(!t)return"#999";const n=10+(e??100)/127*50;return`hsl(${t.h}, ${t.s}%, ${n}%)`}function ut(i){return(e,t)=>{const r=i(e,t);return co(r,e.velocity)}}function uo(i){const e=J(i.pitch);if(e==null)return"#999";const t=e*3%360,r=100,n=60,a=.2+(i.velocity??100)/127*.8;return`hsla(${t}, ${r}%, ${n}%, ${a})`}const ho={Scriabin:ut((i,{getPitchClass:e}={})=>{const t=e?e(i.pitch):0;return lo[t]||"#999"}),"Track Color":ut((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#999"),"Note Velocity":ut((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#ff0000"),"Octave Bands":uo,"Pitch Class Contrast":ut((i,{getPitchClass:e}={})=>{const t=J(i.pitch);if(t==null)return"#999";const r=t%12;return["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"][r]||"#999"})};function fo(i){return i<0&&(console.error(`Invalid trackId: ${i}. Using default color.`),i=0),Re[i%Re.length]}class po{constructor(e,t,r,n,s){this.scroll=e,this.config=t,this.noteManager=r,this.interactionStore=n,this.sequencerId=s}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:r,labelWidth:n,headerHeight:s},behavior:{zoom:a}}=this.config,{noteColorScheme:o}=z().theme,l=ho[o]||(()=>"#999"),d={getPitchClass:Ba,getTrackColor:()=>fo(this.sequencerId)},c=t*a,u=c/r,h=this.scroll.getX(),f=this.scroll.getY(),y=e.canvas,b=this.noteManager.getTrackedNotes(this.interactionStore);e.save(),e.translate(n-h,s-f);const p=ao(h,f,this.config,y)(b);for(const{note:v,state:S}of p){const C=_i(v.pitch,this.config.layout.lowestMidi,this.config.layout.highestMidi)*u,N=v.start*c,w=v.duration*c,L=u,G=l(v,d);e.fillStyle=G,Fe(e,N,C,w,L,4),e.fill(),(S.selected||S.hovered||S.highlighted)&&(e.lineWidth=2,e.strokeStyle=S.selected?"#ffffff":S.hovered?"#ff9933":"#33ff99",Fe(e,N,C,w,L,4),e.stroke())}e.restore()}}class mo{constructor(e,t,r,n){this.scroll=e,this.config=t,this.store=r,this.getNoteDuration=n}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:r,labelWidth:n,headerHeight:s,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=t*l,c=d/r;e.save(),e.translate(n-this.scroll.getX(),s-this.scroll.getY()),e.fillStyle="rgba(100, 180, 255, 0.5)";const u=this.store.getPreviewNotes();if(u.length>0){const p=o-a+1;for(const v of u){const S=ne(v.pitch);if(S===null)continue;const _=p-1-(S-a),C=v.start*d,N=_*c,w=v.duration*d;Fe(e,C,N,w,c,3),e.fill()}e.restore();return}const h=this.store.getSnappedCursorGridPosition();if(!h){e.restore();return}const f=this.getNoteDuration(),y=h.x*d,b=h.y*c,g=d*f;Fe(e,y,b,g,c,3),e.fill(),e.restore()}}let ze=!1,Si=[];const ai=new Set;function qi(){return ze=!ze,ai.forEach(i=>i(ze)),ze}function yo(i){return ai.add(i),i(ze),()=>ai.delete(i)}function go(i){Si=i}function Ye(){return Si}function Ci(){Si=[]}class _o{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:r,labelWidth:n,headerHeight:s,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=t*l,c=d/r;e.save(),e.translate(n-this.scroll.getX(),s-this.scroll.getY()),e.fillStyle="rgba(255, 100, 180, 0.4)";const u=Ye();if(u.length>0){const h=o-a+1;for(const f of u){const y=ne(f.pitch);if(y===null)continue;const b=h-1-(y-a),g=f.start*d,p=b*c,v=f.duration*d;Fe(e,g,p,v,c,3),e.fill()}e.restore();return}e.restore()}}class bo{constructor(e,t){this.scroll=e,this.config=t,this.animations=[]}playNote(e){const t=performance.now(),r=de();let n=e.duration*6e4/r;n=Math.max(100,Math.min(n,1600));const a=(J(e.pitch)||0)*5%360;this.animations.push({note:e,startTime:t,duration:n,hue:a})}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:r,labelWidth:n,headerHeight:s,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=this.scroll.getX(),c=this.scroll.getY(),u=t*l,h=u/r,f=performance.now();e.clearRect(0,0,e.canvas.width,e.canvas.height),this.animations=this.animations.filter(y=>{const b=(f-y.startTime)/y.duration;if(b>1)return!1;const{note:g,hue:p}=y,v=J(g.pitch);if(v==null||v<a||v>o)return!0;const S=o-v,_=g.start*u+n-d,C=S*h+s-c,N=g.duration*u,w=h-1,L=_+N/2,G=C+w/2,E=Math.sin(b*Math.PI),M=`hsla(${p}, 100%, 70%, ${.4*E})`;e.save(),e.globalAlpha=1,e.fillStyle=M,e.beginPath(),e.roundRect(_,C,N,w,4),e.fill();const x=2,B=50;for(let R=0;R<x;R++){const F=R*B,q=Math.max(0,Math.min(1,(f-y.startTime-F)/(y.duration-F))),Q=Math.sin(q*Math.PI),be=1+(.1+R*.1)*Q,Rt=(1-q)*.3;e.globalAlpha=Rt,e.strokeStyle=`hsl(${p}, 100%, 65%)`,e.lineWidth=1.5;const ct=N*be,Ii=w*be;e.beginPath(),e.roundRect(L-ct/2,G-Ii/2,ct,Ii,4),e.stroke()}return e.restore(),!0}),this.animations.length>0&&requestAnimationFrame(()=>this.draw(e))}}class vo{constructor(e,t,r){this.scroll=e,this.config=t,this.ctx=r,this.isAnimating=!1,this.acceptanceAnimations=[],this.activeBarIndex=null,this.renderFrame=n=>{if(!this.isAnimating)return;this.draw(n);const s=this.acceptanceAnimations.length>0,a=Ye().length>0,o=this.activeBarIndex!==null;s||a||o?requestAnimationFrame(this.renderFrame):this.isAnimating=!1}}start(){this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}stop(){this.isAnimating=!1}setActiveAutocompleteBar(e){this.activeBarIndex=e}invalidate(){this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}playNoteAcceptance(e){const t=performance.now();for(const r of e){const s=(J(r.pitch)||0)*5%360;this.acceptanceAnimations.push({note:r,startTime:t,duration:800,hue:s})}this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:r,labelWidth:n,headerHeight:s,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=this.scroll.getX(),c=this.scroll.getY(),u=t*l,h=u/r,f=this.ctx;f.clearRect(0,0,f.canvas.width,f.canvas.height);const y=o-a+1;if(this.activeBarIndex!==null){const p=.5+.5*Math.sin(e*.005),{layout:{baseCellWidth:v,verticalCellRatio:S,labelWidth:_,headerHeight:C,lowestMidi:N,highestMidi:w},behavior:{zoom:L}}=this.config,G=this.scroll.getX(),E=this.scroll.getY(),M=v*L,x=M/S,B=this.activeBarIndex*M*(xe()??4)+_-G,R=B+(xe()??4)*M,F=C-E,q=(w-N+1)*x;this.ctx.save(),this.ctx.globalAlpha=.2*p,this.ctx.fillStyle="rgba(180, 255, 255, 1)",this.ctx.fillRect(B,F,R-B,q),this.ctx.restore()}const b=Ye();if(b.length>0){const p=.5+.5*Math.sin(e*.005);f.save(),f.translate(n-d,s-c);for(const v of b){const S=ne(v.pitch);if(S===null)continue;const _=y-1-(S-a),C=v.start*u,N=_*h,w=v.duration*u;f.fillStyle=`rgba(255, 100, 180, ${.2*p})`,f.beginPath(),f.roundRect(C,N,w,h,3),f.fill(),f.lineWidth=1.5,f.strokeStyle=`rgba(255, 100, 180, ${.3*p})`,f.beginPath(),f.roundRect(C,N,w,h,3),f.stroke()}f.restore()}const g=performance.now();this.acceptanceAnimations=this.acceptanceAnimations.filter(p=>{const v=(g-p.startTime)/p.duration;if(v>1)return!1;const{note:S,hue:_}=p,C=ne(S.pitch);if(C===null||C<a||C>o)return!0;const N=y-1-(C-a),w=S.start*u+n-d,L=N*h+s-c,G=S.duration*u,E=h-1,M=w+G/2,x=L+E/2,R=1+.5*Math.sin(v*Math.PI),F=(1-v)*.5;f.save(),f.globalAlpha=F,f.strokeStyle=`hsl(${_}, 100%, 65%)`,f.lineWidth=2.5;const q=G*R,Q=E*R;return f.beginPath(),f.roundRect(M-q/2,x-Q/2,q,Q,4),f.stroke(),f.restore(),!0})}}class So{constructor(e,t){this.scroll=e,this.config=t,this.x=null}setPlayheadX(e){this.x=e}clear(){this.x=null}draw(e){if(this.x==null)return;const{layout:{verticalCellRatio:t,baseCellWidth:r,labelWidth:n,headerHeight:s,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=this.config,d=a-o+1,c=this.scroll.getX(),u=this.scroll.getY(),h=r*l/t,f=d*h+s,y=this.x;e.save(),e.translate(n-c,-u),e.lineWidth=2,e.strokeStyle="rgba(168, 85, 247, 1.0)",e.shadowColor="rgba(168, 85, 247, 0.5)",e.shadowBlur=6,e.beginPath(),e.moveTo(y,0),e.lineTo(y,f),e.stroke(),e.restore()}}class ke{constructor(e,t=!0){this.canvas=e,this.dpr=t&&window.devicePixelRatio||1;const r=this.canvas.getContext("2d");if(!r)throw new Error("Failed to get 2D context");this.ctx=r}resize(){const e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,r=Math.floor(e*this.dpr),n=Math.floor(t*this.dpr);(this.canvas.width!==r||this.canvas.height!==n)&&(this.canvas.width=r,this.canvas.height=n,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr))}getContext(){return this.ctx}withContext(e){e(this.ctx)}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}destroy(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Ki{constructor(e,t,r,n,s){this.thumb=e,this.isHorizontal=t,this.scroll=r,this.interactionStore=n,this.requestRedraw=s,this.onMouseEnter=()=>this.interactionStore.setIsOnScrollbar(!0),this.onMouseLeave=()=>this.interactionStore.setIsOnScrollbar(!1),this.onThumbMouseDown=o=>this.handleMouseDown(o),this.onMouseMove=null,this.onMouseUp=null;const a=this.thumb.parentElement;if(!a)throw new Error("Scrollbar thumb must have a parent track element.");this.track=a,this.attachDragHandler()}attachDragHandler(){this.track.addEventListener("mouseenter",this.onMouseEnter),this.track.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mouseenter",this.onMouseEnter),this.thumb.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mousedown",this.onThumbMouseDown)}handleMouseDown(e){e.preventDefault(),this.interactionStore.setIsScrolling(!0),this.onMouseMove=t=>{const r=this.track.getBoundingClientRect(),n=this.isHorizontal?this.track.offsetWidth:this.track.offsetHeight,a=(this.isHorizontal?t.clientX:t.clientY)-(this.isHorizontal?r.left:r.top),o=this.isHorizontal?this.thumb.offsetWidth:this.thumb.offsetHeight,l=n-o,d=Math.max(0,Math.min(a-o/2,l)),c=l>0?d/l:0,u=this.isHorizontal?this.scroll.getMaxScrollX():this.scroll.getMaxScrollY(),h=c*u;this.isHorizontal?this.scroll.setScroll(h,this.scroll.getY()):this.scroll.setScroll(this.scroll.getX(),h),this.requestRedraw()},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.interactionStore.setIsScrolling(!1),this.onMouseMove=null,this.onMouseUp=null},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){this.track.removeEventListener("mouseenter",this.onMouseEnter),this.track.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mouseenter",this.onMouseEnter),this.thumb.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mousedown",this.onThumbMouseDown),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&document.removeEventListener("mouseup",this.onMouseUp),this.onMouseMove=null,this.onMouseUp=null}}let Hi=!1;function Co(){if(Hi)return;const i=document.createElement("style");i.textContent=`
    .grid-scrollbars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .grid-scrollbar {
      position: absolute;
      background: #1f1f1f;
      pointer-events: all;
    }

    .grid-scrollbar-thumb {
      position: absolute;
      background: #888;
      border-radius: 6px;
      cursor: pointer;
    }

    .grid-scrollbar-corner {
      position: absolute;
      width: 12px;
      height: 12px;
      bottom: 0;
      right: 0;
      background: #1f1f1f;
      z-index: 2;
      pointer-events: none;
    }
  `,document.head.appendChild(i),Hi=!0}class No{constructor(e,t,r,n,s){this.container=e,this.scroll=t,this.config=r,this.interactionStore=n,this.requestRedraw=s,this.trackThickness=16,Co(),this.createDOM(),this.attachEvents(),this.config=this.config,this.interactionStore=n}createDOM(){const e=this.hScrollbar=document.createElement("div"),t=this.hThumb=document.createElement("div"),r=this.vScrollbar=document.createElement("div"),n=this.vThumb=document.createElement("div"),s=this.corner=document.createElement("div");e.className="grid-scrollbar",r.className="grid-scrollbar",t.className="grid-scrollbar-thumb",n.className="grid-scrollbar-thumb",s.className="grid-scrollbar-corner",e.style.position=r.style.position=s.style.position="absolute",e.style.zIndex=r.style.zIndex=s.style.zIndex="5",e.style.bottom="0",e.style.left="0",e.style.right=`${this.trackThickness}px`,e.style.height=`${this.trackThickness}px`,r.style.top="0",r.style.right="0",r.style.bottom=`${this.trackThickness}px`,r.style.width=`${this.trackThickness}px`,s.style.width=`${this.trackThickness}px`,s.style.height=`${this.trackThickness}px`,s.style.right="0",s.style.bottom="0",s.style.background="#333",s.style.position="absolute",t.style.zIndex=n.style.zIndex="6",t.style.position=n.style.position="absolute",t.style.background="#7e22ce",n.style.background="#7e22ce",t.style.borderRadius=n.style.borderRadius="8px",t.style.height="100%",n.style.width="100%",e.appendChild(t),r.appendChild(n),this.container.appendChild(e),this.container.appendChild(r),this.container.appendChild(s)}attachEvents(){this.hDragHandler=new Ki(this.hThumb,!0,this.scroll,this.interactionStore,this.requestRedraw),this.vDragHandler=new Ki(this.vThumb,!1,this.scroll,this.interactionStore,this.requestRedraw)}update(){const{width:e,height:t}=this.container.getBoundingClientRect(),r=this.scroll.getContentWidth(),n=this.scroll.getContentHeight(),s=this.scroll.getX(),a=this.scroll.getY(),o=this.scroll.getMaxScrollX(),l=this.scroll.getMaxScrollY(),d=e-this.trackThickness,c=this.config.layout.labelWidth,u=Math.max(40,(e-c)/r*d),h=s/o*(d-u);this.hThumb.style.width=`${u}px`,this.hThumb.style.left=`${Math.max(0,h)}px`;const f=t-this.trackThickness,y=this.config.layout.headerHeight,b=Math.max(40,(t-y)/n*f),g=a/l*(f-b);this.vThumb.style.height=`${b}px`,this.vThumb.style.top=`${Math.max(0,g)}px`}destroy(){this.hDragHandler.destroy(),this.vDragHandler.destroy(),this.hScrollbar.remove(),this.vScrollbar.remove(),this.corner.remove(),this.hScrollbar=null,this.vScrollbar=null,this.corner=null}}var k=(i=>(i[i.NoteTool=0]="NoteTool",i[i.Selecting=1]="Selecting",i[i.SelectedIdle=2]="SelectedIdle",i[i.Dragging=3]="Dragging",i[i.Pasting=4]="Pasting",i[i.Sizing=5]="Sizing",i))(k||{});function Me(i,e,t,r,n){const s=rt(i,e),a=t.getSnapResolution(),o=t.isTripletMode();return nt(s,r,n,a,o)}function ge(i,e,t,r){const{baseCellWidth:n}=r.layout,{zoom:s}=r.behavior,a=or(i,e,t,r),o=n*s;return a.x/o}var P=(i=>(i.Default="default",i.Pointer="pointer",i.Crosshair="crosshair",i.Grabbing="grabbing",i.Grab="grab",i.ResizeHorizontal="ew-resize",i.ResizeVertical="ns-resize",i.Move="move",i.NotAllowed="not-allowed",i.Custom="url(cursor.png), auto",i))(P||{});function Ze(i,e,t,r){return!i||i.x>=ce()?(e.setSnappedCursorGridPosition(null),e.setHoveredNoteKey(null),t.set(P.Default),r(),!0):!1}function wo(i,e){const t=structuredClone(i),r=t.sequencers.find(n=>n.id===e.sequencerId);return r?(r.notes.push(...e.notes),_e(e.sequencerId),t):i}function kt(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}function Gt(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function Mo(i,e){const t=structuredClone(i),r=t.sequencers.find(s=>s.id===e.sequencerId);if(!r)return i;const n=new Set(e.notes.map(s=>`${s.pitch}|${s.start}|${s.duration}`));return r.notes=r.notes.filter(s=>{const a=`${s.pitch}|${s.start}|${s.duration}`;return!n.has(a)}),_e(e.sequencerId),t}function ae(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function oe(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}class xo{constructor(e,t,r,n,s,a,o,l,d,c,u,h){this.canvas=e,this.noteManager=t,this.scroll=r,this.config=n,this.store=s,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(Ze(t,this.store,this.cursorController,this.requestRedraw))return;const r=ge(e,this.canvas,this.scroll,this.config);if(t){const n=Z(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),s=this.noteManager.findNoteEdgeAtCursor(n,r),a=this.store.getHoveredNoteKey();if(s&&a===`${s.pitch}:${s.start}`){this.store.setSelectedNotes([s]),this.controller.transitionTo(k.Sizing);return}}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,r=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+r*r);if(this.store.isDraggingToSelect()){const c=this.store.getHoveredNoteKey();if(c&&n>=this.dragThreshold){const[u,h]=c.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}}if(n>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const s=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!s||Ze(s,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(s);const a=Z(s.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=ge(e,this.canvas,this.scroll,this.config),l=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(l){const c=`${l.pitch}:${l.start}`;this.store.setHoveredNoteKey(c),this.store.setSnappedCursorGridPosition(null),d===l?this.cursorController.set(P.ResizeHorizontal):this.cursorController.set(P.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(s),this.cursorController.set(P.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0)return;if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}this.store.isDraggingToSelect()&&this.store.endSelectionDrag();const t=this.store.getHoveredNoteKey();if(t){if(performance.now()-this.store.getLastDeletionTime()<100)return;const[d,c]=t.split(":"),u=this.noteManager.findAtPosition(d,Number(c));if(u){this.noteManager.previewNote(u.pitch,.25),this.store.setSelectedNotes([u]),this.controller.transitionTo(k.SelectedIdle);return}}const r=this.store.getSnappedCursorGridPosition();if(!r)return;const{layout:n}=this.config,s=this.grid.getNoteDuration(),a=Z(r.y,n.lowestMidi,n.highestMidi);if(!a||this.noteManager.findAtPosition(a,r.x))return;const l={start:r.x,duration:s,pitch:a,velocity:100};I(kt(this.getSequencerId(),[l]),Gt(this.getSequencerId(),[l])),this.noteManager.previewNote(a,s),this.playNoteAnimation({start:r.x,duration:s,pitch:a,velocity:100})}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[r,n]=t.split(":"),s=parseFloat(n);if(!r||isNaN(s))return;const a=this.noteManager.findAtPosition(r,s);a&&(I(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting)}}onEnter(){A("DefaultNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}function $i(i,e,t,r,n){const{layout:{baseCellWidth:s,verticalCellRatio:a,lowestMidi:o,highestMidi:l},behavior:{zoom:d}}=r,c=s*d,u=c/a,h=Math.min(e.startX,e.currentX+c/2),f=Math.max(e.startX,e.currentX+c/2),y=Math.min(e.startY,e.currentY),b=Math.max(e.startY,e.currentY),g=n.getSnapResolution(),p=Math.floor(h/c/g)*g,v=Math.floor(f/c/g)*g,S=Math.floor(y/u),_=Math.floor(b/u),C=Math.min(S,_),N=Math.max(S,_);return i.filter(w=>{const L=_i(w.pitch,o,l);if(L==null)return!1;const G=L>=C&&L<=N,E=w.start+w.duration,M=w.start>=p&&E<=v;return G&&M})}class Lo{constructor(e,t,r,n,s,a,o,l){this.canvas=e,this.config=t,this.scroll=r,this.grid=n,this.store=s,this.controller=a,this.noteManager=o,this.requestRedraw=l}onEnter(){const e=ro(this.controller.getLastMouseX(),this.controller.getLastMouseY(),this.canvas,this.scroll,this.config);this.store.setMarqueeBox({startX:e.x,startY:e.y,currentX:e.x,currentY:e.y})}onMouseMove(e){const t=this.store.getMarqueeBox();if(!t)return;const r=or(e,this.canvas,this.scroll,this.config);t.currentX=r.x,t.currentY=r.y,this.store.setMarqueeBox({...t});const n=$i(this.noteManager.getAll(),t,this.scroll,this.config,this.grid);this.store.setHighlightedNotes(n),this.requestRedraw()}onMouseUp(e){const t=this.store.getMarqueeBox();if(!t){this.controller.transitionTo(k.NoteTool);return}const r=$i(this.noteManager.getAll(),t,this.scroll,this.config,this.grid),s=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(r.length>0){const a=this.store.getSelectedNotes(),o=s?this.noteManager.mergeSelections(a,r):r;this.store.setSelectedNotes(o),this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(k.SelectedIdle)}else this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(k.NoteTool)}onExit(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.requestRedraw()}}class ko{constructor(e,t,r,n,s,a,o,l,d,c,u,h){this.canvas=e,this.config=t,this.scroll=r,this.noteManager=n,this.store=s,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!t)return;const r=ge(e,this.canvas,this.scroll,this.config),n=Z(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),s=this.noteManager.findNoteEdgeAtCursor(n,r);if(s){const a=`${s.pitch}:${s.start}`;new Set(this.store.getSelectedNotes().map(l=>`${l.pitch}:${l.start}`)).has(a)||this.store.setSelectedNotes([s]),this.controller.transitionTo(k.Sizing);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,r=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+r*r);if(this.store.isDraggingToSelect()){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),g=parseFloat(b),p=this.noteManager.findAtPosition(y,g);if(!p)return;this.store.getSelectedNotes().some(_=>_.pitch===p.pitch&&_.start===p.start)||this.store.setSelectedNotes([p]),this.store.setDragAnchorNoteKey(`${p.pitch}:${p.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}if(!f&&n>=this.dragThreshold){!e.ctrlKey&&!e.metaKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const s=rt(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),l=nt(s,this.scroll,this.config,a,o);if(!l){this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default),this.requestRedraw();return}const d=ge(e,this.canvas,this.scroll,this.config),c=Z(l.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(c,d),h=this.noteManager.findNoteEdgeAtCursor(c,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(P.ResizeHorizontal):this.cursorController.set(P.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const r=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),s=n.some(l=>`${l.pitch}:${l.start}`===r);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(s){const l=n.filter(d=>`${d.pitch}:${d.start}`!==r);this.store.setSelectedNotes(l)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(k.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(k.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[r,n]=t.split(":"),s=parseFloat(n),a=this.noteManager.findNoteUnderCursor(r,s);if(!a)return;const o=this.store.getSelectedNotes(),l=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&l?I(ae(this.getSequencerId(),o),oe(this.getSequencerId(),o)):I(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),I(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting);return}if(e.key==="Delete"){if(!t.length)return;I(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}}}function Go({notes:i,anchorBeat:e,anchorMidi:t,targetBeat:r,targetMidi:n,lowestMidi:s,highestMidi:a}){const o=r-e,l=i.map(g=>g.start+o),d=i.map(g=>g.start+o+g.duration),c=Math.min(...l),u=Math.max(...d),h=Math.min(0,c),f=Math.max(0,u-ce()),y=o-h-f;if(!wt()||Ve()){const g=n-t;return i.flatMap(p=>{const v=ne(p.pitch);if(v==null)return[];let S=v+g;S<s&&(S=s),S>a&&(S=a);const _=Ie(S);return _?[{pitch:_,start:p.start+y,duration:p.duration,velocity:p.velocity??100}]:[]})}else{const g=Mt(),p=[];for(let C=a;C>=s;C--)g.get(C)&&p.push(C);const v=p.indexOf(t),S=p.indexOf(n);if(v===-1||S===-1)return[];const _=S-v;return i.flatMap(C=>{const N=ne(C.pitch);if(N==null)return[];const w=p.indexOf(N);if(w===-1)return[];const L=w+_;if(L<0||L>=p.length)return[];const G=p[L],E=Ie(G);return E?[{pitch:E,start:C.start+y,duration:C.duration,velocity:C.velocity??100}]:[]})}}class Bo{constructor(e,t,r,n,s,a,o,l,d,c){this.canvas=e,this.config=t,this.scroll=r,this.store=n,this.grid=s,this.requestRedraw=a,this.getSequencerId=o,this.controller=l,this.cursorController=d,this.getClipboard=c}onMouseMove(e){const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!t||Ze(t,this.store,this.cursorController,this.requestRedraw))return;const r=this.getClipboard();if(!r.notes.length)return;const{lowestMidi:n,highestMidi:s}=this.config.layout,a=s-n+1,o=n+(a-1-t.y),l=t.x,d=Go({notes:r.notes,anchorBeat:r.anchorBeat,anchorMidi:r.anchorMidi,targetBeat:l,targetMidi:o,lowestMidi:n,highestMidi:s});this.store.setPreviewNotes(d),this.cursorController.set(P.Pointer),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=this.store.getPreviewNotes();t.length&&(I(kt(this.getSequencerId(),t),Gt(this.getSequencerId(),t)),this.store.clearPreviewNotes(),this.controller.transitionTo(k.NoteTool))}onMouseLeave(){this.store.clearPreviewNotes(),this.controller.transitionTo(k.NoteTool)}onExit(){this.store.clearPreviewNotes(),this.requestRedraw()}}function Eo({originalNotes:i,anchorNote:e,targetPitch:t,targetBeat:r,lowestMidi:n,highestMidi:s}){const a=ne(t),o=ne(e.pitch);if(a==null||o==null)return[];const l=r-e.start,d=i.map(p=>p.start+l),c=i.map(p=>p.start+l+p.duration),u=Math.min(...d),h=Math.max(...c),f=Math.min(0,u),y=Math.max(0,h-ce()),b=l-f-y;if(!wt()||Ve()){const p=a-o;return i.flatMap(v=>{const S=ne(v.pitch);if(S==null)return[];let _=S+p;_<n&&(_=n),_>s&&(_=s);const C=Ie(_);return C?[{pitch:C,start:v.start+b,duration:v.duration,velocity:v.velocity??100}]:[]})}else{const p=Mt(),v=[];for(let N=s;N>=n;N--)p.get(N)&&v.push(N);const S=v.indexOf(o),_=v.indexOf(a);if(S===-1||_===-1)return[];const C=_-S;return i.flatMap(N=>{const w=ne(N.pitch);if(w==null)return[];const L=v.indexOf(w);if(L===-1)return[];const G=L+C;if(G<0||G>=v.length)return[];const E=v[G],M=Ie(E);return M?[{pitch:M,start:N.start+b,duration:N.duration,velocity:N.velocity??100}]:[]})}}function Ao(i,e){const t=structuredClone(i),r=t.sequencers.find(a=>a.id===e.sequencerId);if(!r)return i;const n=e.from,s=e.to;for(let a=0;a<n.length;a++){const o=n[a],l=s[a],d=r.notes.findIndex(c=>c.pitch===o.pitch&&c.start===o.start&&c.duration===o.duration);d!==-1&&(r.notes[d].pitch=l.pitch,r.notes[d].start=l.start)}return _e(e.sequencerId),t}function lr(i,e,t){return{type:"MOVE_NOTES",sequencerId:i,from:structuredClone(e),to:structuredClone(t)}}function To(i,e,t){return lr(i,t,e)}class Io{constructor(e,t,r,n,s,a,o,l,d,c){this.canvas=e,this.config=t,this.scroll=r,this.store=n,this.noteManager=s,this.grid=a,this.requestRedraw=o,this.controller=l,this.cursorController=d,this.getSequencerId=c,this.originalNotes=[],this.anchorNote=null,this.hasMoved=!1,this.lastPreviewedPitch=null}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(k.NoteTool);return}this.originalNotes=e.map(n=>({...n}));const t=this.store.getDragAnchorNoteKey(),r=t?e.find(n=>`${n.pitch}:${n.start}`===t):e[0];this.anchorNote=r??e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasMoved=!1,this.requestRedraw()}onMouseMove(e){const t=rt(e,this.canvas),r=this.grid.getSnapResolution(),n=this.grid.isTripletMode(),s=nt(t,this.scroll,this.config,r,n);if(!s||!this.anchorNote)return;const{layout:a}=this.config,o=Z(s.y,a.lowestMidi,a.highestMidi);if(!o)return;const l=Eo({originalNotes:this.originalNotes,anchorNote:this.anchorNote,targetPitch:o,targetBeat:s.x,lowestMidi:a.lowestMidi,highestMidi:a.highestMidi});this.store.setPreviewNotes(l),this.hasMoved=!0,this.cursorController.set(P.Grabbing),o!==this.lastPreviewedPitch&&(this.noteManager.previewNote(o,.25),this.lastPreviewedPitch=o),this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote)return;const t=this.store.getPreviewNotes();if(this.hasMoved&&t.some((n,s)=>n.start!==this.originalNotes[s].start||n.pitch!==this.originalNotes[s].pitch))I(lr(this.getSequencerId(),this.originalNotes,t),To(this.getSequencerId(),this.originalNotes,t));else for(const n of this.originalNotes)this.noteManager.add(n);this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.hasMoved=!1,this.controller.transitionTo(k.NoteTool)}onExit(){if(!this.hasMoved&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.store.setDragAnchorNoteKey(null),this.requestRedraw()}}function Ro(i,e){const t=structuredClone(i),r=t.sequencers.find(s=>s.id===e.sequencerId);if(!r)return i;const n=e.resizes;for(const s of n){const a=r.notes.find(o=>o.pitch===s.pitch&&o.start===s.start);a&&(a.duration=s.newDuration)}return _e(e.sequencerId),t}function Fo(i,e){return{type:"RESIZE_NOTES",sequencerId:i,resizes:structuredClone(e)}}function Oo(i,e){const t=e.map(r=>({pitch:r.pitch,start:r.start,newDuration:r.oldDuration}));return{type:"RESIZE_NOTES",sequencerId:i,resizes:t}}class Po{constructor(e,t,r,n,s,a,o,l,d,c){this.canvas=e,this.config=t,this.scroll=r,this.store=n,this.noteManager=s,this.grid=a,this.requestRedraw=o,this.controller=l,this.cursorController=d,this.getSequencerId=c,this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.hasResized=!1,this.hasMoved=!1,this.initialMouseX=0,this.accumulatedDelta=0}onEnter(){const e=this.store.getSelectedNotes();if(this.cursorController.set(P.ResizeHorizontal),!e.length){this.controller.transitionTo(k.NoteTool);return}this.originalNotes=e.map(r=>({...r}));const t=this.store.getHoveredNoteKey();this.anchorNote=t?e.find(r=>`${r.pitch}:${r.start}`===t)??null:e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasResized=!1,this.hasMoved=!1,this.accumulatedDelta=0,this.initialMouseX=this.controller.getLastMouseX(),this.requestRedraw()}onMouseMove(e){if(!this.anchorNote)return;const t=this.grid.getSnapResolution(),n=this.grid.isTripletMode()?t*(2/3):t,s=e.clientX-this.initialMouseX,o=this.config.layout.baseCellWidth*this.config.behavior.zoom*n,l=s/o,d=Math.round(l);if(d===this.accumulatedDelta)return;this.accumulatedDelta=d;const c=d*n,u=this.originalNotes.map(h=>{const f=Math.max(n,h.duration+c);return{...h,duration:f}});this.previewNotes=u,this.store.setPreviewNotes(u),this.hasResized=!0,this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote||!this.hasResized)return;const t=this.originalNotes,n=this.previewNotes.map((a,o)=>({pitch:a.pitch,start:a.start,newDuration:a.duration})),s=t.map((a,o)=>({pitch:a.pitch,start:a.start,oldDuration:a.duration}));I(Fo(this.getSequencerId(),n),Oo(this.getSequencerId(),s)),this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.controller.transitionTo(k.NoteTool)}onExit(){if(!this.hasResized&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.cursorController.set(P.Default),this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.requestRedraw()}}class Uo{constructor(e,t,r,n,s,a,o,l,d,c,u,h){this.canvas=e,this.noteManager=t,this.scroll=r,this.config=n,this.store=s,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(!this.store.isOnNonGridElement())if(e.button!==0)this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;else{const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(Ze(t,this.store,this.cursorController,this.requestRedraw)||!t)return;const r=ge(e,this.canvas,this.scroll,this.config),n=Z(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!n)return;const s=this.noteManager.findNoteUnderCursor(n,r),a=this.noteManager.findNoteEdgeAtCursor(n,r);if(a&&s&&`${s.pitch}:${s.start}`==`${a.pitch}:${a.start}`){this.store.setSelectedNotes([a]),this.controller.transitionTo(k.Sizing);return}if(s){this.noteManager.previewNote(s.pitch,.25),this.store.setSelectedNotes([s]),this.store.suppressNextMouseUpEvent(),this.controller.transitionTo(k.SelectedIdle);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;const o=this.grid.getNoteDuration();if(this.noteManager.findAtPosition(n,t.x))return;const d={start:t.x,duration:o,pitch:n,velocity:100};I(kt(this.getSequencerId(),[d]),Gt(this.getSequencerId(),[d])),this.noteManager.previewNote(n,o),this.playNoteAnimation(d)}}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,r=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+r*r);if(e.buttons===1&&this.store.isDraggingToSelect()){const c=this.store.getHoveredNoteKey();if(c&&n>=this.dragThreshold){const[u,h]=c.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(k.Sizing);return}}}if(e.buttons===2&&this.store.isDraggingToSelect()){const c=e.clientX-this.initialMouseX,u=e.clientY-this.initialMouseY;if(Math.sqrt(c*c+u*u)>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const s=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!s||Ze(s,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(s);const a=Z(s.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=ge(e,this.canvas,this.scroll,this.config),l=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(l){const c=`${l.pitch}:${l.start}`;this.store.setHoveredNoteKey(c),this.store.setSnappedCursorGridPosition(null),d===l?this.cursorController.set(P.ResizeHorizontal):this.cursorController.set(P.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(s),this.cursorController.set(P.Default);this.requestRedraw()}onMouseUp(e){this.store.endSelectionDrag()}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[r,n]=t.split(":"),s=parseFloat(n);if(!r||isNaN(s))return;const a=this.noteManager.findAtPosition(r,s);a&&(I(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting)}}onEnter(){A("ExpressNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}class Do{constructor(e,t,r,n,s,a,o,l,d,c,u,h){this.canvas=e,this.config=t,this.scroll=r,this.noteManager=n,this.store=s,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){var e;if(window&&((e=window.event)==null?void 0:e.buttons)&1){this.store.beginSelectionDrag();const t=window.event;this.initialMouseX=t.clientX,this.initialMouseY=t.clientY}}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(this.store.isOnNonGridElement())return;const t=e.button===0,r=e.button===2,n=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!n){r&&this.beginSelectionDrag(e);return}const s=Z(n.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!s){r&&this.beginSelectionDrag(e);return}const a=ge(e,this.canvas,this.scroll,this.config),o=this.noteManager.findNoteUnderCursor(s,a);if(t){const l=this.noteManager.findNoteEdgeAtCursor(s,a);if(l){const d=`${l.pitch}:${l.start}`;new Set(this.store.getSelectedNotes().map(u=>`${u.pitch}:${u.start}`)).has(d)||this.store.setSelectedNotes([l]),this.controller.transitionTo(k.Sizing);return}o&&(this.beginSelectionDrag(e),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY)}if(r)if(o){const l=`${o.pitch}:${o.start}`;this.store.setHoveredNoteKey(l)}else this.store.setHoveredNoteKey(null),this.beginSelectionDrag(e)}beginSelectionDrag(e){this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,r=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+r*r);if(this.store.isDraggingToSelect()&&e.buttons&1){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),g=parseFloat(b),p=this.noteManager.findAtPosition(y,g);if(!p)return;this.store.getSelectedNotes().some(_=>_.pitch===p.pitch&&_.start===p.start)||this.store.setSelectedNotes([p]),this.store.setDragAnchorNoteKey(`${p.pitch}:${p.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}}else if(this.store.isDraggingToSelect()&&e.buttons&2&&!this.store.getHoveredNoteKey()&&n>=this.dragThreshold){!e.metaKey&&!e.shiftKey&&!e.ctrlKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}const s=rt(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),l=nt(s,this.scroll,this.config,a,o);if(!l){this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default),this.requestRedraw();return}const d=ge(e,this.canvas,this.scroll,this.config),c=Z(l.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(c,d),h=this.noteManager.findNoteEdgeAtCursor(c,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(P.ResizeHorizontal):this.cursorController.set(P.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(P.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement()||this.store.consumeSuppressMouseUpFlag())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const r=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),s=n.some(l=>`${l.pitch}:${l.start}`===r);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(s){const l=n.filter(d=>`${d.pitch}:${d.start}`!==r);this.store.setSelectedNotes(l)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(k.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(k.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[r,n]=t.split(":"),s=parseFloat(n),a=this.noteManager.findNoteUnderCursor(r,s);if(!a)return;const o=this.store.getSelectedNotes(),l=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&l?I(ae(this.getSequencerId(),o),oe(this.getSequencerId(),o)):I(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),I(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting);return}if(e.key==="Delete"){if(!t.length)return;I(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}}}class qo{constructor(e){this.data=e,this.mode=k.NoteTool,this.activeHandler=null,this.lastMouseX=0,this.lastMouseY=0,this.transitionTo(k.NoteTool)}handleMouseDown(e){var t,r;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(r=(t=this.activeHandler)==null?void 0:t.onMouseDown)==null||r.call(t,e)}handleMouseMove(e){var t,r;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(r=(t=this.activeHandler)==null?void 0:t.onMouseMove)==null||r.call(t,e)}handleMouseUp(e){var t,r;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(r=(t=this.activeHandler)==null?void 0:t.onMouseUp)==null||r.call(t,e)}handleContextMenu(e){var t,r;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(r=(t=this.activeHandler)==null?void 0:t.onContextMenu)==null||r.call(t,e)}handleMouseLeave(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onMouseLeave)==null||t.call(e)}handleMouseEnter(e){var t,r;(r=(t=this.activeHandler)==null?void 0:t.onMouseEnter)==null||r.call(t,e)}handleKeyDown(e){var t,r;(r=(t=this.activeHandler)==null?void 0:t.onKeyDown)==null||r.call(t,e)}transitionTo(e){var t,r,n,s;A(`Transitioning to mode: ${k[e]} from ${k[this.mode]}`),(r=(t=this.activeHandler)==null?void 0:t.onExit)==null||r.call(t),this.mode=e,this.activeHandler=this.createHandlerForMode(e),(s=(n=this.activeHandler)==null?void 0:n.onEnter)==null||s.call(n)}reset(){this.transitionTo(k.NoteTool)}createHandlerForMode(e){const t={transitionTo:r=>this.transitionTo(r),getLastMouseX:()=>this.lastMouseX,getLastMouseY:()=>this.lastMouseY};switch(e){case k.NoteTool:{const{global:{noteToolMode:r}}=z(),n=r==="express"?Uo:xo,s=[this.data.canvas,this.data.noteManager,this.data.scroll,this.data.config,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard,this.data.playNoteAnimation];return new n(...s)}case k.Selecting:return new Lo(this.data.canvas,this.data.config,this.data.scroll,this.data.grid,this.data.store,t,this.data.noteManager,this.data.requestRedraw);case k.SelectedIdle:{const{global:{noteToolMode:r}}=z(),n=r==="express"?Do:ko,s=[this.data.canvas,this.data.config,this.data.scroll,this.data.noteManager,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.setClipboard,this.data.getClipboard];return new n(...s)}case k.Pasting:return new Bo(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard);case k.Dragging:return new Io(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());case k.Sizing:return new Po(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());default:return{}}}destroy(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onExit)==null||t.call(e),this.activeHandler=null}}class Ko{constructor(e){this.current=P.Default,this.canvas=e}set(e){this.current!==e&&(this.canvas.style.cursor=e,this.current=e)}reset(){this.set(P.Default)}}class Ho{constructor(e,t){this.context=e,this.canvas=t,this.onMouseMove=r=>{this.context.handleMouseMove(r)},this.onMouseDown=r=>{this.context.handleMouseDown(r)},this.onMouseUp=r=>{this.context.handleMouseUp(r)},this.onMouseLeave=()=>{this.context.handleMouseLeave()},this.onMouseEnter=r=>{var n,s;(s=(n=this.context).handleMouseEnter)==null||s.call(n,r)},this.onContextMenu=r=>{this.context.handleContextMenu(r)},this.onKeyDown=r=>{this.context.handleKeyDown(r)},this.attachListeners(),this.canvas.style.pointerEvents="auto"}attachListeners(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("contextmenu",this.onContextMenu),window.addEventListener("keydown",this.onKeyDown)}destroy(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("keydown",this.onKeyDown)}}class $o{constructor(e,t,r){this.canvas=e,this.scroll=t,this.requestRedraw=r,this.SCROLL_SPEED_X=1,this.SCROLL_SPEED_Y=1,this.onWheel=n=>{n.preventDefault();const s=n.shiftKey||Math.abs(n.deltaX)>Math.abs(n.deltaY),a=n.deltaX||n.deltaY;if(s){const o=this.scroll.getX()+a*this.SCROLL_SPEED_X;this.scroll.setScroll(o,this.scroll.getY())}else{const o=this.scroll.getY()+n.deltaY*this.SCROLL_SPEED_Y;this.scroll.setScroll(this.scroll.getX(),o)}this.requestRedraw()},this.attachListeners()}attachListeners(){this.canvas.addEventListener("wheel",this.onWheel,{passive:!1})}destroy(){this.canvas.removeEventListener("wheel",this.onWheel)}}class zo{constructor(){this.snappedCursorGridPosition=null,this.previewNotes=[],this.hoveredNoteKey=null,this.marqueeBox=null,this.highlightedNoteKeys=new Set,this.suppressNextMouseUp=!1,this.selectedNotes=[],this.dragAnchorNoteKey=null,this.isOnScrollbar=!1,this.isScrolling=!1,this.isInitiatingSelectionDrag=!1,this.isDraggingNotes=!1,this.lastDeletionTime=0}setSnappedCursorGridPosition(e){this.snappedCursorGridPosition=e}getSnappedCursorGridPosition(){return this.snappedCursorGridPosition}setPreviewNotes(e){this.previewNotes=e}getPreviewNotes(){return this.previewNotes}clearPreviewNotes(){this.previewNotes=[]}setHoveredNoteKey(e){this.hoveredNoteKey=e}getHoveredNoteKey(){return this.hoveredNoteKey}setMarqueeBox(e){this.marqueeBox=e}getMarqueeBox(){return this.marqueeBox}hasMarquee(){return this.marqueeBox!==null}setHighlightedNotes(e){this.highlightedNoteKeys=new Set(e.map(t=>`${t.pitch}:${t.start}`))}clearHighlightedNotes(){this.highlightedNoteKeys.clear()}isNoteHighlighted(e){return this.highlightedNoteKeys.has(`${e.pitch}:${e.start}`)}suppressNextMouseUpEvent(){this.suppressNextMouseUp=!0}consumeSuppressMouseUpFlag(){const e=this.suppressNextMouseUp;return this.suppressNextMouseUp=!1,e}getSelectedNotes(){return this.selectedNotes}setSelectedNotes(e){this.selectedNotes=e}clearSelection(){this.selectedNotes=[]}hasSelection(){return this.selectedNotes.length>0}setDragAnchorNoteKey(e){this.dragAnchorNoteKey=e}getDragAnchorNoteKey(){return this.dragAnchorNoteKey}setIsOnScrollbar(e){this.isOnScrollbar=e}getIsOnScrollbar(){return this.isOnScrollbar}setIsScrolling(e){this.isScrolling=e}isOnNonGridElement(){return this.isOnScrollbar||this.isScrolling}beginSelectionDrag(){this.isInitiatingSelectionDrag=!0}endSelectionDrag(){this.isInitiatingSelectionDrag=!1}isDraggingToSelect(){return this.isInitiatingSelectionDrag}setIsDraggingNotes(e){this.isDraggingNotes=e}getIsDraggingNotes(){return this.isDraggingNotes}isActivelyDragging(){return this.isDraggingNotes||this.isInitiatingSelectionDrag}setLastDeletionTime(){this.lastDeletionTime=performance.now()}getLastDeletionTime(){return this.lastDeletionTime}}class Jo{constructor(e){this.container=this.createContainer(),e.appendChild(this.container),this.gridCanvas=this.createCanvas("gridCanvas"),this.noteCanvas=this.createCanvas("noteCanvas"),this.animationCanvas=this.createCanvas("animationCanvas"),this.playheadCanvas=this.createCanvas("playheadCanvas"),this.aipreviewCanvas=this.createCanvas("aipreviewCanvas"),this.aiAnimationCanvas=this.createCanvas("aiAnimationCanvas"),this.container.appendChild(this.gridCanvas),this.container.appendChild(this.noteCanvas),this.container.appendChild(this.animationCanvas),this.container.appendChild(this.playheadCanvas),this.container.appendChild(this.aipreviewCanvas),this.container.appendChild(this.aiAnimationCanvas),this.gridCtx=this.getCtx(this.gridCanvas),this.noteCtx=this.getCtx(this.noteCanvas),this.animationCtx=this.getCtx(this.animationCanvas),this.playheadCtx=this.getCtx(this.playheadCanvas),this.aipreviewCtx=this.getCtx(this.aipreviewCanvas),this.aiAnimationCtx=this.getCtx(this.aiAnimationCanvas),this.injectContainerStyles(),this.injectCanvasStyles()}createContainer(){const e=document.createElement("div");return e.id="grid-container",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="#222",e.style.border="1px solid #333",e.style.overflow="hidden",e.style.boxShadow="0 0 20px rgba(0,0,0,0.4)",e.style.borderRadius="6px",e}createCanvas(e){const t=document.createElement("canvas");return t.id=e,t.style.display="block",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t}getCtx(e){const t=e.getContext("2d");if(!t)throw new Error(`2D context not available for canvas with id: ${e.id}`);return t}injectContainerStyles(){const e=document.createElement("style");e.textContent=`
        #grid-container canvas {
          z-index: 0;
        }
        #grid-container canvas#noteCanvas {
          z-index: 1;
        }
        #grid-container canvas#aipreviewCanvas {
          z-index: 2;
        }
        #grid-container canvas#aiAnimationCanvas {
          z-index: 3;
        }
        #grid-container canvas#animationCanvas {
          z-index: 4;
        }
        #grid-container canvas#playheadCanvas {
          z-index: 5;
        }
      `,document.head.appendChild(e)}injectCanvasStyles(){}}class Wo{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,headerHeight:r,labelWidth:n},totalMeasures:s,beatsPerMeasure:a,behavior:{zoom:o}}=this.config,{gridColorScheme:l}=z().theme,d=vi[l],c=t*o,u=this.scroll.getX(),h=e.canvas.offsetWidth;e.save(),e.translate(n-u,0);const f=e.createLinearGradient(0,0,0,r);f.addColorStop(0,d.labelWhite),f.addColorStop(1,d.labelBlack),e.fillStyle=f,e.fillRect(-n+u,0,h,r);for(let y=0;y<=s;y++){const g=y*a*c,p=y%4===0;e.strokeStyle=p?d.measureLine:d.beatLine,e.lineWidth=p?2:1,e.beginPath(),e.moveTo(g,0),e.lineTo(g,r),e.stroke(),e.textAlign="center",e.textBaseline="top",e.fillStyle=p?d.textWhite:d.textBlack,e.font=`${p?"bold":""} ${Math.floor(r*.5)}px 'Inter', sans-serif`;const v=g+a*c/2;e.fillText(`${y+1}`,v,4)}e.restore()}}class jo{constructor(e,t,r,n){this.scroll=e,this.config=t,this.getCustomLabels=r,this.getBlackKeyMap=n;const{lowestMidi:s,highestMidi:a}=t.layout;this.blackKeyMap=qs(s,a)}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:r,headerHeight:n,labelWidth:s,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=this.config,{gridColorScheme:d}=z().theme,c=vi[d],u=a-o+1,h=this.scroll.getY(),y=t*l/r,b=e.canvas.offsetHeight??u*y+n;e.save(),e.translate(0,-h);const g=e.createLinearGradient(0,0,0,b);g.addColorStop(0,c.labelWhite),g.addColorStop(1,c.labelBlack),e.fillStyle=g,e.fillRect(0,h,s,b),e.font=`${Math.floor(y*.6)}px 'Inter', sans-serif`,e.textAlign="right",e.textBaseline="middle",e.strokeStyle=c.gridLine,e.lineWidth=1,e.beginPath(),e.moveTo(s-.5,h),e.lineTo(s-.5,h+b),e.stroke();const p=this.getCustomLabels();for(let v=0;v<u;v++){const S=v*y+n,_=a-v,C=(p==null?void 0:p[_])??Z(v,o,a),N=this.getBlackKeyMap().get(_)??!1;e.fillStyle=N?c.textBlack:c.textWhite,e.fillText(C,s-8,S+y/2)}e.restore()}}class Xo{constructor(e,t,r){this.scroll=e,this.config=t,this.interactionStore=r}draw(e){const t=this.interactionStore.getMarqueeBox();if(!t)return;const{layout:{baseCellWidth:r,verticalCellRatio:n},behavior:{zoom:s}}=this.config,a=this.scroll.getX(),o=this.scroll.getY(),l=Math.min(t.startX,t.currentX),d=Math.min(t.startY,t.currentY),c=Math.abs(t.currentX-t.startX),u=Math.abs(t.currentY-t.startY);c<1||u<1||(e.save(),e.translate(this.config.layout.labelWidth-a,this.config.layout.headerHeight-o),e.strokeStyle="rgba(128, 90, 213, 1.0)",e.lineWidth=2,e.setLineDash([5,5]),Fe(e,l,d,c,u,3),e.stroke(),e.restore())}}const at={cellWidth:40,cellHeight:20,visibleNotes:36,noteRange:["C1","B9"],currentDuration:1,snapResolution:1,isTripletMode:!1,loopEnabled:!1,useEqualTemperament:!0};let cr={notes:[],anchorBeat:0,anchorMidi:0};function Vo(i){if(i.length===0)return;const e=i[0],t=e.start,r=$(e.pitch)??0;cr={notes:i.map(n=>({pitch:n.pitch,start:n.start,duration:n.duration,velocity:n.velocity??100})),anchorBeat:t,anchorMidi:r}}function Yo(){return cr}class Zo{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t)}off(e,t){var r;(r=this.listeners[e])==null||r.delete(t)}emit(e,t){var r;(r=this.listeners[e])==null||r.forEach(n=>n(t))}clear(e){var t;(t=this.listeners[e])==null||t.clear()}removeAllListeners(){var e;for(const t in this.listeners)(e=this.listeners[t])==null||e.clear()}}class Qo{constructor(e,t={},r){this.sequencerConfig=at,this.needsRedraw=!0,this.customLabels=null,this.blackKeyMap=new Map,this.isDestroyed=!1,this.onWindowResize=()=>this.resize(),this.config=Qa(Za(),t),this.sequencerContext=r,this.recalculateLabelAndHeader(),this.gridManager=new Jo(e);const{gridCanvas:n,noteCanvas:s,animationCanvas:a,playheadCanvas:o,aipreviewCanvas:l,aiAnimationCanvas:d}=this.gridManager;this.gridCanvasManager=new ke(n),this.noteCanvasManager=new ke(s),this.animationCanvasManager=new ke(a),this.playheadCanvasManager=new ke(o),this.aipreviewCanvasManager=new ke(l),this.aiAnimationCanvasManager=new ke(d);const c=this.gridManager.container;this.noteManager=new no(this.config,this.sequencerContext.playNote),this.interactionStore=new zo,this.emitter=new Zo,this.scroll=new so(c,this.config),this.scrollbars=new No(c,this.scroll,this.config,this.interactionStore,()=>this.requestRedraw()),this.wheelHandler=new $o(c,this.scroll,()=>this.requestRedraw()),this.cursorController=new Ko(c);const u={canvas:s,noteManager:this.noteManager,scroll:this.scroll,config:this.config,store:this.interactionStore,grid:this,addNote:h=>this.noteManager.add(h),requestRedraw:()=>this.requestRedraw(),sequencerContext:r,cursorController:this.cursorController,setClipboard:Vo,getClipboard:Yo,playNoteAnimation:h=>this.playNoteAnimation(h)};this.interactionContext=new qo(u),this.inputTracker=new Ho(this.interactionContext,c),this.gridRenderer=new eo(this.scroll,this.config,this.interactionStore,()=>this.getBlackKeyMap(),()=>Mt()),this.noteRenderer=new po(this.scroll,this.config,this.noteManager,this.interactionStore,this.sequencerContext.getId()),this.notePreviewRenderer=new mo(this.scroll,this.config,this.interactionStore,()=>this.getNoteDuration()),this.animationRenderer=new bo(this.scroll,this.config),this.headerRenderer=new Wo(this.scroll,this.config),this.labelRenderer=new jo(this.scroll,this.config,()=>this.customLabels,()=>this.getBlackKeyMap()),this.playheadRenderer=new So(this.scroll,this.config),this.marqueeRenderer=new Xo(this.scroll,this.config,this.interactionStore),this.aiAutocompletePreviewRenderer=new _o(this.scroll,this.config),this.aiAnimationRenderer=new vo(this.scroll,this.config,this.aiAnimationCanvasManager.getContext()),this.initialZoom=this.zoom,this.customLabels=null,requestAnimationFrame(()=>this.resize()),this.playheadRenderer.setPlayheadX(0),this.attachListeners(),this.renderLoop()}attachListeners(){window.addEventListener("resize",this.onWindowResize)}detachListeners(){window.removeEventListener("resize",this.onWindowResize)}renderLoop(){this.isDestroyed||(this.needsRedraw&&(this.render(),this.needsRedraw=!1),requestAnimationFrame(()=>this.renderLoop()))}recalculateLabelAndHeader(){const{baseCellWidth:e,verticalCellRatio:t,labelWidthColumns:r,headerHeightRows:n}=this.config.layout,s=this.zoom,a=e*s,o=a/t;this.config.layout.labelWidth=r*a,this.config.layout.headerHeight=n*o}get zoom(){return this.config.behavior.zoom}set zoom(e){this.config.behavior.zoom=e}get notes(){const e=this.noteManager.getAll();return e||[]}render(){this.gridCanvasManager.clear(),this.noteCanvasManager.clear(),this.animationCanvasManager.clear(),this.playheadCanvasManager.clear(),this.aipreviewCanvasManager.clear();const e=this.gridCanvasManager.getContext(),t=this.noteCanvasManager.getContext(),r=this.animationCanvasManager.getContext(),n=this.playheadCanvasManager.getContext(),s=this.aipreviewCanvasManager.getContext();this.gridRenderer.draw(e),this.noteRenderer.draw(t),this.notePreviewRenderer.draw(t),this.animationRenderer.draw(r),this.labelRenderer.draw(e),this.headerRenderer.draw(e),this.playheadRenderer.draw(n),this.aiAutocompletePreviewRenderer.draw(s),this.interactionStore.hasMarquee()&&this.marqueeRenderer.draw(r),this.scrollbars.update()}requestRedraw(){this.needsRedraw=!0}resize(){this.gridCanvasManager.resize(),this.noteCanvasManager.resize(),this.animationCanvasManager.resize(),this.playheadCanvasManager.resize(),this.aipreviewCanvasManager.resize(),this.aiAnimationCanvasManager.resize(),this.scroll.recalculateBounds(),this.scrollbars.update(),this.requestRedraw()}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}setPlayheadPixelX(e){this.playheadRenderer.setPlayheadX(e),this.requestRedraw()}getPixelsPerBeat(){return this.config.layout.baseCellWidth*this.config.behavior.zoom}setNotes(e){this.noteManager.set(e),this.requestRedraw()}playNoteAnimation(e){this.animationRenderer.playNote(e)}invalidateAIAutocompleteRenderer(){this.aiAnimationRenderer.invalidate()}startAIAutocompleteAnimationLoop(){this.aiAnimationRenderer.start()}stopAIAutocompleteAnimationLoop(){this.aiAnimationRenderer.stop()}setActiveAutocompleteBar(e){this.aiAnimationRenderer.setActiveAutocompleteBar(e),requestAnimationFrame(this.aiAnimationRenderer.renderFrame)}playNoteAcceptanceAnimation(e){this.aiAnimationRenderer.playNoteAcceptance(e)}getTrackedNotes(){return this.noteManager.getTrackedNotes(this.interactionStore)}scrollTo(e,t){this.scroll.setScroll(e,t),this.scrollbars.update(),this.requestRedraw()}setZoom(e){this.zoom=e,this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.requestRedraw()}getZoom(){return this.zoom}resetZoom(){this.setZoom(this.initialZoom)}zoomIn(){this.setZoom(Math.min(this.config.behavior.maxZoom,this.zoom+.1))}zoomOut(){this.setZoom(Math.max(this.config.behavior.minZoom,this.zoom-.1))}setCustomLabels(e){this.customLabels=e,this.requestRedraw()}getMeasures(){return this.config.totalMeasures}setMeasures(e){this.config.totalMeasures=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getBeatsPerMeasure(){return this.config.beatsPerMeasure}setBeatsPerMeasure(e){this.config.beatsPerMeasure=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getTotalBeats(){return this.config.totalMeasures*this.config.beatsPerMeasure}setNoteRange(e,t){this.config.layout.lowestMidi=e,this.config.layout.highestMidi=t,this.blackKeyMap=qs(e,t),this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.resize(),this.requestRedraw()}refreshNoteRange(){this.setNoteRange(this.config.layout.lowestMidi,this.config.layout.highestMidi)}getBlackKeyMap(){return this.blackKeyMap}isTripletMode(){return ci()}getNoteDuration(){return this.sequencerConfig.currentDuration}getSnapResolution(){return Tt()}getInteractionStore(){return this.interactionStore}getNoteManager(){return this.noteManager}getInteractionContext(){return this.interactionContext}emit(e,t){this.emitter.emit(e,t)}destroy(){this.inputTracker.destroy(),this.wheelHandler.destroy(),this.scrollbars.destroy(),this.aiAnimationRenderer.stop(),this.gridManager.container.remove(),this.gridCanvasManager.destroy(),this.noteCanvasManager.destroy(),this.animationCanvasManager.destroy(),this.playheadCanvasManager.destroy(),this.aipreviewCanvasManager.destroy(),this.aiAnimationCanvasManager.destroy(),this.detachListeners(),this.emitter.removeAllListeners(),this.interactionContext.destroy(),this.isDestroyed=!0}}function el(i,e,t){return new Qo(i,e,t)}function dr({instrument:i,midi:e,time:t,duration:r,velocity:n}){var a;const s=((a=i.__midiMap)==null?void 0:a.get(e))??e;if(!(i!=null&&i.start)){console.warn("[startInstrumentNote] Instrument missing start() method");return}try{i.start({note:s,time:t,duration:r,velocity:n})}catch(o){console.warn("[startInstrumentNote] Failed to start instrument note",{midi:e,resolved:s,err:o})}}function Ni(i,e){var t;(t=i==null?void 0:i.stop)==null||t.call(i);for(const r of e)clearTimeout(r);e.length=0}async function tl(i,e,t,r,n,s,a,o=0){if(!n)return;if(i||await e(),Ni(i,s),!(i!=null&&i.start)){console.warn("[playback] Instrument does not support scheduled playback.");return}const d=60/de(),c=performance.now();t.sort((h,f)=>h.start-f.start);let u=0;for(;u<t.length&&t[u].start<o;)u++;for(;u<t.length;u++){const h=t[u],f=J(h.pitch);if(f==null)continue;const y=h.start-o,b=a+y*d,g=h.duration*d,p=h.velocity??100;if(dr({instrument:i,midi:f,time:b,duration:g,velocity:p}),!r){const v=c+y*d*1e3,S=Math.max(0,v-performance.now()),_=setTimeout(()=>{n==null||n.playNoteAnimation(h)},S);s.push(_)}}}function il(i,e,t,r,n,s){if(!r||n)return;const o=60/de();performance.now();const c=(X().currentTime-e)/o,u=t+c;for(const h of i){if(h.start<u)continue;const y=(h.start-u)*o*1e3;if(y>=0){const b=setTimeout(()=>{r==null||r.playNoteAnimation(h)},y);s.push(b)}}}async function sl(i,e,t,r,n,s,a,o,l,d=0){if(!r||(Ni(i,o),i||await e(),s||!a||!(i!=null&&i.start)))return;const u=60/de(),h=performance.now(),f=X().currentTime,y=t.filter(b=>b.start>=d);for(const b of y){const g=J(b.pitch);if(g==null)continue;const p=b.start-d,v=l+p*u;if(v<=f+.01)continue;const S=b.duration*u,_=b.velocity??100;if(dr({instrument:i,midi:g,time:v,duration:S,velocity:_}),!n){const C=h+p*u*1e3,N=Math.max(0,C-performance.now()),w=setTimeout(()=>{r==null||r.playNoteAnimation(b)},N);o.push(w)}}}class ur{constructor(e,t,r=X(),n=Ae(),s="sf2/fluidr3-gm/acoustic_grand_piano",a=!1,o=0){if(this.colorIndex=0,this.id=0,this.mute=!1,this.solo=!1,this.collapsed=!1,this.miniContour=null,this.body=null,this.collapseIcon=null,this._scheduledAnimations=[],this._volume=100/127,this._pan=0,this._instrument=null,this.id=o,this.container=e,this.config={...t},this.context=r,this.destination=n,this.instrumentName=s,this.squelchLoadingScreen=a,this.container){const l=this.container.querySelector(".sequencer-body");this.matrix=el(l,{},{playNote:this.playNote.bind(this),getId:()=>this.id}),this.matrix.refreshNoteRange()}}async initInstrument(){try{this._instrument=await nr(this.instrumentName,this.context,this.destination,this._volume,this._pan,!1,!1),this.updateToDrumNoteRange()}catch(e){console.warn(`[SEQ:${this.id}] Failed to load instrument '${this.instrumentName}':`,e)}}setInstrument(e){this.instrumentName=e,this.updateTrackLabel(),this.initInstrument()}updateTrackLabel(){var t;const e=(t=this.container)==null?void 0:t.querySelector(".track-name");e&&(e.textContent=`${this.id+1}: ${this.instrumentName}`)}get notes(){var e;return((e=this.matrix)==null?void 0:e.notes)??[]}get volume(){return this._volume}set volume(e){var t;this._volume=Math.max(0,Math.min(1,e)),(t=this._instrument)!=null&&t.setVolume&&this._instrument.setVolume(this._volume)}get pan(){return this._pan}set pan(e){var t;this._pan=Math.max(-1,Math.min(1,e)),(t=this._instrument)!=null&&t.setPan&&this._instrument.setPan(this._pan)}get shouldPlay(){return Mc()?this.solo:!this.mute}get scheduledAnimations(){return this._scheduledAnimations}set scheduledAnimations(e){this._scheduledAnimations=e}toggleMute(){const e=H.getInstance();this.mute=!this.mute,this.mute&&(this.solo=!1),this.stopScheduledNotes(),Di(this),e.isActive()&&cs()}toggleSolo(){const e=H.getInstance();this.solo=!this.solo,this.solo&&(this.mute=!1),Di(this),e.isActive()&&cs()}setCollapsed(e){this.collapsed=e}resetInteractionMode(){var e;(e=this.matrix)==null||e.getInteractionContext().reset()}async preparePlayback(e,t=0){var r;await tl(this._instrument,()=>this.initInstrument(),((r=this.matrix)==null?void 0:r.notes)??[],this.collapsed,this.matrix??null,this._scheduledAnimations,e,t)}stopScheduledNotes(){Ni(this._instrument,this._scheduledAnimations)}resumeAnimationsFromCurrentTime(e,t){var r;il(((r=this.matrix)==null?void 0:r.notes)??[],e,t,this.matrix??null,this.collapsed,this._scheduledAnimations)}async reschedulePlayback(e,t=0){var r;await sl(this._instrument,()=>this.initInstrument(),((r=this.matrix)==null?void 0:r.notes)??[],this.matrix??null,this.collapsed,this.mute,this.shouldPlay,this._scheduledAnimations,e,t)}async exportToOffline(e,t){var n;const r=t??((n=this.matrix)==null?void 0:n.notes);!r||r.length===0||await za(this.instrumentName,this.context,this.destination,r,this._volume,this._pan,e)}playNote(e,t,r=100,n=!1){return ya(this.instrumentName,e,t,r,n,null,Le(),this.destination,this.volume,this.pan)}updateTotalMeasures(){this.matrix&&this.matrix.setMeasures(Ei())}updateBeatsPerMeasure(){this.matrix&&this.matrix.setBeatsPerMeasure(xe())}redraw(){var e;(e=this.matrix)==null||e.requestRedraw()}getState(){return this.matrix?{notes:[...this.matrix.notes],config:{...this.config},instrument:this.instrumentName}:{notes:[],config:this.config,instrument:this.instrumentName}}setState({notes:e,config:t,instrument:r,volume:n,pan:s,collapsed:a}){this.matrix&&(this.matrix.setNotes(e),Object.assign(this.config,t),typeof n=="number"&&(this.volume=n),typeof s=="number"&&(this.pan=s),bt(this,a),r&&(this.instrumentName=r),this.redraw())}updateNotesFromTrackMap(e){this.matrix&&this.matrix.notes.splice(0,this.matrix.notes.length,...e.n.map(([t,r,n,s=100])=>({pitch:t,start:r,duration:n,velocity:s})))}updateNoteRange(e){ni({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var t;return((t=this.matrix)==null?void 0:t.notes)??[]}},e)}updateToDrumNoteRange(){Ja({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var e;return((e=this.matrix)==null?void 0:e.notes)??[]}})}destroy(){var e,t;this.stopScheduledNotes(),(e=this.matrix)==null||e.destroy(),(t=this.container)==null||t.remove(),Nc(this.id),H.getInstance().removeSequencer(this),this._instrument=null,this.matrix=void 0,this.container=null,this.refreshPanUI=void 0,this.refreshVolumeUI=void 0}}function rl(i,e){const t=structuredClone(i);t.sequencers=t.sequencers.filter(n=>n.id!==e.id);const r=ar(e.id);return r?r.destroy():console.warn(`DELETE_SEQUENCER: No controller found for id ${e.id}`),_e(null),t}function hr(i,e,t=[],r,n,s){return{type:"DELETE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:r,pan:n,collapsed:s}}function fr(i,e,t=[],r,n,s){return{type:"CREATE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:r,pan:n,collapsed:s}}function nl(i,e,t){const r={id:t,...at},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",s=new ur(i,r,X(),Ae(),n,!0,t);s.id=t,s.colorIndex=t,s.mute=!1,s.solo=!1,s.volume=100/127,e.notes&&s.matrix&&s.matrix.setNotes(e.notes),e&&s.setState({notes:e.notes,config:{},instrument:e.instrument,volume:e.volume,pan:e.pan,collapsed:e.collapsed});const a=i.querySelector("canvas.mini-contour");return s.miniContour=a,xt(a,s.notes,s.config,s.colorIndex),s.updateTrackLabel(),s.initInstrument(),Cc(s.id,s),H.getInstance().addSequencer(s),{seq:s}}function al(){var i,e;for(const t of K().slice())I(hr(t.id,t.instrumentName,((i=t.matrix)==null?void 0:i.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed),fr(t.id,t.instrumentName,((e=t.matrix)==null?void 0:e.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed));wc(),Wa(),H.getInstance().clearSequencers()}function T(i,e){return m("img",{src:ie(`static/svg/${i}.svg`),class:"w-6 h-6",alt:e})}function ol(){const i=O(),e=m("div",{class:`sequencer-header flex justify-between items-center ${i.textColor}`}),t=m("canvas",{class:"mini-contour w-full h-10 mb-2 bg-gray-800 rounded hidden"}),r=m("div",{class:`sequencer-body flex pt-2 h-[720px] border-t ${i.borderColor}`}),n=m("div",{class:"grip-handle group flex justify-center items-center h-6 cursor-grab hover:bg-gray-800 rounded"},T("icon-grip","Drag Track"));return{element:m("div",{class:`sequencer flex flex-col space-y-2 p-4 rounded ${i.surfaceBackground}`},e,t,r,n),topBarContainer:e,miniContourCanvas:t,matrixContainer:r,gripHandleContainer:n}}function ll(){const i=O(),e=m("div",{class:"sequencer-left-group-wrapper flex items-center gap-2"}),t=m("div",{class:"sequencer-volume-wrapper"}),r=m("div",{class:"sequencer-pan-wrapper"}),n=m("div",{class:"sequencer-zoom-wrapper flex items-center gap-2"}),s=m("div",{class:"sequencer-right-controls-wrapper flex items-center gap-2"}),a=m("div",{class:"sequencer-right-group-container flex items-center gap-3"},t,r,n,s);return{element:m("div",{class:`sequencer-header flex justify-between items-center w-full px-2 ${i.textColor}`},e,a),leftGroup:e,volumeWrapper:t,panWrapper:r,zoomWrapper:n,rightControlsWrapper:s}}function cl(){const i=O(),e=m("button",{class:["instrument-select-btn","side-button-primary","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonPrimaryColor,i.buttonPrimaryColorHover,i.textColor].join(" "),title:"Change Instrument"},T("icon-list-instrument","Change Instrument")),t=m("button",{draggable:"true",class:["copy-midi-btn","side-button-secondary","cursor-grab select-none","px-2 py-1 rounded w-8 flex items-center justify-center","transition-transform transition-opacity duration-150","hover:scale-105 hover:brightness-110 active:cursor-grabbing",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Export MIDI Track (Drag to Desktop)"},T("icon-copy","Export MIDI")),r=m("span",{class:`track-name font-semibold ${i.textColor}`},"Track");return{instrumentButton:e,copyMidiButton:t,label:r}}function dl(){const i=O(),e=m("div",{class:`volume-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.volumeGradientFrom} ${i.volumeGradientTo}`,style:"width: 60%;"}),t=m("div",{class:`volume-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 78.74%;"}),r=m("div",{class:["volume-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.volumeThumbColor].join(" "),style:"left: calc(60% - 5px);"});return{element:m("div",{class:`volume-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,r),fill:e,snapMarker:t,thumb:r}}function ul(){const i=O(),e=m("div",{class:`pan-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.panGradientFrom} ${i.panGradientTo}`,style:"width: 50%;"}),t=m("div",{class:`pan-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 50%;"}),r=m("div",{class:["pan-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.panThumbColor].join(" "),style:"left: calc(50% - 5px);"});return{element:m("div",{class:`pan-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,r),fill:e,snapMarker:t,thumb:r}}function hl(){const i=O(),e=m("button",{class:["zoom-in-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom In"},T("icon-zoom-in","Zoom In")),t=m("button",{class:["zoom-out-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom Out"},T("icon-zoom-out","Zoom Out")),r=m("button",{class:["zoom-reset-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Reset Zoom"},T("icon-reset","Reset Zoom")),n=m("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`}),s=m("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`});return{element:m("div",{class:"flex items-center gap-2"},n,e,t,r,s),leadingDivider:n,zoomInBtn:e,zoomOutBtn:t,zoomResetBtn:r,trailingDivider:s}}function fl(){const i=O(),e=["side-button-secondary cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor],t=m("button",{class:[...e,"mute-btn"].join(" "),title:"Mute Track"},T("icon-volume-mute","Mute Track")),r=m("button",{class:[...e,"solo-btn"].join(" "),title:"Solo Track"},T("icon-headphones","Solo Track")),n=m("button",{class:[...e,"collapse-btn"].join(" "),title:"Expand/Collapse Track"},T("icon-caret-down","Expand/Collapse")),s=m("button",{class:[...e,"delete-btn hover:bg-red-600"].join(" "),title:"Delete Track"},T("icon-close-circle","Delete Track"));return{element:m("div",{class:"flex items-center gap-2"},t,r,n,s),muteBtn:t,soloBtn:r,collapseBtn:n,deleteBtn:s}}function pl(i,e,t){let r=!1,n=0,s=0;const a=150,o=1e3,l=u=>{r=!0,n=u.clientY,s=e.offsetHeight,i.classList.replace("cursor-grab","cursor-grabbing"),document.body.style.userSelect="none"},d=u=>{if(!r)return;const h=u.clientY-n;let f=s+h;f=Math.max(a,Math.min(o,f)),e.style.height=`${f}px`,t.resize()},c=()=>{r&&(r=!1,i.classList.replace("cursor-grabbing","cursor-grab"),document.body.style.userSelect="")};return i.addEventListener("mousedown",l),window.addEventListener("mousemove",d),window.addEventListener("mouseup",c),{detach:()=>{i.removeEventListener("mousedown",l),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",c)},refreshUI:()=>{}}}const ml={sm:"text-base",md:"text-lg",lg:"text-xl",xl:"text-2xl"};function me(i){const e=O();if(typeof i=="string")return m("h2",{class:["text-lg font-semibold mb-4",e.textColor].join(" "),textContent:i});const{text:t,size:r="md",additionalClasses:n=""}=i;return m("h2",{class:[ml[r],"font-semibold mb-4",e.textColor,n].join(" "),textContent:t})}function yl(){const i=me({text:"Delete Track",size:"lg",additionalClasses:"text-center mb-4"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"Are you sure you want to delete this track?"}),t=U({id:"delete-confirm",text:"Delete",kind:"tertiary",additionalClasses:"flex-1 py-2"}),r=U({id:"delete-cancel",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2"}),n=m("div",{class:"flex gap-3 w-full"},t,r);return te("delete-confirm-modal",[i,e,n],{sizePreset:"sm"})}function gl(i,e,t){const r=i.querySelector("#delete-confirm"),n=i.querySelector("#delete-cancel"),s=()=>{e(),i.classList.add("hidden")},a=()=>{t(),i.classList.add("hidden")};return r==null||r.addEventListener("click",s),n==null||n.addEventListener("click",a),{detach:()=>{r==null||r.removeEventListener("click",s),n==null||n.removeEventListener("click",a)},refreshUI:()=>{}}}class _l{constructor(){this.detachFn=null,this.modal=yl(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const r=gl(this.modal,e,t);this.detachFn=r.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function we(i){const{id:e,label:t,stateA:r,stateB:n,tooltipTrigger:s,inline:a}=i,o=O(),l=r?m("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:r}):null,d=m("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:n}),c=m("input",{id:e,type:"checkbox",class:"sr-only peer"}),u=m("div",{class:["w-11 h-6 rounded-full peer relative",o.toggleTrackBase,o.toggleTrackChecked,'after:content-[""] after:absolute after:top-[2px] after:left-[2px]',"after:bg-white after:border after:rounded-full","after:h-5 after:w-5 after:transition-all",o.toggleKnobBase,o.toggleKnobChecked,"peer-checked:after:translate-x-full"].join(" ")}),h=()=>{const g=c.checked;l&&(l.style.opacity=g?"0.5":"1"),d.style.opacity=g?"1":"0.5"};c.addEventListener("change",h);const f=[];l&&f.push(l),f.push(m("label",{class:"relative inline-flex items-center cursor-pointer"},c,u)),f.push(d),s&&f.push(s);const y=m("div",{class:"flex items-center gap-3"},...f),b=a?y:m("div",{class:"mb-6"},t?m("label",{class:`block text-sm font-medium mb-2 ${o.textColor}`,textContent:t}):null,y);return requestAnimationFrame(h),{element:b,input:c,setChecked:g=>{c.checked=g,h()},getChecked:()=>c.checked,update:h}}function Y(i,e){const t=O();if(typeof i=="string")return m("label",{class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},i,e??null);const{text:r,for:n,trailingElement:s}=i;return m("label",{...n?{htmlFor:n}:{},class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},r,s??null)}function bl(){const i=O(),e=me({text:"Select Instrument",size:"xl",additionalClasses:"text-center mb-6 z-10"}),t=(h,f)=>{const y=m("select",{id:h,class:["w-full bg-gray-700 border border-gray-600 rounded px-3 py-2","focus:outline-none focus:border-purple-500 cursor-pointer",i.textColor].join(" ")});return m("div",{class:"mb-4 z-10 w-full"},Y({text:f,for:h}),y)},r=t("instrument-engine-select","Engine"),n=t("instrument-library-select","Instrument Library"),s=t("instrument-select","Instrument"),a=we({id:"instrument-loop-toggle",label:"Loop instrument sound",stateB:"On"}),o=U({id:"instrument-select-confirm",text:"Select",kind:"primary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),l=U({id:"instrument-cancel-btn",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),d=m("div",{class:"flex gap-3 z-10 w-full"},o,l),c=[e,r,n,s,a.element,d];return te("instrument-select-modal",c,{sizePreset:"md"})}function vl(i,e){const t=structuredClone(i),r=t.sequencers.find(n=>n.id===e.sequencerId);return r&&e.instrument&&(r.instrument=e.instrument),t}function Sl(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}function Cl(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}async function Nl(i,e){if(e!=null){const t=lt(e);t?(I(Sl(t.id,i),Cl(t.id,t.instrumentName)),t.setInstrument(i)):console.warn(`Failed to find sequencer with ID ${e}`)}else try{await gi(i),ua(i),window.dispatchEvent(new CustomEvent("global-instrument-selected",{detail:{fullName:i}}))}catch(t){console.error("Failed to load global instrument:",i,t)}}function wl(){return Object.keys(it)}async function Ml(i=rr){const e=bi[i];if(!e)throw new Error(`Engine "${i}" not available`);return await e.getAvailableLibraries()}async function xl(i,e=rr){const t=bi[e];if(!t)throw new Error(`Engine "${e}" not available`);return await t.getAvailableInstruments(i)}function Ll(i,e){const t=i.querySelector("#instrument-engine-select"),r=i.querySelector("#instrument-library-select"),n=i.querySelector("#instrument-select"),s=i.querySelector("#instrument-loop-toggle"),a=i.querySelector("#instrument-select-confirm"),o=i.querySelector("#instrument-cancel-btn"),{currentInstrument:l}=e;let d=null,c=null,u=null;if(l){const S=l.split("/");d=S[0]||null,c=S[1]||null,u=S[2]||null}const h=()=>{const S=wl();t&&(t.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,t.appendChild(C)}),d&&S.includes(d)&&(t.value=d))},f=async()=>{if(!t)return;const S=await Ml(t.value);r&&(r.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,r.appendChild(C)}),c&&S.includes(c)?r.value=c:S.length>0&&(r.value=S[0]))},y=async()=>{if(!t||!r)return;const S=await xl(r.value,t.value);n&&(n.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,n.appendChild(C)}),u&&S.includes(u)&&(n.value=u))},b=async()=>{await f(),await y()},g=()=>{y()},p=async()=>{if(!t||!r||!n||!s)return;const S=`${t.value}/${r.value}/${n.value}`;await Nl(S,e.sequencerId),e.hide()},v=()=>{e.hide()};return(async()=>(h(),await f(),await y()))(),t==null||t.addEventListener("change",b),r==null||r.addEventListener("change",g),a==null||a.addEventListener("click",p),o==null||o.addEventListener("click",v),{detach:()=>{t==null||t.removeEventListener("change",b),r==null||r.removeEventListener("change",g),a==null||a.removeEventListener("click",p),o==null||o.removeEventListener("click",v)},refreshUI:async()=>{h(),await f(),await y()}}}class kl{constructor(){this.detachFn=null,this.modal=bl(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const r=Ll(this.modal,{sequencerId:e,currentInstrument:t,hide:()=>this.hide()});this.detachFn=r.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class Gl{constructor(){this.initialize()}initialize(){this.deleteConfirmModal=new _l,this.instrumentSelectModal=new kl}showInstrumentSelectModal(e,t){this.instrumentSelectModal.show(e,t)}showDeleteConfirmModal(e,t){this.deleteConfirmModal.show(e,t)}destroy(){var e,t;(e=this.deleteConfirmModal)==null||e.destroy(),(t=this.instrumentSelectModal)==null||t.destroy()}reload(){this.destroy(),this.initialize()}}let zt=null;function Bt(){return zt||(zt=new Gl),zt}function Bl(i,e){const t=()=>{Bt().showInstrumentSelectModal(e.id,e.instrumentName)};return i.addEventListener("click",t),{detach:()=>{i.removeEventListener("click",t)},refreshUI:()=>{}}}function El(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),t}var ve={},ht={},Jt,zi;function Al(){if(zi)return Jt;zi=1;function i(n){var s=new r(n),a=s.readChunk();if(a.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var o=e(a.data),l=[],d=0;!s.eof()&&d<o.numTracks;d++){var c=s.readChunk();if(c.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var u=t(c.data);l.push(u)}return{header:o,tracks:l}}function e(n){var s=new r(n),a=s.readUInt16(),o=s.readUInt16(),l={format:a,numTracks:o},d=s.readUInt16();return d&32768?(l.framesPerSecond=256-(d>>8),l.ticksPerFrame=d&255):l.ticksPerBeat=d,l}function t(n){for(var s=new r(n),a=[];!s.eof();){var o=d();a.push(o)}return a;var l;function d(){var c={};c.deltaTime=s.readVarInt();var u=s.readUInt8();if((u&240)===240)if(u===255){c.meta=!0;var h=s.readUInt8(),f=s.readVarInt();switch(h){case 0:if(c.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return c.number=s.readUInt16(),c;case 1:return c.type="text",c.text=s.readString(f),c;case 2:return c.type="copyrightNotice",c.text=s.readString(f),c;case 3:return c.type="trackName",c.text=s.readString(f),c;case 4:return c.type="instrumentName",c.text=s.readString(f),c;case 5:return c.type="lyrics",c.text=s.readString(f),c;case 6:return c.type="marker",c.text=s.readString(f),c;case 7:return c.type="cuePoint",c.text=s.readString(f),c;case 32:if(c.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return c.channel=s.readUInt8(),c;case 33:if(c.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return c.port=s.readUInt8(),c;case 47:if(c.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return c;case 81:if(c.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return c.microsecondsPerBeat=s.readUInt24(),c;case 84:if(c.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var y=s.readUInt8(),b={0:24,32:25,64:29,96:30};return c.frameRate=b[y&96],c.hour=y&31,c.min=s.readUInt8(),c.sec=s.readUInt8(),c.frame=s.readUInt8(),c.subFrame=s.readUInt8(),c;case 88:if(c.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return c.numerator=s.readUInt8(),c.denominator=1<<s.readUInt8(),f===4?(c.metronome=s.readUInt8(),c.thirtyseconds=s.readUInt8()):(c.metronome=36,c.thirtyseconds=8),c;case 89:if(c.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return c.key=s.readInt8(),c.scale=s.readUInt8(),c;case 127:return c.type="sequencerSpecific",c.data=s.readBytes(f),c;default:return c.type="unknownMeta",c.data=s.readBytes(f),c.metatypeByte=h,c}}else if(u==240){c.type="sysEx";var f=s.readVarInt();return c.data=s.readBytes(f),c}else if(u==247){c.type="endSysEx";var f=s.readVarInt();return c.data=s.readBytes(f),c}else throw"Unrecognised MIDI event type byte: "+u;else{var g;if((u&128)===0){if(l===null)throw"Running status byte encountered before status byte";g=u,u=l,c.running=!0}else g=s.readUInt8(),l=u;var p=u>>4;switch(c.channel=u&15,p){case 8:return c.type="noteOff",c.noteNumber=g,c.velocity=s.readUInt8(),c;case 9:var v=s.readUInt8();return c.type=v===0?"noteOff":"noteOn",c.noteNumber=g,c.velocity=v,v===0&&(c.byte9=!0),c;case 10:return c.type="noteAftertouch",c.noteNumber=g,c.amount=s.readUInt8(),c;case 11:return c.type="controller",c.controllerType=g,c.value=s.readUInt8(),c;case 12:return c.type="programChange",c.programNumber=g,c;case 13:return c.type="channelAftertouch",c.amount=g,c;case 14:return c.type="pitchBend",c.value=g+(s.readUInt8()<<7)-8192,c;default:throw"Unrecognised MIDI event type: "+p}}}}function r(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return r.prototype.eof=function(){return this.pos>=this.bufferLen},r.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},r.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},r.prototype.readUInt16=function(){var n=this.readUInt8(),s=this.readUInt8();return(n<<8)+s},r.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},r.prototype.readUInt24=function(){var n=this.readUInt8(),s=this.readUInt8(),a=this.readUInt8();return(n<<16)+(s<<8)+a},r.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},r.prototype.readUInt32=function(){var n=this.readUInt8(),s=this.readUInt8(),a=this.readUInt8(),o=this.readUInt8();return(n<<24)+(s<<16)+(a<<8)+o},r.prototype.readBytes=function(n){var s=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,s},r.prototype.readString=function(n){var s=this.readBytes(n);return String.fromCharCode.apply(null,s)},r.prototype.readVarInt=function(){for(var n=0;!this.eof();){var s=this.readUInt8();if(s&128)n+=s&127,n<<=7;else return n+s}return n},r.prototype.readChunk=function(){var n=this.readString(4),s=this.readUInt32(),a=this.readBytes(s);return{id:n,length:s,data:a}},Jt=i,Jt}var Wt,Ji;function Tl(){if(Ji)return Wt;Ji=1;function i(s,a){if(typeof s!="object")throw"Invalid MIDI data";a=a||{};var o=s.header||{},l=s.tracks||[],d,c=l.length,u=new n;for(e(u,o,c),d=0;d<c;d++)t(u,l[d],a);return u.buffer}function e(s,a,o){var l=a.format==null?1:a.format,d=128;a.timeDivision?d=a.timeDivision:a.ticksPerFrame&&a.framesPerSecond?d=-(a.framesPerSecond&255)<<8|a.ticksPerFrame&255:a.ticksPerBeat&&(d=a.ticksPerBeat&32767);var c=new n;c.writeUInt16(l),c.writeUInt16(o),c.writeUInt16(d),s.writeChunk("MThd",c.buffer)}function t(s,a,o){var l=new n,d,c=a.length,u=null;for(d=0;d<c;d++)(o.running===!1||!o.running&&!a[d].running)&&(u=null),u=r(l,a[d],u,o.useByte9ForNoteOff);s.writeChunk("MTrk",l.buffer)}function r(s,a,o,l){var d=a.type,c=a.deltaTime,u=a.text||"",h=a.data||[],f=null;switch(s.writeVarInt(c),d){case"sequenceNumber":s.writeUInt8(255),s.writeUInt8(0),s.writeVarInt(2),s.writeUInt16(a.number);break;case"text":s.writeUInt8(255),s.writeUInt8(1),s.writeVarInt(u.length),s.writeString(u);break;case"copyrightNotice":s.writeUInt8(255),s.writeUInt8(2),s.writeVarInt(u.length),s.writeString(u);break;case"trackName":s.writeUInt8(255),s.writeUInt8(3),s.writeVarInt(u.length),s.writeString(u);break;case"instrumentName":s.writeUInt8(255),s.writeUInt8(4),s.writeVarInt(u.length),s.writeString(u);break;case"lyrics":s.writeUInt8(255),s.writeUInt8(5),s.writeVarInt(u.length),s.writeString(u);break;case"marker":s.writeUInt8(255),s.writeUInt8(6),s.writeVarInt(u.length),s.writeString(u);break;case"cuePoint":s.writeUInt8(255),s.writeUInt8(7),s.writeVarInt(u.length),s.writeString(u);break;case"channelPrefix":s.writeUInt8(255),s.writeUInt8(32),s.writeVarInt(1),s.writeUInt8(a.channel);break;case"portPrefix":s.writeUInt8(255),s.writeUInt8(33),s.writeVarInt(1),s.writeUInt8(a.port);break;case"endOfTrack":s.writeUInt8(255),s.writeUInt8(47),s.writeVarInt(0);break;case"setTempo":s.writeUInt8(255),s.writeUInt8(81),s.writeVarInt(3),s.writeUInt24(a.microsecondsPerBeat);break;case"smpteOffset":s.writeUInt8(255),s.writeUInt8(84),s.writeVarInt(5);var y={24:0,25:32,29:64,30:96},b=a.hour&31|y[a.frameRate];s.writeUInt8(b),s.writeUInt8(a.min),s.writeUInt8(a.sec),s.writeUInt8(a.frame),s.writeUInt8(a.subFrame);break;case"timeSignature":s.writeUInt8(255),s.writeUInt8(88),s.writeVarInt(4),s.writeUInt8(a.numerator);var g=Math.floor(Math.log(a.denominator)/Math.LN2)&255;s.writeUInt8(g),s.writeUInt8(a.metronome),s.writeUInt8(a.thirtyseconds||8);break;case"keySignature":s.writeUInt8(255),s.writeUInt8(89),s.writeVarInt(2),s.writeInt8(a.key),s.writeUInt8(a.scale);break;case"sequencerSpecific":s.writeUInt8(255),s.writeUInt8(127),s.writeVarInt(h.length),s.writeBytes(h);break;case"unknownMeta":a.metatypeByte!=null&&(s.writeUInt8(255),s.writeUInt8(a.metatypeByte),s.writeVarInt(h.length),s.writeBytes(h));break;case"sysEx":s.writeUInt8(240),s.writeVarInt(h.length),s.writeBytes(h);break;case"endSysEx":s.writeUInt8(247),s.writeVarInt(h.length),s.writeBytes(h);break;case"noteOff":var p=l!==!1&&a.byte9||l&&a.velocity==0?144:128;f=p|a.channel,f!==o&&s.writeUInt8(f),s.writeUInt8(a.noteNumber),s.writeUInt8(a.velocity);break;case"noteOn":f=144|a.channel,f!==o&&s.writeUInt8(f),s.writeUInt8(a.noteNumber),s.writeUInt8(a.velocity);break;case"noteAftertouch":f=160|a.channel,f!==o&&s.writeUInt8(f),s.writeUInt8(a.noteNumber),s.writeUInt8(a.amount);break;case"controller":f=176|a.channel,f!==o&&s.writeUInt8(f),s.writeUInt8(a.controllerType),s.writeUInt8(a.value);break;case"programChange":f=192|a.channel,f!==o&&s.writeUInt8(f),s.writeUInt8(a.programNumber);break;case"channelAftertouch":f=208|a.channel,f!==o&&s.writeUInt8(f),s.writeUInt8(a.amount);break;case"pitchBend":f=224|a.channel,f!==o&&s.writeUInt8(f);var v=8192+a.value,S=v&127,_=v>>7&127;s.writeUInt8(S),s.writeUInt8(_);break;default:throw"Unrecognized event type: "+d}return f}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(s){this.buffer.push(s&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(s){var a=s>>8&255,o=s&255;this.writeUInt8(a),this.writeUInt8(o)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(s){var a=s>>16&255,o=s>>8&255,l=s&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(l)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(s){var a=s>>24&255,o=s>>16&255,l=s>>8&255,d=s&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(l),this.writeUInt8(d)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(s){this.buffer=this.buffer.concat(Array.prototype.slice.call(s,0))},n.prototype.writeString=function(s){var a,o=s.length,l=[];for(a=0;a<o;a++)l.push(s.codePointAt(a));this.writeBytes(l)},n.prototype.writeVarInt=function(s){if(s<0)throw"Cannot write negative variable-length integer";if(s<=127)this.writeUInt8(s);else{var a=s,o=[];for(o.push(a&127),a>>=7;a;){var l=a&127|128;o.push(l),a>>=7}this.writeBytes(o.reverse())}},n.prototype.writeChunk=function(s,a){this.writeString(s),this.writeUInt32(a.length),this.writeBytes(a)},Wt=i,Wt}var Wi;function pr(){return Wi||(Wi=1,ht.parseMidi=Al(),ht.writeMidi=Tl()),ht}var jt={},Se={},ji;function mr(){if(ji)return Se;ji=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.insert=Se.search=void 0;function i(t,r,n){n===void 0&&(n="ticks");var s=0,a=t.length,o=a;if(a>0&&t[a-1][n]<=r)return a-1;for(;s<o;){var l=Math.floor(s+(o-s)/2),d=t[l],c=t[l+1];if(d[n]===r){for(var u=l;u<t.length;u++){var h=t[u];h[n]===r&&(l=u)}return l}else{if(d[n]<r&&c[n]>r)return l;d[n]>r?o=l:d[n]<r&&(s=l+1)}}return-1}Se.search=i;function e(t,r,n){if(n===void 0&&(n="ticks"),t.length){var s=i(t,r[n],n);t.splice(s+1,0,r)}else t.push(r)}return Se.insert=e,Se}var Xi;function oi(){return Xi||(Xi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.keySignatureKeys=void 0;var e=mr(),t=new WeakMap;i.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function n(s){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",t.set(this,480),s){t.set(this,s.header.ticksPerBeat),s.tracks.forEach(function(l){l.forEach(function(d){d.meta&&(d.type==="timeSignature"?a.timeSignatures.push({ticks:d.absoluteTime,timeSignature:[d.numerator,d.denominator]}):d.type==="setTempo"?a.tempos.push({bpm:6e7/d.microsecondsPerBeat,ticks:d.absoluteTime}):d.type==="keySignature"&&a.keySignatures.push({key:i.keySignatureKeys[d.key+7],scale:d.scale===0?"major":"minor",ticks:d.absoluteTime}))})});var o=0;s.tracks[0].forEach(function(l){o+=l.deltaTime,l.meta&&(l.type==="trackName"?a.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&a.meta.push({text:l.text,ticks:o,type:l.type}))}),this.update()}}return n.prototype.update=function(){var s=this,a=0,o=0;this.tempos.sort(function(l,d){return l.ticks-d.ticks}),this.tempos.forEach(function(l,d){var c=d>0?s.tempos[d-1].bpm:s.tempos[0].bpm,u=l.ticks/s.ppq-o,h=60/c*u;l.time=h+a,a=l.time,o+=u}),this.timeSignatures.sort(function(l,d){return l.ticks-d.ticks}),this.timeSignatures.forEach(function(l,d){var c=d>0?s.timeSignatures[d-1]:s.timeSignatures[0],u=(l.ticks-c.ticks)/s.ppq,h=u/c.timeSignature[0]/(c.timeSignature[1]/4);c.measures=c.measures||0,l.measures=h+c.measures})},n.prototype.ticksToSeconds=function(s){var a=(0,e.search)(this.tempos,s);if(a!==-1){var o=this.tempos[a],l=o.time,d=(s-o.ticks)/this.ppq;return l+60/o.bpm*d}else{var c=s/this.ppq;return 60/120*c}},n.prototype.ticksToMeasures=function(s){var a=(0,e.search)(this.timeSignatures,s);if(a!==-1){var o=this.timeSignatures[a],l=(s-o.ticks)/this.ppq;return o.measures+l/(o.timeSignature[0]/o.timeSignature[1])/4}else return s/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(s){var a=(0,e.search)(this.tempos,s,"time");if(a!==-1){var o=this.tempos[a],l=o.time,d=s-l,c=d/(60/o.bpm);return Math.round(o.ticks+c*this.ppq)}else{var u=s/.5;return Math.round(u*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(s){return{bpm:s.bpm,ticks:s.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(s){this.name=s.name,this.tempos=s.tempos.map(function(a){return Object.assign({},a)}),this.timeSignatures=s.timeSignatures.map(function(a){return Object.assign({},a)}),this.keySignatures=s.keySignatures.map(function(a){return Object.assign({},a)}),this.meta=s.meta.map(function(a){return Object.assign({},a)}),t.set(this,s.ppq),this.update()},n.prototype.setTempo=function(s){this.tempos=[{bpm:s,ticks:0}],this.update()},n}();i.Header=r}(jt)),jt}var Pe={},Xt={},Vi;function yr(){return Vi||(Vi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ControlChange=i.controlChangeIds=i.controlChangeNames=void 0,i.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},i.controlChangeIds=Object.keys(i.controlChangeNames).reduce(function(n,s){return n[i.controlChangeNames[s]]=s,n},{});var e=new WeakMap,t=new WeakMap,r=function(){function n(s,a){e.set(this,a),t.set(this,s.controllerType),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(n.prototype,"number",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return i.controlChangeNames[this.number]?i.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var s=e.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var a=e.get(this);this.ticks=a.secondsToTicks(s)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();i.ControlChange=r}(Xt)),Xt}var Ue={},Yi;function Il(){if(Yi)return Ue;Yi=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.createControlChanges=void 0;var i=yr();function e(){return new Proxy({},{get:function(t,r){if(t[r])return t[r];if(i.controlChangeIds.hasOwnProperty(r))return t[i.controlChangeIds[r]]},set:function(t,r,n){return i.controlChangeIds.hasOwnProperty(r)?t[i.controlChangeIds[r]]=n:t[r]=n,!0}})}return Ue.createControlChanges=e,Ue}var De={},Zi;function Rl(){if(Zi)return De;Zi=1,Object.defineProperty(De,"__esModule",{value:!0}),De.PitchBend=void 0;var i=new WeakMap,e=function(){function t(r,n){i.set(this,n),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(t.prototype,"time",{get:function(){var r=i.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var n=i.get(this);this.ticks=n.secondsToTicks(r)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return De.PitchBend=e,De}var qe={},ue={},Qi;function Fl(){return Qi||(Qi=1,Object.defineProperty(ue,"__esModule",{value:!0}),ue.DrumKitByPatchID=ue.InstrumentFamilyByID=ue.instrumentByPatchID=void 0,ue.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],ue.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],ue.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),ue}var es;function Ol(){if(es)return qe;es=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.Instrument=void 0;var i=Fl(),e=new WeakMap,t=function(){function r(n,s){if(this.number=0,e.set(this,s),this.number=0,n){var a=n.find(function(o){return o.type==="programChange"});a&&(this.number=a.programNumber)}}return Object.defineProperty(r.prototype,"name",{get:function(){return this.percussion?i.DrumKitByPatchID[this.number]:i.instrumentByPatchID[this.number]},set:function(n){var s=i.instrumentByPatchID.indexOf(n);s!==-1&&(this.number=s)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"family",{get:function(){return this.percussion?"drums":i.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"percussion",{get:function(){var n=e.get(this);return n.channel===9},enumerable:!1,configurable:!0}),r.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},r.prototype.fromJSON=function(n){this.number=n.number},r}();return qe.Instrument=t,qe}var Ke={},ts;function Pl(){if(ts)return Ke;ts=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.Note=void 0;function i(a){var o=Math.floor(a/12)-1;return e(a)+o.toString()}function e(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=a%12;return o[l]}function t(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(a)}var r=function(){var a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(l){var d=a.exec(l),c=d[1],u=d[2],h=o[c.toLowerCase()];return h+(parseInt(u,10)+1)*12}}(),n=new WeakMap,s=function(){function a(o,l,d){n.set(this,d),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=l.velocity,this.ticks=o.ticks,this.durationTicks=l.ticks-o.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return i(this.midi)},set:function(o){this.midi=r(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var l=o-this.octave;this.midi+=l*12},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(o){this.midi=12*(this.octave+1)+t(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var l=n.get(this),d=l.secondsToTicks(this.time+o);this.durationTicks=d-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var l=n.get(this);this.ticks=l.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){var o=n.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return Ke.Note=s,Ke}var is;function ss(){if(is)return Pe;is=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Track=void 0;var i=mr(),e=yr(),t=Il(),r=Rl(),n=Ol(),s=Pl(),a=new WeakMap,o=function(){function l(d,c){var u=this;if(this.name="",this.notes=[],this.controlChanges=(0,t.createControlChanges)(),this.pitchBends=[],a.set(this,c),d){var h=d.find(function(_){return _.type==="trackName"});this.name=h?h.text:""}if(this.instrument=new n.Instrument(d,this),this.channel=0,d){for(var f=d.filter(function(_){return _.type==="noteOn"}),y=d.filter(function(_){return _.type==="noteOff"}),b=function(){var _=f.shift();g.channel=_.channel;var C=y.findIndex(function(w){return w.noteNumber===_.noteNumber&&w.absoluteTime>=_.absoluteTime});if(C!==-1){var N=y.splice(C,1)[0];g.addNote({durationTicks:N.absoluteTime-_.absoluteTime,midi:_.noteNumber,noteOffVelocity:N.velocity/127,ticks:_.absoluteTime,velocity:_.velocity/127})}},g=this;f.length;)b();var p=d.filter(function(_){return _.type==="controller"});p.forEach(function(_){u.addCC({number:_.controllerType,ticks:_.absoluteTime,value:_.value/127})});var v=d.filter(function(_){return _.type==="pitchBend"});v.forEach(function(_){u.addPitchBend({ticks:_.absoluteTime,value:_.value/Math.pow(2,13)})});var S=d.find(function(_){return _.type==="endOfTrack"});this.endOfTrackTicks=S!==void 0?S.absoluteTime:void 0}}return l.prototype.addNote=function(d){var c=a.get(this),u=new s.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},c);return Object.assign(u,d),(0,i.insert)(this.notes,u,"ticks"),this},l.prototype.addCC=function(d){var c=a.get(this),u=new e.ControlChange({controllerType:d.number},c);return delete d.number,Object.assign(u,d),Array.isArray(this.controlChanges[u.number])||(this.controlChanges[u.number]=[]),(0,i.insert)(this.controlChanges[u.number],u,"ticks"),this},l.prototype.addPitchBend=function(d){var c=a.get(this),u=new r.PitchBend({},c);return Object.assign(u,d),(0,i.insert)(this.pitchBends,u,"ticks"),this},Object.defineProperty(l.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,c=0;c<this.notes.length-1;c++){var u=this.notes[c].time+this.notes[c].duration;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,c=0;c<this.notes.length-1;c++){var u=this.notes[c].ticks+this.notes[c].durationTicks;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),l.prototype.fromJSON=function(d){var c=this;this.name=d.name,this.channel=d.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(d.instrument),d.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=d.endOfTrackTicks);for(var u in d.controlChanges)d.controlChanges[u]&&d.controlChanges[u].forEach(function(h){c.addCC({number:h.number,ticks:h.ticks,value:h.value})});d.notes.forEach(function(h){c.addNote({durationTicks:h.durationTicks,midi:h.midi,ticks:h.ticks,velocity:h.velocity})})},l.prototype.toJSON=function(){for(var d={},c=0;c<127;c++)this.controlChanges.hasOwnProperty(c)&&(d[c]=this.controlChanges[c].map(function(h){return h.toJSON()}));var u={channel:this.channel,controlChanges:d,pitchBends:this.pitchBends.map(function(h){return h.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(h){return h.toJSON()})};return this.endOfTrackTicks!==void 0&&(u.endOfTrackTicks=this.endOfTrackTicks),u},l}();return Pe.Track=o,Pe}var Ce={};function Ul(i){var e=[];return gr(i,e),e}function gr(i,e){for(var t=0;t<i.length;t++){var r=i[t];Array.isArray(r)?gr(r,e):e.push(r)}}const Dl=Object.freeze(Object.defineProperty({__proto__:null,flatten:Ul},Symbol.toStringTag,{value:"Module"})),ql=El(Dl);var rs;function Kl(){if(rs)return Ce;rs=1;var i=Ce&&Ce.__spreadArray||function(p,v,S){if(S||arguments.length===2)for(var _=0,C=v.length,N;_<C;_++)(N||!(_ in v))&&(N||(N=Array.prototype.slice.call(v,0,_)),N[_]=v[_]);return p.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.encode=void 0;var e=pr(),t=oi(),r=ql;function n(p,v){return[{absoluteTime:p.ticks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOn",velocity:Math.floor(p.velocity*127)},{absoluteTime:p.ticks+p.durationTicks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOff",velocity:Math.floor(p.noteOffVelocity*127)}]}function s(p){return(0,r.flatten)(p.notes.map(function(v){return n(v,p.channel)}))}function a(p,v){return{absoluteTime:p.ticks,channel:v,controllerType:p.number,deltaTime:0,type:"controller",value:Math.floor(p.value*127)}}function o(p){for(var v=[],S=0;S<127;S++)p.controlChanges.hasOwnProperty(S)&&p.controlChanges[S].forEach(function(_){v.push(a(_,p.channel))});return v}function l(p,v){return{absoluteTime:p.ticks,channel:v,deltaTime:0,type:"pitchBend",value:p.value}}function d(p){var v=[];return p.pitchBends.forEach(function(S){v.push(l(S,p.channel))}),v}function c(p){return{absoluteTime:0,channel:p.channel,deltaTime:0,programNumber:p.instrument.number,type:"programChange"}}function u(p){return{absoluteTime:0,deltaTime:0,meta:!0,text:p,type:"trackName"}}function h(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/p.bpm),type:"setTempo"}}function f(p){return{absoluteTime:p.ticks,deltaTime:0,denominator:p.timeSignature[1],meta:!0,metronome:24,numerator:p.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function y(p){var v=t.keySignatureKeys.indexOf(p.key);return{absoluteTime:p.ticks,deltaTime:0,key:v+7,meta:!0,scale:p.scale==="major"?0:1,type:"keySignature"}}function b(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,text:p.text,type:p.type}}function g(p){var v={header:{format:1,numTracks:p.tracks.length+1,ticksPerBeat:p.header.ppq},tracks:i([i(i(i(i([{absoluteTime:0,deltaTime:0,meta:!0,text:p.header.name,type:"trackName"}],p.header.keySignatures.map(function(S){return y(S)}),!0),p.header.meta.map(function(S){return b(S)}),!0),p.header.tempos.map(function(S){return h(S)}),!0),p.header.timeSignatures.map(function(S){return f(S)}),!0)],p.tracks.map(function(S){return i(i(i([u(S.name),c(S)],s(S),!0),o(S),!0),d(S),!0)}),!0)};return v.tracks=v.tracks.map(function(S){S=S.sort(function(C,N){return C.absoluteTime-N.absoluteTime});var _=0;return S.forEach(function(C){C.deltaTime=C.absoluteTime-_,_=C.absoluteTime,delete C.absoluteTime}),S.push({deltaTime:0,meta:!0,type:"endOfTrack"}),S}),new Uint8Array((0,e.writeMidi)(v))}return Ce.encode=g,Ce}var ns;function Hl(){return ns||(ns=1,function(i){var e=ve&&ve.__awaiter||function(u,h,f,y){function b(g){return g instanceof f?g:new f(function(p){p(g)})}return new(f||(f=Promise))(function(g,p){function v(C){try{_(y.next(C))}catch(N){p(N)}}function S(C){try{_(y.throw(C))}catch(N){p(N)}}function _(C){C.done?g(C.value):b(C.value).then(v,S)}_((y=y.apply(u,h||[])).next())})},t=ve&&ve.__generator||function(u,h){var f={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},y,b,g,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(_){return function(C){return S([_,C])}}function S(_){if(y)throw new TypeError("Generator is already executing.");for(;f;)try{if(y=1,b&&(g=_[0]&2?b.return:_[0]?b.throw||((g=b.return)&&g.call(b),0):b.next)&&!(g=g.call(b,_[1])).done)return g;switch(b=0,g&&(_=[_[0]&2,g.value]),_[0]){case 0:case 1:g=_;break;case 4:return f.label++,{value:_[1],done:!1};case 5:f.label++,b=_[1],_=[0];continue;case 7:_=f.ops.pop(),f.trys.pop();continue;default:if(g=f.trys,!(g=g.length>0&&g[g.length-1])&&(_[0]===6||_[0]===2)){f=0;continue}if(_[0]===3&&(!g||_[1]>g[0]&&_[1]<g[3])){f.label=_[1];break}if(_[0]===6&&f.label<g[1]){f.label=g[1],g=_;break}if(g&&f.label<g[2]){f.label=g[2],f.ops.push(_);break}g[2]&&f.ops.pop(),f.trys.pop();continue}_=h.call(u,f)}catch(C){_=[6,C],b=0}finally{y=g=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.Track=i.Midi=void 0;var r=pr(),n=oi(),s=ss(),a=Kl(),o=function(){function u(h){var f=this,y=null;if(h){var b=h instanceof ArrayBuffer?new Uint8Array(h):h;y=(0,r.parseMidi)(b),y.tracks.forEach(function(g){var p=0;g.forEach(function(v){p+=v.deltaTime,v.absoluteTime=p})}),y.tracks=c(y.tracks)}this.header=new n.Header(y),this.tracks=[],h&&(this.tracks=y.tracks.map(function(g){return new s.Track(g,f.header)}),y.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return u.fromUrl=function(h){return e(this,void 0,void 0,function(){var f,y;return t(this,function(b){switch(b.label){case 0:return[4,fetch(h)];case 1:return f=b.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return y=b.sent(),[2,new u(y)];case 3:throw new Error("Could not load '".concat(h,"'"))}})})},Object.defineProperty(u.prototype,"name",{get:function(){return this.header.name},set:function(h){this.header.name=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var h=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){var h=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),u.prototype.addTrack=function(){var h=new s.Track(void 0,this.header);return this.tracks.push(h),h},u.prototype.toArray=function(){return(0,a.encode)(this)},u.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(h){return h.toJSON()})}},u.prototype.fromJSON=function(h){var f=this;this.header=new n.Header,this.header.fromJSON(h.header),this.tracks=h.tracks.map(function(y){var b=new s.Track(void 0,f.header);return b.fromJSON(y),b})},u.prototype.clone=function(){var h=new u;return h.fromJSON(this.toJSON()),h},u}();i.Midi=o;var l=ss();Object.defineProperty(i,"Track",{enumerable:!0,get:function(){return l.Track}});var d=oi();Object.defineProperty(i,"Header",{enumerable:!0,get:function(){return d.Header}});function c(u){for(var h=[],f=0;f<u.length;f++)for(var y=h.length,b=new Map,g=Array(16).fill(0),p=0,v=u[f];p<v.length;p++){var S=v[p],_=y,C=S.channel;if(C!==void 0){S.type==="programChange"&&(g[C]=S.programNumber);var N=g[C],w="".concat(N," ").concat(C);b.has(w)?_=b.get(w):(_=y+b.size,b.set(w,_))}h[_]||h.push([]),h[_].push(S)}return h}}(ve)),ve}var wi=Hl();const _r=["acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honkytonk_piano","electric_piano_1","electric_piano_2","harpsichord","clavinet","celesta","glockenspiel","music_box","vibraphone","marimba","xylophone","tubular_bells","dulcimer","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","guitar_harmonics","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass","slap_bass_1","slap_bass_2","synth_bass_1","synth_bass_2","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synth_strings_1","synth_strings_2","choir_aahs","voice_oohs","synth_choir","orchestra_hit","trumpet","trombone","tuba","muted_trumpet","french_horn","brass_section","synth_brass_1","synth_brass_2","soprano_sax","alto_sax","tenor_sax","baritone_sax","oboe","english_horn","bassoon","clarinet","piccolo","flute","recorder","pan_flute","blown_bottle","shakuhachi","whistle","ocarina","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","sitar","banjo","shamisen","koto","kalimba","bagpipe","fiddle","shanai","tinkle_bell","agogo","steel_drums","woodblock","taiko_drum","melodic_tom","synth_drum","reverse_cymbal","guitar_fret_noise","breath_noise","seashore","bird_tweet","telephone_ring","helicopter","applause","gunshot"];function br(i){const e=i.split("/"),r=e[e.length-1].trim().toLowerCase().replace(/\s+/g,"_"),n=_r.findIndex(s=>s===r);return n!==-1?n:(r.includes("drum")||r.includes("drummachine"),0)}async function $l(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=new wi.Midi;e.header.setTempo(i.tempo),e.header.timeSignatures.push({ticks:0,timeSignature:i.timeSignature});for(const[n,s]of i.sequencers.entries()){const a=e.addTrack(),o=s.instrument.toLowerCase().includes("drum");a.channel=o?9:n%16;const l=br(s.instrument);if(a.instrument.number=l,typeof s.volume=="number"&&a.addCC({number:7,time:0,value:Math.max(0,Math.min(1,s.volume))}),typeof s.pan=="number"){const d=(s.pan+1)/2;a.addCC({number:10,time:0,value:Math.max(0,Math.min(1,d))})}for(const d of s.notes){const c=$(d.pitch),u=Math.max(.01,Math.min(1,(d.velocity??100)/127));if(c===null)continue;const h=vt(d.start,i.tempo),f=vt(d.duration,i.tempo);a.addNote({midi:c,time:h,duration:f,velocity:u})}}const t=new Blob([e.toArray()],{type:"audio/midi"});return{url:URL.createObjectURL(t),filename:`session-${Date.now()}.mid`}}function zl(i){if(!i.length)throw new Error("No sequencers to export.");const e=new wi.Midi,t=de(),r=xe();e.header.setTempo(t),e.header.timeSignatures.push({ticks:0,timeSignature:[r,4]});for(const[a,o]of i.entries()){const l=e.addTrack(),d=o.instrumentName.toLowerCase().includes("drum");l.channel=d?9:a%16;const c=br(o.instrumentName);if(l.instrument.number=c,typeof o.volume=="number"&&l.addCC({number:7,time:0,value:Math.max(0,Math.min(1,o.volume))}),typeof o.pan=="number"){const u=(o.pan+1)/2;l.addCC({number:10,time:0,value:Math.max(0,Math.min(1,u))})}for(const u of o.notes){const h=$(u.pitch),f=Math.max(.01,Math.min(1,(u.velocity??100)/127));if(h===null)continue;const y=vt(u.start,t),b=vt(u.duration,t);l.addNote({midi:h,time:y,duration:b,velocity:f})}A(`[ExportMidi] Track ${a} (${o.instrumentName}) added with ${l.notes.length} notes.`)}const n=new Blob([e.toArray()],{type:"audio/midi"}),s=`session-${Date.now()}.mid`;return A(`[ExportMidi] MIDI session file created: ${s}, size: ${n.size} bytes`),{filename:s,blob:n}}function vt(i,e){return 60/e*i}function vr(i,e){const{filename:t,blob:r}=zl(e),n=URL.createObjectURL(r);if(i.dataTransfer){i.dataTransfer.clearData(),i.dataTransfer.setData("DownloadURL",`audio/midi:${t}:${n}`),i.dataTransfer.effectAllowed="copy";const s=document.createElement("div");return s.textContent=t,s.style.padding="10px 16px",s.style.background="#000000",s.style.color="#ffffff",s.style.fontFamily="sans-serif",s.style.fontSize="12px",s.style.border="1px solid #555",s.style.borderRadius="6px",s.style.boxShadow="0 2px 6px rgba(0, 0, 0, 0.5)",s.style.position="absolute",s.style.top="-1000px",s.style.pointerEvents="none",document.body.appendChild(s),i.dataTransfer.setDragImage(s,0,0),A("[ExportMidiDrag] dataTransfer populated with MIDI file via DownloadURL"),()=>{A("[ExportMidiDrag] cleaning up URL and drag image"),setTimeout(()=>{URL.revokeObjectURL(n),A(`[ExportMidiDrag] URL revoked: ${n}`)},100),s.parentNode&&s.parentNode.removeChild(s)}}else return console.warn("Drag event has no dataTransfer"),()=>{}}function Jl(i,e){let t=null;const r=s=>{i.classList.add("dragging"),A(`[ExportMidiDrag] dragstart fired for sequencer ${e.id}`),t=vr(s,[e])},n=()=>{A(`[ExportMidiDrag] dragend for sequencer ${e.id}`),i.classList.remove("dragging"),t&&(t(),t=null)};return i.addEventListener("dragstart",r),i.addEventListener("dragend",n),{detach:()=>{i.removeEventListener("dragstart",r),i.removeEventListener("dragend",n)},refreshUI:()=>{}}}function Wl(i,e){var n;const t=structuredClone(i),r=t.sequencers.find(s=>s.id===e.id);if(r&&typeof e.volume=="number"){r.volume=e.volume;const a=K().find(o=>o.id===e.id);a&&(a.volume=e.volume,(n=a.refreshVolumeUI)==null||n.call(a))}return t}function jl(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function Xl(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function Vl(i,e){const{element:t,fill:r,thumb:n}=i;let s=!1,a=!1,o=!1,l=null;const d=100/127,c=.1;function u(){const p=Math.max(0,Math.min(1,e.volume)),v=t.clientWidth,S=14,_=0,C=v-S,N=p*v,w=Math.max(_,Math.min(C,N-S/2));r.style.width=`${Math.round(p*100)}%`,n.style.left=`${w}px`;const L=Math.round(p/d*100);t.setAttribute("title",`Volume: ${L}%`);const G=p>d;r.classList.toggle("overdrive",G),n.classList.toggle("overdrive",G)}function h(){r.classList.toggle("precise",a),n.classList.toggle("precise",a)}function f(p){const v=t.getBoundingClientRect(),S=p-v.left;let _=Math.max(0,Math.min(1,S/v.width));return!a&&Math.abs(_-d)<c?(_=d,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.volume=_,u(),_}const y=p=>{s=!0,a=p.shiftKey,l=e.volume,h(),f(p.clientX),p.preventDefault()},b=p=>{s&&(a=p.shiftKey,h(),f(p.clientX))},g=p=>{if(!s)return;s=!1;const v=f(p.clientX);l!==null&&v!==l&&I(jl(e.id,v),Xl(e.id,l)),l=null,a=!1,o=!1,h(),u()};return t.addEventListener("mousedown",y),window.addEventListener("mousemove",b),window.addEventListener("mouseup",g),{detach:()=>{t.removeEventListener("mousedown",y),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",g)},refreshUI:u}}function Yl(i,e){var n;const t=structuredClone(i),r=t.sequencers.find(s=>s.id===e.id);if(r&&typeof e.pan=="number"){r.pan=e.pan;const a=K().find(o=>o.id===e.id);a&&(a.pan=e.pan,(n=a.refreshPanUI)==null||n.call(a))}return t}function Zl(i,e){return{type:"SET_PAN",id:i,pan:e}}function Ql(i,e){return{type:"SET_PAN",id:i,pan:e}}function ec(i,e){const{element:t,fill:r,thumb:n}=i;let s=!1,a=!1,o=!1,l=null;function d(){const b=Math.max(-1,Math.min(1,e.pan)),g=(b+1)/2,p=t.clientWidth,v=14,S=0,_=p-v,C=g*p,N=Math.max(S,Math.min(_,C-v/2));r.style.width=`${Math.round(g*100)}%`,n.style.left=`${N}px`;const w=Math.round(b*100);t.setAttribute("title",`Pan: ${w}%`)}function c(){r.classList.toggle("precise",a),n.classList.toggle("precise",a)}function u(b){const g=t.getBoundingClientRect(),p=b-g.left;let S=Math.max(0,Math.min(1,p/g.width))*2-1;const _=0;return!a&&Math.abs(S-_)<.05?(S=_,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.pan=S,d(),S}const h=b=>{s=!0,a=b.shiftKey,l=e.pan,c(),u(b.clientX),b.preventDefault()},f=b=>{s&&(a=b.shiftKey,c(),u(b.clientX))},y=b=>{if(!s)return;s=!1;const g=u(b.clientX);l!==null&&g!==l&&I(Zl(e.id,g),Ql(e.id,l)),l=null,a=!1,o=!1,c(),d()};return t.addEventListener("mousedown",h),window.addEventListener("mousemove",f),window.addEventListener("mouseup",y),{detach:()=>{t.removeEventListener("mousedown",h),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",y)},refreshUI:d}}function tc(i,{onZoomIn:e,onZoomOut:t,onResetZoom:r}){const{zoomInBtn:n,zoomOutBtn:s,zoomResetBtn:a,trailingDivider:o}=i,l=()=>{n.classList.toggle("hidden",!0),s.classList.toggle("hidden",!0),a.classList.toggle("hidden",!0),o.classList.toggle("hidden",!0)};return n.addEventListener("click",e),s.addEventListener("click",t),a.addEventListener("click",r),{detach:()=>{n.removeEventListener("click",e),s.removeEventListener("click",t),a.removeEventListener("click",r)},refreshUI:l}}function ic(i,e,t,r,n){const{muteBtn:s,soloBtn:a,collapseBtn:o,deleteBtn:l}=i,d=()=>{s.classList.toggle("side-button-activated",e.mute),a.classList.toggle("side-button-activated",e.solo)},c=()=>{e.toggleMute(),d()},u=()=>{e.toggleSolo(),d()},h=()=>{r(!n())},f=()=>{Bt().showDeleteConfirmModal(()=>{I(hr(e.id,e.instrumentName,e.notes,e.volume,e.pan),fr(e.id,e.instrumentName,e.notes,e.volume,e.pan)),e.destroy()},()=>{console.log("Delete cancelled")})};return s.addEventListener("click",c),a.addEventListener("click",u),o.addEventListener("click",h),l.addEventListener("click",f),{detach:()=>{s.removeEventListener("click",c),a.removeEventListener("click",u),o.removeEventListener("click",h),l.removeEventListener("click",f)},refreshUI:()=>{d()}}}class sc{constructor(e,t,r){this.id=null,this.zoomUI=null,this._collapsed=!1,this.detachFns=[],this.refreshFns=[],this.id=r??null,this.initializeUI(e,t),this.toggleZoomControls(!0),this.boundReload=this.reload.bind(this)}initializeUI(e,t){const r=ol(),n=ll();this.rootEl=r.element,r.topBarContainer.appendChild(n.element),e.appendChild(this.rootEl);const s=cl(),a=dl(),o=ul(),l=hl(),d=fl();this.collapseBtn=d.collapseBtn,n.leftGroup.appendChild(s.instrumentButton),n.leftGroup.appendChild(s.copyMidiButton),n.leftGroup.appendChild(s.label),n.volumeWrapper.appendChild(a.element),n.panWrapper.appendChild(o.element),n.zoomWrapper.appendChild(l.element),n.rightControlsWrapper.appendChild(d.element);const{seq:c}=nl(this.rootEl,t,this.id);this.body=r,this.zoomUI=l,this.sequencer=c,this.grid=c.matrix;const u=pl(r.gripHandleContainer,r.matrixContainer,this.grid),h=Jl(s.copyMidiButton,this.sequencer),f=Bl(s.instrumentButton,this.sequencer),y=Vl(a,this.sequencer),b=ec(o,this.sequencer),g=tc(l,{onZoomIn:()=>this.grid.zoomIn(),onZoomOut:()=>this.grid.zoomOut(),onResetZoom:()=>this.grid.resetZoom()}),p=ic(d,this.sequencer,r.matrixContainer,v=>this.collapse(v),()=>this.collapsed);this.detachFns=[u.detach,f.detach,h.detach,y.detach,b.detach,g.detach,p.detach],this.refreshFns=[u.refreshUI,f.refreshUI,h.refreshUI,y.refreshUI,b.refreshUI,g.refreshUI,p.refreshUI],bt(this.sequencer,t.collapsed),this.refreshUI()}get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e}collapse(e=!0){return bt(this.sequencer,e,this.collapseBtn),this._collapsed}getMiniContourCanvas(){return this.body.miniContourCanvas}getMatrixContainer(){return this.body.matrixContainer}getElement(){return this.rootEl}refreshUI(){this.refreshFns.forEach(e=>e())}destroy(){this.detachFns.forEach(e=>e()),this.rootEl.remove(),this.sequencer.destroy(),Xa(this.sequencer.id),fe.getInstance().unregisterReloadable(this.boundReload)}reload(){if(this.id===null||this.id===void 0){console.error("[SequencerController] Cannot reload without a valid ID.");return}const e={id:this.sequencer.id,instrument:this.sequencer.instrumentName,notes:structuredClone(this.sequencer.notes),volume:this.sequencer.volume,pan:this.sequencer.pan,collapsed:this._collapsed};this.detachFns.forEach(r=>r()),this.rootEl.remove(),this.sequencer.destroy();const t=document.getElementById("sequencers-container");if(!t){console.error("[SequencerController] Cannot reload - parent container missing.");return}this.initializeUI(t,e)}toggleZoomControls(e){if(!this.zoomUI)return;const{leadingDivider:t,zoomInBtn:r,zoomOutBtn:n,zoomResetBtn:s,trailingDivider:a}=this.zoomUI;t.classList.toggle("hidden",!e),r.classList.toggle("hidden",!e),n.classList.toggle("hidden",!e),s.classList.toggle("hidden",!e),a.classList.toggle("hidden",!e)}toggleGripHandle(e){const t=this.body.gripHandleContainer;t==null||t.classList.toggle("hidden",!e)}}function Sr(i,e){const t=e.id,r=new sc(i,e,t);return ja(t,r),fe.getInstance().registerReloadable(r.boundReload),r}function rc(i,e){const t=structuredClone(i);if(t.sequencers.push({id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed}),!lt(e.id)){const n={id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed},s=document.getElementById("sequencers-container");if(!s)return console.error("Sequencer container not found!"),t;Sr(s,n)}return t}function Cr(i,e,t,r,n){return{type:"CREATE_SEQUENCER",id:i,instrument:e,volume:t,pan:r,collapsed:n}}function Mi(i){return{type:"DELETE_SEQUENCER",id:i}}function nc(i,e){const t=structuredClone(i),r=t.sequencers.find(s=>s.id===e.sequencerId);if(!r)return i;const n=new Set(e.notes.map(s=>`${s.pitch}|${s.start}|${s.duration}`));return r.notes=r.notes.filter(s=>{const a=`${s.pitch}|${s.start}|${s.duration}`;return!n.has(a)}),_e(e.sequencerId),t}function ac(i,e){const t=structuredClone(i),r=t.sequencers.find(n=>n.id===e.sequencerId);return r?(r.notes.push(...e.notes),_e(e.sequencerId),t):i}function oc(i,e){const t=structuredClone(i),r=t.sequencers.find(s=>s.id===e.sequencerId);if(!r)return i;const n=e.notes;for(const s of n){const a=r.notes.find(o=>o.pitch===s.pitch&&o.start===s.start&&o.duration===s.duration);a&&(a.velocity=s.velocity)}return _e(e.sequencerId),t}function lc(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function cc(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function dc(i,e){return structuredClone(i)}function xi(i=""){return{type:"CHECKPOINT",label:i}}function Nr(i=""){return xi(i)}const uc=Object.freeze(Object.defineProperty({__proto__:null,CHANGE_NOTE_DURATION:qa,CHANGE_SNAP_RESOLUTION:Ua,CHANGE_SONG_KEY:Oa,CHANGE_TEMPO:_a,CHECKPOINT:dc,CREATE_SEQUENCER:rc,CUT_NOTES:nc,DELETE_NOTES:Mo,DELETE_SEQUENCER:rl,MOVE_NOTES:Ao,PASTE_NOTES:ac,PLACE_NOTES:wo,RESIZE_NOTES:Ro,SET_INSTRUMENT:vl,SET_NOTE_MODIFIER_MODE:Ha,SET_NOTE_VELOCITY:oc,SET_PAN:Yl,SET_TIME_SIGNATURE:va,SET_TOTAL_MEASURES:Ca,SET_VOLUME:Wl},Symbol.toStringTag,{value:"Module"}));function Li(i){const e=uc[i.type];if(!e)throw new Error(`Unknown diff type: ${i.type}`);const t=e(D(),i);yc(t)}const li=new Set;function Et(i){return li.add(i),()=>li.delete(i)}function At(i){for(const e of li)e(i)}const ye=[];let pe=-1;const hc=100;function fc({forwardDiff:i,reverseDiff:e}){ye.splice(pe+1),ye.push({forwardDiff:i,reverseDiff:e}),pe=ye.length-1,ye.length>hc&&(ye.shift(),pe--)}function pc(){var i;if(pe<0)return null;for(let e=pe;e>=0;e--){const t=ye[e];if(((i=t==null?void 0:t.forwardDiff)==null?void 0:i.type)==="CHECKPOINT")return null;if(t!=null&&t.reverseDiff)return pe=e-1,Li(t.reverseDiff),At(D()),t.reverseDiff}return null}function mc(){if(pe>=ye.length-1)return null;pe++;const i=ye[pe];return!i||!i.forwardDiff?null:(Li(i.forwardDiff),At(D()),i.forwardDiff)}let St={tempo:120,timeSignature:[4,4],totalMeasures:8,sequencers:[],songKey:"CM",snapResolution:1,noteDuration:1,isTripletMode:!1,isDottedMode:!1};function D(){return St}function yc(i){St=structuredClone(i),At(St)}function I(i,e){Li(i),fc({forwardDiff:i,reverseDiff:e}),At(St)}let wr=500,Mr=!1;function ce(){return D().totalMeasures*D().timeSignature[0]}function de(){return 60/(wr/1e3)}function ki(i,e=!0){const t=de();if(e){I(Os(i),ba(t));return}const r=H.getInstance();performance.now(),r.getCurrentBeat(),wr=60/i*1e3,r.isActive()&&r.syncAfterTempoChange(t)}function Gi(i,e=!0){const t=D().timeSignature[0];if(e){I(Ps(i),Sa(t));return}K().forEach(r=>r.updateBeatsPerMeasure())}function Bi(i,e=!0){const t=D().totalMeasures;if(e){I(Us(i),Na(t));return}}function xr(i,e=!0){const t=D().songKey;e&&I(er(i),Pa(t))}function Tt(){return Qs()?D().snapResolution:.001}function as(i,e=!0){const t=Tt();if(e){I(tr(i),Da(t));return}}function gc(i,e=!0){const t=D().noteDuration;if(e){I(ir(i),Ka(t));return}}function os(i,e,t=!0){const r=D(),n=r.isTripletMode,s=r.isDottedMode;if(t){I(sr(i,e),$a(n,s));return}}function ci(){return D().isTripletMode}function ls(){return D().isDottedMode}function _c(){return D().noteDuration}function xe(){return D().timeSignature[0]}function Ei(){return D().totalMeasures}function Ai(){return D().songKey}function bc(i){Mr=i}function vc(){return Mr}let ft=null;function Sc(){return H.getInstance()}class H{constructor(e){this.startTime=0,this.startBeat=0,this.isPlaying=!1,this.animationFrameId=null,this.onResumeCallback=null,this.onStopCallback=null,this.tick=()=>{var n;if(!this.isPlaying)return;const t=this.getCurrentBeat(),r=ce();if(t>=r)if(vc())this.seek(0),this.start();else{this.stop(),(n=this.onStopCallback)==null||n.call(this);return}this.animationFrameId=requestAnimationFrame(this.tick)},this.context=X(),this.sequencers=e}static initialize(e){if(ft){console.warn("[PlaybackEngine] Instance already exists. Ignoring re-initialization.");return}ft=new H(e)}static getInstance(){if(!ft)throw new Error("[PlaybackEngine] Instance not initialized. Call initialize() first.");return ft}setOnResumeCallback(e){this.onResumeCallback=e}setOnStopCallback(e){this.onStopCallback=e}getCurrentBeat(){if(!this.isPlaying)return this.startBeat;const e=60/de();return(this.context.currentTime-this.startTime)/e+this.startBeat}async start(){const e=this.context.currentTime+.1;this.startTime=e,this.startBeat=0,this.isPlaying=!0,await this.scheduleAll(e,this.startBeat),this.context.state==="suspended"&&await this.context.resume(),this.animationFrameId=requestAnimationFrame(this.tick)}async pause(){if(!this.isPlaying)return;const e=this.getCurrentBeat();for(const t of this.sequencers)t.stopScheduledNotes();await this.context.suspend(),this.startBeat=e,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}async resume(){var r;if(this.isPlaying)return;await this.context.resume();const t=this.context.currentTime+.05;this.startTime=t,await this.scheduleAll(t,this.startBeat),this.isPlaying=!0,(r=this.onResumeCallback)==null||r.call(this),this.animationFrameId=requestAnimationFrame(this.tick)}stop(){for(const e of this.sequencers)e.stopScheduledNotes();this.isPlaying=!1,this.startBeat=0,this.startTime=0,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}seek(e){this.startBeat=e,this.startTime=this.context.currentTime;const t=this.isPlaying;if(this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t){const r=this.context.currentTime+.05;this.startTime=r,this.scheduleAll(r,this.startBeat).then(()=>{this.animationFrameId=requestAnimationFrame(this.tick)}),this.context.state==="suspended"&&this.context.resume(),this.isPlaying=!0}else this.isPlaying=!1}syncAfterTempoChange(e){const t=this.context.currentTime,r=60/e,n=(t-this.startTime)/r+this.startBeat;this.startBeat=n,this.startTime=t}setSequencers(e){this.sequencers=e}addSequencer(e){this.sequencers.includes(e)||this.sequencers.push(e)}removeSequencer(e){this.sequencers=this.sequencers.filter(t=>t!==e)}clearSequencers(){this.stop(),this.sequencers=[]}isActive(){return this.isPlaying}getStartTime(){return this.startTime}getStartBeat(){return this.startBeat}async scheduleAll(e,t){for(const r of this.sequencers)r.shouldPlay?await r.preparePlayback(e,t):r.stopScheduledNotes()}}const ot=new Map;let Lr=null;function Cc(i,e){ot.set(i,e)}function Nc(i){ot.delete(i)}function lt(i){return ot.get(i)}function K(){return Array.from(ot.values())}function kr(){return Lr}function _e(i){Ci(),Lr=i}function wc(){ot.clear()}function Mc(){return K().some(i=>i.solo)}function cs(){const i=H.getInstance();if(!i.isActive())return;const e=i.getStartTime(),t=i.getStartBeat();for(const r of K())r.stopScheduledNotes(),r.shouldPlay&&(r.reschedulePlayback(e,t),r.resumeAnimationsFromCurrentTime(e,t))}function Gr(){return K()}function xc(){A("Sequencer Dump",Gr())}const Lc=Object.freeze(Object.defineProperty({__proto__:null,dumpSequencers:xc,getSequencers:Gr},Symbol.toStringTag,{value:"Module"}));function Br(){return D()}function kc(){A("App State Dump",Br())}const Gc=Object.freeze(Object.defineProperty({__proto__:null,dumpState:kc,getAppState:Br},Symbol.toStringTag,{value:"Module"}));function Bc(){return structuredClone(z())}function Ec(i,e){const t=i.split(".");if(t.length===0){console.warn("Invalid path provided to setUserConfigProperty.");return}let r={},n=r;for(let a=0;a<t.length-1;a++){const o=t[a];n[o]={},n=n[o]}const s=t[t.length-1];n[s]=e,le(r),A(`[UserConfig] Set ${i} =`,e)}function Ac(i){const e=i.split(".");let t=z();for(const r of e)if(t&&typeof t=="object"&&r in t)t=t[r];else{console.warn(`getUserConfigProperty: Path "${i}" not found.`);return}return t}const Tc=Object.freeze(Object.defineProperty({__proto__:null,getUserConfigProperty:Ac,getUserConfigSnapshot:Bc,setUserConfigProperty:Ec},Symbol.toStringTag,{value:"Module"}));function Ic(){const i=Object.create(null);return Object.assign(i,Lc,Gc,Tc),i}const Rc="SEQUENZIA_DEV";function Fc(){if(typeof window>"u")return;localStorage.getItem(Rc)==="true"&&!Ft()&&(Ri(),console.info("[SEQUENZIA] Dev mode re-enabled from localStorage")),window.toggleDevMode=()=>{const e=!Ft();e?Ri():tn(),console.info(`[SEQUENZIA] Dev mode ${e?"enabled":"disabled"}`),e?ds():delete window.DEVTOOLS},Ft()&&ds()}function ds(){window.DEVTOOLS=Ic()}function Oc(){window.addEventListener("contextmenu",i=>i.preventDefault()),window.addEventListener("dragstart",i=>{const e=i.target;e.closest(".copy-midi-btn")||e.closest(".drag-midi-btn")||i.preventDefault()}),window.addEventListener("selectstart",i=>i.preventDefault()),window.addEventListener("drop",i=>i.preventDefault()),window.addEventListener("dragover",i=>i.preventDefault()),window.addEventListener("keydown",i=>{const e=[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Home","End","PageUp","PageDown"],t=i.metaKey,r=i.ctrlKey;(e.includes(i.key)||(t||r)&&["s","p"].includes(i.key.toLowerCase()))&&i.preventDefault()})}function Er(i,e){const t=i.getContext("2d");if(!t)return;const r=window.devicePixelRatio||1,n=i.width/r,s=i.height/r;t.clearRect(0,0,n,s);const a=ce();for(const o of e){const{notes:l,config:d}=o;if(!(l!=null&&l.length))continue;const c=Re[e.indexOf(o)%Re.length];t.fillStyle=c;const u=$(d.noteRange[0]),h=$(d.noteRange[1]);if(u==null||h==null)continue;const f=h-u||1,y=Math.max(2,s/f);for(const b of l){const g=$(b.pitch);if(g==null)continue;const p=b.start/a*n,v=Math.max(1,b.duration/a*n),S=(g-u)/f,_=s-S*s-y/2;t.fillRect(p,_,v,y)}}}function Pc(i,e){Er(i,e)}function Ar(){const i=document.getElementById("global-mini-contour");if(!i)return;const e=K();Er(i,e)}function Uc(i,e,t,r=!0){const n=i.getInteractionStore();let s=new Set;if(r){const o=n.getSelectedNotes();s=new Set(o.map(l=>`${l.pitch}:${l.start}:${l.duration}:${l.velocity}`))}if(i.setNotes(structuredClone(e)),i.getNoteManager().rebuildIndex(),r&&s.size>0){const o=i.notes.filter(l=>s.has(`${l.pitch}:${l.start}:${l.duration}:${l.velocity}`));n.setSelectedNotes(o)}const a=H.getInstance();if(a!=null&&a.isActive()){const o=a.getStartTime(),l=a.getStartBeat();t.reschedulePlayback(o,l)}i.requestRedraw()}function Dc(i,e){return i!==void 0&&e!==void 0&&i===e}function qc(i=D()){var n;ki(i.tempo,!1),Gi(i.timeSignature[0],!1),Bi(i.totalMeasures,!1);const e=K();for(const s of e)s.updateTotalMeasures();const t=document.getElementById("sequencers-container");if(!t){console.error("resyncFromState: Missing #sequencers-container");return}console.log("State.sequencers length is: ",i.sequencers.length);for(const s of i.sequencers){const a=e.find(o=>Dc(o.id,s.id));if(console.log("Live sequencer ID: and serialized ID: ",a==null?void 0:a.id,s.id),a){a.instrumentName=s.instrument,typeof s.volume=="number"&&(a.volume=s.volume),typeof s.pan=="number"&&(a.pan=s.pan);const o=(n=a.container)==null?void 0:n.querySelector("canvas.mini-contour");o&&xt(o,s.notes,a.config,a.colorIndex),a.matrix&&Uc(a.matrix,s.notes,a,!0)}else{const o={id:s.id,instrument:s.instrument,notes:structuredClone(s.notes),volume:s.volume,pan:s.pan,collapsed:s.collapsed};console.log("No sequencer found, creating one with ID: ",s.id),Sr(t,o)}}document.getElementById("global-mini-contour")&&Ar()}const Tr="userConfig";function Kc(){const i=z();Nt(Tr,i)}function Hc(){const i=st(Tr);i&&le(i)}function $c(i,e=[],t="w-[1276px]"){const r=i.id||"bottom-drawer",n=i.ariaLabel||"Bottom drawer",s=i.edgeOffsetClass||"bottom-[60px]",a=i.drawerClassOverride||"",o=t.toString(),l=O(),d=m("div",{id:r,class:["fixed bottom-0 left-1/2 translate-x-[-50%] z-40",o,"overflow-y-auto","rounded-t-lg",l.menuBackground,l.textColor,"transition-transform","translate-y-0","border-t border-gray-200 dark:border-gray-700 pb-[20px]",s,a].join(" "),"aria-labelledby":`${r}-label`,"data-drawer-placement":"bottom","data-drawer-edge":"true","data-drawer-edge-offset":s}),c=m("div",{class:[i.toggleHandleHeightClass,"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"].join(" ")},m("span",{class:"absolute w-8 h-1 -translate-x-1/2 bg-gray-300 rounded-lg top-3 left-1/2 dark:bg-gray-600"}),m("h5",{id:`${r}-label`,class:"inline-flex items-center text-base text-gray-500 dark:text-gray-400 font-medium"},n));d.appendChild(c),e.forEach(h=>d.appendChild(h));const u=new Yr(d,{placement:"bottom",edge:!0,edgeOffset:s,backdrop:!1,bodyScrolling:!0},{id:r,override:!0});return u.show(),c.addEventListener("click",()=>{u.toggle()}),d}const zc="w-[1260px]",Vt=1100,Jc=[{value:"4",label:"𝅝",title:"Whole"},{value:"2",label:"𝅗𝅥",title:"Half"},{value:"1",label:"𝅘𝅥",title:"Quarter"},{value:"0.5",label:"♪",title:"Eighth"},{value:"0.25",label:"♬",title:"Sixteenth"},{value:"0.125",label:"𝅘𝅥𝅰",title:"32nd"}];class Wc{constructor(){this.globalPlayheadRow=m("div",{id:"global-playhead-row",class:"w-full mb-2"}),this.globalToolsRow=m("div",{id:"global-tools-row",class:"w-full mb-2"}),this.globalTransportRow=m("div",{id:"global-transport-row",class:"w-full"});const e=$c({id:"global-controls-drawer",ariaLabel:" ",edgeOffsetClass:"bottom-[40px]",toggleHandleHeightClass:"py-2"},[this.globalPlayheadRow,this.globalToolsRow,this.globalTransportRow],zc);this.drawer=e;const t=document.getElementById("footer-main");t?t.appendChild(this.drawer):console.warn("footer-main container not found. GlobalControls not injected.")}render(){return this.drawer}destroy(){this.drawer.remove()}getGlobalPlayheadRow(){return this.globalPlayheadRow}getGlobalToolsRow(){return this.globalToolsRow}getGlobalTransportRow(){return this.globalTransportRow}}function pt(i,e,t){const r=window.devicePixelRatio||1;i.width=e*r,i.height=t*r,i.style.width=`${e}px`,i.style.height=`${t}px`;const n=i.getContext("2d");n&&n.scale(r,r)}const jc=ie("static/svg/icon-caret-up.svg");function Xc(){const i=`w-[${Vt}px]`,e="h-[75px]",t=m("div",{class:"relative flex justify-center w-full mt-4"}),r=m("canvas",{id:"global-mini-contour",class:`absolute top-0 left-0 ${i} ${e} z-0`}),n=m("canvas",{id:"global-mini-playhead",class:`absolute top-0 left-0 ${i} ${e} z-10`,style:"cursor: pointer;"}),s=m("div",{class:`relative ${i} ${e} bg-gray-900/80 backdrop-blur-sm shadow-md rounded-xl`},r,n);pt(r,Vt,75),pt(n,Vt,75),new ResizeObserver(()=>{const d=s.getBoundingClientRect(),c=Math.round(d.width),u=Math.round(d.height);pt(r,c,u),pt(n,c,u),Ar()}).observe(s);const o=m("img",{id:"global-mini-collapse-icon",src:jc,class:"w-4 h-4",alt:"Expand Mini Contour"}),l=m("button",{id:"global-mini-collapse-btn",class:"absolute right-[calc(50%-600px)] bottom-0 mb-2 p-2 bg-purple-700 text-white text-sm rounded hover:bg-purple-600 transition-colors",style:"cursor: pointer;",title:"Expand Mini Contour"},o);return t.appendChild(s),t.appendChild(l),m("div",{id:"globalControls-miniContour-body",class:"w-full max-w-[1260px] mx-auto"},t)}let j=null;function Vc(){return(j==null?void 0:j.disabled)??!1}function Yc(i){j=i}function Zc(){j&&(j.disabled=!0,j.classList.add("opacity-50","cursor-not-allowed"),ed())}function Qc(){j&&(j.disabled=!1,j.classList.remove("opacity-50","cursor-not-allowed"),td())}function ed(){if(!j)return;const i=j.querySelector("img");i&&(i.src=ie("static/svg/icon-cog.svg"),i.classList.add("img-spin"),i.alt="Generating...")}function td(){if(!j)return;const i=j.querySelector("img");i&&(i.src=ie("static/svg/icon-cursor-arrow-rays.svg"),i.classList.remove("img-spin"),i.alt="Toggle Autocomplete")}function Ti(i,e=[],t={}){const r=O(),n=t.id||`popover-${Math.random().toString(36).slice(2,9)}`,s=m("div",{id:n,"data-popover":"",role:"tooltip",class:["absolute z-[9999] inline-block w-64 text-sm transition-opacity duration-300","border rounded-lg shadow-xs opacity-0 invisible",r.menuBackground,r.textColor,r.borderColor,"bg-white dark:bg-gray-800"].join(" ")});if(t.title){const u=m("div",{class:["px-3 py-2 border-b rounded-t-lg","bg-gray-100 dark:bg-gray-700","border-gray-200 dark:border-gray-600"].join(" ")},m("h3",{class:"font-semibold text-gray-900 dark:text-white",textContent:t.title}));s.appendChild(u)}const a=m("div",{class:"px-3 py-2"},...e);s.appendChild(a),document.body.appendChild(s);const o={placement:t.placement||"bottom",triggerType:t.triggerType||"click",offset:t.offset??10,onShow:t.onShow??(()=>{}),onHide:t.onHide??(()=>{}),onToggle:t.onToggle??(()=>{})},l={id:n,override:t.overrideInstance??!0},d=new Zr(s,i,o,l);let c=null;return d.updateOnShow(()=>{var u;c=h=>{(h.key==="Escape"||h.key.length===1)&&d.hide()},document.addEventListener("keydown",c,{once:!0}),(u=o.onShow)==null||u.call(o,d)}),d.updateOnHide(()=>{var u;c&&(document.removeEventListener("keydown",c),c=null),(u=o.onHide)==null||u.call(o,d)}),{trigger:i,content:s,instance:d}}const id=[{id:"velocity-tool",label:"Velocity Tool",iconName:"icon-cog",hotkey:"V"},{id:"quantize-tool",label:"Quantize Tool",iconName:"icon-cog",hotkey:"Q",disabled:!0},{id:"transpose-tool",label:"Transpose Tool",iconName:"icon-cog",hotkey:"T",disabled:!0},{id:"chordifier",label:"Chordifier",iconName:"icon-adjustments-vertical",hotkey:"Shift+C",disabled:!0},{id:"humanizer",label:"Humanizer",iconName:"icon-adjustments-vertical",hotkey:"Shift+H",disabled:!0}];function sd(){const i=O(),e=m("button",{id:"note-editing-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Tools"},T("icon-chart-bar","Editing"));let t;const r=[m("div",{class:"max-h-72 overflow-y-auto flex flex-col gap-1"},...id.flatMap((a,o)=>{const l=o===2,d=m("button",{class:["flex items-center justify-between gap-2 px-3 py-2 text-sm rounded text-left transition-colors",a.disabled?"text-gray-500 bg-gray-700/30 cursor-not-allowed opacity-50":"text-white hover:bg-purple-700 cursor-pointer"].join(" "),...a.disabled?{}:{onClick:()=>{const c=new CustomEvent("editor-invoke",{detail:{editorId:a.id},bubbles:!0});e.dispatchEvent(c),requestAnimationFrame(()=>{t==null||t.hide()})}}},m("div",{class:"flex items-center gap-2"},T(a.iconName,a.label),m("span",{textContent:a.label})),a.hotkey?m("span",{class:"text-xs text-gray-400 font-mono",textContent:a.hotkey}):null);return l?[d,m("div",{class:`my-2 border-t ${i.borderColor} mx-2`})]:[d]}))];t=Ti(e,r,{title:"Tools",placement:"bottom",triggerType:"click"}).instance;let s=null;return t.updateOnShow(()=>{s=a=>{(a.key==="Escape"||a.key.length===1)&&(t==null||t.hide())},document.addEventListener("keydown",s,{once:!0})}),t.updateOnHide(()=>{s&&(document.removeEventListener("keydown",s),s=null)}),e}function Be(i){const e=O();return m("span",{class:`font-semibold ${e.accentColor} rounded text-xs`,textContent:i})}function V(...i){const e=O();return m("p",{class:`text-sm leading-relaxed ${e.textColor}`},...i)}function Te(i,e="?",t){const r=O(),n=m("span",{"data-tooltip-target":i,tabIndex:-1,class:[`${r.textColor} border border-white/40`,"hover:bg-white/10","font-medium rounded-full text-xs px-2 py-[2px]","pointer-events-auto select-none","cursor-default","focus:outline-none focus:ring-0","aria-hidden"].join(" ")},e),s=Array.isArray(t)?t.map(o=>typeof o=="string"?V(o):o):[typeof t=="string"?V(t):t],a=m("div",{id:i,role:"tooltip",class:["absolute z-10 invisible inline-block max-w-xs px-4 py-3 text-sm",`${r.textColor} transition-opacity duration-300 ${r.surfaceBackground} rounded-lg shadow-xs`,"opacity-0 tooltip"].join(" ")},m("div",{class:"space-y-2"},...s),m("div",{class:"tooltip-arrow","data-popper-arrow":""}));return{trigger:n,tooltip:a}}function rd(){const i=O(),e=m("button",{id:"note-placement-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",title:"Grid Settings",style:"cursor: pointer;"},T("icon-music","Placement")),t=Te("tooltip-grid-guides","?",[V(Be("Key Grid Highlighting:")," colors each piano roll row based on the current song key."),V("In-key notes are shown as white rows. Out-of-key notes are shown as black rows.")]),r=we({id:"toggle-grid-guides",stateA:"Off",stateB:"Transpose Grid to Key",inline:!0,tooltipTrigger:t.trigger});r.input.addEventListener("change",()=>{Ta(r.getChecked())});const n=Te("tooltip-snap-to-key","?",[V(Be("Snap to Key:")," constrains vertical note placement to notes in the current key."),V("Hold ",Be("CTRL")," while placing notes to temporarily allow chromatic input.")]),s=we({id:"toggle-snap-key",stateA:"Off",stateB:"Snap Notes to Key",inline:!0,tooltipTrigger:n.trigger});s.input.addEventListener("change",()=>{Ra(s.getChecked())});const a=Te("tooltip-snap-to-grid","?",[V(Be("Snap to Grid:")," constrains horizontal note placement to musical durations."),V("Notes will align to the selected beat value (e.g. quarter, eighth, sixteenth).")]),o=we({id:"toggle-snap-grid",stateA:"Off",stateB:"Snap Notes to Grid",inline:!0,tooltipTrigger:a.trigger});o.input.addEventListener("change",()=>{Ia(o.getChecked())});const l=()=>{r.setChecked(Zs()),s.setChecked(wt()),o.setChecked(Qs())},d=[m("div",{class:"mb-1"},r.element),t.tooltip,m("div",{class:`my-2 border-t ${i.borderColor} mb-3 mx-2`}),m("div",{class:"mb-1"},s.element),n.tooltip,m("div",{class:"mt-1"},o.element),a.tooltip];return Ti(e,d,{title:"Grid Settings",placement:"bottom",triggerType:"click",onShow:()=>requestAnimationFrame(l)}),{trigger:e,refreshToggles:l}}function nd(){const i=rd(),e=m("div",{class:"flex flex-wrap justify-center items-center gap-4 p-4"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},m("button",{id:"note-mode-btn",class:"bg-blue-600 px-3 py-1 rounded text-white hover:bg-blue-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Drawing Toolbar (Q)"},T("icon-pen","Note Mode")),m("button",{id:"ai-mode-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"AI Toolbar (W)"},T("icon-brain-white","AI Mode")))),t=m("div",{class:"flex gap-4"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},i.trigger,sd()),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},...Jc.map((s,a)=>m("button",{class:["bg-transparent hover:bg-gray-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl","w-[52px] h-[42px] flex items-center justify-center"].join(" "),"data-value":s.value,title:`${s.title} (${a+1} or Shift+${a+1})`},s.label))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"dotted-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Dotted Note (.)"},"•"),m("button",{id:"triplet-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Triplet (/)"},"³"))),r=m("button",{id:"autocomplete-toggle-btn",class:"bg-transparent hover:bg-purple-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Autocomplete (G/Shift+G)"},T("icon-cursor-arrow-rays","Toggle Autocomplete"));Yc(r);const n=m("div",{class:"flex gap-4 hidden"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-tools-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Tools"},T("icon-chip","AI Tools"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},r,m("button",{id:"autocomplete-approve-btn",class:"bg-transparent hover:bg-green-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"Approve (Tab)"},T("icon-thumbs-up","Approve Autocomplete"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-extend-before-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Extend Before (SHIFT+1)"},T("icon-double-arrow-left","AI Extend Before")),m("button",{id:"ai-paint-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Paint Tool (SHIFT+2)"},T("icon-paint-brush","AI Paint")),m("button",{id:"ai-extend-after-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Extend After (SHIFT+3)"},T("icon-double-arrow-right","AI Extend After"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-adjust-prompt-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"Adjust AI Prompt Settings"},T("icon-adjust-ai-prompt","Adjust AI Prompt")),m("button",{id:"ai-debugger-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Debugger"},T("icon-command-line","AI Debugger"))));return e.appendChild(t),e.appendChild(n),{element:e,refreshGridSettings:i.refreshToggles,noteOptionsGroup:t,aiOptionsGroup:n}}function ad(){const i=m("div",{class:"fixed left-[calc(50%-678px)] bottom-[20px] flex flex-col gap-2 z-[9999]"},m("button",{id:"footer-help-btn",class:"side-button side-button-info",title:"Help / Documentation"},T("icon-lightbulb","Help")),m("button",{id:"footer-whats-new-btn",class:"side-button side-button-info",title:"What's New / Release Notes"},T("icon-circle-plus","What's New")));return document.body.appendChild(i),i}function us(){const i=O();return m("div",{class:["h-12 w-px",i.accentColor,"shadow-inner","rounded-full"].join(" ")})}function Ge(i,e,t,r,n){return m("button",{id:i,title:e,class:["w-12 h-12 flex items-center justify-center rounded-full cursor-pointer shadow transition-all hover:scale-110","text-white",r,n].join(" ")},t)}function Yt(i){const{id:e,value:t,min:r,max:n,onInput:s}=i,a=O();return m("input",{id:e,type:"number",value:String(t),min:r==null?void 0:r.toString(),max:n==null?void 0:n.toString(),class:["w-[72px] h-[40px] px-2 rounded text-sm font-semibold",a.surfaceBackground,a.textColor,a.borderColor].join(" "),oninput:s})}function He(i="4"){return m("div",{class:`inline-block w-${i}`})}function od(){const i=O();return m("div",{class:["w-full h-px",i.accentColor,"shadow-inner","rounded-full","my-2"].join(" ")})}const ld=["C","D","E","F","G","A","B"],cd=["C#","D#","","F#","G#","A#",""];function dd(){return Ai()??"CM"}function Zt(i){const e=i.endsWith("m")?"m":"M";return[i.slice(0,i.length-1),e]}function ud(){O();let[i,e]=Zt(dd());const t=U({id:"key-selector-trigger",text:`${i}${e}`,kind:"secondary",additionalClasses:"w-14 px-2 py-[10px] text-center truncate"}),r=(c,u)=>{if(c==="")return;i=c,e=u;const h=`${c}${u}`;xr(h),t.textContent=h,l()},n=m("div",{class:"flex w-full mt-2 gap-[6px]"},...ld.map(c=>m("button",{class:Qt(c,i),onClick:()=>r(c,e)},c))),s=m("div",{class:"flex w-full mb-1 gap-[6px] translate-x-[22px]"},...cd.map(c=>c===""?m("div",{class:"w-8"}):m("button",{class:Qt(c,i),onClick:()=>r(c,e)},c))),a=we({id:"key-mode-toggle",stateA:"Major",stateB:"Minor",inline:!0});a.setChecked(e==="m"),a.input.addEventListener("change",()=>{const c=a.getChecked()?"m":"M";r(i,c)});const o=[s,n,od(),a.element],l=()=>{[...n.children,...s.children].forEach(u=>{if(!(u instanceof HTMLButtonElement))return;const h=u.textContent||"";u.className=Qt(h,i)}),a.setChecked(e==="m")};return Ti(t,o,{title:"Key Selector",placement:"bottom",triggerType:"click"}),Et(c=>{const[u,h]=Zt(c.songKey);i=u,e=h,t.textContent=c.songKey,l()}),{trigger:t,refreshUI:()=>{const[c,u]=Zt(Ai());i=c,e=u,t.textContent=`${c}${u}`,l()}}}function Qt(i,e){return["w-8 h-8 rounded-full text-xs flex items-center justify-center","transition-all duration-150","cursor-pointer focus:outline-none","text-white",i===e?"bg-cyan-600 ring-2 ring-white":"bg-gray-600 hover:bg-gray-500 hover:ring-1 hover:ring-white"].join(" ")}function hd(){const i=we({id:"loop-toggle",stateB:"Loop",inline:!0}),e=ud();return{element:m("div",{class:"flex justify-center items-center gap-4 flex-wrap"},m("div",{class:"flex items-center gap-2"},Ge("play-button","Play/Pause",T("icon-play","Play"),"bg-blue-600","hover:bg-blue-700"),Ge("stop-button","Stop",T("icon-stop","Stop"),"bg-blue-600","hover:bg-blue-700"),He("4"),Ge("record-button","Record",T("icon-record","Record"),"bg-red-600","hover:bg-red-700"),He("4"),i.element,He("4"),us()),m("div",{class:"flex items-center gap-4 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("div",{class:"flex flex-col items-start gap-1"},Y("Key"),e.trigger),m("div",{class:"flex flex-col items-start gap-1"},Y("Tempo"),Yt({id:"tempo-input",min:20,max:300,value:120})),m("div",{class:"flex flex-col items-start gap-1"},Y("Measures"),Yt({id:"measures-input",min:1,max:1e3,value:8})),m("div",{class:"flex flex-col items-start gap-1"},Y("Beats"),Yt({id:"beats-per-measure-input",min:1,max:16,value:4}))),us(),m("div",{class:"flex items-center gap-2"},He("4"),Ge("save-button","Save",T("icon-save","Save"),"bg-green-600","hover:bg-green-700"),Ge("load-button","Load",T("icon-load","Load"),"bg-yellow-600","hover:bg-yellow-700"),He("4"),Ge("config-button","User Settings",T("icon-user-settings","Settings"),"bg-purple-600","hover:bg-purple-700"))),refreshToggles:()=>{e.refreshUI()}}}const fd=ie("static/svg/icon-caret-up.svg"),pd=ie("static/svg/icon-caret-down.svg");function md(i){var d;const e=()=>{},t=(d=i.querySelector("#global-mini-contour"))==null?void 0:d.parentElement,r=i.querySelector("#global-mini-collapse-btn"),n=i.querySelector("#global-mini-collapse-icon"),s=300,a=75;let o=!0;const l=()=>{if(!t||!r||!n)return;o=!o,t.style.height=o?`${a}px`:`${s}px`,t.querySelectorAll("canvas").forEach(u=>{u.style.height=o?`${a}px`:`${s}px`}),n.src=o?fd:pd,r.title=o?"Expand Mini Contour":"Collapse Mini Contour"};return r==null||r.addEventListener("click",l),{detach:()=>{r==null||r.removeEventListener("click",l)},refreshUI:e}}function hs(i,e={}){const{beatsPerBar:t=4,stepsPerBeat:r=4,quantizeDurations:n=!0,ignoreVelocity:s=!1}=e,a=[],o=[...i].sort((d,c)=>d.start-c.start);let l=-1;for(const d of o){const c=Math.floor(d.start/t),u=d.start%t,h=Math.round(u*r);c!==l&&(a.push({type:"Bar",value:c}),l=c),a.push({type:"Position",value:h}),a.push({type:"Pitch",value:d.pitch});const f=n?Math.max(1,Math.round(d.duration*r)):d.duration;if(a.push({type:"Duration",value:f}),!s){const y=d.velocity??100;a.push({type:"Velocity",value:y})}}return a}function yd(i,e={}){const{beatsPerBar:t=4,stepsPerBeat:r=4,quantizeDurations:n=!0,ignoreVelocity:s=!1}=e;let a=0,o=0,l=!1;const d=[];for(let c=0;c<i.length;c++){const u=i[c];switch(u.type){case"Bar":a=u.value;break;case"Position":o=u.value,l=!0;break;case"Pitch":{if(!l){A(`REMI decode: Pitch token at index ${c} has no preceding Position`,u,"warn");continue}const h=i[c+1],f=p=>typeof p=="number"&&!Number.isNaN(p)&&Number.isFinite(p);if(!h||h.type!=="Duration"||!f(h.value)){A(`REMI decode: Missing or invalid Duration token after Pitch at index ${c}`,{pitchToken:u,durationToken:h},"warn");continue}let y=100;if(!s){const p=i[c+2];if(!p||p.type!=="Velocity"||!f(p.value)){A(`REMI decode: Missing or invalid Velocity token after Duration at index ${c}`,{pitchToken:u,velocityToken:p},"warn");continue}y=p.value}const b=a*t+o/r,g=n?h.value/r:h.value;d.push({pitch:u.value,start:b,duration:g,velocity:y}),l=!1,c+=s?1:2;break}}}return d}function gd(i,e,t,r,n){const s=c=>c.start>=t&&c.start<r,a=e.find(c=>c.id===i);if(!a)throw new Error(`Sequencer with id ${i} not found.`);const o=a.notes.filter(s),l=hs(o,n),d=e.filter(c=>c.id!==i).map(c=>{const u=c.notes.filter(s);return hs(u,n)});return A("[AutoComplete] Extracted Context:",{primaryTrackRemi:l,otherTracksRemi:d,startBeat:t,endBeat:r}),{primaryTrackRemi:l,otherTracksRemi:d,startBeat:t,endBeat:r}}function _d(i,e,t){const r=[];let n=0,s=null,a=!1;A("[AutoComplete] Clipping LLM Continuation:",{llmContinuationRemi:i,clipAfterBar:e,clipAfterPosition:t});for(const o of i){if(o.type==="Bar"){s=o,n=o.value;continue}if(o.type==="Position"){a=n>e||n===e&&o.value>=t,a&&(s&&(r.push(s),s=null),r.push(o));continue}a&&r.push(o)}return A("[AutoComplete] Clipped LLM Continuation:",r),r}function bd(i,e,t){const r=e*t,n=[];let s=0;for(const a of i){if(a.type==="Bar"){s=a.value,n.push(a);continue}if(a.type==="Position"){const o=a.value,l=Math.floor(o/r),d=o%r,c=s+l,u=n[n.length-1];(!u||u.type!=="Bar"||u.value!==c)&&n.push({type:"Bar",value:c}),n.push({type:"Position",value:d})}else n.push(a)}return n}const vd="llmSettings",Sd={promptTuning:{styleInstruction:"",additionalInstructions:"",avoidStyles:""},context:{useMultiTrackContext:!0,contextBeats:32}};let Cd=st(vd)??Sd;function di(){return Cd}function Ir(){return{beatsPerBar:xe(),stepsPerBeat:4,quantizeDurations:!0,ignoreVelocity:!0}}function Rr(i){const t=di().context.contextBeats,r=i.notes;if(r.length===0)return[0,t];const n=r.reduce((l,d)=>{const c=l.start+l.duration;return d.start+d.duration>c?d:l}),s=n.start+n.duration,a=Math.ceil(s);return[Math.max(0,a-t),a]}function Nd(i,e,t){const r=Math.floor(i/e),n=Math.round(i%e*t);return A("[AutoComplete] Computed Clip Boundary:",{endBeat:i,beatsPerBar:e,stepsPerBeat:t,clipAfterBar:r,clipAfterPosition:n}),{clipAfterBar:r,clipAfterPosition:n}}function wd(i){const[,e]=Rr(i),t=Ir(),r=(t==null?void 0:t.beatsPerBar)??4;return Math.floor(e/r)}function Md(i){const e=[];for(const n of i){const s=n.trim();if(s.includes("_")){const d=kd(s);if(d.length>0){e.push(...d);continue}}if(s.includes("|")){const d=Ld(s);if(d.length>0){e.push(...d);continue}}const a=xd(n);if(a.length>0){e.push(...a);continue}const o=s.match(/^([A-Za-z]+)=(.+)$/);if(o){const[,d,c]=o;e.push(`${d.trim()} ${c.trim()}`);continue}const l=s.match(/^([A-Ga-g])[:](\d)$/);if(l){const[,d,c]=l;e.push(`Pitch ${d.toUpperCase()}${c}`);continue}if(s.includes(":")){const d=s.split(":");if(d.length===2&&d[0]&&d[1]){e.push(`${d[0].trim()} ${d[1].trim()}`);continue}}if(n.match(/(Bar_|Position_|Pitch_|Duration_|Velocity_|Pos_|Vel_|Dur_)/i)){const d=n.split(/(?=Bar_|Position_|Pitch_|Duration_|Velocity_|Pos_|Vel_|Dur_)/i);e.push(...d.map(c=>c.replace(/_/g," ").trim()).filter(Boolean));continue}if(n.match(/(Bar\s|Position\s|Pitch\s|Duration\s|Velocity\s|Pos\s|Vel\s|Dur\s)/i)&&n.split(" ").length>2){const d=n.split(/(?=Bar\s|Position\s|Pitch\s|Duration\s|Velocity\s|Pos\s|Vel\s|Dur\s)/i);e.push(...d.map(c=>c.trim()).filter(Boolean));continue}e.push(s)}const t={pos:"Position",vel:"Velocity",dur:"Duration"},r=[];for(let n=0;n<e.length;n++){const s=e[n],a=s.match(/^(pos|vel|dur|bar|position|pitch|duration|velocity)\s+(.+)$/i);if(a){const[,h,f]=a,y=t[h.toLowerCase()]||null,b=y||h[0].toUpperCase()+h.slice(1).toLowerCase();r.push(`${b} ${f}`);continue}const o=s,l=e[n+1],d=t[o.toLowerCase()]||null,c=o.match(/^(bar|position|pitch|duration|velocity)$/i),u=d||(c?c[0][0].toUpperCase()+c[0].slice(1).toLowerCase():null);if(u&&l!==void 0){r.push(`${u} ${l}`),n++;continue}r.push(s)}return r}function xd(i){const e=[],t=i.trim(),r=t.match(/^([\d\.]+),(\d+),(\d+)/);if(r){const[,s,a,o]=r,l=Math.round(Number(s)*16);e.push(`Position ${l}`),e.push(`Velocity ${a}`),e.push(`Duration ${o}`)}const n=t.split("//");if(n.length>1){const a=n[1].trim().split(",").map(o=>o.trim()).filter(Boolean);e.push(...a)}return e}function Ld(i){const e=[],t=i.split("|").map(r=>r.trim()).filter(Boolean);for(let r=0;r<t.length;r+=2){const n=t[r],s=t[r+1];s&&(n.toLowerCase()==="track_info"||n.toLowerCase()==="inst"||e.push(`${n} ${s}`))}return e}function kd(i){const e=[],t=["bar","position","pos","pitch","duration","dur","velocity","vel"],r=i.split("_").filter(Boolean);for(let n=0;n<r.length-1;n++){const s=r[n].toLowerCase(),a=r[n+1];t.includes(s)&&(e.push(`${s} ${a}`),n++)}return e}function Gd(i){const e=[],t=Md(i);for(const r of t){const n=r.match(/^(\w+)\s+(.+)$/);if(!n){if(/^\d+$/.test(r)){e.push({type:"Duration",value:Number(r)});continue}console.warn(`Invalid REMI token format: '${r}'`);continue}const[,s,a]=n;let o=s.charAt(0).toUpperCase()+s.slice(1).toLowerCase();if(!["Key","Inst","Tempo","Start","End"].includes(o))switch(o==="Note"&&(o="Pitch"),o){case"Bar":case"Position":case"Duration":case"Velocity":{const l=Number(a);if(isNaN(l)){console.warn(`Invalid numeric value in REMI token: '${r}'`);continue}e.push({type:o,value:l});break}case"Pitch":e.push({type:o,value:a});break;default:console.warn(`Unknown REMI token type: '${o}' in token '${r}'`);break}}return A("[RemiTokenParser] Parsed RemiEvents:",e),e}function Bd(i){if(!i||typeof i!="string"||!i.trim())return"Unknown Key";const e=i.trim();if(e.length===1)return`${e.toUpperCase()} Major`;const t=e.slice(-1),r=e.slice(0,-1);return r?t==="m"?`${r.toUpperCase()} Minor`:`${r.toUpperCase()} Major`:"Unknown Key"}class Ed{logPrompt(e){A(`[${this.name}] Generated Prompt:`,e)}}class Ad extends Ed{constructor(){super(...arguments),this.name="Remi Autocomplete Prompt"}buildPrompt(e,t){const{continuationBeats:r,llmSettings:n}=t,{styleInstruction:s}=n.promptTuning,{primaryTrackRemi:a,otherTracksRemi:o}=e,l=f=>f.map(y=>`${y.type} ${y.value}`).join(" "),d=o.map((f,y)=>`Track ${y+1}: ${l(f)}`).join(`
`),c=`Primary Track: ${l(a)}`,h=["Song Key:",Bd(Ai()),...s?["","STYLE INSTRUCTION:",s]:[],"Background Tracks Context (Can be empty):",d,"","Track to continue from:",c,"",`${r} beat PRIMARY TRACK CONTINUATION:`].join(`
`);return this.logPrompt(h),h}}async function Td(i,e,t){const r=Ms();if(!r)throw new Error("OpenAI API key is not set.");const n="https://api.openai.com/v1/responses",s=t.schema,a={model:e,input:[{role:"user",content:i}],text:{format:{type:"json_schema",name:t.name,schema:s,strict:!0}}},o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(a)});if(!o.ok){const d=await o.text();throw console.error("OpenAI Responses API Error:",d),new Error(`OpenAI request failed: ${o.status}`)}const l=await o.json();return Id(l)}function Id(i){var s,a,o;const e=(s=i.output)==null?void 0:s.find(l=>l.type==="message"),t=(o=(a=e==null?void 0:e.content)==null?void 0:a.find(l=>l.type==="output_text"))==null?void 0:o.text;if(A("[OpenAI] Raw Output:",t),!t)throw new Error("Missing output_text in OpenAI response.");const r=JSON.parse(t);if(!Array.isArray(r.result))throw new Error("Invalid result format.");return r.result}async function Rd(i,e,t){if(i.startsWith("gpt-")||i.startsWith("o3")||i.startsWith("o4"))return Td(e,i,t);throw new Error(`Unsupported LLM model: ${i}`)}const Fd={name:"remi_tokens",schema:{type:"object",properties:{result:{type:"array",items:{type:"object",properties:{type:{type:"string",enum:["Bar","Position","Pitch","Duration","Velocity"],description:"The REMI token type"},value:{type:["string","number"],description:"The token value (Pitch is string, others are numbers)"}},required:["type","value"],additionalProperties:!1},description:"REMI token sequence"}},required:["result"],additionalProperties:!1}};async function fs(i="unknown"){var a,o,l,d,c;const e=kr();if(e===null){console.warn("No active sequencer to apply autocomplete to.");return}const t=lt(e);if(!t){console.error(`Sequencer with id ${e} not found.`);return}Zc(),Ci(),(a=t.matrix)==null||a.invalidateAIAutocompleteRenderer();const[r,n]=Rr(t);A(`[AutoComplete] Running autocomplete for beats ${r} to ${n} on sequencer ${e} via ${i}`);const s=wd(t);(o=t.matrix)==null||o.setActiveAutocompleteBar(s),(l=t.matrix)==null||l.startAIAutocompleteAnimationLoop();try{await Od(e,K(),r,n)}catch(u){console.error("Autocomplete failed:",u)}finally{Qc(),Ye().length===0&&(A("[AutoComplete] No preview notes generated. Stopping animation loop."),(d=t.matrix)==null||d.stopAIAutocompleteAnimationLoop()),(c=t.matrix)==null||c.setActiveAutocompleteBar(null)}}async function Od(i,e,t,r,n="gpt-4o",s=4){const a=Ir();A("[AutoComplete] Running REMI Continuation Pipeline with LLM settings:",di());const o=gd(i,e,t,r,a),d=new Ad().buildPrompt(o,{continuationBeats:s,llmSettings:di()}),c=a.beatsPerBar??4,u=a.stepsPerBeat??4,{clipAfterBar:h,clipAfterPosition:f}=Nd(r,c,u),y=2;for(let b=1;b<=y;b++){const g=await Rd(n,d,Fd),p=typeof g[0]=="string"?Gd(g):g,v=bd(p,c,u),S=_d(v,h,f),_=yd(S,a);if(A(`[AutoComplete] Attempt ${b}: Decoded Notes:`,_),_.length>0){A("[AutoComplete] Final Decoded Notes:",_),go(_);const C=lt(i);C&&C.redraw();return}A(`[AutoComplete] Attempt ${b}: No new notes after clip boundary. Retrying...`)}A("[AutoComplete] All retry attempts failed to generate new continuation notes.")}function Pd(i){var r,n;const e=Ye();I(kt(i,e),Gt(i,e)),Ci();const t=lt(i);t?((r=t.matrix)==null||r.stopAIAutocompleteAnimationLoop(),(n=t.matrix)==null||n.playNoteAcceptanceAnimation(e)):console.warn(`Could not stop AI animation: sequencer ${i} not found.`)}const ps={Digit1:4,Digit2:2,Digit3:1,Digit4:.5,Digit5:.25,Digit6:.125};function Ud(i){const{rootElement:e,noteOptionsGroup:t,aiOptionsGroup:r}=i,n=e.querySelectorAll("button[data-value]"),s=e.querySelector("#dotted-note-btn"),a=e.querySelector("#triplet-note-btn"),o=e.querySelector("#note-mode-btn"),l=e.querySelector("#ai-mode-btn"),d=e.querySelector("#autocomplete-toggle-btn"),c=e.querySelector("#autocomplete-approve-btn"),u=e.querySelector("#autocomplete-reject-btn"),h=e.querySelector("#ai-tools-btn"),f=e.querySelector("#ai-extend-before-btn"),y=e.querySelector("#ai-paint-btn"),b=e.querySelector("#ai-extend-after-btn"),g=e.querySelector("#ai-adjust-prompt-btn"),p=e.querySelector("#ai-debugger-btn"),v=M=>{if(M==="ai"&&!Ms()){W().showOpenAIKeyNotSet();return}const x=M==="note";t.classList.toggle("hidden",!x),r.classList.toggle("hidden",x),o==null||o.classList.toggle("bg-blue-600",x),o==null||o.classList.toggle("bg-gray-800",!x),l==null||l.classList.toggle("bg-purple-700",!x),l==null||l.classList.toggle("bg-gray-800",x)};o==null||o.addEventListener("click",()=>v("note")),l==null||l.addEventListener("click",()=>v("ai")),d==null||d.addEventListener("click",M=>{M.button===0&&fs("GlobalToolbarListeners")}),d==null||d.addEventListener("contextmenu",M=>{M.preventDefault(),qi(),console.log("Toggled Autocomplete Mode")}),c==null||c.addEventListener("click",()=>{console.log("Approved Autocompleted Notes");const M=kr();if(M===null){console.warn("No active sequencer to apply autocomplete to.");return}Pd(M)}),h==null||h.addEventListener("click",()=>{W().showFeatureBlocked(),console.log("AI Tools Popover Triggered (placeholder)")}),f==null||f.addEventListener("click",()=>{W().showFeatureBlocked(),console.log("AI Extend Before Triggered (placeholder)")}),y==null||y.addEventListener("click",()=>{W().showFeatureBlocked(),console.log("AI Paint Tool Activated (placeholder)")}),b==null||b.addEventListener("click",()=>{W().showFeatureBlocked(),console.log("AI Extend After Triggered (placeholder)")}),g==null||g.addEventListener("click",()=>{W().showFeatureBlocked(),console.log("AI Prompt Settings Modal Opened (placeholder)")}),p==null||p.addEventListener("click",()=>{W().showFeatureBlocked(),console.log("AI Debugger Panel Opened (placeholder)")});const S=()=>{const M=Tt(),x=_c();n.forEach(B=>{const R=parseFloat(B.dataset.value??"-1");B.classList.remove("bg-purple-700","bg-blue-700","bg-gray-800"),B.classList.add("bg-transparent"),R===x?(B.classList.add("bg-purple-700"),B.classList.remove("bg-transparent")):R===M?(B.classList.add("bg-blue-700"),B.classList.remove("bg-transparent")):B.classList.add("bg-gray-800")})},_=Et(M=>{S(),s==null||s.classList.toggle("bg-purple-700",M.isDottedMode),s==null||s.classList.toggle("bg-transparent",!M.isDottedMode),a==null||a.classList.toggle("bg-purple-700",M.isTripletMode),a==null||a.classList.toggle("bg-transparent",!M.isTripletMode),N(M.noteDuration,!1)}),C=yo(M=>{d==null||d.classList.toggle("bg-pink-400",M),d==null||d.classList.toggle("bg-transparent",!M)}),N=(M,x=!0)=>{const B=ls(),R=ci();let F=M;B?F*=1.5:R&&(F*=2/3),at.currentDuration=F,K().forEach(Q=>{var be;Q.config.currentDuration=F,(be=Q.matrix)==null||be.requestRedraw()}),gc(M,x)},w=(M=!0)=>{const x=e.querySelector("button[data-value].bg-purple-700");if(x){const B=parseFloat(x.dataset.value);N(B,M)}},L=()=>{S()};n.forEach(M=>{M.classList.add("note-duration-btn"),M.addEventListener("click",x=>{if(x.button===0){const B=parseFloat(M.dataset.value);N(B)}}),M.addEventListener("contextmenu",x=>{x.preventDefault();const B=parseFloat(M.dataset.value);as(B,!0)})}),a==null||a.addEventListener("click",()=>{const M=!ci();os(M,!1),w(!1)}),s==null||s.addEventListener("click",()=>{const M=!ls();os(!1,M),w(!1)});const G=M=>{const x=M.target;if(!(x.tagName==="INPUT"||x.tagName==="TEXTAREA"||x.isContentEditable||Ne())){if(ps.hasOwnProperty(M.code)){M.preventDefault();const B=ps[M.code];M.shiftKey?as(B,!0):N(B);return}if(M.key==="."){M.preventDefault(),s==null||s.click();return}if(M.key==="/"){M.preventDefault(),a==null||a.click();return}switch(M.code){case"KeyG":M.preventDefault(),M.shiftKey?(qi(),console.log("Toggled Autocomplete Mode via Shift+G")):Vc()||fs("GlobalToolbarListeners");return;case"Tab":M.preventDefault(),c==null||c.click();return;case"KeyQ":M.preventDefault(),o==null||o.click();return;case"KeyW":M.preventDefault(),l==null||l.click();return}}};return window.addEventListener("keydown",G),L(),{detach:()=>{window.removeEventListener("keydown",G),_(),C(),[o,l,d,c,u,h,f,y,b,g,p].forEach(R=>{R&&R.replaceWith(R.cloneNode(!0))}),n.forEach(R=>{const F=R.cloneNode(!0);R.replaceWith(F)});const x=s==null?void 0:s.cloneNode(!0);x&&(s!=null&&s.parentNode)&&s.parentNode.replaceChild(x,s);const B=a==null?void 0:a.cloneNode(!0);B&&(a!=null&&a.parentNode)&&a.parentNode.replaceChild(B,a)},refreshUI:L}}function Dd(i,e){const t=i.querySelector("#footer-help-btn"),r=i.querySelector("#footer-whats-new-btn"),n=()=>{},s=()=>{window.open("https://github.com/alacrity-ai/sequenzia","_blank")},a=()=>{e.show()};return t==null||t.addEventListener("click",s),r==null||r.addEventListener("click",a),{detach:()=>{t==null||t.removeEventListener("click",s),r==null||r.removeEventListener("click",a)},refreshUI:n}}function qd(i,e,t,r,n){const s=i.querySelector("#play-button"),a=i.querySelector("#stop-button"),o=i.querySelector("#record-button"),l=i.querySelector("#loop-toggle"),d=i.querySelector("#tempo-input"),c=i.querySelector("#measures-input"),u=i.querySelector("#beats-per-measure-input"),h=i.querySelector("#save-button"),f=i.querySelector("#load-button"),y=i.querySelector("#config-button"),b=x=>{if(!s)return;s.classList.toggle("bg-blue-800",x),s.classList.toggle("bg-blue-600",!x);const B=x?"icon-pause":"icon-play",R=ie(`static/svg/${B}.svg`),F=s.querySelector("img");if((F==null?void 0:F.getAttribute("src"))!==R){const q=T(B,x?"Pause":"Play");F?s.replaceChild(q,F):s.appendChild(q)}},g=()=>{b(e.isPlaying())};e.setOnStopCallback(()=>{b(!1)});const p=()=>{const x=!e.isPlaying();e.toggle(),b(x)},v=()=>{e.stop(),b(!1)},S=()=>{},_=()=>{const x=d==null?void 0:d.valueAsNumber;x&&x>=20&&x<=300&&ki(x,!0)},C=()=>{const x=c==null?void 0:c.valueAsNumber;x&&x>=1&&x<=1e3&&Bi(x,!0)},N=()=>{const x=u==null?void 0:u.valueAsNumber;x&&x>=1&&x<=16&&Gi(x,!0)};Et(x=>{d&&(d.value=String(x.tempo)),c&&(c.value=String(x.totalMeasures)),u&&(u.value=String(x.timeSignature[0]))});const w=()=>{bc((l==null?void 0:l.checked)??!1)},L=()=>{r.show()},G=()=>{n.show()},E=()=>{t.show()},M=x=>{var F;const B=(F=document.activeElement)==null?void 0:F.tagName,R=B==="INPUT"||B==="TEXTAREA";x.key===" "&&!R&&(x.preventDefault(),x.shiftKey?v():p())};return s==null||s.addEventListener("click",p),a==null||a.addEventListener("click",v),o==null||o.addEventListener("click",S),d==null||d.addEventListener("change",_),c==null||c.addEventListener("change",C),u==null||u.addEventListener("change",N),l==null||l.addEventListener("change",w),h==null||h.addEventListener("click",L),f==null||f.addEventListener("click",G),y==null||y.addEventListener("click",E),window.addEventListener("keydown",M),{detach:()=>{s==null||s.removeEventListener("click",p),a==null||a.removeEventListener("click",v),o==null||o.removeEventListener("click",S),d==null||d.removeEventListener("change",_),c==null||c.removeEventListener("change",C),u==null||u.removeEventListener("change",N),l==null||l.removeEventListener("change",w),h==null||h.removeEventListener("click",L),f==null||f.removeEventListener("click",G),y==null||y.removeEventListener("click",E),window.removeEventListener("keydown",M)},refreshUI:g}}function Fr(i,e){var t;for(const r of i.sequencers){const n=r.matrix;if(!n)continue;const s=(t=n.getPixelsPerBeat)==null?void 0:t.call(n);if(!s)continue;const a=e*s;n.setPlayheadPixelX(a)}}let he=null,We=null;function Kd(i){We=i,he=We.getContext("2d")}function It(i){if(!he||!We)return;const e=window.devicePixelRatio||1,t=We.width/e,r=We.height/e;he.clearRect(0,0,t,r);const n=Math.round(i)+.5;he.strokeStyle="#ff00ff",he.lineWidth=1,he.beginPath(),he.moveTo(n,0),he.lineTo(n,r),he.stroke()}function Hd(i,e){const t=e.snapResolution||.25,r=e.isTripletMode?t*(2/3):t;return Math.round(i/r)*r}let mt=!1,ee=null,ei=!1;function $d(i){if(ee=i.querySelector("#global-mini-playhead"),!ee)throw new Error("Playhead canvas not found in container.");const e=H.getInstance(),t=(l,d=!0)=>{const c=ce(),u=Hd(l,at),h=Math.max(0,Math.min(c,u)),f=e.isActive();if(e.seek(h),d&&f&&e.resume(),Fr(e,h),ee){const y=window.devicePixelRatio||1,b=ee.width/y,g=h/c*b;It(g)}},r=l=>{if(!ee)return;const d=window.devicePixelRatio||1,c=ee.getBoundingClientRect(),u=ee.width/d;let h=(l.clientX-c.left)*(u/c.width);h=Math.max(0,Math.min(u,h));const f=ce(),y=h/u*f;t(y,!1)},n=l=>{var f;const d=(f=document.activeElement)==null?void 0:f.tagName;if(d==="INPUT"||d==="TEXTAREA"||!l.shiftKey)return;const c=ce(),u=xe();let h=e.getCurrentBeat();switch(l.key.toLowerCase()){case"a":h-=1;break;case"d":h+=1;break;case"s":{const y=Math.floor(h),b=Math.floor(y/u)*u;h=y===b?Math.max(0,b-u):b;break}case"w":{const y=Math.floor(h),g=Math.floor(y/u)*u+u;h=Math.min(c,g);break}default:return}l.preventDefault(),t(h)},s=async l=>{e.isActive()&&(await e.pause(),ei=!0),mt=!0,r(l)},a=l=>{mt&&r(l)},o=l=>{mt&&(r(l),mt=!1,ei&&(e.resume(),ei=!1))};return ee.addEventListener("mousedown",l=>void s(l)),window.addEventListener("mousemove",a),window.addEventListener("mouseup",o),window.addEventListener("keydown",n),{detach:()=>{ee==null||ee.removeEventListener("mousedown",s),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",o),window.removeEventListener("keydown",n)},refreshUI:()=>{}}}function Or(){const i=K();for(const e of i){const t=e.matrix;if(!t)continue;const r=t.getInteractionStore();if(r.hasSelection())return{sequencerId:e.id,selectedNotes:r.getSelectedNotes()}}return null}function zd(i){const e=()=>{const o=W(),l=Or();if(!l||l.selectedNotes.length===0){o.showError("No notes selected. Please select notes before adjusting velocity.");return}i.velocity.show(l.selectedNotes)},t=o=>{var u;if(o.key.toLowerCase()!=="v"||o.ctrlKey||o.metaKey||o.altKey)return;const l=(u=document.activeElement)==null?void 0:u.tagName,d=l==="INPUT"||l==="TEXTAREA",c=Ne();d||c||(o.preventDefault(),e())},r=o=>{o.type==="keydown"&&o.ctrlKey&&!Ve()&&Ui(!0),o.type==="keyup"&&o.key==="Control"&&Ve()&&Ui(!1)},n=o=>{t(o),r(o)},s=o=>{r(o)},a=o=>{const{editorId:l}=o.detail;l==="velocity-tool"&&e()};return window.addEventListener("keydown",n),window.addEventListener("keyup",s),document.body.addEventListener("editor-invoke",a),{detach:()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",s),document.body.removeEventListener("editor-invoke",a)},refreshUI:()=>{}}}let je=null;function ms(i,e){const t=ce(),r=window.devicePixelRatio||1,n=e/r;function s(){if(!i.isActive())return;const a=i.getCurrentBeat(),o=a/t*n;It(o),Fr(i,a),je=requestAnimationFrame(s)}ui(),je=requestAnimationFrame(s)}function ui(){je!==null&&(cancelAnimationFrame(je),je=null)}function Jd(i){var e;It(0);for(const t of i.sequencers)(e=t.matrix)==null||e.setPlayheadPixelX(0)}class Wd{constructor(){this.onStop=null,this.engine=H.getInstance(),this.playheadCanvasWidth=300,this.engine.setOnResumeCallback(()=>{ms(this.engine,this.playheadCanvasWidth)}),this.engine.setOnStopCallback(()=>{var e;(e=this.onStop)==null||e.call(this)})}play(){this.engine.start(),ms(this.engine,this.playheadCanvasWidth)}stop(){this.engine.stop(),ui(),Jd(this.engine)}setOnStopCallback(e){this.onStop=e}async pause(){await this.engine.pause(),ui()}async resume(){await this.engine.resume()}toggle(){this.engine.isActive()?this.pause():this.resume()}isPlaying(){return this.engine.isActive()}getEngine(){return this.engine}setSequencers(e){this.engine.setSequencers(e)}setPlayheadCanvasWidth(e){this.playheadCanvasWidth=e}}function jd(){const i=me("💾 Export"),e=U({id:"export-json",text:"Save Project",kind:"primary"}),t=m("div",{class:"h-px bg-gray-600"}),r=U({id:"export-wav",text:"Export as WAV",kind:"secondary",additionalClasses:"bg-green-600 hover:bg-green-700"}),n=U({id:"export-midi",text:"Export as MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),s=m("button",{id:"drag-midi",draggable:"true",class:["drag-midi-btn","cursor-grab select-none","px-2 py-1 rounded w-8 flex items-center justify-center","transition-transform transition-opacity duration-150","hover:scale-105 hover:brightness-110 active:cursor-grabbing","bg-yellow-700 hover:bg-yellow-600 text-white","border border-yellow-500"].join(" "),title:"Drag entire song as MIDI file to Desktop"},"🎵"),a=m("div",{class:"flex items-center gap-2"},n,s),o=U({id:"export-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),l=m("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,r,a);return{root:te("export-modal",[i,l,o]),dragMidiBtn:s}}let Pr=0;function Xd(i,e){const t=Pr++,r={id:t,...at},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",s=new ur(null,r,i,i.destination,n,!0,t);return s.id=t,s.colorIndex=t,s.mute=!1,s.solo=!1,s.volume=e.volume??100/127,s.pan=e.pan??0,e.notes&&s.matrix&&s.matrix.setNotes(e.notes),s.setState({notes:e.notes,config:e.config||{},instrument:e.instrument,volume:e.volume,pan:e.pan}),s.initInstrument(),s}function Vd(){Pr=0}function Yd(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=i.tempo,t=i.timeSignature[0],r=i.totalMeasures,n=i.songKey,s={v:3,t:new Date().toISOString(),c:{b:e,bpm:t,tm:r,sk:n},i:i.sequencers.map(o=>o.instrument||"sf2/fluidr3-gm/acoustic_grand_piano"),vlm:i.sequencers.map(o=>o.volume??100/127),pan:i.sequencers.map(o=>o.pan??0),tr:i.sequencers.map(o=>({n:o.notes.map(l=>[l.pitch,l.start,l.duration,l.velocity??100])}))},a=new Blob([JSON.stringify(s)],{type:"application/json"});return{url:URL.createObjectURL(a),filename:`session-${Date.now()}.json`}}async function Zd(i,e={sampleRate:44100,includePan:!0}){if(!i.tracks||i.tracks.length===0)throw new Error("No tracks to export.");const t=e.sampleRate,r=e.includePan?2:1,n=new AbortController;let s=!1;$e("Exporting Session","Rendering your session offline...",()=>{s=!0,n.abort()},!0);try{const o=60/de(),l=Math.max(...i.tracks.flatMap(y=>y.notes.map(b=>(b.start+b.duration)*o+.2))),d=new OfflineAudioContext(r,Math.ceil(t*l),t);Vd();for(const y of i.tracks)if(s||(await Xd(d,y).exportToOffline(n.signal,y.notes),s))return;if(s)return;$e("Rendering Audio","Rendering audio buffer…",void 0,!0);const c=await d.startRendering();$e("Converting to WAV","Converting to WAV format…",void 0,!0);const u=Qd(c);$e("Downloading WAV","Please wait...",void 0,!0);const h=URL.createObjectURL(u),f=document.createElement("a");f.href=h,f.download=`session-${Date.now()}.wav`,f.click(),URL.revokeObjectURL(h)}catch(a){s?console.warn("Export operation was cancelled by the user."):console.error("Error during export:",a)}finally{fi(!0)}}function Qd(i){const e=i.numberOfChannels,t=i.length*e*2,r=new DataView(new ArrayBuffer(44+t)),n=(a,o)=>{for(let l=0;l<o.length;l++)r.setUint8(a+l,o.charCodeAt(l))};n(0,"RIFF"),r.setUint32(4,36+t,!0),n(8,"WAVE"),n(12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,e,!0),r.setUint32(24,i.sampleRate,!0),r.setUint32(28,i.sampleRate*e*2,!0),r.setUint16(32,e*2,!0),r.setUint16(34,16,!0),n(36,"data"),r.setUint32(40,t,!0);let s=44;for(let a=0;a<i.length;a++)for(let o=0;o<e;o++){const l=i.getChannelData(o)[a],d=Math.max(-1,Math.min(1,l));r.setInt16(s,d*32767,!0),s+=2}return new Blob([r.buffer],{type:"audio/wav"})}async function eu(i){var l,d,c,u;const e=await i.text();let t;try{t=JSON.parse(e)}catch{throw new Error("Invalid JSON format.")}if(!Array.isArray(t.tr))throw new Error("Missing or invalid `tr` (tracks) array.");const r={bpm:((l=t.c)==null?void 0:l.b)??120,beatsPerMeasure:((d=t.c)==null?void 0:d.bpm)??4,totalMeasures:((c=t.c)==null?void 0:c.tm)??8,songKey:((u=t.c)==null?void 0:u.sk)??"CM"},n=Array.isArray(t.i)?t.i:[],s=Array.isArray(t.vlm)?t.vlm:[],a=Array.isArray(t.pan)?t.pan:[],o=t.tr.map((h,f)=>{if(!Array.isArray(h.n))throw new Error(`Track ${f} missing \`n\` (notes) array.`);const y=h.n.map(([v,S,_,C])=>({pitch:v,start:S,duration:_,velocity:C??100})),b=n[f]||"sf2/fluidr3-gm/acoustic_grand_piano",g=s[f],p=a[f];return{notes:y,instrument:b,volume:typeof g=="number"?g:void 0,pan:typeof p=="number"?p:void 0,config:{}}});return{globalConfig:r,tracks:o}}async function tu(i){var f;const e=await i.arrayBuffer(),t=new wi.Midi(e),r=t.header.tempos[0],n=t.header.timeSignatures[0],s=(r==null?void 0:r.bpm)??120,a=((f=n==null?void 0:n.timeSignature)==null?void 0:f[0])??4,l=Math.max(0,...t.tracks.flatMap(y=>y.notes.map(b=>b.time+b.duration)))*(s/60),d=Math.ceil(l/a)||8,c={bpm:s,beatsPerMeasure:a,totalMeasures:d,songKey:"CM"},u=await Dn(),h=t.tracks.map(y=>{const b=y.notes.map(N=>({pitch:N.name,start:N.time*(s/60),duration:N.duration*(s/60),velocity:Math.max(1,Math.min(127,Math.round(N.velocity*127)))}));let g=y.instrument.number;(g===void 0||g===0)&&(g=y.channel===9?0:y.channel%128);const p=y.controlChanges[7]||[],v=y.controlChanges[10]||[],S=p.length>0?p[0].value:void 0,_=v.length>0?v[0].value*2-1:void 0;let C;if(y.channel===9){const N=Yn(g);N?C=`webaudiofont/${N.library}/${N.displayName}`:C=`sf2/drummachines/${u.includes("LM-2")?"LM-2":u[0]??"TR-808"}`}else C=`sf2/fluidr3-gm/${_r[g]||"acoustic_grand_piano"}`;return{notes:b,instrument:C,volume:S,pan:_,config:{}}});return{globalConfig:c,tracks:h}}function ys(i,e){const t=H.getInstance();t.isActive()&&t.pause(),ki(e.bpm),Gi(e.beatsPerMeasure),Bi(e.totalMeasures),xr(e.songKey);const r=document.getElementById("tempo-input");r&&(r.value=String(de()));const n=document.getElementById("measures-input");n&&(n.value=String(Ei())),al();for(const[o,l]of i.entries()){const d=o,c=l.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",u=l.notes||[],h=l.volume,f=l.pan;I({type:"CREATE_SEQUENCER",id:d,instrument:c,notes:structuredClone(u),volume:h,pan:f,config:{...l.config||{}}},Mi(d))}I(xi("Session Loaded"),Nr("Session Loaded"));const s=K();Va();const a=document.getElementById("global-mini-contour");a&&Pc(a,s),It(0)}class Oe{static async save(e){const t=D();if(e==="json"){const{url:r,filename:n}=Yd(t);Oe.download(r,n)}else if(e==="midi"){const{url:r,filename:n}=await $l(t);Oe.download(r,n)}else throw new Error("Unsupported export format.")}static async saveWavWithOptions(e){const t=D(),r=K();try{const n={globalConfig:{bpm:t.tempo,beatsPerMeasure:t.timeSignature[0],totalMeasures:t.totalMeasures,songKey:t.songKey},tracks:r.map(s=>({notes:s.notes,instrument:s.instrumentName,config:s.config,volume:s.volume,pan:s.pan}))};await Zd(n,e)}catch(n){alert("Failed to export WAV: "+(n instanceof Error?n.message:"Unknown error"))}}static async load(e){var t;try{const r=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();if(r==="json"){const{tracks:n,globalConfig:s}=await eu(e);ys(n,s)}else if(r==="mid"||r==="midi"){const{tracks:n,globalConfig:s}=await tu(e);ys(n,s)}else throw new Error("Unsupported file type.")}catch(r){alert("Failed to load file: "+(r.message||"Unknown error"))}}static download(e,t){const r=document.createElement("a");r.href=e,r.download=t,r.click(),URL.revokeObjectURL(e)}}function iu(i,e,t){const r=i.querySelector("#export-cancel"),n=i.querySelector("#export-json"),s=i.querySelector("#export-wav"),a=i.querySelector("#export-midi");let o=null;const l=()=>{i.classList.add("hidden")},d=async h=>{h==="wav"?(l(),t()):(await Oe.save(h),l())};r==null||r.addEventListener("click",l),n==null||n.addEventListener("click",()=>d("json")),s==null||s.addEventListener("click",()=>d("wav")),a==null||a.addEventListener("click",()=>d("midi"));const c=h=>{e.classList.add("dragging"),o=vr(h,K())},u=()=>{e.classList.remove("dragging"),o&&(o(),o=null)};return e.addEventListener("dragstart",c),e.addEventListener("dragend",u),{detach:()=>{r==null||r.removeEventListener("click",l),n==null||n.removeEventListener("click",()=>d("json")),s==null||s.removeEventListener("click",()=>d("wav")),a==null||a.removeEventListener("click",()=>d("midi")),e.removeEventListener("dragstart",c),e.removeEventListener("dragend",u)},refreshUI:()=>{}}}class su{constructor(e){this.detachFn=null;const{root:t,dragMidiBtn:r}=jd();this.modal=t,document.body.appendChild(this.modal);const n=iu(this.modal,r,e);this.detachFn=n.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function ru({id:i,label:e,options:t}){const r=O(),n=m("select",{id:i,class:["w-[80px] h-[40px] text-sm font-semibold rounded px-2 cursor-pointer",r.surfaceBackground,r.textColor,r.borderColor].join(" ")},...t.map(s=>m("option",{value:s.value},s.label)));return e?m("div",{class:"flex flex-col items-start gap-1"},Y(e),n):n}class nu{constructor(){const e=O();this.sampleRateSelect=ru({id:"save-wav-sample-rate",options:[{value:"44100",label:"44,100 Hz (CD Quality)"},{value:"32000",label:"32,000 Hz"},{value:"22050",label:"22,050 Hz (Faster Export)"}]}),this.includePanCheckbox=m("input",{id:"save-wav-include-pan",type:"checkbox",checked:!0,class:"accent-purple-500"}),this.cancelButton=U({id:"save-wav-options-cancel-btn",text:"Cancel",kind:"secondary"}),this.applyButton=U({id:"save-wav-options-apply-btn",text:"Export",kind:"primary"});const t=[me("Export Settings"),V("Choose your WAV export parameters."),m("div",{class:"z-10 mb-4 w-full"},Y({text:"Sample Rate",for:"save-wav-sample-rate"}),this.sampleRateSelect),m("div",{class:"z-10 mb-6"},m("label",{class:`flex items-center gap-2 text-sm ${e.textColor}`},this.includePanCheckbox,"Include Panning in Export")),m("div",{class:"flex justify-end gap-4 z-10"},this.cancelButton,this.applyButton)];this.modalEl=te("save-wav-options-modal",t,{sizePreset:"md"}),document.body.appendChild(this.modalEl),this.attachListeners()}attachListeners(){this.cancelButton.addEventListener("click",()=>this.hide()),this.applyButton.addEventListener("click",()=>{const e=parseInt(this.sampleRateSelect.value,10),t=this.includePanCheckbox.checked;this.hide(),Oe.saveWavWithOptions({sampleRate:e,includePan:t})})}show(){this.modalEl.classList.remove("hidden")}hide(){this.modalEl.classList.add("hidden")}destroy(){this.modalEl.remove()}}function au(){const i=me("📁 Load Project"),e=U({id:"import-json",text:"Load Project",kind:"primary"}),t=m("div",{class:"h-px bg-gray-600"}),r=U({id:"import-midi",text:"Import MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),n=U({id:"import-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),s=m("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,r);return te("import-modal",[i,s,n])}function ou(i){const e=i.querySelector("#import-cancel"),t=i.querySelector("#import-json"),r=i.querySelector("#import-midi"),n=()=>{i.classList.add("hidden")},s=async l=>{const d=document.createElement("input");d.type="file",d.accept=l.join(","),d.onchange=async()=>{var c;(c=d.files)!=null&&c[0]&&(await Oe.load(d.files[0]),n())},d.click()},a=()=>s([".json"]),o=()=>s([".mid",".midi"]);return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",a),r==null||r.addEventListener("click",o),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",a),r==null||r.removeEventListener("click",o)},refreshUI:()=>{}}}class lu{constructor(){this.detachFn=null,this.modal=au(),document.body.appendChild(this.modal);const e=ou(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function cu(){const i=m("h2",{class:"text-xl font-semibold mb-2 z-10 text-center",textContent:"Adjust Velocity"}),e=m("p",{class:"text-sm text-gray-400 mb-4 text-center z-10",textContent:"Apply a velocity transformation to the selected notes."}),t=m("input",{id:"velocity-set-toggle",type:"checkbox",class:"accent-purple-500",checked:!0}),r=m("label",{class:"flex items-center gap-2 text-sm mb-2"},t,"Set base velocity to"),n=m("select",{id:"velocity-action-select",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},m("option",{value:"set"},"Set Velocity To"),m("option",{value:"increase"},"Increase Velocity By"),m("option",{value:"decrease"},"Decrease Velocity By")),s=m("input",{id:"velocity-value-input",type:"number",value:"100",min:"1",max:"127",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),a=m("div",{id:"velocity-set-fields",class:"flex items-center gap-3"},n,s),o=m("div",{class:"z-10 mb-4"},r,a),l=m("input",{id:"velocity-ramp-toggle",type:"checkbox",class:"accent-purple-500"}),d=m("label",{class:"flex items-center gap-2 text-sm mb-2"},l,"Enable velocity ramp"),c=m("select",{id:"velocity-ramp-direction",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},m("option",{value:"up"},"Ramp Up"),m("option",{value:"down"},"Ramp Down")),u=m("input",{id:"velocity-ramp-amount",type:"number",value:"10",min:"1",max:"127",placeholder:"Δ per note",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),h=m("div",{class:"flex items-center gap-2 mb-4 text-sm text-gray-300"},m("label",{class:"flex items-center gap-1"},m("input",{type:"radio",name:"ramp-mode",value:"linear",checked:!0,class:"accent-purple-500"}),"Linear"),m("label",{class:"flex items-center gap-1"},m("input",{type:"radio",name:"ramp-mode",value:"exponential",class:"accent-purple-500"}),"Exponential")),f=m("div",{id:"velocity-ramp-fields",class:"opacity-50 pointer-events-none"},m("div",{class:"flex items-center gap-3 mb-2"},c,u),h),y=m("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},d,f),b=m("input",{id:"velocity-randomize-toggle",type:"checkbox",class:"accent-purple-500"}),g=m("label",{class:"flex items-center gap-2 text-sm mb-2"},b,"Add random variation"),p=m("input",{id:"velocity-random-range",type:"number",value:"5",min:"1",max:"64",class:"w-[80px] bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm focus:outline-none focus:border-purple-500"}),v=m("div",{id:"velocity-random-fields",class:"flex items-center gap-2 text-sm text-gray-300 opacity-50 pointer-events-none"},m("span",{textContent:"±"}),p),S=m("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},g,v),_=m("div",{id:"velocity-preview-summary",class:"mt-6 text-sm text-gray-400 text-center z-10"}),C=U({id:"velocity-apply-btn",text:"Apply",kind:"primary"}),N=U({id:"velocity-cancel-btn",text:"Cancel",kind:"tertiary"}),w=m("div",{class:"flex gap-3 mt-6 z-10"},C,N);return te("velocity-modal",[i,e,o,y,S,_,w])}function du(i){const e=Or();if(!e){console.warn("No active note selection to apply velocity changes.");return}const{sequencerId:t,selectedNotes:r}=e;if(r.length===0){console.warn("No notes selected in the active sequencer.");return}const n=K().find(p=>p.id===t);if(!(n!=null&&n.matrix)){console.warn(`Could not find matrix for sequencer ID ${t}.`);return}const s=r.map(p=>({...p})),{mode:a,value:o,rampDirection:l="none",rampAmount:d=0,rampMode:c="linear",randomize:u=!1,randomRange:h=0}=i,f=r.map((p,v)=>({note:p,originalIndex:v}));f.sort((p,v)=>p.note.start-v.note.start);const y=new Map;for(const p of f){const v=p.note.start;y.has(v)||y.set(v,[]),y.get(v).push(p)}Array.from(y.entries()).sort((p,v)=>p[0]-v[0]).map(([,p])=>p).forEach((p,v)=>{let S=c==="linear"?v:Math.pow(v,1.3),_=d*S;l==="down"&&(_=-_);for(const{note:C}of p){let N;switch(a){case"set":N=Math.max(1,o);break;case"increase":N=(C.velocity??100)+o;break;case"decrease":N=(C.velocity??100)-o;break;case"none":default:N=C.velocity??100;break}let w=N+_;if(u&&h>0){const L=(Math.random()*2-1)*h;w+=L}C.velocity=Math.max(1,Math.min(127,Math.round(w)))}});const g=f.sort((p,v)=>p.originalIndex-v.originalIndex).map(({note:p})=>({...p}));I(lc(t,g),cc(t,s))}function uu(i){const e=document.getElementById("velocity-modal");e&&e.classList.remove("hidden")}function ti(){const i=document.getElementById("velocity-modal");i&&i.classList.add("hidden")}function hu(i){var f;const e=i.querySelector("#velocity-apply-btn"),t=i.querySelector("#velocity-cancel-btn"),r=i.querySelector("#velocity-set-toggle"),n=((f=i.querySelector("#velocity-action-select"))==null?void 0:f.parentElement)??null,s=i.querySelector("#velocity-ramp-toggle"),a=i.querySelector("#velocity-ramp-fields"),o=i.querySelector("#velocity-randomize-toggle"),l=i.querySelector("#velocity-random-fields");function d(y,b){if(!y||!b)return;const g=y.checked;b.classList.toggle("opacity-50",!g),b.classList.toggle("pointer-events-none",!g)}function c(){r==null||r.addEventListener("change",()=>d(r,n)),s==null||s.addEventListener("change",()=>d(s,a)),o==null||o.addEventListener("change",()=>d(o,l)),d(r,n),d(s,a),d(o,l)}function u(){var L,G,E,M,x,B;const y=(r==null?void 0:r.checked)??!0,b=(s==null?void 0:s.checked)??!1,g=(o==null?void 0:o.checked)??!1,p=y?(L=i.querySelector("#velocity-action-select"))==null?void 0:L.value:"none",v=parseInt(((G=i.querySelector("#velocity-value-input"))==null?void 0:G.value)??"",10),S=isNaN(v)?100:Math.max(1,Math.min(127,v)),_=b?(E=i.querySelector("#velocity-ramp-direction"))==null?void 0:E.value:"none",C=b?parseInt(((M=i.querySelector("#velocity-ramp-amount"))==null?void 0:M.value)??"0",10):0,N=b?(x=i.querySelector('input[name="ramp-mode"]:checked'))==null?void 0:x.value:"linear",w=g?parseInt(((B=i.querySelector("#velocity-random-range"))==null?void 0:B.value)??"0",10):0;du({mode:p,value:S,rampDirection:_,rampAmount:C,rampMode:N,randomize:g,randomRange:w}),ti()}const h=()=>{t==null||t.removeEventListener("click",ti),e==null||e.removeEventListener("click",u),r==null||r.removeEventListener("change",()=>d(r,n)),s==null||s.removeEventListener("change",()=>d(s,a)),o==null||o.removeEventListener("change",()=>d(o,l))};return t==null||t.addEventListener("click",ti),e==null||e.addEventListener("click",u),c(),{detach:h,refreshUI:()=>{}}}class fu{constructor(){this.detachFn=null,this.modal=cu(),document.body.appendChild(this.modal);const e=hu(this.modal);this.detachFn=e.detach}show(e){uu()}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}const pu="v0.1.1",mu="May 13, 2025",yu=["✨ New Features","- 🤖 Added AI Autocomplete for seamless melody continuation (OpenAI API Key required; more AI features rolling out soon)","- 🎨 Improved skin system with expanded customization options (available in User Settings)","- 🐛 Fixed numerous bugs and polished UI behavior for a smoother experience","🐞 Known Issues","- 🚫 Note placement during live playback of large sequences causes performance issues","🛣️ Roadmap","- 🤖 Continous enhancing and implementation of AI features"];function gu(){const i=Y({text:`${pu} — Updated ${mu}`});i.id="whats-new-metadata",i.classList.add("italic","text-gray-400","text-center","self-center","mb-4");const e=m("ul",{id:"whats-new-content",class:"list-disc list-inside text-left space-y-2 text-md w-full"});let t=null;for(const a of yu)if(a.startsWith("✨")||a.startsWith("🐞")||a.startsWith("🛣️")){const o=m("li",{class:"font-bold mt-6 text-lg",textContent:a});e.appendChild(o),t=m("ul",{class:"list-disc list-inside ml-6 mt-2 space-y-1"}),e.appendChild(t)}else if(t){const o=m("li",{textContent:a.replace(/^- /,"")});t.appendChild(o)}const r=m("img",{src:ie("static/logo.png"),alt:"Sequenzia",class:"w-[180px] h-auto rounded-xl mb-6 self-center"}),n=U({id:"whats-new-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"}),s=me({text:"🆕 What's New in Sequenzia",size:"xl",additionalClasses:"text-center self-center"});return te("whats-new-modal",[r,s,i,e,n],{sizePreset:"xl"})}function _u(i){const e=i.querySelector("#whats-new-close-btn"),t=()=>{i.style.opacity="0",i.style.transition="opacity 0.4s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},400)};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class bu{constructor(){this.detachFn=null,this.modal=gu(),document.body.appendChild(this.modal);const e=_u(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.style.opacity="0",this.modal.style.transition="opacity 0.4s ease-out",setTimeout(()=>{this.modal.classList.add("hidden"),this.modal.style.opacity="1"},400)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class vu{constructor(e,t){this.contour=null,this.miniCanvas=null,this.sideButtons=null,this.detachFns=[],this.refreshFns=[],this.engine=e,this.userConfigModalController=t,this.playbackService=new Wd,this.initializeUI()}initializeUI(){this.controls=new Wc,this.wavOptionsModal=new nu,this.saveModal=new su(()=>this.wavOptionsModal.show()),this.loadModal=new lu,this.velocityModal=new fu,this.whatsNewModal=new bu;const e=Xc(),t=nd(),r=hd(),n=ad();this.controls.getGlobalPlayheadRow().appendChild(e),this.controls.getGlobalToolsRow().appendChild(t.element),this.controls.getGlobalTransportRow().appendChild(r.element);const s=document.getElementById("footer-main");s&&s.appendChild(n),this.miniCanvas=this.getGlobalMiniContourCanvas(),this.sideButtons=n,this.contour=e;const a=md(e),o=Ud({rootElement:t.element,noteOptionsGroup:t.noteOptionsGroup,aiOptionsGroup:t.aiOptionsGroup}),l=qd(r.element,this.playbackService,this.userConfigModalController,this.saveModal,this.loadModal),d=Dd(n,this.whatsNewModal),c=$d(this.controls.getGlobalPlayheadRow()),u=zd({velocity:this.velocityModal});this.detachFns=[a.detach,o.detach,l.detach,d.detach,c.detach,u.detach,t.refreshGridSettings],this.refreshFns=[a.refreshUI,o.refreshUI,l.refreshUI,d.refreshUI,c.refreshUI,u.refreshUI,r.refreshToggles],Ss(),this.initPlayhead()}initPlayhead(){if(!this.contour)return;const e=this.contour.querySelector("#global-mini-playhead");e&&(Kd(e),this.playbackService.setPlayheadCanvasWidth(e.width))}getPlaybackService(){return this.playbackService}getGlobalMiniContourCanvas(){var e;return((e=this.contour)==null?void 0:e.querySelector("#global-mini-contour"))??null}show(){this.refreshFns.forEach(e=>e()),this.controls.render().classList.remove("hidden")}hide(){this.controls.render().classList.add("hidden")}destroy(){var e,t,r,n,s,a;this.detachFns.forEach(o=>o()),this.controls.destroy(),(e=this.sideButtons)!=null&&e.parentNode&&this.sideButtons.parentNode.removeChild(this.sideButtons),this.sideButtons=null,(t=this.wavOptionsModal)==null||t.destroy(),(r=this.saveModal)==null||r.destroy(),(n=this.loadModal)==null||n.destroy(),(s=this.velocityModal)==null||s.destroy(),(a=this.whatsNewModal)==null||a.destroy()}reload(){this.destroy(),this.initializeUI()}}function Su(i,e){window.addEventListener("keydown",t=>{const r=(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="z",n=(t.ctrlKey||t.metaKey)&&(t.key.toLowerCase()==="y"||t.shiftKey&&t.key.toLowerCase()==="z");if(!r&&!n)return;t.preventDefault(),t.target instanceof HTMLElement&&t.target.matches('input, textarea, [contenteditable="true"]')||(r?i():e())},{capture:!0})}function Cu(){const i=m("canvas",{id:"waveform",width:1260,height:100,class:"rounded border border-purple-800 bg-gray-900"}),e=m("button",{id:"visualizer-mode",class:"side-button side-button-primary",title:"Change visualizer mode",textContent:"📊"}),t=m("div",{class:"flex flex-col gap-2"},e),r=m("div",{class:"flex items-start gap-2"},i,t),n=document.getElementById("visualizer-container");return n&&n.appendChild(r),r}function Nu(i,e){const t=e.getContext("2d");if(!t)throw new Error("Canvas 2D context not available");const r=e.width,n=e.height,s=new Uint8Array(i.fftSize),a=new Uint8Array(i.frequencyBinCount),o=document.createElement("canvas");o.width=r,o.height=n;const l=o.getContext("2d");if(!l)throw new Error("Offscreen canvas 2D context not available");let d="frequency";function c(){if(!t)return;i.getByteTimeDomainData(s),t.fillStyle="#000",t.fillRect(0,0,r,n),t.lineWidth=2,t.strokeStyle="#00ffcc",t.beginPath();const y=r/s.length;let b=0;for(let g=0;g<s.length;g++){const v=s[g]/128*n/2;g===0?t.moveTo(b,v):t.lineTo(b,v),b+=y}t.lineTo(r,n/2),t.stroke()}function u(){if(i.getByteFrequencyData(a),!t)return;t.fillStyle="#000",t.fillRect(0,0,r,n),t.fillStyle="rgba(255,255,255,0.2)",t.fillRect(0,0,1,n),t.fillRect(r-1,0,1,n);const y=128,b=2,g=[];for(let p=0;p<y;p++)g.push(p*r/(y-1));g[g.length-1]=r-1;for(let p=0;p<y;p++){const v=g[p],S=p<y-1?g[p+1]:r,_=Math.max(1,S-v-b),C=20,N=2e4,w=p/(y-1),L=C*Math.pow(N/C,w),E=Math.min(a.length-1,Math.floor(L/22050*a.length)),M=a[E]/255,x=Math.max(1,M*n),B=240-w*240;t.fillStyle=`hsl(${B}, ${80+M*20}%, ${40+M*40}%)`,t.fillRect(v,n-x,_,x)}}function h(){if(i.getByteFrequencyData(a),!l)return;o.initialized||(l.fillStyle="#000",l.fillRect(0,0,r,n),o.initialized=!0),l.drawImage(o,-1,0),l.fillStyle="#000",l.fillRect(r-1,0,1,n);const y=128,b=20,g=2e4;for(let p=0;p<y;p++){const v=p/(y-1),S=b*Math.pow(g/b,v),C=Math.min(a.length-1,Math.floor(S/22050*a.length)),N=a[C]/255,w=n-1-Math.floor(p*n/y);if(N<.05)continue;const L=Math.floor(N*255),G=Math.floor(N*(255-v*200)),E=Math.floor(N*(100+v*155));l.fillStyle=`rgb(${L}, ${G}, ${E})`,l.fillRect(r-1,w,1,1)}t&&(t.fillStyle="#000",t.fillRect(0,0,r,n),t.drawImage(o,0,0))}function f(){switch(requestAnimationFrame(f),d){case"frequency":u();break;case"spectrogram":h();break;case"waveform":default:c()}}return f(),{setMode(y){["waveform","frequency","spectrogram"].includes(y)&&(d=y,t.clearRect(0,0,r,n),d==="spectrogram"&&l.clearRect(0,0,r,n))}}}function wu(i){const e=i.querySelector("#waveform"),t=i.querySelector("#visualizer-mode");if(!e||!t)return console.warn("Visualizer setup failed: missing canvas or button"),{detach:()=>{},refreshUI:()=>{}};const r=Nu(Fs(),e),n=[{name:"waveform",emoji:"🌊"},{name:"frequency",emoji:"📊"},{name:"spectrogram",emoji:"🌈"}];let s=0;function a(){if(!t)return;s=(s+1)%n.length;const{name:o,emoji:l}=n[s];r.setMode(o),t.textContent=l,t.title=`Mode: ${o}`}return t.addEventListener("click",a),a(),{detach:()=>{t.removeEventListener("click",a)},refreshUI:()=>{t.textContent=n[s].emoji,t.title=`Mode: ${n[s].name}`}}}class Mu{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=Cu();const e=wu(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function xu(){const i=m("div",{id:"left-sidebutton-column",class:"absolute left-[-46px] flex flex-col gap-2 z-10"},m("button",{id:"piano-toggle-btn",class:"side-button side-button-info",title:"Toggle Piano View",textContent:"🎹"}),m("button",{id:"mixer-toggle-btn",class:"side-button side-button-info",title:"Toggle Mixer View",textContent:"🎛️"}),m("button",{id:"ai-toggle-btn",class:"side-button side-button-info",title:"Toggle AI View",textContent:"🤖"})),e=document.getElementById("top-controls-container");return e?e.appendChild(i):console.warn("[SideMenuUI] #top-controls-container not found."),i}function Lu(i){const e=i.querySelector("#piano-toggle-btn"),t=i.querySelector("#mixer-toggle-btn"),r=i.querySelector("#ai-toggle-btn"),n=()=>{W().showFeatureBlocked()},s=()=>{W().showFeatureBlocked()},a=()=>{W().showFeatureBlocked()};return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",s),r==null||r.addEventListener("click",a),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",s),r==null||r.removeEventListener("click",a)},refreshUI:()=>{}}}class ku{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=xu();const e=Lu(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function Gu(){const i=m("canvas",{id:"piano",width:1260,height:200,class:"rounded shadow-lg border border-purple-700"}),e=m("button",{id:"octave-up",class:"side-button side-button-primary",title:"Octave Up"},T("icon-arrow-up","Octave Up")),t=m("button",{id:"octave-down",class:"side-button side-button-primary",title:"Octave Down"},T("icon-arrow-down","Octave Down")),r=m("button",{id:"global-instrument-select-btn",class:"side-button side-button-primary",title:"Select Instrument"},T("icon-list-instrument","Instrument")),n=m("button",{id:"disable-keyboard-inputs",class:"side-button side-button-secondary",title:"Toggle Keyboard Input"},T("icon-keyboard","Keyboard Input")),s=m("div",{class:"flex flex-col gap-2"},e,t,r,n);return{wrapper:m("div",{class:"flex items-start gap-2"},i,s),canvas:i}}function gs(i,e){const t=parseInt(i.replace("#",""),16),r=Math.round(2.55*e),n=Math.max(0,Math.min(255,(t>>16)+r)),s=Math.max(0,Math.min(255,(t>>8&255)+r)),a=Math.max(0,Math.min(255,(t&255)+r));return`rgb(${n},${s},${a})`}function Qe(i,e,t=new Set,r=null){i.clearRect(0,0,i.canvas.width,i.canvas.height);const{whiteKeyColor:n,blackKeyColor:s}=O(),a={};if(r)for(const[o,l]of Object.entries(r))a[l]=o;for(const o of Object.values(e))if(!o.isBlack){const l=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(l.addColorStop(0,"#99cfff"),l.addColorStop(1,"#cce0ff")):(l.addColorStop(0,gs(n,-20)),l.addColorStop(1,n)),_s(i,{...o,fill:l,stroke:"#333",radius:6}),i.fillStyle="#333",i.font="12px sans-serif",i.textAlign="center",a[o.note]&&(i.fillStyle="#7c3aed",i.fillText(a[o.note],o.x+o.width/2,o.height-24),i.fillStyle="#333"),i.fillText(o.note,o.x+o.width/2,o.height-8)}for(const o of Object.values(e))if(o.isBlack){const l=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(l.addColorStop(0,"#3040ff"),l.addColorStop(1,"#4a60ff")):(l.addColorStop(0,gs(s,-20)),l.addColorStop(1,s)),_s(i,{...o,fill:l,stroke:"#000000",radius:4}),a[o.note]&&(i.fillStyle="#c084fc",i.font="10px sans-serif",i.textAlign="center",i.fillText(a[o.note],o.x+o.width/2,o.height-28))}}function _s(i,e){const{x:t,width:r,height:n,fill:s,stroke:a,radius:o=8}=e;i.beginPath(),i.moveTo(t,0),i.lineTo(t,n-o),i.quadraticCurveTo(t,n,t+o,n),i.lineTo(t+r-o,n),i.quadraticCurveTo(t+r,n,t+r,n-o),i.lineTo(t+r,0),i.closePath(),i.fillStyle=s,i.fill(),i.strokeStyle=a,i.lineWidth=1,i.stroke()}function Bu(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Map,r=new Set;let n=!1;function s(f,y){const b=Ee();for(const g of Object.values(b))if(g.isBlack&&f>=g.x&&f<=g.x+g.width&&y>=0&&y<=g.height)return g.note;for(const g of Object.values(b))if(!g.isBlack&&f>=g.x&&f<=g.x+g.width&&y>=0&&y<=g.height)return g.note;return null}function a(f){if(!f||r.has(f)||!e)return;const y=ga(f);y&&(t.set(f,y),r.add(f),Qe(e,Ee(),r,void 0))}function o(f){if(!r.has(f)||!e)return;const y=t.get(f);y&&(y.stop(),t.delete(f)),r.delete(f),Qe(e,Ee(),r,void 0)}function l(){for(const f of r)o(f)}const d=f=>{n=!0;const y=i.getBoundingClientRect(),b=f.clientX-y.left,g=f.clientY-y.top,p=s(b,g);a(p)},c=f=>{if(!n)return;const y=i.getBoundingClientRect(),b=f.clientX-y.left,g=f.clientY-y.top,p=s(b,g);a(p)},u=()=>{n=!1,l()},h=()=>{n=!1,l()};return i.addEventListener("mousedown",d),i.addEventListener("mousemove",c),i.addEventListener("mouseup",u),i.addEventListener("mouseleave",h),{detach:()=>{i.removeEventListener("mousedown",d),i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",u),i.removeEventListener("mouseleave",h)},refreshUI:()=>{}}}const Ur=[..."qwertyuiop[zxcvbnm,./"],Dr=["2","3","5","6","7","9","0","=","s","d","g","h","k","l",";"];function Eu(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Set,r=new Set,n=new Map;function s(){const c=Ee(),u=Object.values(c).filter(y=>!y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),h=Object.values(c).filter(y=>y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),f={};return Ur.forEach((y,b)=>{u[b]&&(f[y]=u[b])}),Dr.forEach((y,b)=>{h[b]&&(f[y]=h[b])}),f}function a(c){const u=s(),h=u[c];if(!(!h||t.has(c)||!e)){if(t.add(c),!r.has(h)){const f=Rs(h,100,ha());f&&(n.set(h,{stop:f}),r.add(h))}Qe(e,Ee(),r,u)}}function o(c){const u=s(),h=u[c];!h||!e||(t.delete(c),r.has(h)&&(ma(h),n.delete(h),r.delete(h)),Qe(e,Ee(),r,u))}const l=c=>{c.repeat||!Ne()||a(c.key)},d=c=>{Ne()&&o(c.key)};return window.addEventListener("keydown",l),window.addEventListener("keyup",d),{detach:()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",d)},refreshUI:()=>{}}}function bs(i,e){e?(i.classList.remove("side-button-secondary","side-button-primary"),i.classList.add("side-button-activated")):(i.classList.remove("side-button-activated"),i.classList.add("side-button-secondary"))}function Au(i){const e=Object.values(i).filter(n=>!n.isBlack).sort((n,s)=>n.x-s.x).map(n=>n.note),t=Object.values(i).filter(n=>n.isBlack).sort((n,s)=>n.x-s.x).map(n=>n.note),r={};return Ur.forEach((n,s)=>{e[s]&&(r[n]=e[s])}),Dr.forEach((n,s)=>{t[s]&&(r[n]=t[s])}),r}function Tu(i){const e=i.querySelector("#piano"),t=e==null?void 0:e.getContext("2d");if(!e||!t)throw new Error("Keyboard canvas not available");const r=i.querySelector("#octave-up"),n=i.querySelector("#octave-down"),s=i.querySelector("#disable-keyboard-inputs"),a=i.querySelector("#global-instrument-select-btn");function o(){if(!t)return;const h=qt(),f=As(h);pa(f),s&&bs(s,Ne());const y=Ne()?Au(f):null;Qe(t,f,new Set,y??void 0)}const l=()=>{const h=qt();h<7&&(Pi(h+1),o())},d=()=>{const h=qt();h>1&&(Pi(h-1),o())},c=()=>{const h=Ne();fa(!h),o(),s&&bs(s,!h)},u=()=>{const h=yi()||"sf2/fluidr3-gm/acoustic_grand_piano";Bt().showInstrumentSelectModal(null,h)};return r==null||r.addEventListener("click",l),n==null||n.addEventListener("click",d),s==null||s.addEventListener("click",c),a==null||a.addEventListener("click",u),{detach:()=>{r==null||r.removeEventListener("click",l),n==null||n.removeEventListener("click",d),s==null||s.removeEventListener("click",c),a==null||a.removeEventListener("click",u)},refreshUI:o}}class Iu{constructor(){this.detachFns=[],this.refreshFns=[];const{wrapper:e,canvas:t}=Gu();this.wrapper=e,this.canvas=t}render(){return this.wrapper}initialize(){da();const e=Bu(this.canvas),t=Eu(this.canvas),r=Tu(this.wrapper);this.detachFns=[e.detach,t.detach,r.detach],this.refreshFns=[e.refreshUI,t.refreshUI,r.refreshUI],this.refresh()}refresh(){this.refreshFns.forEach(e=>e())}hide(){this.wrapper.classList.add("hidden")}show(){this.wrapper.classList.remove("hidden"),this.refresh()}destroy(){this.detachFns.forEach(e=>e()),this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)}}class Ru{constructor(){this.activeMode="keyboard",this.activeElement=null,this.detachFns=[];const e=document.getElementById("top-controls-container");if(!e)throw new Error("#top-controls-container not found in DOM");this.container=e,this.initialize()}initialize(){this.sideMenuController=new ku,this.keyboardController=new Iu,this.setMode("keyboard")}setMode(e){if(this.activeElement){if(this.activeMode===e)return;this.container.removeChild(this.activeElement),this.activeElement=null}switch(this.activeMode=e,e){case"keyboard":this.activeElement=this.keyboardController.render(),this.container.appendChild(this.activeElement),this.keyboardController.initialize();break;case"ai":this.activeElement=this.createStub("AI View not implemented"),this.container.appendChild(this.activeElement);break;case"mixer":this.activeElement=this.createStub("Mixer View not implemented"),this.container.appendChild(this.activeElement);break}}getCurrentMode(){return this.activeMode}destroy(){var e,t,r;this.detachFns.forEach(n=>n()),this.detachFns=[],(e=this.sideMenuController)==null||e.destroy(),(t=this.keyboardController)==null||t.destroy(),((r=this.activeElement)==null?void 0:r.parentNode)===this.container&&this.container.removeChild(this.activeElement),this.activeElement=null}reload(){this.destroy(),this.initialize()}createStub(e){const t=document.createElement("div");return t.className="text-gray-400 text-sm p-4 border border-gray-600 rounded",t.textContent=e,t}}function Fu(i){return m("div",{class:"flex justify-between items-center mb-6 border-b border-purple-700 pb-2 z-10"},m("div",{class:"flex gap-4 text-xl select-none"},...i.map(e=>m("span",{class:["settings-tab","hover:text-white hover:scale-110 transition-all duration-150 cursor-pointer",e.isActive?"text-purple-500":"text-gray-300"].join(" "),dataset:{tab:e.key},title:e.title,textContent:e.icon}))))}class Ou{constructor(){this.globalSection=m("div",{id:"userconfig-global-settings",class:"settings-section z-10"}),this.themeSection=m("div",{id:"userconfig-theme-settings",class:"settings-section hidden z-10"}),this.aiSection=m("div",{id:"userconfig-ai-settings",class:"settings-section hidden z-10"});const e=Fu([{key:"global-settings",icon:"⚙️",title:"Global Settings",isActive:!0},{key:"theme-settings",icon:"🎹",title:"Theme Settings"},{key:"ai-settings",icon:"🤖",title:"AI Settings"}]);this.saveButton=U({id:"userconfig-save",text:"Save",kind:"primary"}),this.closeButton=U({id:"userconfig-close-bottom",text:"Cancel",kind:"secondary"});const t=m("div",{class:"flex gap-3 mt-4 z-10"},this.saveButton,this.closeButton);this.modal=te("userconfig-modal",[e,this.globalSection,this.themeSection,this.aiSection,t]),document.body.appendChild(this.modal)}render(){return this.modal}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){this.modal.remove()}getSectionContainer(e){switch(e){case"global":return this.globalSection;case"theme":return this.themeSection;case"ai":return this.aiSection}}getSaveButton(){return this.saveButton}getCloseButton(){return this.closeButton}getTabs(){return this.modal.querySelectorAll(".settings-tab")}getSections(){return this.modal.querySelectorAll(".settings-section")}}function Pu(){const{trigger:i,tooltip:e}=Te("tooltip-note-mode","?",[V(Be("Default Mode:")," gesture-based note placement. Allows click-and-drag selection and edit gestures."),V(Be("Express Mode:")," notes are placed immediately on mouse down. Holding allows drag-resizing. Right-click initiates multi-note selection.")]),t=we({id:"note-tool-toggle",label:"Note Placement:",stateA:"Classic",stateB:"Express",tooltipTrigger:i});t.input.addEventListener("change",()=>{const s=t.getChecked()?"express":"default";le({global:{noteToolMode:s}})});const r=()=>{const s=z().global.noteToolMode;t.setChecked(s==="express")};return{element:m("div",{},me("Global Settings"),t.element,e),refreshToggle:r}}const Uu=["Default","Blue Dream","Modern Light","Synthwave","Verdant Alloy","Sunset"],Du=["Darkroom","Seashell","Cyberpunk","Classic Blue","Midnight"],qu=["Track Color","Note Velocity","Pitch Class Contrast","Scriabin","Octave Bands"];function Ku(){const i=Du.map(r=>m("option",{value:r,textContent:r})),e=qu.map(r=>m("option",{value:r,textContent:r})),t=Uu.map(r=>m("option",{value:r,textContent:r}));return m("div",{},me("Theme Settings"),m("div",{className:"mb-6"},Y("Interface Skin"),m("select",{id:"skin-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...t)),m("div",{className:"mb-6"},Y("Grid Color Scheme"),m("select",{id:"grid-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i)),m("div",{className:"mb-6"},Y("Note Color Scheme"),m("select",{id:"note-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...e)))}const Hu=[{value:"gpt-4o",label:"gpt-4o"},{value:"gpt-4o-mini",label:"gpt-4o-mini"},{value:"gpt-4.1",label:"gpt-4.1"},{value:"gpt-4.1-mini",label:"gpt-4.1-mini"},{value:"o3-mini",label:"o3-mini"},{value:"o4-mini",label:"o4-mini",className:"bg-green-700 text-white"}];function $u(){const i=Hu.map(s=>m("option",{value:s.value,className:s.className,textContent:s.label})),{trigger:e,tooltip:t}=Te("tooltip-openai-key","?",["You must provide an OpenAI API key to use AI features.",V("Visit ",m("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",class:"text-blue-400 underline hover:text-blue-300"},"platform.openai.com")," to manage your key.")]),{trigger:r,tooltip:n}=Te("tooltip-openai-model","?",["Different models offer varying performance and response quality.",V("Models marked in ",m("span",{class:"text-green-400 font-semibold"},"green")," are recommended for best results."),"We will add support for new models as they become available."]);return m("div",{},me("AI Configuration"),m("div",{class:"mb-6"},Y("OpenAI API Key",e),m("input",{type:"password",id:"openai-key-input",placeholder:"sk-...",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500"}),t),m("div",{class:"mb-8"},Y("OpenAI Model",r),m("select",{id:"openai-model-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i),n))}function zu(i,e={}){const t=i.getTabs(),r=i.getSections(),n=i.getCloseButton(),s=i.getSaveButton(),a=c=>{r.forEach(h=>{h.classList.add("hidden")});const u=document.getElementById(`userconfig-${c}`);u&&u.classList.remove("hidden"),t.forEach(h=>{const f=h.dataset.tab===c;h.classList.toggle("text-purple-500",f),h.classList.toggle("opacity-100",f),h.classList.toggle("text-gray-300",!f),h.classList.toggle("opacity-50",!f)})},o=[];t.forEach(c=>{const u=c.dataset.tab;if(!u)return;const h=()=>a(u);c.addEventListener("click",h),o.push(()=>c.removeEventListener("click",h))});const l=()=>{var c;(c=e.onClose)==null||c.call(e),i.hide()},d=()=>{var u;(u=e.onSave)==null||u.call(e);const c=O();c.name,fe.getInstance().reloadAll(),i.hide()};return n.addEventListener("click",l),s.addEventListener("click",d),(()=>{const c=Array.from(t).find(u=>u.classList.contains("text-purple-500"));c!=null&&c.dataset.tab&&a(c.dataset.tab)})(),()=>{o.forEach(c=>c()),n.removeEventListener("click",l),s.removeEventListener("click",d)}}function Ju(i){const e=i.querySelector("#openai-key-input"),t=i.querySelector("#openai-model-select"),r=()=>{var o;const a=z();e&&(e.value=a.ai.openaiApiKey||""),t&&(t.value=a.ai.openaiModel||((o=t.options[0])==null?void 0:o.value)||"")},n=a=>{const o=a.target;le({ai:{openaiApiKey:o.value}})},s=a=>{const o=a.target;le({ai:{openaiModel:o.value}})};return e==null||e.addEventListener("input",n),t==null||t.addEventListener("change",s),r(),{detach:()=>{e==null||e.removeEventListener("input",n),t==null||t.removeEventListener("change",s)},refreshUI:r}}function Wu(i){const e=i.querySelector("#grid-color-select"),t=i.querySelector("#note-color-select"),r=i.querySelector("#skin-select"),n=()=>{var d,c,u;const l=z();e&&(e.value=l.theme.gridColorScheme||((d=e.options[0])==null?void 0:d.value)||""),t&&(t.value=l.theme.noteColorScheme||((c=t.options[0])==null?void 0:c.value)||""),r&&(r.value=l.theme.skin||((u=r.options[0])==null?void 0:u.value)||"")},s=l=>{const d=l.target;le({theme:{gridColorScheme:d.value}})},a=l=>{const d=l.target;le({theme:{noteColorScheme:d.value}})},o=l=>{const d=l.target;H.getInstance().stop(),le({theme:{skin:d.value}})};return e==null||e.addEventListener("change",s),t==null||t.addEventListener("change",a),r==null||r.addEventListener("change",o),n(),{detach:()=>{e==null||e.removeEventListener("change",s),t==null||t.removeEventListener("change",a),r==null||r.removeEventListener("change",o)},refreshUI:n}}function ju(i){const e=i.querySelector("#note-tool-toggle");if(!e)return console.warn("[GlobalSettings] Toggle input not found."),{detach:()=>{},refreshUI:()=>{}};const t=()=>{const n=z();e.checked=n.global.noteToolMode==="express"},r=n=>{const a=n.target.checked?"express":"default";le({global:{noteToolMode:a}}),K().forEach(o=>o.resetInteractionMode())};return e.addEventListener("change",r),t(),{detach:()=>e.removeEventListener("change",r),refreshUI:t}}class Xu{constructor(){this.modal=null,this.detachFns=[],this.refreshFns=[],this.initialSnapshot=structuredClone(z()),this.initializeUI()}initializeUI(){this.modal=new Ou;const e=Pu(),t=Ku(),r=$u();this.modal.getSectionContainer("global").appendChild(e.element),this.modal.getSectionContainer("theme").appendChild(t),this.modal.getSectionContainer("ai").appendChild(r);const n=zu(this.modal,{onSave:()=>Kc(),onClose:()=>le(this.initialSnapshot)}),s=ju(e.element),a=Wu(t),o=Ju(r);this.detachFns.push(n,s.detach,a.detach,o.detach),this.refreshFns.push(s.refreshUI,a.refreshUI,o.refreshUI,e.refreshToggle),Ss(),document.body.appendChild(this.modal.render())}show(){var e;this.initialSnapshot=structuredClone(z()),this.refreshFns.forEach(t=>t()),(e=this.modal)==null||e.show()}hide(){var e;(e=this.modal)==null||e.hide()}destroy(){var e;this.detachFns.forEach(t=>t()),(e=this.modal)==null||e.destroy(),this.modal=null,this.detachFns=[],this.refreshFns=[]}reload(){this.destroy(),this.initializeUI()}}function Vu(){document.getElementById("add-sequencer").addEventListener("click",()=>{const e=K().length;I(Cr(e,"sf2/fluidr3-gm/acoustic_grand_piano"),Mi(e))})}function Yu(){const i=W();i.showSplashScreen(),Hc(),Fc(),Oc(),H.initialize(K());const e=new Xu,t=Bt(),r=new Ru,n=new vu(Sc(),e),s=new Mu;n.show(),s.show();const a=fe.getInstance();a.registerReloadable(()=>s.reload()),a.registerReloadable(()=>r.reload()),a.registerReloadable(()=>e.reload()),a.registerReloadable(()=>n.reload()),a.registerReloadable(()=>i.reload()),a.registerReloadable(()=>t.reload()),Et(qc),A("Setting up additional UI..."),Su(pc,mc),Vu();const o=0;I(Cr(o,"sf2/fluidr3-gm/acoustic_grand_piano"),Mi(o)),I(xi("Initial App State"),Nr("Initial App State")),i.hideSplashScreen(),Cs("Sequenzia initialized"),A("Current state: ",D())}requestAnimationFrame(()=>{Yu()});
