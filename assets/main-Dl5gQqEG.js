const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/extendTracks-B5DZe7ih.js","assets/index-BfMGmNCr.js"])))=>i.map(i=>d[i]);
import{_ as $r}from"./index-BfMGmNCr.js";function Es(t){const e=t.startsWith("/")?t.substring(1):t;return(window.location.pathname.startsWith("/sequenzia")?"/sequenzia/":"./")+e}function Kr(){const t=document.getElementById("splash-modal"),e=document.getElementById("splash-logo");e&&(e.src=Es("static/logo.png")),t==null||t.classList.remove("hidden")}function Wr(t=1e3){const e=document.getElementById("splash-modal"),i=document.getElementById("footer-main"),s=document.getElementById("content-main");e&&setTimeout(()=>{e.style.opacity="0",e.style.transition="opacity 0.5s ease-out",setTimeout(()=>{e.classList.add("hidden"),e.style.opacity="1",i&&(i.classList.remove("content-hidden"),i.classList.add("content-visible")),s&&(s.classList.remove("content-hidden"),s.classList.add("content-visible"))},500)},t)}function zr(){const t=document.getElementById("splash-modal");return t?!t.classList.contains("hidden"):!1}function Xr(){const t=document.getElementById("feature-not-implemented-modal"),e=document.getElementById("feature-modal-close-btn");if(!t||!e){console.warn("Feature modal elements not found");return}function i(){t&&t.classList.remove("hidden")}e.addEventListener("click",()=>{t.classList.add("hidden")});const s=document.getElementById("piano-toggle-btn");s&&s.addEventListener("click",()=>{i()});const a=document.getElementById("mixer-toggle-btn");a&&a.addEventListener("click",()=>{i()});const r=document.getElementById("ai-toggle-btn");r&&r.addEventListener("click",()=>{i()});const n=document.getElementById("quantize-mode-menu-btn");n&&n.addEventListener("click",()=>{i()})}function Vr(t,e){window.addEventListener("keydown",i=>{const s=(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="z",a=(i.ctrlKey||i.metaKey)&&(i.key.toLowerCase()==="y"||i.shiftKey&&i.key.toLowerCase()==="z");if(!s&&!a)return;i.preventDefault(),i.target instanceof HTMLElement&&i.target.matches('input, textarea, [contenteditable="true"]')||(s?t():e())},{capture:!0})}var jr=Object.defineProperty,Yr=Object.defineProperties,Zr=Object.getOwnPropertyDescriptors,$i=Object.getOwnPropertySymbols,Qr=Object.prototype.hasOwnProperty,ea=Object.prototype.propertyIsEnumerable,Is=t=>{throw TypeError(t)},Ki=(t,e,i)=>e in t?jr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,Q=(t,e)=>{for(var i in e||(e={}))Qr.call(e,i)&&Ki(t,i,e[i]);if($i)for(var i of $i(e))ea.call(e,i)&&Ki(t,i,e[i]);return t},ge=(t,e)=>Yr(t,Zr(e)),Ci=(t,e,i)=>e.has(t)||Is("Cannot "+i),B=(t,e,i)=>(Ci(t,e,"read from private field"),i?i.call(t):e.get(t)),H=(t,e,i)=>e.has(t)?Is("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),x=(t,e,i,s)=>(Ci(t,e,"write to private field"),e.set(t,i),i),Gt=(t,e,i)=>(Ci(t,e,"access private method"),i),W=(t,e,i)=>new Promise((s,a)=>{var r=c=>{try{o(i.next(c))}catch(d){a(d)}},n=c=>{try{o(i.throw(c))}catch(d){a(d)}},o=c=>c.done?s(c.value):Promise.resolve(c.value).then(r,n);o((i=i.apply(t,e)).next())});function Et(t){const e=t.filter(i=>!!i);return e.reduce((i,s)=>{const a="output"in i?i.output:i,r="input"in s?s.input:s;return a.connect(r),s}),()=>{e.reduce((i,s)=>{const a="output"in i?i.output:i,r="input"in s?s.input:s;return a.disconnect(r),s})}}function ta(t){let e=t;const i=new Set;function s(n){return i.add(n),n(e),()=>{i.delete(n)}}function a(n){e=n,i.forEach(o=>o(e))}function r(){return e}return{subscribe:s,set:a,get:r}}function ia(){const t=new Set;function e(s){return t.add(s),()=>{t.delete(s)}}function i(s){t.forEach(a=>a(s))}return{subscribe:e,trigger:i}}function sa(t){let e=!1;return()=>{e||(e=!0,t.forEach(i=>i==null?void 0:i()))}}function ks(t){return t*t/16129}function ra(t){return Math.pow(10,t/20)}var Me,me,Te,Re,It,Be,Le,As=class{constructor(t,e){this.context=t,H(this,Me),H(this,me),H(this,Te),H(this,Re),H(this,It),H(this,Be),H(this,Le,!1);var i,s,a;x(this,Be,{destination:(i=e==null?void 0:e.destination)!=null?i:t.destination,volume:(s=e==null?void 0:e.volume)!=null?s:100,volumeToGain:(a=e==null?void 0:e.volumeToGain)!=null?a:ks}),this.input=t.createGain(),x(this,Me,t.createGain()),x(this,Re,Et([this.input,B(this,Me),B(this,Be).destination]));const r=ta(B(this,Be).volume);this.setVolume=r.set,x(this,It,r.subscribe(n=>{B(this,Me).gain.value=B(this,Be).volumeToGain(n)}))}addInsert(t){var e;if(B(this,Le))throw Error("Can't add insert to disconnected channel");(e=B(this,Te))!=null||x(this,Te,[]),B(this,Te).push(t),B(this,Re).call(this),x(this,Re,Et([this.input,...B(this,Te),B(this,Me),B(this,Be).destination]))}addEffect(t,e,i){var s;if(B(this,Le))throw Error("Can't add effect to disconnected channel");const a=this.context.createGain();a.gain.value=i;const r="input"in e?e.input:e,n=Et([B(this,Me),a,r]);(s=B(this,me))!=null||x(this,me,[]),B(this,me).push({name:t,mix:a,disconnect:n})}sendEffect(t,e){var i;if(B(this,Le))throw Error("Can't send effect to disconnected channel");const s=(i=B(this,me))==null?void 0:i.find(a=>a.name===t);s?s.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;B(this,Le)||(x(this,Le,!0),B(this,Re).call(this),B(this,It).call(this),(t=B(this,me))==null||t.forEach(e=>e.disconnect()),x(this,me,void 0))}};Me=new WeakMap;me=new WeakMap;Te=new WeakMap;Re=new WeakMap;It=new WeakMap;Be=new WeakMap;Le=new WeakMap;var V,aa=class{constructor(t){this.compare=t,H(this,V,[])}push(t){const e=B(this,V).length;let i=0,s=e-1,a=e;for(;i<=s;){const r=Math.floor((i+s)/2);this.compare(t,B(this,V)[r])<0?(a=r,s=r-1):i=r+1}B(this,V).splice(a,0,t)}pop(){return B(this,V).shift()}peek(){return B(this,V)[0]}removeAll(t){const e=B(this,V).length;return x(this,V,B(this,V).filter(i=>!t(i))),B(this,V).length!==e}clear(){x(this,V,[])}size(){return B(this,V).length}};V=new WeakMap;function Wi(t,e){return t&&e?i=>{t(i),e(i)}:t??e}function na(t){var e,i,s;const a={disableScheduler:(e=t.disableScheduler)!=null?e:!1,scheduleLookaheadMs:(i=t.scheduleLookaheadMs)!=null?i:200,scheduleIntervalMs:(s=t.scheduleIntervalMs)!=null?s:50,onStart:t.onStart,onEnded:t.onEnded};if(a.scheduleLookaheadMs<1)throw Error("scheduleLookaheadMs must be greater than 0");if(a.scheduleIntervalMs<1)throw Error("scheduleIntervalMs must be greater than 0");if(a.scheduleLookaheadMs<a.scheduleIntervalMs)throw Error("scheduleLookaheadMs must be greater than scheduleIntervalMs");return a}var oe,j,we,Fs=class{constructor(t,e={}){H(this,oe),H(this,j),H(this,we),x(this,oe,na(e)),x(this,j,new aa((i,s)=>i.time-s.time)),this.player=t}get context(){return this.player.context}get buffers(){return this.player.buffers}get isRunning(){return B(this,we)!==void 0}start(t){var e;if(B(this,oe).disableScheduler)return this.player.start(t);const i=this.player.context,s=i.currentTime,a=(e=t.time)!=null?e:s,r=B(this,oe).scheduleLookaheadMs/1e3;return t.onStart=Wi(t.onStart,B(this,oe).onStart),t.onEnded=Wi(t.onEnded,B(this,oe).onEnded),a<s+r?this.player.start(t):(B(this,j).push(ge(Q({},t),{time:a})),B(this,we)||x(this,we,setInterval(()=>{const n=i.currentTime+r;for(;B(this,j).size()&&B(this,j).peek().time<=n;){const o=B(this,j).pop();o&&this.player.start(o)}B(this,j).size()||(clearInterval(B(this,we)),x(this,we,void 0))},B(this,oe).scheduleIntervalMs)),n=>{!n||n<a?B(this,j).removeAll(o=>o===t)||this.player.stop(ge(Q({},t),{time:n})):this.player.stop(ge(Q({},t),{time:n}))})}stop(t){var e;if(B(this,oe).disableScheduler)return this.player.stop(t);if(this.player.stop(t),!t){B(this,j).clear();return}const i=(e=t==null?void 0:t.time)!=null?e:0,s=t==null?void 0:t.stopId;s?B(this,j).removeAll(a=>a.time>=i&&a.stopId?a.stopId===s:a.note===s):B(this,j).removeAll(a=>a.time>=i)}disconnect(){this.player.disconnect()}};oe=new WeakMap;j=new WeakMap;we=new WeakMap;var Qe,Oe,et,Ps=class{constructor(t,e){this.context=t,this.options=e,H(this,Qe),H(this,Oe,!1),H(this,et);var i,s;x(this,Qe,{velocityToGain:(i=e.velocityToGain)!=null?i:ks,destination:(s=e.destination)!=null?s:t.destination}),this.buffers={},x(this,et,ia())}start(t){var e,i,s,a,r,n,o,c,d,l,u,h,f,p;if(B(this,Oe))throw new Error("Can't start a sample on disconnected player");const g=this.context,y=t.name&&this.buffers[t.name]||this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>{};const m=g.createBufferSource();m.buffer=y;const _=(i=(e=t.detune)!=null?e:this.options.detune)!=null?i:0;m.detune?m.detune.value=_:m.playbackRate&&(m.playbackRate.value=Math.pow(2,_/1200));const v=(s=t.lpfCutoffHz)!=null?s:this.options.lpfCutoffHz,b=v?g.createBiquadFilter():void 0;v&&b&&(b.type="lowpass",b.frequency.value=v);const S=g.createGain(),N=(r=(a=t.velocity)!=null?a:this.options.velocity)!=null?r:100;S.gain.value=B(this,Qe).velocityToGain(N),((n=t.loop)!=null?n:this.options.loop)&&(m.loop=!0,m.loopStart=(o=t.loopStart)!=null?o:0,m.loopEnd=(c=t.loopEnd)!=null?c:y.duration);const M=(d=t.decayTime)!=null?d:this.options.decayTime,[E,k]=oa(g,M);function L(F){if(F??(F=g.currentTime),F<=D)m.stop(F);else{const w=k(F);m.stop(w)}}const P=t.gainOffset?g.createGain():void 0;P&&t.gainOffset&&(P.gain.value=t.gainOffset);const A=(l=t.stopId)!=null?l:t.note,U=sa([Et([m,b,S,E,P,B(this,Qe).destination]),(u=t.stop)==null?void 0:u.call(t,L),B(this,et).subscribe(F=>{(!F||F.stopId===void 0||F.stopId===A)&&L(F==null?void 0:F.time)})]);m.onended=()=>{var F;U(),(F=t.onEnded)==null||F.call(t,t)},(h=t.onStart)==null||h.call(t,t);const D=Math.max((f=t.time)!=null?f:0,g.currentTime);m.start(t.time);let q=(p=t.duration)!=null?p:y.duration;return typeof t.duration=="number"&&L(D+q),L}stop(t){B(this,et).trigger(t)}disconnect(){B(this,Oe)||(x(this,Oe,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!B(this,Oe)}};Qe=new WeakMap;Oe=new WeakMap;et=new WeakMap;function oa(t,e=.2){let i=0;const s=t.createGain();s.gain.value=1;function a(r){if(i)return i;s.gain.cancelScheduledValues(r);const n=r||t.currentTime;return i=n+e,s.gain.setValueAtTime(1,n),s.gain.linearRampToValueAtTime(0,i),i}return[s,a]}var Ht=class{constructor(t,e){this.context=t;const i=new As(t,e);this.player=new Fs(new Ps(t,ge(Q({},e),{destination:i.input})),e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop(typeof t=="object"?t:t!==void 0?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}};function Mi(t,e,i){return W(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");const s=yield i.fetch(e);if(s.status!==200){console.warn("Error loading buffer. Invalid status: ",s.status,e);return}try{const a=yield s.arrayBuffer();return yield t.decodeAudioData(a)}catch(a){console.warn("Error loading buffer",a,e)}})}function $t(t){if(typeof document>"u")return null;const e=document.createElement("audio");for(let i=0;i<t.length;i++){const s=t[i],a=e.canPlayType(`audio/${s}`);if(a==="probably"||a==="maybe")return s;if(s==="m4a"){const r=e.canPlayType("audio/aac");if(r==="probably"||r==="maybe")return s}}return null}function la(){var t;return"."+((t=$t(["ogg","m4a"]))!=null?t:"ogg")}var _t={fetch(t){return fetch(t)}};function Ts(t){return typeof t=="object"&&typeof t.baseUrl=="string"&&typeof t.name=="string"&&Array.isArray(t.samples)&&Array.isArray(t.groupNames)&&typeof t.nameToSampleName=="object"&&typeof t.sampleGroupVariations=="object"}var da={baseUrl:"",name:"",samples:[],groupNames:[],nameToSampleName:{},sampleGroupVariations:{}};function ca(t,e){return W(this,null,function*(){var i,s,a,r;const o=yield(yield e.fetch(t)).json();o.baseUrl=t.replace("/dm.json",""),o.groupNames=[],o.nameToSampleName={},o.sampleGroupVariations={};for(const c of o.samples){o.nameToSampleName[c]=c;const d=c.indexOf("/")!==-1?"/":"-",[l,u]=c.split(d);o.groupNames.includes(l)||o.groupNames.push(l),(s=(i=o.nameToSampleName)[l])!=null||(i[l]=c),(r=(a=o.sampleGroupVariations)[l])!=null||(a[l]=[]),u&&o.sampleGroupVariations[l].push(`${l}${d}${u}`)}return o})}function Rs(){return Object.keys(Os)}var Os={"TR-808":"https://smpldsnds.github.io/drum-machines/TR-808/dm.json","Casio-RZ1":"https://smpldsnds.github.io/drum-machines/Casio-RZ1/dm.json","LM-2":"https://smpldsnds.github.io/drum-machines/LM-2/dm.json","MFB-512":"https://smpldsnds.github.io/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://smpldsnds.github.io/drum-machines/Roland-CR-8000/dm.json"};function ua(t){var e,i,s;const a={instrument:(e=t==null?void 0:t.instrument)!=null?e:"TR-808",storage:(i=t==null?void 0:t.storage)!=null?i:_t,url:(s=t==null?void 0:t.url)!=null?s:""};if(typeof a.instrument=="string"){if(a.url||(a.url=Os[a.instrument]),!a.url)throw new Error("Invalid instrument: "+a.instrument)}else if(!Ts(a.instrument))throw new Error("Invalid instrument: "+a.instrument);return a}var le,fa=class{constructor(t,e){H(this,le,da);const i=ua(e),s=Ts(i.instrument)?Promise.resolve(i.instrument):ca(i.url,i.storage);this.player=new Ht(t,e),this.output=this.player.output,this.load=ha(t,this.player.buffers,s,i.storage).then(()=>this),s.then(a=>{x(this,le,a)})}getSampleNames(){return B(this,le).samples.slice()}getGroupNames(){return B(this,le).groupNames.slice()}getSampleNamesForGroup(t){var e;return(e=B(this,le).sampleGroupVariations[t])!=null?e:[]}start(t){var e;const i=B(this,le).nameToSampleName[t.note];return this.player.start(ge(Q({},t),{note:i||t.note,stopId:(e=t.stopId)!=null?e:t.note}))}stop(t){return this.player.stop(t)}loaded(){return W(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}get sampleNames(){return console.log("deprecated: Use getGroupNames instead"),B(this,le).groupNames.slice()}getVariations(t){var e;return console.warn("deprecated: use getSampleNamesForGroup"),(e=B(this,le).sampleGroupVariations[t])!=null?e:[]}};le=new WeakMap;function ha(t,e,i,s){var a;const r=(a=$t(["ogg","m4a"]))!=null?a:"ogg";return i.then(n=>Promise.all(n.samples.map(o=>W(this,null,function*(){const c=`${n.baseUrl}/${o}.${r}`,d=yield Mi(t,c,s);d&&(e[o]=d)}))))}function ma(t){const i=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!i)return;const s=i[1].toUpperCase();if(!s)return;const a=i[2],r=a[0]==="b"?-a.length:a.length,n=i[3]?+i[3]:4,o=(s.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][o]+r+12*(n+1)}function fe(t){return t===void 0?void 0:typeof t=="number"?t:ma(t)}function pa(t={}){return{groups:[],options:t}}function Bi(){return{regions:[]}}function xs(t,e,i,s){const a=[],r=fe(e.note);if(r===void 0)return a;for(const n of t.regions){const o=Us(r,i??0,e,n,s);o&&a.push(o)}return a}function ya(t,e,i,s){const a=fe(e.note);if(a!==void 0)for(const r of t.regions){const n=Us(a,0,e,r,s);if(n)return n}}function Us(t,e,i,s,a){var r,n,o,c,d,l,u,h,f,p,g,y,m,_,v,b,S,N,C,M,E,k,L,P,A,U,D,q;if(!(t>=((r=s.midiLow)!=null?r:0)&&t<((n=s.midiHigh)!=null?n:127)+1)||!(i.velocity===void 0||i.velocity>=((o=s.velLow)!=null?o:0)&&i.velocity<=((c=s.velHigh)!=null?c:127)))return;if(s.seqLength){const Jr=e%s.seqLength,Hr=((d=s.seqPosition)!=null?d:1)-1;if(Jr!==Hr)return}const J=t-s.midiPitch,T=(l=i.velocity)!=null?l:a==null?void 0:a.velocity,ee=s.volume?ra(s.volume):0,ze=(h=(u=i.gainOffset)!=null?u:void 0)!=null?h:0,qr=(f=i.detune)!=null?f:0;return{decayTime:(y=(g=i==null?void 0:i.decayTime)!=null?g:(p=s.sample)==null?void 0:p.decayTime)!=null?y:a==null?void 0:a.decayTime,detune:100*(J+((m=s.tune)!=null?m:0))+qr,duration:(b=(v=i==null?void 0:i.duration)!=null?v:(_=s.sample)==null?void 0:_.duration)!=null?b:a==null?void 0:a.duration,gainOffset:ze+ee||void 0,loop:(C=(N=i==null?void 0:i.loop)!=null?N:(S=s.sample)==null?void 0:S.loop)!=null?C:a==null?void 0:a.loop,loopEnd:(k=(E=i==null?void 0:i.loopEnd)!=null?E:(M=s.sample)==null?void 0:M.loopEnd)!=null?k:a==null?void 0:a.loopEnd,loopStart:(A=(P=i==null?void 0:i.loopStart)!=null?P:(L=s.sample)==null?void 0:L.loopStart)!=null?A:a==null?void 0:a.loopStart,lpfCutoffHz:(q=(D=i==null?void 0:i.lpfCutoffHz)!=null?D:(U=s.sample)==null?void 0:U.lpfCutoffHz)!=null?q:a==null?void 0:a.lpfCutoffHz,name:s.sampleName,note:t,onEnded:i.onEnded,onStart:i.onStart,stopId:i.name,time:i.time,velocity:T??void 0}}function _a(t){if(t.length===0)return[];if(t.sort((e,i)=>e.midiPitch-i.midiPitch),t[0].midiLow=0,t[0].midiHigh=127,t.length===1)return t;for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e],a=Math.floor((i.midiPitch+s.midiPitch)/2);i.midiHigh=a,s.midiLow=a+1}return t[t.length-1].midiHigh=127,t}var ga=class{constructor(t,e){this.context=t,this.seqNum=0;const i=new As(t,e);this.instrument=pa(e),this.player=new Fs(new Ps(t,ge(Q({},e),{destination:i.input})),e),this.output=i}get buffers(){return this.player.buffers}start(t){const e=[],i=typeof t=="object"?t:{note:t};for(const s of this.instrument.groups){const a=xs(s,i,this.seqNum);this.seqNum++;for(const r of a){let n=this.player.start(r);e.push(n)}}return s=>e.forEach(a=>a(s))}stop(t){if(t==null){this.player.stop();return}const e=typeof t=="object"?t:{stopId:t},i=fe(e.stopId);i&&(e.stopId=i,this.player.stop(e))}disconnect(){this.output.disconnect(),this.player.disconnect()}};function Ds(t,e){const i=la();return(s,a)=>W(this,null,function*(){const r=yield fetch(t).then(c=>c.text()),n=ba(r,e.group);n.length&&console.warn("Problems converting sfz",n);const o=new Set;return e.group.regions.forEach(c=>o.add(c.sampleName)),Promise.all(Array.from(o).map(c=>W(this,null,function*(){const d=e.urlFromSampleName(c,i),l=yield Mi(s,d,a);e.buffers[c]=l}))).then(()=>e.group)})}function ba(t,e){let i="global";const s=t.split(`
`).map(Ma).filter(n=>!!n),a=new Ba;let r=[];for(const n of s)switch(n.type){case"mode":r.push(a.closeScope(i,e)),i=n.value;break;case"prop:num":case"prop:str":case"prop:num_arr":a.push(n.key,n.value);break;case"unknown":console.warn("Unknown SFZ token",n.value);break}return r.filter(n=>!!n)}var va=/^<([^>]+)>$/,Sa=/^([^=]+)=([-\.\d]+)$/,Na=/^([^=]+)=(.+)$/,Ca=/^([^=]+)_(\d+)=(\d+)$/;function Ma(t){if(t=t.trim(),t===""||t.startsWith("//"))return;const e=t.match(va);if(e)return{type:"mode",value:e[1]};const i=t.match(Ca);if(i)return{type:"prop:num_arr",key:i[1],value:[Number(i[2]),Number(i[3])]};const s=t.match(Sa);if(s)return{type:"prop:num",key:s[1],value:Number(s[2])};const a=t.match(Na);return a?{type:"prop:str",key:a[1],value:a[2]}:{type:"unknown",value:t}}var tt,kt,Ba=class{constructor(){H(this,tt),this.values={},this.global={},this.group={}}closeScope(t,e){if(t==="global")Gt(this,tt,kt).call(this,this.global);else if(t==="group")this.group=Gt(this,tt,kt).call(this,{});else if(t==="region"){const i=Gt(this,tt,kt).call(this,Q(Q({sampleName:"",midiPitch:-1},this.global),this.group));if(i.sampleName==="")return"Missing sample name";if(i.midiPitch===-1)if(i.midiLow!==void 0)i.midiPitch=i.midiLow;else return"Missing pitch_keycenter";i.seqLength&&i.seqPosition===void 0&&(i.seqPosition=1),i.ampRelease&&(i.sample={decayTime:i.ampRelease},delete i.ampRelease),e.regions.push(i)}}get empty(){return Object.keys(this.values).length===0}get keys(){return Object.keys(this.values)}push(t,e){this.values[t]=e}popNum(t,e,i){return typeof this.values[t]!="number"?!1:(e[i]=this.values[t],delete this.values[t],!0)}popStr(t,e,i){return typeof this.values[t]!="string"?!1:(e[i]=this.values[t],delete this.values[t],!0)}popNumArr(t,e,i){return Array.isArray(this.values[t])?(e[i]=this.values[t],delete this.values[t],!0):!1}};tt=new WeakSet;kt=function(t){return this.popStr("sample",t,"sampleName"),this.popNum("pitch_keycenter",t,"midiPitch"),this.popNum("ampeg_attack",t,"ampAttack"),this.popNum("ampeg_release",t,"ampRelease"),this.popNum("bend_down",t,"bendDown"),this.popNum("bend_up",t,"bendUp"),this.popNum("group",t,"group"),this.popNum("hikey",t,"midiHigh"),this.popNum("hivel",t,"velHigh"),this.popNum("lokey",t,"midiLow"),this.popNum("offset",t,"offset"),this.popNum("lovel",t,"velLow"),this.popNum("off_by",t,"groupOffBy"),this.popNum("pitch_keytrack",t,"ignore"),this.popNum("seq_length",t,"seqLength"),this.popNum("seq_position",t,"seqPosition"),this.popNum("tune",t,"tune"),this.popNum("volume",t,"volume"),this.popNumArr("amp_velcurve",t,"ampVelCurve"),this.values={},t};var La="https://smpldsnds.github.io/sgossner-vcsl/";function wa(t){return La+t+".sfz"}function Ga(t,e){const i=wa(t),a=`https://smpldsnds.github.io/sgossner-vcsl/${t.slice(0,t.lastIndexOf("/")+1)}`,r=Bi();return Ds(i,{buffers:e,group:r,urlFromSampleName:(n,o)=>a+"/"+n.replace(".wav",o)})}var Ea=class{constructor(t,e={}){var i,s;this.config={instrument:(i=e.instrument)!=null?i:"Arco",storage:(s=e.storage)!=null?s:_t},this.player=new ga(t,e);const a=Ga(this.config.instrument,this.player.buffers);this.load=a(t,this.config.storage).then(r=>(this.player.instrument.groups.push(r),this))}get output(){return this.player.output}get buffers(){return this.player.buffers}get context(){return this.player.context}start(t){return this.player.start(t)}stop(t){return this.player.stop(t)}disconnect(){this.player.disconnect()}};function Ia(){return Object.keys(qs)}var ka=class extends Ea{constructor(t,e){var i;super(t,ge(Q({},e),{instrument:qs[(i=e.instrument)!=null?i:""]}))}},qs={"Balafon - Hard Mallet":"Idiophones/Struck Idiophones/Balafon - Hard Mallet","Balafon - Keyswitch":"Idiophones/Struck Idiophones/Balafon - Keyswitch","Balafon - Soft Mallet":"Idiophones/Struck Idiophones/Balafon - Soft Mallet","Balafon - Traditional Mallet":"Idiophones/Struck Idiophones/Balafon - Traditional Mallet","Tubular Bells 1":"Idiophones/Struck Idiophones/Tubular Bells 1","Tubular Bells 2":"Idiophones/Struck Idiophones/Tubular Bells 2","Vibraphone - Bowed":"Idiophones/Struck Idiophones/Vibraphone - Bowed","Vibraphone - Hard Mallets":"Idiophones/Struck Idiophones/Vibraphone - Hard Mallets","Vibraphone - Keyswitch":"Idiophones/Struck Idiophones/Vibraphone - Keyswitch","Vibraphone - Soft Mallets":"Idiophones/Struck Idiophones/Vibraphone - Soft Mallets","Xylophone - Hard Mallets":"Idiophones/Struck Idiophones/Xylophone - Hard Mallets","Xylophone - Keyswitch":"Idiophones/Struck Idiophones/Xylophone - Keyswitch","Xylophone - Medium Mallets":"Idiophones/Struck Idiophones/Xylophone - Medium Mallets","Xylophone - Soft Mallets":"Idiophones/Struck Idiophones/Xylophone - Soft Mallets"};function Aa(){return["Pizzicato","Arco","Switched"]}function Fa(t){return`https://smpldsnds.github.io/sfzinstruments-dsmolken-double-bass/d_smolken_rubner_bass_${{Arco:"arco",Pizzicato:"pizz",Switched:"switched"}[t]}.sfz`}var Pa=class{constructor(t,e={}){this.seqNum=0;var i,s;this.config={instrument:(i=e.instrument)!=null?i:"Arco",storage:(s=e.storage)!=null?s:_t},this.player=new Ht(t,e),this.group=Bi();const a=Fa(this.config.instrument),r=Ds(a,{buffers:this.player.buffers,group:this.group,urlFromSampleName:(n,o)=>`https://smpldsnds.github.io/sfzinstruments-dsmolken-double-bass/${n.replace("\\","/").replace(".wav",o)}`});this.load=r(t,this.config.storage).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}get context(){return this.player.context}start(t){const e=xs(this.group,typeof t=="object"?t:{note:t},this.seqNum);this.seqNum++;const i=e.map(s=>this.player.start(s));return s=>i.forEach(a=>a(s))}stop(t){if(t==null){this.player.stop();return}const e=typeof t=="object"?t:{stopId:t},i=fe(e.stopId);i&&(e.stopId=i,this.player.stop(e))}disconnect(){this.player.disconnect()}};function Ta(t,e){var i;const s=(i=$t(["ogg","mp3"]))!=null?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${s}.js`}function Ra(t,e,i){return(s,a)=>W(this,null,function*(){const r=yield(yield a.fetch(t)).text(),n=Oa(r),o=Object.keys(n);yield Promise.all(o.map(c=>W(this,null,function*(){const d=fe(c);if(!d)return;const l=Ua(xa(n[c])),u=yield s.decodeAudioData(l);e[c]=u,i.regions.push({sampleName:c,midiPitch:d})}))),_a(i.regions)})}function Oa(t){const e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");const i=t.indexOf("=",e)+2,s=t.lastIndexOf(",");return JSON.parse(t.slice(i,s)+"}")}function xa(t){return t.slice(t.indexOf(",")+1)}function Ua(t){const e=window.atob(t),i=e.length,s=new Uint8Array(i);for(let a=0;a<i;a++)s[a]=e.charCodeAt(a);return s.buffer}var Da=["MusyngKite","FluidR3_GM"],qa=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function Ja(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}function Ha(t,e=44100){return W(this,null,function*(){if(t)try{const i=yield fetch(t);if(i.status!==200)return;const s=yield i.json(),a={};return Object.keys(s).forEach(r=>{const n=fe(r);if(n){const o=s[r];a[n]=[o[0]/e,o[1]/e]}}),a}catch{return}})}function $a(){return Da}function Ka(){return qa}var it,Wa=class{constructor(t,e){this.context=t,H(this,it),this.config=Xa(e),this.player=new Ht(t,e),this.group=Bi(),x(this,it,!1);const i=za(this.config.instrumentUrl,this.config.loopDataUrl,this.player.buffers,this.group);this.load=i(t,this.config.storage).then(a=>(x(this,it,a),this));const s=t.createGain();s.gain.value=this.config.extraGain,this.player.output.addInsert(s)}get output(){return this.player.output}get hasLoops(){return B(this,it)}loaded(){return W(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}disconnect(){this.player.disconnect()}start(t){const e=ya(this.group,typeof t=="object"?t:{note:t});return e?this.player.start(e):()=>{}}stop(t){return this.player.stop(t)}};it=new WeakMap;function za(t,e,i,s){const a=Ra(t,i,s);return(r,n)=>W(this,null,function*(){const[o,c]=yield Promise.all([a(r,n),Ha(e)]);return c&&s.regions.forEach(d=>{var l;const u=c[d.midiPitch];u&&((l=d.sample)!=null||(d.sample={}),d.sample.loop=!0,d.sample.loopStart=u[0],d.sample.loopEnd=u[1])}),!!c})}function Xa(t){var e,i,s,a;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");const r={kit:"MusyngKite",instrument:t.instrument,storage:(e=t.storage)!=null?e:_t,extraGain:(i=t.extraGain)!=null?i:5,loadLoopData:(s=t.loadLoopData)!=null?s:!1,loopDataUrl:t.loopDataUrl,instrumentUrl:(a=t.instrumentUrl)!=null?a:""};if(r.instrument&&r.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),r.instrumentUrl=r.instrument,r.instrument=void 0),r.instrumentUrl)(r.kit||r.instrument)&&console.warn("Soundfont: 'kit' and 'instrument' config parameters are ignored because 'instrumentUrl' is explicitly set.");else if(r.instrument)r.instrumentUrl=Ta(r.instrument,r.kit);else throw Error("Soundfont: 'instrument' or 'instrumentUrl' configuration parameter is required");return r.loadLoopData&&r.instrument&&!r.loopDataUrl&&(r.loopDataUrl=Ja(r.instrument,r.kit)),r}var Va="https://danigb.github.io/samples/splendid-grand-piano",di,Js,ja=class{constructor(t,e){this.context=t,H(this,di),this.options=Object.assign({baseUrl:Va,storage:_t,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new Ht(t,this.options);const i=Za(this.options.baseUrl,this.options.storage,this.options.notesToLoad);this.load=i(t,this.player.buffers).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return W(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}start(t){var e,i;const s=typeof t=="object"?Q({},t):{note:t},a=Gt(this,di,Js).call(this,s);return a?(s.note=a[0],s.stopId=(e=s.stopId)!=null?e:a[1],s.detune=a[2]+((i=s.detune)!=null?i:this.options.detune),this.player.start(s)):()=>{}}stop(t){var e;if(typeof t=="string")return this.player.stop((e=fe(t))!=null?e:t);if(typeof t=="object"){const i=fe(t.stopId);return this.player.stop(i!==void 0?ge(Q({},t),{stopId:i}):t)}else return this.player.stop(t)}};di=new WeakSet;Js=function(t){var e;const i=fe(t.note);if(!i)return;const s=(e=t.velocity)!=null?e:this.options.velocity,a=Pt.findIndex(n=>s>=n.vel_range[0]&&s<=n.vel_range[1]),r=Pt[a];if(r)return Ya(r.name,i,this.player.buffers)};function Ya(t,e,i){let s=0;for(;i[t+(e+s)]===void 0&&s<128;)s>0?s=-s:s=-s+1;return s===127?[t+e,e,0]:[t+(e+s),e,-s*100]}function Za(t,e,i){var s;const a=(s=$t(["ogg","m4a"]))!=null?s:"ogg";let r=i?Pt.filter(n=>n.vel_range[0]<=i.velocityRange[1]&&n.vel_range[1]>=i.velocityRange[0]):Pt;return(n,o)=>W(this,null,function*(){for(const c of r){const d=i?c.samples.filter(l=>i.notes.includes(l[0])):c.samples;yield Promise.all(d.map(l=>W(this,[l],function*([u,h]){const f=`${t}/${h}.${a}`,p=yield Mi(n,f,e);p&&(o[c.name+u]=p)})))}})}var Pt=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}];let At=null,Hs=!1;function st(t="Loading Sounds...",e="Please wait while we dial it in.",i,s){if(zr()||$s()&&!s)return;s&&(Tt(),ci(!0));const a=document.getElementById("loading-modal"),r=document.getElementById("loading-modal-title"),n=document.getElementById("loading-modal-subtext"),o=document.getElementById("loading-modal-cancel");r&&(r.textContent=t),n&&(n.textContent=e),o&&(i?(o.classList.remove("hidden"),At=()=>{i(),ci(!1),Tt()},o.onclick=At):(o.classList.add("hidden"),o.onclick=null,At=null)),a&&a.classList.remove("hidden")}function Tt(t){if(t&&ci(!1),$s())return;const e=document.getElementById("loading-modal"),i=document.getElementById("loading-modal-cancel");e&&e.classList.add("hidden"),i&&(i.classList.add("hidden"),i.onclick=null),At=null}function ci(t){Hs=t}function $s(){return Hs}let ot=0;function Ks(){ot++,ot===1&&st()}function Ws(){ot--,ot<=0&&(ot=0,Tt())}async function Qa(t){Ks();try{return await t}finally{Ws()}}const Zt=new Map;async function en(t,e){e?await t.load:await nn(t.load)}async function Kt(t,e=z(),i=null,s,a,r,n=!0){var S;const o=t.split("/");let c="sf2",d="musyngkite",l="acoustic_grand_piano";o.length===3?[c,d,l]=o:o.length===2?[d,l]=o:o.length===1&&(l=o[0]);const u=e instanceof OfflineAudioContext;Zt.has(e)||Zt.set(e,new Map);const h=Zt.get(e),f=String(e??z()),p=`${d}/${l}@${f}`;if(n&&h.has(p))return h.get(p);const g=Math.max(0,Math.min(127,Math.round((s??1)*127))),y=e.createStereoPanner();a!==void 0&&(y.pan.value=a);const m=e.createGain();m.connect(y),i&&i.context!==e&&(console.warn("[loadInstrument] Ignoring mismatched destination from different context"),i=null),y.connect(i||qe(e));const _={instrument:l,volume:g,destination:m,disableScheduler:u};let v;if(d==="smolken")v=new Pa(e,_);else if(d==="splendidgrandpiano")v=new ja(e,_);else if(d==="mallets")v=new ka(e,_);else if(d==="drummachines")v=new fa(e,_);else{const C={"fluidr3-gm":"FluidR3_GM",fatboy:"FatBoy",musyngkite:"MusyngKite"}[d.toLowerCase()]||"MusyngKite",E=`https://gleitz.github.io/midi-js-soundfonts/${C}/${l}-ogg.js`;v=new Wa(e,{..._,instrumentUrl:E,kit:C})}if(await en(v,r??!1),d==="drummachines"){const N=((S=v.getSampleNames)==null?void 0:S.call(v))??[],C=new Map;N.forEach((M,E)=>{const k=36+E;C.set(k,M)}),v.__midiMap=C}const b=v;return b.setVolume=N=>{var M;const C=Math.max(0,Math.min(127,Math.round(N*127)));"output"in b&&typeof((M=b.output)==null?void 0:M.setVolume)=="function"&&b.output.setVolume(C)},b.setPan=N=>{y.pan.value=Math.max(-1,Math.min(1,N))},n&&h.set(p,b),b}async function tn(){const e=sn().map(s=>{switch(s){case"FluidR3_GM":return"fluidr3-gm";case"FatBoy":return"fatboy";case"MusyngKite":return"musyngkite";default:return s.toLowerCase()}}),i=["splendidgrandpiano","mallets","drummachines","smolken"];return[...new Set([...e,...i])]}function sn(){const e=[...$a()];return e.includes("FatBoy")||e.push("FatBoy"),e}async function rn(t){const e=t.toLowerCase();return e==="splendidgrandpiano"?["splendidgrandpiano"]:e==="mallets"?Ia():e==="drummachines"?Rs():e==="smolken"?Aa():(await Kt(`${t}/acoustic_grand_piano`,z(),null,0,0,!0),Ka()??[])}function an(){return Rs()}async function nn(t){Ks();try{await t}finally{Ws()}}function on(){return{name:"sf2",loadInstrument:Kt,getAvailableLibraries:tn,getAvailableInstruments:rn}}let Qt=null,bt=null;function Ae(){return Qt||(Qt=new AudioContext),Qt}function ln(){if(!bt){const t=Ae();bt=t.createGain(),bt.connect(t.destination)}return bt}const dn={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function K(t){const e=t==null?void 0:t.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,i,s,a]=e,r=i.toUpperCase(),n=dn[r];if(n===void 0)return null;const o=[...s].reduce((d,l)=>l==="#"?d+1:l==="b"?d-1:d,0);return 12*(parseInt(a,10)+1)+(n+o)}let ie=null,ui=null;async function cn(t){if(ui===t)return;ie=await Kt(t,Ae()),ui=t}function un(){return ui}function fn(t,e=100,i=!1){var o;if(!ie)return null;const a=Ae().currentTime,r=K(t);if(r===null)return null;const n=((o=ie.__midiMap)==null?void 0:o.get(r))??r;return ie.start({note:n,stopId:n,velocity:e,time:a,loop:i}),()=>{ie==null||ie.stop({stopId:n})}}function hn(t){var s;if(!ie)return;const e=K(t);if(e===null)return;const i=((s=ie.__midiMap)==null?void 0:s.get(e))??e;ie.stop({stopId:i})}async function mn(t,e,i,s=100,a=!1,r=null,n=null,o=null,c,d){var p;const l=n||z(),u=await Kt(t,l,o,c,d);c!==void 0&&u.setVolume&&u.setVolume(c),d!==void 0&&u.setPan&&u.setPan(d);const h=K(e);if(h===null)return null;const f=((p=u.__midiMap)==null?void 0:p.get(h))??h;return u.start({note:f,duration:i,velocity:s,loop:a,time:r??l.currentTime}),null}function pn(){return{name:"sf2",setActiveInstrument:cn,getActiveInstrumentName:un,playNote:fn,stopNoteByPitch:hn,loadAndPlayNote:mn}}const ht=[{id:"0000_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Grand Piano"},{id:"0000_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Grand Piano"},{id:"0000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Grand Piano"},{id:"0000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Grand Piano"},{id:"0000_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Grand Piano"},{id:"0000_SBLive_sf2",library:"SBLive",displayName:"Acoustic Grand Piano"},{id:"0000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Grand Piano"},{id:"0010_Aspirin_sf2_file",library:"Aspirin",displayName:"Bright Acoustic Piano"},{id:"0010_Chaos_sf2_file",library:"Chaos",displayName:"Bright Acoustic Piano"},{id:"0010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bright Acoustic Piano"},{id:"0010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bright Acoustic Piano"},{id:"0010_JCLive_sf2_file",library:"JCLive",displayName:"Bright Acoustic Piano"},{id:"0010_SBLive_sf2",library:"SBLive",displayName:"Bright Acoustic Piano"},{id:"0010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bright Acoustic Piano"},{id:"0020_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Grand Piano"},{id:"0020_Chaos_sf2_file",library:"Chaos",displayName:"Electric Grand Piano"},{id:"0020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Grand Piano"},{id:"0020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Grand Piano"},{id:"0020_JCLive_sf2_file",library:"JCLive",displayName:"Electric Grand Piano"},{id:"0020_SBLive_sf2",library:"SBLive",displayName:"Electric Grand Piano"},{id:"0020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Grand Piano"},{id:"0050_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Piano 2"},{id:"0050_Chaos_sf2_file",library:"Chaos",displayName:"Electric Piano 2"},{id:"0050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Piano 2"},{id:"0050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Piano 2"},{id:"0050_JCLive_sf2_file",library:"JCLive",displayName:"Electric Piano 2"},{id:"0050_SBLive_sf2",library:"SBLive",displayName:"Electric Piano 2"},{id:"0050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Piano 2"},{id:"0060_Aspirin_sf2_file",library:"Aspirin",displayName:"Harpsichord"},{id:"0060_Chaos_sf2_file",library:"Chaos",displayName:"Harpsichord"},{id:"0060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harpsichord"},{id:"0060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harpsichord"},{id:"0060_JCLive_sf2_file",library:"JCLive",displayName:"Harpsichord"},{id:"0060_SBLive_sf2",library:"SBLive",displayName:"Harpsichord"},{id:"0060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harpsichord"},{id:"0070_Aspirin_sf2_file",library:"Aspirin",displayName:"Clavinet"},{id:"0070_Chaos_sf2_file",library:"Chaos",displayName:"Clavinet"},{id:"0070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clavinet"},{id:"0070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clavinet"},{id:"0070_JCLive_sf2_file",library:"JCLive",displayName:"Clavinet"},{id:"0070_SBLive_sf2",library:"SBLive",displayName:"Clavinet"},{id:"0070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clavinet"},{id:"0080_Aspirin_sf2_file",library:"Aspirin",displayName:"Celesta"},{id:"0080_Chaos_sf2_file",library:"Chaos",displayName:"Celesta"},{id:"0080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Celesta"},{id:"0080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Celesta"},{id:"0080_JCLive_sf2_file",library:"JCLive",displayName:"Celesta"},{id:"0080_SBLive_sf2",library:"SBLive",displayName:"Celesta"},{id:"0080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Celesta"},{id:"0090_Aspirin_sf2_file",library:"Aspirin",displayName:"Glockenspiel"},{id:"0090_Chaos_sf2_file",library:"Chaos",displayName:"Glockenspiel"},{id:"0090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Glockenspiel"},{id:"0090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Glockenspiel"},{id:"0090_JCLive_sf2_file",library:"JCLive",displayName:"Glockenspiel"},{id:"0090_SBLive_sf2",library:"SBLive",displayName:"Glockenspiel"},{id:"0090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Glockenspiel"},{id:"0100_Aspirin_sf2_file",library:"Aspirin",displayName:"Music Box"},{id:"0100_Chaos_sf2_file",library:"Chaos",displayName:"Music Box"},{id:"0100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Music Box"},{id:"0100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Music Box"},{id:"0100_JCLive_sf2_file",library:"JCLive",displayName:"Music Box"},{id:"0100_SBLive_sf2",library:"SBLive",displayName:"Music Box"},{id:"0100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Music Box"},{id:"0110_Aspirin_sf2_file",library:"Aspirin",displayName:"Vibraphone"},{id:"0110_Chaos_sf2_file",library:"Chaos",displayName:"Vibraphone"},{id:"0110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Vibraphone"},{id:"0110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Vibraphone"},{id:"0110_JCLive_sf2_file",library:"JCLive",displayName:"Vibraphone"},{id:"0110_SBLive_sf2",library:"SBLive",displayName:"Vibraphone"},{id:"0110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Vibraphone"},{id:"0120_Aspirin_sf2_file",library:"Aspirin",displayName:"Marimba"},{id:"0120_Chaos_sf2_file",library:"Chaos",displayName:"Marimba"},{id:"0120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Marimba"},{id:"0120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Marimba"},{id:"0120_JCLive_sf2_file",library:"JCLive",displayName:"Marimba"},{id:"0120_SBLive_sf2",library:"SBLive",displayName:"Marimba"},{id:"0120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Marimba"},{id:"0130_Aspirin_sf2_file",library:"Aspirin",displayName:"Xylophone"},{id:"0130_Chaos_sf2_file",library:"Chaos",displayName:"Xylophone"},{id:"0130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Xylophone"},{id:"0130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Xylophone"},{id:"0130_JCLive_sf2_file",library:"JCLive",displayName:"Xylophone"},{id:"0130_SBLive_sf2",library:"SBLive",displayName:"Xylophone"},{id:"0130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Xylophone"},{id:"0140_Aspirin_sf2_file",library:"Aspirin",displayName:"Tubular Bells"},{id:"0140_Chaos_sf2_file",library:"Chaos",displayName:"Tubular Bells"},{id:"0140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tubular Bells"},{id:"0140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tubular Bells"},{id:"0140_JCLive_sf2_file",library:"JCLive",displayName:"Tubular Bells"},{id:"0140_SBLive_sf2",library:"SBLive",displayName:"Tubular Bells"},{id:"0140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tubular Bells"},{id:"0150_Aspirin_sf2_file",library:"Aspirin",displayName:"Dulcimer"},{id:"0150_Chaos_sf2_file",library:"Chaos",displayName:"Dulcimer"},{id:"0150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Dulcimer"},{id:"0150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Dulcimer"},{id:"0150_JCLive_sf2_file",library:"JCLive",displayName:"Dulcimer"},{id:"0150_SBLive_sf2",library:"SBLive",displayName:"Dulcimer"},{id:"0150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Dulcimer"},{id:"0160_Aspirin_sf2_file",library:"Aspirin",displayName:"Drawbar Organ"},{id:"0160_Chaos_sf2_file",library:"Chaos",displayName:"Drawbar Organ"},{id:"0160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drawbar Organ"},{id:"0160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Drawbar Organ"},{id:"0160_JCLive_sf2_file",library:"JCLive",displayName:"Drawbar Organ"},{id:"0160_SBLive_sf2",library:"SBLive",displayName:"Drawbar Organ"},{id:"0160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Drawbar Organ"},{id:"0170_Aspirin_sf2_file",library:"Aspirin",displayName:"Percussive Organ"},{id:"0170_Chaos_sf2_file",library:"Chaos",displayName:"Percussive Organ"},{id:"0170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Percussive Organ"},{id:"0170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Percussive Organ"},{id:"0170_JCLive_sf2_file",library:"JCLive",displayName:"Percussive Organ"},{id:"0170_SBLive_sf2",library:"SBLive",displayName:"Percussive Organ"},{id:"0170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Percussive Organ"},{id:"0180_Aspirin_sf2_file",library:"Aspirin",displayName:"Rock Organ"},{id:"0180_Chaos_sf2_file",library:"Chaos",displayName:"Rock Organ"},{id:"0180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Rock Organ"},{id:"0180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Rock Organ"},{id:"0180_JCLive_sf2_file",library:"JCLive",displayName:"Rock Organ"},{id:"0180_SBLive_sf2",library:"SBLive",displayName:"Rock Organ"},{id:"0180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Rock Organ"},{id:"0190_Aspirin_sf2_file",library:"Aspirin",displayName:"Church Organ"},{id:"0190_Chaos_sf2_file",library:"Chaos",displayName:"Church Organ"},{id:"0190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Church Organ"},{id:"0190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Church Organ"},{id:"0190_JCLive_sf2_file",library:"JCLive",displayName:"Church Organ"},{id:"0190_SBLive_sf2",library:"SBLive",displayName:"Church Organ"},{id:"0190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Church Organ"},{id:"0200_Aspirin_sf2_file",library:"Aspirin",displayName:"Reed Organ"},{id:"0200_Chaos_sf2_file",library:"Chaos",displayName:"Reed Organ"},{id:"0200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reed Organ"},{id:"0200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reed Organ"},{id:"0200_JCLive_sf2_file",library:"JCLive",displayName:"Reed Organ"},{id:"0200_SBLive_sf2",library:"SBLive",displayName:"Reed Organ"},{id:"0200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reed Organ"},{id:"0210_Aspirin_sf2_file",library:"Aspirin",displayName:"Accordion"},{id:"0210_Chaos_sf2_file",library:"Chaos",displayName:"Accordion"},{id:"0210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Accordion"},{id:"0210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Accordion"},{id:"0210_JCLive_sf2_file",library:"JCLive",displayName:"Accordion"},{id:"0210_SBLive_sf2",library:"SBLive",displayName:"Accordion"},{id:"0210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Accordion"},{id:"0220_Aspirin_sf2_file",library:"Aspirin",displayName:"Harmonica"},{id:"0220_Chaos_sf2_file",library:"Chaos",displayName:"Harmonica"},{id:"0220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harmonica"},{id:"0220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harmonica"},{id:"0220_JCLive_sf2_file",library:"JCLive",displayName:"Harmonica"},{id:"0220_SBLive_sf2",library:"SBLive",displayName:"Harmonica"},{id:"0220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harmonica"},{id:"0230_Aspirin_sf2_file",library:"Aspirin",displayName:"Tango Accordion"},{id:"0230_Chaos_sf2_file",library:"Chaos",displayName:"Tango Accordion"},{id:"0230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tango Accordion"},{id:"0230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tango Accordion"},{id:"0230_JCLive_sf2_file",library:"JCLive",displayName:"Tango Accordion"},{id:"0230_SBLive_sf2",library:"SBLive",displayName:"Tango Accordion"},{id:"0230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tango Accordion"},{id:"0240_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (nylon)"},{id:"0240_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (nylon)"},{id:"0240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (nylon)"},{id:"0240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (nylon)"},{id:"0240_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (nylon)"},{id:"0250_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (steel)"},{id:"0250_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (steel)"},{id:"0250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (steel)"},{id:"0250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (steel)"},{id:"0250_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (steel)"},{id:"0260_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (jazz)"},{id:"0260_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (jazz)"},{id:"0260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (jazz)"},{id:"0260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (jazz)"},{id:"0260_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (jazz)"},{id:"0270_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (clean)"},{id:"0270_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (clean)"},{id:"0270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (clean)"},{id:"0270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (clean)"},{id:"0270_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (clean)"},{id:"0270_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (clean)"},{id:"0270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (clean)"},{id:"0280_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (muted)"},{id:"0280_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (muted)"},{id:"0280_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (muted)"},{id:"0280_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (muted)"},{id:"0280_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (muted)"},{id:"0280_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (muted)"},{id:"0280_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (muted)"},{id:"0290_Aspirin_sf2_file",library:"Aspirin",displayName:"Overdriven Guitar"},{id:"0290_Chaos_sf2_file",library:"Chaos",displayName:"Overdriven Guitar"},{id:"0290_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Overdriven Guitar"},{id:"0290_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Overdriven Guitar"},{id:"0290_JCLive_sf2_file",library:"JCLive",displayName:"Overdriven Guitar"},{id:"0290_SBLive_sf2",library:"SBLive",displayName:"Overdriven Guitar"},{id:"0290_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Overdriven Guitar"},{id:"0300_Aspirin_sf2_file",library:"Aspirin",displayName:"Distortion Guitar"},{id:"0300_Chaos_sf2_file",library:"Chaos",displayName:"Distortion Guitar"},{id:"0300_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Distortion Guitar"},{id:"0300_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Distortion Guitar"},{id:"0300_JCLive_sf2_file",library:"JCLive",displayName:"Distortion Guitar"},{id:"0300_SBLive_sf2",library:"SBLive",displayName:"Distortion Guitar"},{id:"0300_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Distortion Guitar"},{id:"0310_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Harmonics"},{id:"0310_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Harmonics"},{id:"0310_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Harmonics"},{id:"0310_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Harmonics"},{id:"0310_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Harmonics"},{id:"0310_SBLive_sf2",library:"SBLive",displayName:"Guitar Harmonics"},{id:"0310_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Harmonics"},{id:"0320_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Bass"},{id:"0320_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Bass"},{id:"0320_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Bass"},{id:"0320_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Bass"},{id:"0320_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Bass"},{id:"0320_SBLive_sf2",library:"SBLive",displayName:"Acoustic Bass"},{id:"0320_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Bass"},{id:"0330_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (finger)"},{id:"0330_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (finger)"},{id:"0330_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (finger)"},{id:"0330_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (finger)"},{id:"0330_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (finger)"},{id:"0330_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (finger)"},{id:"0330_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (finger)"},{id:"0340_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (pick)"},{id:"0340_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (pick)"},{id:"0340_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (pick)"},{id:"0340_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (pick)"},{id:"0340_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (pick)"},{id:"0340_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (pick)"},{id:"0340_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (pick)"},{id:"0350_Aspirin_sf2_file",library:"Aspirin",displayName:"Fretless Bass"},{id:"0350_Chaos_sf2_file",library:"Chaos",displayName:"Fretless Bass"},{id:"0350_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fretless Bass"},{id:"0350_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fretless Bass"},{id:"0350_JCLive_sf2_file",library:"JCLive",displayName:"Fretless Bass"},{id:"0350_SBLive_sf2",library:"SBLive",displayName:"Fretless Bass"},{id:"0350_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fretless Bass"},{id:"0360_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 1"},{id:"0360_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 1"},{id:"0360_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 1"},{id:"0360_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 1"},{id:"0360_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 1"},{id:"0360_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 1"},{id:"0360_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 1"},{id:"0370_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 2"},{id:"0370_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 2"},{id:"0370_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 2"},{id:"0370_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 2"},{id:"0370_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 2"},{id:"0370_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 2"},{id:"0370_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 2"},{id:"0380_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 1"},{id:"0380_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 1"},{id:"0380_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 1"},{id:"0380_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 1"},{id:"0380_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 1"},{id:"0380_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 1"},{id:"0380_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 1"},{id:"0390_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 2"},{id:"0390_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 2"},{id:"0390_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 2"},{id:"0390_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 2"},{id:"0390_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 2"},{id:"0390_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 2"},{id:"0390_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 2"},{id:"0400_Aspirin_sf2_file",library:"Aspirin",displayName:"Violin"},{id:"0400_Chaos_sf2_file",library:"Chaos",displayName:"Violin"},{id:"0400_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Violin"},{id:"0400_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Violin"},{id:"0400_JCLive_sf2_file",library:"JCLive",displayName:"Violin"},{id:"0400_SBLive_sf2",library:"SBLive",displayName:"Violin"},{id:"0400_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Violin"},{id:"0410_Aspirin_sf2_file",library:"Aspirin",displayName:"Viola"},{id:"0410_Chaos_sf2_file",library:"Chaos",displayName:"Viola"},{id:"0410_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Viola"},{id:"0410_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Viola"},{id:"0410_JCLive_sf2_file",library:"JCLive",displayName:"Viola"},{id:"0410_SBLive_sf2",library:"SBLive",displayName:"Viola"},{id:"0410_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Viola"},{id:"0420_Aspirin_sf2_file",library:"Aspirin",displayName:"Cello"},{id:"0420_Chaos_sf2_file",library:"Chaos",displayName:"Cello"},{id:"0420_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Cello"},{id:"0420_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Cello"},{id:"0420_JCLive_sf2_file",library:"JCLive",displayName:"Cello"},{id:"0420_SBLive_sf2",library:"SBLive",displayName:"Cello"},{id:"0420_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Cello"},{id:"0430_Aspirin_sf2_file",library:"Aspirin",displayName:"Contrabass"},{id:"0430_Chaos_sf2_file",library:"Chaos",displayName:"Contrabass"},{id:"0430_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Contrabass"},{id:"0430_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Contrabass"},{id:"0430_JCLive_sf2_file",library:"JCLive",displayName:"Contrabass"},{id:"0430_SBLive_sf2",library:"SBLive",displayName:"Contrabass"},{id:"0430_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Contrabass"},{id:"0440_Aspirin_sf2_file",library:"Aspirin",displayName:"Tremolo Strings"},{id:"0440_Chaos_sf2_file",library:"Chaos",displayName:"Tremolo Strings"},{id:"0440_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tremolo Strings"},{id:"0440_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tremolo Strings"},{id:"0440_JCLive_sf2_file",library:"JCLive",displayName:"Tremolo Strings"},{id:"0440_SBLive_sf2",library:"SBLive",displayName:"Tremolo Strings"},{id:"0440_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tremolo Strings"},{id:"0450_Aspirin_sf2_file",library:"Aspirin",displayName:"Pizzicato Strings"},{id:"0450_Chaos_sf2_file",library:"Chaos",displayName:"Pizzicato Strings"},{id:"0450_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pizzicato Strings"},{id:"0450_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pizzicato Strings"},{id:"0450_JCLive_sf2_file",library:"JCLive",displayName:"Pizzicato Strings"},{id:"0450_SBLive_sf2",library:"SBLive",displayName:"Pizzicato Strings"},{id:"0450_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pizzicato Strings"},{id:"0460_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestral Harp"},{id:"0460_Chaos_sf2_file",library:"Chaos",displayName:"Orchestral Harp"},{id:"0460_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestral Harp"},{id:"0460_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestral Harp"},{id:"0460_JCLive_sf2_file",library:"JCLive",displayName:"Orchestral Harp"},{id:"0460_SBLive_sf2",library:"SBLive",displayName:"Orchestral Harp"},{id:"0460_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestral Harp"},{id:"0470_Aspirin_sf2_file",library:"Aspirin",displayName:"Timpani"},{id:"0470_Chaos_sf2_file",library:"Chaos",displayName:"Timpani"},{id:"0470_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Timpani"},{id:"0470_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Timpani"},{id:"0470_JCLive_sf2_file",library:"JCLive",displayName:"Timpani"},{id:"0470_SBLive_sf2",library:"SBLive",displayName:"Timpani"},{id:"0470_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Timpani"},{id:"0480_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 1"},{id:"0480_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 1"},{id:"0480_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 1"},{id:"0480_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 1"},{id:"0480_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 1"},{id:"0480_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 1"},{id:"0480_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 1"},{id:"0490_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 2"},{id:"0490_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 2"},{id:"0490_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 2"},{id:"0490_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 2"},{id:"0490_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 2"},{id:"0490_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 2"},{id:"0490_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 2"},{id:"0500_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 1"},{id:"0500_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 1"},{id:"0500_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 1"},{id:"0500_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 1"},{id:"0500_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 1"},{id:"0500_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 1"},{id:"0500_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 1"},{id:"0510_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 2"},{id:"0510_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 2"},{id:"0510_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 2"},{id:"0510_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 2"},{id:"0510_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 2"},{id:"0510_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 2"},{id:"0510_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 2"},{id:"0520_Aspirin_sf2_file",library:"Aspirin",displayName:"Choir Aahs"},{id:"0520_Chaos_sf2_file",library:"Chaos",displayName:"Choir Aahs"},{id:"0520_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Choir Aahs"},{id:"0520_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Choir Aahs"},{id:"0520_JCLive_sf2_file",library:"JCLive",displayName:"Choir Aahs"},{id:"0520_SBLive_sf2",library:"SBLive",displayName:"Choir Aahs"},{id:"0520_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Choir Aahs"},{id:"0530_Aspirin_sf2_file",library:"Aspirin",displayName:"Voice Oohs"},{id:"0530_Chaos_sf2_file",library:"Chaos",displayName:"Voice Oohs"},{id:"0530_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Voice Oohs"},{id:"0530_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Voice Oohs"},{id:"0530_JCLive_sf2_file",library:"JCLive",displayName:"Voice Oohs"},{id:"0530_SBLive_sf2",library:"SBLive",displayName:"Voice Oohs"},{id:"0530_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Voice Oohs"},{id:"0540_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Choir"},{id:"0540_Chaos_sf2_file",library:"Chaos",displayName:"Synth Choir"},{id:"0540_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Choir"},{id:"0540_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Choir"},{id:"0540_JCLive_sf2_file",library:"JCLive",displayName:"Synth Choir"},{id:"0540_SBLive_sf2",library:"SBLive",displayName:"Synth Choir"},{id:"0540_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Choir"},{id:"0550_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestra Hit"},{id:"0550_Chaos_sf2_file",library:"Chaos",displayName:"Orchestra Hit"},{id:"0550_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestra Hit"},{id:"0550_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestra Hit"},{id:"0550_JCLive_sf2_file",library:"JCLive",displayName:"Orchestra Hit"},{id:"0550_SBLive_sf2",library:"SBLive",displayName:"Orchestra Hit"},{id:"0550_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestra Hit"},{id:"0560_Aspirin_sf2_file",library:"Aspirin",displayName:"Trumpet"},{id:"0560_Chaos_sf2_file",library:"Chaos",displayName:"Trumpet"},{id:"0560_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trumpet"},{id:"0560_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trumpet"},{id:"0560_JCLive_sf2_file",library:"JCLive",displayName:"Trumpet"},{id:"0560_SBLive_sf2",library:"SBLive",displayName:"Trumpet"},{id:"0560_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trumpet"},{id:"0570_Aspirin_sf2_file",library:"Aspirin",displayName:"Trombone"},{id:"0570_Chaos_sf2_file",library:"Chaos",displayName:"Trombone"},{id:"0570_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trombone"},{id:"0570_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trombone"},{id:"0570_JCLive_sf2_file",library:"JCLive",displayName:"Trombone"},{id:"0570_SBLive_sf2",library:"SBLive",displayName:"Trombone"},{id:"0570_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trombone"},{id:"0580_Aspirin_sf2_file",library:"Aspirin",displayName:"Tuba"},{id:"0580_Chaos_sf2_file",library:"Chaos",displayName:"Tuba"},{id:"0580_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tuba"},{id:"0580_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tuba"},{id:"0580_JCLive_sf2_file",library:"JCLive",displayName:"Tuba"},{id:"0580_SBLive_sf2",library:"SBLive",displayName:"Tuba"},{id:"0580_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tuba"},{id:"0590_Aspirin_sf2_file",library:"Aspirin",displayName:"Muted Trumpet"},{id:"0590_Chaos_sf2_file",library:"Chaos",displayName:"Muted Trumpet"},{id:"0590_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Muted Trumpet"},{id:"0590_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Muted Trumpet"},{id:"0590_JCLive_sf2_file",library:"JCLive",displayName:"Muted Trumpet"},{id:"0590_SBLive_sf2",library:"SBLive",displayName:"Muted Trumpet"},{id:"0590_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Muted Trumpet"},{id:"0600_Aspirin_sf2_file",library:"Aspirin",displayName:"French Horn"},{id:"0600_Chaos_sf2_file",library:"Chaos",displayName:"French Horn"},{id:"0600_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"French Horn"},{id:"0600_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"French Horn"},{id:"0600_JCLive_sf2_file",library:"JCLive",displayName:"French Horn"},{id:"0600_SBLive_sf2",library:"SBLive",displayName:"French Horn"},{id:"0600_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"French Horn"},{id:"0610_Aspirin_sf2_file",library:"Aspirin",displayName:"Brass Section"},{id:"0610_Chaos_sf2_file",library:"Chaos",displayName:"Brass Section"},{id:"0610_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Brass Section"},{id:"0610_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Brass Section"},{id:"0610_JCLive_sf2_file",library:"JCLive",displayName:"Brass Section"},{id:"0610_SBLive_sf2",library:"SBLive",displayName:"Brass Section"},{id:"0610_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Brass Section"},{id:"0620_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 1"},{id:"0620_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 1"},{id:"0620_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 1"},{id:"0620_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 1"},{id:"0620_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 1"},{id:"0620_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 1"},{id:"0620_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 1"},{id:"0630_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 2"},{id:"0630_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 2"},{id:"0630_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 2"},{id:"0630_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 2"},{id:"0630_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 2"},{id:"0630_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 2"},{id:"0630_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 2"},{id:"0640_Aspirin_sf2_file",library:"Aspirin",displayName:"Soprano Sax"},{id:"0640_Chaos_sf2_file",library:"Chaos",displayName:"Soprano Sax"},{id:"0640_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Soprano Sax"},{id:"0640_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Soprano Sax"},{id:"0640_JCLive_sf2_file",library:"JCLive",displayName:"Soprano Sax"},{id:"0640_SBLive_sf2",library:"SBLive",displayName:"Soprano Sax"},{id:"0640_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Soprano Sax"},{id:"0650_Aspirin_sf2_file",library:"Aspirin",displayName:"Alto Sax"},{id:"0650_Chaos_sf2_file",library:"Chaos",displayName:"Alto Sax"},{id:"0650_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Alto Sax"},{id:"0650_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Alto Sax"},{id:"0650_JCLive_sf2_file",library:"JCLive",displayName:"Alto Sax"},{id:"0650_SBLive_sf2",library:"SBLive",displayName:"Alto Sax"},{id:"0650_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Alto Sax"},{id:"0660_Aspirin_sf2_file",library:"Aspirin",displayName:"Tenor Sax"},{id:"0660_Chaos_sf2_file",library:"Chaos",displayName:"Tenor Sax"},{id:"0660_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tenor Sax"},{id:"0660_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tenor Sax"},{id:"0660_JCLive_sf2_file",library:"JCLive",displayName:"Tenor Sax"},{id:"0660_SBLive_sf2",library:"SBLive",displayName:"Tenor Sax"},{id:"0660_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tenor Sax"},{id:"0670_Aspirin_sf2_file",library:"Aspirin",displayName:"Baritone Sax"},{id:"0670_Chaos_sf2_file",library:"Chaos",displayName:"Baritone Sax"},{id:"0670_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Baritone Sax"},{id:"0670_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Baritone Sax"},{id:"0670_JCLive_sf2_file",library:"JCLive",displayName:"Baritone Sax"},{id:"0670_SBLive_sf2",library:"SBLive",displayName:"Baritone Sax"},{id:"0670_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Baritone Sax"},{id:"0680_Aspirin_sf2_file",library:"Aspirin",displayName:"Oboe"},{id:"0680_Chaos_sf2_file",library:"Chaos",displayName:"Oboe"},{id:"0680_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Oboe"},{id:"0680_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Oboe"},{id:"0680_JCLive_sf2_file",library:"JCLive",displayName:"Oboe"},{id:"0680_SBLive_sf2",library:"SBLive",displayName:"Oboe"},{id:"0680_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Oboe"},{id:"0690_Aspirin_sf2_file",library:"Aspirin",displayName:"English Horn"},{id:"0690_Chaos_sf2_file",library:"Chaos",displayName:"English Horn"},{id:"0690_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"English Horn"},{id:"0690_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"English Horn"},{id:"0690_JCLive_sf2_file",library:"JCLive",displayName:"English Horn"},{id:"0690_SBLive_sf2",library:"SBLive",displayName:"English Horn"},{id:"0690_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"English Horn"},{id:"0700_Aspirin_sf2_file",library:"Aspirin",displayName:"Bassoon"},{id:"0700_Chaos_sf2_file",library:"Chaos",displayName:"Bassoon"},{id:"0700_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bassoon"},{id:"0700_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bassoon"},{id:"0700_JCLive_sf2_file",library:"JCLive",displayName:"Bassoon"},{id:"0700_SBLive_sf2",library:"SBLive",displayName:"Bassoon"},{id:"0700_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bassoon"},{id:"0710_Aspirin_sf2_file",library:"Aspirin",displayName:"Clarinet"},{id:"0710_Chaos_sf2_file",library:"Chaos",displayName:"Clarinet"},{id:"0710_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clarinet"},{id:"0710_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clarinet"},{id:"0710_JCLive_sf2_file",library:"JCLive",displayName:"Clarinet"},{id:"0710_SBLive_sf2",library:"SBLive",displayName:"Clarinet"},{id:"0710_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clarinet"},{id:"0720_Aspirin_sf2_file",library:"Aspirin",displayName:"Piccolo"},{id:"0720_Chaos_sf2_file",library:"Chaos",displayName:"Piccolo"},{id:"0720_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Piccolo"},{id:"0720_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Piccolo"},{id:"0720_JCLive_sf2_file",library:"JCLive",displayName:"Piccolo"},{id:"0720_SBLive_sf2",library:"SBLive",displayName:"Piccolo"},{id:"0720_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Piccolo"},{id:"0730_Aspirin_sf2_file",library:"Aspirin",displayName:"Flute"},{id:"0730_Chaos_sf2_file",library:"Chaos",displayName:"Flute"},{id:"0730_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Flute"},{id:"0730_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Flute"},{id:"0730_JCLive_sf2_file",library:"JCLive",displayName:"Flute"},{id:"0730_SBLive_sf2",library:"SBLive",displayName:"Flute"},{id:"0730_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Flute"},{id:"0740_Aspirin_sf2_file",library:"Aspirin",displayName:"Recorder"},{id:"0740_Chaos_sf2_file",library:"Chaos",displayName:"Recorder"},{id:"0740_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Recorder"},{id:"0740_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Recorder"},{id:"0740_JCLive_sf2_file",library:"JCLive",displayName:"Recorder"},{id:"0740_SBLive_sf2",library:"SBLive",displayName:"Recorder"},{id:"0740_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Recorder"},{id:"0750_Aspirin_sf2_file",library:"Aspirin",displayName:"Pan Flute"},{id:"0750_Chaos_sf2_file",library:"Chaos",displayName:"Pan Flute"},{id:"0750_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pan Flute"},{id:"0750_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pan Flute"},{id:"0750_JCLive_sf2_file",library:"JCLive",displayName:"Pan Flute"},{id:"0750_SBLive_sf2",library:"SBLive",displayName:"Pan Flute"},{id:"0750_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pan Flute"},{id:"0760_Aspirin_sf2_file",library:"Aspirin",displayName:"Blown Bottle"},{id:"0760_Chaos_sf2_file",library:"Chaos",displayName:"Blown Bottle"},{id:"0760_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Blown Bottle"},{id:"0760_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Blown Bottle"},{id:"0760_JCLive_sf2_file",library:"JCLive",displayName:"Blown Bottle"},{id:"0760_SBLive_sf2",library:"SBLive",displayName:"Blown Bottle"},{id:"0760_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Blown Bottle"},{id:"0770_Aspirin_sf2_file",library:"Aspirin",displayName:"Shakuhachi"},{id:"0770_Chaos_sf2_file",library:"Chaos",displayName:"Shakuhachi"},{id:"0770_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shakuhachi"},{id:"0770_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shakuhachi"},{id:"0770_JCLive_sf2_file",library:"JCLive",displayName:"Shakuhachi"},{id:"0770_SBLive_sf2",library:"SBLive",displayName:"Shakuhachi"},{id:"0770_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shakuhachi"},{id:"0780_Aspirin_sf2_file",library:"Aspirin",displayName:"Whistle"},{id:"0780_Chaos_sf2_file",library:"Chaos",displayName:"Whistle"},{id:"0780_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Whistle"},{id:"0780_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Whistle"},{id:"0780_JCLive_sf2_file",library:"JCLive",displayName:"Whistle"},{id:"0780_SBLive_sf2",library:"SBLive",displayName:"Whistle"},{id:"0780_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Whistle"},{id:"0790_Aspirin_sf2_file",library:"Aspirin",displayName:"Ocarina"},{id:"0790_Chaos_sf2_file",library:"Chaos",displayName:"Ocarina"},{id:"0790_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Ocarina"},{id:"0790_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Ocarina"},{id:"0790_JCLive_sf2_file",library:"JCLive",displayName:"Ocarina"},{id:"0790_SBLive_sf2",library:"SBLive",displayName:"Ocarina"},{id:"0790_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Ocarina"},{id:"0800_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 1 (square)"},{id:"0800_Chaos_sf2_file",library:"Chaos",displayName:"Lead 1 (square)"},{id:"0800_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 1 (square)"},{id:"0800_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 1 (square)"},{id:"0800_JCLive_sf2_file",library:"JCLive",displayName:"Lead 1 (square)"},{id:"0800_SBLive_sf2",library:"SBLive",displayName:"Lead 1 (square)"},{id:"0800_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 1 (square)"},{id:"0810_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 2 (sawtooth)"},{id:"0810_Chaos_sf2_file",library:"Chaos",displayName:"Lead 2 (sawtooth)"},{id:"0810_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 2 (sawtooth)"},{id:"0810_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 2 (sawtooth)"},{id:"0810_JCLive_sf2_file",library:"JCLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SBLive_sf2",library:"SBLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 2 (sawtooth)"},{id:"0820_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 3 (calliope)"},{id:"0820_Chaos_sf2_file",library:"Chaos",displayName:"Lead 3 (calliope)"},{id:"0820_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 3 (calliope)"},{id:"0820_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 3 (calliope)"},{id:"0820_JCLive_sf2_file",library:"JCLive",displayName:"Lead 3 (calliope)"},{id:"0820_SBLive_sf2",library:"SBLive",displayName:"Lead 3 (calliope)"},{id:"0820_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 3 (calliope)"},{id:"0830_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 4 (chiff)"},{id:"0830_Chaos_sf2_file",library:"Chaos",displayName:"Lead 4 (chiff)"},{id:"0830_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 4 (chiff)"},{id:"0830_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 4 (chiff)"},{id:"0830_JCLive_sf2_file",library:"JCLive",displayName:"Lead 4 (chiff)"},{id:"0830_SBLive_sf2",library:"SBLive",displayName:"Lead 4 (chiff)"},{id:"0830_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 4 (chiff)"},{id:"0840_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 5 (charang)"},{id:"0840_Chaos_sf2_file",library:"Chaos",displayName:"Lead 5 (charang)"},{id:"0840_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 5 (charang)"},{id:"0840_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 5 (charang)"},{id:"0840_JCLive_sf2_file",library:"JCLive",displayName:"Lead 5 (charang)"},{id:"0840_SBLive_sf2",library:"SBLive",displayName:"Lead 5 (charang)"},{id:"0840_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 5 (charang)"},{id:"0850_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 6 (voice)"},{id:"0850_Chaos_sf2_file",library:"Chaos",displayName:"Lead 6 (voice)"},{id:"0850_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 6 (voice)"},{id:"0850_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 6 (voice)"},{id:"0850_JCLive_sf2_file",library:"JCLive",displayName:"Lead 6 (voice)"},{id:"0850_SBLive_sf2",library:"SBLive",displayName:"Lead 6 (voice)"},{id:"0850_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 6 (voice)"},{id:"0860_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 7 (fifths)"},{id:"0860_Chaos_sf2_file",library:"Chaos",displayName:"Lead 7 (fifths)"},{id:"0860_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 7 (fifths)"},{id:"0860_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 7 (fifths)"},{id:"0860_JCLive_sf2_file",library:"JCLive",displayName:"Lead 7 (fifths)"},{id:"0860_SBLive_sf2",library:"SBLive",displayName:"Lead 7 (fifths)"},{id:"0860_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 7 (fifths)"},{id:"0870_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 8 (bass + lead)"},{id:"0870_Chaos_sf2_file",library:"Chaos",displayName:"Lead 8 (bass + lead)"},{id:"0870_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 8 (bass + lead)"},{id:"0870_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 8 (bass + lead)"},{id:"0870_JCLive_sf2_file",library:"JCLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SBLive_sf2",library:"SBLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 8 (bass + lead)"},{id:"0880_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 1 (new age)"},{id:"0880_Chaos_sf2_file",library:"Chaos",displayName:"Pad 1 (new age)"},{id:"0880_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 1 (new age)"},{id:"0880_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 1 (new age)"},{id:"0880_JCLive_sf2_file",library:"JCLive",displayName:"Pad 1 (new age)"},{id:"0880_SBLive_sf2",library:"SBLive",displayName:"Pad 1 (new age)"},{id:"0880_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 1 (new age)"},{id:"0890_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 2 (warm)"},{id:"0890_Chaos_sf2_file",library:"Chaos",displayName:"Pad 2 (warm)"},{id:"0890_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 2 (warm)"},{id:"0890_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 2 (warm)"},{id:"0890_JCLive_sf2_file",library:"JCLive",displayName:"Pad 2 (warm)"},{id:"0890_SBLive_sf2",library:"SBLive",displayName:"Pad 2 (warm)"},{id:"0890_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 2 (warm)"},{id:"0900_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 3 (polysynth)"},{id:"0900_Chaos_sf2_file",library:"Chaos",displayName:"Pad 3 (polysynth)"},{id:"0900_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 3 (polysynth)"},{id:"0900_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 3 (polysynth)"},{id:"0900_JCLive_sf2_file",library:"JCLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SBLive_sf2",library:"SBLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 3 (polysynth)"},{id:"0910_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 4 (choir)"},{id:"0910_Chaos_sf2_file",library:"Chaos",displayName:"Pad 4 (choir)"},{id:"0910_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 4 (choir)"},{id:"0910_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 4 (choir)"},{id:"0910_JCLive_sf2_file",library:"JCLive",displayName:"Pad 4 (choir)"},{id:"0910_SBLive_sf2",library:"SBLive",displayName:"Pad 4 (choir)"},{id:"0910_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 4 (choir)"},{id:"0920_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 5 (bowed)"},{id:"0920_Chaos_sf2_file",library:"Chaos",displayName:"Pad 5 (bowed)"},{id:"0920_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 5 (bowed)"},{id:"0920_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 5 (bowed)"},{id:"0920_JCLive_sf2_file",library:"JCLive",displayName:"Pad 5 (bowed)"},{id:"0920_SBLive_sf2",library:"SBLive",displayName:"Pad 5 (bowed)"},{id:"0920_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 5 (bowed)"},{id:"0930_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 6 (metallic)"},{id:"0930_Chaos_sf2_file",library:"Chaos",displayName:"Pad 6 (metallic)"},{id:"0930_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 6 (metallic)"},{id:"0930_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 6 (metallic)"},{id:"0930_JCLive_sf2_file",library:"JCLive",displayName:"Pad 6 (metallic)"},{id:"0930_SBLive_sf2",library:"SBLive",displayName:"Pad 6 (metallic)"},{id:"0930_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 6 (metallic)"},{id:"0940_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 7 (halo)"},{id:"0940_Chaos_sf2_file",library:"Chaos",displayName:"Pad 7 (halo)"},{id:"0940_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 7 (halo)"},{id:"0940_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 7 (halo)"},{id:"0940_JCLive_sf2_file",library:"JCLive",displayName:"Pad 7 (halo)"},{id:"0940_SBLive_sf2",library:"SBLive",displayName:"Pad 7 (halo)"},{id:"0940_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 7 (halo)"},{id:"0950_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 8 (sweep)"},{id:"0950_Chaos_sf2_file",library:"Chaos",displayName:"Pad 8 (sweep)"},{id:"0950_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 8 (sweep)"},{id:"0950_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 8 (sweep)"},{id:"0950_JCLive_sf2_file",library:"JCLive",displayName:"Pad 8 (sweep)"},{id:"0950_SBLive_sf2",library:"SBLive",displayName:"Pad 8 (sweep)"},{id:"0950_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 8 (sweep)"},{id:"0960_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 1 (rain)"},{id:"0960_Chaos_sf2_file",library:"Chaos",displayName:"FX 1 (rain)"},{id:"0960_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 1 (rain)"},{id:"0960_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 1 (rain)"},{id:"0960_JCLive_sf2_file",library:"JCLive",displayName:"FX 1 (rain)"},{id:"0960_SBLive_sf2",library:"SBLive",displayName:"FX 1 (rain)"},{id:"0960_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 1 (rain)"},{id:"0970_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 2 (soundtrack)"},{id:"0970_Chaos_sf2_file",library:"Chaos",displayName:"FX 2 (soundtrack)"},{id:"0970_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 2 (soundtrack)"},{id:"0970_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 2 (soundtrack)"},{id:"0970_JCLive_sf2_file",library:"JCLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SBLive_sf2",library:"SBLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 2 (soundtrack)"},{id:"0980_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 3 (crystal)"},{id:"0980_Chaos_sf2_file",library:"Chaos",displayName:"FX 3 (crystal)"},{id:"0980_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 3 (crystal)"},{id:"0980_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 3 (crystal)"},{id:"0980_JCLive_sf2_file",library:"JCLive",displayName:"FX 3 (crystal)"},{id:"0980_SBLive_sf2",library:"SBLive",displayName:"FX 3 (crystal)"},{id:"0980_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 3 (crystal)"},{id:"0990_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 4 (atmosphere)"},{id:"0990_Chaos_sf2_file",library:"Chaos",displayName:"FX 4 (atmosphere)"},{id:"0990_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 4 (atmosphere)"},{id:"0990_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 4 (atmosphere)"},{id:"0990_JCLive_sf2_file",library:"JCLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SBLive_sf2",library:"SBLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 4 (atmosphere)"},{id:"1000_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 5 (brightness)"},{id:"1000_Chaos_sf2_file",library:"Chaos",displayName:"FX 5 (brightness)"},{id:"1000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 5 (brightness)"},{id:"1000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 5 (brightness)"},{id:"1000_JCLive_sf2_file",library:"JCLive",displayName:"FX 5 (brightness)"},{id:"1000_SBLive_sf2",library:"SBLive",displayName:"FX 5 (brightness)"},{id:"1000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 5 (brightness)"},{id:"1010_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 6 (goblins)"},{id:"1010_Chaos_sf2_file",library:"Chaos",displayName:"FX 6 (goblins)"},{id:"1010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 6 (goblins)"},{id:"1010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 6 (goblins)"},{id:"1010_JCLive_sf2_file",library:"JCLive",displayName:"FX 6 (goblins)"},{id:"1010_SBLive_sf2",library:"SBLive",displayName:"FX 6 (goblins)"},{id:"1010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 6 (goblins)"},{id:"1020_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 7 (echoes)"},{id:"1020_Chaos_sf2_file",library:"Chaos",displayName:"FX 7 (echoes)"},{id:"1020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 7 (echoes)"},{id:"1020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 7 (echoes)"},{id:"1020_JCLive_sf2_file",library:"JCLive",displayName:"FX 7 (echoes)"},{id:"1020_SBLive_sf2",library:"SBLive",displayName:"FX 7 (echoes)"},{id:"1020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 7 (echoes)"},{id:"1030_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 8 (sci-fi)"},{id:"1030_Chaos_sf2_file",library:"Chaos",displayName:"FX 8 (sci-fi)"},{id:"1030_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 8 (sci-fi)"},{id:"1030_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 8 (sci-fi)"},{id:"1030_JCLive_sf2_file",library:"JCLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SBLive_sf2",library:"SBLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 8 (sci-fi)"},{id:"1040_Aspirin_sf2_file",library:"Aspirin",displayName:"Sitar"},{id:"1040_Chaos_sf2_file",library:"Chaos",displayName:"Sitar"},{id:"1040_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Sitar"},{id:"1040_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Sitar"},{id:"1040_JCLive_sf2_file",library:"JCLive",displayName:"Sitar"},{id:"1040_SBLive_sf2",library:"SBLive",displayName:"Sitar"},{id:"1040_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Sitar"},{id:"1050_Aspirin_sf2_file",library:"Aspirin",displayName:"Banjo"},{id:"1050_Chaos_sf2_file",library:"Chaos",displayName:"Banjo"},{id:"1050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Banjo"},{id:"1050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Banjo"},{id:"1050_JCLive_sf2_file",library:"JCLive",displayName:"Banjo"},{id:"1050_SBLive_sf2",library:"SBLive",displayName:"Banjo"},{id:"1050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Banjo"},{id:"1060_Aspirin_sf2_file",library:"Aspirin",displayName:"Shamisen"},{id:"1060_Chaos_sf2_file",library:"Chaos",displayName:"Shamisen"},{id:"1060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shamisen"},{id:"1060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shamisen"},{id:"1060_JCLive_sf2_file",library:"JCLive",displayName:"Shamisen"},{id:"1060_SBLive_sf2",library:"SBLive",displayName:"Shamisen"},{id:"1060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shamisen"},{id:"1070_Aspirin_sf2_file",library:"Aspirin",displayName:"Koto"},{id:"1070_Chaos_sf2_file",library:"Chaos",displayName:"Koto"},{id:"1070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Koto"},{id:"1070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Koto"},{id:"1070_JCLive_sf2_file",library:"JCLive",displayName:"Koto"},{id:"1070_SBLive_sf2",library:"SBLive",displayName:"Koto"},{id:"1070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Koto"},{id:"1080_Aspirin_sf2_file",library:"Aspirin",displayName:"Kalimba"},{id:"1080_Chaos_sf2_file",library:"Chaos",displayName:"Kalimba"},{id:"1080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Kalimba"},{id:"1080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Kalimba"},{id:"1080_JCLive_sf2_file",library:"JCLive",displayName:"Kalimba"},{id:"1080_SBLive_sf2",library:"SBLive",displayName:"Kalimba"},{id:"1080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Kalimba"},{id:"1090_Aspirin_sf2_file",library:"Aspirin",displayName:"Bagpipe"},{id:"1090_Chaos_sf2_file",library:"Chaos",displayName:"Bagpipe"},{id:"1090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bagpipe"},{id:"1090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bagpipe"},{id:"1090_JCLive_sf2_file",library:"JCLive",displayName:"Bagpipe"},{id:"1090_SBLive_sf2",library:"SBLive",displayName:"Bagpipe"},{id:"1090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bagpipe"},{id:"1100_Aspirin_sf2_file",library:"Aspirin",displayName:"Fiddle"},{id:"1100_Chaos_sf2_file",library:"Chaos",displayName:"Fiddle"},{id:"1100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fiddle"},{id:"1100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fiddle"},{id:"1100_JCLive_sf2_file",library:"JCLive",displayName:"Fiddle"},{id:"1100_SBLive_sf2",library:"SBLive",displayName:"Fiddle"},{id:"1100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fiddle"},{id:"1110_Aspirin_sf2_file",library:"Aspirin",displayName:"Shanai"},{id:"1110_Chaos_sf2_file",library:"Chaos",displayName:"Shanai"},{id:"1110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shanai"},{id:"1110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shanai"},{id:"1110_JCLive_sf2_file",library:"JCLive",displayName:"Shanai"},{id:"1110_SBLive_sf2",library:"SBLive",displayName:"Shanai"},{id:"1110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shanai"},{id:"1120_Aspirin_sf2_file",library:"Aspirin",displayName:"Tinkle Bell"},{id:"1120_Chaos_sf2_file",library:"Chaos",displayName:"Tinkle Bell"},{id:"1120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tinkle Bell"},{id:"1120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tinkle Bell"},{id:"1120_JCLive_sf2_file",library:"JCLive",displayName:"Tinkle Bell"},{id:"1120_SBLive_sf2",library:"SBLive",displayName:"Tinkle Bell"},{id:"1120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tinkle Bell"},{id:"1130_Aspirin_sf2_file",library:"Aspirin",displayName:"Agogo"},{id:"1130_Chaos_sf2_file",library:"Chaos",displayName:"Agogo"},{id:"1130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Agogo"},{id:"1130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Agogo"},{id:"1130_JCLive_sf2_file",library:"JCLive",displayName:"Agogo"},{id:"1130_SBLive_sf2",library:"SBLive",displayName:"Agogo"},{id:"1130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Agogo"},{id:"1140_Aspirin_sf2_file",library:"Aspirin",displayName:"Steel Drums"},{id:"1140_Chaos_sf2_file",library:"Chaos",displayName:"Steel Drums"},{id:"1140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Steel Drums"},{id:"1140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Steel Drums"},{id:"1140_JCLive_sf2_file",library:"JCLive",displayName:"Steel Drums"},{id:"1140_SBLive_sf2",library:"SBLive",displayName:"Steel Drums"},{id:"1140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Steel Drums"},{id:"1150_Aspirin_sf2_file",library:"Aspirin",displayName:"Woodblock"},{id:"1150_Chaos_sf2_file",library:"Chaos",displayName:"Woodblock"},{id:"1150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Woodblock"},{id:"1150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Woodblock"},{id:"1150_JCLive_sf2_file",library:"JCLive",displayName:"Woodblock"},{id:"1150_SBLive_sf2",library:"SBLive",displayName:"Woodblock"},{id:"1150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Woodblock"},{id:"1160_Aspirin_sf2_file",library:"Aspirin",displayName:"Taiko Drum"},{id:"1160_Chaos_sf2_file",library:"Chaos",displayName:"Taiko Drum"},{id:"1160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Taiko Drum"},{id:"1160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Taiko Drum"},{id:"1160_JCLive_sf2_file",library:"JCLive",displayName:"Taiko Drum"},{id:"1160_SBLive_sf2",library:"SBLive",displayName:"Taiko Drum"},{id:"1160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Taiko Drum"},{id:"1170_Aspirin_sf2_file",library:"Aspirin",displayName:"Melodic Tom"},{id:"1170_Chaos_sf2_file",library:"Chaos",displayName:"Melodic Tom"},{id:"1170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Melodic Tom"},{id:"1170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Melodic Tom"},{id:"1170_JCLive_sf2_file",library:"JCLive",displayName:"Melodic Tom"},{id:"1170_SBLive_sf2",library:"SBLive",displayName:"Melodic Tom"},{id:"1170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Melodic Tom"},{id:"1180_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Drum"},{id:"1180_Chaos_sf2_file",library:"Chaos",displayName:"Synth Drum"},{id:"1180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Drum"},{id:"1180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Drum"},{id:"1180_JCLive_sf2_file",library:"JCLive",displayName:"Synth Drum"},{id:"1180_SBLive_sf2",library:"SBLive",displayName:"Synth Drum"},{id:"1180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Drum"},{id:"1190_Aspirin_sf2_file",library:"Aspirin",displayName:"Reverse Cymbal"},{id:"1190_Chaos_sf2_file",library:"Chaos",displayName:"Reverse Cymbal"},{id:"1190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reverse Cymbal"},{id:"1190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reverse Cymbal"},{id:"1190_JCLive_sf2_file",library:"JCLive",displayName:"Reverse Cymbal"},{id:"1190_SBLive_sf2",library:"SBLive",displayName:"Reverse Cymbal"},{id:"1190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reverse Cymbal"},{id:"1200_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Fret Noise"},{id:"1200_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Fret Noise"},{id:"1200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Fret Noise"},{id:"1200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Fret Noise"},{id:"1200_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Fret Noise"},{id:"1200_SBLive_sf2",library:"SBLive",displayName:"Guitar Fret Noise"},{id:"1200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Fret Noise"},{id:"1210_Aspirin_sf2_file",library:"Aspirin",displayName:"Breath Noise"},{id:"1210_Chaos_sf2_file",library:"Chaos",displayName:"Breath Noise"},{id:"1210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Breath Noise"},{id:"1210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Breath Noise"},{id:"1210_JCLive_sf2_file",library:"JCLive",displayName:"Breath Noise"},{id:"1210_SBLive_sf2",library:"SBLive",displayName:"Breath Noise"},{id:"1210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Breath Noise"},{id:"1220_Aspirin_sf2_file",library:"Aspirin",displayName:"Seashore"},{id:"1220_Chaos_sf2_file",library:"Chaos",displayName:"Seashore"},{id:"1220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Seashore"},{id:"1220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Seashore"},{id:"1220_JCLive_sf2_file",library:"JCLive",displayName:"Seashore"},{id:"1220_SBLive_sf2",library:"SBLive",displayName:"Seashore"},{id:"1220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Seashore"},{id:"1230_Aspirin_sf2_file",library:"Aspirin",displayName:"Bird Tweet"},{id:"1230_Chaos_sf2_file",library:"Chaos",displayName:"Bird Tweet"},{id:"1230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bird Tweet"},{id:"1230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bird Tweet"},{id:"1230_JCLive_sf2_file",library:"JCLive",displayName:"Bird Tweet"},{id:"1230_SBLive_sf2",library:"SBLive",displayName:"Bird Tweet"},{id:"1230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bird Tweet"},{id:"1240_Aspirin_sf2_file",library:"Aspirin",displayName:"Telephone Ring"},{id:"1240_Chaos_sf2_file",library:"Chaos",displayName:"Telephone Ring"},{id:"1240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Telephone Ring"},{id:"1240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Telephone Ring"},{id:"1240_JCLive_sf2_file",library:"JCLive",displayName:"Telephone Ring"},{id:"1240_SBLive_sf2",library:"SBLive",displayName:"Telephone Ring"},{id:"1240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Telephone Ring"},{id:"1250_Aspirin_sf2_file",library:"Aspirin",displayName:"Helicopter"},{id:"1250_Chaos_sf2_file",library:"Chaos",displayName:"Helicopter"},{id:"1250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Helicopter"},{id:"1250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Helicopter"},{id:"1250_JCLive_sf2_file",library:"JCLive",displayName:"Helicopter"},{id:"1250_SBLive_sf2",library:"SBLive",displayName:"Helicopter"},{id:"1250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Helicopter"},{id:"1260_Aspirin_sf2_file",library:"Aspirin",displayName:"Applause"},{id:"1260_Chaos_sf2_file",library:"Chaos",displayName:"Applause"},{id:"1260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Applause"},{id:"1260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Applause"},{id:"1260_JCLive_sf2_file",library:"JCLive",displayName:"Applause"},{id:"1260_SBLive_sf2",library:"SBLive",displayName:"Applause"},{id:"1260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Applause"},{id:"1270_Aspirin_sf2_file",library:"Aspirin",displayName:"Gunshot"},{id:"1270_Chaos_sf2_file",library:"Chaos",displayName:"Gunshot"},{id:"1270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Gunshot"},{id:"1270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Gunshot"},{id:"1270_JCLive_sf2_file",library:"JCLive",displayName:"Gunshot"},{id:"1270_SBLive_sf2",library:"SBLive",displayName:"Gunshot"},{id:"1270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Gunshot"},{id:"12835_1_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 1"},{id:"12835_1_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 1"},{id:"12835_1_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 1"},{id:"12835_1_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 1"},{id:"12835_2_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 2"},{id:"12835_2_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 2"},{id:"12835_2_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 2"},{id:"12835_2_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 2"},{id:"12835_3_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 3"},{id:"12835_3_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 3"},{id:"12835_3_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 3"},{id:"12835_3_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 3"},{id:"12835_4_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 4"},{id:"12835_4_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 4"},{id:"12835_4_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 4"},{id:"12835_4_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 4"},{id:"12835_5_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 5"},{id:"12835_5_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 5"},{id:"12835_5_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 5"},{id:"12835_5_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 5"},{id:"12835_6_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 6"},{id:"12835_6_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 6"},{id:"12835_6_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 6"},{id:"12835_6_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 6"},{id:"12835_7_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 7"},{id:"12835_7_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 7"},{id:"12835_7_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 7"},{id:"12835_7_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 7"},{id:"12835_8_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 8"},{id:"12835_8_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 8"},{id:"12835_8_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 8"},{id:"12835_8_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 8"},{id:"12835_9_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 9"},{id:"12835_9_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 9"},{id:"12835_9_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 9"},{id:"12835_10_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 10"},{id:"12835_10_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 10"},{id:"12835_10_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 10"},{id:"12835_11_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 11"},{id:"12835_11_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 11"},{id:"12835_11_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 11"},{id:"12835_12_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 12"},{id:"12835_12_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 12"},{id:"12835_13_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 13"},{id:"12835_13_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 13"},{id:"12835_14_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 14"},{id:"12835_14_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 14"},{id:"12835_15_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 15"},{id:"12835_15_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 15"},{id:"12835_16_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 16"},{id:"12835_16_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 16"},{id:"12835_17_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 17"},{id:"12835_17_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 17"},{id:"12835_18_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 18"},{id:"12835_18_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 18"}];function yn(t){const e=1+t%18,i=ht.find(a=>a.id.startsWith(`12835_${e}_`)&&a.library==="FluidR3_GM");if(i)return{library:i.library,displayName:i.displayName};const s=ht.find(a=>a.id.startsWith(`12835_${e}_`));return s?{library:s.library,displayName:s.displayName}:null}const _n=Array.from({length:47},(t,e)=>35+e),gn={35:"kick2",36:"kick1",37:"rim",38:"snare1",39:"clap",40:"snare2",41:"lowtom2",42:"hh_closed",43:"lowtom1",44:"hh_pedal",45:"midtom2",46:"hh_open",47:"midtom1",48:"hitom2",49:"crash1",50:"hitom1",51:"ride1",52:"china",53:"ride_bell",54:"tamb",55:"splash",56:"cowbell",57:"crash2",58:"vibraslap",59:"ride2",60:"bongo_hi",61:"bongo_lo",62:"conga_hi_mute",63:"conga_hi_open",64:"conga_lo",65:"timbale_hi",66:"timbale_lo",67:"agogo_hi",68:"agogo_lo",69:"cabasa",70:"maracas",71:"whistle_short",72:"whistle_long",73:"guiro_short",74:"guiro_long",75:"claves",76:"woodblock_hi",77:"woodblock_lo",78:"cuica_mute",79:"cuica_open",80:"triangle_mute",81:"triangle_open"},zi=Qa,ei=new Map;let te=null;function Xi(t){return Math.max(t,1e-4)}async function Ft(t){return new Promise((e,i)=>{const s=document.createElement("script");s.src=t,s.onload=()=>e(),s.onerror=()=>i(new Error(`Failed to load script: ${t}`)),document.body.appendChild(s)})}async function bn(){te||(await Ft("https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"),te=new window.WebAudioFontPlayer)}async function Li(t,e=z(),i=null,s,a,r,n=!0){const[o,c]=t.split("/"),d=String(e),l=`${o}/${c}@${d}`;ei.has(e)||ei.set(e,new Map);const u=ei.get(e);if(n&&u.has(l))return u.get(l);if(await bn(),te.resumeContext){const C=te.resumeContext;te.resumeContext=M=>{if(!(M instanceof OfflineAudioContext))return C.call(te,M)}}const h=ht.find(C=>C.library===o&&C.displayName===c);if(!h)throw new Error(`Could not find WebAudioFont entry for library=${o} and instrument=${c}`);i&&i.context!==e&&(console.warn("[WebAudioFont] Ignoring mismatched destination from another context"),i=null);const f=i||qe(e),p=e.createStereoPanner();if(p.pan.value=a??0,p.connect(f),!h.displayName.startsWith("Drum Kit")){const C=`_tone_${h.id}`,M=`https://surikov.github.io/webaudiofontdata/sound/${h.id}.js`;r?await Ft(M):await zi(Ft(M));const E=window[C];if(!E)throw new Error(`Missing preset: ${C}`);if(te.loader.decodeAfterLoading(e,C),e instanceof OfflineAudioContext){const L=(E==null?void 0:E.zones)??[];for(const P of L)if(P.file&&!P.buffer){const A=atob(P.file),U=new ArrayBuffer(A.length),D=new Uint8Array(U);for(let q=0;q<A.length;q++)D[q]=A.charCodeAt(q);P.buffer=await new Promise((q,F)=>e.decodeAudioData(U,q,F))}}const k={_preset:E,_volume:s??1,_activeEnvelopes:[],start({note:L,duration:P=1,velocity:A=100,time:U}){const D=typeof L=="string"?K(L):L;if(D==null||typeof D!="number")return;const q=typeof U=="number"?U:0,F=Math.max(.01,Math.min(1,A/127)),w=Xi(k._volume),J=Math.max(.01,Math.min(1,w*F)),T=te.queueWaveTable(e,p||qe(),E,q,D,P,J);k._activeEnvelopes.push(T)},stop(){var L;for(const P of k._activeEnvelopes)try{P.cancel?P.cancel():(L=P.audioBufferSourceNode)!=null&&L.stop&&P.audioBufferSourceNode.stop()}catch(A){console.warn("Failed to stop envelope:",A)}k._activeEnvelopes=[]},setVolume(L){k._volume=Math.max(0,Math.min(1,L))},setPan(L){p.pan.value=Math.max(-1,Math.min(1,L))},load:Promise.resolve()};return n&&u.set(l,k),k}const y=h.id.match(/^12835_(\d+)_([A-Za-z0-9_]+)_sf2_file$/);if(!y)throw new Error(`Invalid drum ID format in catalogue: ${h.id}`);const[,m,_]=y,v=parseInt(m,10),b={},S=async()=>{for(const C of _n){const M=`_drum_${C}_${v}_${_}_sf2_file`,E=`https://surikov.github.io/webaudiofontdata/sound/${12800+C}_${v}_${_}_sf2_file.js`;try{await Ft(E);const k=window[M];if(!k){console.warn(`Missing drum preset: ${M}`);continue}te.loader.decodeAfterLoading(e,M),b[C]=k}catch(k){console.warn(`Failed to load drum preset ${C}: ${k}`)}}};r??!1?await S():await zi(S());const N={_preset:b,_volume:s??1,_activeEnvelopes:[],start({note:C,duration:M=1,velocity:E=100,time:k}){const L=typeof C=="string"?K(C):C;if(L==null||typeof L!="number"){console.warn(`Invalid MIDI pitch: ${C}`);return}const P=b[L];if(!P){console.warn(`No drum preset loaded for MIDI ${L}`);return}const A=typeof k=="number"?k:0,U=Xi(N._volume),D=te.queueWaveTable(e,p||qe(),P,A,L,M,U);N._activeEnvelopes.push(D)},stop(){var C;for(const M of N._activeEnvelopes)try{M.cancel?M.cancel():(C=M.audioBufferSourceNode)!=null&&C.stop&&M.audioBufferSourceNode.stop()}catch(E){console.warn("Failed to stop envelope:",E)}N._activeEnvelopes=[]},load:Promise.resolve(),setVolume(C){N._volume=Math.max(0,Math.min(1,C))},setPan(C){p.pan.value=Math.max(-1,Math.min(1,C))}};return n&&u.set(l,N),N}async function vn(){const t=new Set;for(const e of ht)t.add(e.library);return Array.from(t)}async function Sn(t){return ht.filter(e=>e.library===t).map(e=>e.displayName)}function Nn(){return{name:"webaudiofont",loadInstrument:Li,getAvailableLibraries:vn,getAvailableInstruments:Sn}}let fi=null,hi=null;async function Cn(t){if(hi===t)return;const[,e,i]=t.split("/");fi=await Li(`${e}/${i}`,Ae()),hi=t}function Mn(){return hi}function Bn(t,e=100,i=!1){if(!fi)return null;const a=Ae().currentTime,r=K(t);return r===null?null:(fi.start({note:r,velocity:e,time:a,duration:1.5,loop:i}),()=>{})}function Ln(t){}async function wn(t,e,i,s=100,a=!1,r=null,n=null,o=null,c,d){const l=n||z(),[,u,h]=t.split("/"),f=await Li(`${u}/${h}`,l,o,c,d);c!==void 0&&f.setVolume&&f.setVolume(c),d!==void 0&&f.setPan&&f.setPan(d);const p=K(e);return p===null||f.start({note:p,duration:i,velocity:s,loop:a,time:r??l.currentTime}),null}function Gn(){return{name:"webaudiofont",setActiveInstrument:Cn,getActiveInstrumentName:Mn,playNote:Bn,stopNoteByPitch:Ln,loadAndPlayNote:wn}}const Wt={sf2:pn(),webaudiofont:Gn()};let Je=null;async function zs(t){if(!t.includes("/"))throw new Error(`Invalid instrument name: "${t}". Expected "<engine>/<library>/<instrument>"`);const e=t.split("/")[0],i=Wt[e];if(!i)throw new Error(`Engine "${e}" not available`);await i.setActiveInstrument(t),Je=t}function En(){return Je}function Xs(t,e=100,i=!1){if(!Je)return null;const s=Je.split("/")[0],a=Wt[s];if(!a)throw new Error(`Engine "${s}" not available`);return a.playNote(t,e,i)}function In(t){if(!Je)return;const e=Je.split("/")[0],i=Wt[e];if(!i)throw new Error(`Engine "${e}" not available`);i.stopNoteByPitch(t)}async function kn(t,e,i=1,s=100,a=!1,r=null,n=null,o=null,c,d){const l=t.split("/")[0],u=Wt[l];if(!u)throw new Error(`Engine "${l}" not available`);let h=n??z(),f=o;return h.state==="suspended"&&(console.warn("[loadAndPlayNote] Using preview context due to suspended main context"),h=Ae(),f=ln()),await u.loadAndPlayNote(t,e,i,s,a,r,h,f,c,d)}let ti=null;function z(){return ti||(ti=new(window.AudioContext||window.webkitAudioContext)),ti}const ii=new WeakMap,si=new WeakMap;function Vs(t=z()){if(!si.has(t)){const e=t.createAnalyser();e.fftSize=2048,si.set(t,e)}return si.get(t)}function qe(t=z()){if(!ii.has(t)){const e=t.createGain(),i=Vs(t);e.connect(i),i.connect(t.destination),ii.set(t,e)}return ii.get(t)}function An(t){try{const e=Xs(t,100,!1);return e?{stop:e,forceStop:e}:null}catch(e){return console.error("[playNote] Failed to play note",t,e),null}}const zt={sf2:on(),webaudiofont:Nn()},js="sf2";async function Ys(t,e,i,s,a,r,n=!0){const o=t.split("/");if(o.length!==3)throw new Error(`Invalid instrument fullName format: "${t}". Expected format "engine/library/instrument"`);const[c,d,l]=o,u=zt[c];if(!u)throw new Error(`Engine "${c}" not available`);return await u.loadInstrument(`${d}/${l}`,e,i,s,a,r,n)}async function Fn(t=js){const e=zt[t];if(!e)throw new Error(`Engine "${t}" not available`);return await e.getAvailableLibraries()}async function Pn(t,e=js){const i=zt[e];if(!i)throw new Error(`Engine "${e}" not available`);return await i.getAvailableInstruments(t)}function Tn(){return Object.keys(zt)}const Rn=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],On=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],xn={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function Un(t){return t.includes("#")}function X(t){const e=t==null?void 0:t.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,i,s,a]=e,r=i.toUpperCase(),n=xn[r];if(n===void 0)return null;const o=[...s].reduce((d,l)=>l==="#"?d+1:l==="b"?d-1:d,0);return 12*(parseInt(a,10)+1)+(n+o)}function lt(t){return X(t)}const Dn=t=>{const e=X(t);return e!==null?e%12:0};function wi(t,e=21,i){const s=X(t);if(s===null)return null;const a=i-e+1,r=s-e,n=a-1-r;return n>=0&&n<a?n:null}function Ie(t,e,i){const a=i-e+1-1-t,r=e+a;return Xt(r)}function Xt(t,e=!1){const s=(e?On:Rn)[t%12],a=Math.floor(t/12)-1;return`${s}${a}`}function Zs(t,e){const i=new Map;for(let s=t;s<=e;s++)i.set(s,Un(Xt(s)));return i}function qn(t,e){const i=X(t),s=X(e);if(i===null||s===null)throw new Error(`Invalid pitches provided: ${t}, ${e}`);return i-s}function Jn(t,e){const i=structuredClone(t);return i.tempo=e.bpm,i}function Qs(t){return{type:"CHANGE_TEMPO",bpm:t}}function Hn(t){return Qs(t)}function $n(t,e){const i=structuredClone(t);return i.timeSignature=[e.beats,4],i}function er(t){return{type:"SET_TIME_SIGNATURE",beats:t}}function Kn(t){return er(t)}function Wn(t,e){const i=structuredClone(t);return i.totalMeasures=e.measures,i}function tr(t){return{type:"SET_TOTAL_MEASURES",measures:t}}function zn(t){return tr(t)}function Xn(t,e){const i=structuredClone(t);if(i.sequencers.push({id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan}),!R.find(a=>a.id===e.id)){const a={id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan};Nr(a)}return i}function ir(t,e,i,s){return{type:"CREATE_SEQUENCER",id:t,instrument:e,volume:i,pan:s}}function Gi(t){return{type:"DELETE_SEQUENCER",id:t}}function Vn(t,e){const i=structuredClone(t);i.sequencers=i.sequencers.filter(a=>a.id!==e.id);const s=R.findIndex(a=>a.id===e.id);return s!==-1&&(R[s].destroy(),R.splice(s,1)),i}function sr(t,e,i=[],s,a){return{type:"DELETE_SEQUENCER",id:t,instrument:e,notes:structuredClone(i),volume:s,pan:a}}function rr(t,e,i=[],s,a){return{type:"CREATE_SEQUENCER",id:t,instrument:e,notes:structuredClone(i),volume:s,pan:a}}function jn(t,e){const i=structuredClone(t),s=i.sequencers.find(a=>a.id===e.sequencerId);return s&&e.instrument&&(s.instrument=e.instrument),i}function Yn(t,e){return{type:"SET_INSTRUMENT",sequencerId:t,instrument:e}}function Zn(t,e){return{type:"SET_INSTRUMENT",sequencerId:t,instrument:e}}function Qn(t,e){var a;const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.id);if(s&&typeof e.volume=="number"){s.volume=e.volume;const r=R.find(n=>n.id===e.id);r&&(r.volume=e.volume,(a=r.refreshVolumeUI)==null||a.call(r))}return i}function eo(t,e){return{type:"SET_VOLUME",id:t,volume:e}}function to(t,e){return{type:"SET_VOLUME",id:t,volume:e}}function io(t,e){var a;const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.id);if(s&&typeof e.pan=="number"){s.pan=e.pan;const r=R.find(n=>n.id===e.id);r&&(r.pan=e.pan,(a=r.refreshPanUI)==null||a.call(r))}return i}function so(t,e){return{type:"SET_PAN",id:t,pan:e}}function ro(t,e){return{type:"SET_PAN",id:t,pan:e}}function ao(t,e){const i=structuredClone(t),s=i.sequencers.find(a=>a.id===e.sequencerId);return s?(s.notes.push(...e.notes),i):t}function ar(t,e){return{type:"PLACE_NOTES",sequencerId:t,notes:structuredClone(e)}}function nr(t,e){return{type:"DELETE_NOTES",sequencerId:t,notes:structuredClone(e)}}function no(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const a=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const n=`${r.pitch}|${r.start}|${r.duration}`;return!a.has(n)}),i}function rt(t,e){return{type:"DELETE_NOTES",sequencerId:t,notes:structuredClone(e)}}function at(t,e){return{type:"PLACE_NOTES",sequencerId:t,notes:structuredClone(e)}}function oo(t,e){const i=structuredClone(t),s=i.sequencers.find(n=>n.id===e.sequencerId);if(!s)return t;const a=e.from,r=e.to;for(let n=0;n<a.length;n++){const o=a[n],c=r[n],d=s.notes.findIndex(l=>l.pitch===o.pitch&&l.start===o.start&&l.duration===o.duration);d!==-1&&(s.notes[d].pitch=c.pitch,s.notes[d].start=c.start)}return i}function or(t,e,i){return{type:"MOVE_NOTES",sequencerId:t,from:structuredClone(e),to:structuredClone(i)}}function lo(t,e,i){return or(t,i,e)}function co(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const a=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const n=`${r.pitch}|${r.start}|${r.duration}`;return!a.has(n)}),i}function uo(t,e){const i=structuredClone(t),s=i.sequencers.find(a=>a.id===e.sequencerId);return s?(s.notes.push(...e.notes),i):t}function fo(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const a=e.resizes;for(const r of a){const n=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start);n&&(n.duration=r.newDuration)}return i}function ho(t,e){return{type:"RESIZE_NOTES",sequencerId:t,resizes:structuredClone(e)}}function mo(t,e){const i=e.map(s=>({pitch:s.pitch,start:s.start,newDuration:s.oldDuration}));return{type:"RESIZE_NOTES",sequencerId:t,resizes:i}}function po(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const a=e.notes;for(const r of a){const n=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start&&o.duration===r.duration);n&&(n.velocity=r.velocity)}return i}function yo(t,e){return{type:"SET_NOTE_VELOCITY",sequencerId:t,notes:structuredClone(e)}}function _o(t,e){return{type:"SET_NOTE_VELOCITY",sequencerId:t,notes:structuredClone(e)}}function go(t,e){return structuredClone(t)}function Ei(t=""){return{type:"CHECKPOINT",label:t}}function lr(t=""){return Ei(t)}const bo=Object.freeze(Object.defineProperty({__proto__:null,CHANGE_TEMPO:Jn,CHECKPOINT:go,CREATE_SEQUENCER:Xn,CUT_NOTES:co,DELETE_NOTES:no,DELETE_SEQUENCER:Vn,MOVE_NOTES:oo,PASTE_NOTES:uo,PLACE_NOTES:ao,RESIZE_NOTES:fo,SET_INSTRUMENT:jn,SET_NOTE_VELOCITY:po,SET_PAN:io,SET_TIME_SIGNATURE:$n,SET_TOTAL_MEASURES:Wn,SET_VOLUME:Qn},Symbol.toStringTag,{value:"Module"}));function Ii(t){const e=bo[t.type];if(!e)throw new Error(`Unknown diff type: ${t.type}`);const i=e(Ke(),t);Bo(i)}const mi=new Set;function vo(t){return mi.add(t),()=>mi.delete(t)}function Vt(t){for(const e of mi)e(t)}const ye=[];let ue=-1;const So=100;function No({forwardDiff:t,reverseDiff:e}){ye.splice(ue+1),ye.push({forwardDiff:t,reverseDiff:e}),ue=ye.length-1,ye.length>So&&(ye.shift(),ue--)}function Co(){var t;if(ue<0)return null;for(let e=ue;e>=0;e--){const i=ye[e];if(((t=i==null?void 0:i.forwardDiff)==null?void 0:t.type)==="CHECKPOINT")return null;if(i!=null&&i.reverseDiff)return ue=e-1,Ii(i.reverseDiff),Vt(Ke()),i.reverseDiff}return null}function Mo(){if(ue>=ye.length-1)return null;ue++;const t=ye[ue];return!t||!t.forwardDiff?null:(Ii(t.forwardDiff),Vt(Ke()),t.forwardDiff)}let Rt={tempo:120,timeSignature:[4,4],totalMeasures:8,sequencers:[]};function Ke(){return Rt}function Bo(t){Rt=structuredClone(t),Vt(Rt)}function O(t,e){Ii(t),No({forwardDiff:t,reverseDiff:e}),Vt(Rt)}const Y={cellWidth:40,cellHeight:20,visibleNotes:36,noteRange:["C1","B9"],currentDuration:1,snapResolution:1,isTripletMode:!1,loopEnabled:!1,useEqualTemperament:!0},Lo={4:"",2:"",1:"","0.5":"","0.25":"","0.125":""};let dr=500,cr=!1,ur=4,fr=8;function ae(){return We()*gt()}function ki(t,e=!0){const i=he();if(e){O(Qs(t),Hn(i));return}performance.now(),I.getCurrentBeat(),dr=60/t*1e3,I.isActive()&&I.syncAfterTempoChange(i);const s=document.getElementById("tempo-input");s&&s.value!==String(t)&&(s.value=String(t))}function he(){return 60/(dr/1e3)}function Ai(t,e=!0){if(e){const s=gt();O(er(t),Kn(s));return}ur=t;const i=document.getElementById("beats-per-measure-input");i&&i.value!==String(t)&&(i.value=String(t)),re().forEach(s=>{s.updateBeatsPerMeasure()})}function gt(){return ur}function Fi(t,e=!0){if(e){const s=We();O(tr(t),zn(s));return}fr=t;const i=document.getElementById("measures-input");i&&i.value!==String(t)&&(i.value=String(t))}function We(){return fr}function wo(t){cr=t}function Go(){return cr}async function Eo(t,e,i,s,a,r,n){if(!s||s.length===0)return;const o=60/he();if(n!=null&&n.aborted){console.log("ABORTED Before loading instrument");return}const c=await Ys(t,e,i,a,r);if(n!=null&&n.aborted){console.log("ABORTED After loading instrument");return}for(const d of s){if(n!=null&&n.aborted){console.log("ABORTED During note export");return}const l=d.start*o,u=Math.max(.01,l),h=d.duration*o,f=d.velocity??100,p=X(d.pitch);if(p==null)continue;const g=t.split("/"),m=(g.length>=3?g[1]:g[0])==="drummachines"&&c.__midiMap?c.__midiMap.get(p)??p:p;try{c.start({note:m,duration:h,velocity:f,time:u,loop:!1})}catch(_){console.warn("[exportNotesToOffline] Failed to start note:",d,_)}}}function Vi(t){if(!t.container)return;const e=t.container.querySelector(".mute-btn"),i=t.container.querySelector(".solo-btn"),s=t.container.querySelector(".sequencer-body"),a=t.container.querySelector(".mini-contour");e==null||e.classList.toggle("bg-red-600",t.mute),e==null||e.classList.toggle("bg-gray-700",!t.mute),i==null||i.classList.toggle("bg-yellow-200",t.solo),i==null||i.classList.toggle("bg-gray-700",!t.solo);const r=t.mute&&!t.solo;s==null||s.classList.toggle("opacity-40",r),s==null||s.classList.toggle("opacity-100",!r),a==null||a.classList.toggle("opacity-40",r),a==null||a.classList.toggle("opacity-100",!r)}function Io(t,e,i,s,a){const r=t.querySelector(".zoom-in-btn"),n=t.querySelector(".zoom-out-btn"),o=t.querySelector(".zoom-reset-btn");!r||!n||!o||(a.on(r,"click",e),a.on(n,"click",i),a.on(o,"click",s))}function hr(t,e){var i,s,a,r,n;(i=t.querySelector(".zoom-in-btn"))==null||i.classList.toggle("hidden",!e),(s=t.querySelector(".zoom-out-btn"))==null||s.classList.toggle("hidden",!e),(a=t.querySelector(".zoom-reset-btn"))==null||a.classList.toggle("hidden",!e),(r=t.querySelector(".zoom-button-divider"))==null||r.classList.toggle("hidden",!e),(n=t.querySelector(".grip-handle"))==null||n.classList.toggle("hidden",!e)}function ko(t,e,i){const s=t.querySelector(".cursor-grab");if(!s)return;const a=t.querySelector(".sequencer-body");if(!a)return;let r=!1,n=0,o=0;const c=150,d=1e3;i.on(s,"mousedown",l=>{r=!0,n=l.clientY,o=a.offsetHeight,s.classList.replace("cursor-grab","cursor-grabbing"),document.body.style.userSelect="none"}),i.on(window,"mousemove",l=>{if(!r)return;const u=l.clientY-n;let h=o+u;h=Math.max(c,Math.min(d,h)),a.style.height=`${h}px`,e.resize()}),i.on(window,"mouseup",()=>{r&&(r=!1,s.classList.replace("cursor-grabbing","cursor-grab"),document.body.style.userSelect="")})}function Ao(t,e){var i;(i=t.querySelector(".cursor-grab"))==null||i.classList.toggle("hidden",!e)}function Fo(t,e){var r;t.collapsed=e;const i=t.container,s=n=>{hr(i,n),Ao(i,n)};e?((()=>{for(const n of t.scheduledAnimations)clearTimeout(n);t.scheduledAnimations=[]})(),s(!1)):(s(!0),(r=t.matrix)==null||r.resize(),I.isActive()&&t.resumeAnimationsFromCurrentTime(I.getStartTime(),I.getStartBeat()))}const He=["#ff006e","#3a86ff","#ffbe0b","#8338ec","#06d6a0","#ef476f","#118ab2","#ffd166","#073b4c","#8ac926","#0077b6","#00b4d8","#005f73","#03045e","#023e8a"];function mt(t,e,i,s=0){const a=t.getContext("2d");if(!a)return;a.imageSmoothingEnabled=!1;const r=t.width,n=t.height;if(a.clearRect(0,0,r,n),!e.length)return;const o=He[s%He.length];a.fillStyle=o;const c=ae(),d=e.map(m=>K(m.pitch)).filter(m=>m!==null);if(!d.length)return;let l=Math.min(...d),u=Math.max(...d),h=Math.max(1,u-l);for(;n%h!==0;)u++,h=u-l;const f=n/h;for(const m of e){const _=K(m.pitch);if(_==null)continue;const v=m.start/c*r,b=m.duration/c*r,S=(_-l)/h,N=n-S*n-f/2,C=Math.round(v),M=Math.max(1,Math.round(b)),E=Math.round(N);a.fillRect(C,E,M,f)}const p=gt(),g=We();a.save();let y=1;g>256?y=16:g>128?y=8:g>32&&(y=4);for(let m=0;m<=g;m++){if(m%y!==0)continue;const v=m*p/c*r,b=Math.round(v)+.5;a.beginPath(),a.moveTo(b,0),a.lineTo(b,n);const S=y===1||m%(y*2)===0;a.strokeStyle=S?"rgba(255, 255, 255, 0.12)":"rgba(255, 255, 255, 0.04)",a.lineWidth=.2,a.stroke()}a.restore()}function be(t,e){const i=t.getContext("2d");if(!i)return;const s=t.width,a=t.height;i.clearRect(0,0,s,a);const r=ae();for(const n of e){const{notes:o,config:c}=n;if(!(o!=null&&o.length))continue;const d=He[e.indexOf(n)%He.length];i.fillStyle=d;const l=K(c.noteRange[0]),u=K(c.noteRange[1]);if(l==null||u==null)continue;const h=u-l||1,f=Math.max(2,a/h);for(const p of o){const g=K(p.pitch);if(g==null)continue;const y=p.start/r*s,m=Math.max(1,p.duration/r*s),_=(g-l)/h,v=a-_*a-f/2;i.fillRect(y,v,m,f)}}}function Po(t,e){be(t,e)}function pi(t,e){const{config:i,container:s,matrix:a,colorIndex:r,getNotes:n}=t,[o,c]=e,d=X(o),l=X(c);if(d===null||l===null){console.warn(`Invalid note range: ${e}`);return}if(d>=l){console.warn("Invalid note range: low note must be lower than high note");return}i.noteRange=e,i.visibleNotes=qn(c,o)+1;const u=s==null?void 0:s.querySelector(".mini-contour");u&&mt(u,n(),i,r),a.setNoteRange(d,l)}function To(t){t.instrumentName.toLowerCase().includes("drum kit")?(pi(t,["B1","A5"]),t.matrix.setCustomLabels(gn)):(pi(t,["A0","C9"]),t.matrix.setCustomLabels(null))}const Ro={totalMeasures:16,beatsPerMeasure:4,layout:{labelWidthColumns:1,headerHeightRows:2,footerHeightRows:1,labelWidth:80,headerHeight:40,footerHeight:40,baseCellWidth:70,minCellWidth:10,maxCellWidth:200,verticalCellRatio:4,highestMidi:108,lowestMidi:21},display:{showMeasureLines:!0,showBeatLines:!0,showHoveredCell:!0,highlightCurrentMeasure:!0},behavior:{zoom:1,scrollMargin:48,enableSnapping:!0,snapDivisions:4,maxZoom:1.6,minZoom:.5}};function Oo(){return structuredClone(Ro)}function xo(t,e){return{...t,...e,layout:{...t.layout,...e.layout??{}},display:{...t.display,...e.display??{}},behavior:{...t.behavior,...e.behavior??{}}}}const mr={openaiApiKey:"",openaiModel:"gpt-4o",gridColorScheme:"Darkroom",noteColorScheme:"Track Color"};function ve(){return mr}function pt(t){Object.assign(mr,t)}const Pi={Midnight:{whiteKey:"#1e1e1e",blackKey:"#2a103b",labelWhite:"#2c2c2c",labelBlack:"#3a1d4d",textWhite:"#cfcfcf",textBlack:"#e6d9ff",gridLine:"#333",beatLine:"#4e3d63",measureLine:"#8561c2"},Seashell:{whiteKey:"#fefefe",blackKey:"#f1e7dc",labelWhite:"#dddddd",labelBlack:"#d4cfc9",textWhite:"#444",textBlack:"#663300",gridLine:"#ccc",beatLine:"#bbb",measureLine:"#999"},Cyberpunk:{whiteKey:"#162447",blackKey:"#1b1b2f",labelWhite:"#1f4068",labelBlack:"#1f4068",textWhite:"#e43f5a",textBlack:"#e43f5a",gridLine:"#1f4068",beatLine:"#e43f5a",measureLine:"#ffcc00"},"Classic Blue":{whiteKey:"#f5faff",blackKey:"#dceeff",labelWhite:"#aaccee",labelBlack:"#88bbdd",textWhite:"#002244",textBlack:"#001122",gridLine:"#99bbdd",beatLine:"#88aacc",measureLine:"#336699"},Darkroom:{whiteKey:"#2c2c2c",blackKey:"#1e1e1e",labelWhite:"#2a2a2a",labelBlack:"#383838",textWhite:"#e0e0e0",textBlack:"#a0a0a0",gridLine:"#404040",beatLine:"#606060",measureLine:"#808080"}};class Uo{constructor(e,i,s,a){this.getBlackKeyMap=a,this.scroll=e,this.config=i,this.interactionStore=s}draw(e){const{totalMeasures:i,beatsPerMeasure:s,layout:{baseCellWidth:a,verticalCellRatio:r,labelWidth:n,headerHeight:o},behavior:{zoom:c}}=this.config,{gridColorScheme:d}=ve(),l=Pi[d],u=this.config.layout.highestMidi-this.config.layout.lowestMidi+1,h=a*c,f=h/r,p=this.scroll.getX(),g=this.scroll.getY();(e.canvas.width-n)/h;const y=i*s;e.save(),e.translate(n-p,o-g);const m=Math.max(0,Math.floor((p-n)/h));for(let _=0;_<=u;_++){const v=_*f;if(e.strokeStyle=l.gridLine,e.beginPath(),e.moveTo(0,v),e.lineTo(y*h,v),e.stroke(),_<u){const b=this.config.layout.highestMidi-_,S=this.getBlackKeyMap().get(b);e.fillStyle=S?l.blackKey:l.whiteKey,e.fillRect(0,v,y*h,f)}}for(let _=m;_<=y;_++){if(_<0)continue;const v=_*h;_%s===0?e.strokeStyle=l.measureLine:e.strokeStyle=l.beatLine,e.beginPath(),e.moveTo(v,0),e.lineTo(v,u*f),e.stroke()}e.restore()}}function Do(t){const{layout:{labelWidth:e,baseCellWidth:i},totalMeasures:s,beatsPerMeasure:a,behavior:{zoom:r}}=t,n=i*r;return e+s*a*n}function qo(t){const{layout:{baseCellWidth:e,verticalCellRatio:i,highestMidi:s,lowestMidi:a,headerHeight:r},behavior:{zoom:n}}=t,o=s-a+1,c=e*n/i;return o*c+r}class Jo{constructor(e,i){this.scrollX=0,this.scrollY=0,this.canvas=e,this.config=i}getX(){return this.scrollX}getY(){return this.scrollY}setScroll(e,i){this.scrollX=this.clampX(e),this.scrollY=this.clampY(i)}recalculateBounds(){}getMaxScrollX(){const e=this.canvas.offsetWidth;return Math.max(0,this.getContentWidth()-e)}getMaxScrollY(){const e=this.canvas.offsetHeight-this.config.layout.headerHeight;return Math.max(0,this.getContentHeight()-e)}clampX(e){return Math.max(0,Math.min(e,this.getMaxScrollX()))}clampY(e){return Math.max(0,Math.min(e,this.getMaxScrollY()))}getContentWidth(){return Do(this.config)}getContentHeight(){return qo(this.config)}}class Ho{constructor(e,i){this.notes=[],this.noteIndex=new Map,this.pitchIndex=new Map,this.config=e,this.playNote=i}set(e){this.notes=e}getAll(){return this.notes}add(e){this.notes.push(e)}getTrackedNotes(e){const i=e.getHoveredNoteKey(),s=r=>e.isNoteHighlighted(r),a=new Set(e.getSelectedNotes().map(r=>`${r.pitch}:${r.start}`));return this.notes.map(r=>{const n=`${r.pitch}:${r.start}`;return{note:r,state:{hovered:n===i,selected:a.has(n),highlighted:s(r)}}})}remove(e){const i=`${e.pitch}:${e.start}`;this.notes=this.notes.filter(s=>!(s.pitch===e.pitch&&s.start===e.start)),this.noteIndex.delete(i)}removeAll(e){const i=new Set(e.map(s=>`${s.pitch}:${s.start}`));this.notes=this.notes.filter(s=>!i.has(`${s.pitch}:${s.start}`));for(const s of i)this.noteIndex.delete(s)}rebuildIndex(){this.noteIndex.clear(),this.pitchIndex.clear();for(const e of this.notes){const i=`${e.pitch}:${e.start}`;this.noteIndex.set(i,e),this.pitchIndex.has(e.pitch)||this.pitchIndex.set(e.pitch,[]),this.pitchIndex.get(e.pitch).push(e)}for(const e of this.pitchIndex.values())e.sort((i,s)=>i.start-s.start)}findAtPosition(e,i){return this.noteIndex.get(`${e}:${i}`)}findNoteUnderCursor(e,i){const s=this.pitchIndex.get(e);if(!s||s.length===0)return;let a=0,r=s.length-1,n=-1;for(;a<=r;){const o=Math.floor((a+r)/2);s[o].start<=i?(n=o,a=o+1):r=o-1}if(n!==-1)for(let o=n;o>=0;o--){const c=s[o];if(i>=c.start&&i<c.start+c.duration)return c;if(c.start+c.duration<i)break}}findNoteEdgeAtCursor(e,i,s=.25){const a=this.pitchIndex.get(e);if(!a||a.length===0)return;let r=0,n=a.length-1,o=-1;for(;r<=n;){const c=Math.floor((r+n)/2);a[c].start<=i?(o=c,r=c+1):n=c-1}if(o!==-1)for(let c=o;c>=0;c--){const d=a[c],l=d.start+d.duration*(1-s),u=d.start+d.duration;if(i>=l&&i<=u)return d;if(d.start+d.duration<i)break}}previewNote(e,i,s=100,a=!1){this.playNote(e,i,s,a)}}function yt(t,e,i,s,a,r=4){t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+s-r,i),t.quadraticCurveTo(e+s,i,e+s,i+r),t.lineTo(e+s,i+a-r),t.quadraticCurveTo(e+s,i+a,e+s-r,i+a),t.lineTo(e+r,i+a),t.quadraticCurveTo(e,i+a,e,i+a-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath()}function $o(t,e,i,s){const{layout:{baseCellWidth:a,verticalCellRatio:r,highestMidi:n,lowestMidi:o},behavior:{zoom:c}}=i,d=n-o+1,l=a*c,u=l/r,h=s.offsetWidth,f=s.offsetHeight,p=0,g=t/l-p,y=(t+h)/l+p,m=Math.floor(e/u),_=Math.min(d-1,Math.ceil((e+f)/u)+p),v=new Map;return b=>b.filter(({note:S})=>{if(S.start+S.duration<g||S.start>y)return!1;let C=v.get(S.pitch);if(C==null){const M=wi(S.pitch,o,n);if(M==null||M<0||M>=d)return!1;C=M,v.set(S.pitch,C)}return C>=m&&C<=_})}function Ko(t){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(u,h,f,p)=>h+h+f+f+p+p);const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!i)return null;const s=parseInt(i[1],16)/255,a=parseInt(i[2],16)/255,r=parseInt(i[3],16)/255,n=Math.max(s,a,r),o=Math.min(s,a,r);let c=0,d=0,l=(n+o)/2;if(n!==o){const u=n-o;switch(d=l>.5?u/(2-n-o):u/(n+o),n){case s:c=(a-r)/u+(a<r?6:0);break;case a:c=(r-s)/u+2;break;case r:c=(s-a)/u+4;break}c*=60}return{h:Math.round(c),s:Math.round(d*100),l:Math.round(l*100)}}const Wo=["#FF0000","#9400D3","#FFFF00","#FF69B4","#00FF00","#00FFFF","#0000FF","#8A2BE2","#FF8C00","#FFD700","#ADFF2F","#DC143C"];function zo(t,e){const i=Ko(t);if(!i)return"#999";const a=10+(e??100)/127*50;return`hsl(${i.h}, ${i.s}%, ${a}%)`}function vt(t){return(e,i)=>{const s=t(e,i);return zo(s,e.velocity)}}function Xo(t){const e=X(t.pitch);if(e==null)return"#999";const i=e*3%360,s=100,a=60,n=.2+(t.velocity??100)/127*.8;return`hsla(${i}, ${s}%, ${a}%, ${n})`}const Vo={Scriabin:vt((t,{getPitchClass:e}={})=>{const i=e?e(t.pitch):0;return Wo[i]||"#999"}),"Track Color":vt((t,{getTrackColor:e}={})=>(e==null?void 0:e())||"#999"),"Note Velocity":vt((t,{getTrackColor:e}={})=>(e==null?void 0:e())||"#ff0000"),"Octave Bands":Xo,"Pitch Class Contrast":vt((t,{getPitchClass:e}={})=>{const i=X(t.pitch);if(i==null)return"#999";const s=i%12;return["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"][s]||"#999"})};function jo(t){return t<0&&(console.error(`Invalid trackId: ${t}. Using default color.`),t=0),He[t%He.length]}class Yo{constructor(e,i,s,a,r){this.scroll=e,this.config=i,this.noteManager=s,this.interactionStore=a,this.sequencerId=r}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,labelWidth:a,headerHeight:r},behavior:{zoom:n}}=this.config,{noteColorScheme:o}=ve(),c=Vo[o]||(()=>"#999"),d={getPitchClass:Dn,getTrackColor:()=>jo(this.sequencerId)},l=i*n,u=l/s,h=this.scroll.getX(),f=this.scroll.getY(),p=e.canvas,g=this.noteManager.getTrackedNotes(this.interactionStore);e.save(),e.translate(a-h,r-f);const m=$o(h,f,this.config,p)(g);for(const{note:_,state:v}of m){const S=wi(_.pitch,this.config.layout.lowestMidi,this.config.layout.highestMidi)*u,N=_.start*l,C=_.duration*l,M=u,E=c(_,d);e.fillStyle=E,yt(e,N,S,C,M,4),e.fill(),(v.selected||v.hovered||v.highlighted)&&(e.lineWidth=2,e.strokeStyle=v.selected?"#ffffff":v.hovered?"#ff9933":"#33ff99",yt(e,N,S,C,M,4),e.stroke())}e.restore()}}class Zo{constructor(e,i,s,a){this.scroll=e,this.config=i,this.store=s,this.getNoteDuration=a}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,labelWidth:a,headerHeight:r,lowestMidi:n,highestMidi:o},behavior:{zoom:c}}=this.config,d=i*c,l=d/s;e.save(),e.translate(a-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(100, 180, 255, 0.5)";const u=this.store.getPreviewNotes();if(u.length>0){const m=o-n+1;for(const _ of u){const v=lt(_.pitch);if(v===null)continue;const b=m-1-(v-n),S=_.start*d,N=b*l,C=_.duration*d;yt(e,S,N,C,l,3),e.fill()}e.restore();return}const h=this.store.getSnappedCursorGridPosition();if(!h){e.restore();return}const f=this.getNoteDuration(),p=h.x*d,g=h.y*l,y=d*f;yt(e,p,g,y,l,3),e.fill(),e.restore()}}class Qo{constructor(e,i){this.scroll=e,this.config=i,this.animations=[]}playNote(e){const i=performance.now(),s=he();let a=e.duration*6e4/s;a=Math.max(100,Math.min(a,1600));const n=(X(e.pitch)||0)*5%360;this.animations.push({note:e,startTime:i,duration:a,hue:n})}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,labelWidth:a,headerHeight:r,lowestMidi:n,highestMidi:o},behavior:{zoom:c}}=this.config,d=this.scroll.getX(),l=this.scroll.getY(),u=i*c,h=u/s,f=performance.now();e.clearRect(0,0,e.canvas.width,e.canvas.height),this.animations=this.animations.filter(p=>{const g=(f-p.startTime)/p.duration;if(g>1)return!1;const{note:y,hue:m}=p,_=X(y.pitch);if(_==null||_<n||_>o)return!0;const v=o-_,b=y.start*u+a-d,S=v*h+r-l,N=y.duration*u,C=h-1,M=b+N/2,E=S+C/2,k=Math.sin(g*Math.PI),L=`hsla(${m}, 100%, 70%, ${.4*k})`;e.save(),e.globalAlpha=1,e.fillStyle=L,e.beginPath(),e.roundRect(b,S,N,C,4),e.fill();const P=2,A=50;for(let U=0;U<P;U++){const D=U*A,q=Math.max(0,Math.min(1,(f-p.startTime-D)/(p.duration-D))),F=Math.sin(q*Math.PI),w=1+(.1+U*.1)*F,J=(1-q)*.3;e.globalAlpha=J,e.strokeStyle=`hsl(${m}, 100%, 65%)`,e.lineWidth=1.5;const T=N*w,ee=C*w;e.beginPath(),e.roundRect(M-T/2,E-ee/2,T,ee,4),e.stroke()}return e.restore(),!0}),this.animations.length>0&&requestAnimationFrame(()=>this.draw(e))}}class el{constructor(e,i){this.scroll=e,this.config=i,this.x=null}setPlayheadX(e){this.x=e}clear(){this.x=null}draw(e){if(this.x==null)return;const{layout:{verticalCellRatio:i,baseCellWidth:s,labelWidth:a,headerHeight:r,highestMidi:n,lowestMidi:o},behavior:{zoom:c}}=this.config,d=n-o+1,l=this.scroll.getX(),u=this.scroll.getY(),h=s*c/i,f=d*h+r,p=this.x;e.save(),e.translate(a-l,-u),e.lineWidth=2,e.strokeStyle="rgba(168, 85, 247, 1.0)",e.shadowColor="rgba(168, 85, 247, 0.5)",e.shadowBlur=6,e.beginPath(),e.moveTo(p,0),e.lineTo(p,f),e.stroke(),e.restore()}}class St{constructor(e,i=!0){this.canvas=e,this.dpr=i&&window.devicePixelRatio||1;const s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.ctx=s}resize(){const e=this.canvas.offsetWidth,i=this.canvas.offsetHeight,s=Math.floor(e*this.dpr),a=Math.floor(i*this.dpr);(this.canvas.width!==s||this.canvas.height!==a)&&(this.canvas.width=s,this.canvas.height=a,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr))}getContext(){return this.ctx}withContext(e){e(this.ctx)}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}destroy(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class ji{constructor(e,i,s,a,r){this.thumb=e,this.isHorizontal=i,this.scroll=s,this.interactionStore=a,this.requestRedraw=r,this.onMouseEnter=()=>this.interactionStore.setIsOnScrollbar(!0),this.onMouseLeave=()=>this.interactionStore.setIsOnScrollbar(!1),this.onThumbMouseDown=o=>this.handleMouseDown(o),this.onMouseMove=null,this.onMouseUp=null;const n=this.thumb.parentElement;if(!n)throw new Error("Scrollbar thumb must have a parent track element.");this.track=n,this.attachDragHandler()}attachDragHandler(){this.track.addEventListener("mouseenter",this.onMouseEnter),this.track.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mouseenter",this.onMouseEnter),this.thumb.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mousedown",this.onThumbMouseDown)}handleMouseDown(e){e.preventDefault(),this.interactionStore.setIsScrolling(!0),this.onMouseMove=i=>{const s=this.track.getBoundingClientRect(),a=this.isHorizontal?this.track.offsetWidth:this.track.offsetHeight,n=(this.isHorizontal?i.clientX:i.clientY)-(this.isHorizontal?s.left:s.top),o=this.isHorizontal?this.thumb.offsetWidth:this.thumb.offsetHeight,c=a-o,d=Math.max(0,Math.min(n-o/2,c)),l=c>0?d/c:0,u=this.isHorizontal?this.scroll.getMaxScrollX():this.scroll.getMaxScrollY(),h=l*u;this.isHorizontal?this.scroll.setScroll(h,this.scroll.getY()):this.scroll.setScroll(this.scroll.getX(),h),this.requestRedraw()},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.interactionStore.setIsScrolling(!1),this.onMouseMove=null,this.onMouseUp=null},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){this.track.removeEventListener("mouseenter",this.onMouseEnter),this.track.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mouseenter",this.onMouseEnter),this.thumb.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mousedown",this.onThumbMouseDown),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&document.removeEventListener("mouseup",this.onMouseUp),this.onMouseMove=null,this.onMouseUp=null}}let Yi=!1;function tl(){if(Yi)return;const t=document.createElement("style");t.textContent=`
    .grid-scrollbars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .grid-scrollbar {
      position: absolute;
      background: #1f1f1f;
      pointer-events: all;
    }

    .grid-scrollbar-thumb {
      position: absolute;
      background: #888;
      border-radius: 6px;
      cursor: pointer;
    }

    .grid-scrollbar-corner {
      position: absolute;
      width: 12px;
      height: 12px;
      bottom: 0;
      right: 0;
      background: #1f1f1f;
      z-index: 2;
      pointer-events: none;
    }
  `,document.head.appendChild(t),Yi=!0}const Zi={"bg-purple-700":"#7e22ce"};class il{constructor(e,i,s,a,r){this.container=e,this.scroll=i,this.config=s,this.interactionStore=a,this.requestRedraw=r,this.trackThickness=16,tl(),this.createDOM(),this.attachEvents(),this.config=this.config,this.interactionStore=a}createDOM(){const e=this.hScrollbar=document.createElement("div"),i=this.hThumb=document.createElement("div"),s=this.vScrollbar=document.createElement("div"),a=this.vThumb=document.createElement("div"),r=this.corner=document.createElement("div");e.className="grid-scrollbar",s.className="grid-scrollbar",i.className="grid-scrollbar-thumb",a.className="grid-scrollbar-thumb",r.className="grid-scrollbar-corner",e.style.position=s.style.position=r.style.position="absolute",e.style.zIndex=s.style.zIndex=r.style.zIndex="5",e.style.bottom="0",e.style.left="0",e.style.right=`${this.trackThickness}px`,e.style.height=`${this.trackThickness}px`,s.style.top="0",s.style.right="0",s.style.bottom=`${this.trackThickness}px`,s.style.width=`${this.trackThickness}px`,r.style.width=`${this.trackThickness}px`,r.style.height=`${this.trackThickness}px`,r.style.right="0",r.style.bottom="0",r.style.background="#333",r.style.position="absolute",i.style.zIndex=a.style.zIndex="6",i.style.position=a.style.position="absolute",i.style.background=Zi["bg-purple-700"],a.style.background=Zi["bg-purple-700"],i.style.borderRadius=a.style.borderRadius="8px",i.style.height="100%",a.style.width="100%",e.appendChild(i),s.appendChild(a),this.container.appendChild(e),this.container.appendChild(s),this.container.appendChild(r)}attachEvents(){this.hDragHandler=new ji(this.hThumb,!0,this.scroll,this.interactionStore,this.requestRedraw),this.vDragHandler=new ji(this.vThumb,!1,this.scroll,this.interactionStore,this.requestRedraw)}update(){const{width:e,height:i}=this.container.getBoundingClientRect(),s=this.scroll.getContentWidth(),a=this.scroll.getContentHeight(),r=this.scroll.getX(),n=this.scroll.getY(),o=this.scroll.getMaxScrollX(),c=this.scroll.getMaxScrollY(),d=e-this.trackThickness,l=this.config.layout.labelWidth,u=Math.max(40,(e-l)/s*d),h=r/o*(d-u);this.hThumb.style.width=`${u}px`,this.hThumb.style.left=`${Math.max(0,h)}px`;const f=i-this.trackThickness,p=this.config.layout.headerHeight,g=Math.max(40,(i-p)/a*f),y=n/c*(f-g);this.vThumb.style.height=`${g}px`,this.vThumb.style.top=`${Math.max(0,y)}px`}destroy(){this.hDragHandler.destroy(),this.vDragHandler.destroy(),this.hScrollbar.remove(),this.vScrollbar.remove(),this.corner.remove(),this.hScrollbar=null,this.vScrollbar=null,this.corner=null}}var G=(t=>(t[t.DefaultNoteTool=0]="DefaultNoteTool",t[t.Selecting=1]="Selecting",t[t.SelectedIdle=2]="SelectedIdle",t[t.Dragging=3]="Dragging",t[t.Pasting=4]="Pasting",t[t.Sizing=5]="Sizing",t))(G||{});function Ti(t,e){const i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}function pr(t,e,i,s){const a=e.getBoundingClientRect();return{x:t.clientX-a.left+i.getX()-s.layout.labelWidth,y:t.clientY-a.top+i.getY()-s.layout.headerHeight}}function sl(t,e,i,s,a){const r=i.getBoundingClientRect();return{x:t-r.left+s.getX()-a.layout.labelWidth,y:e-r.top+s.getY()-a.layout.headerHeight}}function Ri(t,e,i,s,a=!1){const{layout:{labelWidth:r,headerHeight:n,baseCellWidth:o,verticalCellRatio:c,highestMidi:d,lowestMidi:l},behavior:{zoom:u}}=i,h=d-l+1,f=o*u,p=f/c,g=(t.x+e.getX()-r)/f,y=Math.floor((t.y+e.getY()-n)/p),m=a?s*(2/3):s,_=Math.floor(g/m)*m;return _>=0&&y>=0&&y<h?{x:_,y}:null}function Ot(t,e,i,s,a){const r=Ti(t,e),n=i.getSnapResolution(),o=i.isTripletMode();return Ri(r,s,a,n,o)}function xt(t,e,i,s){const{baseCellWidth:a}=s.layout,{zoom:r}=s.behavior,n=pr(t,e,i,s),o=a*r;return n.x/o}var $=(t=>(t.Default="default",t.Pointer="pointer",t.Crosshair="crosshair",t.Grabbing="grabbing",t.Grab="grab",t.ResizeHorizontal="ew-resize",t.ResizeVertical="ns-resize",t.Move="move",t.NotAllowed="not-allowed",t.Custom="url(cursor.png), auto",t))($||{});function yi(t,e,i,s){return!t||t.x>=ae()?(e.setSnappedCursorGridPosition(null),e.setHoveredNoteKey(null),i.set($.Default),s(),!0):!1}class rl{constructor(e,i,s,a,r,n,o,c,d,l,u,h){this.canvas=e,this.noteManager=i,this.scroll=s,this.config=a,this.store=r,this.grid=n,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=5}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const i=Ot(e,this.canvas,this.grid,this.scroll,this.config);if(yi(i,this.store,this.cursorController,this.requestRedraw))return;const s=xt(e,this.canvas,this.scroll,this.config);if(i){const a=Ie(i.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(a,s),n=this.store.getHoveredNoteKey();if(r&&n===`${r.pitch}:${r.start}`){this.store.setSelectedNotes([r]),this.controller.transitionTo(G.Sizing);return}}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const i=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,a=Math.sqrt(i*i+s*s);if(this.store.isDraggingToSelect()){const l=this.store.getHoveredNoteKey();if(l&&a>=this.dragThreshold){const[u,h]=l.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(G.Dragging);return}}if(a>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(G.Selecting);return}}const r=Ot(e,this.canvas,this.grid,this.scroll,this.config);if(!r||yi(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const n=Ie(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=xt(e,this.canvas,this.scroll,this.config),c=this.noteManager.findNoteUnderCursor(n,o),d=this.noteManager.findNoteEdgeAtCursor(n,o);if(c){const l=`${c.pitch}:${c.start}`;this.store.setHoveredNoteKey(l),this.store.setSnappedCursorGridPosition(null),d===c?this.cursorController.set($.ResizeHorizontal):this.cursorController.set($.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set($.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0)return;if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}this.store.isDraggingToSelect()&&this.store.endSelectionDrag();const i=this.store.getHoveredNoteKey();if(i){if(performance.now()-this.store.getLastDeletionTime()<100)return;const[d,l]=i.split(":"),u=this.noteManager.findAtPosition(d,Number(l));if(u){this.store.setSelectedNotes([u]),this.controller.transitionTo(G.SelectedIdle);return}}const s=this.store.getSnappedCursorGridPosition();if(!s)return;const{layout:a}=this.config,r=this.grid.getNoteDuration(),n=Ie(s.y,a.lowestMidi,a.highestMidi);if(!n||this.noteManager.findAtPosition(n,s.x))return;const c={start:s.x,duration:r,pitch:n,velocity:100};O(ar(this.getSequencerId(),[c]),nr(this.getSequencerId(),[c])),this.noteManager.previewNote(n,r),this.playNoteAnimation({start:s.x,duration:r,pitch:n,velocity:100})}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const i=this.store.getHoveredNoteKey();if(!i)return;const[s,a]=i.split(":"),r=parseFloat(a);if(!s||isNaN(r))return;const n=this.noteManager.findAtPosition(s,r);n&&(O(rt(this.getSequencerId(),[n]),at(this.getSequencerId(),[n])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set($.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(G.Pasting)}}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}function Qi(t,e,i,s,a){const{layout:{baseCellWidth:r,verticalCellRatio:n,lowestMidi:o,highestMidi:c},behavior:{zoom:d}}=s,l=r*d,u=l/n,h=Math.min(e.startX,e.currentX+l/2),f=Math.max(e.startX,e.currentX+l/2),p=Math.min(e.startY,e.currentY),g=Math.max(e.startY,e.currentY),y=a.getSnapResolution(),m=Math.floor(h/l/y)*y,_=Math.floor(f/l/y)*y,v=Math.floor(p/u),b=Math.floor(g/u),S=Math.min(v,b),N=Math.max(v,b);return t.filter(C=>{const M=wi(C.pitch,o,c);if(M==null)return!1;const E=M>=S&&M<=N,k=C.start+C.duration,L=C.start>=m&&k<=_;return E&&L})}class al{constructor(e,i,s,a,r,n,o,c){this.canvas=e,this.config=i,this.scroll=s,this.grid=a,this.store=r,this.controller=n,this.noteManager=o,this.requestRedraw=c}onEnter(){const e=sl(this.controller.getLastMouseX(),this.controller.getLastMouseY(),this.canvas,this.scroll,this.config);this.store.setMarqueeBox({startX:e.x,startY:e.y,currentX:e.x,currentY:e.y})}onMouseMove(e){const i=this.store.getMarqueeBox();if(!i)return;const s=pr(e,this.canvas,this.scroll,this.config);i.currentX=s.x,i.currentY=s.y,this.store.setMarqueeBox({...i});const a=Qi(this.noteManager.getAll(),i,this.scroll,this.config,this.grid);this.store.setHighlightedNotes(a),this.requestRedraw()}onMouseUp(e){const i=this.store.getMarqueeBox();if(!i){this.controller.transitionTo(G.DefaultNoteTool);return}const s=Qi(this.noteManager.getAll(),i,this.scroll,this.config,this.grid);s.length>0?(this.store.clearHighlightedNotes(),this.store.setSelectedNotes(s),this.store.setMarqueeBox(null),this.controller.transitionTo(G.SelectedIdle)):(this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool))}onMouseLeave(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(G.DefaultNoteTool)}onExit(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.requestRedraw()}}class nl{constructor(e,i,s,a,r,n,o,c,d,l,u,h){this.canvas=e,this.config=i,this.scroll=s,this.noteManager=a,this.store=r,this.grid=n,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=5}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const i=Ot(e,this.canvas,this.grid,this.scroll,this.config);if(!i)return;const s=xt(e,this.canvas,this.scroll,this.config),a=Ie(i.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(a,s);if(r){const n=`${r.pitch}:${r.start}`;new Set(this.store.getSelectedNotes().map(c=>`${c.pitch}:${c.start}`)).has(n)||this.store.setSelectedNotes([r]),this.controller.transitionTo(G.Sizing);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set($.Default),this.requestRedraw();return}const i=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,a=Math.sqrt(i*i+s*s);if(this.store.isDraggingToSelect()){const f=this.store.getHoveredNoteKey();if(f&&a>=this.dragThreshold){const[p,g]=f.split(":"),y=parseFloat(g),m=this.noteManager.findAtPosition(p,y);if(!m)return;this.store.getSelectedNotes().some(b=>b.pitch===m.pitch&&b.start===m.start)||this.store.setSelectedNotes([m]),this.store.setDragAnchorNoteKey(`${m.pitch}:${m.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(G.Dragging);return}if(!f&&a>=this.dragThreshold){this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(G.Selecting);return}}const r=Ti(e,this.canvas),n=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),c=Ri(r,this.scroll,this.config,n,o);if(!c){this.store.setHoveredNoteKey(null),this.cursorController.set($.Default),this.requestRedraw();return}const d=xt(e,this.canvas,this.scroll,this.config),l=Ie(c.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(l,d),h=this.noteManager.findNoteEdgeAtCursor(l,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set($.ResizeHorizontal):this.cursorController.set($.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set($.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement())return;this.store.endSelectionDrag();const i=this.store.getHoveredNoteKey();if(i){const[s,a]=i.split(":"),r=this.noteManager.findNoteUnderCursor(s,Number(a));if(r){this.store.setSelectedNotes([r]),this.controller.transitionTo(G.SelectedIdle);return}}this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const i=this.store.getHoveredNoteKey();if(!i)return;const[s,a]=i.split(":"),r=parseFloat(a),n=this.noteManager.findNoteUnderCursor(s,r);if(!n)return;const o=this.store.getSelectedNotes(),c=o.some(d=>d.pitch===n.pitch&&d.start===n.start);o.length>0&&c?O(rt(this.getSequencerId(),o),at(this.getSequencerId(),o)):O(rt(this.getSequencerId(),[n]),at(this.getSequencerId(),[n])),this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool)}onKeyDown(e){const i=this.store.getSelectedNotes(),a=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(a&&e.key==="c"){i.length&&this.setClipboard(i);return}if(a&&e.key==="x"){if(!i.length)return;this.setClipboard(i),O(rt(this.getSequencerId(),i),at(this.getSequencerId(),i)),this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool);return}if(a&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(G.Pasting);return}if(e.key==="Delete"){if(!i.length)return;O(rt(this.getSequencerId(),i),at(this.getSequencerId(),i)),this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool)}}}function ol({notes:t,anchorBeat:e,anchorMidi:i,targetBeat:s,targetMidi:a,lowestMidi:r,highestMidi:n}){const o=s-e,c=a-i,d=t.map(y=>y.start+o),l=t.map(y=>y.start+o+y.duration),u=Math.min(...d),h=Math.max(...l),f=Math.min(0,u),p=Math.max(0,h-ae()),g=o-f-p;return t.flatMap(y=>{const m=lt(y.pitch);if(m==null)return[];let _=m+c;_<r&&(_=r),_>n&&(_=n);const v=Xt(_);return v?[{pitch:v,start:y.start+g,duration:y.duration,velocity:y.velocity??100}]:[]})}class ll{constructor(e,i,s,a,r,n,o,c,d,l){this.canvas=e,this.config=i,this.scroll=s,this.store=a,this.grid=r,this.requestRedraw=n,this.getSequencerId=o,this.controller=c,this.cursorController=d,this.getClipboard=l}onMouseMove(e){const i=Ot(e,this.canvas,this.grid,this.scroll,this.config);if(!i||yi(i,this.store,this.cursorController,this.requestRedraw))return;const s=this.getClipboard();if(!s.notes.length)return;const{lowestMidi:a,highestMidi:r}=this.config.layout,n=r-a+1,o=a+(n-1-i.y),c=i.x,d=ol({notes:s.notes,anchorBeat:s.anchorBeat,anchorMidi:s.anchorMidi,targetBeat:c,targetMidi:o,lowestMidi:a,highestMidi:r});this.store.setPreviewNotes(d),this.cursorController.set($.Pointer),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const i=this.store.getPreviewNotes();i.length&&(O(ar(this.getSequencerId(),i),nr(this.getSequencerId(),i)),this.store.clearPreviewNotes(),this.controller.transitionTo(G.DefaultNoteTool))}onMouseLeave(){this.store.clearPreviewNotes(),this.controller.transitionTo(G.DefaultNoteTool)}onExit(){this.store.clearPreviewNotes(),this.requestRedraw()}}function dl({originalNotes:t,anchorNote:e,targetPitch:i,targetBeat:s,lowestMidi:a,highestMidi:r}){const n=lt(i),o=lt(e.pitch);if(n==null||o==null)return[];const c=s-e.start,d=n-o,l=t.map(m=>m.start+c),u=t.map(m=>m.start+c+m.duration),h=Math.min(...l),f=Math.max(...u),p=Math.min(0,h),g=Math.max(0,f-ae()),y=c-p-g;return t.flatMap(m=>{const _=lt(m.pitch);if(_==null)return[];let v=_+d;v<a&&(v=a),v>r&&(v=r);const b=Xt(v);return b?[{pitch:b,start:m.start+y,duration:m.duration,velocity:m.velocity??100}]:[]})}class cl{constructor(e,i,s,a,r,n,o,c,d,l){this.canvas=e,this.config=i,this.scroll=s,this.store=a,this.noteManager=r,this.grid=n,this.requestRedraw=o,this.controller=c,this.cursorController=d,this.getSequencerId=l,this.originalNotes=[],this.anchorNote=null,this.hasMoved=!1,this.lastPreviewedPitch=null}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(G.DefaultNoteTool);return}this.originalNotes=e.map(a=>({...a}));const i=this.store.getDragAnchorNoteKey(),s=i?e.find(a=>`${a.pitch}:${a.start}`===i):e[0];this.anchorNote=s??e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasMoved=!1,this.requestRedraw()}onMouseMove(e){const i=Ti(e,this.canvas),s=this.grid.getSnapResolution(),a=this.grid.isTripletMode(),r=Ri(i,this.scroll,this.config,s,a);if(!r||!this.anchorNote)return;const{layout:n}=this.config,o=Ie(r.y,n.lowestMidi,n.highestMidi);if(!o)return;const c=dl({originalNotes:this.originalNotes,anchorNote:this.anchorNote,targetPitch:o,targetBeat:r.x,lowestMidi:n.lowestMidi,highestMidi:n.highestMidi});this.store.setPreviewNotes(c),this.hasMoved=!0,this.cursorController.set($.Grabbing),o!==this.lastPreviewedPitch&&(this.noteManager.previewNote(o,.25),this.lastPreviewedPitch=o),this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote)return;const i=this.store.getPreviewNotes();if(this.hasMoved&&i.some((a,r)=>a.start!==this.originalNotes[r].start||a.pitch!==this.originalNotes[r].pitch))O(or(this.getSequencerId(),this.originalNotes,i),lo(this.getSequencerId(),this.originalNotes,i));else for(const a of this.originalNotes)this.noteManager.add(a);this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool)}onMouseLeave(){this.hasMoved=!1,this.controller.transitionTo(G.DefaultNoteTool)}onExit(){if(!this.hasMoved&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.store.setDragAnchorNoteKey(null),this.requestRedraw()}}class ul{constructor(e,i,s,a,r,n,o,c,d,l){this.canvas=e,this.config=i,this.scroll=s,this.store=a,this.noteManager=r,this.grid=n,this.requestRedraw=o,this.controller=c,this.cursorController=d,this.getSequencerId=l,this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.hasResized=!1,this.hasMoved=!1,this.initialMouseX=0,this.accumulatedDelta=0}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(G.DefaultNoteTool);return}this.originalNotes=e.map(s=>({...s}));const i=this.store.getHoveredNoteKey();this.anchorNote=i?e.find(s=>`${s.pitch}:${s.start}`===i)??null:e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasResized=!1,this.hasMoved=!1,this.accumulatedDelta=0,this.initialMouseX=this.controller.getLastMouseX(),this.requestRedraw()}onMouseMove(e){if(!this.anchorNote)return;const i=this.grid.getSnapResolution(),a=this.grid.isTripletMode()?i*(2/3):i,r=e.clientX-this.initialMouseX,o=this.config.layout.baseCellWidth*this.config.behavior.zoom*a,c=r/o,d=Math.round(c);if(d===this.accumulatedDelta)return;this.accumulatedDelta=d;const l=d*a,u=this.originalNotes.map(h=>{const f=Math.max(a,h.duration+l);return{...h,duration:f}});this.previewNotes=u,this.store.setPreviewNotes(u),this.cursorController.set($.ResizeHorizontal),this.hasResized=!0,this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote||!this.hasResized)return;const i=this.originalNotes,a=this.previewNotes.map((n,o)=>({pitch:n.pitch,start:n.start,newDuration:n.duration})),r=i.map((n,o)=>({pitch:n.pitch,start:n.start,oldDuration:n.duration}));O(ho(this.getSequencerId(),a),mo(this.getSequencerId(),r)),this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(G.DefaultNoteTool)}onMouseLeave(){this.controller.transitionTo(G.DefaultNoteTool)}onExit(){if(!this.hasResized&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.requestRedraw()}}class fl{constructor(e){this.data=e,this.mode=G.DefaultNoteTool,this.activeHandler=null,this.lastMouseX=0,this.lastMouseY=0,this.transitionTo(G.DefaultNoteTool)}handleMouseDown(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onMouseDown)==null||s.call(i,e)}handleMouseMove(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onMouseMove)==null||s.call(i,e)}handleMouseUp(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onMouseUp)==null||s.call(i,e)}handleContextMenu(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onContextMenu)==null||s.call(i,e)}handleMouseLeave(){var e,i;(i=(e=this.activeHandler)==null?void 0:e.onMouseLeave)==null||i.call(e)}handleMouseEnter(e){var i,s;(s=(i=this.activeHandler)==null?void 0:i.onMouseEnter)==null||s.call(i,e)}handleKeyDown(e){var i,s;(s=(i=this.activeHandler)==null?void 0:i.onKeyDown)==null||s.call(i,e)}transitionTo(e){var i,s,a,r;(s=(i=this.activeHandler)==null?void 0:i.onExit)==null||s.call(i),this.mode=e,this.activeHandler=this.createHandlerForMode(e),(r=(a=this.activeHandler)==null?void 0:a.onEnter)==null||r.call(a)}createHandlerForMode(e){const i={transitionTo:s=>this.transitionTo(s),getLastMouseX:()=>this.lastMouseX,getLastMouseY:()=>this.lastMouseY};switch(e){case G.DefaultNoteTool:return new rl(this.data.canvas,this.data.noteManager,this.data.scroll,this.data.config,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),i,this.data.cursorController,this.data.getClipboard,this.data.playNoteAnimation);case G.Selecting:return new al(this.data.canvas,this.data.config,this.data.scroll,this.data.grid,this.data.store,i,this.data.noteManager,this.data.requestRedraw);case G.SelectedIdle:return new nl(this.data.canvas,this.data.config,this.data.scroll,this.data.noteManager,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),i,this.data.cursorController,this.data.setClipboard,this.data.getClipboard);case G.Pasting:return new ll(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),i,this.data.cursorController,this.data.getClipboard);case G.Dragging:return new cl(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,i,this.data.cursorController,()=>this.data.sequencerContext.getId());case G.Sizing:return new ul(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,i,this.data.cursorController,()=>this.data.sequencerContext.getId());default:return{}}}destroy(){var e,i;(i=(e=this.activeHandler)==null?void 0:e.onExit)==null||i.call(e),this.activeHandler=null}}class hl{constructor(e){this.current=$.Default,this.canvas=e}set(e){this.current!==e&&(this.canvas.style.cursor=e,this.current=e)}reset(){this.set($.Default)}}class ml{constructor(e,i){this.context=e,this.canvas=i,this.onMouseMove=s=>{this.context.handleMouseMove(s)},this.onMouseDown=s=>{this.context.handleMouseDown(s)},this.onMouseUp=s=>{this.context.handleMouseUp(s)},this.onMouseLeave=()=>{this.context.handleMouseLeave()},this.onMouseEnter=s=>{var a,r;(r=(a=this.context).handleMouseEnter)==null||r.call(a,s)},this.onContextMenu=s=>{this.context.handleContextMenu(s)},this.onKeyDown=s=>{this.context.handleKeyDown(s)},this.attachListeners(),this.canvas.style.pointerEvents="auto"}attachListeners(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("contextmenu",this.onContextMenu),window.addEventListener("keydown",this.onKeyDown)}destroy(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("keydown",this.onKeyDown)}}class pl{constructor(e,i,s){this.canvas=e,this.scroll=i,this.requestRedraw=s,this.SCROLL_SPEED_X=1,this.SCROLL_SPEED_Y=1,this.onWheel=a=>{a.preventDefault();const r=a.shiftKey||Math.abs(a.deltaX)>Math.abs(a.deltaY),n=a.deltaX||a.deltaY;if(r){const o=this.scroll.getX()+n*this.SCROLL_SPEED_X;this.scroll.setScroll(o,this.scroll.getY())}else{const o=this.scroll.getY()+a.deltaY*this.SCROLL_SPEED_Y;this.scroll.setScroll(this.scroll.getX(),o)}this.requestRedraw()},this.attachListeners()}attachListeners(){this.canvas.addEventListener("wheel",this.onWheel,{passive:!1})}destroy(){this.canvas.removeEventListener("wheel",this.onWheel)}}class yl{constructor(){this.snappedCursorGridPosition=null,this.previewNotes=[],this.hoveredNoteKey=null,this.marqueeBox=null,this.highlightedNoteKeys=new Set,this.selectedNotes=[],this.dragAnchorNoteKey=null,this.isOnScrollbar=!1,this.isScrolling=!1,this.isInitiatingSelectionDrag=!1,this.isDraggingNotes=!1,this.lastDeletionTime=0}setSnappedCursorGridPosition(e){this.snappedCursorGridPosition=e}getSnappedCursorGridPosition(){return this.snappedCursorGridPosition}setPreviewNotes(e){this.previewNotes=e}getPreviewNotes(){return this.previewNotes}clearPreviewNotes(){this.previewNotes=[]}setHoveredNoteKey(e){this.hoveredNoteKey=e}getHoveredNoteKey(){return this.hoveredNoteKey}setMarqueeBox(e){this.marqueeBox=e}getMarqueeBox(){return this.marqueeBox}hasMarquee(){return this.marqueeBox!==null}setHighlightedNotes(e){this.highlightedNoteKeys=new Set(e.map(i=>`${i.pitch}:${i.start}`))}clearHighlightedNotes(){this.highlightedNoteKeys.clear()}isNoteHighlighted(e){return this.highlightedNoteKeys.has(`${e.pitch}:${e.start}`)}getSelectedNotes(){return this.selectedNotes}setSelectedNotes(e){this.selectedNotes=e}clearSelection(){this.selectedNotes=[]}hasSelection(){return this.selectedNotes.length>0}setDragAnchorNoteKey(e){this.dragAnchorNoteKey=e}getDragAnchorNoteKey(){return this.dragAnchorNoteKey}setIsOnScrollbar(e){this.isOnScrollbar=e}getIsOnScrollbar(){return this.isOnScrollbar}setIsScrolling(e){this.isScrolling=e}isOnNonGridElement(){return this.isOnScrollbar||this.isScrolling}beginSelectionDrag(){this.isInitiatingSelectionDrag=!0}endSelectionDrag(){this.isInitiatingSelectionDrag=!1}isDraggingToSelect(){return this.isInitiatingSelectionDrag}setIsDraggingNotes(e){this.isDraggingNotes=e}getIsDraggingNotes(){return this.isDraggingNotes}isActivelyDragging(){return this.isDraggingNotes||this.isInitiatingSelectionDrag}setLastDeletionTime(){this.lastDeletionTime=performance.now()}getLastDeletionTime(){return this.lastDeletionTime}}class _l{constructor(e){this.container=this.createContainer(),e.appendChild(this.container),this.gridCanvas=this.createCanvas("gridCanvas"),this.noteCanvas=this.createCanvas("noteCanvas"),this.animationCanvas=this.createCanvas("animationCanvas"),this.playheadCanvas=this.createCanvas("playheadCanvas"),this.container.appendChild(this.gridCanvas),this.container.appendChild(this.noteCanvas),this.container.appendChild(this.animationCanvas),this.container.appendChild(this.playheadCanvas),this.gridCtx=this.getCtx(this.gridCanvas),this.noteCtx=this.getCtx(this.noteCanvas),this.animationCtx=this.getCtx(this.animationCanvas),this.playheadCtx=this.getCtx(this.playheadCanvas),this.injectContainerStyles(),this.injectCanvasStyles()}createContainer(){const e=document.createElement("div");return e.id="grid-container",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="#222",e.style.border="1px solid #333",e.style.overflow="hidden",e.style.boxShadow="0 0 20px rgba(0,0,0,0.4)",e.style.borderRadius="6px",e}createCanvas(e){const i=document.createElement("canvas");return i.id=e,i.style.display="block",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",i}getCtx(e){const i=e.getContext("2d");if(!i)throw new Error(`2D context not available for canvas with id: ${e.id}`);return i}injectContainerStyles(){const e=document.createElement("style");e.textContent=`
        #grid-container canvas {
          z-index: 0;
        }
        #grid-container canvas#noteCanvas {
          z-index: 1;
        }
        #grid-container canvas#animationCanvas {
          z-index: 2;
        }
        #grid-container canvas#playheadCanvas {
          z-index: 3;
        }
      `,document.head.appendChild(e)}injectCanvasStyles(){}}class gl{constructor(e,i){this.scroll=e,this.config=i}draw(e){const{layout:{baseCellWidth:i,headerHeight:s,labelWidth:a},totalMeasures:r,beatsPerMeasure:n,behavior:{zoom:o}}=this.config,{gridColorScheme:c}=ve(),d=Pi[c],l=i*o,u=this.scroll.getX(),h=e.canvas.offsetWidth;e.save(),e.translate(a-u,0);const f=e.createLinearGradient(0,0,0,s);f.addColorStop(0,d.labelWhite),f.addColorStop(1,d.labelBlack),e.fillStyle=f,e.fillRect(-a+u,0,h,s);for(let p=0;p<=r;p++){const y=p*n*l,m=p%4===0;e.strokeStyle=m?d.measureLine:d.beatLine,e.lineWidth=m?2:1,e.beginPath(),e.moveTo(y,0),e.lineTo(y,s),e.stroke(),e.textAlign="center",e.textBaseline="top",e.fillStyle=m?d.textWhite:d.textBlack,e.font=`${m?"bold":""} ${Math.floor(s*.5)}px 'Inter', sans-serif`;const _=y+n*l/2;e.fillText(`${p+1}`,_,4)}e.restore()}}class bl{constructor(e,i,s,a){this.scroll=e,this.config=i,this.getCustomLabels=s,this.getBlackKeyMap=a;const{lowestMidi:r,highestMidi:n}=i.layout;this.blackKeyMap=Zs(r,n)}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,headerHeight:a,labelWidth:r,highestMidi:n,lowestMidi:o},behavior:{zoom:c}}=this.config,{gridColorScheme:d}=ve(),l=Pi[d],u=n-o+1,h=this.scroll.getY(),p=i*c/s,g=e.canvas.offsetHeight??u*p+a;e.save(),e.translate(0,-h);const y=e.createLinearGradient(0,0,0,g);y.addColorStop(0,l.labelWhite),y.addColorStop(1,l.labelBlack),e.fillStyle=y,e.fillRect(0,h,r,g),e.font=`${Math.floor(p*.6)}px 'Inter', sans-serif`,e.textAlign="right",e.textBaseline="middle",e.strokeStyle=l.gridLine,e.lineWidth=1,e.beginPath(),e.moveTo(r-.5,h),e.lineTo(r-.5,h+g),e.stroke();const m=this.getCustomLabels();for(let _=0;_<u;_++){const v=_*p+a,b=n-_,S=(m==null?void 0:m[b])??Ie(_,o,n),N=this.getBlackKeyMap().get(b)??!1;e.fillStyle=N?l.textBlack:l.textWhite,e.fillText(S,r-8,v+p/2)}e.restore()}}class vl{constructor(e,i,s){this.scroll=e,this.config=i,this.interactionStore=s}draw(e){const i=this.interactionStore.getMarqueeBox();if(!i)return;const{layout:{baseCellWidth:s,verticalCellRatio:a},behavior:{zoom:r}}=this.config,n=this.scroll.getX(),o=this.scroll.getY(),c=Math.min(i.startX,i.currentX),d=Math.min(i.startY,i.currentY),l=Math.abs(i.currentX-i.startX),u=Math.abs(i.currentY-i.startY);l<1||u<1||(e.save(),e.translate(this.config.layout.labelWidth-n,this.config.layout.headerHeight-o),e.strokeStyle="rgba(128, 90, 213, 1.0)",e.lineWidth=2,e.setLineDash([5,5]),yt(e,c,d,l,u,3),e.stroke(),e.restore())}}let yr={notes:[],anchorBeat:0,anchorMidi:0};function Sl(t){if(t.length===0)return;const e=t[0],i=e.start,s=K(e.pitch)??0;yr={notes:t.map(a=>({pitch:a.pitch,start:a.start,duration:a.duration,velocity:a.velocity??100})),anchorBeat:i,anchorMidi:s}}function Nl(){return yr}class Cl{constructor(){this.listeners={}}on(e,i){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(i)}off(e,i){var s;(s=this.listeners[e])==null||s.delete(i)}emit(e,i){var s;(s=this.listeners[e])==null||s.forEach(a=>a(i))}clear(e){var i;(i=this.listeners[e])==null||i.clear()}removeAllListeners(){var e;for(const i in this.listeners)(e=this.listeners[i])==null||e.clear()}}class Ml{constructor(e,i={},s){this.sequencerConfig=Y,this.needsRedraw=!0,this.customLabels=null,this.blackKeyMap=new Map,this.isDestroyed=!1,this.onWindowResize=()=>this.resize(),this.config=xo(Oo(),i),this.sequencerContext=s,this.recalculateLabelAndHeader(),this.gridManager=new _l(e);const{gridCanvas:a,noteCanvas:r,animationCanvas:n,playheadCanvas:o}=this.gridManager;this.gridCanvasManager=new St(a),this.noteCanvasManager=new St(r),this.animationCanvasManager=new St(n),this.playheadCanvasManager=new St(o);const c=this.gridManager.container;this.noteManager=new Ho(this.config,this.sequencerContext.playNote),this.interactionStore=new yl,this.emitter=new Cl,this.scroll=new Jo(c,this.config),this.scrollbars=new il(c,this.scroll,this.config,this.interactionStore,()=>this.requestRedraw()),this.wheelHandler=new pl(c,this.scroll,()=>this.requestRedraw()),this.cursorController=new hl(c);const d={canvas:r,noteManager:this.noteManager,scroll:this.scroll,config:this.config,store:this.interactionStore,grid:this,addNote:l=>this.noteManager.add(l),requestRedraw:()=>this.requestRedraw(),sequencerContext:s,cursorController:this.cursorController,setClipboard:Sl,getClipboard:Nl,playNoteAnimation:l=>this.playNoteAnimation(l)};this.interactionContext=new fl(d),this.inputTracker=new ml(this.interactionContext,c),this.gridRenderer=new Uo(this.scroll,this.config,this.interactionStore,()=>this.getBlackKeyMap()),this.noteRenderer=new Yo(this.scroll,this.config,this.noteManager,this.interactionStore,this.sequencerContext.getId()),this.notePreviewRenderer=new Zo(this.scroll,this.config,this.interactionStore,()=>this.getNoteDuration()),this.animationRenderer=new Qo(this.scroll,this.config),this.headerRenderer=new gl(this.scroll,this.config),this.labelRenderer=new bl(this.scroll,this.config,()=>this.customLabels,()=>this.getBlackKeyMap()),this.playheadRenderer=new el(this.scroll,this.config),this.marqueeRenderer=new vl(this.scroll,this.config,this.interactionStore),this.initialZoom=this.zoom,this.customLabels=null,requestAnimationFrame(()=>this.resize()),this.playheadRenderer.setPlayheadX(0),this.attachListeners(),this.renderLoop()}attachListeners(){window.addEventListener("resize",this.onWindowResize)}detachListeners(){window.removeEventListener("resize",this.onWindowResize)}renderLoop(){this.isDestroyed||(this.needsRedraw&&(this.render(),this.needsRedraw=!1),requestAnimationFrame(()=>this.renderLoop()))}recalculateLabelAndHeader(){const{baseCellWidth:e,verticalCellRatio:i,labelWidthColumns:s,headerHeightRows:a}=this.config.layout,r=this.zoom,n=e*r,o=n/i;this.config.layout.labelWidth=s*n,this.config.layout.headerHeight=a*o}get zoom(){return this.config.behavior.zoom}set zoom(e){this.config.behavior.zoom=e}get notes(){const e=this.noteManager.getAll();return e||[]}render(){this.gridCanvasManager.clear(),this.noteCanvasManager.clear(),this.animationCanvasManager.clear(),this.playheadCanvasManager.clear();const e=this.gridCanvasManager.getContext(),i=this.noteCanvasManager.getContext(),s=this.animationCanvasManager.getContext(),a=this.playheadCanvasManager.getContext();this.gridRenderer.draw(e),this.noteRenderer.draw(i),this.notePreviewRenderer.draw(i),this.animationRenderer.draw(s),this.labelRenderer.draw(e),this.headerRenderer.draw(e),this.playheadRenderer.draw(a),this.interactionStore.hasMarquee()&&this.marqueeRenderer.draw(s),this.scrollbars.update()}requestRedraw(){this.needsRedraw=!0}resize(){this.gridCanvasManager.resize(),this.noteCanvasManager.resize(),this.animationCanvasManager.resize(),this.playheadCanvasManager.resize(),this.scroll.recalculateBounds(),this.scrollbars.update(),this.requestRedraw()}on(e,i){this.emitter.on(e,i)}off(e,i){this.emitter.off(e,i)}setPlayheadPixelX(e){this.playheadRenderer.setPlayheadX(e),this.requestRedraw()}getPixelsPerBeat(){return this.config.layout.baseCellWidth*this.config.behavior.zoom}setNotes(e){this.noteManager.set(e),this.requestRedraw()}playNoteAnimation(e){this.animationRenderer.playNote(e)}getTrackedNotes(){return this.noteManager.getTrackedNotes(this.interactionStore)}scrollTo(e,i){this.scroll.setScroll(e,i),this.scrollbars.update(),this.requestRedraw()}setZoom(e){this.zoom=e,this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.requestRedraw()}getZoom(){return this.zoom}resetZoom(){this.setZoom(this.initialZoom)}zoomIn(){this.setZoom(Math.min(this.config.behavior.maxZoom,this.zoom+.1))}zoomOut(){this.setZoom(Math.max(this.config.behavior.minZoom,this.zoom-.1))}setCustomLabels(e){this.customLabels=e,this.requestRedraw()}getMeasures(){return this.config.totalMeasures}setMeasures(e){this.config.totalMeasures=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getBeatsPerMeasure(){return this.config.beatsPerMeasure}setBeatsPerMeasure(e){this.config.beatsPerMeasure=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getTotalBeats(){return this.config.totalMeasures*this.config.beatsPerMeasure}setNoteRange(e,i){this.config.layout.lowestMidi=e,this.config.layout.highestMidi=i,this.blackKeyMap=Zs(e,i),this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.resize(),this.requestRedraw()}refreshNoteRange(){this.setNoteRange(this.config.layout.lowestMidi,this.config.layout.highestMidi)}getBlackKeyMap(){return this.blackKeyMap}isTripletMode(){return this.sequencerConfig.isTripletMode}getNoteDuration(){return this.sequencerConfig.currentDuration}getSnapResolution(){return this.sequencerConfig.snapResolution}getInteractionStore(){return this.interactionStore}getNoteManager(){return this.noteManager}emit(e,i){this.emitter.emit(e,i)}destroy(){this.inputTracker.destroy(),this.wheelHandler.destroy(),this.scrollbars.destroy(),this.gridManager.container.remove(),this.gridCanvasManager.destroy(),this.noteCanvasManager.destroy(),this.animationCanvasManager.destroy(),this.playheadCanvasManager.destroy(),this.detachListeners(),this.emitter.removeAllListeners(),this.interactionContext.destroy(),this.isDestroyed=!0}}function Bl(t,e,i){return new Ml(t,e,i)}function _r({instrument:t,midi:e,time:i,duration:s,velocity:a}){var n;const r=((n=t.__midiMap)==null?void 0:n.get(e))??e;if(!(t!=null&&t.start)){console.warn("[startInstrumentNote] Instrument missing start() method");return}try{t.start({note:r,time:i,duration:s,velocity:a})}catch(o){console.warn("[startInstrumentNote] Failed to start instrument note",{midi:e,resolved:r,err:o})}}function Oi(t,e){var i;(i=t==null?void 0:t.stop)==null||i.call(t);for(const s of e)clearTimeout(s);e.length=0}async function Ll(t,e,i,s,a,r,n,o=0){if(!a)return;if(t||await e(),Oi(t,r),!(t!=null&&t.start)){console.warn("[playback] Instrument does not support scheduled playback.");return}const d=60/he(),l=performance.now();i.sort((h,f)=>h.start-f.start);let u=0;for(;u<i.length&&i[u].start<o;)u++;for(;u<i.length;u++){const h=i[u],f=X(h.pitch);if(f==null)continue;const p=h.start-o,g=n+p*d,y=h.duration*d,m=h.velocity??100;if(_r({instrument:t,midi:f,time:g,duration:y,velocity:m}),!s){const _=l+p*d*1e3,v=Math.max(0,_-performance.now()),b=setTimeout(()=>{a==null||a.playNoteAnimation(h)},v);r.push(b)}}}function wl(t,e,i,s,a,r){if(!s||a)return;const o=60/he();performance.now();const l=(z().currentTime-e)/o,u=i+l;for(const h of t){if(h.start<u)continue;const p=(h.start-u)*o*1e3;if(p>=0){const g=setTimeout(()=>{s==null||s.playNoteAnimation(h)},p);r.push(g)}}}async function Gl(t,e,i,s,a,r,n,o,c,d=0){if(!s||(Oi(t,o),t||await e(),r||!n||!(t!=null&&t.start)))return;const u=60/he(),h=performance.now(),f=z().currentTime,p=i.filter(g=>g.start>=d);for(const g of p){const y=X(g.pitch);if(y==null)continue;const m=g.start-d,_=c+m*u;if(_<=f+.01)continue;const v=g.duration*u,b=g.velocity??100;if(_r({instrument:t,midi:y,time:_,duration:v,velocity:b}),!a){const S=h+m*u*1e3,N=Math.max(0,S-performance.now()),C=setTimeout(()=>{s==null||s.playNoteAnimation(g)},N);o.push(C)}}}const Z=class Z{constructor(e,i,s=z(),a=qe(),r="sf2/fluidr3-gm/acoustic_grand_piano",n=!1,o=0){if(this.colorIndex=0,this._registry=null,this.id=0,this.mute=!1,this.solo=!1,this.collapsed=!1,this._scheduledAnimations=[],this._volume=100/127,this._pan=0,this._instrument=null,Z.allSequencers.push(this),this.id=o,this.container=e,this.config={...i},this.context=s,this.destination=a,this.instrumentName=r,this.squelchLoadingScreen=n,this.container){const c=this.container.querySelector(".sequencer-body");this.matrix=Bl(c,{},{playNote:this.playNote.bind(this),getId:()=>this.id}),this.matrix.refreshNoteRange()}}static isAnySoloActive(){return Z.allSequencers.some(e=>e.solo)}static rescheduleAll(){if(!I.isActive())return;const e=I.getStartTime(),i=I.getStartBeat();for(const s of Z.allSequencers)s.stopScheduledNotes(),s.shouldPlay&&(s.reschedulePlayback(e,i),s.resumeAnimationsFromCurrentTime(e,i))}async initInstrument(){try{this._instrument=await Ys(this.instrumentName,this.context,this.destination,this._volume,this._pan,!1,!1),this.updateToDrumNoteRange()}catch(e){console.warn(`[SEQ:${this.id}] Failed to load instrument '${this.instrumentName}':`,e)}}setInstrument(e){this.instrumentName=e,this.updateTrackLabel(),this.initInstrument()}updateTrackLabel(){var i;const e=(i=this.container)==null?void 0:i.querySelector(".track-name");e&&(e.textContent=`${this.id+1}: ${this.instrumentName}`)}get notes(){var e;return((e=this.matrix)==null?void 0:e.notes)??[]}get volume(){return this._volume}set volume(e){var i;this._volume=Math.max(0,Math.min(1,e)),(i=this._instrument)!=null&&i.setVolume&&this._instrument.setVolume(this._volume)}get pan(){return this._pan}set pan(e){var i;this._pan=Math.max(-1,Math.min(1,e)),(i=this._instrument)!=null&&i.setPan&&this._instrument.setPan(this._pan)}get shouldPlay(){return Z.isAnySoloActive()?this.solo:!this.mute}get scheduledAnimations(){return this._scheduledAnimations}set scheduledAnimations(e){this._scheduledAnimations=e}toggleMute(){this.mute=!this.mute,this.mute&&(this.solo=!1),this.stopScheduledNotes(),Vi(this),I.isActive()&&Z.rescheduleAll()}toggleSolo(){this.solo=!this.solo,this.solo&&(this.mute=!1),Vi(this),I.isActive()&&Z.rescheduleAll()}setCollapsed(e){Fo(this,e)}async preparePlayback(e,i=0){var s;await Ll(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.collapsed,this.matrix??null,this._scheduledAnimations,e,i)}stopScheduledNotes(){Oi(this._instrument,this._scheduledAnimations)}resumeAnimationsFromCurrentTime(e,i){var s;wl(((s=this.matrix)==null?void 0:s.notes)??[],e,i,this.matrix??null,this.collapsed,this._scheduledAnimations)}async reschedulePlayback(e,i=0){var s;await Gl(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.matrix??null,this.collapsed,this.mute,this.shouldPlay,this._scheduledAnimations,e,i)}async exportToOffline(e,i){var a;const s=i??((a=this.matrix)==null?void 0:a.notes);!s||s.length===0||await Eo(this.instrumentName,this.context,this.destination,s,this._volume,this._pan,e)}playNote(e,i,s=100,a=!1){return kn(this.instrumentName,e,i,s,a,null,Ae(),this.destination,this.volume,this.pan)}updateTotalMeasures(){this.matrix&&this.matrix.setMeasures(We())}updateBeatsPerMeasure(){this.matrix&&this.matrix.setBeatsPerMeasure(gt())}redraw(){var e;(e=this.matrix)==null||e.requestRedraw()}getState(){return this.matrix?{notes:[...this.matrix.notes],config:{...this.config},instrument:this.instrumentName}:{notes:[],config:this.config,instrument:this.instrumentName}}setState({notes:e,config:i,instrument:s,volume:a,pan:r}){this.matrix&&(this.matrix.setNotes(e),Object.assign(this.config,i),typeof a=="number"&&(this.volume=a),typeof r=="number"&&(this.pan=r),s&&(this.instrumentName=s),this.redraw())}updateNotesFromTrackMap(e){this.matrix&&this.matrix.notes.splice(0,this.matrix.notes.length,...e.n.map(([i,s,a,r=100])=>({pitch:i,start:s,duration:a,velocity:r})))}updateNoteRange(e){pi({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var i;return((i=this.matrix)==null?void 0:i.notes)??[]}},e)}updateToDrumNoteRange(){To({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var e;return((e=this.matrix)==null?void 0:e.notes)??[]}})}setRegistry(e){this._registry=e}destroy(){var e,i,s;this.stopScheduledNotes(),(e=this.matrix)==null||e.destroy(),(i=this.container)==null||i.remove(),Z.allSequencers=Z.allSequencers.filter(a=>a!==this),(s=this._registry)==null||s.clear(),this._instrument=null,this.matrix=void 0,this.container=null,this.refreshPanUI=void 0,this.refreshVolumeUI=void 0}};Z.allSequencers=[];let Ut=Z,_e,De,gr,br,ke,se,ce="sf2";function El(){_e=document.getElementById("instrument-select-modal"),De=document.getElementById("instrument-select"),gr=document.getElementById("instrument-select-confirm"),br=document.getElementById("instrument-cancel-btn"),ke=document.getElementById("instrument-engine-select"),se=document.getElementById("instrument-library-select"),Il(),kl()}function Il(){const t=Tn();ke.innerHTML="",t.forEach(e=>{const i=document.createElement("option");i.value=e,i.textContent=e.toUpperCase(),ke.appendChild(i)}),ke.value=ce}function kl(){ke.addEventListener("change",async()=>{ce=ke.value,await vr()}),se.addEventListener("change",()=>{const t=new CustomEvent("instrument-library-change",{detail:{preselect:null}});se.dispatchEvent(t)}),se.addEventListener("instrument-library-change",async t=>{var a;const e=t,i=se.value,s=((a=e.detail)==null?void 0:a.preselect)??null;try{const r=await Pn(i,ce);De.innerHTML="",r.forEach(n=>{const o=document.createElement("option");o.value=`${ce}/${i}/${n}`,o.textContent=n.split("_").map(c=>c?c[0].toUpperCase()+c.slice(1):"").join(" "),De.appendChild(o)}),s?De.value=s:r.length>0&&(De.value=`${ce}/${i}/${r[0]}`)}catch(r){console.error(`Failed to load instruments for library: ${i}`,r)}}),gr.addEventListener("click",Al),br.addEventListener("click",Fl)}async function vr(t=null,e=null){try{const i=await Fn(ce);se.innerHTML="",i.forEach(a=>{const r=document.createElement("option");r.value=a,r.textContent=a.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase()),se.appendChild(r)}),t&&i.includes(t)?se.value=t:i.length>0&&(se.value=i[0]);const s=new CustomEvent("instrument-library-change",{detail:{preselect:e}});se.dispatchEvent(s)}catch(i){console.error("Failed to refresh libraries for engine:",ce,i)}}async function Sr(t,e){const[i,s,a]=t.split("/");ce=i||"sf2",ke.value=ce,e!==void 0?_e.dataset.currentSequencer=String(e):delete _e.dataset.currentSequencer,await vr(s,t)}async function Al(){const t=De.value;_e.classList.add("hidden");const e=Number(_e.dataset.currentSequencer);if(_e.dataset.currentSequencer!==void 0&&!isNaN(e)){const i=Dl(e);if(i){O(Yn(i.id,t),Zn(i.id,i.instrumentName)),i.setInstrument(t);return}console.warn(`Failed to find sequencer with ID ${e}`);return}if(_e.dataset.currentSequencer===void 0)try{return await zs(t),window.dispatchEvent(new CustomEvent("global-instrument-selected",{detail:{fullName:t}})),t}catch(i){console.error("Failed to load global instrument:",t,i)}}function Fl(){_e.classList.add("hidden")}function Pl(t,e){var h;const i=(h=t.querySelector(".volume-fill"))==null?void 0:h.parentElement,s=t.querySelector(".volume-fill"),a=t.querySelector(".volume-thumb");let r=!1,n=!1,o=!1,c=null;if(!i||!s){console.warn("[setupVolumeBar] Volume bar or fill element missing.");return}function d(){const f=Math.max(0,Math.min(1,e.volume)),p=100/127,g=i.clientWidth,y=14,m=0,_=g-y,v=f*g,b=Math.max(m,Math.min(_,v-y/2)),S=Math.round(f*100);s.style.width=`${S}%`,a.style.left=`${b}px`;const N=Math.round(f/p*100);i.setAttribute("title",`Volume: ${N}%`),f>p?(s.classList.add("overdrive"),a.classList.add("overdrive")):(s.classList.remove("overdrive"),a.classList.remove("overdrive"))}function l(){n?(s.classList.add("precise"),a.classList.add("precise")):(s.classList.remove("precise"),a.classList.remove("precise"))}e.refreshVolumeUI=d,requestAnimationFrame(d);function u(f){const p=i.getBoundingClientRect(),g=f-p.left,y=100/127,m=.1;let _=Math.max(0,Math.min(1,g/p.width));return!n&&Math.abs(_-y)<m?(_=y,!r&&navigator.vibrate&&navigator.vibrate(10),r=!0):r=!1,e.volume=_,d(),_}i.addEventListener("mousedown",f=>{o=!0,n=f.shiftKey,c=e.volume,l(),u(f.clientX),f.preventDefault()}),window.addEventListener("mousemove",f=>{o&&(n=f.shiftKey,l(),u(f.clientX))}),window.addEventListener("mouseup",f=>{if(!o)return;o=!1;const p=u(f.clientX);c!==null&&p!==c&&O(eo(e.id,p),to(e.id,c)),n=!1,l(),s.classList.remove("precise"),a.classList.remove("precise"),d(),c=null})}function Tl(t,e){var h;const i=(h=t.querySelector(".pan-fill"))==null?void 0:h.parentElement,s=t.querySelector(".pan-fill"),a=t.querySelector(".pan-thumb");let r=!1,n=!1,o=!1,c=null;if(!i||!s){console.warn("[setupPanBar] Pan bar or fill element missing.");return}function d(){const f=Math.max(-1,Math.min(1,e.pan)),p=(f+1)/2,g=i.clientWidth,y=14,m=0,_=g-y,v=p*g,b=Math.max(m,Math.min(_,v-y/2)),S=Math.round(p*100);s.style.width=`${S}%`,a.style.left=`${b}px`;const N=Math.round(f*100);i.setAttribute("title",`Pan: ${N}%`)}e.refreshPanUI=d;function l(){n?(s.classList.add("precise"),a.classList.add("precise")):(s.classList.remove("precise"),a.classList.remove("precise"))}requestAnimationFrame(d);function u(f){const p=i.getBoundingClientRect(),g=f-p.left;let m=Math.max(0,Math.min(1,g/p.width))*2-1;const _=0;return!n&&Math.abs(m-_)<.05?(m=_,!r&&navigator.vibrate&&navigator.vibrate(10),r=!0):r=!1,e.pan=m,d(),m}i.addEventListener("mousedown",f=>{o=!0,n=f.shiftKey,c=e.pan,l(),u(f.clientX),f.preventDefault()}),window.addEventListener("mouseup",f=>{if(!o)return;o=!1;const p=u(f.clientX);c!==null&&p!==c&&O(so(e.id,p),ro(e.id,c)),n=!1,l(),s.classList.remove("precise"),a.classList.remove("precise"),d(),c=null}),window.addEventListener("mousemove",f=>{o&&(n=f.shiftKey,l(),u(f.clientX))})}class Rl{constructor(){this.listeners=[]}on(e,i,s,a){e.addEventListener(i,s,a),this.listeners.push({target:e,type:i,handler:s,options:a})}clearHandler(e,i,s){for(let a=this.listeners.length-1;a>=0;a--){const r=this.listeners[a];r.target===e&&r.type===i&&r.handler===s&&(e.removeEventListener(i,s,r.options),this.listeners.splice(a,1))}}clear(){for(const{target:e,type:i,handler:s,options:a}of this.listeners)e.removeEventListener(i,s,a);this.listeners.length=0}}const R=[],Ol=document.getElementById("sequencers-container"),xl=document.getElementById("sequencer-template"),Ul=document.getElementById("add-sequencer");function Nr(t){const e=new Rl,s=xl.content.cloneNode(!0).querySelector(".sequencer");Ol.insertBefore(s,Ul);const a=R.length,r={id:a,...Y},n=(t==null?void 0:t.instrument)||"sf2/fluidr3-gm/acoustic_grand_piano",o=new Ut(s,r,z(),qe(),n,!0,a);o.id=a,o.colorIndex=a,o.mute=!1,o.solo=!1,o.volume=100/127,t!=null&&t.notes&&o.matrix&&o.matrix.setNotes(t.notes);const c=s.querySelector("canvas.mini-contour");t&&o.setState({notes:t.notes,config:{},instrument:t.instrument,volume:t.volume,pan:t.pan}),mt(c,o.notes,o.config,o.colorIndex),o.updateTrackLabel(),o.initInstrument(),Pl(s,o),Tl(s,o);const d=s.querySelector(".collapse-btn"),l=d.querySelector("use"),u=s.querySelector(".sequencer-body");e.on(d,"click",()=>{const m=u.classList.toggle("hidden");l.setAttribute("href",m?"#icon-caret-up":"#icon-caret-down"),c.classList.toggle("hidden",!m),o.setCollapsed(m),m&&mt(c,o.notes,o.config,o.colorIndex)});const h=s.querySelector(".delete-btn");e.on(h,"click",()=>{const m=document.getElementById("delete-confirm-modal"),_=document.getElementById("delete-confirm"),v=document.getElementById("delete-cancel");m.classList.remove("hidden");const b=()=>{O(sr(o.id,o.instrumentName,o.notes,o.volume,o.pan),rr(o.id,o.instrumentName,o.notes,o.volume,o.pan)),N()},S=()=>N(),N=()=>{m.classList.add("hidden"),e.clearHandler(_,"click",b),e.clearHandler(v,"click",S)};e.on(_,"click",b),e.on(v,"click",S)});const f=s.querySelector(".mute-btn"),p=s.querySelector(".solo-btn"),g=s.querySelector(".instrument-select-btn"),y=(m,_)=>m.classList.toggle("side-button-activated",_);return e.on(f,"click",()=>{o.toggleMute(),y(f,o.mute),y(p,o.solo)}),e.on(p,"click",()=>{o.toggleSolo(),y(f,o.mute),y(p,o.solo)}),e.on(g,"click",async()=>{const m=o.instrumentName||"sf2/fluidr3-gm/acoustic_grand_piano";await Sr(m,o.id),document.getElementById("instrument-select-modal").classList.remove("hidden")}),ko(s,o.matrix,e),Io(s,()=>{var m;return(m=o.matrix)==null?void 0:m.zoomIn()},()=>{var m;return(m=o.matrix)==null?void 0:m.zoomOut()},()=>{var m;return(m=o.matrix)==null?void 0:m.resetZoom()},e),R.push(o),o.setRegistry(e),o.setCollapsed(!1),{seq:o,wrapper:s}}function re(){return R}function Dl(t){const e=t;return R.find(i=>i.id===e)}function ql(){var t,e;for(const i of R.slice())O(sr(i.id,i.instrumentName,((t=i.matrix)==null?void 0:t.getNoteManager().getAll())??[],i.volume,i.pan),rr(i.id,i.instrumentName,((e=i.matrix)==null?void 0:e.getNoteManager().getAll())??[],i.volume,i.pan))}function xi(){const t=re();for(const e of t){const i=e.matrix;if(!i)continue;const s=i.getInteractionStore();if(s.hasSelection())return{sequencerId:e.id,selectedNotes:s.getSelectedNotes()}}return null}function Jl(t){const e=xi();if(!e){console.warn("No active note selection to apply velocity changes.");return}const{sequencerId:i,selectedNotes:s}=e;if(s.length===0){console.warn("No notes selected in the active sequencer.");return}const a=re().find(m=>m.id===i);if(!(a!=null&&a.matrix)){console.warn(`Could not find matrix for sequencer ID ${i}.`);return}const r=s.map(m=>({...m})),{mode:n,value:o,rampDirection:c="none",rampAmount:d=0,rampMode:l="linear",randomize:u=!1,randomRange:h=0}=t,f=s.map((m,_)=>({note:m,originalIndex:_}));f.sort((m,_)=>m.note.start-_.note.start);const p=new Map;for(const m of f){const _=m.note.start;p.has(_)||p.set(_,[]),p.get(_).push(m)}Array.from(p.entries()).sort((m,_)=>m[0]-_[0]).map(([,m])=>m).forEach((m,_)=>{let v=l==="linear"?_:Math.pow(_,1.3),b=d*v;c==="down"&&(b=-b);for(const{note:S}of m){let N;switch(n){case"set":N=Math.max(1,o);break;case"increase":N=(S.velocity??100)+o;break;case"decrease":N=(S.velocity??100)-o;break;case"none":default:N=S.velocity??100;break}let C=N+b;if(u&&h>0){const M=(Math.random()*2-1)*h;C+=M}S.velocity=Math.max(1,Math.min(127,Math.round(C)))}});const y=f.sort((m,_)=>m.originalIndex-_.originalIndex).map(({note:m})=>({...m}));O(yo(i,y),_o(i,r))}const es="velocity-modal",Hl="velocity-action-select",$l="velocity-value-input",Kl="velocity-apply-btn",Wl="velocity-cancel-btn";function Cr(){const t=document.getElementById(es);if(!t)throw new Error(`[VelocityModeMenu] Modal element "#${es}" not found`);return t}function Mr(t){Cr().classList.remove("hidden")}function Br(){Cr().classList.add("hidden")}function zl(){var u,h,f,p,g,y,m,_,v;const t=((u=document.getElementById("velocity-set-toggle"))==null?void 0:u.checked)??!0,e=((h=document.getElementById("velocity-ramp-toggle"))==null?void 0:h.checked)??!1,i=((f=document.getElementById("velocity-randomize-toggle"))==null?void 0:f.checked)??!1,s=parseInt(((p=document.getElementById($l))==null?void 0:p.value)??"",10),a=isNaN(s)?100:s,r=Math.max(1,Math.min(127,a)),n=t?(g=document.getElementById(Hl))==null?void 0:g.value:"none",o=e?(y=document.getElementById("velocity-ramp-direction"))==null?void 0:y.value:"none",c=e?parseInt(((m=document.getElementById("velocity-ramp-amount"))==null?void 0:m.value)??"0",10):0,d=e?(_=document.querySelector('input[name="ramp-mode"]:checked'))==null?void 0:_.value:"linear",l=i?parseInt(((v=document.getElementById("velocity-random-range"))==null?void 0:v.value)??"0",10):0;Jl({mode:n,value:r,rampDirection:o,rampAmount:c,rampMode:d,randomize:i,randomRange:l}),Br()}function Xl(){Br()}function Vl(){const t=document.getElementById("velocity-set-toggle"),e=document.getElementById("velocity-set-fields"),i=document.getElementById("velocity-ramp-toggle"),s=document.getElementById("velocity-ramp-fields"),a=document.getElementById("velocity-randomize-toggle"),r=document.getElementById("velocity-random-fields");if(t&&e&&t.addEventListener("change",()=>{e.classList.toggle("opacity-50",!t.checked),e.classList.toggle("pointer-events-none",!t.checked)}),i&&s&&(i.checked=!1,s.classList.add("opacity-50","pointer-events-none"),i.addEventListener("change",()=>{s.classList.toggle("opacity-50",!i.checked),s.classList.toggle("pointer-events-none",!i.checked)})),a&&r){const n=()=>{const o=a.checked;r.classList.toggle("opacity-50",!o),r.classList.toggle("pointer-events-none",!o)};a.addEventListener("change",n),n()}}function jl(){var t,e;(t=document.getElementById(Kl))==null||t.addEventListener("click",zl),(e=document.getElementById(Wl))==null||e.addEventListener("click",Xl),Vl()}function Lr(t){const e=document.getElementById("error-modal"),i=document.getElementById("error-message-content");if(!e||!i){console.error("Error modal elements not found");return}i.textContent=t,e.classList.remove("hidden")}var ws;(ws=document.getElementById("error-close-btn"))==null||ws.addEventListener("click",()=>{var t;(t=document.getElementById("error-modal"))==null||t.classList.add("hidden")});function Yl(){const t=xi();if(!t||t.selectedNotes.length===0){Lr("No notes selected. Please select notes before adjusting velocity.");return}Mr(t.selectedNotes)}function Zl(){const t=document.getElementById("velocity-mode-menu-btn");if(!t){console.warn('[VelocityMode] Could not find button with id "velocity-mode-menu-btn".');return}t.addEventListener("click",Yl)}const Ql="v0.0.10",ed="May 5, 2025",td=[" New Features","-  Introduced fully modular matrix-based grid system for better performance and maintainability","-  Switched to multi-canvas rendering (grid, note, animation) for improved visual clarity and layering","-  Implemented robust interaction state machine for clean, extensible editing tools","-  Refined visual rendering of note grid, headers, and pitch labels for better contrast and UX","-  WebAudioFont engine support finalized for broader instrument playback","-  Fixed WAV export context handling for improved reliability"," Known Issues","-  Note placement during live playback of large sequences causes performance issues","-  Several other small bugs and edge cases remain to be addressed"," Roadmap","-  AI-assisted generation and track extension tools (May rollout)","-  Customizable keyboard shortcuts and input presets"];function id(){const t=document.getElementById("whats-new-modal"),e=t==null?void 0:t.querySelector("ul"),i=document.getElementById("whats-new-metadata"),s=t==null?void 0:t.querySelector("img");if(t&&e&&i){e.innerHTML="",i.textContent=`${Ql}  Updated ${ed}`,s&&(s.src=Es("static/logo.png"));let a=null;for(const r of td)if(r.startsWith("")||r.startsWith("")||r.startsWith("")){const n=document.createElement("li");n.textContent=r,n.classList.add("font-bold","mt-6","text-lg"),e.appendChild(n),a=document.createElement("ul"),a.classList.add("list-disc","list-inside","ml-6","mt-2","space-y-1"),e.appendChild(a)}else if(a){const n=document.createElement("li");n.textContent=r.replace(/^- /,""),a.appendChild(n)}t.classList.remove("hidden")}}function sd(){const t=document.getElementById("whats-new-modal");t&&(t.style.opacity="0",t.style.transition="opacity 0.4s ease-out",setTimeout(()=>{t.classList.add("hidden"),t.style.opacity="1"},400))}var Gs;(Gs=document.getElementById("whats-new-close-btn"))==null||Gs.addEventListener("click",sd);function rd(){var t;(t=document.getElementById("footer-whats-new-btn"))==null||t.addEventListener("click",id)}function ad(){const t=document.getElementById("footer-help-btn");t&&t.addEventListener("click",()=>{window.open("https://github.com/alacrity-ai/sequenzia","_blank")})}function jt(t=3){const r=["C","D","E","F","G","A","B"],n=["C#","D#","","F#","G#","A#",""],o=[t,t+1,t+2],c={};let d=0;for(const l of o)r.forEach(u=>{const h=`${u}${l}`;c[h]={note:h,x:d,width:60,height:200,isBlack:!1},d+=60});d=0;for(const l of o)n.forEach((u,h)=>{if(u===""){d+=60;return}const f=`${u}${l}`;c[f]={note:f,x:d+60-40/2,width:40,height:120,isBlack:!0},d+=60});return c}function $e(t,e,i=new Set,s=null){t.clearRect(0,0,t.canvas.width,t.canvas.height);const a={};if(s)for(const[r,n]of Object.entries(s))a[n]=r;for(const r of Object.values(e))r.isBlack||(ts(t,{...r,fill:i.has(r.note)?"#cce0ff":"#ffffff",stroke:"#333",radius:6}),t.fillStyle="#333",t.font="12px sans-serif",t.textAlign="center",a[r.note]&&(t.fillStyle="#7c3aed",t.fillText(a[r.note],r.x+r.width/2,r.height-24),t.fillStyle="#333"),t.fillText(r.note,r.x+r.width/2,r.height-8));for(const r of Object.values(e))r.isBlack&&(ts(t,{...r,fill:i.has(r.note)?"#4a60ff":"#111111",stroke:"#000000",radius:4}),nd(t,r),a[r.note]&&(t.fillStyle="#c084fc",t.font="10px sans-serif",t.textAlign="center",t.fillText(a[r.note],r.x+r.width/2,r.height-28)))}function ts(t,e){const{x:i,width:s,height:a,fill:r,stroke:n,radius:o=8}=e;t.beginPath(),t.moveTo(i,0),t.lineTo(i,a-o),t.quadraticCurveTo(i,a,i+o,a),t.lineTo(i+s-o,a),t.quadraticCurveTo(i+s,a,i+s,a-o),t.lineTo(i+s,0),t.closePath(),t.fillStyle=r,t.fill(),t.strokeStyle=n,t.lineWidth=1,t.stroke()}function nd(t,e){const i=t.createLinearGradient(e.x,0,e.x,e.height);i.addColorStop(0,"rgba(255,255,255,0.2)"),i.addColorStop(.3,"rgba(255,255,255,0)"),t.fillStyle=i,t.beginPath(),t.moveTo(e.x,0),t.lineTo(e.x+e.width,0),t.lineTo(e.x+e.width,e.height*.4),t.lineTo(e.x,e.height*.4),t.closePath(),t.fill()}let is=!1,Nt=null;function wr(t,e){if(is)return;is=!0,Nt=e;const i=t.getContext("2d");if(!i)return;const s=new Map,a=new Set;function r(l,u){const h=Nt();for(const f of Object.values(h))if(f.isBlack&&l>=f.x&&l<=f.x+f.width&&u>=0&&u<=f.height)return f.note;for(const f of Object.values(h))if(!f.isBlack&&l>=f.x&&l<=f.x+f.width&&u>=0&&u<=f.height)return f.note;return null}function n(l){if(!l||a.has(l))return;const u=An(l);u&&(s.set(l,u),a.add(l),i&&$e(i,Nt(),a))}function o(l){if(!a.has(l))return;const u=s.get(l);u&&(u.stop(),s.delete(l)),a.delete(l),i&&$e(i,Nt(),a)}function c(){for(const l of a)o(l)}let d=!1;t.addEventListener("mousedown",l=>{d=!0;const u=t.getBoundingClientRect(),h=l.clientX-u.left,f=l.clientY-u.top,p=r(h,f);n(p)}),t.addEventListener("mousemove",l=>{if(!d)return;const u=t.getBoundingClientRect(),h=l.clientX-u.left,f=l.clientY-u.top,p=r(h,f);n(p)}),t.addEventListener("mouseup",()=>{d=!1,c()}),t.addEventListener("mouseleave",()=>{d=!1,c()})}const Ui=[..."qwertyuiop[zxcvbnm,./"],Di=["2","3","5","6","7","9","0","=","s","d","g","h","k","l",";"];function od(){const t=document.getElementById("instrument-loop-toggle");return(t==null?void 0:t.checked)??!1}let Dt=!1;function Gr(){return Dt}let Ct=null,dt=null,ct=null;function Er(t,e){if(Dt)return;Dt=!0;const i=t.getContext("2d");if(!i)throw new Error("Canvas 2D context not available.");const s=new Set,a=new Set,r=new Map,n=Ui,o=Di;Ct=e;function c(){const u=Ct(),h=Object.values(u).filter(g=>!g.isBlack).sort((g,y)=>g.x-y.x).map(g=>g.note),f=Object.values(u).filter(g=>g.isBlack).sort((g,y)=>g.x-y.x).map(g=>g.note),p={};return n.forEach((g,y)=>{h[y]&&(p[g]=h[y])}),o.forEach((g,y)=>{f[y]&&(p[g]=f[y])}),p}function d(u){const h=c(),f=h[u];if(!(!f||s.has(u))){if(s.add(u),!a.has(f)){const p=Xs(f,100,od());p&&(r.set(f,{stop:p}),a.add(f))}i&&$e(i,Ct(),a,h)}}function l(u){const h=c(),f=h[u];f&&(s.delete(u),a.has(f)&&(In(f),r.delete(f),a.delete(f)),i&&$e(i,Ct(),a,h))}dt=u=>{u.repeat||d(u.key)},ct=u=>{l(u.key)},window.addEventListener("keydown",dt),window.addEventListener("keyup",ct)}function Ir(){dt&&(window.removeEventListener("keydown",dt),dt=null),ct&&(window.removeEventListener("keyup",ct),ct=null),Dt=!1}let xe=3,Fe=jt(xe),Mt=!1;async function ld(t){var r,n;const e=t.getContext("2d");if(!e)throw new Error("Failed to get 2D context for keyboard canvas");function i(){const o=Object.values(Fe).filter(l=>!l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),c=Object.values(Fe).filter(l=>l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),d={};return Ui.forEach((l,u)=>{o[u]&&(d[l]=o[u])}),Di.forEach((l,u)=>{c[u]&&(d[l]=c[u])}),d}function s(){if(!e)return;Fe=jt(xe);const o=Mt?i():null;$e(e,Fe,new Set,o)}wr(t,()=>Fe),s(),(r=document.getElementById("octave-up"))==null||r.addEventListener("click",()=>{xe<7&&(xe++,s())}),(n=document.getElementById("octave-down"))==null||n.addEventListener("click",()=>{xe>1&&(xe--,s())});const a=document.getElementById("disable-keyboard-inputs");return a.classList.remove("bg-purple-600"),a.classList.add("bg-gray-700"),a.addEventListener("click",()=>{Mt=!Mt,Mt?(Er(t,()=>Fe),a.classList.remove("bg-gray-700"),a.classList.add("bg-purple-600")):(Ir(),a.classList.remove("bg-purple-600"),a.classList.add("bg-gray-700")),s()}),{refreshKeyboard:s}}let Ue=3,Pe=jt(Ue),Bt=!1,Lt=null;async function dd(t){var r,n;if(Lt=t.getContext("2d"),!Lt)throw new Error("Failed to get 2D context for keyboard canvas.");await zs("sf2/fluidr3-gm/acoustic_grand_piano");function e(){const o=Object.values(Pe).filter(l=>!l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),c=Object.values(Pe).filter(l=>l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),d={};return Ui.forEach((l,u)=>{o[u]&&(d[l]=o[u])}),Di.forEach((l,u)=>{c[u]&&(d[l]=c[u])}),d}function i(){Pe=jt(Ue);const o=Bt?e():null;Lt&&$e(Lt,Pe,new Set,o)}wr(t,()=>Pe),i(),(r=document.getElementById("octave-up"))==null||r.addEventListener("click",()=>{Ue<7&&(Ue++,i())}),(n=document.getElementById("octave-down"))==null||n.addEventListener("click",()=>{Ue>1&&(Ue--,i())});const s=document.getElementById("disable-keyboard-inputs");s.classList.remove("bg-purple-600"),s.classList.add("bg-gray-700"),s.addEventListener("click",()=>{Bt=!Bt,Bt?(Er(t,()=>Pe),s.classList.remove("bg-gray-700"),s.classList.add("bg-purple-600")):(Ir(),s.classList.remove("bg-purple-600"),s.classList.add("bg-gray-700")),i()}),document.getElementById("global-instrument-select-btn").addEventListener("click",async()=>{const o=En()||"sf2/fluidr3-gm/acoustic_grand_piano",c=document.getElementById("instrument-select-modal");delete c.dataset.currentSequencer,await Sr(o),c.classList.remove("hidden")})}async function cd(t){await dd(t);const{refreshKeyboard:e}=await ld(t)}function ud(t,e){const i=e.getContext("2d");if(!i)throw new Error("Canvas 2D context not available");const s=e.width,a=e.height,r=new Uint8Array(t.fftSize),n=new Uint8Array(t.frequencyBinCount),o=document.createElement("canvas");o.width=s,o.height=a;const c=o.getContext("2d");if(!c)throw new Error("Offscreen canvas 2D context not available");let d="frequency";function l(){if(!i)return;t.getByteTimeDomainData(r),i.fillStyle="#000",i.fillRect(0,0,s,a),i.lineWidth=2,i.strokeStyle="#00ffcc",i.beginPath();const p=s/r.length;let g=0;for(let y=0;y<r.length;y++){const _=r[y]/128*a/2;y===0?i.moveTo(g,_):i.lineTo(g,_),g+=p}i.lineTo(s,a/2),i.stroke()}function u(){if(t.getByteFrequencyData(n),!i)return;i.fillStyle="#000",i.fillRect(0,0,s,a),i.fillStyle="rgba(255,255,255,0.2)",i.fillRect(0,0,1,a),i.fillRect(s-1,0,1,a);const p=128,g=2,y=[];for(let m=0;m<p;m++)y.push(m*s/(p-1));y[y.length-1]=s-1;for(let m=0;m<p;m++){const _=y[m],v=m<p-1?y[m+1]:s,b=Math.max(1,v-_-g),S=20,N=2e4,C=m/(p-1),M=S*Math.pow(N/S,C),k=Math.min(n.length-1,Math.floor(M/22050*n.length)),L=n[k]/255,P=Math.max(1,L*a),A=240-C*240;i.fillStyle=`hsl(${A}, ${80+L*20}%, ${40+L*40}%)`,i.fillRect(_,a-P,b,P)}}function h(){if(t.getByteFrequencyData(n),!c)return;o.initialized||(c.fillStyle="#000",c.fillRect(0,0,s,a),o.initialized=!0),c.drawImage(o,-1,0),c.fillStyle="#000",c.fillRect(s-1,0,1,a);const p=128,g=20,y=2e4;for(let m=0;m<p;m++){const _=m/(p-1),v=g*Math.pow(y/g,_),S=Math.min(n.length-1,Math.floor(v/22050*n.length)),N=n[S]/255,C=a-1-Math.floor(m*a/p);if(N<.05)continue;const M=Math.floor(N*255),E=Math.floor(N*(255-_*200)),k=Math.floor(N*(100+_*155));c.fillStyle=`rgb(${M}, ${E}, ${k})`,c.fillRect(s-1,C,1,1)}i&&(i.fillStyle="#000",i.fillRect(0,0,s,a),i.drawImage(o,0,0))}function f(){switch(requestAnimationFrame(f),d){case"frequency":u();break;case"spectrogram":h();break;case"waveform":default:l()}}return f(),{setMode(p){["waveform","frequency","spectrogram"].includes(p)&&(d=p,i.clearRect(0,0,s,a),d==="spectrogram"&&c.clearRect(0,0,s,a))}}}function fd(t,e){const i=ud(Vs(),t),s=[{name:"waveform",emoji:""},{name:"frequency",emoji:""},{name:"spectrogram",emoji:""}];let a=0;function r(){a=(a+1)%s.length;const{name:n,emoji:o}=s[a];i.setMode(n),e.textContent=o,e.title=`Mode: ${n}`}e.addEventListener("click",r),r()}function hd(){document.getElementById("add-sequencer").addEventListener("click",()=>{const e=R.length;O(ir(e,"sf2/fluidr3-gm/acoustic_grand_piano"),Gi(e))})}function qi(){return typeof window<"u"&&typeof localStorage<"u"}function md(){if(!qi())return;const t=ve();localStorage.setItem("userConfig",JSON.stringify(t))}function pd(){if(!qi())return;const t=localStorage.getItem("userConfig");if(t)try{const e=JSON.parse(t);pt(e)}catch(e){console.error("Failed to parse userConfig from localStorage:",e)}}qi()&&pd();const ss=["gpt-4o","gpt-4o-mini","gpt-4.1","gpt-4.1-mini","o3-mini","o4-mini"];function _i(){return ve().openaiApiKey}function rs(){return ve().openaiModel}function yd(t){pt({openaiApiKey:t})}function _d(t){if(!ss.includes(t))throw new Error(`Invalid model: ${t}. Must be one of: ${ss.join(", ")}`);pt({openaiModel:t})}function gd(){var a;const t=document.getElementById("openai-key-input"),e=document.getElementById("openai-model-select"),i=document.getElementById("config-save"),s=document.querySelectorAll("#config-close, #config-close-bottom");t.value=_i(),e.value=rs(),i.addEventListener("click",()=>{var r;yd(t.value),_d(e.value),md(),(r=document.getElementById("userconfig-modal"))==null||r.classList.add("hidden")}),s.forEach(r=>{r.addEventListener("click",()=>{var n;t.value=_i(),e.value=rs(),(n=document.getElementById("userconfig-modal"))==null||n.classList.add("hidden")})}),(a=document.getElementById("key-not-set-ok"))==null||a.addEventListener("click",()=>{var r;(r=document.getElementById("openai-key-not-set-modal"))==null||r.classList.add("hidden")})}const bd=["Darkroom","Seashell","Cyberpunk","Classic Blue","Midnight"],vd=["Track Color","Note Velocity","Pitch Class Contrast","Scriabin","Octave Bands"];function Sd(){const t=document.getElementById("grid-color-select"),e=document.getElementById("note-color-select");if(!t||!e)return;for(const s of bd){const a=document.createElement("option");a.value=s,a.textContent=s,t.appendChild(a)}for(const s of vd){const a=document.createElement("option");a.value=s,a.textContent=s,e.appendChild(a)}const i=ve();t.value=i.gridColorScheme,e.value=i.noteColorScheme,t.addEventListener("change",s=>{const a=s.target;pt({gridColorScheme:a.value}),re().forEach(r=>{var n;return(n=r.matrix)==null?void 0:n.requestRedraw()})}),e.addEventListener("change",s=>{const a=s.target;pt({noteColorScheme:a.value}),re().forEach(r=>{var n;return(n=r.matrix)==null?void 0:n.requestRedraw()})})}function Nd(){const t=document.getElementById("userconfig-modal"),e=document.querySelectorAll(".settings-tab"),i=document.querySelectorAll(".settings-section");if(!t)return;function s(){e.forEach(a=>{const r=a.dataset.tab;if(!r)return;const n=document.getElementById(r),o=n!==null&&!n.classList.contains("hidden");a.classList.toggle("text-purple-500",o),a.classList.toggle("opacity-100",o),a.classList.toggle("text-gray-500",!o),a.classList.toggle("opacity-50",!o)})}e.forEach(a=>{a.addEventListener("click",()=>{const r=a.dataset.tab;if(!r)return;i.forEach(o=>o.classList.add("hidden"));const n=document.getElementById(r);n&&n.classList.remove("hidden"),s()})}),s(),gd(),Sd()}let as=!1,Ge=!1,Ee=!1;function Cd({getSequencers:t,onPlay:e,onStop:i,onPause:s,onResume:a,onDurationChange:r,onSnapChange:n,onToggleLoop:o,onTempoChange:c,onSave:d,onLoad:l,onMeasuresChange:u,onBeatsPerMeasureChange:h}){if(as)return;as=!0;const f=document.getElementById("play-button"),p=f.querySelector("use"),g=document.getElementById("stop-button"),y=document.getElementById("snap-resolution"),m=document.getElementById("loop-toggle"),_=document.getElementById("tempo-input"),v=document.getElementById("save-button"),b=document.getElementById("load-button"),S=document.getElementById("measures-input"),N=document.getElementById("beats-per-measure-input"),C=document.getElementById("config-button"),M=document.getElementById("export-modal"),E=document.getElementById("export-json"),k=document.getElementById("export-wav"),L=document.getElementById("export-midi"),P=document.getElementById("export-cancel");y.value=String(Y.snapResolution||.25);const A=document.getElementById("import-modal"),U=document.getElementById("import-json"),D=document.getElementById("import-midi"),q=document.getElementById("import-cancel"),F=document.getElementById("load-input");b.addEventListener("click",()=>{A==null||A.classList.remove("hidden")}),F&&F.addEventListener("change",w=>{var ee;const J=w.target,T=(ee=J.files)==null?void 0:ee[0];T&&l(T),J.value=""}),U&&U.addEventListener("click",()=>{A==null||A.classList.add("hidden"),F&&(F.setAttribute("accept",".json"),F.click())}),D&&D.addEventListener("click",()=>{A==null||A.classList.add("hidden"),F&&(F.setAttribute("accept",".mid,.midi"),F.click())}),q&&q.addEventListener("click",()=>{A==null||A.classList.add("hidden")}),p.setAttribute("href","#icon-play"),f.addEventListener("click",()=>{!Ge&&!Ee?(Ge=!0,Ee=!1,e(),p.setAttribute("href","#icon-pause")):Ge?(Ge=!1,Ee=!0,s(),p.setAttribute("href","#icon-play")):Ee&&(Ge=!0,Ee=!1,a(),p.setAttribute("href","#icon-pause"))}),g.addEventListener("click",()=>{i(),Ge=!1,Ee=!1,p.setAttribute("href","#icon-play")}),window.addEventListener("keydown",w=>{var ee;if(document.querySelector(".ai-modal:not(.hidden)"))return;const T=(ee=document.activeElement)==null?void 0:ee.tagName;if(!(T==="INPUT"||T==="TEXTAREA")){if(w.code==="Space"){w.preventDefault(),f.click();return}if((w.metaKey||w.ctrlKey)&&w.key.toLowerCase()==="r"){w.preventDefault();return}if(w.key==="v"&&!w.ctrlKey&&!w.metaKey&&!w.altKey&&!Gr()){const ze=xi();if(!ze||ze.selectedNotes.length===0){Lr("No notes selected. Please select notes before adjusting velocity.");return}w.preventDefault(),Mr(ze.selectedNotes);return}}}),y.addEventListener("change",w=>{const T=w.target.value;Object.prototype.hasOwnProperty.call(Lo,T)&&(Y.snapResolution=parseFloat(T),y.value=String(T),n(Y.snapResolution))}),m.addEventListener("change",w=>{const J=w.target;o(J.checked)}),_.addEventListener("change",w=>{const J=w.target,T=parseInt(J.value,10);J.blur(),isNaN(T)||c(T)}),v.addEventListener("click",()=>{M?M.classList.remove("hidden"):d("json")}),E&&E.addEventListener("click",()=>{M==null||M.classList.add("hidden"),d==null||d("json")}),k&&k.addEventListener("click",()=>{M==null||M.classList.add("hidden"),requestAnimationFrame(()=>{d==null||d("wav")})}),L&&L.addEventListener("click",()=>{M==null||M.classList.add("hidden"),d==null||d("midi")}),P&&P.addEventListener("click",()=>{M==null||M.classList.add("hidden")}),C==null||C.addEventListener("click",()=>{const w=document.getElementById("userconfig-modal");w==null||w.classList.remove("hidden")}),Nd(),S&&(S.value=String(We())),N&&(N.value=String(gt())),S==null||S.addEventListener("change",w=>{const J=w.target,T=parseInt(J.value,10);!isNaN(T)&&T>0&&(u==null||u(T))}),N==null||N.addEventListener("change",w=>{const J=w.target,T=parseInt(J.value,10);!isNaN(T)&&T>0&&(h==null||h(T))})}function Md(){Ge=!1,Ee=!1;const t=document.getElementById("play-button"),e=t==null?void 0:t.querySelector("use");e&&e.setAttribute("href","#icon-play")}function Bd(){var u;const t=document.getElementById("global-mini-expand-btn"),e=document.getElementById("global-mini-contour"),i=document.getElementById("global-mini-playhead"),s=(u=e==null?void 0:e.parentElement)==null?void 0:u.parentElement,a=e==null?void 0:e.parentElement,r=t==null?void 0:t.querySelector("svg use"),n=document.querySelector(".footer-spacer"),o=40;let c=!1;function d(h,f){const p=h.offsetWidth;h.style.height=`${f}px`,h.height=f,h.width=p}if(!t||!e||!i||!s||!a||!r||!n){console.warn("FooterUI: One or more elements not found.");return}s.style.height=`${o}px`,a.style.height=`${o}px`,d(e,o),d(i,o),be(e,re());function l(){c=!c;const h=c?200:40;!s||!a||!e||!i||!r||!n||(s.style.height=`${h}px`,a.style.height=`${h}px`,d(e,h),d(i,h),r.setAttribute("href",c?"#icon-caret-down":"#icon-caret-up"),n.style.height=`${h-40+140}px`,be(e,re()))}t.addEventListener("click",l)}function Ld(t){if(!t.sequencers.length)throw new Error("No tracks to export.");const e=t.tempo,i=t.timeSignature[0],s=t.totalMeasures,a={v:3,t:new Date().toISOString(),c:{b:e,bpm:i,tm:s},i:t.sequencers.map(n=>n.instrument||"sf2/fluidr3-gm/acoustic_grand_piano"),vlm:t.sequencers.map(n=>n.volume??100/127),pan:t.sequencers.map(n=>n.pan??0),tr:t.sequencers.map(n=>({n:n.notes.map(o=>[o.pitch,o.start,o.duration,o.velocity??100])}))},r=new Blob([JSON.stringify(a)],{type:"application/json"});return{url:URL.createObjectURL(r),filename:`session-${Date.now()}.json`}}async function wd(t,e={sampleRate:44100,includePan:!0}){if(!t.tracks||t.tracks.length===0)throw new Error("No tracks to export.");const i=e.sampleRate,s=e.includePan?2:1,a=new AbortController;let r=!1;st("Exporting Session","Rendering your session offline...",()=>{r=!0,a.abort()},!0);try{const o=60/he(),c=Math.max(...t.tracks.flatMap(p=>p.notes.map(g=>(g.start+g.duration)*o+.2))),d=new OfflineAudioContext(s,Math.ceil(i*c),i);for(const p of t.tracks){if(r)return;const g=p.instrument||"sf2/fluidr3-gm/acoustic_grand_piano";if(await new Ut(null,p.config,d,d.destination,g,!0).exportToOffline(a.signal,p.notes),r)return}if(r)return;st("Rendering Audio","Rendering audio buffer",void 0,!0);const l=await d.startRendering();st("Converting to WAV","Converting to WAV format",void 0,!0);const u=Gd(l);st("Downloading WAV","Please wait...",void 0,!0);const h=URL.createObjectURL(u),f=document.createElement("a");f.href=h,f.download=`session-${Date.now()}.wav`,f.click(),URL.revokeObjectURL(h)}catch(n){r?console.warn("Export operation was cancelled by the user."):console.error("Error during export:",n)}finally{Tt(!0)}}function Gd(t){const e=t.numberOfChannels,i=t.length*e*2,s=new DataView(new ArrayBuffer(44+i)),a=(n,o)=>{for(let c=0;c<o.length;c++)s.setUint8(n+c,o.charCodeAt(c))};a(0,"RIFF"),s.setUint32(4,36+i,!0),a(8,"WAVE"),a(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,e,!0),s.setUint32(24,t.sampleRate,!0),s.setUint32(28,t.sampleRate*e*2,!0),s.setUint16(32,e*2,!0),s.setUint16(34,16,!0),a(36,"data"),s.setUint32(40,i,!0);let r=44;for(let n=0;n<t.length;n++)for(let o=0;o<e;o++){const c=t.getChannelData(o)[n],d=Math.max(-1,Math.min(1,c));s.setInt16(r,d*32767,!0),r+=2}return new Blob([s.buffer],{type:"audio/wav"})}function Ed(){document.getElementById("save-wav-options-modal").classList.remove("hidden")}function kr(){document.getElementById("save-wav-options-modal").classList.add("hidden")}async function Id(){var a;const t=parseInt(document.getElementById("save-wav-sample-rate").value,10),e=((a=document.getElementById("save-wav-include-pan"))==null?void 0:a.checked)??!0;kr();const i=Ke(),s={globalConfig:{bpm:i.tempo,beatsPerMeasure:i.timeSignature[0],totalMeasures:i.totalMeasures},tracks:R.map(r=>({notes:r.notes,instrument:r.instrumentName,config:r.config,volume:r.volume,pan:r.pan}))};try{await wd(s,{sampleRate:t,includePan:e})}catch(r){console.error("[SaveWav] Export failed:",r)}}function kd(){kr()}function Ad(){const t=document.getElementById("save-wav-options-apply-btn"),e=document.getElementById("save-wav-options-cancel-btn");t&&t.addEventListener("click",Id),e&&e.addEventListener("click",kd)}function Fd(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var i=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var a=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(i,s,a.get?a:{enumerable:!0,get:function(){return t[s]}})}),i}var Se={},wt={},ri,ns;function Pd(){if(ns)return ri;ns=1;function t(a){var r=new s(a),n=r.readChunk();if(n.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var o=e(n.data),c=[],d=0;!r.eof()&&d<o.numTracks;d++){var l=r.readChunk();if(l.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var u=i(l.data);c.push(u)}return{header:o,tracks:c}}function e(a){var r=new s(a),n=r.readUInt16(),o=r.readUInt16(),c={format:n,numTracks:o},d=r.readUInt16();return d&32768?(c.framesPerSecond=256-(d>>8),c.ticksPerFrame=d&255):c.ticksPerBeat=d,c}function i(a){for(var r=new s(a),n=[];!r.eof();){var o=d();n.push(o)}return n;var c;function d(){var l={};l.deltaTime=r.readVarInt();var u=r.readUInt8();if((u&240)===240)if(u===255){l.meta=!0;var h=r.readUInt8(),f=r.readVarInt();switch(h){case 0:if(l.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return l.number=r.readUInt16(),l;case 1:return l.type="text",l.text=r.readString(f),l;case 2:return l.type="copyrightNotice",l.text=r.readString(f),l;case 3:return l.type="trackName",l.text=r.readString(f),l;case 4:return l.type="instrumentName",l.text=r.readString(f),l;case 5:return l.type="lyrics",l.text=r.readString(f),l;case 6:return l.type="marker",l.text=r.readString(f),l;case 7:return l.type="cuePoint",l.text=r.readString(f),l;case 32:if(l.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return l.channel=r.readUInt8(),l;case 33:if(l.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return l.port=r.readUInt8(),l;case 47:if(l.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return l;case 81:if(l.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return l.microsecondsPerBeat=r.readUInt24(),l;case 84:if(l.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var p=r.readUInt8(),g={0:24,32:25,64:29,96:30};return l.frameRate=g[p&96],l.hour=p&31,l.min=r.readUInt8(),l.sec=r.readUInt8(),l.frame=r.readUInt8(),l.subFrame=r.readUInt8(),l;case 88:if(l.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return l.numerator=r.readUInt8(),l.denominator=1<<r.readUInt8(),f===4?(l.metronome=r.readUInt8(),l.thirtyseconds=r.readUInt8()):(l.metronome=36,l.thirtyseconds=8),l;case 89:if(l.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return l.key=r.readInt8(),l.scale=r.readUInt8(),l;case 127:return l.type="sequencerSpecific",l.data=r.readBytes(f),l;default:return l.type="unknownMeta",l.data=r.readBytes(f),l.metatypeByte=h,l}}else if(u==240){l.type="sysEx";var f=r.readVarInt();return l.data=r.readBytes(f),l}else if(u==247){l.type="endSysEx";var f=r.readVarInt();return l.data=r.readBytes(f),l}else throw"Unrecognised MIDI event type byte: "+u;else{var y;if((u&128)===0){if(c===null)throw"Running status byte encountered before status byte";y=u,u=c,l.running=!0}else y=r.readUInt8(),c=u;var m=u>>4;switch(l.channel=u&15,m){case 8:return l.type="noteOff",l.noteNumber=y,l.velocity=r.readUInt8(),l;case 9:var _=r.readUInt8();return l.type=_===0?"noteOff":"noteOn",l.noteNumber=y,l.velocity=_,_===0&&(l.byte9=!0),l;case 10:return l.type="noteAftertouch",l.noteNumber=y,l.amount=r.readUInt8(),l;case 11:return l.type="controller",l.controllerType=y,l.value=r.readUInt8(),l;case 12:return l.type="programChange",l.programNumber=y,l;case 13:return l.type="channelAftertouch",l.amount=y,l;case 14:return l.type="pitchBend",l.value=y+(r.readUInt8()<<7)-8192,l;default:throw"Unrecognised MIDI event type: "+m}}}}function s(a){this.buffer=a,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var a=this.buffer[this.pos];return this.pos+=1,a},s.prototype.readInt8=function(){var a=this.readUInt8();return a&128?a-256:a},s.prototype.readUInt16=function(){var a=this.readUInt8(),r=this.readUInt8();return(a<<8)+r},s.prototype.readInt16=function(){var a=this.readUInt16();return a&32768?a-65536:a},s.prototype.readUInt24=function(){var a=this.readUInt8(),r=this.readUInt8(),n=this.readUInt8();return(a<<16)+(r<<8)+n},s.prototype.readInt24=function(){var a=this.readUInt24();return a&8388608?a-16777216:a},s.prototype.readUInt32=function(){var a=this.readUInt8(),r=this.readUInt8(),n=this.readUInt8(),o=this.readUInt8();return(a<<24)+(r<<16)+(n<<8)+o},s.prototype.readBytes=function(a){var r=this.buffer.slice(this.pos,this.pos+a);return this.pos+=a,r},s.prototype.readString=function(a){var r=this.readBytes(a);return String.fromCharCode.apply(null,r)},s.prototype.readVarInt=function(){for(var a=0;!this.eof();){var r=this.readUInt8();if(r&128)a+=r&127,a<<=7;else return a+r}return a},s.prototype.readChunk=function(){var a=this.readString(4),r=this.readUInt32(),n=this.readBytes(r);return{id:a,length:r,data:n}},ri=t,ri}var ai,os;function Td(){if(os)return ai;os=1;function t(r,n){if(typeof r!="object")throw"Invalid MIDI data";n=n||{};var o=r.header||{},c=r.tracks||[],d,l=c.length,u=new a;for(e(u,o,l),d=0;d<l;d++)i(u,c[d],n);return u.buffer}function e(r,n,o){var c=n.format==null?1:n.format,d=128;n.timeDivision?d=n.timeDivision:n.ticksPerFrame&&n.framesPerSecond?d=-(n.framesPerSecond&255)<<8|n.ticksPerFrame&255:n.ticksPerBeat&&(d=n.ticksPerBeat&32767);var l=new a;l.writeUInt16(c),l.writeUInt16(o),l.writeUInt16(d),r.writeChunk("MThd",l.buffer)}function i(r,n,o){var c=new a,d,l=n.length,u=null;for(d=0;d<l;d++)(o.running===!1||!o.running&&!n[d].running)&&(u=null),u=s(c,n[d],u,o.useByte9ForNoteOff);r.writeChunk("MTrk",c.buffer)}function s(r,n,o,c){var d=n.type,l=n.deltaTime,u=n.text||"",h=n.data||[],f=null;switch(r.writeVarInt(l),d){case"sequenceNumber":r.writeUInt8(255),r.writeUInt8(0),r.writeVarInt(2),r.writeUInt16(n.number);break;case"text":r.writeUInt8(255),r.writeUInt8(1),r.writeVarInt(u.length),r.writeString(u);break;case"copyrightNotice":r.writeUInt8(255),r.writeUInt8(2),r.writeVarInt(u.length),r.writeString(u);break;case"trackName":r.writeUInt8(255),r.writeUInt8(3),r.writeVarInt(u.length),r.writeString(u);break;case"instrumentName":r.writeUInt8(255),r.writeUInt8(4),r.writeVarInt(u.length),r.writeString(u);break;case"lyrics":r.writeUInt8(255),r.writeUInt8(5),r.writeVarInt(u.length),r.writeString(u);break;case"marker":r.writeUInt8(255),r.writeUInt8(6),r.writeVarInt(u.length),r.writeString(u);break;case"cuePoint":r.writeUInt8(255),r.writeUInt8(7),r.writeVarInt(u.length),r.writeString(u);break;case"channelPrefix":r.writeUInt8(255),r.writeUInt8(32),r.writeVarInt(1),r.writeUInt8(n.channel);break;case"portPrefix":r.writeUInt8(255),r.writeUInt8(33),r.writeVarInt(1),r.writeUInt8(n.port);break;case"endOfTrack":r.writeUInt8(255),r.writeUInt8(47),r.writeVarInt(0);break;case"setTempo":r.writeUInt8(255),r.writeUInt8(81),r.writeVarInt(3),r.writeUInt24(n.microsecondsPerBeat);break;case"smpteOffset":r.writeUInt8(255),r.writeUInt8(84),r.writeVarInt(5);var p={24:0,25:32,29:64,30:96},g=n.hour&31|p[n.frameRate];r.writeUInt8(g),r.writeUInt8(n.min),r.writeUInt8(n.sec),r.writeUInt8(n.frame),r.writeUInt8(n.subFrame);break;case"timeSignature":r.writeUInt8(255),r.writeUInt8(88),r.writeVarInt(4),r.writeUInt8(n.numerator);var y=Math.floor(Math.log(n.denominator)/Math.LN2)&255;r.writeUInt8(y),r.writeUInt8(n.metronome),r.writeUInt8(n.thirtyseconds||8);break;case"keySignature":r.writeUInt8(255),r.writeUInt8(89),r.writeVarInt(2),r.writeInt8(n.key),r.writeUInt8(n.scale);break;case"sequencerSpecific":r.writeUInt8(255),r.writeUInt8(127),r.writeVarInt(h.length),r.writeBytes(h);break;case"unknownMeta":n.metatypeByte!=null&&(r.writeUInt8(255),r.writeUInt8(n.metatypeByte),r.writeVarInt(h.length),r.writeBytes(h));break;case"sysEx":r.writeUInt8(240),r.writeVarInt(h.length),r.writeBytes(h);break;case"endSysEx":r.writeUInt8(247),r.writeVarInt(h.length),r.writeBytes(h);break;case"noteOff":var m=c!==!1&&n.byte9||c&&n.velocity==0?144:128;f=m|n.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(n.noteNumber),r.writeUInt8(n.velocity);break;case"noteOn":f=144|n.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(n.noteNumber),r.writeUInt8(n.velocity);break;case"noteAftertouch":f=160|n.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(n.noteNumber),r.writeUInt8(n.amount);break;case"controller":f=176|n.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(n.controllerType),r.writeUInt8(n.value);break;case"programChange":f=192|n.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(n.programNumber);break;case"channelAftertouch":f=208|n.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(n.amount);break;case"pitchBend":f=224|n.channel,f!==o&&r.writeUInt8(f);var _=8192+n.value,v=_&127,b=_>>7&127;r.writeUInt8(v),r.writeUInt8(b);break;default:throw"Unrecognized event type: "+d}return f}function a(){this.buffer=[]}return a.prototype.writeUInt8=function(r){this.buffer.push(r&255)},a.prototype.writeInt8=a.prototype.writeUInt8,a.prototype.writeUInt16=function(r){var n=r>>8&255,o=r&255;this.writeUInt8(n),this.writeUInt8(o)},a.prototype.writeInt16=a.prototype.writeUInt16,a.prototype.writeUInt24=function(r){var n=r>>16&255,o=r>>8&255,c=r&255;this.writeUInt8(n),this.writeUInt8(o),this.writeUInt8(c)},a.prototype.writeInt24=a.prototype.writeUInt24,a.prototype.writeUInt32=function(r){var n=r>>24&255,o=r>>16&255,c=r>>8&255,d=r&255;this.writeUInt8(n),this.writeUInt8(o),this.writeUInt8(c),this.writeUInt8(d)},a.prototype.writeInt32=a.prototype.writeUInt32,a.prototype.writeBytes=function(r){this.buffer=this.buffer.concat(Array.prototype.slice.call(r,0))},a.prototype.writeString=function(r){var n,o=r.length,c=[];for(n=0;n<o;n++)c.push(r.codePointAt(n));this.writeBytes(c)},a.prototype.writeVarInt=function(r){if(r<0)throw"Cannot write negative variable-length integer";if(r<=127)this.writeUInt8(r);else{var n=r,o=[];for(o.push(n&127),n>>=7;n;){var c=n&127|128;o.push(c),n>>=7}this.writeBytes(o.reverse())}},a.prototype.writeChunk=function(r,n){this.writeString(r),this.writeUInt32(n.length),this.writeBytes(n)},ai=t,ai}var ls;function Ar(){return ls||(ls=1,wt.parseMidi=Pd(),wt.writeMidi=Td()),wt}var ni={},Ne={},ds;function Fr(){if(ds)return Ne;ds=1,Object.defineProperty(Ne,"__esModule",{value:!0}),Ne.insert=Ne.search=void 0;function t(i,s,a){a===void 0&&(a="ticks");var r=0,n=i.length,o=n;if(n>0&&i[n-1][a]<=s)return n-1;for(;r<o;){var c=Math.floor(r+(o-r)/2),d=i[c],l=i[c+1];if(d[a]===s){for(var u=c;u<i.length;u++){var h=i[u];h[a]===s&&(c=u)}return c}else{if(d[a]<s&&l[a]>s)return c;d[a]>s?o=c:d[a]<s&&(r=c+1)}}return-1}Ne.search=t;function e(i,s,a){if(a===void 0&&(a="ticks"),i.length){var r=t(i,s[a],a);i.splice(r+1,0,s)}else i.push(s)}return Ne.insert=e,Ne}var cs;function gi(){return cs||(cs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Fr(),i=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function a(r){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),r){i.set(this,r.header.ticksPerBeat),r.tracks.forEach(function(c){c.forEach(function(d){d.meta&&(d.type==="timeSignature"?n.timeSignatures.push({ticks:d.absoluteTime,timeSignature:[d.numerator,d.denominator]}):d.type==="setTempo"?n.tempos.push({bpm:6e7/d.microsecondsPerBeat,ticks:d.absoluteTime}):d.type==="keySignature"&&n.keySignatures.push({key:t.keySignatureKeys[d.key+7],scale:d.scale===0?"major":"minor",ticks:d.absoluteTime}))})});var o=0;r.tracks[0].forEach(function(c){o+=c.deltaTime,c.meta&&(c.type==="trackName"?n.name=c.text:(c.type==="text"||c.type==="cuePoint"||c.type==="marker"||c.type==="lyrics")&&n.meta.push({text:c.text,ticks:o,type:c.type}))}),this.update()}}return a.prototype.update=function(){var r=this,n=0,o=0;this.tempos.sort(function(c,d){return c.ticks-d.ticks}),this.tempos.forEach(function(c,d){var l=d>0?r.tempos[d-1].bpm:r.tempos[0].bpm,u=c.ticks/r.ppq-o,h=60/l*u;c.time=h+n,n=c.time,o+=u}),this.timeSignatures.sort(function(c,d){return c.ticks-d.ticks}),this.timeSignatures.forEach(function(c,d){var l=d>0?r.timeSignatures[d-1]:r.timeSignatures[0],u=(c.ticks-l.ticks)/r.ppq,h=u/l.timeSignature[0]/(l.timeSignature[1]/4);l.measures=l.measures||0,c.measures=h+l.measures})},a.prototype.ticksToSeconds=function(r){var n=(0,e.search)(this.tempos,r);if(n!==-1){var o=this.tempos[n],c=o.time,d=(r-o.ticks)/this.ppq;return c+60/o.bpm*d}else{var l=r/this.ppq;return 60/120*l}},a.prototype.ticksToMeasures=function(r){var n=(0,e.search)(this.timeSignatures,r);if(n!==-1){var o=this.timeSignatures[n],c=(r-o.ticks)/this.ppq;return o.measures+c/(o.timeSignature[0]/o.timeSignature[1])/4}else return r/this.ppq/4},Object.defineProperty(a.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),a.prototype.secondsToTicks=function(r){var n=(0,e.search)(this.tempos,r,"time");if(n!==-1){var o=this.tempos[n],c=o.time,d=r-c,l=d/(60/o.bpm);return Math.round(o.ticks+l*this.ppq)}else{var u=r/.5;return Math.round(u*this.ppq)}},a.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(r){return{bpm:r.bpm,ticks:r.ticks}}),timeSignatures:this.timeSignatures}},a.prototype.fromJSON=function(r){this.name=r.name,this.tempos=r.tempos.map(function(n){return Object.assign({},n)}),this.timeSignatures=r.timeSignatures.map(function(n){return Object.assign({},n)}),this.keySignatures=r.keySignatures.map(function(n){return Object.assign({},n)}),this.meta=r.meta.map(function(n){return Object.assign({},n)}),i.set(this,r.ppq),this.update()},a.prototype.setTempo=function(r){this.tempos=[{bpm:r,ticks:0}],this.update()},a}();t.Header=s}(ni)),ni}var Xe={},oi={},us;function Pr(){return us||(us=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(a,r){return a[t.controlChangeNames[r]]=r,a},{});var e=new WeakMap,i=new WeakMap,s=function(){function a(r,n){e.set(this,n),i.set(this,r.controllerType),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(a.prototype,"number",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var r=e.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var n=e.get(this);this.ticks=n.secondsToTicks(r)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},a}();t.ControlChange=s}(oi)),oi}var Ve={},fs;function Rd(){if(fs)return Ve;fs=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.createControlChanges=void 0;var t=Pr();function e(){return new Proxy({},{get:function(i,s){if(i[s])return i[s];if(t.controlChangeIds.hasOwnProperty(s))return i[t.controlChangeIds[s]]},set:function(i,s,a){return t.controlChangeIds.hasOwnProperty(s)?i[t.controlChangeIds[s]]=a:i[s]=a,!0}})}return Ve.createControlChanges=e,Ve}var je={},hs;function Od(){if(hs)return je;hs=1,Object.defineProperty(je,"__esModule",{value:!0}),je.PitchBend=void 0;var t=new WeakMap,e=function(){function i(s,a){t.set(this,a),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(i.prototype,"time",{get:function(){var s=t.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var a=t.get(this);this.ticks=a.secondsToTicks(s)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},i}();return je.PitchBend=e,je}var Ye={},ne={},ms;function xd(){return ms||(ms=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.DrumKitByPatchID=ne.InstrumentFamilyByID=ne.instrumentByPatchID=void 0,ne.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],ne.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],ne.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),ne}var ps;function Ud(){if(ps)return Ye;ps=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.Instrument=void 0;var t=xd(),e=new WeakMap,i=function(){function s(a,r){if(this.number=0,e.set(this,r),this.number=0,a){var n=a.find(function(o){return o.type==="programChange"});n&&(this.number=n.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?t.DrumKitByPatchID[this.number]:t.instrumentByPatchID[this.number]},set:function(a){var r=t.instrumentByPatchID.indexOf(a);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":t.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var a=e.get(this);return a.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(a){this.number=a.number},s}();return Ye.Instrument=i,Ye}var Ze={},ys;function Dd(){if(ys)return Ze;ys=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.Note=void 0;function t(n){var o=Math.floor(n/12)-1;return e(n)+o.toString()}function e(n){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],c=n%12;return o[c]}function i(n){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(n)}var s=function(){var n=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(c){var d=n.exec(c),l=d[1],u=d[2],h=o[l.toLowerCase()];return h+(parseInt(u,10)+1)*12}}(),a=new WeakMap,r=function(){function n(o,c,d){a.set(this,d),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=c.velocity,this.ticks=o.ticks,this.durationTicks=c.ticks-o.ticks}return Object.defineProperty(n.prototype,"name",{get:function(){return t(this.midi)},set:function(o){this.midi=s(o)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var c=o-this.octave;this.midi+=c*12},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"pitch",{get:function(){return e(this.midi)},set:function(o){this.midi=12*(this.octave+1)+i(o)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"duration",{get:function(){var o=a.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var c=a.get(this),d=c.secondsToTicks(this.time+o);this.durationTicks=d-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var o=a.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var c=a.get(this);this.ticks=c.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bars",{get:function(){var o=a.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},n}();return Ze.Note=r,Ze}var _s;function gs(){if(_s)return Xe;_s=1,Object.defineProperty(Xe,"__esModule",{value:!0}),Xe.Track=void 0;var t=Fr(),e=Pr(),i=Rd(),s=Od(),a=Ud(),r=Dd(),n=new WeakMap,o=function(){function c(d,l){var u=this;if(this.name="",this.notes=[],this.controlChanges=(0,i.createControlChanges)(),this.pitchBends=[],n.set(this,l),d){var h=d.find(function(b){return b.type==="trackName"});this.name=h?h.text:""}if(this.instrument=new a.Instrument(d,this),this.channel=0,d){for(var f=d.filter(function(b){return b.type==="noteOn"}),p=d.filter(function(b){return b.type==="noteOff"}),g=function(){var b=f.shift();y.channel=b.channel;var S=p.findIndex(function(C){return C.noteNumber===b.noteNumber&&C.absoluteTime>=b.absoluteTime});if(S!==-1){var N=p.splice(S,1)[0];y.addNote({durationTicks:N.absoluteTime-b.absoluteTime,midi:b.noteNumber,noteOffVelocity:N.velocity/127,ticks:b.absoluteTime,velocity:b.velocity/127})}},y=this;f.length;)g();var m=d.filter(function(b){return b.type==="controller"});m.forEach(function(b){u.addCC({number:b.controllerType,ticks:b.absoluteTime,value:b.value/127})});var _=d.filter(function(b){return b.type==="pitchBend"});_.forEach(function(b){u.addPitchBend({ticks:b.absoluteTime,value:b.value/Math.pow(2,13)})});var v=d.find(function(b){return b.type==="endOfTrack"});this.endOfTrackTicks=v!==void 0?v.absoluteTime:void 0}}return c.prototype.addNote=function(d){var l=n.get(this),u=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},l);return Object.assign(u,d),(0,t.insert)(this.notes,u,"ticks"),this},c.prototype.addCC=function(d){var l=n.get(this),u=new e.ControlChange({controllerType:d.number},l);return delete d.number,Object.assign(u,d),Array.isArray(this.controlChanges[u.number])||(this.controlChanges[u.number]=[]),(0,t.insert)(this.controlChanges[u.number],u,"ticks"),this},c.prototype.addPitchBend=function(d){var l=n.get(this),u=new s.PitchBend({},l);return Object.assign(u,d),(0,t.insert)(this.pitchBends,u,"ticks"),this},Object.defineProperty(c.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,l=0;l<this.notes.length-1;l++){var u=this.notes[l].time+this.notes[l].duration;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,l=0;l<this.notes.length-1;l++){var u=this.notes[l].ticks+this.notes[l].durationTicks;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),c.prototype.fromJSON=function(d){var l=this;this.name=d.name,this.channel=d.channel,this.instrument=new a.Instrument(void 0,this),this.instrument.fromJSON(d.instrument),d.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=d.endOfTrackTicks);for(var u in d.controlChanges)d.controlChanges[u]&&d.controlChanges[u].forEach(function(h){l.addCC({number:h.number,ticks:h.ticks,value:h.value})});d.notes.forEach(function(h){l.addNote({durationTicks:h.durationTicks,midi:h.midi,ticks:h.ticks,velocity:h.velocity})})},c.prototype.toJSON=function(){for(var d={},l=0;l<127;l++)this.controlChanges.hasOwnProperty(l)&&(d[l]=this.controlChanges[l].map(function(h){return h.toJSON()}));var u={channel:this.channel,controlChanges:d,pitchBends:this.pitchBends.map(function(h){return h.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(h){return h.toJSON()})};return this.endOfTrackTicks!==void 0&&(u.endOfTrackTicks=this.endOfTrackTicks),u},c}();return Xe.Track=o,Xe}var Ce={};function qd(t){var e=[];return Tr(t,e),e}function Tr(t,e){for(var i=0;i<t.length;i++){var s=t[i];Array.isArray(s)?Tr(s,e):e.push(s)}}const Jd=Object.freeze(Object.defineProperty({__proto__:null,flatten:qd},Symbol.toStringTag,{value:"Module"})),Hd=Fd(Jd);var bs;function $d(){if(bs)return Ce;bs=1;var t=Ce&&Ce.__spreadArray||function(m,_,v){if(v||arguments.length===2)for(var b=0,S=_.length,N;b<S;b++)(N||!(b in _))&&(N||(N=Array.prototype.slice.call(_,0,b)),N[b]=_[b]);return m.concat(N||Array.prototype.slice.call(_))};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.encode=void 0;var e=Ar(),i=gi(),s=Hd;function a(m,_){return[{absoluteTime:m.ticks,channel:_,deltaTime:0,noteNumber:m.midi,type:"noteOn",velocity:Math.floor(m.velocity*127)},{absoluteTime:m.ticks+m.durationTicks,channel:_,deltaTime:0,noteNumber:m.midi,type:"noteOff",velocity:Math.floor(m.noteOffVelocity*127)}]}function r(m){return(0,s.flatten)(m.notes.map(function(_){return a(_,m.channel)}))}function n(m,_){return{absoluteTime:m.ticks,channel:_,controllerType:m.number,deltaTime:0,type:"controller",value:Math.floor(m.value*127)}}function o(m){for(var _=[],v=0;v<127;v++)m.controlChanges.hasOwnProperty(v)&&m.controlChanges[v].forEach(function(b){_.push(n(b,m.channel))});return _}function c(m,_){return{absoluteTime:m.ticks,channel:_,deltaTime:0,type:"pitchBend",value:m.value}}function d(m){var _=[];return m.pitchBends.forEach(function(v){_.push(c(v,m.channel))}),_}function l(m){return{absoluteTime:0,channel:m.channel,deltaTime:0,programNumber:m.instrument.number,type:"programChange"}}function u(m){return{absoluteTime:0,deltaTime:0,meta:!0,text:m,type:"trackName"}}function h(m){return{absoluteTime:m.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/m.bpm),type:"setTempo"}}function f(m){return{absoluteTime:m.ticks,deltaTime:0,denominator:m.timeSignature[1],meta:!0,metronome:24,numerator:m.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function p(m){var _=i.keySignatureKeys.indexOf(m.key);return{absoluteTime:m.ticks,deltaTime:0,key:_+7,meta:!0,scale:m.scale==="major"?0:1,type:"keySignature"}}function g(m){return{absoluteTime:m.ticks,deltaTime:0,meta:!0,text:m.text,type:m.type}}function y(m){var _={header:{format:1,numTracks:m.tracks.length+1,ticksPerBeat:m.header.ppq},tracks:t([t(t(t(t([{absoluteTime:0,deltaTime:0,meta:!0,text:m.header.name,type:"trackName"}],m.header.keySignatures.map(function(v){return p(v)}),!0),m.header.meta.map(function(v){return g(v)}),!0),m.header.tempos.map(function(v){return h(v)}),!0),m.header.timeSignatures.map(function(v){return f(v)}),!0)],m.tracks.map(function(v){return t(t(t([u(v.name),l(v)],r(v),!0),o(v),!0),d(v),!0)}),!0)};return _.tracks=_.tracks.map(function(v){v=v.sort(function(S,N){return S.absoluteTime-N.absoluteTime});var b=0;return v.forEach(function(S){S.deltaTime=S.absoluteTime-b,b=S.absoluteTime,delete S.absoluteTime}),v.push({deltaTime:0,meta:!0,type:"endOfTrack"}),v}),new Uint8Array((0,e.writeMidi)(_))}return Ce.encode=y,Ce}var vs;function Kd(){return vs||(vs=1,function(t){var e=Se&&Se.__awaiter||function(u,h,f,p){function g(y){return y instanceof f?y:new f(function(m){m(y)})}return new(f||(f=Promise))(function(y,m){function _(S){try{b(p.next(S))}catch(N){m(N)}}function v(S){try{b(p.throw(S))}catch(N){m(N)}}function b(S){S.done?y(S.value):g(S.value).then(_,v)}b((p=p.apply(u,h||[])).next())})},i=Se&&Se.__generator||function(u,h){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},p,g,y,m;return m={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function _(b){return function(S){return v([b,S])}}function v(b){if(p)throw new TypeError("Generator is already executing.");for(;f;)try{if(p=1,g&&(y=b[0]&2?g.return:b[0]?g.throw||((y=g.return)&&y.call(g),0):g.next)&&!(y=y.call(g,b[1])).done)return y;switch(g=0,y&&(b=[b[0]&2,y.value]),b[0]){case 0:case 1:y=b;break;case 4:return f.label++,{value:b[1],done:!1};case 5:f.label++,g=b[1],b=[0];continue;case 7:b=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(b[0]===6||b[0]===2)){f=0;continue}if(b[0]===3&&(!y||b[1]>y[0]&&b[1]<y[3])){f.label=b[1];break}if(b[0]===6&&f.label<y[1]){f.label=y[1],y=b;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(b);break}y[2]&&f.ops.pop(),f.trys.pop();continue}b=h.call(u,f)}catch(S){b=[6,S],g=0}finally{p=y=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var s=Ar(),a=gi(),r=gs(),n=$d(),o=function(){function u(h){var f=this,p=null;if(h){var g=h instanceof ArrayBuffer?new Uint8Array(h):h;p=(0,s.parseMidi)(g),p.tracks.forEach(function(y){var m=0;y.forEach(function(_){m+=_.deltaTime,_.absoluteTime=m})}),p.tracks=l(p.tracks)}this.header=new a.Header(p),this.tracks=[],h&&(this.tracks=p.tracks.map(function(y){return new r.Track(y,f.header)}),p.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return u.fromUrl=function(h){return e(this,void 0,void 0,function(){var f,p;return i(this,function(g){switch(g.label){case 0:return[4,fetch(h)];case 1:return f=g.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return p=g.sent(),[2,new u(p)];case 3:throw new Error("Could not load '".concat(h,"'"))}})})},Object.defineProperty(u.prototype,"name",{get:function(){return this.header.name},set:function(h){this.header.name=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var h=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){var h=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),u.prototype.addTrack=function(){var h=new r.Track(void 0,this.header);return this.tracks.push(h),h},u.prototype.toArray=function(){return(0,n.encode)(this)},u.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(h){return h.toJSON()})}},u.prototype.fromJSON=function(h){var f=this;this.header=new a.Header,this.header.fromJSON(h.header),this.tracks=h.tracks.map(function(p){var g=new r.Track(void 0,f.header);return g.fromJSON(p),g})},u.prototype.clone=function(){var h=new u;return h.fromJSON(this.toJSON()),h},u}();t.Midi=o;var c=gs();Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return c.Track}});var d=gi();Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return d.Header}});function l(u){for(var h=[],f=0;f<u.length;f++)for(var p=h.length,g=new Map,y=Array(16).fill(0),m=0,_=u[f];m<_.length;m++){var v=_[m],b=p,S=v.channel;if(S!==void 0){v.type==="programChange"&&(y[S]=v.programNumber);var N=y[S],C="".concat(N," ").concat(S);g.has(C)?b=g.get(C):(b=p+g.size,g.set(C,b))}h[b]||h.push([]),h[b].push(v)}return h}}(Se)),Se}var Rr=Kd();const Or=["acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honkytonk_piano","electric_piano_1","electric_piano_2","harpsichord","clavinet","celesta","glockenspiel","music_box","vibraphone","marimba","xylophone","tubular_bells","dulcimer","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","guitar_harmonics","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass","slap_bass_1","slap_bass_2","synth_bass_1","synth_bass_2","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synth_strings_1","synth_strings_2","choir_aahs","voice_oohs","synth_choir","orchestra_hit","trumpet","trombone","tuba","muted_trumpet","french_horn","brass_section","synth_brass_1","synth_brass_2","soprano_sax","alto_sax","tenor_sax","baritone_sax","oboe","english_horn","bassoon","clarinet","piccolo","flute","recorder","pan_flute","blown_bottle","shakuhachi","whistle","ocarina","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","sitar","banjo","shamisen","koto","kalimba","bagpipe","fiddle","shanai","tinkle_bell","agogo","steel_drums","woodblock","taiko_drum","melodic_tom","synth_drum","reverse_cymbal","guitar_fret_noise","breath_noise","seashore","bird_tweet","telephone_ring","helicopter","applause","gunshot"];function Wd(t){const e=t.split("/"),s=e[e.length-1].trim().toLowerCase().replace(/\s+/g,"_"),a=Or.findIndex(r=>r===s);return a!==-1?a:(s.includes("drum")||s.includes("drummachine"),0)}async function zd(t){if(!t.sequencers.length)throw new Error("No tracks to export.");const e=new Rr.Midi;e.header.setTempo(t.tempo),e.header.timeSignatures.push({ticks:0,timeSignature:t.timeSignature});for(const[a,r]of t.sequencers.entries()){const n=e.addTrack(),o=r.instrument.toLowerCase().includes("drum");n.channel=o?9:a%16;const c=Wd(r.instrument);if(n.instrument.number=c,typeof r.volume=="number"&&n.addCC({number:7,time:0,value:Math.max(0,Math.min(1,r.volume))}),typeof r.pan=="number"){const d=(r.pan+1)/2;n.addCC({number:10,time:0,value:Math.max(0,Math.min(1,d))})}for(const d of r.notes){const l=K(d.pitch),u=Math.max(.01,Math.min(1,(d.velocity??100)/127));if(l===null)continue;const h=Ss(d.start,t.tempo),f=Ss(d.duration,t.tempo);n.addNote({midi:l,time:h,duration:f,velocity:u})}}const i=new Blob([e.toArray()],{type:"audio/midi"});return{url:URL.createObjectURL(i),filename:`session-${Date.now()}.mid`}}function Ss(t,e){return 60/e*t}async function Xd(t){var c,d,l;const e=await t.text();let i;try{i=JSON.parse(e)}catch{throw new Error("Invalid JSON format.")}if(!Array.isArray(i.tr))throw new Error("Missing or invalid `tr` (tracks) array.");const s={bpm:((c=i.c)==null?void 0:c.b)??120,beatsPerMeasure:((d=i.c)==null?void 0:d.bpm)??4,totalMeasures:((l=i.c)==null?void 0:l.tm)??8},a=Array.isArray(i.i)?i.i:[],r=Array.isArray(i.vlm)?i.vlm:[],n=Array.isArray(i.pan)?i.pan:[],o=i.tr.map((u,h)=>{if(!Array.isArray(u.n))throw new Error(`Track ${h} missing \`n\` (notes) array.`);const f=u.n.map(([m,_,v,b])=>({pitch:m,start:_,duration:v,velocity:b??100})),p=a[h]||"sf2/fluidr3-gm/acoustic_grand_piano",g=r[h],y=n[h];return{notes:f,instrument:p,volume:typeof g=="number"?g:void 0,pan:typeof y=="number"?y:void 0,config:{}}});return{globalConfig:s,tracks:o}}async function Vd(t){var f;const e=await t.arrayBuffer(),i=new Rr.Midi(e),s=i.header.tempos[0],a=i.header.timeSignatures[0],r=(s==null?void 0:s.bpm)??120,n=((f=a==null?void 0:a.timeSignature)==null?void 0:f[0])??4,c=Math.max(0,...i.tracks.flatMap(p=>p.notes.map(g=>g.time+g.duration)))*(r/60),d=Math.ceil(c/n)||8,l={bpm:r,beatsPerMeasure:n,totalMeasures:d},u=await an(),h=i.tracks.map(p=>{const g=p.notes.map(N=>({pitch:N.name,start:N.time*(r/60),duration:N.duration*(r/60),velocity:Math.max(1,Math.min(127,Math.round(N.velocity*127)))}));let y=p.instrument.number;(y===void 0||y===0)&&(y=p.channel===9?0:p.channel%128);const m=p.controlChanges[7]||[],_=p.controlChanges[10]||[],v=m.length>0?m[0].value:void 0,b=_.length>0?_[0].value*2-1:void 0;let S;if(p.channel===9){const N=yn(y);N?S=`webaudiofont/${N.library}/${N.displayName}`:S=`sf2/drummachines/${u.includes("LM-2")?"LM-2":u[0]??"TR-808"}`}else S=`sf2/fluidr3-gm/${Or[y]||"acoustic_grand_piano"}`;return{notes:g,instrument:S,volume:v,pan:b,config:{}}});return{globalConfig:l,tracks:h}}function jd(){for(const t of R){const e=t.container;if(!e)continue;const i=e.querySelector(".sequencer-body"),s=e.querySelector("canvas.mini-contour"),a=e.querySelector(".collapse-btn use");!i||!s||i.classList.contains("hidden")||requestAnimationFrame(()=>{i.classList.add("hidden"),s.classList.remove("hidden"),a==null||a.setAttribute("href","#icon-caret-up"),t.setCollapsed(!0),mt(s,t.notes,t.config,t.colorIndex)})}}let de=null,qt=null;function Yd(t){qt=t,de=qt.getContext("2d")}function Yt(t){if(!de||!qt)return;const{width:e,height:i}=qt;de.clearRect(0,0,e,i);const s=Math.round(t)+.5;de.strokeStyle="#ff00ff",de.lineWidth=1,de.beginPath(),de.moveTo(s,0),de.lineTo(s,i),de.stroke()}function Ns(t,e){I.isActive()&&I.pause(),ki(e.bpm),Ai(e.beatsPerMeasure),Fi(e.totalMeasures);const i=document.getElementById("tempo-input");i&&(i.value=String(he()));const s=document.getElementById("measures-input");s&&(s.value=String(We())),ql();for(const[r,n]of t.entries()){const o=r,c=n.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",d=n.notes||[],l=n.volume,u=n.pan;O({type:"CREATE_SEQUENCER",id:o,instrument:c,notes:structuredClone(d),volume:l,pan:u,config:{...n.config||{}}},Gi(o))}O(Ei("Session Loaded"),lr("Session Loaded")),I.setSequencers(R),jd();const a=document.getElementById("global-mini-contour");a&&Po(a,R),Yt(0)}const Cs={Digit1:4,Digit2:2,Digit3:1,Digit4:.5,Digit5:.25,Digit6:.125};function Zd(){const t=document.querySelectorAll(".note-duration-btn"),e=document.getElementById("note-duration"),i=document.getElementById("dotted-note-btn"),s=document.getElementById("triplet-note-btn");let a=!1,r=!1;function n(d){let l=d;a?l=d*1.5:r&&(l=d*(2/3)),Y.currentDuration=l,R.forEach(h=>{var f;h.config.currentDuration=l,(f=h.matrix)==null||f.requestRedraw()});let u=Array.from(e.options).find(h=>Math.abs(parseFloat(h.value)-l)<1e-4);u||(u=new Option(l.toString(),l.toString()),e.add(u)),e.value=u.value,e.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),o(d)}function o(d){t.forEach(l=>{const u=parseFloat(l.dataset.value??"0");l.classList.remove("bg-purple-700","bg-gray-800"),u===d?l.classList.add("bg-purple-700"):l.classList.add("bg-gray-800")})}function c(){const d=document.querySelector(".note-duration-btn.bg-purple-700");if(d){const l=parseFloat(d.dataset.value);n(l)}}t.forEach(d=>{d.addEventListener("click",()=>{const l=parseFloat(d.dataset.value);n(l)})}),i.addEventListener("click",()=>{r&&(r=!1,s.classList.remove("bg-purple-700")),a=!a,i.classList.toggle("bg-purple-700"),c()}),s.addEventListener("click",()=>{a&&(a=!1,i.classList.remove("bg-purple-700")),r=!r,s.classList.toggle("bg-purple-700"),Y.isTripletMode=r,R.forEach(d=>{d.config.isTripletMode=r}),c()}),document.addEventListener("keydown",d=>{const l=d.target;if(!(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||Gr())){if(Object.prototype.hasOwnProperty.call(Cs,d.code)){d.preventDefault();const u=Cs[d.code],h=Array.from(t).find(f=>parseFloat(f.dataset.value??"-1")===u);h&&h.click();return}if(d.key==="."){d.preventDefault(),i==null||i.click();return}if(d.key==="/"){d.preventDefault(),s==null||s.click();return}}}),n(Y.currentDuration||1)}function xr(t,e){var i;for(const s of t.sequencers){const a=s.matrix;if(!a)continue;const r=(i=a.getPixelsPerBeat)==null?void 0:i.call(a);if(!r)continue;const n=e*r;a.setPlayheadPixelX(n)}}let ut=null;function Ur(t){const i=ae();function s(){if(!t.isActive())return;const a=t.getCurrentBeat(),r=a/i*1260;Yt(r),xr(t,a),ut=requestAnimationFrame(s)}bi(),ut=requestAnimationFrame(s)}function bi(){ut!==null&&(cancelAnimationFrame(ut),ut=null)}function Qd(t){var e;Yt(0);for(const i of t.sequencers)(e=i.matrix)==null||e.setPlayheadPixelX(0)}function ec(t,e){const i=e.snapResolution||.25,s=e.isTripletMode?i*(2/3):i;return Math.round(t/s)*s}let Jt=!1,pe=null,vi=null,Si=!1;function tc(t,e){pe=t,vi=e,pe.addEventListener("mousedown",ic),window.addEventListener("mousemove",sc),window.addEventListener("mouseup",rc)}function ic(t){I.isActive()&&(I.pause(),Si=!0),Jt=!0,Ji(t)}function sc(t){Jt&&Ji(t)}function rc(t){Jt&&(Ji(t),Jt=!1,Si&&(I.resume(),Si=!1))}function Ji(t){if(!pe||!vi)return;const e=pe.getBoundingClientRect(),i=pe.width/e.width;let s=(t.clientX-e.left)*i;s=Math.max(0,Math.min(pe.width,s));const a=ae(),r=s/pe.width*a,n=ec(r,vi),o=n/a*pe.width;I.seek(n),xr(I,I.getCurrentBeat()),Yt(o)}const Hi={maxBeatsContext:32,extendBeatsAmount:16};function gc(){return Hi.maxBeatsContext}function bc(){return Hi.extendBeatsAmount}function Ni(t,e,i,s){const a=ae(),r=s/a*e;t.clearRect(0,0,e,i);const n=Hi.maxBeatsContext,c=Math.max(0,s-n)/a*e,d=r-c;t.fillStyle="rgba(85, 187, 255, 0.55)",t.fillRect(c,0,d,i),t.strokeStyle="#ffffff",t.lineWidth=2,t.beginPath(),t.moveTo(r,0),t.lineTo(r,i),t.stroke()}let Ms=!1,li=!1,ft=0;function vc(){return ft}function Bs(){if(!Ms){Ms=!0;const s=document.getElementById("extend-use-tags"),a=document.getElementById("extend-tags");if(s&&a){let d=function(){const h=l.checked;u.disabled=!h,u.classList.toggle("opacity-50",!h),u.classList.toggle("cursor-not-allowed",!h)};const l=s,u=a;d(),l.addEventListener("change",d)}const r=document.getElementById("extend-start-help-btn"),n=document.getElementById("extend-start-help-popup"),o=document.getElementById("extend-start-help-close");r&&n&&o&&(r.addEventListener("click",()=>n.classList.remove("hidden")),o.addEventListener("click",()=>n.classList.add("hidden")),document.addEventListener("click",d=>{d.target instanceof Node&&!n.contains(d.target)&&d.target!==r&&n.classList.add("hidden")}));const c=document.querySelector("#ai-extend-modal .generate-btn");c&&c.addEventListener("click",async()=>{const{extendTracksWithAI:d}=await $r(async()=>{const{extendTracksWithAI:l}=await import("./extendTracks-B5DZe7ih.js");return{extendTracksWithAI:l}},__vite__mapDeps([0,1]));await d()})}const t=document.getElementById("extend-track-checkboxes"),e=document.getElementById("extend-select-all"),i=document.getElementById("extend-deselect-all");t&&e&&i&&(t.innerHTML="",re().forEach((a,r)=>{const n=`extend-track-${r}`,o=document.createElement("div");o.className="flex items-center gap-2";const c=document.createElement("input");c.type="checkbox",c.id=n,c.dataset.index=r.toString(),c.checked=!0,c.className="w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500";const d=document.createElement("label");d.htmlFor=n,d.className="text-sm text-gray-200",d.textContent=`Track ${r+1}`,c.addEventListener("change",()=>{nt()}),o.appendChild(c),o.appendChild(d),t.appendChild(o)}),e.addEventListener("click",()=>{t.querySelectorAll('input[type="checkbox"]').forEach(a=>a.checked=!0),nt()}),i.addEventListener("click",()=>{t.querySelectorAll('input[type="checkbox"]').forEach(a=>a.checked=!1),nt()}),nt())}function ac(){const t=document.getElementById("extend-mini-contour"),e=document.getElementById("extend-mini-playhead");if(!t||!e)return;const i=e.getContext("2d");if(!i)return;const s=t.clientWidth,a=t.clientHeight;t.width=s,t.height=a,e.width=s,e.height=a,nt(),Ni(i,s,a,ft),e.addEventListener("mousedown",n=>{li=!0,r(n.offsetX)}),window.addEventListener("mouseup",()=>{li=!1}),window.addEventListener("mousemove",n=>{if(!li)return;const o=e.getBoundingClientRect();r(n.clientX-o.left)});function r(n){if(!i)return;const o=ae(),c=Math.max(0,Math.min(n,s));ft=Math.round(c/s*o),Ni(i,s,a,ft)}}function nt(){const t=document.getElementById("extend-mini-contour"),e=document.getElementById("extend-mini-playhead");if(!t||!e)return;const i=e.getContext("2d");if(!i)return;const s=e.width,a=e.height,r=document.querySelectorAll('#extend-track-checkboxes input[type="checkbox"]'),n=Array.from(r).filter(c=>c.checked).map(c=>parseInt(c.dataset.index||"0",10)),o=re().filter((c,d)=>n.includes(d));be(t,o),Ni(i,s,a,ft)}function nc(){const t=document.getElementById("note-placement-options-btn"),e=document.getElementById("note-editing-options-btn"),i=document.getElementById("note-duration-controls"),s=document.getElementById("note-editing-controls"),a=document.getElementById("velocity-mode-controls");if(!t||!e||!i||!s||!a){console.error("Missing essential UI elements for edit mode switching.");return}function r(o){[t,e].forEach(c=>{c&&(c.classList.remove("bg-purple-600"),c.classList.add("bg-gray-800"))}),o.classList.remove("bg-gray-800"),o.classList.add("bg-purple-600")}function n(o){[i,s,a].forEach(c=>{c&&c.classList.add("hidden")}),o.classList.remove("hidden")}t.addEventListener("click",()=>{r(t),n(i)}),e.addEventListener("click",()=>{r(e),n(s)}),window.addEventListener("keydown",o=>{var l;const c=(l=document.activeElement)==null?void 0:l.tagName;if(!(c==="INPUT"||c==="TEXTAREA"||document.querySelector(".ai-modal:not(.hidden)")))switch(o.key.toLowerCase()){case"q":t.click();break;case"w":e.click();break;default:return}}),r(t),n(i)}function oc(){var h,f,p;const t=document.getElementById("note-mode-btn"),e=document.getElementById("ai-mode-btn"),i=document.getElementById("note-duration-panel"),s=document.getElementById("ai-control-panel");if(!t||!e||!i||!s){console.error("Missing essential elements for control mode switching.");return}function a(){document.querySelectorAll(".sequencer").forEach(g=>{const y=g.querySelector(".delete-btn"),m=g.querySelector(".collapse-btn"),_=m==null?void 0:m.querySelector("use"),v=g.querySelector(".sequencer-body"),b=g.querySelector(".mini-contour");!y||!m||!_||!v||!b||(y.classList.add("button-locked"),m.classList.add("button-locked"),hr(g,!1),v.classList.contains("hidden")||(v.classList.add("hidden"),b.classList.remove("hidden"),_.setAttribute("href","#icon-caret-up")))})}function r(){document.querySelectorAll(".sequencer").forEach(g=>{const y=g.querySelector(".delete-btn"),m=g.querySelector(".collapse-btn");y==null||y.classList.remove("button-locked"),m==null||m.classList.remove("button-locked")})}function n(){!t||!e||!i||!s||(t.classList.replace("bg-gray-800","bg-blue-600"),e.classList.replace("bg-purple-600","bg-gray-800"),i.classList.remove("hidden"),s.classList.add("hidden"),r())}function o(){if(!_i()){const g=document.getElementById("openai-key-not-set-modal");g==null||g.classList.remove("hidden");return}!t||!e||!i||!s||(e.classList.replace("bg-gray-800","bg-purple-600"),t.classList.replace("bg-blue-600","bg-gray-800"),i.classList.add("hidden"),s.classList.remove("hidden"),a())}t.addEventListener("click",n),e.addEventListener("click",o);const c=document.getElementById("ai-inpaint-modal"),d=document.getElementById("ai-extend-modal"),l=document.getElementById("ai-generate-modal");function u(g){if(!g)return;const y=g.querySelector(".cancel-btn");y==null||y.addEventListener("click",()=>{g.classList.add("hidden")})}u(c),u(d),u(l),Bs(),(h=document.getElementById("ai-inpaint-btn"))==null||h.addEventListener("click",()=>{c==null||c.classList.remove("hidden")}),(f=document.getElementById("ai-extend-btn"))==null||f.addEventListener("click",()=>{d==null||d.classList.remove("hidden"),ac(),Bs()}),(p=document.getElementById("ai-generate-btn"))==null||p.addEventListener("click",()=>{l==null||l.classList.remove("hidden")}),nc()}function lc(t,e,i,s=!0){const a=t.getInteractionStore();let r=new Set;if(s){const n=a.getSelectedNotes();r=new Set(n.map(o=>`${o.pitch}:${o.start}:${o.duration}:${o.velocity}`))}if(t.setNotes(structuredClone(e)),t.getNoteManager().rebuildIndex(),s&&r.size>0){const n=t.notes.filter(o=>r.has(`${o.pitch}:${o.start}:${o.duration}:${o.velocity}`));a.setSelectedNotes(n)}if(I!=null&&I.isActive()){const n=I.getStartTime(),o=I.getStartBeat();i.reschedulePlayback(n,o)}t.requestRedraw()}function dc(t,e){return t!==void 0&&e!==void 0&&t===e}function cc(t=Ke()){var i;ki(t.tempo,!1),Ai(t.timeSignature[0],!1),Fi(t.totalMeasures,!1);for(const s of R)s.updateTotalMeasures();for(const s of t.sequencers){const a=R.find(r=>dc(r.id,s.id));if(a){a.instrumentName=s.instrument,typeof s.volume=="number"&&(a.volume=s.volume),typeof s.pan=="number"&&(a.pan=s.pan);const r=(i=a.container)==null?void 0:i.querySelector("canvas.mini-contour");r&&mt(r,s.notes,a.config,a.colorIndex),a.matrix&&lc(a.matrix,s.notes,a,!0)}else{const r={id:s.id,instrument:s.instrument,notes:structuredClone(s.notes),volume:s.volume,pan:s.pan};Nr(r)}}const e=document.getElementById("global-mini-contour");e&&be(e,R)}class uc{constructor(e){this.startTime=0,this.startBeat=0,this.isPlaying=!1,this.animationFrameId=null,this.onResumeCallback=null,this.tick=()=>{if(!this.isPlaying)return;const i=this.getCurrentBeat(),s=ae();if(i>=s)if(Go())this.seek(0),this.start();else{this.stop();return}this.animationFrameId=requestAnimationFrame(this.tick)},this.context=z(),this.sequencers=e}setOnResumeCallback(e){this.onResumeCallback=e}getCurrentBeat(){if(!this.isPlaying)return this.startBeat;const e=60/he();return(this.context.currentTime-this.startTime)/e+this.startBeat}async start(){const e=this.context.currentTime+.1;this.startTime=e,this.startBeat=0,this.isPlaying=!0,await this.scheduleAll(e,this.startBeat),this.context.state==="suspended"&&await this.context.resume(),this.animationFrameId=requestAnimationFrame(this.tick)}syncAfterTempoChange(e){const i=this.context.currentTime,s=60/e,a=(i-this.startTime)/s+this.startBeat;this.startBeat=a,this.startTime=i}async pause(){if(!this.isPlaying)return;const e=this.getCurrentBeat();for(const i of this.sequencers)i.stopScheduledNotes();await this.context.suspend(),this.startBeat=e,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}async resume(){var s;if(this.isPlaying)return;await this.context.resume();const i=this.context.currentTime+.05;this.startTime=i,await this.scheduleAll(i,this.startBeat),this.isPlaying=!0,(s=this.onResumeCallback)==null||s.call(this),this.animationFrameId=requestAnimationFrame(this.tick)}async scheduleAll(e,i){for(const s of this.sequencers)s.shouldPlay?await s.preparePlayback(e,i):s.stopScheduledNotes()}stop(){for(const e of this.sequencers)e.stopScheduledNotes();this.isPlaying=!1,this.startBeat=0,this.startTime=0,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),Md()}seek(e){this.startBeat=e,this.startTime=this.context.currentTime,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}setSequencers(e){this.sequencers=e}isActive(){return this.isPlaying}getStartTime(){return this.startTime}getStartBeat(){return this.startBeat}}Kr();const I=new uc(re());I.setOnResumeCallback(()=>Ur(I));vo(cc);El();function fc(){const t=document.getElementById("global-mini-contour");t&&be(t,R)}document.getElementById("global-mini-contour");const Dr=document.getElementById("global-mini-playhead");Yd(Dr);tc(Dr,Y);const Ls=0,hc="sf2/fluidr3-gm/acoustic_grand_piano";O(ir(Ls,hc),Gi(Ls));const mc=document.getElementById("piano");cd(mc);const pc=document.getElementById("waveform"),yc=document.getElementById("visualizer-mode");fd(pc,yc);O(Ei("Initial App State"),lr("Initial App State"));Vr(Co,Mo);fc();hd();Zd();Zl();jl();Ad();oc();Bd();rd();ad();Xr();Cd({getSequencers:()=>R,onPlay:async()=>{await I.start(),Ur(I)},onPause:async()=>{await I.pause(),bi()},onResume:async()=>{await I.resume()},onStop:()=>{I.stop(),bi(),Qd(I)},onDurationChange:t=>{Y.currentDuration=t,R.forEach(e=>e.config.currentDuration=t)},onSnapChange:t=>{Y.snapResolution=t,R.forEach(e=>e.config.snapResolution=t)},onToggleLoop:t=>{Y.loopEnabled=t,R.forEach(e=>e.config.loopEnabled=t),wo(t)},onTempoChange:t=>{ki(t)},onSave:async t=>{const e=Ke();if(t==="json"){const{url:i,filename:s}=Ld(e),a=document.createElement("a");a.href=i,a.download=s,a.click(),URL.revokeObjectURL(i)}else if(t==="wav")Ed();else if(t==="midi"){const{url:i,filename:s}=await zd(e),a=document.createElement("a");a.href=i,a.download=s,a.click(),URL.revokeObjectURL(i)}},onLoad:async t=>{var e;try{const i=(e=t.name.split(".").pop())==null?void 0:e.toLowerCase();if(i==="json"){const{tracks:s,globalConfig:a}=await Xd(t);Ns(s,a)}else if(i==="mid"||i==="midi"){const{tracks:s,globalConfig:a}=await Vd(t);Ns(s,a)}else throw new Error("Unsupported file type.")}catch(i){i instanceof Error?alert("Failed to load file: "+i.message):alert("Failed to load file: Unknown error")}},onMeasuresChange:t=>{Fi(t);const e=document.getElementById("global-mini-contour");e&&be(e,R)},onBeatsPerMeasureChange:t=>{Ai(t);const e=document.getElementById("global-mini-contour");e&&be(e,R)}});Wr();const Sc=Object.freeze(Object.defineProperty({__proto__:null,engine:I},Symbol.toStringTag,{value:"Module"}));export{rs as a,re as b,vc as c,gc as d,bc as e,gt as f,_i as g,mt as h,be as i,Sc as m,Fi as u};
