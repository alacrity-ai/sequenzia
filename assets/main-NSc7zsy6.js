const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/extendTracks-JIj-plVC.js","assets/index-VrxXiQV4.js"])))=>i.map(i=>d[i]);
import{_ as sn}from"./index-VrxXiQV4.js";function rn(){return new Date().toISOString()}function mi(t,e=1){var s,n;if(t===null||typeof t!="object")return t;if(e===0){const r=((s=t.constructor)==null?void 0:s.name)||"Object",a=Object.keys(t).length;return`[${r} object, ${a} keys]`}if(Array.isArray(t))return t.map(r=>mi(r,e-1));const i={_type:((n=t.constructor)==null?void 0:n.name)||"Object"};for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const a=t[r];if(a instanceof HTMLElement)i[r]=`[HTMLElement: ${a.tagName}]`;else if(a instanceof AudioContext||a instanceof AudioNode)i[r]="[AudioNode]";else if(typeof a=="function")i[r]="[Function]";else if(typeof a=="object")try{i[r]=mi(a,e-1)}catch{i[r]="[Unserializable Object]"}else i[r]=a}return i}function nn(t){try{const e=mi(t,2);return JSON.stringify(e,null,2)}catch(e){return JSON.stringify({error:"Could not serialize log payload",reason:e.message,type:typeof t},null,2)}}function Rs(t,e,i="log"){const n={timestamp:rn(),level:i,message:t};e!==void 0&&(n.data=e);const r=nn(n);switch(i){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;case"debug":console.debug(r);break;case"log":default:console.log(r);break}}const Ei="SEQUENZIA_DEV";let _t=!1;typeof window<"u"&&(_t=localStorage.getItem(Ei)==="true");function Vi(){_t=!0,typeof window<"u"&&localStorage.setItem(Ei,"true")}function an(){_t=!1,typeof window<"u"&&localStorage.removeItem(Ei)}function ii(){return _t}function Q(t,e,i="log"){_t&&Rs(t,e,i)}var on=Object.defineProperty,ln=Object.defineProperties,dn=Object.getOwnPropertyDescriptors,ji=Object.getOwnPropertySymbols,cn=Object.prototype.hasOwnProperty,un=Object.prototype.propertyIsEnumerable,Os=t=>{throw TypeError(t)},Yi=(t,e,i)=>e in t?on(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i,ee=(t,e)=>{for(var i in e||(e={}))cn.call(e,i)&&Yi(t,i,e[i]);if(ji)for(var i of ji(e))un.call(e,i)&&Yi(t,i,e[i]);return t},be=(t,e)=>ln(t,dn(e)),Ii=(t,e,i)=>e.has(t)||Os("Cannot "+i),B=(t,e,i)=>(Ii(t,e,"read from private field"),i?i.call(t):e.get(t)),H=(t,e,i)=>e.has(t)?Os("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,i),x=(t,e,i,s)=>(Ii(t,e,"write to private field"),e.set(t,i),i),It=(t,e,i)=>(Ii(t,e,"access private method"),i),W=(t,e,i)=>new Promise((s,n)=>{var r=c=>{try{o(i.next(c))}catch(d){n(d)}},a=c=>{try{o(i.throw(c))}catch(d){n(d)}},o=c=>c.done?s(c.value):Promise.resolve(c.value).then(r,a);o((i=i.apply(t,e)).next())});function kt(t){const e=t.filter(i=>!!i);return e.reduce((i,s)=>{const n="output"in i?i.output:i,r="input"in s?s.input:s;return n.connect(r),s}),()=>{e.reduce((i,s)=>{const n="output"in i?i.output:i,r="input"in s?s.input:s;return n.disconnect(r),s})}}function fn(t){let e=t;const i=new Set;function s(a){return i.add(a),a(e),()=>{i.delete(a)}}function n(a){e=a,i.forEach(o=>o(e))}function r(){return e}return{subscribe:s,set:n,get:r}}function hn(){const t=new Set;function e(s){return t.add(s),()=>{t.delete(s)}}function i(s){t.forEach(n=>n(s))}return{subscribe:e,trigger:i}}function mn(t){let e=!1;return()=>{e||(e=!0,t.forEach(i=>i==null?void 0:i()))}}function xs(t){return t*t/16129}function pn(t){return Math.pow(10,t/20)}var Le,pe,Oe,xe,At,Ge,Ee,Us=class{constructor(t,e){this.context=t,H(this,Le),H(this,pe),H(this,Oe),H(this,xe),H(this,At),H(this,Ge),H(this,Ee,!1);var i,s,n;x(this,Ge,{destination:(i=e==null?void 0:e.destination)!=null?i:t.destination,volume:(s=e==null?void 0:e.volume)!=null?s:100,volumeToGain:(n=e==null?void 0:e.volumeToGain)!=null?n:xs}),this.input=t.createGain(),x(this,Le,t.createGain()),x(this,xe,kt([this.input,B(this,Le),B(this,Ge).destination]));const r=fn(B(this,Ge).volume);this.setVolume=r.set,x(this,At,r.subscribe(a=>{B(this,Le).gain.value=B(this,Ge).volumeToGain(a)}))}addInsert(t){var e;if(B(this,Ee))throw Error("Can't add insert to disconnected channel");(e=B(this,Oe))!=null||x(this,Oe,[]),B(this,Oe).push(t),B(this,xe).call(this),x(this,xe,kt([this.input,...B(this,Oe),B(this,Le),B(this,Ge).destination]))}addEffect(t,e,i){var s;if(B(this,Ee))throw Error("Can't add effect to disconnected channel");const n=this.context.createGain();n.gain.value=i;const r="input"in e?e.input:e,a=kt([B(this,Le),n,r]);(s=B(this,pe))!=null||x(this,pe,[]),B(this,pe).push({name:t,mix:n,disconnect:a})}sendEffect(t,e){var i;if(B(this,Ee))throw Error("Can't send effect to disconnected channel");const s=(i=B(this,pe))==null?void 0:i.find(n=>n.name===t);s?s.mix.gain.value=e:console.warn("Send bus not found: "+t)}disconnect(){var t;B(this,Ee)||(x(this,Ee,!0),B(this,xe).call(this),B(this,At).call(this),(t=B(this,pe))==null||t.forEach(e=>e.disconnect()),x(this,pe,void 0))}};Le=new WeakMap;pe=new WeakMap;Oe=new WeakMap;xe=new WeakMap;At=new WeakMap;Ge=new WeakMap;Ee=new WeakMap;var j,yn=class{constructor(t){this.compare=t,H(this,j,[])}push(t){const e=B(this,j).length;let i=0,s=e-1,n=e;for(;i<=s;){const r=Math.floor((i+s)/2);this.compare(t,B(this,j)[r])<0?(n=r,s=r-1):i=r+1}B(this,j).splice(n,0,t)}pop(){return B(this,j).shift()}peek(){return B(this,j)[0]}removeAll(t){const e=B(this,j).length;return x(this,j,B(this,j).filter(i=>!t(i))),B(this,j).length!==e}clear(){x(this,j,[])}size(){return B(this,j).length}};j=new WeakMap;function Zi(t,e){return t&&e?i=>{t(i),e(i)}:t??e}function _n(t){var e,i,s;const n={disableScheduler:(e=t.disableScheduler)!=null?e:!1,scheduleLookaheadMs:(i=t.scheduleLookaheadMs)!=null?i:200,scheduleIntervalMs:(s=t.scheduleIntervalMs)!=null?s:50,onStart:t.onStart,onEnded:t.onEnded};if(n.scheduleLookaheadMs<1)throw Error("scheduleLookaheadMs must be greater than 0");if(n.scheduleIntervalMs<1)throw Error("scheduleIntervalMs must be greater than 0");if(n.scheduleLookaheadMs<n.scheduleIntervalMs)throw Error("scheduleLookaheadMs must be greater than scheduleIntervalMs");return n}var le,Y,Ie,Ds=class{constructor(t,e={}){H(this,le),H(this,Y),H(this,Ie),x(this,le,_n(e)),x(this,Y,new yn((i,s)=>i.time-s.time)),this.player=t}get context(){return this.player.context}get buffers(){return this.player.buffers}get isRunning(){return B(this,Ie)!==void 0}start(t){var e;if(B(this,le).disableScheduler)return this.player.start(t);const i=this.player.context,s=i.currentTime,n=(e=t.time)!=null?e:s,r=B(this,le).scheduleLookaheadMs/1e3;return t.onStart=Zi(t.onStart,B(this,le).onStart),t.onEnded=Zi(t.onEnded,B(this,le).onEnded),n<s+r?this.player.start(t):(B(this,Y).push(be(ee({},t),{time:n})),B(this,Ie)||x(this,Ie,setInterval(()=>{const a=i.currentTime+r;for(;B(this,Y).size()&&B(this,Y).peek().time<=a;){const o=B(this,Y).pop();o&&this.player.start(o)}B(this,Y).size()||(clearInterval(B(this,Ie)),x(this,Ie,void 0))},B(this,le).scheduleIntervalMs)),a=>{!a||a<n?B(this,Y).removeAll(o=>o===t)||this.player.stop(be(ee({},t),{time:a})):this.player.stop(be(ee({},t),{time:a}))})}stop(t){var e;if(B(this,le).disableScheduler)return this.player.stop(t);if(this.player.stop(t),!t){B(this,Y).clear();return}const i=(e=t==null?void 0:t.time)!=null?e:0,s=t==null?void 0:t.stopId;s?B(this,Y).removeAll(n=>n.time>=i&&n.stopId?n.stopId===s:n.note===s):B(this,Y).removeAll(n=>n.time>=i)}disconnect(){this.player.disconnect()}};le=new WeakMap;Y=new WeakMap;Ie=new WeakMap;var et,Ue,tt,qs=class{constructor(t,e){this.context=t,this.options=e,H(this,et),H(this,Ue,!1),H(this,tt);var i,s;x(this,et,{velocityToGain:(i=e.velocityToGain)!=null?i:xs,destination:(s=e.destination)!=null?s:t.destination}),this.buffers={},x(this,tt,hn())}start(t){var e,i,s,n,r,a,o,c,d,l,u,h,f,p;if(B(this,Ue))throw new Error("Can't start a sample on disconnected player");const g=this.context,y=t.name&&this.buffers[t.name]||this.buffers[t.note];if(!y)return console.warn(`Sample not found: '${t.note}'`),()=>{};const m=g.createBufferSource();m.buffer=y;const _=(i=(e=t.detune)!=null?e:this.options.detune)!=null?i:0;m.detune?m.detune.value=_:m.playbackRate&&(m.playbackRate.value=Math.pow(2,_/1200));const v=(s=t.lpfCutoffHz)!=null?s:this.options.lpfCutoffHz,b=v?g.createBiquadFilter():void 0;v&&b&&(b.type="lowpass",b.frequency.value=v);const S=g.createGain(),N=(r=(n=t.velocity)!=null?n:this.options.velocity)!=null?r:100;S.gain.value=B(this,et).velocityToGain(N),((a=t.loop)!=null?a:this.options.loop)&&(m.loop=!0,m.loopStart=(o=t.loopStart)!=null?o:0,m.loopEnd=(c=t.loopEnd)!=null?c:y.duration);const M=(d=t.decayTime)!=null?d:this.options.decayTime,[E,k]=gn(g,M);function L(P){if(P??(P=g.currentTime),P<=D)m.stop(P);else{const G=k(P);m.stop(G)}}const F=t.gainOffset?g.createGain():void 0;F&&t.gainOffset&&(F.gain.value=t.gainOffset);const A=(l=t.stopId)!=null?l:t.note,U=mn([kt([m,b,S,E,F,B(this,et).destination]),(u=t.stop)==null?void 0:u.call(t,L),B(this,tt).subscribe(P=>{(!P||P.stopId===void 0||P.stopId===A)&&L(P==null?void 0:P.time)})]);m.onended=()=>{var P;U(),(P=t.onEnded)==null||P.call(t,t)},(h=t.onStart)==null||h.call(t,t);const D=Math.max((f=t.time)!=null?f:0,g.currentTime);m.start(t.time);let q=(p=t.duration)!=null?p:y.duration;return typeof t.duration=="number"&&L(D+q),L}stop(t){B(this,tt).trigger(t)}disconnect(){B(this,Ue)||(x(this,Ue,!0),this.stop(),Object.keys(this.buffers).forEach(t=>{delete this.buffers[t]}))}get connected(){return!B(this,Ue)}};et=new WeakMap;Ue=new WeakMap;tt=new WeakMap;function gn(t,e=.2){let i=0;const s=t.createGain();s.gain.value=1;function n(r){if(i)return i;s.gain.cancelScheduledValues(r);const a=r||t.currentTime;return i=a+e,s.gain.setValueAtTime(1,a),s.gain.linearRampToValueAtTime(0,i),i}return[s,n]}var Kt=class{constructor(t,e){this.context=t;const i=new Us(t,e);this.player=new Ds(new qs(t,be(ee({},e),{destination:i.input})),e),this.output=i}get buffers(){return this.player.buffers}start(t){return this.player.start(t)}stop(t){this.player.stop(typeof t=="object"?t:t!==void 0?{stopId:t}:void 0)}disconnect(){this.output.disconnect(),this.player.disconnect()}};function ki(t,e,i){return W(this,null,function*(){e=e.replace(/#/g,"%23").replace(/([^:]\/)\/+/g,"$1");const s=yield i.fetch(e);if(s.status!==200){console.warn("Error loading buffer. Invalid status: ",s.status,e);return}try{const n=yield s.arrayBuffer();return yield t.decodeAudioData(n)}catch(n){console.warn("Error loading buffer",n,e)}})}function zt(t){if(typeof document>"u")return null;const e=document.createElement("audio");for(let i=0;i<t.length;i++){const s=t[i],n=e.canPlayType(`audio/${s}`);if(n==="probably"||n==="maybe")return s;if(s==="m4a"){const r=e.canPlayType("audio/aac");if(r==="probably"||r==="maybe")return s}}return null}function bn(){var t;return"."+((t=zt(["ogg","m4a"]))!=null?t:"ogg")}var gt={fetch(t){return fetch(t)}};function Js(t){return typeof t=="object"&&typeof t.baseUrl=="string"&&typeof t.name=="string"&&Array.isArray(t.samples)&&Array.isArray(t.groupNames)&&typeof t.nameToSampleName=="object"&&typeof t.sampleGroupVariations=="object"}var vn={baseUrl:"",name:"",samples:[],groupNames:[],nameToSampleName:{},sampleGroupVariations:{}};function Sn(t,e){return W(this,null,function*(){var i,s,n,r;const o=yield(yield e.fetch(t)).json();o.baseUrl=t.replace("/dm.json",""),o.groupNames=[],o.nameToSampleName={},o.sampleGroupVariations={};for(const c of o.samples){o.nameToSampleName[c]=c;const d=c.indexOf("/")!==-1?"/":"-",[l,u]=c.split(d);o.groupNames.includes(l)||o.groupNames.push(l),(s=(i=o.nameToSampleName)[l])!=null||(i[l]=c),(r=(n=o.sampleGroupVariations)[l])!=null||(n[l]=[]),u&&o.sampleGroupVariations[l].push(`${l}${d}${u}`)}return o})}function Hs(){return Object.keys($s)}var $s={"TR-808":"https://smpldsnds.github.io/drum-machines/TR-808/dm.json","Casio-RZ1":"https://smpldsnds.github.io/drum-machines/Casio-RZ1/dm.json","LM-2":"https://smpldsnds.github.io/drum-machines/LM-2/dm.json","MFB-512":"https://smpldsnds.github.io/drum-machines/MFB-512/dm.json","Roland CR-8000":"https://smpldsnds.github.io/drum-machines/Roland-CR-8000/dm.json"};function Nn(t){var e,i,s;const n={instrument:(e=t==null?void 0:t.instrument)!=null?e:"TR-808",storage:(i=t==null?void 0:t.storage)!=null?i:gt,url:(s=t==null?void 0:t.url)!=null?s:""};if(typeof n.instrument=="string"){if(n.url||(n.url=$s[n.instrument]),!n.url)throw new Error("Invalid instrument: "+n.instrument)}else if(!Js(n.instrument))throw new Error("Invalid instrument: "+n.instrument);return n}var de,Cn=class{constructor(t,e){H(this,de,vn);const i=Nn(e),s=Js(i.instrument)?Promise.resolve(i.instrument):Sn(i.url,i.storage);this.player=new Kt(t,e),this.output=this.player.output,this.load=Mn(t,this.player.buffers,s,i.storage).then(()=>this),s.then(n=>{x(this,de,n)})}getSampleNames(){return B(this,de).samples.slice()}getGroupNames(){return B(this,de).groupNames.slice()}getSampleNamesForGroup(t){var e;return(e=B(this,de).sampleGroupVariations[t])!=null?e:[]}start(t){var e;const i=B(this,de).nameToSampleName[t.note];return this.player.start(be(ee({},t),{note:i||t.note,stopId:(e=t.stopId)!=null?e:t.note}))}stop(t){return this.player.stop(t)}loaded(){return W(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}get sampleNames(){return console.log("deprecated: Use getGroupNames instead"),B(this,de).groupNames.slice()}getVariations(t){var e;return console.warn("deprecated: use getSampleNamesForGroup"),(e=B(this,de).sampleGroupVariations[t])!=null?e:[]}};de=new WeakMap;function Mn(t,e,i,s){var n;const r=(n=zt(["ogg","m4a"]))!=null?n:"ogg";return i.then(a=>Promise.all(a.samples.map(o=>W(this,null,function*(){const c=`${a.baseUrl}/${o}.${r}`,d=yield ki(t,c,s);d&&(e[o]=d)}))))}function Bn(t){const i=/^([a-gA-G]?)(#{1,}|b{1,}|)(-?\d+)$/.exec(t);if(!i)return;const s=i[1].toUpperCase();if(!s)return;const n=i[2],r=n[0]==="b"?-n.length:n.length,a=i[3]?+i[3]:4,o=(s.charCodeAt(0)+3)%7;return[0,2,4,5,7,9,11][o]+r+12*(a+1)}function he(t){return t===void 0?void 0:typeof t=="number"?t:Bn(t)}function wn(t={}){return{groups:[],options:t}}function Ai(){return{regions:[]}}function Ks(t,e,i,s){const n=[],r=he(e.note);if(r===void 0)return n;for(const a of t.regions){const o=zs(r,i??0,e,a,s);o&&n.push(o)}return n}function Ln(t,e,i,s){const n=he(e.note);if(n!==void 0)for(const r of t.regions){const a=zs(n,0,e,r,s);if(a)return a}}function zs(t,e,i,s,n){var r,a,o,c,d,l,u,h,f,p,g,y,m,_,v,b,S,N,C,M,E,k,L,F,A,U,D,q;if(!(t>=((r=s.midiLow)!=null?r:0)&&t<((a=s.midiHigh)!=null?a:127)+1)||!(i.velocity===void 0||i.velocity>=((o=s.velLow)!=null?o:0)&&i.velocity<=((c=s.velHigh)!=null?c:127)))return;if(s.seqLength){const en=e%s.seqLength,tn=((d=s.seqPosition)!=null?d:1)-1;if(en!==tn)return}const J=t-s.midiPitch,R=(l=i.velocity)!=null?l:n==null?void 0:n.velocity,ie=s.volume?pn(s.volume):0,Xe=(h=(u=i.gainOffset)!=null?u:void 0)!=null?h:0,Qr=(f=i.detune)!=null?f:0;return{decayTime:(y=(g=i==null?void 0:i.decayTime)!=null?g:(p=s.sample)==null?void 0:p.decayTime)!=null?y:n==null?void 0:n.decayTime,detune:100*(J+((m=s.tune)!=null?m:0))+Qr,duration:(b=(v=i==null?void 0:i.duration)!=null?v:(_=s.sample)==null?void 0:_.duration)!=null?b:n==null?void 0:n.duration,gainOffset:Xe+ie||void 0,loop:(C=(N=i==null?void 0:i.loop)!=null?N:(S=s.sample)==null?void 0:S.loop)!=null?C:n==null?void 0:n.loop,loopEnd:(k=(E=i==null?void 0:i.loopEnd)!=null?E:(M=s.sample)==null?void 0:M.loopEnd)!=null?k:n==null?void 0:n.loopEnd,loopStart:(A=(F=i==null?void 0:i.loopStart)!=null?F:(L=s.sample)==null?void 0:L.loopStart)!=null?A:n==null?void 0:n.loopStart,lpfCutoffHz:(q=(D=i==null?void 0:i.lpfCutoffHz)!=null?D:(U=s.sample)==null?void 0:U.lpfCutoffHz)!=null?q:n==null?void 0:n.lpfCutoffHz,name:s.sampleName,note:t,onEnded:i.onEnded,onStart:i.onStart,stopId:i.name,time:i.time,velocity:R??void 0}}function Gn(t){if(t.length===0)return[];if(t.sort((e,i)=>e.midiPitch-i.midiPitch),t[0].midiLow=0,t[0].midiHigh=127,t.length===1)return t;for(let e=1;e<t.length;e++){const i=t[e-1],s=t[e],n=Math.floor((i.midiPitch+s.midiPitch)/2);i.midiHigh=n,s.midiLow=n+1}return t[t.length-1].midiHigh=127,t}var En=class{constructor(t,e){this.context=t,this.seqNum=0;const i=new Us(t,e);this.instrument=wn(e),this.player=new Ds(new qs(t,be(ee({},e),{destination:i.input})),e),this.output=i}get buffers(){return this.player.buffers}start(t){const e=[],i=typeof t=="object"?t:{note:t};for(const s of this.instrument.groups){const n=Ks(s,i,this.seqNum);this.seqNum++;for(const r of n){let a=this.player.start(r);e.push(a)}}return s=>e.forEach(n=>n(s))}stop(t){if(t==null){this.player.stop();return}const e=typeof t=="object"?t:{stopId:t},i=he(e.stopId);i&&(e.stopId=i,this.player.stop(e))}disconnect(){this.output.disconnect(),this.player.disconnect()}};function Ws(t,e){const i=bn();return(s,n)=>W(this,null,function*(){const r=yield fetch(t).then(c=>c.text()),a=In(r,e.group);a.length&&console.warn("Problems converting sfz",a);const o=new Set;return e.group.regions.forEach(c=>o.add(c.sampleName)),Promise.all(Array.from(o).map(c=>W(this,null,function*(){const d=e.urlFromSampleName(c,i),l=yield ki(s,d,n);e.buffers[c]=l}))).then(()=>e.group)})}function In(t,e){let i="global";const s=t.split(`
`).map(Tn).filter(a=>!!a),n=new Rn;let r=[];for(const a of s)switch(a.type){case"mode":r.push(n.closeScope(i,e)),i=a.value;break;case"prop:num":case"prop:str":case"prop:num_arr":n.push(a.key,a.value);break;case"unknown":console.warn("Unknown SFZ token",a.value);break}return r.filter(a=>!!a)}var kn=/^<([^>]+)>$/,An=/^([^=]+)=([-\.\d]+)$/,Pn=/^([^=]+)=(.+)$/,Fn=/^([^=]+)_(\d+)=(\d+)$/;function Tn(t){if(t=t.trim(),t===""||t.startsWith("//"))return;const e=t.match(kn);if(e)return{type:"mode",value:e[1]};const i=t.match(Fn);if(i)return{type:"prop:num_arr",key:i[1],value:[Number(i[2]),Number(i[3])]};const s=t.match(An);if(s)return{type:"prop:num",key:s[1],value:Number(s[2])};const n=t.match(Pn);return n?{type:"prop:str",key:n[1],value:n[2]}:{type:"unknown",value:t}}var it,Pt,Rn=class{constructor(){H(this,it),this.values={},this.global={},this.group={}}closeScope(t,e){if(t==="global")It(this,it,Pt).call(this,this.global);else if(t==="group")this.group=It(this,it,Pt).call(this,{});else if(t==="region"){const i=It(this,it,Pt).call(this,ee(ee({sampleName:"",midiPitch:-1},this.global),this.group));if(i.sampleName==="")return"Missing sample name";if(i.midiPitch===-1)if(i.midiLow!==void 0)i.midiPitch=i.midiLow;else return"Missing pitch_keycenter";i.seqLength&&i.seqPosition===void 0&&(i.seqPosition=1),i.ampRelease&&(i.sample={decayTime:i.ampRelease},delete i.ampRelease),e.regions.push(i)}}get empty(){return Object.keys(this.values).length===0}get keys(){return Object.keys(this.values)}push(t,e){this.values[t]=e}popNum(t,e,i){return typeof this.values[t]!="number"?!1:(e[i]=this.values[t],delete this.values[t],!0)}popStr(t,e,i){return typeof this.values[t]!="string"?!1:(e[i]=this.values[t],delete this.values[t],!0)}popNumArr(t,e,i){return Array.isArray(this.values[t])?(e[i]=this.values[t],delete this.values[t],!0):!1}};it=new WeakSet;Pt=function(t){return this.popStr("sample",t,"sampleName"),this.popNum("pitch_keycenter",t,"midiPitch"),this.popNum("ampeg_attack",t,"ampAttack"),this.popNum("ampeg_release",t,"ampRelease"),this.popNum("bend_down",t,"bendDown"),this.popNum("bend_up",t,"bendUp"),this.popNum("group",t,"group"),this.popNum("hikey",t,"midiHigh"),this.popNum("hivel",t,"velHigh"),this.popNum("lokey",t,"midiLow"),this.popNum("offset",t,"offset"),this.popNum("lovel",t,"velLow"),this.popNum("off_by",t,"groupOffBy"),this.popNum("pitch_keytrack",t,"ignore"),this.popNum("seq_length",t,"seqLength"),this.popNum("seq_position",t,"seqPosition"),this.popNum("tune",t,"tune"),this.popNum("volume",t,"volume"),this.popNumArr("amp_velcurve",t,"ampVelCurve"),this.values={},t};var On="https://smpldsnds.github.io/sgossner-vcsl/";function xn(t){return On+t+".sfz"}function Un(t,e){const i=xn(t),n=`https://smpldsnds.github.io/sgossner-vcsl/${t.slice(0,t.lastIndexOf("/")+1)}`,r=Ai();return Ws(i,{buffers:e,group:r,urlFromSampleName:(a,o)=>n+"/"+a.replace(".wav",o)})}var Dn=class{constructor(t,e={}){var i,s;this.config={instrument:(i=e.instrument)!=null?i:"Arco",storage:(s=e.storage)!=null?s:gt},this.player=new En(t,e);const n=Un(this.config.instrument,this.player.buffers);this.load=n(t,this.config.storage).then(r=>(this.player.instrument.groups.push(r),this))}get output(){return this.player.output}get buffers(){return this.player.buffers}get context(){return this.player.context}start(t){return this.player.start(t)}stop(t){return this.player.stop(t)}disconnect(){this.player.disconnect()}};function qn(){return Object.keys(Xs)}var Jn=class extends Dn{constructor(t,e){var i;super(t,be(ee({},e),{instrument:Xs[(i=e.instrument)!=null?i:""]}))}},Xs={"Balafon - Hard Mallet":"Idiophones/Struck Idiophones/Balafon - Hard Mallet","Balafon - Keyswitch":"Idiophones/Struck Idiophones/Balafon - Keyswitch","Balafon - Soft Mallet":"Idiophones/Struck Idiophones/Balafon - Soft Mallet","Balafon - Traditional Mallet":"Idiophones/Struck Idiophones/Balafon - Traditional Mallet","Tubular Bells 1":"Idiophones/Struck Idiophones/Tubular Bells 1","Tubular Bells 2":"Idiophones/Struck Idiophones/Tubular Bells 2","Vibraphone - Bowed":"Idiophones/Struck Idiophones/Vibraphone - Bowed","Vibraphone - Hard Mallets":"Idiophones/Struck Idiophones/Vibraphone - Hard Mallets","Vibraphone - Keyswitch":"Idiophones/Struck Idiophones/Vibraphone - Keyswitch","Vibraphone - Soft Mallets":"Idiophones/Struck Idiophones/Vibraphone - Soft Mallets","Xylophone - Hard Mallets":"Idiophones/Struck Idiophones/Xylophone - Hard Mallets","Xylophone - Keyswitch":"Idiophones/Struck Idiophones/Xylophone - Keyswitch","Xylophone - Medium Mallets":"Idiophones/Struck Idiophones/Xylophone - Medium Mallets","Xylophone - Soft Mallets":"Idiophones/Struck Idiophones/Xylophone - Soft Mallets"};function Hn(){return["Pizzicato","Arco","Switched"]}function $n(t){return`https://smpldsnds.github.io/sfzinstruments-dsmolken-double-bass/d_smolken_rubner_bass_${{Arco:"arco",Pizzicato:"pizz",Switched:"switched"}[t]}.sfz`}var Kn=class{constructor(t,e={}){this.seqNum=0;var i,s;this.config={instrument:(i=e.instrument)!=null?i:"Arco",storage:(s=e.storage)!=null?s:gt},this.player=new Kt(t,e),this.group=Ai();const n=$n(this.config.instrument),r=Ws(n,{buffers:this.player.buffers,group:this.group,urlFromSampleName:(a,o)=>`https://smpldsnds.github.io/sfzinstruments-dsmolken-double-bass/${a.replace("\\","/").replace(".wav",o)}`});this.load=r(t,this.config.storage).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}get context(){return this.player.context}start(t){const e=Ks(this.group,typeof t=="object"?t:{note:t},this.seqNum);this.seqNum++;const i=e.map(s=>this.player.start(s));return s=>i.forEach(n=>n(s))}stop(t){if(t==null){this.player.stop();return}const e=typeof t=="object"?t:{stopId:t},i=he(e.stopId);i&&(e.stopId=i,this.player.stop(e))}disconnect(){this.player.disconnect()}};function zn(t,e){var i;const s=(i=zt(["ogg","mp3"]))!=null?i:"mp3";return`https://gleitz.github.io/midi-js-soundfonts/${e}/${t}-${s}.js`}function Wn(t,e,i){return(s,n)=>W(this,null,function*(){const r=yield(yield n.fetch(t)).text(),a=Xn(r),o=Object.keys(a);yield Promise.all(o.map(c=>W(this,null,function*(){const d=he(c);if(!d)return;const l=jn(Vn(a[c])),u=yield s.decodeAudioData(l);e[c]=u,i.regions.push({sampleName:c,midiPitch:d})}))),Gn(i.regions)})}function Xn(t){const e=t.indexOf("MIDI.Soundfont.");if(e<0)throw Error("Invalid MIDI.js Soundfont format");const i=t.indexOf("=",e)+2,s=t.lastIndexOf(",");return JSON.parse(t.slice(i,s)+"}")}function Vn(t){return t.slice(t.indexOf(",")+1)}function jn(t){const e=window.atob(t),i=e.length,s=new Uint8Array(i);for(let n=0;n<i;n++)s[n]=e.charCodeAt(n);return s.buffer}var Yn=["MusyngKite","FluidR3_GM"],Zn=["accordion","acoustic_bass","acoustic_grand_piano","acoustic_guitar_nylon","acoustic_guitar_steel","agogo","alto_sax","applause","bagpipe","banjo","baritone_sax","bassoon","bird_tweet","blown_bottle","brass_section","breath_noise","bright_acoustic_piano","celesta","cello","choir_aahs","church_organ","clarinet","clavinet","contrabass","distortion_guitar","drawbar_organ","dulcimer","electric_bass_finger","electric_bass_pick","electric_grand_piano","electric_guitar_clean","electric_guitar_jazz","electric_guitar_muted","electric_piano_1","electric_piano_2","english_horn","fiddle","flute","french_horn","fretless_bass","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","glockenspiel","guitar_fret_noise","guitar_harmonics","gunshot","harmonica","harpsichord","helicopter","honkytonk_piano","kalimba","koto","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","marimba","melodic_tom","music_box","muted_trumpet","oboe","ocarina","orchestra_hit","orchestral_harp","overdriven_guitar","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","pan_flute","percussive_organ","piccolo","pizzicato_strings","recorder","reed_organ","reverse_cymbal","rock_organ","seashore","shakuhachi","shamisen","shanai","sitar","slap_bass_1","slap_bass_2","soprano_sax","steel_drums","string_ensemble_1","string_ensemble_2","synth_bass_1","synth_bass_2","synth_brass_1","synth_brass_2","synth_choir","synth_drum","synth_strings_1","synth_strings_2","taiko_drum","tango_accordion","telephone_ring","tenor_sax","timpani","tinkle_bell","tremolo_strings","trombone","trumpet","tuba","tubular_bells","vibraphone","viola","violin","voice_oohs","whistle","woodblock","xylophone"];function Qn(t,e){if(!t.startsWith("http"))return`https://goldst.dev/midi-js-soundfonts/${e}/${t}-loop.json`}function ea(t,e=44100){return W(this,null,function*(){if(t)try{const i=yield fetch(t);if(i.status!==200)return;const s=yield i.json(),n={};return Object.keys(s).forEach(r=>{const a=he(r);if(a){const o=s[r];n[a]=[o[0]/e,o[1]/e]}}),n}catch{return}})}function ta(){return Yn}function ia(){return Zn}var st,sa=class{constructor(t,e){this.context=t,H(this,st),this.config=na(e),this.player=new Kt(t,e),this.group=Ai(),x(this,st,!1);const i=ra(this.config.instrumentUrl,this.config.loopDataUrl,this.player.buffers,this.group);this.load=i(t,this.config.storage).then(n=>(x(this,st,n),this));const s=t.createGain();s.gain.value=this.config.extraGain,this.player.output.addInsert(s)}get output(){return this.player.output}get hasLoops(){return B(this,st)}loaded(){return W(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}disconnect(){this.player.disconnect()}start(t){const e=Ln(this.group,typeof t=="object"?t:{note:t});return e?this.player.start(e):()=>{}}stop(t){return this.player.stop(t)}};st=new WeakMap;function ra(t,e,i,s){const n=Wn(t,i,s);return(r,a)=>W(this,null,function*(){const[o,c]=yield Promise.all([n(r,a),ea(e)]);return c&&s.regions.forEach(d=>{var l;const u=c[d.midiPitch];u&&((l=d.sample)!=null||(d.sample={}),d.sample.loop=!0,d.sample.loopStart=u[0],d.sample.loopEnd=u[1])}),!!c})}function na(t){var e,i,s,n;if(!t.instrument&&!t.instrumentUrl)throw Error("Soundfont: instrument or instrumentUrl is required");const r={kit:"MusyngKite",instrument:t.instrument,storage:(e=t.storage)!=null?e:gt,extraGain:(i=t.extraGain)!=null?i:5,loadLoopData:(s=t.loadLoopData)!=null?s:!1,loopDataUrl:t.loopDataUrl,instrumentUrl:(n=t.instrumentUrl)!=null?n:""};if(r.instrument&&r.instrument.startsWith("http")&&(console.warn("Use 'instrumentUrl' instead of 'instrument' to load from a URL"),r.instrumentUrl=r.instrument,r.instrument=void 0),r.instrumentUrl)(r.kit||r.instrument)&&console.warn("Soundfont: 'kit' and 'instrument' config parameters are ignored because 'instrumentUrl' is explicitly set.");else if(r.instrument)r.instrumentUrl=zn(r.instrument,r.kit);else throw Error("Soundfont: 'instrument' or 'instrumentUrl' configuration parameter is required");return r.loadLoopData&&r.instrument&&!r.loopDataUrl&&(r.loopDataUrl=Qn(r.instrument,r.kit)),r}var aa="https://danigb.github.io/samples/splendid-grand-piano",pi,Vs,oa=class{constructor(t,e){this.context=t,H(this,pi),this.options=Object.assign({baseUrl:aa,storage:gt,detune:0,volume:100,velocity:100,decayTime:.5},e),this.player=new Kt(t,this.options);const i=da(this.options.baseUrl,this.options.storage,this.options.notesToLoad);this.load=i(t,this.player.buffers).then(()=>this)}get output(){return this.player.output}get buffers(){return this.player.buffers}loaded(){return W(this,null,function*(){return console.warn("deprecated: use load instead"),this.load})}start(t){var e,i;const s=typeof t=="object"?ee({},t):{note:t},n=It(this,pi,Vs).call(this,s);return n?(s.note=n[0],s.stopId=(e=s.stopId)!=null?e:n[1],s.detune=n[2]+((i=s.detune)!=null?i:this.options.detune),this.player.start(s)):()=>{}}stop(t){var e;if(typeof t=="string")return this.player.stop((e=he(t))!=null?e:t);if(typeof t=="object"){const i=he(t.stopId);return this.player.stop(i!==void 0?be(ee({},t),{stopId:i}):t)}else return this.player.stop(t)}};pi=new WeakSet;Vs=function(t){var e;const i=he(t.note);if(!i)return;const s=(e=t.velocity)!=null?e:this.options.velocity,n=Rt.findIndex(a=>s>=a.vel_range[0]&&s<=a.vel_range[1]),r=Rt[n];if(r)return la(r.name,i,this.player.buffers)};function la(t,e,i){let s=0;for(;i[t+(e+s)]===void 0&&s<128;)s>0?s=-s:s=-s+1;return s===127?[t+e,e,0]:[t+(e+s),e,-s*100]}function da(t,e,i){var s;const n=(s=zt(["ogg","m4a"]))!=null?s:"ogg";let r=i?Rt.filter(a=>a.vel_range[0]<=i.velocityRange[1]&&a.vel_range[1]>=i.velocityRange[0]):Rt;return(a,o)=>W(this,null,function*(){for(const c of r){const d=i?c.samples.filter(l=>i.notes.includes(l[0])):c.samples;yield Promise.all(d.map(l=>W(this,[l],function*([u,h]){const f=`${t}/${h}.${n}`,p=yield ki(a,f,e);p&&(o[c.name+u]=p)})))}})}var Rt=[{name:"PPP",vel_range:[1,40],cutoff:1e3,samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"PP",vel_range:[41,67],samples:[[23,"PP-B-1"],[27,"PP-D#0"],[29,"PP-F0"],[31,"PP-G0"],[33,"PP-A0"],[35,"PP-B0"],[37,"PP-C#1"],[38,"PP-D1"],[40,"PP-E1"],[41,"PP-F1"],[43,"PP-G1"],[45,"PP-A1"],[47,"PP-B1"],[48,"PP-C2"],[50,"PP-D2"],[52,"PP-E2"],[53,"PP-F2"],[55,"PP-G2"],[56,"PP-G#2"],[57,"PP-A2"],[58,"PP-A#2"],[59,"PP-B2"],[60,"PP-C3"],[62,"PP-D3"],[64,"PP-E3"],[65,"PP-F3"],[67,"PP-G3"],[69,"PP-A3"],[71,"PP-B3"],[72,"PP-C4"],[74,"PP-D4"],[76,"PP-E4"],[77,"PP-F4"],[79,"PP-G4"],[80,"PP-G#4"],[81,"PP-A4"],[82,"PP-A#4"],[83,"PP-B4"],[85,"PP-C#5"],[86,"PP-D5"],[87,"PP-D#5"],[89,"PP-F5"],[90,"PP-F#5"],[91,"PP-G5"],[92,"PP-G#5"],[93,"PP-A5"],[94,"PP-A#5"],[95,"PP-B5"],[96,"PP-C6"],[97,"PP-C#6"],[98,"PP-D6"],[99,"PP-D#6"],[100,"PP-E6"],[101,"PP-F6"],[102,"PP-F#6"],[103,"PP-G6"],[104,"PP-G#6"],[105,"PP-A6"],[106,"PP-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MP",vel_range:[68,84],samples:[[23,"Mp-B-1"],[27,"Mp-D#0"],[29,"Mp-F0"],[31,"Mp-G0"],[33,"Mp-A0"],[35,"Mp-B0"],[37,"Mp-C#1"],[38,"Mp-D1"],[40,"Mp-E1"],[41,"Mp-F1"],[43,"Mp-G1"],[45,"Mp-A1"],[47,"Mp-B1"],[48,"Mp-C2"],[50,"Mp-D2"],[52,"Mp-E2"],[53,"Mp-F2"],[55,"Mp-G2"],[56,"Mp-G#2"],[57,"Mp-A2"],[58,"Mp-A#2"],[59,"Mp-B2"],[60,"Mp-C3"],[62,"Mp-D3"],[64,"Mp-E3"],[65,"Mp-F3"],[67,"Mp-G3"],[69,"Mp-A3"],[71,"Mp-B3"],[72,"Mp-C4"],[74,"Mp-D4"],[76,"Mp-E4"],[77,"Mp-F4"],[79,"Mp-G4"],[80,"Mp-G#4"],[81,"Mp-A4"],[82,"Mp-A#4"],[83,"Mp-B4"],[85,"Mp-C#5"],[86,"Mp-D5"],[87,"Mp-D#5"],[88,"Mp-E5"],[89,"Mp-F5"],[90,"Mp-F#5"],[91,"Mp-G5"],[92,"Mp-G#5"],[93,"Mp-A5"],[94,"Mp-A#5"],[95,"Mp-B5"],[96,"Mp-C6"],[97,"Mp-C#6"],[98,"Mp-D6"],[99,"Mp-D#6"],[100,"PP-E6"],[101,"Mp-F6"],[102,"Mp-F#6"],[103,"Mp-G6"],[104,"Mp-G#6"],[105,"Mp-A6"],[106,"Mp-A#6"],[107,"PP-B6"],[108,"PP-C7"]]},{name:"MF",vel_range:[85,100],samples:[[23,"Mf-B-1"],[27,"Mf-D#0"],[29,"Mf-F0"],[31,"Mf-G0"],[33,"Mf-A0"],[35,"Mf-B0"],[37,"Mf-C#1"],[38,"Mf-D1"],[40,"Mf-E1"],[41,"Mf-F1"],[43,"Mf-G1"],[45,"Mf-A1"],[47,"Mf-B1"],[48,"Mf-C2"],[50,"Mf-D2"],[52,"Mf-E2"],[53,"Mf-F2"],[55,"Mf-G2"],[56,"Mf-G#2"],[57,"Mf-A2"],[58,"Mf-A#2"],[59,"Mf-B2"],[60,"Mf-C3"],[62,"Mf-D3"],[64,"Mf-E3"],[65,"Mf-F3"],[67,"Mf-G3"],[69,"Mf-A3"],[71,"Mf-B3"],[72,"Mf-C4"],[74,"Mf-D4"],[76,"Mf-E4"],[77,"Mf-F4"],[79,"Mf-G4"],[80,"Mf-G#4"],[81,"Mf-A4"],[82,"Mf-A#4"],[83,"Mf-B4"],[85,"Mf-C#5"],[86,"Mf-D5"],[87,"Mf-D#5"],[88,"Mf-E5"],[89,"Mf-F5"],[90,"Mf-F#5"],[91,"Mf-G5"],[92,"Mf-G#5"],[93,"Mf-A5"],[94,"Mf-A#5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[101,"Mf-F6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"PP-C7"]]},{name:"FF",vel_range:[101,127],samples:[[23,"FF-B-1"],[27,"FF-D#0"],[29,"FF-F0"],[31,"FF-G0"],[33,"FF-A0"],[35,"FF-B0"],[37,"FF-C#1"],[38,"FF-D1"],[40,"FF-E1"],[41,"FF-F1"],[43,"FF-G1"],[45,"FF-A1"],[47,"FF-B1"],[48,"FF-C2"],[50,"FF-D2"],[52,"FF-E2"],[53,"FF-F2"],[55,"FF-G2"],[56,"FF-G#2"],[57,"FF-A2"],[58,"FF-A#2"],[59,"FF-B2"],[60,"FF-C3"],[62,"FF-D3"],[64,"FF-E3"],[65,"FF-F3"],[67,"FF-G3"],[69,"FF-A3"],[71,"FF-B3"],[72,"FF-C4"],[74,"FF-D4"],[76,"FF-E4"],[77,"FF-F4"],[79,"FF-G4"],[80,"FF-G#4"],[81,"FF-A4"],[82,"FF-A#4"],[83,"FF-B4"],[85,"FF-C#5"],[86,"FF-D5"],[88,"FF-E5"],[89,"FF-F5"],[91,"FF-G5"],[93,"FF-A5"],[95,"Mf-B5"],[96,"Mf-C6"],[97,"Mf-C#6"],[98,"Mf-D6"],[99,"Mf-D#6"],[100,"Mf-E6"],[102,"Mf-F#6"],[103,"Mf-G6"],[104,"Mf-G#6"],[105,"Mf-A6"],[106,"Mf-A#6"],[107,"Mf-B6"],[108,"Mf-C7"]]}];function js(t){const e=t.startsWith("/")?t.substring(1):t;return(window.location.pathname.startsWith("/sequenzia")?"/sequenzia/":"./")+e}function ca(){const t=document.getElementById("splash-modal"),e=document.getElementById("splash-logo");e&&(e.src=js("static/logo.png")),t==null||t.classList.remove("hidden")}function ua(t=1e3){const e=document.getElementById("splash-modal"),i=document.getElementById("footer-main"),s=document.getElementById("content-main");e&&setTimeout(()=>{e.style.opacity="0",e.style.transition="opacity 0.5s ease-out",setTimeout(()=>{e.classList.add("hidden"),e.style.opacity="1",i&&(i.classList.remove("content-hidden"),i.classList.add("content-visible")),s&&(s.classList.remove("content-hidden"),s.classList.add("content-visible"))},500)},t)}function fa(){const t=document.getElementById("splash-modal");return t?!t.classList.contains("hidden"):!1}let Ft=null,Ys=!1;function rt(t="Loading Sounds...",e="Please wait while we dial it in.",i,s){if(fa()||Zs()&&!s)return;s&&(Ot(),yi(!0));const n=document.getElementById("loading-modal"),r=document.getElementById("loading-modal-title"),a=document.getElementById("loading-modal-subtext"),o=document.getElementById("loading-modal-cancel");r&&(r.textContent=t),a&&(a.textContent=e),o&&(i?(o.classList.remove("hidden"),Ft=()=>{i(),yi(!1),Ot()},o.onclick=Ft):(o.classList.add("hidden"),o.onclick=null,Ft=null)),n&&n.classList.remove("hidden")}function Ot(t){if(t&&yi(!1),Zs())return;const e=document.getElementById("loading-modal"),i=document.getElementById("loading-modal-cancel");e&&e.classList.add("hidden"),i&&(i.classList.add("hidden"),i.onclick=null),Ft=null}function yi(t){Ys=t}function Zs(){return Ys}let lt=0;function Qs(){lt++,lt===1&&rt()}function er(){lt--,lt<=0&&(lt=0,Ot())}async function ha(t){Qs();try{return await t}finally{er()}}const si=new Map;async function ma(t,e){e?await t.load:await ba(t.load)}async function Wt(t,e=X(),i=null,s,n,r,a=!0){var S;const o=t.split("/");let c="sf2",d="musyngkite",l="acoustic_grand_piano";o.length===3?[c,d,l]=o:o.length===2?[d,l]=o:o.length===1&&(l=o[0]);const u=e instanceof OfflineAudioContext;si.has(e)||si.set(e,new Map);const h=si.get(e),f=String(e??X()),p=`${d}/${l}@${f}`;if(a&&h.has(p))return h.get(p);const g=Math.max(0,Math.min(127,Math.round((s??1)*127))),y=e.createStereoPanner();n!==void 0&&(y.pan.value=n);const m=e.createGain();m.connect(y),i&&i.context!==e&&(console.warn("[loadInstrument] Ignoring mismatched destination from different context"),i=null),y.connect(i||He(e));const _={instrument:l,volume:g,destination:m,disableScheduler:u};let v;if(d==="smolken")v=new Kn(e,_);else if(d==="splendidgrandpiano")v=new oa(e,_);else if(d==="mallets")v=new Jn(e,_);else if(d==="drummachines")v=new Cn(e,_);else{const C={"fluidr3-gm":"FluidR3_GM",fatboy:"FatBoy",musyngkite:"MusyngKite"}[d.toLowerCase()]||"MusyngKite",E=`https://gleitz.github.io/midi-js-soundfonts/${C}/${l}-ogg.js`;v=new sa(e,{..._,instrumentUrl:E,kit:C})}if(await ma(v,r??!1),d==="drummachines"){const N=((S=v.getSampleNames)==null?void 0:S.call(v))??[],C=new Map;N.forEach((M,E)=>{const k=36+E;C.set(k,M)}),v.__midiMap=C}const b=v;return b.setVolume=N=>{var M;const C=Math.max(0,Math.min(127,Math.round(N*127)));"output"in b&&typeof((M=b.output)==null?void 0:M.setVolume)=="function"&&b.output.setVolume(C)},b.setPan=N=>{y.pan.value=Math.max(-1,Math.min(1,N))},a&&h.set(p,b),b}async function pa(){const e=ya().map(s=>{switch(s){case"FluidR3_GM":return"fluidr3-gm";case"FatBoy":return"fatboy";case"MusyngKite":return"musyngkite";default:return s.toLowerCase()}}),i=["splendidgrandpiano","mallets","drummachines","smolken"];return[...new Set([...e,...i])]}function ya(){const e=[...ta()];return e.includes("FatBoy")||e.push("FatBoy"),e}async function _a(t){const e=t.toLowerCase();return e==="splendidgrandpiano"?["splendidgrandpiano"]:e==="mallets"?qn():e==="drummachines"?Hs():e==="smolken"?Hn():(await Wt(`${t}/acoustic_grand_piano`,X(),null,0,0,!0),ia()??[])}function ga(){return Hs()}async function ba(t){Qs();try{await t}finally{er()}}function va(){return{name:"sf2",loadInstrument:Wt,getAvailableLibraries:pa,getAvailableInstruments:_a}}let ri=null,St=null;function Fe(){return ri||(ri=new AudioContext),ri}function Sa(){if(!St){const t=Fe();St=t.createGain(),St.connect(t.destination)}return St}const Na={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function K(t){const e=t==null?void 0:t.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,i,s,n]=e,r=i.toUpperCase(),a=Na[r];if(a===void 0)return null;const o=[...s].reduce((d,l)=>l==="#"?d+1:l==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}let re=null,_i=null;async function Ca(t){if(_i===t)return;re=await Wt(t,Fe()),_i=t}function Ma(){return _i}function Ba(t,e=100,i=!1){var o;if(!re)return null;const n=Fe().currentTime,r=K(t);if(r===null)return null;const a=((o=re.__midiMap)==null?void 0:o.get(r))??r;return re.start({note:a,stopId:a,velocity:e,time:n,loop:i}),()=>{re==null||re.stop({stopId:a})}}function wa(t){var s;if(!re)return;const e=K(t);if(e===null)return;const i=((s=re.__midiMap)==null?void 0:s.get(e))??e;re.stop({stopId:i})}async function La(t,e,i,s=100,n=!1,r=null,a=null,o=null,c,d){var p;const l=a||X(),u=await Wt(t,l,o,c,d);c!==void 0&&u.setVolume&&u.setVolume(c),d!==void 0&&u.setPan&&u.setPan(d);const h=K(e);if(h===null)return null;const f=((p=u.__midiMap)==null?void 0:p.get(h))??h;return u.start({note:f,duration:i,velocity:s,loop:n,time:r??l.currentTime}),null}function Ga(){return{name:"sf2",setActiveInstrument:Ca,getActiveInstrumentName:Ma,playNote:Ba,stopNoteByPitch:wa,loadAndPlayNote:La}}const mt=[{id:"0000_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Grand Piano"},{id:"0000_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Grand Piano"},{id:"0000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Grand Piano"},{id:"0000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Grand Piano"},{id:"0000_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Grand Piano"},{id:"0000_SBLive_sf2",library:"SBLive",displayName:"Acoustic Grand Piano"},{id:"0000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Grand Piano"},{id:"0010_Aspirin_sf2_file",library:"Aspirin",displayName:"Bright Acoustic Piano"},{id:"0010_Chaos_sf2_file",library:"Chaos",displayName:"Bright Acoustic Piano"},{id:"0010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bright Acoustic Piano"},{id:"0010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bright Acoustic Piano"},{id:"0010_JCLive_sf2_file",library:"JCLive",displayName:"Bright Acoustic Piano"},{id:"0010_SBLive_sf2",library:"SBLive",displayName:"Bright Acoustic Piano"},{id:"0010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bright Acoustic Piano"},{id:"0020_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Grand Piano"},{id:"0020_Chaos_sf2_file",library:"Chaos",displayName:"Electric Grand Piano"},{id:"0020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Grand Piano"},{id:"0020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Grand Piano"},{id:"0020_JCLive_sf2_file",library:"JCLive",displayName:"Electric Grand Piano"},{id:"0020_SBLive_sf2",library:"SBLive",displayName:"Electric Grand Piano"},{id:"0020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Grand Piano"},{id:"0050_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Piano 2"},{id:"0050_Chaos_sf2_file",library:"Chaos",displayName:"Electric Piano 2"},{id:"0050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Piano 2"},{id:"0050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Piano 2"},{id:"0050_JCLive_sf2_file",library:"JCLive",displayName:"Electric Piano 2"},{id:"0050_SBLive_sf2",library:"SBLive",displayName:"Electric Piano 2"},{id:"0050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Piano 2"},{id:"0060_Aspirin_sf2_file",library:"Aspirin",displayName:"Harpsichord"},{id:"0060_Chaos_sf2_file",library:"Chaos",displayName:"Harpsichord"},{id:"0060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harpsichord"},{id:"0060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harpsichord"},{id:"0060_JCLive_sf2_file",library:"JCLive",displayName:"Harpsichord"},{id:"0060_SBLive_sf2",library:"SBLive",displayName:"Harpsichord"},{id:"0060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harpsichord"},{id:"0070_Aspirin_sf2_file",library:"Aspirin",displayName:"Clavinet"},{id:"0070_Chaos_sf2_file",library:"Chaos",displayName:"Clavinet"},{id:"0070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clavinet"},{id:"0070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clavinet"},{id:"0070_JCLive_sf2_file",library:"JCLive",displayName:"Clavinet"},{id:"0070_SBLive_sf2",library:"SBLive",displayName:"Clavinet"},{id:"0070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clavinet"},{id:"0080_Aspirin_sf2_file",library:"Aspirin",displayName:"Celesta"},{id:"0080_Chaos_sf2_file",library:"Chaos",displayName:"Celesta"},{id:"0080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Celesta"},{id:"0080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Celesta"},{id:"0080_JCLive_sf2_file",library:"JCLive",displayName:"Celesta"},{id:"0080_SBLive_sf2",library:"SBLive",displayName:"Celesta"},{id:"0080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Celesta"},{id:"0090_Aspirin_sf2_file",library:"Aspirin",displayName:"Glockenspiel"},{id:"0090_Chaos_sf2_file",library:"Chaos",displayName:"Glockenspiel"},{id:"0090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Glockenspiel"},{id:"0090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Glockenspiel"},{id:"0090_JCLive_sf2_file",library:"JCLive",displayName:"Glockenspiel"},{id:"0090_SBLive_sf2",library:"SBLive",displayName:"Glockenspiel"},{id:"0090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Glockenspiel"},{id:"0100_Aspirin_sf2_file",library:"Aspirin",displayName:"Music Box"},{id:"0100_Chaos_sf2_file",library:"Chaos",displayName:"Music Box"},{id:"0100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Music Box"},{id:"0100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Music Box"},{id:"0100_JCLive_sf2_file",library:"JCLive",displayName:"Music Box"},{id:"0100_SBLive_sf2",library:"SBLive",displayName:"Music Box"},{id:"0100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Music Box"},{id:"0110_Aspirin_sf2_file",library:"Aspirin",displayName:"Vibraphone"},{id:"0110_Chaos_sf2_file",library:"Chaos",displayName:"Vibraphone"},{id:"0110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Vibraphone"},{id:"0110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Vibraphone"},{id:"0110_JCLive_sf2_file",library:"JCLive",displayName:"Vibraphone"},{id:"0110_SBLive_sf2",library:"SBLive",displayName:"Vibraphone"},{id:"0110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Vibraphone"},{id:"0120_Aspirin_sf2_file",library:"Aspirin",displayName:"Marimba"},{id:"0120_Chaos_sf2_file",library:"Chaos",displayName:"Marimba"},{id:"0120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Marimba"},{id:"0120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Marimba"},{id:"0120_JCLive_sf2_file",library:"JCLive",displayName:"Marimba"},{id:"0120_SBLive_sf2",library:"SBLive",displayName:"Marimba"},{id:"0120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Marimba"},{id:"0130_Aspirin_sf2_file",library:"Aspirin",displayName:"Xylophone"},{id:"0130_Chaos_sf2_file",library:"Chaos",displayName:"Xylophone"},{id:"0130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Xylophone"},{id:"0130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Xylophone"},{id:"0130_JCLive_sf2_file",library:"JCLive",displayName:"Xylophone"},{id:"0130_SBLive_sf2",library:"SBLive",displayName:"Xylophone"},{id:"0130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Xylophone"},{id:"0140_Aspirin_sf2_file",library:"Aspirin",displayName:"Tubular Bells"},{id:"0140_Chaos_sf2_file",library:"Chaos",displayName:"Tubular Bells"},{id:"0140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tubular Bells"},{id:"0140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tubular Bells"},{id:"0140_JCLive_sf2_file",library:"JCLive",displayName:"Tubular Bells"},{id:"0140_SBLive_sf2",library:"SBLive",displayName:"Tubular Bells"},{id:"0140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tubular Bells"},{id:"0150_Aspirin_sf2_file",library:"Aspirin",displayName:"Dulcimer"},{id:"0150_Chaos_sf2_file",library:"Chaos",displayName:"Dulcimer"},{id:"0150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Dulcimer"},{id:"0150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Dulcimer"},{id:"0150_JCLive_sf2_file",library:"JCLive",displayName:"Dulcimer"},{id:"0150_SBLive_sf2",library:"SBLive",displayName:"Dulcimer"},{id:"0150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Dulcimer"},{id:"0160_Aspirin_sf2_file",library:"Aspirin",displayName:"Drawbar Organ"},{id:"0160_Chaos_sf2_file",library:"Chaos",displayName:"Drawbar Organ"},{id:"0160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drawbar Organ"},{id:"0160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Drawbar Organ"},{id:"0160_JCLive_sf2_file",library:"JCLive",displayName:"Drawbar Organ"},{id:"0160_SBLive_sf2",library:"SBLive",displayName:"Drawbar Organ"},{id:"0160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Drawbar Organ"},{id:"0170_Aspirin_sf2_file",library:"Aspirin",displayName:"Percussive Organ"},{id:"0170_Chaos_sf2_file",library:"Chaos",displayName:"Percussive Organ"},{id:"0170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Percussive Organ"},{id:"0170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Percussive Organ"},{id:"0170_JCLive_sf2_file",library:"JCLive",displayName:"Percussive Organ"},{id:"0170_SBLive_sf2",library:"SBLive",displayName:"Percussive Organ"},{id:"0170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Percussive Organ"},{id:"0180_Aspirin_sf2_file",library:"Aspirin",displayName:"Rock Organ"},{id:"0180_Chaos_sf2_file",library:"Chaos",displayName:"Rock Organ"},{id:"0180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Rock Organ"},{id:"0180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Rock Organ"},{id:"0180_JCLive_sf2_file",library:"JCLive",displayName:"Rock Organ"},{id:"0180_SBLive_sf2",library:"SBLive",displayName:"Rock Organ"},{id:"0180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Rock Organ"},{id:"0190_Aspirin_sf2_file",library:"Aspirin",displayName:"Church Organ"},{id:"0190_Chaos_sf2_file",library:"Chaos",displayName:"Church Organ"},{id:"0190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Church Organ"},{id:"0190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Church Organ"},{id:"0190_JCLive_sf2_file",library:"JCLive",displayName:"Church Organ"},{id:"0190_SBLive_sf2",library:"SBLive",displayName:"Church Organ"},{id:"0190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Church Organ"},{id:"0200_Aspirin_sf2_file",library:"Aspirin",displayName:"Reed Organ"},{id:"0200_Chaos_sf2_file",library:"Chaos",displayName:"Reed Organ"},{id:"0200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reed Organ"},{id:"0200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reed Organ"},{id:"0200_JCLive_sf2_file",library:"JCLive",displayName:"Reed Organ"},{id:"0200_SBLive_sf2",library:"SBLive",displayName:"Reed Organ"},{id:"0200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reed Organ"},{id:"0210_Aspirin_sf2_file",library:"Aspirin",displayName:"Accordion"},{id:"0210_Chaos_sf2_file",library:"Chaos",displayName:"Accordion"},{id:"0210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Accordion"},{id:"0210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Accordion"},{id:"0210_JCLive_sf2_file",library:"JCLive",displayName:"Accordion"},{id:"0210_SBLive_sf2",library:"SBLive",displayName:"Accordion"},{id:"0210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Accordion"},{id:"0220_Aspirin_sf2_file",library:"Aspirin",displayName:"Harmonica"},{id:"0220_Chaos_sf2_file",library:"Chaos",displayName:"Harmonica"},{id:"0220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harmonica"},{id:"0220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harmonica"},{id:"0220_JCLive_sf2_file",library:"JCLive",displayName:"Harmonica"},{id:"0220_SBLive_sf2",library:"SBLive",displayName:"Harmonica"},{id:"0220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harmonica"},{id:"0230_Aspirin_sf2_file",library:"Aspirin",displayName:"Tango Accordion"},{id:"0230_Chaos_sf2_file",library:"Chaos",displayName:"Tango Accordion"},{id:"0230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tango Accordion"},{id:"0230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tango Accordion"},{id:"0230_JCLive_sf2_file",library:"JCLive",displayName:"Tango Accordion"},{id:"0230_SBLive_sf2",library:"SBLive",displayName:"Tango Accordion"},{id:"0230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tango Accordion"},{id:"0240_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (nylon)"},{id:"0240_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (nylon)"},{id:"0240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (nylon)"},{id:"0240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (nylon)"},{id:"0240_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (nylon)"},{id:"0250_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (steel)"},{id:"0250_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (steel)"},{id:"0250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (steel)"},{id:"0250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (steel)"},{id:"0250_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (steel)"},{id:"0260_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (jazz)"},{id:"0260_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (jazz)"},{id:"0260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (jazz)"},{id:"0260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (jazz)"},{id:"0260_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (jazz)"},{id:"0270_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (clean)"},{id:"0270_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (clean)"},{id:"0270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (clean)"},{id:"0270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (clean)"},{id:"0270_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (clean)"},{id:"0270_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (clean)"},{id:"0270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (clean)"},{id:"0280_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (muted)"},{id:"0280_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (muted)"},{id:"0280_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (muted)"},{id:"0280_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (muted)"},{id:"0280_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (muted)"},{id:"0280_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (muted)"},{id:"0280_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (muted)"},{id:"0290_Aspirin_sf2_file",library:"Aspirin",displayName:"Overdriven Guitar"},{id:"0290_Chaos_sf2_file",library:"Chaos",displayName:"Overdriven Guitar"},{id:"0290_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Overdriven Guitar"},{id:"0290_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Overdriven Guitar"},{id:"0290_JCLive_sf2_file",library:"JCLive",displayName:"Overdriven Guitar"},{id:"0290_SBLive_sf2",library:"SBLive",displayName:"Overdriven Guitar"},{id:"0290_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Overdriven Guitar"},{id:"0300_Aspirin_sf2_file",library:"Aspirin",displayName:"Distortion Guitar"},{id:"0300_Chaos_sf2_file",library:"Chaos",displayName:"Distortion Guitar"},{id:"0300_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Distortion Guitar"},{id:"0300_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Distortion Guitar"},{id:"0300_JCLive_sf2_file",library:"JCLive",displayName:"Distortion Guitar"},{id:"0300_SBLive_sf2",library:"SBLive",displayName:"Distortion Guitar"},{id:"0300_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Distortion Guitar"},{id:"0310_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Harmonics"},{id:"0310_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Harmonics"},{id:"0310_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Harmonics"},{id:"0310_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Harmonics"},{id:"0310_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Harmonics"},{id:"0310_SBLive_sf2",library:"SBLive",displayName:"Guitar Harmonics"},{id:"0310_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Harmonics"},{id:"0320_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Bass"},{id:"0320_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Bass"},{id:"0320_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Bass"},{id:"0320_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Bass"},{id:"0320_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Bass"},{id:"0320_SBLive_sf2",library:"SBLive",displayName:"Acoustic Bass"},{id:"0320_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Bass"},{id:"0330_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (finger)"},{id:"0330_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (finger)"},{id:"0330_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (finger)"},{id:"0330_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (finger)"},{id:"0330_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (finger)"},{id:"0330_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (finger)"},{id:"0330_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (finger)"},{id:"0340_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (pick)"},{id:"0340_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (pick)"},{id:"0340_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (pick)"},{id:"0340_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (pick)"},{id:"0340_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (pick)"},{id:"0340_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (pick)"},{id:"0340_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (pick)"},{id:"0350_Aspirin_sf2_file",library:"Aspirin",displayName:"Fretless Bass"},{id:"0350_Chaos_sf2_file",library:"Chaos",displayName:"Fretless Bass"},{id:"0350_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fretless Bass"},{id:"0350_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fretless Bass"},{id:"0350_JCLive_sf2_file",library:"JCLive",displayName:"Fretless Bass"},{id:"0350_SBLive_sf2",library:"SBLive",displayName:"Fretless Bass"},{id:"0350_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fretless Bass"},{id:"0360_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 1"},{id:"0360_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 1"},{id:"0360_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 1"},{id:"0360_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 1"},{id:"0360_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 1"},{id:"0360_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 1"},{id:"0360_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 1"},{id:"0370_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 2"},{id:"0370_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 2"},{id:"0370_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 2"},{id:"0370_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 2"},{id:"0370_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 2"},{id:"0370_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 2"},{id:"0370_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 2"},{id:"0380_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 1"},{id:"0380_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 1"},{id:"0380_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 1"},{id:"0380_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 1"},{id:"0380_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 1"},{id:"0380_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 1"},{id:"0380_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 1"},{id:"0390_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 2"},{id:"0390_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 2"},{id:"0390_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 2"},{id:"0390_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 2"},{id:"0390_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 2"},{id:"0390_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 2"},{id:"0390_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 2"},{id:"0400_Aspirin_sf2_file",library:"Aspirin",displayName:"Violin"},{id:"0400_Chaos_sf2_file",library:"Chaos",displayName:"Violin"},{id:"0400_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Violin"},{id:"0400_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Violin"},{id:"0400_JCLive_sf2_file",library:"JCLive",displayName:"Violin"},{id:"0400_SBLive_sf2",library:"SBLive",displayName:"Violin"},{id:"0400_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Violin"},{id:"0410_Aspirin_sf2_file",library:"Aspirin",displayName:"Viola"},{id:"0410_Chaos_sf2_file",library:"Chaos",displayName:"Viola"},{id:"0410_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Viola"},{id:"0410_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Viola"},{id:"0410_JCLive_sf2_file",library:"JCLive",displayName:"Viola"},{id:"0410_SBLive_sf2",library:"SBLive",displayName:"Viola"},{id:"0410_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Viola"},{id:"0420_Aspirin_sf2_file",library:"Aspirin",displayName:"Cello"},{id:"0420_Chaos_sf2_file",library:"Chaos",displayName:"Cello"},{id:"0420_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Cello"},{id:"0420_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Cello"},{id:"0420_JCLive_sf2_file",library:"JCLive",displayName:"Cello"},{id:"0420_SBLive_sf2",library:"SBLive",displayName:"Cello"},{id:"0420_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Cello"},{id:"0430_Aspirin_sf2_file",library:"Aspirin",displayName:"Contrabass"},{id:"0430_Chaos_sf2_file",library:"Chaos",displayName:"Contrabass"},{id:"0430_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Contrabass"},{id:"0430_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Contrabass"},{id:"0430_JCLive_sf2_file",library:"JCLive",displayName:"Contrabass"},{id:"0430_SBLive_sf2",library:"SBLive",displayName:"Contrabass"},{id:"0430_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Contrabass"},{id:"0440_Aspirin_sf2_file",library:"Aspirin",displayName:"Tremolo Strings"},{id:"0440_Chaos_sf2_file",library:"Chaos",displayName:"Tremolo Strings"},{id:"0440_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tremolo Strings"},{id:"0440_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tremolo Strings"},{id:"0440_JCLive_sf2_file",library:"JCLive",displayName:"Tremolo Strings"},{id:"0440_SBLive_sf2",library:"SBLive",displayName:"Tremolo Strings"},{id:"0440_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tremolo Strings"},{id:"0450_Aspirin_sf2_file",library:"Aspirin",displayName:"Pizzicato Strings"},{id:"0450_Chaos_sf2_file",library:"Chaos",displayName:"Pizzicato Strings"},{id:"0450_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pizzicato Strings"},{id:"0450_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pizzicato Strings"},{id:"0450_JCLive_sf2_file",library:"JCLive",displayName:"Pizzicato Strings"},{id:"0450_SBLive_sf2",library:"SBLive",displayName:"Pizzicato Strings"},{id:"0450_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pizzicato Strings"},{id:"0460_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestral Harp"},{id:"0460_Chaos_sf2_file",library:"Chaos",displayName:"Orchestral Harp"},{id:"0460_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestral Harp"},{id:"0460_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestral Harp"},{id:"0460_JCLive_sf2_file",library:"JCLive",displayName:"Orchestral Harp"},{id:"0460_SBLive_sf2",library:"SBLive",displayName:"Orchestral Harp"},{id:"0460_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestral Harp"},{id:"0470_Aspirin_sf2_file",library:"Aspirin",displayName:"Timpani"},{id:"0470_Chaos_sf2_file",library:"Chaos",displayName:"Timpani"},{id:"0470_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Timpani"},{id:"0470_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Timpani"},{id:"0470_JCLive_sf2_file",library:"JCLive",displayName:"Timpani"},{id:"0470_SBLive_sf2",library:"SBLive",displayName:"Timpani"},{id:"0470_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Timpani"},{id:"0480_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 1"},{id:"0480_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 1"},{id:"0480_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 1"},{id:"0480_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 1"},{id:"0480_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 1"},{id:"0480_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 1"},{id:"0480_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 1"},{id:"0490_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 2"},{id:"0490_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 2"},{id:"0490_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 2"},{id:"0490_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 2"},{id:"0490_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 2"},{id:"0490_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 2"},{id:"0490_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 2"},{id:"0500_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 1"},{id:"0500_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 1"},{id:"0500_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 1"},{id:"0500_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 1"},{id:"0500_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 1"},{id:"0500_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 1"},{id:"0500_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 1"},{id:"0510_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 2"},{id:"0510_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 2"},{id:"0510_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 2"},{id:"0510_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 2"},{id:"0510_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 2"},{id:"0510_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 2"},{id:"0510_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 2"},{id:"0520_Aspirin_sf2_file",library:"Aspirin",displayName:"Choir Aahs"},{id:"0520_Chaos_sf2_file",library:"Chaos",displayName:"Choir Aahs"},{id:"0520_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Choir Aahs"},{id:"0520_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Choir Aahs"},{id:"0520_JCLive_sf2_file",library:"JCLive",displayName:"Choir Aahs"},{id:"0520_SBLive_sf2",library:"SBLive",displayName:"Choir Aahs"},{id:"0520_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Choir Aahs"},{id:"0530_Aspirin_sf2_file",library:"Aspirin",displayName:"Voice Oohs"},{id:"0530_Chaos_sf2_file",library:"Chaos",displayName:"Voice Oohs"},{id:"0530_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Voice Oohs"},{id:"0530_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Voice Oohs"},{id:"0530_JCLive_sf2_file",library:"JCLive",displayName:"Voice Oohs"},{id:"0530_SBLive_sf2",library:"SBLive",displayName:"Voice Oohs"},{id:"0530_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Voice Oohs"},{id:"0540_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Choir"},{id:"0540_Chaos_sf2_file",library:"Chaos",displayName:"Synth Choir"},{id:"0540_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Choir"},{id:"0540_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Choir"},{id:"0540_JCLive_sf2_file",library:"JCLive",displayName:"Synth Choir"},{id:"0540_SBLive_sf2",library:"SBLive",displayName:"Synth Choir"},{id:"0540_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Choir"},{id:"0550_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestra Hit"},{id:"0550_Chaos_sf2_file",library:"Chaos",displayName:"Orchestra Hit"},{id:"0550_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestra Hit"},{id:"0550_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestra Hit"},{id:"0550_JCLive_sf2_file",library:"JCLive",displayName:"Orchestra Hit"},{id:"0550_SBLive_sf2",library:"SBLive",displayName:"Orchestra Hit"},{id:"0550_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestra Hit"},{id:"0560_Aspirin_sf2_file",library:"Aspirin",displayName:"Trumpet"},{id:"0560_Chaos_sf2_file",library:"Chaos",displayName:"Trumpet"},{id:"0560_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trumpet"},{id:"0560_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trumpet"},{id:"0560_JCLive_sf2_file",library:"JCLive",displayName:"Trumpet"},{id:"0560_SBLive_sf2",library:"SBLive",displayName:"Trumpet"},{id:"0560_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trumpet"},{id:"0570_Aspirin_sf2_file",library:"Aspirin",displayName:"Trombone"},{id:"0570_Chaos_sf2_file",library:"Chaos",displayName:"Trombone"},{id:"0570_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trombone"},{id:"0570_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trombone"},{id:"0570_JCLive_sf2_file",library:"JCLive",displayName:"Trombone"},{id:"0570_SBLive_sf2",library:"SBLive",displayName:"Trombone"},{id:"0570_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trombone"},{id:"0580_Aspirin_sf2_file",library:"Aspirin",displayName:"Tuba"},{id:"0580_Chaos_sf2_file",library:"Chaos",displayName:"Tuba"},{id:"0580_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tuba"},{id:"0580_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tuba"},{id:"0580_JCLive_sf2_file",library:"JCLive",displayName:"Tuba"},{id:"0580_SBLive_sf2",library:"SBLive",displayName:"Tuba"},{id:"0580_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tuba"},{id:"0590_Aspirin_sf2_file",library:"Aspirin",displayName:"Muted Trumpet"},{id:"0590_Chaos_sf2_file",library:"Chaos",displayName:"Muted Trumpet"},{id:"0590_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Muted Trumpet"},{id:"0590_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Muted Trumpet"},{id:"0590_JCLive_sf2_file",library:"JCLive",displayName:"Muted Trumpet"},{id:"0590_SBLive_sf2",library:"SBLive",displayName:"Muted Trumpet"},{id:"0590_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Muted Trumpet"},{id:"0600_Aspirin_sf2_file",library:"Aspirin",displayName:"French Horn"},{id:"0600_Chaos_sf2_file",library:"Chaos",displayName:"French Horn"},{id:"0600_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"French Horn"},{id:"0600_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"French Horn"},{id:"0600_JCLive_sf2_file",library:"JCLive",displayName:"French Horn"},{id:"0600_SBLive_sf2",library:"SBLive",displayName:"French Horn"},{id:"0600_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"French Horn"},{id:"0610_Aspirin_sf2_file",library:"Aspirin",displayName:"Brass Section"},{id:"0610_Chaos_sf2_file",library:"Chaos",displayName:"Brass Section"},{id:"0610_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Brass Section"},{id:"0610_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Brass Section"},{id:"0610_JCLive_sf2_file",library:"JCLive",displayName:"Brass Section"},{id:"0610_SBLive_sf2",library:"SBLive",displayName:"Brass Section"},{id:"0610_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Brass Section"},{id:"0620_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 1"},{id:"0620_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 1"},{id:"0620_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 1"},{id:"0620_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 1"},{id:"0620_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 1"},{id:"0620_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 1"},{id:"0620_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 1"},{id:"0630_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 2"},{id:"0630_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 2"},{id:"0630_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 2"},{id:"0630_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 2"},{id:"0630_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 2"},{id:"0630_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 2"},{id:"0630_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 2"},{id:"0640_Aspirin_sf2_file",library:"Aspirin",displayName:"Soprano Sax"},{id:"0640_Chaos_sf2_file",library:"Chaos",displayName:"Soprano Sax"},{id:"0640_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Soprano Sax"},{id:"0640_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Soprano Sax"},{id:"0640_JCLive_sf2_file",library:"JCLive",displayName:"Soprano Sax"},{id:"0640_SBLive_sf2",library:"SBLive",displayName:"Soprano Sax"},{id:"0640_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Soprano Sax"},{id:"0650_Aspirin_sf2_file",library:"Aspirin",displayName:"Alto Sax"},{id:"0650_Chaos_sf2_file",library:"Chaos",displayName:"Alto Sax"},{id:"0650_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Alto Sax"},{id:"0650_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Alto Sax"},{id:"0650_JCLive_sf2_file",library:"JCLive",displayName:"Alto Sax"},{id:"0650_SBLive_sf2",library:"SBLive",displayName:"Alto Sax"},{id:"0650_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Alto Sax"},{id:"0660_Aspirin_sf2_file",library:"Aspirin",displayName:"Tenor Sax"},{id:"0660_Chaos_sf2_file",library:"Chaos",displayName:"Tenor Sax"},{id:"0660_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tenor Sax"},{id:"0660_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tenor Sax"},{id:"0660_JCLive_sf2_file",library:"JCLive",displayName:"Tenor Sax"},{id:"0660_SBLive_sf2",library:"SBLive",displayName:"Tenor Sax"},{id:"0660_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tenor Sax"},{id:"0670_Aspirin_sf2_file",library:"Aspirin",displayName:"Baritone Sax"},{id:"0670_Chaos_sf2_file",library:"Chaos",displayName:"Baritone Sax"},{id:"0670_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Baritone Sax"},{id:"0670_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Baritone Sax"},{id:"0670_JCLive_sf2_file",library:"JCLive",displayName:"Baritone Sax"},{id:"0670_SBLive_sf2",library:"SBLive",displayName:"Baritone Sax"},{id:"0670_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Baritone Sax"},{id:"0680_Aspirin_sf2_file",library:"Aspirin",displayName:"Oboe"},{id:"0680_Chaos_sf2_file",library:"Chaos",displayName:"Oboe"},{id:"0680_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Oboe"},{id:"0680_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Oboe"},{id:"0680_JCLive_sf2_file",library:"JCLive",displayName:"Oboe"},{id:"0680_SBLive_sf2",library:"SBLive",displayName:"Oboe"},{id:"0680_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Oboe"},{id:"0690_Aspirin_sf2_file",library:"Aspirin",displayName:"English Horn"},{id:"0690_Chaos_sf2_file",library:"Chaos",displayName:"English Horn"},{id:"0690_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"English Horn"},{id:"0690_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"English Horn"},{id:"0690_JCLive_sf2_file",library:"JCLive",displayName:"English Horn"},{id:"0690_SBLive_sf2",library:"SBLive",displayName:"English Horn"},{id:"0690_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"English Horn"},{id:"0700_Aspirin_sf2_file",library:"Aspirin",displayName:"Bassoon"},{id:"0700_Chaos_sf2_file",library:"Chaos",displayName:"Bassoon"},{id:"0700_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bassoon"},{id:"0700_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bassoon"},{id:"0700_JCLive_sf2_file",library:"JCLive",displayName:"Bassoon"},{id:"0700_SBLive_sf2",library:"SBLive",displayName:"Bassoon"},{id:"0700_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bassoon"},{id:"0710_Aspirin_sf2_file",library:"Aspirin",displayName:"Clarinet"},{id:"0710_Chaos_sf2_file",library:"Chaos",displayName:"Clarinet"},{id:"0710_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clarinet"},{id:"0710_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clarinet"},{id:"0710_JCLive_sf2_file",library:"JCLive",displayName:"Clarinet"},{id:"0710_SBLive_sf2",library:"SBLive",displayName:"Clarinet"},{id:"0710_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clarinet"},{id:"0720_Aspirin_sf2_file",library:"Aspirin",displayName:"Piccolo"},{id:"0720_Chaos_sf2_file",library:"Chaos",displayName:"Piccolo"},{id:"0720_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Piccolo"},{id:"0720_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Piccolo"},{id:"0720_JCLive_sf2_file",library:"JCLive",displayName:"Piccolo"},{id:"0720_SBLive_sf2",library:"SBLive",displayName:"Piccolo"},{id:"0720_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Piccolo"},{id:"0730_Aspirin_sf2_file",library:"Aspirin",displayName:"Flute"},{id:"0730_Chaos_sf2_file",library:"Chaos",displayName:"Flute"},{id:"0730_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Flute"},{id:"0730_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Flute"},{id:"0730_JCLive_sf2_file",library:"JCLive",displayName:"Flute"},{id:"0730_SBLive_sf2",library:"SBLive",displayName:"Flute"},{id:"0730_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Flute"},{id:"0740_Aspirin_sf2_file",library:"Aspirin",displayName:"Recorder"},{id:"0740_Chaos_sf2_file",library:"Chaos",displayName:"Recorder"},{id:"0740_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Recorder"},{id:"0740_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Recorder"},{id:"0740_JCLive_sf2_file",library:"JCLive",displayName:"Recorder"},{id:"0740_SBLive_sf2",library:"SBLive",displayName:"Recorder"},{id:"0740_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Recorder"},{id:"0750_Aspirin_sf2_file",library:"Aspirin",displayName:"Pan Flute"},{id:"0750_Chaos_sf2_file",library:"Chaos",displayName:"Pan Flute"},{id:"0750_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pan Flute"},{id:"0750_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pan Flute"},{id:"0750_JCLive_sf2_file",library:"JCLive",displayName:"Pan Flute"},{id:"0750_SBLive_sf2",library:"SBLive",displayName:"Pan Flute"},{id:"0750_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pan Flute"},{id:"0760_Aspirin_sf2_file",library:"Aspirin",displayName:"Blown Bottle"},{id:"0760_Chaos_sf2_file",library:"Chaos",displayName:"Blown Bottle"},{id:"0760_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Blown Bottle"},{id:"0760_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Blown Bottle"},{id:"0760_JCLive_sf2_file",library:"JCLive",displayName:"Blown Bottle"},{id:"0760_SBLive_sf2",library:"SBLive",displayName:"Blown Bottle"},{id:"0760_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Blown Bottle"},{id:"0770_Aspirin_sf2_file",library:"Aspirin",displayName:"Shakuhachi"},{id:"0770_Chaos_sf2_file",library:"Chaos",displayName:"Shakuhachi"},{id:"0770_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shakuhachi"},{id:"0770_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shakuhachi"},{id:"0770_JCLive_sf2_file",library:"JCLive",displayName:"Shakuhachi"},{id:"0770_SBLive_sf2",library:"SBLive",displayName:"Shakuhachi"},{id:"0770_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shakuhachi"},{id:"0780_Aspirin_sf2_file",library:"Aspirin",displayName:"Whistle"},{id:"0780_Chaos_sf2_file",library:"Chaos",displayName:"Whistle"},{id:"0780_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Whistle"},{id:"0780_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Whistle"},{id:"0780_JCLive_sf2_file",library:"JCLive",displayName:"Whistle"},{id:"0780_SBLive_sf2",library:"SBLive",displayName:"Whistle"},{id:"0780_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Whistle"},{id:"0790_Aspirin_sf2_file",library:"Aspirin",displayName:"Ocarina"},{id:"0790_Chaos_sf2_file",library:"Chaos",displayName:"Ocarina"},{id:"0790_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Ocarina"},{id:"0790_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Ocarina"},{id:"0790_JCLive_sf2_file",library:"JCLive",displayName:"Ocarina"},{id:"0790_SBLive_sf2",library:"SBLive",displayName:"Ocarina"},{id:"0790_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Ocarina"},{id:"0800_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 1 (square)"},{id:"0800_Chaos_sf2_file",library:"Chaos",displayName:"Lead 1 (square)"},{id:"0800_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 1 (square)"},{id:"0800_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 1 (square)"},{id:"0800_JCLive_sf2_file",library:"JCLive",displayName:"Lead 1 (square)"},{id:"0800_SBLive_sf2",library:"SBLive",displayName:"Lead 1 (square)"},{id:"0800_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 1 (square)"},{id:"0810_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 2 (sawtooth)"},{id:"0810_Chaos_sf2_file",library:"Chaos",displayName:"Lead 2 (sawtooth)"},{id:"0810_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 2 (sawtooth)"},{id:"0810_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 2 (sawtooth)"},{id:"0810_JCLive_sf2_file",library:"JCLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SBLive_sf2",library:"SBLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 2 (sawtooth)"},{id:"0820_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 3 (calliope)"},{id:"0820_Chaos_sf2_file",library:"Chaos",displayName:"Lead 3 (calliope)"},{id:"0820_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 3 (calliope)"},{id:"0820_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 3 (calliope)"},{id:"0820_JCLive_sf2_file",library:"JCLive",displayName:"Lead 3 (calliope)"},{id:"0820_SBLive_sf2",library:"SBLive",displayName:"Lead 3 (calliope)"},{id:"0820_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 3 (calliope)"},{id:"0830_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 4 (chiff)"},{id:"0830_Chaos_sf2_file",library:"Chaos",displayName:"Lead 4 (chiff)"},{id:"0830_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 4 (chiff)"},{id:"0830_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 4 (chiff)"},{id:"0830_JCLive_sf2_file",library:"JCLive",displayName:"Lead 4 (chiff)"},{id:"0830_SBLive_sf2",library:"SBLive",displayName:"Lead 4 (chiff)"},{id:"0830_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 4 (chiff)"},{id:"0840_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 5 (charang)"},{id:"0840_Chaos_sf2_file",library:"Chaos",displayName:"Lead 5 (charang)"},{id:"0840_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 5 (charang)"},{id:"0840_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 5 (charang)"},{id:"0840_JCLive_sf2_file",library:"JCLive",displayName:"Lead 5 (charang)"},{id:"0840_SBLive_sf2",library:"SBLive",displayName:"Lead 5 (charang)"},{id:"0840_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 5 (charang)"},{id:"0850_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 6 (voice)"},{id:"0850_Chaos_sf2_file",library:"Chaos",displayName:"Lead 6 (voice)"},{id:"0850_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 6 (voice)"},{id:"0850_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 6 (voice)"},{id:"0850_JCLive_sf2_file",library:"JCLive",displayName:"Lead 6 (voice)"},{id:"0850_SBLive_sf2",library:"SBLive",displayName:"Lead 6 (voice)"},{id:"0850_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 6 (voice)"},{id:"0860_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 7 (fifths)"},{id:"0860_Chaos_sf2_file",library:"Chaos",displayName:"Lead 7 (fifths)"},{id:"0860_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 7 (fifths)"},{id:"0860_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 7 (fifths)"},{id:"0860_JCLive_sf2_file",library:"JCLive",displayName:"Lead 7 (fifths)"},{id:"0860_SBLive_sf2",library:"SBLive",displayName:"Lead 7 (fifths)"},{id:"0860_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 7 (fifths)"},{id:"0870_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 8 (bass + lead)"},{id:"0870_Chaos_sf2_file",library:"Chaos",displayName:"Lead 8 (bass + lead)"},{id:"0870_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 8 (bass + lead)"},{id:"0870_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 8 (bass + lead)"},{id:"0870_JCLive_sf2_file",library:"JCLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SBLive_sf2",library:"SBLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 8 (bass + lead)"},{id:"0880_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 1 (new age)"},{id:"0880_Chaos_sf2_file",library:"Chaos",displayName:"Pad 1 (new age)"},{id:"0880_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 1 (new age)"},{id:"0880_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 1 (new age)"},{id:"0880_JCLive_sf2_file",library:"JCLive",displayName:"Pad 1 (new age)"},{id:"0880_SBLive_sf2",library:"SBLive",displayName:"Pad 1 (new age)"},{id:"0880_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 1 (new age)"},{id:"0890_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 2 (warm)"},{id:"0890_Chaos_sf2_file",library:"Chaos",displayName:"Pad 2 (warm)"},{id:"0890_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 2 (warm)"},{id:"0890_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 2 (warm)"},{id:"0890_JCLive_sf2_file",library:"JCLive",displayName:"Pad 2 (warm)"},{id:"0890_SBLive_sf2",library:"SBLive",displayName:"Pad 2 (warm)"},{id:"0890_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 2 (warm)"},{id:"0900_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 3 (polysynth)"},{id:"0900_Chaos_sf2_file",library:"Chaos",displayName:"Pad 3 (polysynth)"},{id:"0900_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 3 (polysynth)"},{id:"0900_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 3 (polysynth)"},{id:"0900_JCLive_sf2_file",library:"JCLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SBLive_sf2",library:"SBLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 3 (polysynth)"},{id:"0910_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 4 (choir)"},{id:"0910_Chaos_sf2_file",library:"Chaos",displayName:"Pad 4 (choir)"},{id:"0910_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 4 (choir)"},{id:"0910_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 4 (choir)"},{id:"0910_JCLive_sf2_file",library:"JCLive",displayName:"Pad 4 (choir)"},{id:"0910_SBLive_sf2",library:"SBLive",displayName:"Pad 4 (choir)"},{id:"0910_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 4 (choir)"},{id:"0920_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 5 (bowed)"},{id:"0920_Chaos_sf2_file",library:"Chaos",displayName:"Pad 5 (bowed)"},{id:"0920_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 5 (bowed)"},{id:"0920_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 5 (bowed)"},{id:"0920_JCLive_sf2_file",library:"JCLive",displayName:"Pad 5 (bowed)"},{id:"0920_SBLive_sf2",library:"SBLive",displayName:"Pad 5 (bowed)"},{id:"0920_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 5 (bowed)"},{id:"0930_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 6 (metallic)"},{id:"0930_Chaos_sf2_file",library:"Chaos",displayName:"Pad 6 (metallic)"},{id:"0930_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 6 (metallic)"},{id:"0930_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 6 (metallic)"},{id:"0930_JCLive_sf2_file",library:"JCLive",displayName:"Pad 6 (metallic)"},{id:"0930_SBLive_sf2",library:"SBLive",displayName:"Pad 6 (metallic)"},{id:"0930_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 6 (metallic)"},{id:"0940_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 7 (halo)"},{id:"0940_Chaos_sf2_file",library:"Chaos",displayName:"Pad 7 (halo)"},{id:"0940_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 7 (halo)"},{id:"0940_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 7 (halo)"},{id:"0940_JCLive_sf2_file",library:"JCLive",displayName:"Pad 7 (halo)"},{id:"0940_SBLive_sf2",library:"SBLive",displayName:"Pad 7 (halo)"},{id:"0940_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 7 (halo)"},{id:"0950_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 8 (sweep)"},{id:"0950_Chaos_sf2_file",library:"Chaos",displayName:"Pad 8 (sweep)"},{id:"0950_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 8 (sweep)"},{id:"0950_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 8 (sweep)"},{id:"0950_JCLive_sf2_file",library:"JCLive",displayName:"Pad 8 (sweep)"},{id:"0950_SBLive_sf2",library:"SBLive",displayName:"Pad 8 (sweep)"},{id:"0950_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 8 (sweep)"},{id:"0960_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 1 (rain)"},{id:"0960_Chaos_sf2_file",library:"Chaos",displayName:"FX 1 (rain)"},{id:"0960_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 1 (rain)"},{id:"0960_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 1 (rain)"},{id:"0960_JCLive_sf2_file",library:"JCLive",displayName:"FX 1 (rain)"},{id:"0960_SBLive_sf2",library:"SBLive",displayName:"FX 1 (rain)"},{id:"0960_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 1 (rain)"},{id:"0970_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 2 (soundtrack)"},{id:"0970_Chaos_sf2_file",library:"Chaos",displayName:"FX 2 (soundtrack)"},{id:"0970_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 2 (soundtrack)"},{id:"0970_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 2 (soundtrack)"},{id:"0970_JCLive_sf2_file",library:"JCLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SBLive_sf2",library:"SBLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 2 (soundtrack)"},{id:"0980_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 3 (crystal)"},{id:"0980_Chaos_sf2_file",library:"Chaos",displayName:"FX 3 (crystal)"},{id:"0980_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 3 (crystal)"},{id:"0980_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 3 (crystal)"},{id:"0980_JCLive_sf2_file",library:"JCLive",displayName:"FX 3 (crystal)"},{id:"0980_SBLive_sf2",library:"SBLive",displayName:"FX 3 (crystal)"},{id:"0980_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 3 (crystal)"},{id:"0990_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 4 (atmosphere)"},{id:"0990_Chaos_sf2_file",library:"Chaos",displayName:"FX 4 (atmosphere)"},{id:"0990_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 4 (atmosphere)"},{id:"0990_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 4 (atmosphere)"},{id:"0990_JCLive_sf2_file",library:"JCLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SBLive_sf2",library:"SBLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 4 (atmosphere)"},{id:"1000_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 5 (brightness)"},{id:"1000_Chaos_sf2_file",library:"Chaos",displayName:"FX 5 (brightness)"},{id:"1000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 5 (brightness)"},{id:"1000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 5 (brightness)"},{id:"1000_JCLive_sf2_file",library:"JCLive",displayName:"FX 5 (brightness)"},{id:"1000_SBLive_sf2",library:"SBLive",displayName:"FX 5 (brightness)"},{id:"1000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 5 (brightness)"},{id:"1010_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 6 (goblins)"},{id:"1010_Chaos_sf2_file",library:"Chaos",displayName:"FX 6 (goblins)"},{id:"1010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 6 (goblins)"},{id:"1010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 6 (goblins)"},{id:"1010_JCLive_sf2_file",library:"JCLive",displayName:"FX 6 (goblins)"},{id:"1010_SBLive_sf2",library:"SBLive",displayName:"FX 6 (goblins)"},{id:"1010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 6 (goblins)"},{id:"1020_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 7 (echoes)"},{id:"1020_Chaos_sf2_file",library:"Chaos",displayName:"FX 7 (echoes)"},{id:"1020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 7 (echoes)"},{id:"1020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 7 (echoes)"},{id:"1020_JCLive_sf2_file",library:"JCLive",displayName:"FX 7 (echoes)"},{id:"1020_SBLive_sf2",library:"SBLive",displayName:"FX 7 (echoes)"},{id:"1020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 7 (echoes)"},{id:"1030_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 8 (sci-fi)"},{id:"1030_Chaos_sf2_file",library:"Chaos",displayName:"FX 8 (sci-fi)"},{id:"1030_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 8 (sci-fi)"},{id:"1030_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 8 (sci-fi)"},{id:"1030_JCLive_sf2_file",library:"JCLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SBLive_sf2",library:"SBLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 8 (sci-fi)"},{id:"1040_Aspirin_sf2_file",library:"Aspirin",displayName:"Sitar"},{id:"1040_Chaos_sf2_file",library:"Chaos",displayName:"Sitar"},{id:"1040_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Sitar"},{id:"1040_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Sitar"},{id:"1040_JCLive_sf2_file",library:"JCLive",displayName:"Sitar"},{id:"1040_SBLive_sf2",library:"SBLive",displayName:"Sitar"},{id:"1040_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Sitar"},{id:"1050_Aspirin_sf2_file",library:"Aspirin",displayName:"Banjo"},{id:"1050_Chaos_sf2_file",library:"Chaos",displayName:"Banjo"},{id:"1050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Banjo"},{id:"1050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Banjo"},{id:"1050_JCLive_sf2_file",library:"JCLive",displayName:"Banjo"},{id:"1050_SBLive_sf2",library:"SBLive",displayName:"Banjo"},{id:"1050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Banjo"},{id:"1060_Aspirin_sf2_file",library:"Aspirin",displayName:"Shamisen"},{id:"1060_Chaos_sf2_file",library:"Chaos",displayName:"Shamisen"},{id:"1060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shamisen"},{id:"1060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shamisen"},{id:"1060_JCLive_sf2_file",library:"JCLive",displayName:"Shamisen"},{id:"1060_SBLive_sf2",library:"SBLive",displayName:"Shamisen"},{id:"1060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shamisen"},{id:"1070_Aspirin_sf2_file",library:"Aspirin",displayName:"Koto"},{id:"1070_Chaos_sf2_file",library:"Chaos",displayName:"Koto"},{id:"1070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Koto"},{id:"1070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Koto"},{id:"1070_JCLive_sf2_file",library:"JCLive",displayName:"Koto"},{id:"1070_SBLive_sf2",library:"SBLive",displayName:"Koto"},{id:"1070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Koto"},{id:"1080_Aspirin_sf2_file",library:"Aspirin",displayName:"Kalimba"},{id:"1080_Chaos_sf2_file",library:"Chaos",displayName:"Kalimba"},{id:"1080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Kalimba"},{id:"1080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Kalimba"},{id:"1080_JCLive_sf2_file",library:"JCLive",displayName:"Kalimba"},{id:"1080_SBLive_sf2",library:"SBLive",displayName:"Kalimba"},{id:"1080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Kalimba"},{id:"1090_Aspirin_sf2_file",library:"Aspirin",displayName:"Bagpipe"},{id:"1090_Chaos_sf2_file",library:"Chaos",displayName:"Bagpipe"},{id:"1090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bagpipe"},{id:"1090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bagpipe"},{id:"1090_JCLive_sf2_file",library:"JCLive",displayName:"Bagpipe"},{id:"1090_SBLive_sf2",library:"SBLive",displayName:"Bagpipe"},{id:"1090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bagpipe"},{id:"1100_Aspirin_sf2_file",library:"Aspirin",displayName:"Fiddle"},{id:"1100_Chaos_sf2_file",library:"Chaos",displayName:"Fiddle"},{id:"1100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fiddle"},{id:"1100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fiddle"},{id:"1100_JCLive_sf2_file",library:"JCLive",displayName:"Fiddle"},{id:"1100_SBLive_sf2",library:"SBLive",displayName:"Fiddle"},{id:"1100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fiddle"},{id:"1110_Aspirin_sf2_file",library:"Aspirin",displayName:"Shanai"},{id:"1110_Chaos_sf2_file",library:"Chaos",displayName:"Shanai"},{id:"1110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shanai"},{id:"1110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shanai"},{id:"1110_JCLive_sf2_file",library:"JCLive",displayName:"Shanai"},{id:"1110_SBLive_sf2",library:"SBLive",displayName:"Shanai"},{id:"1110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shanai"},{id:"1120_Aspirin_sf2_file",library:"Aspirin",displayName:"Tinkle Bell"},{id:"1120_Chaos_sf2_file",library:"Chaos",displayName:"Tinkle Bell"},{id:"1120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tinkle Bell"},{id:"1120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tinkle Bell"},{id:"1120_JCLive_sf2_file",library:"JCLive",displayName:"Tinkle Bell"},{id:"1120_SBLive_sf2",library:"SBLive",displayName:"Tinkle Bell"},{id:"1120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tinkle Bell"},{id:"1130_Aspirin_sf2_file",library:"Aspirin",displayName:"Agogo"},{id:"1130_Chaos_sf2_file",library:"Chaos",displayName:"Agogo"},{id:"1130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Agogo"},{id:"1130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Agogo"},{id:"1130_JCLive_sf2_file",library:"JCLive",displayName:"Agogo"},{id:"1130_SBLive_sf2",library:"SBLive",displayName:"Agogo"},{id:"1130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Agogo"},{id:"1140_Aspirin_sf2_file",library:"Aspirin",displayName:"Steel Drums"},{id:"1140_Chaos_sf2_file",library:"Chaos",displayName:"Steel Drums"},{id:"1140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Steel Drums"},{id:"1140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Steel Drums"},{id:"1140_JCLive_sf2_file",library:"JCLive",displayName:"Steel Drums"},{id:"1140_SBLive_sf2",library:"SBLive",displayName:"Steel Drums"},{id:"1140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Steel Drums"},{id:"1150_Aspirin_sf2_file",library:"Aspirin",displayName:"Woodblock"},{id:"1150_Chaos_sf2_file",library:"Chaos",displayName:"Woodblock"},{id:"1150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Woodblock"},{id:"1150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Woodblock"},{id:"1150_JCLive_sf2_file",library:"JCLive",displayName:"Woodblock"},{id:"1150_SBLive_sf2",library:"SBLive",displayName:"Woodblock"},{id:"1150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Woodblock"},{id:"1160_Aspirin_sf2_file",library:"Aspirin",displayName:"Taiko Drum"},{id:"1160_Chaos_sf2_file",library:"Chaos",displayName:"Taiko Drum"},{id:"1160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Taiko Drum"},{id:"1160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Taiko Drum"},{id:"1160_JCLive_sf2_file",library:"JCLive",displayName:"Taiko Drum"},{id:"1160_SBLive_sf2",library:"SBLive",displayName:"Taiko Drum"},{id:"1160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Taiko Drum"},{id:"1170_Aspirin_sf2_file",library:"Aspirin",displayName:"Melodic Tom"},{id:"1170_Chaos_sf2_file",library:"Chaos",displayName:"Melodic Tom"},{id:"1170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Melodic Tom"},{id:"1170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Melodic Tom"},{id:"1170_JCLive_sf2_file",library:"JCLive",displayName:"Melodic Tom"},{id:"1170_SBLive_sf2",library:"SBLive",displayName:"Melodic Tom"},{id:"1170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Melodic Tom"},{id:"1180_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Drum"},{id:"1180_Chaos_sf2_file",library:"Chaos",displayName:"Synth Drum"},{id:"1180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Drum"},{id:"1180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Drum"},{id:"1180_JCLive_sf2_file",library:"JCLive",displayName:"Synth Drum"},{id:"1180_SBLive_sf2",library:"SBLive",displayName:"Synth Drum"},{id:"1180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Drum"},{id:"1190_Aspirin_sf2_file",library:"Aspirin",displayName:"Reverse Cymbal"},{id:"1190_Chaos_sf2_file",library:"Chaos",displayName:"Reverse Cymbal"},{id:"1190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reverse Cymbal"},{id:"1190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reverse Cymbal"},{id:"1190_JCLive_sf2_file",library:"JCLive",displayName:"Reverse Cymbal"},{id:"1190_SBLive_sf2",library:"SBLive",displayName:"Reverse Cymbal"},{id:"1190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reverse Cymbal"},{id:"1200_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Fret Noise"},{id:"1200_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Fret Noise"},{id:"1200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Fret Noise"},{id:"1200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Fret Noise"},{id:"1200_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Fret Noise"},{id:"1200_SBLive_sf2",library:"SBLive",displayName:"Guitar Fret Noise"},{id:"1200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Fret Noise"},{id:"1210_Aspirin_sf2_file",library:"Aspirin",displayName:"Breath Noise"},{id:"1210_Chaos_sf2_file",library:"Chaos",displayName:"Breath Noise"},{id:"1210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Breath Noise"},{id:"1210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Breath Noise"},{id:"1210_JCLive_sf2_file",library:"JCLive",displayName:"Breath Noise"},{id:"1210_SBLive_sf2",library:"SBLive",displayName:"Breath Noise"},{id:"1210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Breath Noise"},{id:"1220_Aspirin_sf2_file",library:"Aspirin",displayName:"Seashore"},{id:"1220_Chaos_sf2_file",library:"Chaos",displayName:"Seashore"},{id:"1220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Seashore"},{id:"1220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Seashore"},{id:"1220_JCLive_sf2_file",library:"JCLive",displayName:"Seashore"},{id:"1220_SBLive_sf2",library:"SBLive",displayName:"Seashore"},{id:"1220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Seashore"},{id:"1230_Aspirin_sf2_file",library:"Aspirin",displayName:"Bird Tweet"},{id:"1230_Chaos_sf2_file",library:"Chaos",displayName:"Bird Tweet"},{id:"1230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bird Tweet"},{id:"1230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bird Tweet"},{id:"1230_JCLive_sf2_file",library:"JCLive",displayName:"Bird Tweet"},{id:"1230_SBLive_sf2",library:"SBLive",displayName:"Bird Tweet"},{id:"1230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bird Tweet"},{id:"1240_Aspirin_sf2_file",library:"Aspirin",displayName:"Telephone Ring"},{id:"1240_Chaos_sf2_file",library:"Chaos",displayName:"Telephone Ring"},{id:"1240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Telephone Ring"},{id:"1240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Telephone Ring"},{id:"1240_JCLive_sf2_file",library:"JCLive",displayName:"Telephone Ring"},{id:"1240_SBLive_sf2",library:"SBLive",displayName:"Telephone Ring"},{id:"1240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Telephone Ring"},{id:"1250_Aspirin_sf2_file",library:"Aspirin",displayName:"Helicopter"},{id:"1250_Chaos_sf2_file",library:"Chaos",displayName:"Helicopter"},{id:"1250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Helicopter"},{id:"1250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Helicopter"},{id:"1250_JCLive_sf2_file",library:"JCLive",displayName:"Helicopter"},{id:"1250_SBLive_sf2",library:"SBLive",displayName:"Helicopter"},{id:"1250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Helicopter"},{id:"1260_Aspirin_sf2_file",library:"Aspirin",displayName:"Applause"},{id:"1260_Chaos_sf2_file",library:"Chaos",displayName:"Applause"},{id:"1260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Applause"},{id:"1260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Applause"},{id:"1260_JCLive_sf2_file",library:"JCLive",displayName:"Applause"},{id:"1260_SBLive_sf2",library:"SBLive",displayName:"Applause"},{id:"1260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Applause"},{id:"1270_Aspirin_sf2_file",library:"Aspirin",displayName:"Gunshot"},{id:"1270_Chaos_sf2_file",library:"Chaos",displayName:"Gunshot"},{id:"1270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Gunshot"},{id:"1270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Gunshot"},{id:"1270_JCLive_sf2_file",library:"JCLive",displayName:"Gunshot"},{id:"1270_SBLive_sf2",library:"SBLive",displayName:"Gunshot"},{id:"1270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Gunshot"},{id:"12835_1_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 1"},{id:"12835_1_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 1"},{id:"12835_1_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 1"},{id:"12835_1_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 1"},{id:"12835_2_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 2"},{id:"12835_2_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 2"},{id:"12835_2_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 2"},{id:"12835_2_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 2"},{id:"12835_3_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 3"},{id:"12835_3_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 3"},{id:"12835_3_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 3"},{id:"12835_3_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 3"},{id:"12835_4_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 4"},{id:"12835_4_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 4"},{id:"12835_4_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 4"},{id:"12835_4_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 4"},{id:"12835_5_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 5"},{id:"12835_5_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 5"},{id:"12835_5_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 5"},{id:"12835_5_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 5"},{id:"12835_6_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 6"},{id:"12835_6_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 6"},{id:"12835_6_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 6"},{id:"12835_6_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 6"},{id:"12835_7_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 7"},{id:"12835_7_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 7"},{id:"12835_7_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 7"},{id:"12835_7_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 7"},{id:"12835_8_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 8"},{id:"12835_8_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 8"},{id:"12835_8_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 8"},{id:"12835_8_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 8"},{id:"12835_9_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 9"},{id:"12835_9_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 9"},{id:"12835_9_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 9"},{id:"12835_10_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 10"},{id:"12835_10_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 10"},{id:"12835_10_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 10"},{id:"12835_11_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 11"},{id:"12835_11_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 11"},{id:"12835_11_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 11"},{id:"12835_12_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 12"},{id:"12835_12_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 12"},{id:"12835_13_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 13"},{id:"12835_13_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 13"},{id:"12835_14_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 14"},{id:"12835_14_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 14"},{id:"12835_15_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 15"},{id:"12835_15_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 15"},{id:"12835_16_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 16"},{id:"12835_16_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 16"},{id:"12835_17_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 17"},{id:"12835_17_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 17"},{id:"12835_18_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 18"},{id:"12835_18_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 18"}];function Ea(t){const e=1+t%18,i=mt.find(n=>n.id.startsWith(`12835_${e}_`)&&n.library==="FluidR3_GM");if(i)return{library:i.library,displayName:i.displayName};const s=mt.find(n=>n.id.startsWith(`12835_${e}_`));return s?{library:s.library,displayName:s.displayName}:null}const Ia=Array.from({length:47},(t,e)=>35+e),ka={35:"kick2",36:"kick1",37:"rim",38:"snare1",39:"clap",40:"snare2",41:"lowtom2",42:"hh_closed",43:"lowtom1",44:"hh_pedal",45:"midtom2",46:"hh_open",47:"midtom1",48:"hitom2",49:"crash1",50:"hitom1",51:"ride1",52:"china",53:"ride_bell",54:"tamb",55:"splash",56:"cowbell",57:"crash2",58:"vibraslap",59:"ride2",60:"bongo_hi",61:"bongo_lo",62:"conga_hi_mute",63:"conga_hi_open",64:"conga_lo",65:"timbale_hi",66:"timbale_lo",67:"agogo_hi",68:"agogo_lo",69:"cabasa",70:"maracas",71:"whistle_short",72:"whistle_long",73:"guiro_short",74:"guiro_long",75:"claves",76:"woodblock_hi",77:"woodblock_lo",78:"cuica_mute",79:"cuica_open",80:"triangle_mute",81:"triangle_open"},Qi=ha,ni=new Map;let se=null;function es(t){return Math.max(t,1e-4)}async function Tt(t){return new Promise((e,i)=>{const s=document.createElement("script");s.src=t,s.onload=()=>e(),s.onerror=()=>i(new Error(`Failed to load script: ${t}`)),document.body.appendChild(s)})}async function Aa(){se||(await Tt("https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"),se=new window.WebAudioFontPlayer)}async function Pi(t,e=X(),i=null,s,n,r,a=!0){const[o,c]=t.split("/"),d=String(e),l=`${o}/${c}@${d}`;ni.has(e)||ni.set(e,new Map);const u=ni.get(e);if(a&&u.has(l))return u.get(l);if(await Aa(),se.resumeContext){const C=se.resumeContext;se.resumeContext=M=>{if(!(M instanceof OfflineAudioContext))return C.call(se,M)}}const h=mt.find(C=>C.library===o&&C.displayName===c);if(!h)throw new Error(`Could not find WebAudioFont entry for library=${o} and instrument=${c}`);i&&i.context!==e&&(console.warn("[WebAudioFont] Ignoring mismatched destination from another context"),i=null);const f=i||He(e),p=e.createStereoPanner();if(p.pan.value=n??0,p.connect(f),!h.displayName.startsWith("Drum Kit")){const C=`_tone_${h.id}`,M=`https://surikov.github.io/webaudiofontdata/sound/${h.id}.js`;r?await Tt(M):await Qi(Tt(M));const E=window[C];if(!E)throw new Error(`Missing preset: ${C}`);if(se.loader.decodeAfterLoading(e,C),e instanceof OfflineAudioContext){const L=(E==null?void 0:E.zones)??[];for(const F of L)if(F.file&&!F.buffer){const A=atob(F.file),U=new ArrayBuffer(A.length),D=new Uint8Array(U);for(let q=0;q<A.length;q++)D[q]=A.charCodeAt(q);F.buffer=await new Promise((q,P)=>e.decodeAudioData(U,q,P))}}const k={_preset:E,_volume:s??1,_activeEnvelopes:[],start({note:L,duration:F=1,velocity:A=100,time:U}){const D=typeof L=="string"?K(L):L;if(D==null||typeof D!="number")return;const q=typeof U=="number"?U:0,P=Math.max(.01,Math.min(1,A/127)),G=es(k._volume),J=Math.max(.01,Math.min(1,G*P)),R=se.queueWaveTable(e,p||He(),E,q,D,F,J);k._activeEnvelopes.push(R)},stop(){var L;for(const F of k._activeEnvelopes)try{F.cancel?F.cancel():(L=F.audioBufferSourceNode)!=null&&L.stop&&F.audioBufferSourceNode.stop()}catch(A){console.warn("Failed to stop envelope:",A)}k._activeEnvelopes=[]},setVolume(L){k._volume=Math.max(0,Math.min(1,L))},setPan(L){p.pan.value=Math.max(-1,Math.min(1,L))},load:Promise.resolve()};return a&&u.set(l,k),k}const y=h.id.match(/^12835_(\d+)_([A-Za-z0-9_]+)_sf2_file$/);if(!y)throw new Error(`Invalid drum ID format in catalogue: ${h.id}`);const[,m,_]=y,v=parseInt(m,10),b={},S=async()=>{for(const C of Ia){const M=`_drum_${C}_${v}_${_}_sf2_file`,E=`https://surikov.github.io/webaudiofontdata/sound/${12800+C}_${v}_${_}_sf2_file.js`;try{await Tt(E);const k=window[M];if(!k){console.warn(`Missing drum preset: ${M}`);continue}se.loader.decodeAfterLoading(e,M),b[C]=k}catch(k){console.warn(`Failed to load drum preset ${C}: ${k}`)}}};r??!1?await S():await Qi(S());const N={_preset:b,_volume:s??1,_activeEnvelopes:[],start({note:C,duration:M=1,velocity:E=100,time:k}){const L=typeof C=="string"?K(C):C;if(L==null||typeof L!="number"){console.warn(`Invalid MIDI pitch: ${C}`);return}const F=b[L];if(!F){console.warn(`No drum preset loaded for MIDI ${L}`);return}const A=typeof k=="number"?k:0,U=es(N._volume),D=se.queueWaveTable(e,p||He(),F,A,L,M,U);N._activeEnvelopes.push(D)},stop(){var C;for(const M of N._activeEnvelopes)try{M.cancel?M.cancel():(C=M.audioBufferSourceNode)!=null&&C.stop&&M.audioBufferSourceNode.stop()}catch(E){console.warn("Failed to stop envelope:",E)}N._activeEnvelopes=[]},load:Promise.resolve(),setVolume(C){N._volume=Math.max(0,Math.min(1,C))},setPan(C){p.pan.value=Math.max(-1,Math.min(1,C))}};return a&&u.set(l,N),N}async function Pa(){const t=new Set;for(const e of mt)t.add(e.library);return Array.from(t)}async function Fa(t){return mt.filter(e=>e.library===t).map(e=>e.displayName)}function Ta(){return{name:"webaudiofont",loadInstrument:Pi,getAvailableLibraries:Pa,getAvailableInstruments:Fa}}let gi=null,bi=null;async function Ra(t){if(bi===t)return;const[,e,i]=t.split("/");gi=await Pi(`${e}/${i}`,Fe()),bi=t}function Oa(){return bi}function xa(t,e=100,i=!1){if(!gi)return null;const n=Fe().currentTime,r=K(t);return r===null?null:(gi.start({note:r,velocity:e,time:n,duration:1.5,loop:i}),()=>{})}function Ua(t){}async function Da(t,e,i,s=100,n=!1,r=null,a=null,o=null,c,d){const l=a||X(),[,u,h]=t.split("/"),f=await Pi(`${u}/${h}`,l,o,c,d);c!==void 0&&f.setVolume&&f.setVolume(c),d!==void 0&&f.setPan&&f.setPan(d);const p=K(e);return p===null||f.start({note:p,duration:i,velocity:s,loop:n,time:r??l.currentTime}),null}function qa(){return{name:"webaudiofont",setActiveInstrument:Ra,getActiveInstrumentName:Oa,playNote:xa,stopNoteByPitch:Ua,loadAndPlayNote:Da}}const Xt={sf2:Ga(),webaudiofont:qa()};let $e=null;async function tr(t){if(!t.includes("/"))throw new Error(`Invalid instrument name: "${t}". Expected "<engine>/<library>/<instrument>"`);const e=t.split("/")[0],i=Xt[e];if(!i)throw new Error(`Engine "${e}" not available`);await i.setActiveInstrument(t),$e=t}function Ja(){return $e}function ir(t,e=100,i=!1){if(!$e)return null;const s=$e.split("/")[0],n=Xt[s];if(!n)throw new Error(`Engine "${s}" not available`);return n.playNote(t,e,i)}function Ha(t){if(!$e)return;const e=$e.split("/")[0],i=Xt[e];if(!i)throw new Error(`Engine "${e}" not available`);i.stopNoteByPitch(t)}async function $a(t,e,i=1,s=100,n=!1,r=null,a=null,o=null,c,d){const l=t.split("/")[0],u=Xt[l];if(!u)throw new Error(`Engine "${l}" not available`);let h=a??X(),f=o;return h.state==="suspended"&&(console.warn("[loadAndPlayNote] Using preview context due to suspended main context"),h=Fe(),f=Sa()),await u.loadAndPlayNote(t,e,i,s,n,r,h,f,c,d)}let ai=null;function X(){return ai||(ai=new(window.AudioContext||window.webkitAudioContext)),ai}const oi=new WeakMap,li=new WeakMap;function sr(t=X()){if(!li.has(t)){const e=t.createAnalyser();e.fftSize=2048,li.set(t,e)}return li.get(t)}function He(t=X()){if(!oi.has(t)){const e=t.createGain(),i=sr(t);e.connect(i),i.connect(t.destination),oi.set(t,e)}return oi.get(t)}function Ka(t){try{const e=ir(t,100,!1);return e?{stop:e,forceStop:e}:null}catch(e){return console.error("[playNote] Failed to play note",t,e),null}}const Vt={sf2:va(),webaudiofont:Ta()},rr="sf2";async function nr(t,e,i,s,n,r,a=!0){const o=t.split("/");if(o.length!==3)throw new Error(`Invalid instrument fullName format: "${t}". Expected format "engine/library/instrument"`);const[c,d,l]=o,u=Vt[c];if(!u)throw new Error(`Engine "${c}" not available`);return await u.loadInstrument(`${d}/${l}`,e,i,s,n,r,a)}async function za(t=rr){const e=Vt[t];if(!e)throw new Error(`Engine "${t}" not available`);return await e.getAvailableLibraries()}async function Wa(t,e=rr){const i=Vt[e];if(!i)throw new Error(`Engine "${e}" not available`);return await i.getAvailableInstruments(t)}function Xa(){return Object.keys(Vt)}const Va=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ja=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ya={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function Za(t){return t.includes("#")}function V(t){const e=t==null?void 0:t.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,i,s,n]=e,r=i.toUpperCase(),a=Ya[r];if(a===void 0)return null;const o=[...s].reduce((d,l)=>l==="#"?d+1:l==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}function dt(t){return V(t)}const Qa=t=>{const e=V(t);return e!==null?e%12:0};function Fi(t,e=21,i){const s=V(t);if(s===null)return null;const n=i-e+1,r=s-e,a=n-1-r;return a>=0&&a<n?a:null}function ve(t,e,i){const n=i-e+1-1-t,r=e+n;return jt(r)}function jt(t,e=!1){const s=(e?ja:Va)[t%12],n=Math.floor(t/12)-1;return`${s}${n}`}function ar(t,e){const i=new Map;for(let s=t;s<=e;s++)i.set(s,Za(jt(s)));return i}function eo(t,e){const i=V(t),s=V(e);if(i===null||s===null)throw new Error(`Invalid pitches provided: ${t}, ${e}`);return i-s}function to(t,e){const i=structuredClone(t);return i.tempo=e.bpm,i}function or(t){return{type:"CHANGE_TEMPO",bpm:t}}function io(t){return or(t)}function so(t,e){const i=structuredClone(t);return i.timeSignature=[e.beats,4],i}function lr(t){return{type:"SET_TIME_SIGNATURE",beats:t}}function ro(t){return lr(t)}function no(t,e){const i=structuredClone(t);return i.totalMeasures=e.measures,i}function dr(t){return{type:"SET_TOTAL_MEASURES",measures:t}}function ao(t){return dr(t)}function oo(t,e){const i=structuredClone(t);if(i.sequencers.push({id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan}),!T.find(n=>n.id===e.id)){const n={id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan};Ar(n)}return i}function cr(t,e,i,s){return{type:"CREATE_SEQUENCER",id:t,instrument:e,volume:i,pan:s}}function Ti(t){return{type:"DELETE_SEQUENCER",id:t}}function lo(t,e){const i=structuredClone(t);i.sequencers=i.sequencers.filter(n=>n.id!==e.id);const s=T.findIndex(n=>n.id===e.id);return s!==-1&&(T[s].destroy(),T.splice(s,1)),i}function ur(t,e,i=[],s,n){return{type:"DELETE_SEQUENCER",id:t,instrument:e,notes:structuredClone(i),volume:s,pan:n}}function fr(t,e,i=[],s,n){return{type:"CREATE_SEQUENCER",id:t,instrument:e,notes:structuredClone(i),volume:s,pan:n}}function co(t,e){const i=structuredClone(t),s=i.sequencers.find(n=>n.id===e.sequencerId);return s&&e.instrument&&(s.instrument=e.instrument),i}function uo(t,e){return{type:"SET_INSTRUMENT",sequencerId:t,instrument:e}}function fo(t,e){return{type:"SET_INSTRUMENT",sequencerId:t,instrument:e}}function ho(t,e){var n;const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.id);if(s&&typeof e.volume=="number"){s.volume=e.volume;const r=T.find(a=>a.id===e.id);r&&(r.volume=e.volume,(n=r.refreshVolumeUI)==null||n.call(r))}return i}function mo(t,e){return{type:"SET_VOLUME",id:t,volume:e}}function po(t,e){return{type:"SET_VOLUME",id:t,volume:e}}function yo(t,e){var n;const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.id);if(s&&typeof e.pan=="number"){s.pan=e.pan;const r=T.find(a=>a.id===e.id);r&&(r.pan=e.pan,(n=r.refreshPanUI)==null||n.call(r))}return i}function _o(t,e){return{type:"SET_PAN",id:t,pan:e}}function go(t,e){return{type:"SET_PAN",id:t,pan:e}}function bo(t,e){const i=structuredClone(t),s=i.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),i):t}function hr(t,e){return{type:"PLACE_NOTES",sequencerId:t,notes:structuredClone(e)}}function mr(t,e){return{type:"DELETE_NOTES",sequencerId:t,notes:structuredClone(e)}}function vo(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),i}function nt(t,e){return{type:"DELETE_NOTES",sequencerId:t,notes:structuredClone(e)}}function at(t,e){return{type:"PLACE_NOTES",sequencerId:t,notes:structuredClone(e)}}function So(t,e){const i=structuredClone(t),s=i.sequencers.find(a=>a.id===e.sequencerId);if(!s)return t;const n=e.from,r=e.to;for(let a=0;a<n.length;a++){const o=n[a],c=r[a],d=s.notes.findIndex(l=>l.pitch===o.pitch&&l.start===o.start&&l.duration===o.duration);d!==-1&&(s.notes[d].pitch=c.pitch,s.notes[d].start=c.start)}return i}function pr(t,e,i){return{type:"MOVE_NOTES",sequencerId:t,from:structuredClone(e),to:structuredClone(i)}}function No(t,e,i){return pr(t,i,e)}function Co(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),i}function Mo(t,e){const i=structuredClone(t),s=i.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),i):t}function Bo(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const n=e.resizes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start);a&&(a.duration=r.newDuration)}return i}function wo(t,e){return{type:"RESIZE_NOTES",sequencerId:t,resizes:structuredClone(e)}}function Lo(t,e){const i=e.map(s=>({pitch:s.pitch,start:s.start,newDuration:s.oldDuration}));return{type:"RESIZE_NOTES",sequencerId:t,resizes:i}}function Go(t,e){const i=structuredClone(t),s=i.sequencers.find(r=>r.id===e.sequencerId);if(!s)return t;const n=e.notes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start&&o.duration===r.duration);a&&(a.velocity=r.velocity)}return i}function Eo(t,e){return{type:"SET_NOTE_VELOCITY",sequencerId:t,notes:structuredClone(e)}}function Io(t,e){return{type:"SET_NOTE_VELOCITY",sequencerId:t,notes:structuredClone(e)}}function ko(t,e){return structuredClone(t)}function Ri(t=""){return{type:"CHECKPOINT",label:t}}function yr(t=""){return Ri(t)}const Ao=Object.freeze(Object.defineProperty({__proto__:null,CHANGE_TEMPO:to,CHECKPOINT:ko,CREATE_SEQUENCER:oo,CUT_NOTES:Co,DELETE_NOTES:vo,DELETE_SEQUENCER:lo,MOVE_NOTES:So,PASTE_NOTES:Mo,PLACE_NOTES:bo,RESIZE_NOTES:Bo,SET_INSTRUMENT:co,SET_NOTE_VELOCITY:Go,SET_PAN:yo,SET_TIME_SIGNATURE:so,SET_TOTAL_MEASURES:no,SET_VOLUME:ho},Symbol.toStringTag,{value:"Module"}));function Oi(t){const e=Ao[t.type];if(!e)throw new Error(`Unknown diff type: ${t.type}`);const i=e(Ne(),t);xo(i)}const vi=new Set;function Po(t){return vi.add(t),()=>vi.delete(t)}function Yt(t){for(const e of vi)e(t)}const _e=[];let fe=-1;const Fo=100;function To({forwardDiff:t,reverseDiff:e}){_e.splice(fe+1),_e.push({forwardDiff:t,reverseDiff:e}),fe=_e.length-1,_e.length>Fo&&(_e.shift(),fe--)}function Ro(){var t;if(fe<0)return null;for(let e=fe;e>=0;e--){const i=_e[e];if(((t=i==null?void 0:i.forwardDiff)==null?void 0:t.type)==="CHECKPOINT")return null;if(i!=null&&i.reverseDiff)return fe=e-1,Oi(i.reverseDiff),Yt(Ne()),i.reverseDiff}return null}function Oo(){if(fe>=_e.length-1)return null;fe++;const t=_e[fe];return!t||!t.forwardDiff?null:(Oi(t.forwardDiff),Yt(Ne()),t.forwardDiff)}let xt={tempo:120,timeSignature:[4,4],totalMeasures:8,sequencers:[]};function Ne(){return xt}function xo(t){xt=structuredClone(t),Yt(xt)}function O(t,e){Oi(t),To({forwardDiff:t,reverseDiff:e}),Yt(xt)}const z={cellWidth:40,cellHeight:20,visibleNotes:36,noteRange:["C1","B9"],currentDuration:1,snapResolution:1,isTripletMode:!1,loopEnabled:!1,useEqualTemperament:!0},Uo={4:"",2:"",1:"","0.5":"","0.25":"","0.125":""};let _r=500,gr=!1,br=4,vr=8;function ae(){return We()*bt()}function xi(t,e=!0){const i=me();if(e){O(or(t),io(i));return}performance.now(),I.getCurrentBeat(),_r=60/t*1e3,I.isActive()&&I.syncAfterTempoChange(i);const s=document.getElementById("tempo-input");s&&s.value!==String(t)&&(s.value=String(t))}function me(){return 60/(_r/1e3)}function Ui(t,e=!0){if(e){const s=bt();O(lr(t),ro(s));return}br=t;const i=document.getElementById("beats-per-measure-input");i&&i.value!==String(t)&&(i.value=String(t)),te().forEach(s=>{s.updateBeatsPerMeasure()})}function bt(){return br}function Di(t,e=!0){if(e){const s=We();O(dr(t),ao(s));return}vr=t;const i=document.getElementById("measures-input");i&&i.value!==String(t)&&(i.value=String(t))}function We(){return vr}function Do(t){gr=t}function qo(){return gr}function Jo(){return z.snapResolution}async function Ho(t,e,i,s,n,r,a){if(!s||s.length===0)return;const o=60/me();if(a!=null&&a.aborted){console.log("ABORTED Before loading instrument");return}const c=await nr(t,e,i,n,r);if(a!=null&&a.aborted){console.log("ABORTED After loading instrument");return}for(const d of s){if(a!=null&&a.aborted){console.log("ABORTED During note export");return}const l=d.start*o,u=Math.max(.01,l),h=d.duration*o,f=d.velocity??100,p=V(d.pitch);if(p==null)continue;const g=t.split("/"),m=(g.length>=3?g[1]:g[0])==="drummachines"&&c.__midiMap?c.__midiMap.get(p)??p:p;try{c.start({note:m,duration:h,velocity:f,time:u,loop:!1})}catch(_){console.warn("[exportNotesToOffline] Failed to start note:",d,_)}}}function ts(t){if(!t.container)return;const e=t.container.querySelector(".mute-btn"),i=t.container.querySelector(".solo-btn"),s=t.container.querySelector(".sequencer-body"),n=t.container.querySelector(".mini-contour");e==null||e.classList.toggle("bg-red-600",t.mute),e==null||e.classList.toggle("bg-gray-700",!t.mute),i==null||i.classList.toggle("bg-yellow-200",t.solo),i==null||i.classList.toggle("bg-gray-700",!t.solo);const r=t.mute&&!t.solo;s==null||s.classList.toggle("opacity-40",r),s==null||s.classList.toggle("opacity-100",!r),n==null||n.classList.toggle("opacity-40",r),n==null||n.classList.toggle("opacity-100",!r)}function $o(t,e,i,s,n){const r=t.querySelector(".zoom-in-btn"),a=t.querySelector(".zoom-out-btn"),o=t.querySelector(".zoom-reset-btn");!r||!a||!o||(n.on(r,"click",e),n.on(a,"click",i),n.on(o,"click",s))}function Sr(t,e){var i,s,n,r,a;(i=t.querySelector(".zoom-in-btn"))==null||i.classList.toggle("hidden",!e),(s=t.querySelector(".zoom-out-btn"))==null||s.classList.toggle("hidden",!e),(n=t.querySelector(".zoom-reset-btn"))==null||n.classList.toggle("hidden",!e),(r=t.querySelector(".zoom-button-divider"))==null||r.classList.toggle("hidden",!e),(a=t.querySelector(".grip-handle"))==null||a.classList.toggle("hidden",!e)}function Ko(t,e,i){const s=t.querySelector(".cursor-grab");if(!s)return;const n=t.querySelector(".sequencer-body");if(!n)return;let r=!1,a=0,o=0;const c=150,d=1e3;i.on(s,"mousedown",l=>{r=!0,a=l.clientY,o=n.offsetHeight,s.classList.replace("cursor-grab","cursor-grabbing"),document.body.style.userSelect="none"}),i.on(window,"mousemove",l=>{if(!r)return;const u=l.clientY-a;let h=o+u;h=Math.max(c,Math.min(d,h)),n.style.height=`${h}px`,e.resize()}),i.on(window,"mouseup",()=>{r&&(r=!1,s.classList.replace("cursor-grabbing","cursor-grab"),document.body.style.userSelect="")})}function zo(t,e){var i;(i=t.querySelector(".cursor-grab"))==null||i.classList.toggle("hidden",!e)}const Ke=["#ff006e","#3a86ff","#ffbe0b","#8338ec","#06d6a0","#ef476f","#118ab2","#ffd166","#073b4c","#8ac926","#0077b6","#00b4d8","#005f73","#03045e","#023e8a"];function vt(t,e,i,s=0){const n=t.getContext("2d");if(!n)return;n.imageSmoothingEnabled=!1;const r=t.width,a=t.height;if(n.clearRect(0,0,r,a),!e.length)return;const o=Ke[s%Ke.length];n.fillStyle=o;const c=ae(),d=e.map(m=>K(m.pitch)).filter(m=>m!==null);if(!d.length)return;let l=Math.min(...d),u=Math.max(...d),h=Math.max(1,u-l);for(;a%h!==0;)u++,h=u-l;const f=a/h;for(const m of e){const _=K(m.pitch);if(_==null)continue;const v=m.start/c*r,b=m.duration/c*r,S=(_-l)/h,N=a-S*a-f/2,C=Math.round(v),M=Math.max(1,Math.round(b)),E=Math.round(N);n.fillRect(C,E,M,f)}const p=bt(),g=We();n.save();let y=1;g>256?y=16:g>128?y=8:g>32&&(y=4);for(let m=0;m<=g;m++){if(m%y!==0)continue;const v=m*p/c*r,b=Math.round(v)+.5;n.beginPath(),n.moveTo(b,0),n.lineTo(b,a);const S=y===1||m%(y*2)===0;n.strokeStyle=S?"rgba(255, 255, 255, 0.12)":"rgba(255, 255, 255, 0.04)",n.lineWidth=.2,n.stroke()}n.restore()}function Se(t,e){const i=t.getContext("2d");if(!i)return;const s=t.width,n=t.height;i.clearRect(0,0,s,n);const r=ae();for(const a of e){const{notes:o,config:c}=a;if(!(o!=null&&o.length))continue;const d=Ke[e.indexOf(a)%Ke.length];i.fillStyle=d;const l=K(c.noteRange[0]),u=K(c.noteRange[1]);if(l==null||u==null)continue;const h=u-l||1,f=Math.max(2,n/h);for(const p of o){const g=K(p.pitch);if(g==null)continue;const y=p.start/r*s,m=Math.max(1,p.duration/r*s),_=(g-l)/h,v=n-_*n-f/2;i.fillRect(y,v,m,f)}}}function Wo(t,e){Se(t,e)}function Nr(t,e=!0){var c;if(!t.container||!t.body||!t.miniContour||!t.collapseIcon)return;t.collapsed=e;const i=t.container,s=t.body,n=t.miniContour,r=t.collapseIcon,a=d=>{Sr(i,d),zo(i,d)},o=()=>{for(const d of t.scheduledAnimations)clearTimeout(d);t.scheduledAnimations=[]};s.classList.toggle("hidden",e),n.classList.toggle("hidden",!e),r.setAttribute("href",e?"#icon-caret-up":"#icon-caret-down"),e?(o(),a(!1),vt(n,t.notes,t.config,t.colorIndex)):(a(!0),(c=t.matrix)==null||c.resize(),I.isActive()&&t.resumeAnimationsFromCurrentTime(I.getStartTime(),I.getStartBeat()))}function Si(t,e){const{config:i,container:s,matrix:n,colorIndex:r,getNotes:a}=t,[o,c]=e,d=V(o),l=V(c);if(d===null||l===null){console.warn(`Invalid note range: ${e}`);return}if(d>=l){console.warn("Invalid note range: low note must be lower than high note");return}i.noteRange=e,i.visibleNotes=eo(c,o)+1;const u=s==null?void 0:s.querySelector(".mini-contour");u&&vt(u,a(),i,r),n.setNoteRange(d,l)}function Xo(t){t.instrumentName.toLowerCase().includes("drum kit")?(Si(t,["B1","A5"]),t.matrix.setCustomLabels(ka)):(Si(t,["A0","C9"]),t.matrix.setCustomLabels(null))}const Vo={totalMeasures:16,beatsPerMeasure:4,layout:{labelWidthColumns:1,headerHeightRows:2,footerHeightRows:1,labelWidth:80,headerHeight:40,footerHeight:40,baseCellWidth:70,minCellWidth:10,maxCellWidth:200,verticalCellRatio:4,highestMidi:108,lowestMidi:21},display:{showMeasureLines:!0,showBeatLines:!0,showHoveredCell:!0,highlightCurrentMeasure:!0},behavior:{zoom:1,scrollMargin:48,enableSnapping:!0,snapDivisions:4,maxZoom:1.6,minZoom:.5}};function jo(){return structuredClone(Vo)}function Yo(t,e){return{...t,...e,layout:{...t.layout,...e.layout??{}},display:{...t.display,...e.display??{}},behavior:{...t.behavior,...e.behavior??{}}}}const Zo={ai:{openaiApiKey:"",openaiModel:"gpt-4o"},layout:{darkMode:!0},theme:{gridColorScheme:"Darkroom",noteColorScheme:"Track Color"},interaction:{noteToolMode:"default"}},Cr=structuredClone(Zo);function Ce(){return Cr}function pt(t){Mr(Cr,t)}function Mr(t,e){for(const i in e)e[i]&&typeof e[i]=="object"&&!Array.isArray(e[i])?(t[i]||(t[i]={}),Mr(t[i],e[i])):t[i]=e[i]}const qi={Midnight:{whiteKey:"#1e1e1e",blackKey:"#2a103b",labelWhite:"#2c2c2c",labelBlack:"#3a1d4d",textWhite:"#cfcfcf",textBlack:"#e6d9ff",gridLine:"#333",beatLine:"#4e3d63",measureLine:"#8561c2"},Seashell:{whiteKey:"#fefefe",blackKey:"#f1e7dc",labelWhite:"#dddddd",labelBlack:"#d4cfc9",textWhite:"#444",textBlack:"#663300",gridLine:"#ccc",beatLine:"#bbb",measureLine:"#999"},Cyberpunk:{whiteKey:"#162447",blackKey:"#1b1b2f",labelWhite:"#1f4068",labelBlack:"#1f4068",textWhite:"#e43f5a",textBlack:"#e43f5a",gridLine:"#1f4068",beatLine:"#e43f5a",measureLine:"#ffcc00"},"Classic Blue":{whiteKey:"#f5faff",blackKey:"#dceeff",labelWhite:"#aaccee",labelBlack:"#88bbdd",textWhite:"#002244",textBlack:"#001122",gridLine:"#99bbdd",beatLine:"#88aacc",measureLine:"#336699"},Darkroom:{whiteKey:"#2c2c2c",blackKey:"#1e1e1e",labelWhite:"#2a2a2a",labelBlack:"#383838",textWhite:"#e0e0e0",textBlack:"#a0a0a0",gridLine:"#404040",beatLine:"#606060",measureLine:"#808080"}};class Qo{constructor(e,i,s,n){this.getBlackKeyMap=n,this.scroll=e,this.config=i,this.interactionStore=s}draw(e){const{totalMeasures:i,beatsPerMeasure:s,layout:{baseCellWidth:n,verticalCellRatio:r,labelWidth:a,headerHeight:o},behavior:{zoom:c}}=this.config,{gridColorScheme:d}=Ce().theme,l=qi[d],u=this.config.layout.highestMidi-this.config.layout.lowestMidi+1,h=n*c,f=h/r,p=this.scroll.getX(),g=this.scroll.getY();(e.canvas.width-a)/h;const y=i*s;e.save(),e.translate(a-p,o-g);const m=Math.max(0,Math.floor((p-a)/h));for(let _=0;_<=u;_++){const v=_*f;if(e.strokeStyle=l.gridLine,e.beginPath(),e.moveTo(0,v),e.lineTo(y*h,v),e.stroke(),_<u){const b=this.config.layout.highestMidi-_,S=this.getBlackKeyMap().get(b);e.fillStyle=S?l.blackKey:l.whiteKey,e.fillRect(0,v,y*h,f)}}for(let _=m;_<=y;_++){if(_<0)continue;const v=_*h;_%s===0?e.strokeStyle=l.measureLine:e.strokeStyle=l.beatLine,e.beginPath(),e.moveTo(v,0),e.lineTo(v,u*f),e.stroke()}e.restore()}}function el(t){const{layout:{labelWidth:e,baseCellWidth:i},totalMeasures:s,beatsPerMeasure:n,behavior:{zoom:r}}=t,a=i*r;return e+s*n*a}function tl(t){const{layout:{baseCellWidth:e,verticalCellRatio:i,highestMidi:s,lowestMidi:n,headerHeight:r},behavior:{zoom:a}}=t,o=s-n+1,c=e*a/i;return o*c+r}class il{constructor(e,i){this.scrollX=0,this.scrollY=0,this.canvas=e,this.config=i}getX(){return this.scrollX}getY(){return this.scrollY}setScroll(e,i){this.scrollX=this.clampX(e),this.scrollY=this.clampY(i)}recalculateBounds(){}getMaxScrollX(){const e=this.canvas.offsetWidth;return Math.max(0,this.getContentWidth()-e)}getMaxScrollY(){const e=this.canvas.offsetHeight-this.config.layout.headerHeight;return Math.max(0,this.getContentHeight()-e)}clampX(e){return Math.max(0,Math.min(e,this.getMaxScrollX()))}clampY(e){return Math.max(0,Math.min(e,this.getMaxScrollY()))}getContentWidth(){return el(this.config)}getContentHeight(){return tl(this.config)}}function Zt(t,e){const i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}function Br(t,e,i,s){const n=e.getBoundingClientRect();return{x:t.clientX-n.left+i.getX()-s.layout.labelWidth,y:t.clientY-n.top+i.getY()-s.layout.headerHeight}}function sl(t,e,i,s,n){const r=i.getBoundingClientRect();return{x:t-r.left+s.getX()-n.layout.labelWidth,y:e-r.top+s.getY()-n.layout.headerHeight}}function Qt(t,e,i,s,n=!1){const{layout:{labelWidth:r,headerHeight:a,baseCellWidth:o,verticalCellRatio:c,highestMidi:d,lowestMidi:l},behavior:{zoom:u}}=i,h=d-l+1,f=o*u,p=f/c,g=(t.x+e.getX()-r)/f,y=Math.floor((t.y+e.getY()-a)/p),m=n?s*(2/3):s,_=Math.floor(g/m)*m;return _>=0&&y>=0&&y<h?{x:_,y}:null}class rl{constructor(e,i){this.notes=[],this.noteIndex=new Map,this.pitchIndex=new Map,this.config=e,this.playNote=i}set(e){this.notes=e}getAll(){return this.notes}add(e){this.notes.push(e)}getTrackedNotes(e){const i=e.getHoveredNoteKey(),s=r=>e.isNoteHighlighted(r),n=new Set(e.getSelectedNotes().map(r=>`${r.pitch}:${r.start}`));return this.notes.map(r=>{const a=`${r.pitch}:${r.start}`;return{note:r,state:{hovered:a===i,selected:n.has(a),highlighted:s(r)}}})}remove(e){const i=`${e.pitch}:${e.start}`;this.notes=this.notes.filter(s=>!(s.pitch===e.pitch&&s.start===e.start)),this.noteIndex.delete(i)}removeAll(e){const i=new Set(e.map(s=>`${s.pitch}:${s.start}`));this.notes=this.notes.filter(s=>!i.has(`${s.pitch}:${s.start}`));for(const s of i)this.noteIndex.delete(s)}rebuildIndex(){this.noteIndex.clear(),this.pitchIndex.clear();for(const e of this.notes){const i=`${e.pitch}:${e.start}`;this.noteIndex.set(i,e),this.pitchIndex.has(e.pitch)||this.pitchIndex.set(e.pitch,[]),this.pitchIndex.get(e.pitch).push(e)}for(const e of this.pitchIndex.values())e.sort((i,s)=>i.start-s.start)}findNoteAtMousePosition(e,i,s,n,r){const a=Zt(e,i);Q("Raw mouse pos (grid-relative)",a);const o=Jo(),c=Qt(a,s,n,o);if(!c){Q("Snapped position is invalid",{mouse:a,snap:o});return}const d=ve(c.y,n.layout.lowestMidi,n.layout.highestMidi),l=c.x;Q("Snapped grid position",c),Q("Computed pitch and beat",{pitch:d,beat:l});const u=r.findNoteUnderCursor(d,l);return Q("Note under cursor (if any)",u),u}findAtPosition(e,i){return this.noteIndex.get(`${e}:${i}`)}findNoteUnderCursor(e,i){const s=this.pitchIndex.get(e);if(!s||s.length===0)return;let n=0,r=s.length-1,a=-1;for(;n<=r;){const o=Math.floor((n+r)/2);s[o].start<=i?(a=o,n=o+1):r=o-1}if(a!==-1)for(let o=a;o>=0;o--){const c=s[o];if(i>=c.start&&i<c.start+c.duration)return c;if(c.start+c.duration<i)break}}findNoteEdgeAtCursor(e,i,s=.25){const n=this.pitchIndex.get(e);if(!n||n.length===0)return;let r=0,a=n.length-1,o=-1;for(;r<=a;){const c=Math.floor((r+a)/2);n[c].start<=i?(o=c,r=c+1):a=c-1}if(o!==-1)for(let c=o;c>=0;c--){const d=n[c],l=d.start+d.duration*(1-s),u=d.start+d.duration;if(i>=l&&i<=u)return d;if(d.start+d.duration<i)break}}mergeSelections(e,i){const s=new Set,n=[];for(const r of[...e,...i]){const a=`${r.pitch}:${r.start}`;s.has(a)||(s.add(a),n.push(r))}return n}previewNote(e,i,s=100,n=!1){this.playNote(e,i,s,n)}}function yt(t,e,i,s,n,r=4){t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+s-r,i),t.quadraticCurveTo(e+s,i,e+s,i+r),t.lineTo(e+s,i+n-r),t.quadraticCurveTo(e+s,i+n,e+s-r,i+n),t.lineTo(e+r,i+n),t.quadraticCurveTo(e,i+n,e,i+n-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath()}function nl(t,e,i,s){const{layout:{baseCellWidth:n,verticalCellRatio:r,highestMidi:a,lowestMidi:o},behavior:{zoom:c}}=i,d=a-o+1,l=n*c,u=l/r,h=s.offsetWidth,f=s.offsetHeight,p=0,g=t/l-p,y=(t+h)/l+p,m=Math.floor(e/u),_=Math.min(d-1,Math.ceil((e+f)/u)+p),v=new Map;return b=>b.filter(({note:S})=>{if(S.start+S.duration<g||S.start>y)return!1;let C=v.get(S.pitch);if(C==null){const M=Fi(S.pitch,o,a);if(M==null||M<0||M>=d)return!1;C=M,v.set(S.pitch,C)}return C>=m&&C<=_})}function al(t){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;t=t.replace(e,(u,h,f,p)=>h+h+f+f+p+p);const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);if(!i)return null;const s=parseInt(i[1],16)/255,n=parseInt(i[2],16)/255,r=parseInt(i[3],16)/255,a=Math.max(s,n,r),o=Math.min(s,n,r);let c=0,d=0,l=(a+o)/2;if(a!==o){const u=a-o;switch(d=l>.5?u/(2-a-o):u/(a+o),a){case s:c=(n-r)/u+(n<r?6:0);break;case n:c=(r-s)/u+2;break;case r:c=(s-n)/u+4;break}c*=60}return{h:Math.round(c),s:Math.round(d*100),l:Math.round(l*100)}}const ol=["#FF0000","#9400D3","#FFFF00","#FF69B4","#00FF00","#00FFFF","#0000FF","#8A2BE2","#FF8C00","#FFD700","#ADFF2F","#DC143C"];function ll(t,e){const i=al(t);if(!i)return"#999";const n=10+(e??100)/127*50;return`hsl(${i.h}, ${i.s}%, ${n}%)`}function Nt(t){return(e,i)=>{const s=t(e,i);return ll(s,e.velocity)}}function dl(t){const e=V(t.pitch);if(e==null)return"#999";const i=e*3%360,s=100,n=60,a=.2+(t.velocity??100)/127*.8;return`hsla(${i}, ${s}%, ${n}%, ${a})`}const cl={Scriabin:Nt((t,{getPitchClass:e}={})=>{const i=e?e(t.pitch):0;return ol[i]||"#999"}),"Track Color":Nt((t,{getTrackColor:e}={})=>(e==null?void 0:e())||"#999"),"Note Velocity":Nt((t,{getTrackColor:e}={})=>(e==null?void 0:e())||"#ff0000"),"Octave Bands":dl,"Pitch Class Contrast":Nt((t,{getPitchClass:e}={})=>{const i=V(t.pitch);if(i==null)return"#999";const s=i%12;return["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"][s]||"#999"})};function ul(t){return t<0&&(console.error(`Invalid trackId: ${t}. Using default color.`),t=0),Ke[t%Ke.length]}class fl{constructor(e,i,s,n,r){this.scroll=e,this.config=i,this.noteManager=s,this.interactionStore=n,this.sequencerId=r}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,labelWidth:n,headerHeight:r},behavior:{zoom:a}}=this.config,{noteColorScheme:o}=Ce().theme,c=cl[o]||(()=>"#999"),d={getPitchClass:Qa,getTrackColor:()=>ul(this.sequencerId)},l=i*a,u=l/s,h=this.scroll.getX(),f=this.scroll.getY(),p=e.canvas,g=this.noteManager.getTrackedNotes(this.interactionStore);e.save(),e.translate(n-h,r-f);const m=nl(h,f,this.config,p)(g);for(const{note:_,state:v}of m){const S=Fi(_.pitch,this.config.layout.lowestMidi,this.config.layout.highestMidi)*u,N=_.start*l,C=_.duration*l,M=u,E=c(_,d);e.fillStyle=E,yt(e,N,S,C,M,4),e.fill(),(v.selected||v.hovered||v.highlighted)&&(e.lineWidth=2,e.strokeStyle=v.selected?"#ffffff":v.hovered?"#ff9933":"#33ff99",yt(e,N,S,C,M,4),e.stroke())}e.restore()}}class hl{constructor(e,i,s,n){this.scroll=e,this.config=i,this.store=s,this.getNoteDuration=n}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:c}}=this.config,d=i*c,l=d/s;e.save(),e.translate(n-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(100, 180, 255, 0.5)";const u=this.store.getPreviewNotes();if(u.length>0){const m=o-a+1;for(const _ of u){const v=dt(_.pitch);if(v===null)continue;const b=m-1-(v-a),S=_.start*d,N=b*l,C=_.duration*d;yt(e,S,N,C,l,3),e.fill()}e.restore();return}const h=this.store.getSnappedCursorGridPosition();if(!h){e.restore();return}const f=this.getNoteDuration(),p=h.x*d,g=h.y*l,y=d*f;yt(e,p,g,y,l,3),e.fill(),e.restore()}}class ml{constructor(e,i){this.scroll=e,this.config=i,this.animations=[]}playNote(e){const i=performance.now(),s=me();let n=e.duration*6e4/s;n=Math.max(100,Math.min(n,1600));const a=(V(e.pitch)||0)*5%360;this.animations.push({note:e,startTime:i,duration:n,hue:a})}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:c}}=this.config,d=this.scroll.getX(),l=this.scroll.getY(),u=i*c,h=u/s,f=performance.now();e.clearRect(0,0,e.canvas.width,e.canvas.height),this.animations=this.animations.filter(p=>{const g=(f-p.startTime)/p.duration;if(g>1)return!1;const{note:y,hue:m}=p,_=V(y.pitch);if(_==null||_<a||_>o)return!0;const v=o-_,b=y.start*u+n-d,S=v*h+r-l,N=y.duration*u,C=h-1,M=b+N/2,E=S+C/2,k=Math.sin(g*Math.PI),L=`hsla(${m}, 100%, 70%, ${.4*k})`;e.save(),e.globalAlpha=1,e.fillStyle=L,e.beginPath(),e.roundRect(b,S,N,C,4),e.fill();const F=2,A=50;for(let U=0;U<F;U++){const D=U*A,q=Math.max(0,Math.min(1,(f-p.startTime-D)/(p.duration-D))),P=Math.sin(q*Math.PI),G=1+(.1+U*.1)*P,J=(1-q)*.3;e.globalAlpha=J,e.strokeStyle=`hsl(${m}, 100%, 65%)`,e.lineWidth=1.5;const R=N*G,ie=C*G;e.beginPath(),e.roundRect(M-R/2,E-ie/2,R,ie,4),e.stroke()}return e.restore(),!0}),this.animations.length>0&&requestAnimationFrame(()=>this.draw(e))}}class pl{constructor(e,i){this.scroll=e,this.config=i,this.x=null}setPlayheadX(e){this.x=e}clear(){this.x=null}draw(e){if(this.x==null)return;const{layout:{verticalCellRatio:i,baseCellWidth:s,labelWidth:n,headerHeight:r,highestMidi:a,lowestMidi:o},behavior:{zoom:c}}=this.config,d=a-o+1,l=this.scroll.getX(),u=this.scroll.getY(),h=s*c/i,f=d*h+r,p=this.x;e.save(),e.translate(n-l,-u),e.lineWidth=2,e.strokeStyle="rgba(168, 85, 247, 1.0)",e.shadowColor="rgba(168, 85, 247, 0.5)",e.shadowBlur=6,e.beginPath(),e.moveTo(p,0),e.lineTo(p,f),e.stroke(),e.restore()}}class Ct{constructor(e,i=!0){this.canvas=e,this.dpr=i&&window.devicePixelRatio||1;const s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.ctx=s}resize(){const e=this.canvas.offsetWidth,i=this.canvas.offsetHeight,s=Math.floor(e*this.dpr),n=Math.floor(i*this.dpr);(this.canvas.width!==s||this.canvas.height!==n)&&(this.canvas.width=s,this.canvas.height=n,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr))}getContext(){return this.ctx}withContext(e){e(this.ctx)}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}destroy(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class is{constructor(e,i,s,n,r){this.thumb=e,this.isHorizontal=i,this.scroll=s,this.interactionStore=n,this.requestRedraw=r,this.onMouseEnter=()=>this.interactionStore.setIsOnScrollbar(!0),this.onMouseLeave=()=>this.interactionStore.setIsOnScrollbar(!1),this.onThumbMouseDown=o=>this.handleMouseDown(o),this.onMouseMove=null,this.onMouseUp=null;const a=this.thumb.parentElement;if(!a)throw new Error("Scrollbar thumb must have a parent track element.");this.track=a,this.attachDragHandler()}attachDragHandler(){this.track.addEventListener("mouseenter",this.onMouseEnter),this.track.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mouseenter",this.onMouseEnter),this.thumb.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mousedown",this.onThumbMouseDown)}handleMouseDown(e){e.preventDefault(),this.interactionStore.setIsScrolling(!0),this.onMouseMove=i=>{const s=this.track.getBoundingClientRect(),n=this.isHorizontal?this.track.offsetWidth:this.track.offsetHeight,a=(this.isHorizontal?i.clientX:i.clientY)-(this.isHorizontal?s.left:s.top),o=this.isHorizontal?this.thumb.offsetWidth:this.thumb.offsetHeight,c=n-o,d=Math.max(0,Math.min(a-o/2,c)),l=c>0?d/c:0,u=this.isHorizontal?this.scroll.getMaxScrollX():this.scroll.getMaxScrollY(),h=l*u;this.isHorizontal?this.scroll.setScroll(h,this.scroll.getY()):this.scroll.setScroll(this.scroll.getX(),h),this.requestRedraw()},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.interactionStore.setIsScrolling(!1),this.onMouseMove=null,this.onMouseUp=null},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){this.track.removeEventListener("mouseenter",this.onMouseEnter),this.track.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mouseenter",this.onMouseEnter),this.thumb.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mousedown",this.onThumbMouseDown),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&document.removeEventListener("mouseup",this.onMouseUp),this.onMouseMove=null,this.onMouseUp=null}}let ss=!1;function yl(){if(ss)return;const t=document.createElement("style");t.textContent=`
    .grid-scrollbars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .grid-scrollbar {
      position: absolute;
      background: #1f1f1f;
      pointer-events: all;
    }

    .grid-scrollbar-thumb {
      position: absolute;
      background: #888;
      border-radius: 6px;
      cursor: pointer;
    }

    .grid-scrollbar-corner {
      position: absolute;
      width: 12px;
      height: 12px;
      bottom: 0;
      right: 0;
      background: #1f1f1f;
      z-index: 2;
      pointer-events: none;
    }
  `,document.head.appendChild(t),ss=!0}const rs={"bg-purple-700":"#7e22ce"};class _l{constructor(e,i,s,n,r){this.container=e,this.scroll=i,this.config=s,this.interactionStore=n,this.requestRedraw=r,this.trackThickness=16,yl(),this.createDOM(),this.attachEvents(),this.config=this.config,this.interactionStore=n}createDOM(){const e=this.hScrollbar=document.createElement("div"),i=this.hThumb=document.createElement("div"),s=this.vScrollbar=document.createElement("div"),n=this.vThumb=document.createElement("div"),r=this.corner=document.createElement("div");e.className="grid-scrollbar",s.className="grid-scrollbar",i.className="grid-scrollbar-thumb",n.className="grid-scrollbar-thumb",r.className="grid-scrollbar-corner",e.style.position=s.style.position=r.style.position="absolute",e.style.zIndex=s.style.zIndex=r.style.zIndex="5",e.style.bottom="0",e.style.left="0",e.style.right=`${this.trackThickness}px`,e.style.height=`${this.trackThickness}px`,s.style.top="0",s.style.right="0",s.style.bottom=`${this.trackThickness}px`,s.style.width=`${this.trackThickness}px`,r.style.width=`${this.trackThickness}px`,r.style.height=`${this.trackThickness}px`,r.style.right="0",r.style.bottom="0",r.style.background="#333",r.style.position="absolute",i.style.zIndex=n.style.zIndex="6",i.style.position=n.style.position="absolute",i.style.background=rs["bg-purple-700"],n.style.background=rs["bg-purple-700"],i.style.borderRadius=n.style.borderRadius="8px",i.style.height="100%",n.style.width="100%",e.appendChild(i),s.appendChild(n),this.container.appendChild(e),this.container.appendChild(s),this.container.appendChild(r)}attachEvents(){this.hDragHandler=new is(this.hThumb,!0,this.scroll,this.interactionStore,this.requestRedraw),this.vDragHandler=new is(this.vThumb,!1,this.scroll,this.interactionStore,this.requestRedraw)}update(){const{width:e,height:i}=this.container.getBoundingClientRect(),s=this.scroll.getContentWidth(),n=this.scroll.getContentHeight(),r=this.scroll.getX(),a=this.scroll.getY(),o=this.scroll.getMaxScrollX(),c=this.scroll.getMaxScrollY(),d=e-this.trackThickness,l=this.config.layout.labelWidth,u=Math.max(40,(e-l)/s*d),h=r/o*(d-u);this.hThumb.style.width=`${u}px`,this.hThumb.style.left=`${Math.max(0,h)}px`;const f=i-this.trackThickness,p=this.config.layout.headerHeight,g=Math.max(40,(i-p)/n*f),y=a/c*(f-g);this.vThumb.style.height=`${g}px`,this.vThumb.style.top=`${Math.max(0,y)}px`}destroy(){this.hDragHandler.destroy(),this.vDragHandler.destroy(),this.hScrollbar.remove(),this.vScrollbar.remove(),this.corner.remove(),this.hScrollbar=null,this.vScrollbar=null,this.corner=null}}var w=(t=>(t[t.NoteTool=0]="NoteTool",t[t.Selecting=1]="Selecting",t[t.SelectedIdle=2]="SelectedIdle",t[t.Dragging=3]="Dragging",t[t.Pasting=4]="Pasting",t[t.Sizing=5]="Sizing",t))(w||{});function Ut(t,e,i,s,n){const r=Zt(t,e),a=i.getSnapResolution(),o=i.isTripletMode();return Qt(r,s,n,a,o)}function Dt(t,e,i,s){const{baseCellWidth:n}=s.layout,{zoom:r}=s.behavior,a=Br(t,e,i,s),o=n*r;return a.x/o}var $=(t=>(t.Default="default",t.Pointer="pointer",t.Crosshair="crosshair",t.Grabbing="grabbing",t.Grab="grab",t.ResizeHorizontal="ew-resize",t.ResizeVertical="ns-resize",t.Move="move",t.NotAllowed="not-allowed",t.Custom="url(cursor.png), auto",t))($||{});function Ni(t,e,i,s){return!t||t.x>=ae()?(e.setSnappedCursorGridPosition(null),e.setHoveredNoteKey(null),i.set($.Default),s(),!0):!1}class gl{constructor(e,i,s,n,r,a,o,c,d,l,u,h){this.canvas=e,this.noteManager=i,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const i=Ut(e,this.canvas,this.grid,this.scroll,this.config);if(Ni(i,this.store,this.cursorController,this.requestRedraw))return;const s=Dt(e,this.canvas,this.scroll,this.config);if(i){const n=ve(i.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s),a=this.store.getHoveredNoteKey();if(r&&a===`${r.pitch}:${r.start}`){this.store.setSelectedNotes([r]),this.controller.transitionTo(w.Sizing);return}}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const i=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(i*i+s*s);if(this.store.isDraggingToSelect()){const l=this.store.getHoveredNoteKey();if(l&&n>=this.dragThreshold){const[u,h]=l.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(w.Dragging);return}}if(n>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(w.Selecting);return}}const r=Ut(e,this.canvas,this.grid,this.scroll,this.config);if(!r||Ni(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=ve(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=Dt(e,this.canvas,this.scroll,this.config),c=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(c){const l=`${c.pitch}:${c.start}`;this.store.setHoveredNoteKey(l),this.store.setSnappedCursorGridPosition(null),d===c?this.cursorController.set($.ResizeHorizontal):this.cursorController.set($.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set($.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0)return;if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}this.store.isDraggingToSelect()&&this.store.endSelectionDrag();const i=this.store.getHoveredNoteKey();if(i){if(performance.now()-this.store.getLastDeletionTime()<100)return;const[d,l]=i.split(":"),u=this.noteManager.findAtPosition(d,Number(l));if(u){this.noteManager.previewNote(u.pitch,.25),this.store.setSelectedNotes([u]),this.controller.transitionTo(w.SelectedIdle);return}}const s=this.store.getSnappedCursorGridPosition();if(!s)return;const{layout:n}=this.config,r=this.grid.getNoteDuration(),a=ve(s.y,n.lowestMidi,n.highestMidi);if(!a||this.noteManager.findAtPosition(a,s.x))return;const c={start:s.x,duration:r,pitch:a,velocity:100};O(hr(this.getSequencerId(),[c]),mr(this.getSequencerId(),[c])),this.noteManager.previewNote(a,r),this.playNoteAnimation({start:s.x,duration:r,pitch:a,velocity:100})}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const i=this.store.getHoveredNoteKey();if(!i)return;const[s,n]=i.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(O(nt(this.getSequencerId(),[a]),at(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set($.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(w.Pasting)}}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}function ns(t,e,i,s,n){const{layout:{baseCellWidth:r,verticalCellRatio:a,lowestMidi:o,highestMidi:c},behavior:{zoom:d}}=s,l=r*d,u=l/a,h=Math.min(e.startX,e.currentX+l/2),f=Math.max(e.startX,e.currentX+l/2),p=Math.min(e.startY,e.currentY),g=Math.max(e.startY,e.currentY),y=n.getSnapResolution(),m=Math.floor(h/l/y)*y,_=Math.floor(f/l/y)*y,v=Math.floor(p/u),b=Math.floor(g/u),S=Math.min(v,b),N=Math.max(v,b);return t.filter(C=>{const M=Fi(C.pitch,o,c);if(M==null)return!1;const E=M>=S&&M<=N,k=C.start+C.duration,L=C.start>=m&&k<=_;return E&&L})}class bl{constructor(e,i,s,n,r,a,o,c){this.canvas=e,this.config=i,this.scroll=s,this.grid=n,this.store=r,this.controller=a,this.noteManager=o,this.requestRedraw=c}onEnter(){const e=sl(this.controller.getLastMouseX(),this.controller.getLastMouseY(),this.canvas,this.scroll,this.config);this.store.setMarqueeBox({startX:e.x,startY:e.y,currentX:e.x,currentY:e.y})}onMouseMove(e){const i=this.store.getMarqueeBox();if(!i)return;const s=Br(e,this.canvas,this.scroll,this.config);i.currentX=s.x,i.currentY=s.y,this.store.setMarqueeBox({...i});const n=ns(this.noteManager.getAll(),i,this.scroll,this.config,this.grid);this.store.setHighlightedNotes(n),this.requestRedraw()}onMouseUp(e){const i=this.store.getMarqueeBox();if(!i){this.controller.transitionTo(w.NoteTool);return}const s=ns(this.noteManager.getAll(),i,this.scroll,this.config,this.grid),r=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(s.length>0){const a=this.store.getSelectedNotes(),o=r?this.noteManager.mergeSelections(a,s):s;this.store.setSelectedNotes(o),this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(w.SelectedIdle)}else this.store.clearSelection(),this.controller.transitionTo(w.NoteTool)}onMouseLeave(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(w.NoteTool)}onExit(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.requestRedraw()}}class vl{constructor(e,i,s,n,r,a,o,c,d,l,u,h){this.canvas=e,this.config=i,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=c,this.controller=d,this.cursorController=l,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const i=Ut(e,this.canvas,this.grid,this.scroll,this.config);if(!i)return;const s=Dt(e,this.canvas,this.scroll,this.config),n=ve(i.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s);if(r){const a=`${r.pitch}:${r.start}`;new Set(this.store.getSelectedNotes().map(c=>`${c.pitch}:${c.start}`)).has(a)||this.store.setSelectedNotes([r]),this.controller.transitionTo(w.Sizing);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set($.Default),this.requestRedraw();return}const i=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(i*i+s*s);if(this.store.isDraggingToSelect()){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[p,g]=f.split(":"),y=parseFloat(g),m=this.noteManager.findAtPosition(p,y);if(!m)return;this.store.getSelectedNotes().some(b=>b.pitch===m.pitch&&b.start===m.start)||this.store.setSelectedNotes([m]),this.store.setDragAnchorNoteKey(`${m.pitch}:${m.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(w.Dragging);return}if(!f&&n>=this.dragThreshold){!e.ctrlKey&&!e.metaKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(w.Selecting);return}}const r=Zt(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),c=Qt(r,this.scroll,this.config,a,o);if(!c){this.store.setHoveredNoteKey(null),this.cursorController.set($.Default),this.requestRedraw();return}const d=Dt(e,this.canvas,this.scroll,this.config),l=ve(c.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(l,d),h=this.noteManager.findNoteEdgeAtCursor(l,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set($.ResizeHorizontal):this.cursorController.set($.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set($.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement())return;this.store.endSelectionDrag();const i=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(i){const s=`${i.pitch}:${i.start}`,n=this.store.getSelectedNotes(),r=n.some(c=>`${c.pitch}:${c.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const c=n.filter(d=>`${d.pitch}:${d.start}`!==s);this.store.setSelectedNotes(c)}else this.noteManager.previewNote(i.pitch,.25),this.store.setSelectedNotes([...n,i]);this.controller.transitionTo(w.SelectedIdle);return}this.store.setSelectedNotes([i]),this.noteManager.previewNote(i.pitch,.25),this.controller.transitionTo(w.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(w.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const i=this.store.getHoveredNoteKey();if(!i)return;const[s,n]=i.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),c=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&c?O(nt(this.getSequencerId(),o),at(this.getSequencerId(),o)):O(nt(this.getSequencerId(),[a]),at(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(w.NoteTool)}onKeyDown(e){const i=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){i.length&&this.setClipboard(i);return}if(n&&e.key==="x"){if(!i.length)return;this.setClipboard(i),O(nt(this.getSequencerId(),i),at(this.getSequencerId(),i)),this.store.clearSelection(),this.controller.transitionTo(w.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(w.Pasting);return}if(e.key==="Delete"){if(!i.length)return;O(nt(this.getSequencerId(),i),at(this.getSequencerId(),i)),this.store.clearSelection(),this.controller.transitionTo(w.NoteTool)}}}function Sl({notes:t,anchorBeat:e,anchorMidi:i,targetBeat:s,targetMidi:n,lowestMidi:r,highestMidi:a}){const o=s-e,c=n-i,d=t.map(y=>y.start+o),l=t.map(y=>y.start+o+y.duration),u=Math.min(...d),h=Math.max(...l),f=Math.min(0,u),p=Math.max(0,h-ae()),g=o-f-p;return t.flatMap(y=>{const m=dt(y.pitch);if(m==null)return[];let _=m+c;_<r&&(_=r),_>a&&(_=a);const v=jt(_);return v?[{pitch:v,start:y.start+g,duration:y.duration,velocity:y.velocity??100}]:[]})}class Nl{constructor(e,i,s,n,r,a,o,c,d,l){this.canvas=e,this.config=i,this.scroll=s,this.store=n,this.grid=r,this.requestRedraw=a,this.getSequencerId=o,this.controller=c,this.cursorController=d,this.getClipboard=l}onMouseMove(e){const i=Ut(e,this.canvas,this.grid,this.scroll,this.config);if(!i||Ni(i,this.store,this.cursorController,this.requestRedraw))return;const s=this.getClipboard();if(!s.notes.length)return;const{lowestMidi:n,highestMidi:r}=this.config.layout,a=r-n+1,o=n+(a-1-i.y),c=i.x,d=Sl({notes:s.notes,anchorBeat:s.anchorBeat,anchorMidi:s.anchorMidi,targetBeat:c,targetMidi:o,lowestMidi:n,highestMidi:r});this.store.setPreviewNotes(d),this.cursorController.set($.Pointer),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const i=this.store.getPreviewNotes();i.length&&(O(hr(this.getSequencerId(),i),mr(this.getSequencerId(),i)),this.store.clearPreviewNotes(),this.controller.transitionTo(w.NoteTool))}onMouseLeave(){this.store.clearPreviewNotes(),this.controller.transitionTo(w.NoteTool)}onExit(){this.store.clearPreviewNotes(),this.requestRedraw()}}function Cl({originalNotes:t,anchorNote:e,targetPitch:i,targetBeat:s,lowestMidi:n,highestMidi:r}){const a=dt(i),o=dt(e.pitch);if(a==null||o==null)return[];const c=s-e.start,d=a-o,l=t.map(m=>m.start+c),u=t.map(m=>m.start+c+m.duration),h=Math.min(...l),f=Math.max(...u),p=Math.min(0,h),g=Math.max(0,f-ae()),y=c-p-g;return t.flatMap(m=>{const _=dt(m.pitch);if(_==null)return[];let v=_+d;v<n&&(v=n),v>r&&(v=r);const b=jt(v);return b?[{pitch:b,start:m.start+y,duration:m.duration,velocity:m.velocity??100}]:[]})}class Ml{constructor(e,i,s,n,r,a,o,c,d,l){this.canvas=e,this.config=i,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=c,this.cursorController=d,this.getSequencerId=l,this.originalNotes=[],this.anchorNote=null,this.hasMoved=!1,this.lastPreviewedPitch=null}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(w.NoteTool);return}this.originalNotes=e.map(n=>({...n}));const i=this.store.getDragAnchorNoteKey(),s=i?e.find(n=>`${n.pitch}:${n.start}`===i):e[0];this.anchorNote=s??e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasMoved=!1,this.requestRedraw()}onMouseMove(e){const i=Zt(e,this.canvas),s=this.grid.getSnapResolution(),n=this.grid.isTripletMode(),r=Qt(i,this.scroll,this.config,s,n);if(!r||!this.anchorNote)return;const{layout:a}=this.config,o=ve(r.y,a.lowestMidi,a.highestMidi);if(!o)return;const c=Cl({originalNotes:this.originalNotes,anchorNote:this.anchorNote,targetPitch:o,targetBeat:r.x,lowestMidi:a.lowestMidi,highestMidi:a.highestMidi});this.store.setPreviewNotes(c),this.hasMoved=!0,this.cursorController.set($.Grabbing),o!==this.lastPreviewedPitch&&(this.noteManager.previewNote(o,.25),this.lastPreviewedPitch=o),this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote)return;const i=this.store.getPreviewNotes();if(this.hasMoved&&i.some((n,r)=>n.start!==this.originalNotes[r].start||n.pitch!==this.originalNotes[r].pitch))O(pr(this.getSequencerId(),this.originalNotes,i),No(this.getSequencerId(),this.originalNotes,i));else for(const n of this.originalNotes)this.noteManager.add(n);this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(w.NoteTool)}onMouseLeave(){this.hasMoved=!1,this.controller.transitionTo(w.NoteTool)}onExit(){if(!this.hasMoved&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.store.setDragAnchorNoteKey(null),this.requestRedraw()}}class Bl{constructor(e,i,s,n,r,a,o,c,d,l){this.canvas=e,this.config=i,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=c,this.cursorController=d,this.getSequencerId=l,this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.hasResized=!1,this.hasMoved=!1,this.initialMouseX=0,this.accumulatedDelta=0}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(w.NoteTool);return}this.originalNotes=e.map(s=>({...s}));const i=this.store.getHoveredNoteKey();this.anchorNote=i?e.find(s=>`${s.pitch}:${s.start}`===i)??null:e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasResized=!1,this.hasMoved=!1,this.accumulatedDelta=0,this.initialMouseX=this.controller.getLastMouseX(),this.requestRedraw()}onMouseMove(e){if(!this.anchorNote)return;const i=this.grid.getSnapResolution(),n=this.grid.isTripletMode()?i*(2/3):i,r=e.clientX-this.initialMouseX,o=this.config.layout.baseCellWidth*this.config.behavior.zoom*n,c=r/o,d=Math.round(c);if(d===this.accumulatedDelta)return;this.accumulatedDelta=d;const l=d*n,u=this.originalNotes.map(h=>{const f=Math.max(n,h.duration+l);return{...h,duration:f}});this.previewNotes=u,this.store.setPreviewNotes(u),this.cursorController.set($.ResizeHorizontal),this.hasResized=!0,this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote||!this.hasResized)return;const i=this.originalNotes,n=this.previewNotes.map((a,o)=>({pitch:a.pitch,start:a.start,newDuration:a.duration})),r=i.map((a,o)=>({pitch:a.pitch,start:a.start,oldDuration:a.duration}));O(wo(this.getSequencerId(),n),Lo(this.getSequencerId(),r)),this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(w.NoteTool)}onMouseLeave(){this.controller.transitionTo(w.NoteTool)}onExit(){if(!this.hasResized&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.requestRedraw()}}class wl{constructor(e){this.data=e,this.mode=w.NoteTool,this.activeHandler=null,this.lastMouseX=0,this.lastMouseY=0,this.transitionTo(w.NoteTool)}handleMouseDown(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onMouseDown)==null||s.call(i,e)}handleMouseMove(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onMouseMove)==null||s.call(i,e)}handleMouseUp(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onMouseUp)==null||s.call(i,e)}handleContextMenu(e){var i,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(i=this.activeHandler)==null?void 0:i.onContextMenu)==null||s.call(i,e)}handleMouseLeave(){var e,i;(i=(e=this.activeHandler)==null?void 0:e.onMouseLeave)==null||i.call(e)}handleMouseEnter(e){var i,s;(s=(i=this.activeHandler)==null?void 0:i.onMouseEnter)==null||s.call(i,e)}handleKeyDown(e){var i,s;(s=(i=this.activeHandler)==null?void 0:i.onKeyDown)==null||s.call(i,e)}transitionTo(e){var i,s,n,r;Q(`Transitioning to mode: ${w[e]} from ${w[this.mode]}`),(s=(i=this.activeHandler)==null?void 0:i.onExit)==null||s.call(i),this.mode=e,this.activeHandler=this.createHandlerForMode(e),(r=(n=this.activeHandler)==null?void 0:n.onEnter)==null||r.call(n)}createHandlerForMode(e){const i={transitionTo:s=>this.transitionTo(s),getLastMouseX:()=>this.lastMouseX,getLastMouseY:()=>this.lastMouseY};switch(e){case w.NoteTool:return new gl(this.data.canvas,this.data.noteManager,this.data.scroll,this.data.config,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),i,this.data.cursorController,this.data.getClipboard,this.data.playNoteAnimation);case w.Selecting:return new bl(this.data.canvas,this.data.config,this.data.scroll,this.data.grid,this.data.store,i,this.data.noteManager,this.data.requestRedraw);case w.SelectedIdle:return new vl(this.data.canvas,this.data.config,this.data.scroll,this.data.noteManager,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),i,this.data.cursorController,this.data.setClipboard,this.data.getClipboard);case w.Pasting:return new Nl(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),i,this.data.cursorController,this.data.getClipboard);case w.Dragging:return new Ml(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,i,this.data.cursorController,()=>this.data.sequencerContext.getId());case w.Sizing:return new Bl(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,i,this.data.cursorController,()=>this.data.sequencerContext.getId());default:return{}}}destroy(){var e,i;(i=(e=this.activeHandler)==null?void 0:e.onExit)==null||i.call(e),this.activeHandler=null}}class Ll{constructor(e){this.current=$.Default,this.canvas=e}set(e){this.current!==e&&(this.canvas.style.cursor=e,this.current=e)}reset(){this.set($.Default)}}class Gl{constructor(e,i){this.context=e,this.canvas=i,this.onMouseMove=s=>{this.context.handleMouseMove(s)},this.onMouseDown=s=>{this.context.handleMouseDown(s)},this.onMouseUp=s=>{this.context.handleMouseUp(s)},this.onMouseLeave=()=>{this.context.handleMouseLeave()},this.onMouseEnter=s=>{var n,r;(r=(n=this.context).handleMouseEnter)==null||r.call(n,s)},this.onContextMenu=s=>{this.context.handleContextMenu(s)},this.onKeyDown=s=>{this.context.handleKeyDown(s)},this.attachListeners(),this.canvas.style.pointerEvents="auto"}attachListeners(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("contextmenu",this.onContextMenu),window.addEventListener("keydown",this.onKeyDown)}destroy(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("keydown",this.onKeyDown)}}class El{constructor(e,i,s){this.canvas=e,this.scroll=i,this.requestRedraw=s,this.SCROLL_SPEED_X=1,this.SCROLL_SPEED_Y=1,this.onWheel=n=>{n.preventDefault();const r=n.shiftKey||Math.abs(n.deltaX)>Math.abs(n.deltaY),a=n.deltaX||n.deltaY;if(r){const o=this.scroll.getX()+a*this.SCROLL_SPEED_X;this.scroll.setScroll(o,this.scroll.getY())}else{const o=this.scroll.getY()+n.deltaY*this.SCROLL_SPEED_Y;this.scroll.setScroll(this.scroll.getX(),o)}this.requestRedraw()},this.attachListeners()}attachListeners(){this.canvas.addEventListener("wheel",this.onWheel,{passive:!1})}destroy(){this.canvas.removeEventListener("wheel",this.onWheel)}}class Il{constructor(){this.snappedCursorGridPosition=null,this.previewNotes=[],this.hoveredNoteKey=null,this.marqueeBox=null,this.highlightedNoteKeys=new Set,this.selectedNotes=[],this.dragAnchorNoteKey=null,this.isOnScrollbar=!1,this.isScrolling=!1,this.isInitiatingSelectionDrag=!1,this.isDraggingNotes=!1,this.lastDeletionTime=0}setSnappedCursorGridPosition(e){this.snappedCursorGridPosition=e}getSnappedCursorGridPosition(){return this.snappedCursorGridPosition}setPreviewNotes(e){this.previewNotes=e}getPreviewNotes(){return this.previewNotes}clearPreviewNotes(){this.previewNotes=[]}setHoveredNoteKey(e){this.hoveredNoteKey=e}getHoveredNoteKey(){return this.hoveredNoteKey}setMarqueeBox(e){this.marqueeBox=e}getMarqueeBox(){return this.marqueeBox}hasMarquee(){return this.marqueeBox!==null}setHighlightedNotes(e){this.highlightedNoteKeys=new Set(e.map(i=>`${i.pitch}:${i.start}`))}clearHighlightedNotes(){this.highlightedNoteKeys.clear()}isNoteHighlighted(e){return this.highlightedNoteKeys.has(`${e.pitch}:${e.start}`)}getSelectedNotes(){return this.selectedNotes}setSelectedNotes(e){this.selectedNotes=e}clearSelection(){this.selectedNotes=[]}hasSelection(){return this.selectedNotes.length>0}setDragAnchorNoteKey(e){this.dragAnchorNoteKey=e}getDragAnchorNoteKey(){return this.dragAnchorNoteKey}setIsOnScrollbar(e){this.isOnScrollbar=e}getIsOnScrollbar(){return this.isOnScrollbar}setIsScrolling(e){this.isScrolling=e}isOnNonGridElement(){return this.isOnScrollbar||this.isScrolling}beginSelectionDrag(){this.isInitiatingSelectionDrag=!0}endSelectionDrag(){this.isInitiatingSelectionDrag=!1}isDraggingToSelect(){return this.isInitiatingSelectionDrag}setIsDraggingNotes(e){this.isDraggingNotes=e}getIsDraggingNotes(){return this.isDraggingNotes}isActivelyDragging(){return this.isDraggingNotes||this.isInitiatingSelectionDrag}setLastDeletionTime(){this.lastDeletionTime=performance.now()}getLastDeletionTime(){return this.lastDeletionTime}}class kl{constructor(e){this.container=this.createContainer(),e.appendChild(this.container),this.gridCanvas=this.createCanvas("gridCanvas"),this.noteCanvas=this.createCanvas("noteCanvas"),this.animationCanvas=this.createCanvas("animationCanvas"),this.playheadCanvas=this.createCanvas("playheadCanvas"),this.container.appendChild(this.gridCanvas),this.container.appendChild(this.noteCanvas),this.container.appendChild(this.animationCanvas),this.container.appendChild(this.playheadCanvas),this.gridCtx=this.getCtx(this.gridCanvas),this.noteCtx=this.getCtx(this.noteCanvas),this.animationCtx=this.getCtx(this.animationCanvas),this.playheadCtx=this.getCtx(this.playheadCanvas),this.injectContainerStyles(),this.injectCanvasStyles()}createContainer(){const e=document.createElement("div");return e.id="grid-container",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="#222",e.style.border="1px solid #333",e.style.overflow="hidden",e.style.boxShadow="0 0 20px rgba(0,0,0,0.4)",e.style.borderRadius="6px",e}createCanvas(e){const i=document.createElement("canvas");return i.id=e,i.style.display="block",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.pointerEvents="none",i}getCtx(e){const i=e.getContext("2d");if(!i)throw new Error(`2D context not available for canvas with id: ${e.id}`);return i}injectContainerStyles(){const e=document.createElement("style");e.textContent=`
        #grid-container canvas {
          z-index: 0;
        }
        #grid-container canvas#noteCanvas {
          z-index: 1;
        }
        #grid-container canvas#animationCanvas {
          z-index: 2;
        }
        #grid-container canvas#playheadCanvas {
          z-index: 3;
        }
      `,document.head.appendChild(e)}injectCanvasStyles(){}}class Al{constructor(e,i){this.scroll=e,this.config=i}draw(e){const{layout:{baseCellWidth:i,headerHeight:s,labelWidth:n},totalMeasures:r,beatsPerMeasure:a,behavior:{zoom:o}}=this.config,{gridColorScheme:c}=Ce().theme,d=qi[c],l=i*o,u=this.scroll.getX(),h=e.canvas.offsetWidth;e.save(),e.translate(n-u,0);const f=e.createLinearGradient(0,0,0,s);f.addColorStop(0,d.labelWhite),f.addColorStop(1,d.labelBlack),e.fillStyle=f,e.fillRect(-n+u,0,h,s);for(let p=0;p<=r;p++){const y=p*a*l,m=p%4===0;e.strokeStyle=m?d.measureLine:d.beatLine,e.lineWidth=m?2:1,e.beginPath(),e.moveTo(y,0),e.lineTo(y,s),e.stroke(),e.textAlign="center",e.textBaseline="top",e.fillStyle=m?d.textWhite:d.textBlack,e.font=`${m?"bold":""} ${Math.floor(s*.5)}px 'Inter', sans-serif`;const _=y+a*l/2;e.fillText(`${p+1}`,_,4)}e.restore()}}class Pl{constructor(e,i,s,n){this.scroll=e,this.config=i,this.getCustomLabels=s,this.getBlackKeyMap=n;const{lowestMidi:r,highestMidi:a}=i.layout;this.blackKeyMap=ar(r,a)}draw(e){const{layout:{baseCellWidth:i,verticalCellRatio:s,headerHeight:n,labelWidth:r,highestMidi:a,lowestMidi:o},behavior:{zoom:c}}=this.config,{gridColorScheme:d}=Ce().theme,l=qi[d],u=a-o+1,h=this.scroll.getY(),p=i*c/s,g=e.canvas.offsetHeight??u*p+n;e.save(),e.translate(0,-h);const y=e.createLinearGradient(0,0,0,g);y.addColorStop(0,l.labelWhite),y.addColorStop(1,l.labelBlack),e.fillStyle=y,e.fillRect(0,h,r,g),e.font=`${Math.floor(p*.6)}px 'Inter', sans-serif`,e.textAlign="right",e.textBaseline="middle",e.strokeStyle=l.gridLine,e.lineWidth=1,e.beginPath(),e.moveTo(r-.5,h),e.lineTo(r-.5,h+g),e.stroke();const m=this.getCustomLabels();for(let _=0;_<u;_++){const v=_*p+n,b=a-_,S=(m==null?void 0:m[b])??ve(_,o,a),N=this.getBlackKeyMap().get(b)??!1;e.fillStyle=N?l.textBlack:l.textWhite,e.fillText(S,r-8,v+p/2)}e.restore()}}class Fl{constructor(e,i,s){this.scroll=e,this.config=i,this.interactionStore=s}draw(e){const i=this.interactionStore.getMarqueeBox();if(!i)return;const{layout:{baseCellWidth:s,verticalCellRatio:n},behavior:{zoom:r}}=this.config,a=this.scroll.getX(),o=this.scroll.getY(),c=Math.min(i.startX,i.currentX),d=Math.min(i.startY,i.currentY),l=Math.abs(i.currentX-i.startX),u=Math.abs(i.currentY-i.startY);l<1||u<1||(e.save(),e.translate(this.config.layout.labelWidth-a,this.config.layout.headerHeight-o),e.strokeStyle="rgba(128, 90, 213, 1.0)",e.lineWidth=2,e.setLineDash([5,5]),yt(e,c,d,l,u,3),e.stroke(),e.restore())}}let wr={notes:[],anchorBeat:0,anchorMidi:0};function Tl(t){if(t.length===0)return;const e=t[0],i=e.start,s=K(e.pitch)??0;wr={notes:t.map(n=>({pitch:n.pitch,start:n.start,duration:n.duration,velocity:n.velocity??100})),anchorBeat:i,anchorMidi:s}}function Rl(){return wr}class Ol{constructor(){this.listeners={}}on(e,i){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(i)}off(e,i){var s;(s=this.listeners[e])==null||s.delete(i)}emit(e,i){var s;(s=this.listeners[e])==null||s.forEach(n=>n(i))}clear(e){var i;(i=this.listeners[e])==null||i.clear()}removeAllListeners(){var e;for(const i in this.listeners)(e=this.listeners[i])==null||e.clear()}}class xl{constructor(e,i={},s){this.sequencerConfig=z,this.needsRedraw=!0,this.customLabels=null,this.blackKeyMap=new Map,this.isDestroyed=!1,this.onWindowResize=()=>this.resize(),this.config=Yo(jo(),i),this.sequencerContext=s,this.recalculateLabelAndHeader(),this.gridManager=new kl(e);const{gridCanvas:n,noteCanvas:r,animationCanvas:a,playheadCanvas:o}=this.gridManager;this.gridCanvasManager=new Ct(n),this.noteCanvasManager=new Ct(r),this.animationCanvasManager=new Ct(a),this.playheadCanvasManager=new Ct(o);const c=this.gridManager.container;this.noteManager=new rl(this.config,this.sequencerContext.playNote),this.interactionStore=new Il,this.emitter=new Ol,this.scroll=new il(c,this.config),this.scrollbars=new _l(c,this.scroll,this.config,this.interactionStore,()=>this.requestRedraw()),this.wheelHandler=new El(c,this.scroll,()=>this.requestRedraw()),this.cursorController=new Ll(c);const d={canvas:r,noteManager:this.noteManager,scroll:this.scroll,config:this.config,store:this.interactionStore,grid:this,addNote:l=>this.noteManager.add(l),requestRedraw:()=>this.requestRedraw(),sequencerContext:s,cursorController:this.cursorController,setClipboard:Tl,getClipboard:Rl,playNoteAnimation:l=>this.playNoteAnimation(l)};this.interactionContext=new wl(d),this.inputTracker=new Gl(this.interactionContext,c),this.gridRenderer=new Qo(this.scroll,this.config,this.interactionStore,()=>this.getBlackKeyMap()),this.noteRenderer=new fl(this.scroll,this.config,this.noteManager,this.interactionStore,this.sequencerContext.getId()),this.notePreviewRenderer=new hl(this.scroll,this.config,this.interactionStore,()=>this.getNoteDuration()),this.animationRenderer=new ml(this.scroll,this.config),this.headerRenderer=new Al(this.scroll,this.config),this.labelRenderer=new Pl(this.scroll,this.config,()=>this.customLabels,()=>this.getBlackKeyMap()),this.playheadRenderer=new pl(this.scroll,this.config),this.marqueeRenderer=new Fl(this.scroll,this.config,this.interactionStore),this.initialZoom=this.zoom,this.customLabels=null,requestAnimationFrame(()=>this.resize()),this.playheadRenderer.setPlayheadX(0),this.attachListeners(),this.renderLoop()}attachListeners(){window.addEventListener("resize",this.onWindowResize)}detachListeners(){window.removeEventListener("resize",this.onWindowResize)}renderLoop(){this.isDestroyed||(this.needsRedraw&&(this.render(),this.needsRedraw=!1),requestAnimationFrame(()=>this.renderLoop()))}recalculateLabelAndHeader(){const{baseCellWidth:e,verticalCellRatio:i,labelWidthColumns:s,headerHeightRows:n}=this.config.layout,r=this.zoom,a=e*r,o=a/i;this.config.layout.labelWidth=s*a,this.config.layout.headerHeight=n*o}get zoom(){return this.config.behavior.zoom}set zoom(e){this.config.behavior.zoom=e}get notes(){const e=this.noteManager.getAll();return e||[]}render(){this.gridCanvasManager.clear(),this.noteCanvasManager.clear(),this.animationCanvasManager.clear(),this.playheadCanvasManager.clear();const e=this.gridCanvasManager.getContext(),i=this.noteCanvasManager.getContext(),s=this.animationCanvasManager.getContext(),n=this.playheadCanvasManager.getContext();this.gridRenderer.draw(e),this.noteRenderer.draw(i),this.notePreviewRenderer.draw(i),this.animationRenderer.draw(s),this.labelRenderer.draw(e),this.headerRenderer.draw(e),this.playheadRenderer.draw(n),this.interactionStore.hasMarquee()&&this.marqueeRenderer.draw(s),this.scrollbars.update()}requestRedraw(){this.needsRedraw=!0}resize(){this.gridCanvasManager.resize(),this.noteCanvasManager.resize(),this.animationCanvasManager.resize(),this.playheadCanvasManager.resize(),this.scroll.recalculateBounds(),this.scrollbars.update(),this.requestRedraw()}on(e,i){this.emitter.on(e,i)}off(e,i){this.emitter.off(e,i)}setPlayheadPixelX(e){this.playheadRenderer.setPlayheadX(e),this.requestRedraw()}getPixelsPerBeat(){return this.config.layout.baseCellWidth*this.config.behavior.zoom}setNotes(e){this.noteManager.set(e),this.requestRedraw()}playNoteAnimation(e){this.animationRenderer.playNote(e)}getTrackedNotes(){return this.noteManager.getTrackedNotes(this.interactionStore)}scrollTo(e,i){this.scroll.setScroll(e,i),this.scrollbars.update(),this.requestRedraw()}setZoom(e){this.zoom=e,this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.requestRedraw()}getZoom(){return this.zoom}resetZoom(){this.setZoom(this.initialZoom)}zoomIn(){this.setZoom(Math.min(this.config.behavior.maxZoom,this.zoom+.1))}zoomOut(){this.setZoom(Math.max(this.config.behavior.minZoom,this.zoom-.1))}setCustomLabels(e){this.customLabels=e,this.requestRedraw()}getMeasures(){return this.config.totalMeasures}setMeasures(e){this.config.totalMeasures=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getBeatsPerMeasure(){return this.config.beatsPerMeasure}setBeatsPerMeasure(e){this.config.beatsPerMeasure=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getTotalBeats(){return this.config.totalMeasures*this.config.beatsPerMeasure}setNoteRange(e,i){this.config.layout.lowestMidi=e,this.config.layout.highestMidi=i,this.blackKeyMap=ar(e,i),this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.resize(),this.requestRedraw()}refreshNoteRange(){this.setNoteRange(this.config.layout.lowestMidi,this.config.layout.highestMidi)}getBlackKeyMap(){return this.blackKeyMap}isTripletMode(){return this.sequencerConfig.isTripletMode}getNoteDuration(){return this.sequencerConfig.currentDuration}getSnapResolution(){return this.sequencerConfig.snapResolution}getInteractionStore(){return this.interactionStore}getNoteManager(){return this.noteManager}emit(e,i){this.emitter.emit(e,i)}destroy(){this.inputTracker.destroy(),this.wheelHandler.destroy(),this.scrollbars.destroy(),this.gridManager.container.remove(),this.gridCanvasManager.destroy(),this.noteCanvasManager.destroy(),this.animationCanvasManager.destroy(),this.playheadCanvasManager.destroy(),this.detachListeners(),this.emitter.removeAllListeners(),this.interactionContext.destroy(),this.isDestroyed=!0}}function Ul(t,e,i){return new xl(t,e,i)}function Lr({instrument:t,midi:e,time:i,duration:s,velocity:n}){var a;const r=((a=t.__midiMap)==null?void 0:a.get(e))??e;if(!(t!=null&&t.start)){console.warn("[startInstrumentNote] Instrument missing start() method");return}try{t.start({note:r,time:i,duration:s,velocity:n})}catch(o){console.warn("[startInstrumentNote] Failed to start instrument note",{midi:e,resolved:r,err:o})}}function Ji(t,e){var i;(i=t==null?void 0:t.stop)==null||i.call(t);for(const s of e)clearTimeout(s);e.length=0}async function Dl(t,e,i,s,n,r,a,o=0){if(!n)return;if(t||await e(),Ji(t,r),!(t!=null&&t.start)){console.warn("[playback] Instrument does not support scheduled playback.");return}const d=60/me(),l=performance.now();i.sort((h,f)=>h.start-f.start);let u=0;for(;u<i.length&&i[u].start<o;)u++;for(;u<i.length;u++){const h=i[u],f=V(h.pitch);if(f==null)continue;const p=h.start-o,g=a+p*d,y=h.duration*d,m=h.velocity??100;if(Lr({instrument:t,midi:f,time:g,duration:y,velocity:m}),!s){const _=l+p*d*1e3,v=Math.max(0,_-performance.now()),b=setTimeout(()=>{n==null||n.playNoteAnimation(h)},v);r.push(b)}}}function ql(t,e,i,s,n,r){if(!s||n)return;const o=60/me();performance.now();const l=(X().currentTime-e)/o,u=i+l;for(const h of t){if(h.start<u)continue;const p=(h.start-u)*o*1e3;if(p>=0){const g=setTimeout(()=>{s==null||s.playNoteAnimation(h)},p);r.push(g)}}}async function Jl(t,e,i,s,n,r,a,o,c,d=0){if(!s||(Ji(t,o),t||await e(),r||!a||!(t!=null&&t.start)))return;const u=60/me(),h=performance.now(),f=X().currentTime,p=i.filter(g=>g.start>=d);for(const g of p){const y=V(g.pitch);if(y==null)continue;const m=g.start-d,_=c+m*u;if(_<=f+.01)continue;const v=g.duration*u,b=g.velocity??100;if(Lr({instrument:t,midi:y,time:_,duration:v,velocity:b}),!n){const S=h+m*u*1e3,N=Math.max(0,S-performance.now()),C=setTimeout(()=>{s==null||s.playNoteAnimation(g)},N);o.push(C)}}}const Z=class Z{constructor(e,i,s=X(),n=He(),r="sf2/fluidr3-gm/acoustic_grand_piano",a=!1,o=0){if(this.colorIndex=0,this._registry=null,this.id=0,this.mute=!1,this.solo=!1,this.collapsed=!1,this.miniContour=null,this.body=null,this.collapseIcon=null,this._scheduledAnimations=[],this._volume=100/127,this._pan=0,this._instrument=null,Z.allSequencers.push(this),this.id=o,this.container=e,this.config={...i},this.context=s,this.destination=n,this.instrumentName=r,this.squelchLoadingScreen=a,this.container){const c=this.container.querySelector(".sequencer-body");this.matrix=Ul(c,{},{playNote:this.playNote.bind(this),getId:()=>this.id}),this.matrix.refreshNoteRange()}}static isAnySoloActive(){return Z.allSequencers.some(e=>e.solo)}static rescheduleAll(){if(!I.isActive())return;const e=I.getStartTime(),i=I.getStartBeat();for(const s of Z.allSequencers)s.stopScheduledNotes(),s.shouldPlay&&(s.reschedulePlayback(e,i),s.resumeAnimationsFromCurrentTime(e,i))}async initInstrument(){try{this._instrument=await nr(this.instrumentName,this.context,this.destination,this._volume,this._pan,!1,!1),this.updateToDrumNoteRange()}catch(e){console.warn(`[SEQ:${this.id}] Failed to load instrument '${this.instrumentName}':`,e)}}setInstrument(e){this.instrumentName=e,this.updateTrackLabel(),this.initInstrument()}updateTrackLabel(){var i;const e=(i=this.container)==null?void 0:i.querySelector(".track-name");e&&(e.textContent=`${this.id+1}: ${this.instrumentName}`)}get notes(){var e;return((e=this.matrix)==null?void 0:e.notes)??[]}get volume(){return this._volume}set volume(e){var i;this._volume=Math.max(0,Math.min(1,e)),(i=this._instrument)!=null&&i.setVolume&&this._instrument.setVolume(this._volume)}get pan(){return this._pan}set pan(e){var i;this._pan=Math.max(-1,Math.min(1,e)),(i=this._instrument)!=null&&i.setPan&&this._instrument.setPan(this._pan)}get shouldPlay(){return Z.isAnySoloActive()?this.solo:!this.mute}get scheduledAnimations(){return this._scheduledAnimations}set scheduledAnimations(e){this._scheduledAnimations=e}toggleMute(){this.mute=!this.mute,this.mute&&(this.solo=!1),this.stopScheduledNotes(),ts(this),I.isActive()&&Z.rescheduleAll()}toggleSolo(){this.solo=!this.solo,this.solo&&(this.mute=!1),ts(this),I.isActive()&&Z.rescheduleAll()}setCollapsed(e){Nr(this,e)}async preparePlayback(e,i=0){var s;await Dl(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.collapsed,this.matrix??null,this._scheduledAnimations,e,i)}stopScheduledNotes(){Ji(this._instrument,this._scheduledAnimations)}resumeAnimationsFromCurrentTime(e,i){var s;ql(((s=this.matrix)==null?void 0:s.notes)??[],e,i,this.matrix??null,this.collapsed,this._scheduledAnimations)}async reschedulePlayback(e,i=0){var s;await Jl(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.matrix??null,this.collapsed,this.mute,this.shouldPlay,this._scheduledAnimations,e,i)}async exportToOffline(e,i){var n;const s=i??((n=this.matrix)==null?void 0:n.notes);!s||s.length===0||await Ho(this.instrumentName,this.context,this.destination,s,this._volume,this._pan,e)}playNote(e,i,s=100,n=!1){return $a(this.instrumentName,e,i,s,n,null,Fe(),this.destination,this.volume,this.pan)}updateTotalMeasures(){this.matrix&&this.matrix.setMeasures(We())}updateBeatsPerMeasure(){this.matrix&&this.matrix.setBeatsPerMeasure(bt())}redraw(){var e;(e=this.matrix)==null||e.requestRedraw()}getState(){return this.matrix?{notes:[...this.matrix.notes],config:{...this.config},instrument:this.instrumentName}:{notes:[],config:this.config,instrument:this.instrumentName}}setState({notes:e,config:i,instrument:s,volume:n,pan:r}){this.matrix&&(this.matrix.setNotes(e),Object.assign(this.config,i),typeof n=="number"&&(this.volume=n),typeof r=="number"&&(this.pan=r),s&&(this.instrumentName=s),this.redraw())}updateNotesFromTrackMap(e){this.matrix&&this.matrix.notes.splice(0,this.matrix.notes.length,...e.n.map(([i,s,n,r=100])=>({pitch:i,start:s,duration:n,velocity:r})))}updateNoteRange(e){Si({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var i;return((i=this.matrix)==null?void 0:i.notes)??[]}},e)}updateToDrumNoteRange(){Xo({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var e;return((e=this.matrix)==null?void 0:e.notes)??[]}})}setRegistry(e){this._registry=e}destroy(){var e,i,s;this.stopScheduledNotes(),(e=this.matrix)==null||e.destroy(),(i=this.container)==null||i.remove(),Z.allSequencers=Z.allSequencers.filter(n=>n!==this),(s=this._registry)==null||s.clear(),this._instrument=null,this.matrix=void 0,this.container=null,this.refreshPanUI=void 0,this.refreshVolumeUI=void 0}};Z.allSequencers=[];let qt=Z,ge,Je,Gr,Er,Pe,ne,ue="sf2";function Hl(){ge=document.getElementById("instrument-select-modal"),Je=document.getElementById("instrument-select"),Gr=document.getElementById("instrument-select-confirm"),Er=document.getElementById("instrument-cancel-btn"),Pe=document.getElementById("instrument-engine-select"),ne=document.getElementById("instrument-library-select"),$l(),Kl()}function $l(){const t=Xa();Pe.innerHTML="",t.forEach(e=>{const i=document.createElement("option");i.value=e,i.textContent=e.toUpperCase(),Pe.appendChild(i)}),Pe.value=ue}function Kl(){Pe.addEventListener("change",async()=>{ue=Pe.value,await Ir()}),ne.addEventListener("change",()=>{const t=new CustomEvent("instrument-library-change",{detail:{preselect:null}});ne.dispatchEvent(t)}),ne.addEventListener("instrument-library-change",async t=>{var n;const e=t,i=ne.value,s=((n=e.detail)==null?void 0:n.preselect)??null;try{const r=await Wa(i,ue);Je.innerHTML="",r.forEach(a=>{const o=document.createElement("option");o.value=`${ue}/${i}/${a}`,o.textContent=a.split("_").map(c=>c?c[0].toUpperCase()+c.slice(1):"").join(" "),Je.appendChild(o)}),s?Je.value=s:r.length>0&&(Je.value=`${ue}/${i}/${r[0]}`)}catch(r){console.error(`Failed to load instruments for library: ${i}`,r)}}),Gr.addEventListener("click",zl),Er.addEventListener("click",Wl)}async function Ir(t=null,e=null){try{const i=await za(ue);ne.innerHTML="",i.forEach(n=>{const r=document.createElement("option");r.value=n,r.textContent=n.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),ne.appendChild(r)}),t&&i.includes(t)?ne.value=t:i.length>0&&(ne.value=i[0]);const s=new CustomEvent("instrument-library-change",{detail:{preselect:e}});ne.dispatchEvent(s)}catch(i){console.error("Failed to refresh libraries for engine:",ue,i)}}async function kr(t,e){const[i,s,n]=t.split("/");ue=i||"sf2",Pe.value=ue,e!==void 0?ge.dataset.currentSequencer=String(e):delete ge.dataset.currentSequencer,await Ir(s,t)}async function zl(){const t=Je.value;ge.classList.add("hidden");const e=Number(ge.dataset.currentSequencer);if(ge.dataset.currentSequencer!==void 0&&!isNaN(e)){const i=ed(e);if(i){O(uo(i.id,t),fo(i.id,i.instrumentName)),i.setInstrument(t);return}console.warn(`Failed to find sequencer with ID ${e}`);return}if(ge.dataset.currentSequencer===void 0)try{return await tr(t),window.dispatchEvent(new CustomEvent("global-instrument-selected",{detail:{fullName:t}})),t}catch(i){console.error("Failed to load global instrument:",t,i)}}function Wl(){ge.classList.add("hidden")}function Xl(t,e){var h;const i=(h=t.querySelector(".volume-fill"))==null?void 0:h.parentElement,s=t.querySelector(".volume-fill"),n=t.querySelector(".volume-thumb");let r=!1,a=!1,o=!1,c=null;if(!i||!s){console.warn("[setupVolumeBar] Volume bar or fill element missing.");return}function d(){const f=Math.max(0,Math.min(1,e.volume)),p=100/127,g=i.clientWidth,y=14,m=0,_=g-y,v=f*g,b=Math.max(m,Math.min(_,v-y/2)),S=Math.round(f*100);s.style.width=`${S}%`,n.style.left=`${b}px`;const N=Math.round(f/p*100);i.setAttribute("title",`Volume: ${N}%`),f>p?(s.classList.add("overdrive"),n.classList.add("overdrive")):(s.classList.remove("overdrive"),n.classList.remove("overdrive"))}function l(){a?(s.classList.add("precise"),n.classList.add("precise")):(s.classList.remove("precise"),n.classList.remove("precise"))}e.refreshVolumeUI=d,requestAnimationFrame(d);function u(f){const p=i.getBoundingClientRect(),g=f-p.left,y=100/127,m=.1;let _=Math.max(0,Math.min(1,g/p.width));return!a&&Math.abs(_-y)<m?(_=y,!r&&navigator.vibrate&&navigator.vibrate(10),r=!0):r=!1,e.volume=_,d(),_}i.addEventListener("mousedown",f=>{o=!0,a=f.shiftKey,c=e.volume,l(),u(f.clientX),f.preventDefault()}),window.addEventListener("mousemove",f=>{o&&(a=f.shiftKey,l(),u(f.clientX))}),window.addEventListener("mouseup",f=>{if(!o)return;o=!1;const p=u(f.clientX);c!==null&&p!==c&&O(mo(e.id,p),po(e.id,c)),a=!1,l(),s.classList.remove("precise"),n.classList.remove("precise"),d(),c=null})}function Vl(t,e){var h;const i=(h=t.querySelector(".pan-fill"))==null?void 0:h.parentElement,s=t.querySelector(".pan-fill"),n=t.querySelector(".pan-thumb");let r=!1,a=!1,o=!1,c=null;if(!i||!s){console.warn("[setupPanBar] Pan bar or fill element missing.");return}function d(){const f=Math.max(-1,Math.min(1,e.pan)),p=(f+1)/2,g=i.clientWidth,y=14,m=0,_=g-y,v=p*g,b=Math.max(m,Math.min(_,v-y/2)),S=Math.round(p*100);s.style.width=`${S}%`,n.style.left=`${b}px`;const N=Math.round(f*100);i.setAttribute("title",`Pan: ${N}%`)}e.refreshPanUI=d;function l(){a?(s.classList.add("precise"),n.classList.add("precise")):(s.classList.remove("precise"),n.classList.remove("precise"))}requestAnimationFrame(d);function u(f){const p=i.getBoundingClientRect(),g=f-p.left;let m=Math.max(0,Math.min(1,g/p.width))*2-1;const _=0;return!a&&Math.abs(m-_)<.05?(m=_,!r&&navigator.vibrate&&navigator.vibrate(10),r=!0):r=!1,e.pan=m,d(),m}i.addEventListener("mousedown",f=>{o=!0,a=f.shiftKey,c=e.pan,l(),u(f.clientX),f.preventDefault()}),window.addEventListener("mouseup",f=>{if(!o)return;o=!1;const p=u(f.clientX);c!==null&&p!==c&&O(_o(e.id,p),go(e.id,c)),a=!1,l(),s.classList.remove("precise"),n.classList.remove("precise"),d(),c=null}),window.addEventListener("mousemove",f=>{o&&(a=f.shiftKey,l(),u(f.clientX))})}class jl{constructor(){this.listeners=[]}on(e,i,s,n){e.addEventListener(i,s,n),this.listeners.push({target:e,type:i,handler:s,options:n})}clearHandler(e,i,s){for(let n=this.listeners.length-1;n>=0;n--){const r=this.listeners[n];r.target===e&&r.type===i&&r.handler===s&&(e.removeEventListener(i,s,r.options),this.listeners.splice(n,1))}}clear(){for(const{target:e,type:i,handler:s,options:n}of this.listeners)e.removeEventListener(i,s,n);this.listeners.length=0}}const T=[],Yl=document.getElementById("sequencers-container"),Zl=document.getElementById("sequencer-template"),Ql=document.getElementById("add-sequencer");function Ar(t){const e=new jl,s=Zl.content.cloneNode(!0).querySelector(".sequencer");Yl.insertBefore(s,Ql);const n=T.length,r={id:n,...z},a=(t==null?void 0:t.instrument)||"sf2/fluidr3-gm/acoustic_grand_piano",o=new qt(s,r,X(),He(),a,!0,n);o.id=n,o.colorIndex=n,o.mute=!1,o.solo=!1,o.volume=100/127,t!=null&&t.notes&&o.matrix&&o.matrix.setNotes(t.notes);const c=s.querySelector("canvas.mini-contour");t&&o.setState({notes:t.notes,config:{},instrument:t.instrument,volume:t.volume,pan:t.pan}),vt(c,o.notes,o.config,o.colorIndex),o.miniContour=c,o.updateTrackLabel(),o.initInstrument(),Xl(s,o),Vl(s,o);const d=s.querySelector(".collapse-btn"),l=d.querySelector("use"),u=s.querySelector(".sequencer-body");o.body=u,o.collapseIcon=l,e.on(d,"click",()=>{Nr(o,!o.collapsed)});const h=s.querySelector(".delete-btn");e.on(h,"click",()=>{const m=document.getElementById("delete-confirm-modal"),_=document.getElementById("delete-confirm"),v=document.getElementById("delete-cancel");m.classList.remove("hidden");const b=()=>{O(ur(o.id,o.instrumentName,o.notes,o.volume,o.pan),fr(o.id,o.instrumentName,o.notes,o.volume,o.pan)),N()},S=()=>N(),N=()=>{m.classList.add("hidden"),e.clearHandler(_,"click",b),e.clearHandler(v,"click",S)};e.on(_,"click",b),e.on(v,"click",S)});const f=s.querySelector(".mute-btn"),p=s.querySelector(".solo-btn"),g=s.querySelector(".instrument-select-btn"),y=(m,_)=>m.classList.toggle("side-button-activated",_);return e.on(f,"click",()=>{o.toggleMute(),y(f,o.mute),y(p,o.solo)}),e.on(p,"click",()=>{o.toggleSolo(),y(f,o.mute),y(p,o.solo)}),e.on(g,"click",async()=>{const m=o.instrumentName||"sf2/fluidr3-gm/acoustic_grand_piano";await kr(m,o.id),document.getElementById("instrument-select-modal").classList.remove("hidden")}),Ko(s,o.matrix,e),$o(s,()=>{var m;return(m=o.matrix)==null?void 0:m.zoomIn()},()=>{var m;return(m=o.matrix)==null?void 0:m.zoomOut()},()=>{var m;return(m=o.matrix)==null?void 0:m.resetZoom()},e),T.push(o),o.setRegistry(e),o.setCollapsed(!1),{seq:o,wrapper:s}}function te(){return T}function ed(t){const e=t;return T.find(i=>i.id===e)}function td(){var t,e;for(const i of T.slice())O(ur(i.id,i.instrumentName,((t=i.matrix)==null?void 0:t.getNoteManager().getAll())??[],i.volume,i.pan),fr(i.id,i.instrumentName,((e=i.matrix)==null?void 0:e.getNoteManager().getAll())??[],i.volume,i.pan))}function Pr(){return te()}function id(){Q("Sequencer Dump",Pr())}const sd=Object.freeze(Object.defineProperty({__proto__:null,dumpSequencers:id,getSequencers:Pr},Symbol.toStringTag,{value:"Module"}));function Fr(){return Ne()}function rd(){Q("App State Dump",Fr())}const nd=Object.freeze(Object.defineProperty({__proto__:null,dumpState:rd,getAppState:Fr},Symbol.toStringTag,{value:"Module"}));function ad(){const t=Object.create(null);return Object.assign(t,sd,nd),t}const od="SEQUENZIA_DEV";function ld(){if(typeof window>"u")return;localStorage.getItem(od)==="true"&&!ii()&&(Vi(),console.info("[SEQUENZIA] Dev mode re-enabled from localStorage")),window.toggleDevMode=()=>{const e=!ii();e?Vi():an(),console.info(`[SEQUENZIA] Dev mode ${e?"enabled":"disabled"}`),e?as():delete window.DEVTOOLS},ii()&&as()}function as(){window.DEVTOOLS=ad()}function dd(){const t=document.getElementById("feature-not-implemented-modal"),e=document.getElementById("feature-modal-close-btn");if(!t||!e){console.warn("Feature modal elements not found");return}function i(){t&&t.classList.remove("hidden")}e.addEventListener("click",()=>{t.classList.add("hidden")});const s=document.getElementById("piano-toggle-btn");s&&s.addEventListener("click",()=>{i()});const n=document.getElementById("mixer-toggle-btn");n&&n.addEventListener("click",()=>{i()});const r=document.getElementById("ai-toggle-btn");r&&r.addEventListener("click",()=>{i()});const a=document.getElementById("quantize-mode-menu-btn");a&&a.addEventListener("click",()=>{i()})}function cd(t,e){window.addEventListener("keydown",i=>{const s=(i.ctrlKey||i.metaKey)&&i.key.toLowerCase()==="z",n=(i.ctrlKey||i.metaKey)&&(i.key.toLowerCase()==="y"||i.shiftKey&&i.key.toLowerCase()==="z");if(!s&&!n)return;i.preventDefault(),i.target instanceof HTMLElement&&i.target.matches('input, textarea, [contenteditable="true"]')||(s?t():e())},{capture:!0})}function Hi(){const t=te();for(const e of t){const i=e.matrix;if(!i)continue;const s=i.getInteractionStore();if(s.hasSelection())return{sequencerId:e.id,selectedNotes:s.getSelectedNotes()}}return null}function ud(t){const e=Hi();if(!e){console.warn("No active note selection to apply velocity changes.");return}const{sequencerId:i,selectedNotes:s}=e;if(s.length===0){console.warn("No notes selected in the active sequencer.");return}const n=te().find(m=>m.id===i);if(!(n!=null&&n.matrix)){console.warn(`Could not find matrix for sequencer ID ${i}.`);return}const r=s.map(m=>({...m})),{mode:a,value:o,rampDirection:c="none",rampAmount:d=0,rampMode:l="linear",randomize:u=!1,randomRange:h=0}=t,f=s.map((m,_)=>({note:m,originalIndex:_}));f.sort((m,_)=>m.note.start-_.note.start);const p=new Map;for(const m of f){const _=m.note.start;p.has(_)||p.set(_,[]),p.get(_).push(m)}Array.from(p.entries()).sort((m,_)=>m[0]-_[0]).map(([,m])=>m).forEach((m,_)=>{let v=l==="linear"?_:Math.pow(_,1.3),b=d*v;c==="down"&&(b=-b);for(const{note:S}of m){let N;switch(a){case"set":N=Math.max(1,o);break;case"increase":N=(S.velocity??100)+o;break;case"decrease":N=(S.velocity??100)-o;break;case"none":default:N=S.velocity??100;break}let C=N+b;if(u&&h>0){const M=(Math.random()*2-1)*h;C+=M}S.velocity=Math.max(1,Math.min(127,Math.round(C)))}});const y=f.sort((m,_)=>m.originalIndex-_.originalIndex).map(({note:m})=>({...m}));O(Eo(i,y),Io(i,r))}const os="velocity-modal",fd="velocity-action-select",hd="velocity-value-input",md="velocity-apply-btn",pd="velocity-cancel-btn";function Tr(){const t=document.getElementById(os);if(!t)throw new Error(`[VelocityModeMenu] Modal element "#${os}" not found`);return t}function Rr(t){Tr().classList.remove("hidden")}function Or(){Tr().classList.add("hidden")}function yd(){var u,h,f,p,g,y,m,_,v;const t=((u=document.getElementById("velocity-set-toggle"))==null?void 0:u.checked)??!0,e=((h=document.getElementById("velocity-ramp-toggle"))==null?void 0:h.checked)??!1,i=((f=document.getElementById("velocity-randomize-toggle"))==null?void 0:f.checked)??!1,s=parseInt(((p=document.getElementById(hd))==null?void 0:p.value)??"",10),n=isNaN(s)?100:s,r=Math.max(1,Math.min(127,n)),a=t?(g=document.getElementById(fd))==null?void 0:g.value:"none",o=e?(y=document.getElementById("velocity-ramp-direction"))==null?void 0:y.value:"none",c=e?parseInt(((m=document.getElementById("velocity-ramp-amount"))==null?void 0:m.value)??"0",10):0,d=e?(_=document.querySelector('input[name="ramp-mode"]:checked'))==null?void 0:_.value:"linear",l=i?parseInt(((v=document.getElementById("velocity-random-range"))==null?void 0:v.value)??"0",10):0;ud({mode:a,value:r,rampDirection:o,rampAmount:c,rampMode:d,randomize:i,randomRange:l}),Or()}function _d(){Or()}function gd(){const t=document.getElementById("velocity-set-toggle"),e=document.getElementById("velocity-set-fields"),i=document.getElementById("velocity-ramp-toggle"),s=document.getElementById("velocity-ramp-fields"),n=document.getElementById("velocity-randomize-toggle"),r=document.getElementById("velocity-random-fields");if(t&&e&&t.addEventListener("change",()=>{e.classList.toggle("opacity-50",!t.checked),e.classList.toggle("pointer-events-none",!t.checked)}),i&&s&&(i.checked=!1,s.classList.add("opacity-50","pointer-events-none"),i.addEventListener("change",()=>{s.classList.toggle("opacity-50",!i.checked),s.classList.toggle("pointer-events-none",!i.checked)})),n&&r){const a=()=>{const o=n.checked;r.classList.toggle("opacity-50",!o),r.classList.toggle("pointer-events-none",!o)};n.addEventListener("change",a),a()}}function bd(){var t,e;(t=document.getElementById(md))==null||t.addEventListener("click",yd),(e=document.getElementById(pd))==null||e.addEventListener("click",_d),gd()}function xr(t){const e=document.getElementById("error-modal"),i=document.getElementById("error-message-content");if(!e||!i){console.error("Error modal elements not found");return}i.textContent=t,e.classList.remove("hidden")}var Fs;(Fs=document.getElementById("error-close-btn"))==null||Fs.addEventListener("click",()=>{var t;(t=document.getElementById("error-modal"))==null||t.classList.add("hidden")});function vd(){const t=Hi();if(!t||t.selectedNotes.length===0){xr("No notes selected. Please select notes before adjusting velocity.");return}Rr(t.selectedNotes)}function Sd(){const t=document.getElementById("velocity-mode-menu-btn");if(!t){console.warn('[VelocityMode] Could not find button with id "velocity-mode-menu-btn".');return}t.addEventListener("click",vd)}const Nd="v0.0.10",Cd="May 5, 2025",Md=[" New Features","-  Introduced fully modular matrix-based grid system for better performance and maintainability","-  Switched to multi-canvas rendering (grid, note, animation) for improved visual clarity and layering","-  Implemented robust interaction state machine for clean, extensible editing tools","-  Refined visual rendering of note grid, headers, and pitch labels for better contrast and UX","-  WebAudioFont engine support finalized for broader instrument playback","-  Fixed WAV export context handling for improved reliability"," Known Issues","-  Note placement during live playback of large sequences causes performance issues","-  Several other small bugs and edge cases remain to be addressed"," Roadmap","-  AI-assisted generation and track extension tools (May rollout)","-  Customizable keyboard shortcuts and input presets"];function Bd(){const t=document.getElementById("whats-new-modal"),e=t==null?void 0:t.querySelector("ul"),i=document.getElementById("whats-new-metadata"),s=t==null?void 0:t.querySelector("img");if(t&&e&&i){e.innerHTML="",i.textContent=`${Nd}  Updated ${Cd}`,s&&(s.src=js("static/logo.png"));let n=null;for(const r of Md)if(r.startsWith("")||r.startsWith("")||r.startsWith("")){const a=document.createElement("li");a.textContent=r,a.classList.add("font-bold","mt-6","text-lg"),e.appendChild(a),n=document.createElement("ul"),n.classList.add("list-disc","list-inside","ml-6","mt-2","space-y-1"),e.appendChild(n)}else if(n){const a=document.createElement("li");a.textContent=r.replace(/^- /,""),n.appendChild(a)}t.classList.remove("hidden")}}function wd(){const t=document.getElementById("whats-new-modal");t&&(t.style.opacity="0",t.style.transition="opacity 0.4s ease-out",setTimeout(()=>{t.classList.add("hidden"),t.style.opacity="1"},400))}var Ts;(Ts=document.getElementById("whats-new-close-btn"))==null||Ts.addEventListener("click",wd);function Ld(){var t;(t=document.getElementById("footer-whats-new-btn"))==null||t.addEventListener("click",Bd)}function Gd(){const t=document.getElementById("footer-help-btn");t&&t.addEventListener("click",()=>{window.open("https://github.com/alacrity-ai/sequenzia","_blank")})}function ei(t=3){const r=["C","D","E","F","G","A","B"],a=["C#","D#","","F#","G#","A#",""],o=[t,t+1,t+2],c={};let d=0;for(const l of o)r.forEach(u=>{const h=`${u}${l}`;c[h]={note:h,x:d,width:60,height:200,isBlack:!1},d+=60});d=0;for(const l of o)a.forEach((u,h)=>{if(u===""){d+=60;return}const f=`${u}${l}`;c[f]={note:f,x:d+60-40/2,width:40,height:120,isBlack:!0},d+=60});return c}function ze(t,e,i=new Set,s=null){t.clearRect(0,0,t.canvas.width,t.canvas.height);const n={};if(s)for(const[r,a]of Object.entries(s))n[a]=r;for(const r of Object.values(e))r.isBlack||(ls(t,{...r,fill:i.has(r.note)?"#cce0ff":"#ffffff",stroke:"#333",radius:6}),t.fillStyle="#333",t.font="12px sans-serif",t.textAlign="center",n[r.note]&&(t.fillStyle="#7c3aed",t.fillText(n[r.note],r.x+r.width/2,r.height-24),t.fillStyle="#333"),t.fillText(r.note,r.x+r.width/2,r.height-8));for(const r of Object.values(e))r.isBlack&&(ls(t,{...r,fill:i.has(r.note)?"#4a60ff":"#111111",stroke:"#000000",radius:4}),Ed(t,r),n[r.note]&&(t.fillStyle="#c084fc",t.font="10px sans-serif",t.textAlign="center",t.fillText(n[r.note],r.x+r.width/2,r.height-28)))}function ls(t,e){const{x:i,width:s,height:n,fill:r,stroke:a,radius:o=8}=e;t.beginPath(),t.moveTo(i,0),t.lineTo(i,n-o),t.quadraticCurveTo(i,n,i+o,n),t.lineTo(i+s-o,n),t.quadraticCurveTo(i+s,n,i+s,n-o),t.lineTo(i+s,0),t.closePath(),t.fillStyle=r,t.fill(),t.strokeStyle=a,t.lineWidth=1,t.stroke()}function Ed(t,e){const i=t.createLinearGradient(e.x,0,e.x,e.height);i.addColorStop(0,"rgba(255,255,255,0.2)"),i.addColorStop(.3,"rgba(255,255,255,0)"),t.fillStyle=i,t.beginPath(),t.moveTo(e.x,0),t.lineTo(e.x+e.width,0),t.lineTo(e.x+e.width,e.height*.4),t.lineTo(e.x,e.height*.4),t.closePath(),t.fill()}let ds=!1,Mt=null;function Ur(t,e){if(ds)return;ds=!0,Mt=e;const i=t.getContext("2d");if(!i)return;const s=new Map,n=new Set;function r(l,u){const h=Mt();for(const f of Object.values(h))if(f.isBlack&&l>=f.x&&l<=f.x+f.width&&u>=0&&u<=f.height)return f.note;for(const f of Object.values(h))if(!f.isBlack&&l>=f.x&&l<=f.x+f.width&&u>=0&&u<=f.height)return f.note;return null}function a(l){if(!l||n.has(l))return;const u=Ka(l);u&&(s.set(l,u),n.add(l),i&&ze(i,Mt(),n))}function o(l){if(!n.has(l))return;const u=s.get(l);u&&(u.stop(),s.delete(l)),n.delete(l),i&&ze(i,Mt(),n)}function c(){for(const l of n)o(l)}let d=!1;t.addEventListener("mousedown",l=>{d=!0;const u=t.getBoundingClientRect(),h=l.clientX-u.left,f=l.clientY-u.top,p=r(h,f);a(p)}),t.addEventListener("mousemove",l=>{if(!d)return;const u=t.getBoundingClientRect(),h=l.clientX-u.left,f=l.clientY-u.top,p=r(h,f);a(p)}),t.addEventListener("mouseup",()=>{d=!1,c()}),t.addEventListener("mouseleave",()=>{d=!1,c()})}const $i=[..."qwertyuiop[zxcvbnm,./"],Ki=["2","3","5","6","7","9","0","=","s","d","g","h","k","l",";"];function Id(){const t=document.getElementById("instrument-loop-toggle");return(t==null?void 0:t.checked)??!1}let Jt=!1;function Dr(){return Jt}let Bt=null,ct=null,ut=null;function qr(t,e){if(Jt)return;Jt=!0;const i=t.getContext("2d");if(!i)throw new Error("Canvas 2D context not available.");const s=new Set,n=new Set,r=new Map,a=$i,o=Ki;Bt=e;function c(){const u=Bt(),h=Object.values(u).filter(g=>!g.isBlack).sort((g,y)=>g.x-y.x).map(g=>g.note),f=Object.values(u).filter(g=>g.isBlack).sort((g,y)=>g.x-y.x).map(g=>g.note),p={};return a.forEach((g,y)=>{h[y]&&(p[g]=h[y])}),o.forEach((g,y)=>{f[y]&&(p[g]=f[y])}),p}function d(u){const h=c(),f=h[u];if(!(!f||s.has(u))){if(s.add(u),!n.has(f)){const p=ir(f,100,Id());p&&(r.set(f,{stop:p}),n.add(f))}i&&ze(i,Bt(),n,h)}}function l(u){const h=c(),f=h[u];f&&(s.delete(u),n.has(f)&&(Ha(f),r.delete(f),n.delete(f)),i&&ze(i,Bt(),n,h))}ct=u=>{u.repeat||d(u.key)},ut=u=>{l(u.key)},window.addEventListener("keydown",ct),window.addEventListener("keyup",ut)}function Jr(){ct&&(window.removeEventListener("keydown",ct),ct=null),ut&&(window.removeEventListener("keyup",ut),ut=null),Jt=!1}let De=3,Te=ei(De),wt=!1;async function kd(t){var r,a;const e=t.getContext("2d");if(!e)throw new Error("Failed to get 2D context for keyboard canvas");function i(){const o=Object.values(Te).filter(l=>!l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),c=Object.values(Te).filter(l=>l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),d={};return $i.forEach((l,u)=>{o[u]&&(d[l]=o[u])}),Ki.forEach((l,u)=>{c[u]&&(d[l]=c[u])}),d}function s(){if(!e)return;Te=ei(De);const o=wt?i():null;ze(e,Te,new Set,o)}Ur(t,()=>Te),s(),(r=document.getElementById("octave-up"))==null||r.addEventListener("click",()=>{De<7&&(De++,s())}),(a=document.getElementById("octave-down"))==null||a.addEventListener("click",()=>{De>1&&(De--,s())});const n=document.getElementById("disable-keyboard-inputs");return n.classList.remove("bg-purple-600"),n.classList.add("bg-gray-700"),n.addEventListener("click",()=>{wt=!wt,wt?(qr(t,()=>Te),n.classList.remove("bg-gray-700"),n.classList.add("bg-purple-600")):(Jr(),n.classList.remove("bg-purple-600"),n.classList.add("bg-gray-700")),s()}),{refreshKeyboard:s}}let qe=3,Re=ei(qe),Lt=!1,Gt=null;async function Ad(t){var r,a;if(Gt=t.getContext("2d"),!Gt)throw new Error("Failed to get 2D context for keyboard canvas.");await tr("sf2/fluidr3-gm/acoustic_grand_piano");function e(){const o=Object.values(Re).filter(l=>!l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),c=Object.values(Re).filter(l=>l.isBlack).sort((l,u)=>l.x-u.x).map(l=>l.note),d={};return $i.forEach((l,u)=>{o[u]&&(d[l]=o[u])}),Ki.forEach((l,u)=>{c[u]&&(d[l]=c[u])}),d}function i(){Re=ei(qe);const o=Lt?e():null;Gt&&ze(Gt,Re,new Set,o)}Ur(t,()=>Re),i(),(r=document.getElementById("octave-up"))==null||r.addEventListener("click",()=>{qe<7&&(qe++,i())}),(a=document.getElementById("octave-down"))==null||a.addEventListener("click",()=>{qe>1&&(qe--,i())});const s=document.getElementById("disable-keyboard-inputs");s.classList.remove("bg-purple-600"),s.classList.add("bg-gray-700"),s.addEventListener("click",()=>{Lt=!Lt,Lt?(qr(t,()=>Re),s.classList.remove("bg-gray-700"),s.classList.add("bg-purple-600")):(Jr(),s.classList.remove("bg-purple-600"),s.classList.add("bg-gray-700")),i()}),document.getElementById("global-instrument-select-btn").addEventListener("click",async()=>{const o=Ja()||"sf2/fluidr3-gm/acoustic_grand_piano",c=document.getElementById("instrument-select-modal");delete c.dataset.currentSequencer,await kr(o),c.classList.remove("hidden")})}async function Pd(t){await Ad(t);const{refreshKeyboard:e}=await kd(t)}function Fd(t,e){const i=e.getContext("2d");if(!i)throw new Error("Canvas 2D context not available");const s=e.width,n=e.height,r=new Uint8Array(t.fftSize),a=new Uint8Array(t.frequencyBinCount),o=document.createElement("canvas");o.width=s,o.height=n;const c=o.getContext("2d");if(!c)throw new Error("Offscreen canvas 2D context not available");let d="frequency";function l(){if(!i)return;t.getByteTimeDomainData(r),i.fillStyle="#000",i.fillRect(0,0,s,n),i.lineWidth=2,i.strokeStyle="#00ffcc",i.beginPath();const p=s/r.length;let g=0;for(let y=0;y<r.length;y++){const _=r[y]/128*n/2;y===0?i.moveTo(g,_):i.lineTo(g,_),g+=p}i.lineTo(s,n/2),i.stroke()}function u(){if(t.getByteFrequencyData(a),!i)return;i.fillStyle="#000",i.fillRect(0,0,s,n),i.fillStyle="rgba(255,255,255,0.2)",i.fillRect(0,0,1,n),i.fillRect(s-1,0,1,n);const p=128,g=2,y=[];for(let m=0;m<p;m++)y.push(m*s/(p-1));y[y.length-1]=s-1;for(let m=0;m<p;m++){const _=y[m],v=m<p-1?y[m+1]:s,b=Math.max(1,v-_-g),S=20,N=2e4,C=m/(p-1),M=S*Math.pow(N/S,C),k=Math.min(a.length-1,Math.floor(M/22050*a.length)),L=a[k]/255,F=Math.max(1,L*n),A=240-C*240;i.fillStyle=`hsl(${A}, ${80+L*20}%, ${40+L*40}%)`,i.fillRect(_,n-F,b,F)}}function h(){if(t.getByteFrequencyData(a),!c)return;o.initialized||(c.fillStyle="#000",c.fillRect(0,0,s,n),o.initialized=!0),c.drawImage(o,-1,0),c.fillStyle="#000",c.fillRect(s-1,0,1,n);const p=128,g=20,y=2e4;for(let m=0;m<p;m++){const _=m/(p-1),v=g*Math.pow(y/g,_),S=Math.min(a.length-1,Math.floor(v/22050*a.length)),N=a[S]/255,C=n-1-Math.floor(m*n/p);if(N<.05)continue;const M=Math.floor(N*255),E=Math.floor(N*(255-_*200)),k=Math.floor(N*(100+_*155));c.fillStyle=`rgb(${M}, ${E}, ${k})`,c.fillRect(s-1,C,1,1)}i&&(i.fillStyle="#000",i.fillRect(0,0,s,n),i.drawImage(o,0,0))}function f(){switch(requestAnimationFrame(f),d){case"frequency":u();break;case"spectrogram":h();break;case"waveform":default:l()}}return f(),{setMode(p){["waveform","frequency","spectrogram"].includes(p)&&(d=p,i.clearRect(0,0,s,n),d==="spectrogram"&&c.clearRect(0,0,s,n))}}}function Td(t,e){const i=Fd(sr(),t),s=[{name:"waveform",emoji:""},{name:"frequency",emoji:""},{name:"spectrogram",emoji:""}];let n=0;function r(){n=(n+1)%s.length;const{name:a,emoji:o}=s[n];i.setMode(a),e.textContent=o,e.title=`Mode: ${a}`}e.addEventListener("click",r),r()}function Rd(){document.getElementById("add-sequencer").addEventListener("click",()=>{const e=T.length;O(cr(e,"sf2/fluidr3-gm/acoustic_grand_piano"),Ti(e))})}function zi(){return typeof window<"u"&&typeof localStorage<"u"}function Od(){if(!zi())return;const t=Ce();localStorage.setItem("userConfig",JSON.stringify(t))}function xd(){if(!zi())return;const t=localStorage.getItem("userConfig");if(t)try{const e=JSON.parse(t);pt(e)}catch(e){console.error("Failed to parse userConfig from localStorage:",e)}}zi()&&xd();const cs=["gpt-4o","gpt-4o-mini","gpt-4.1","gpt-4.1-mini","o3-mini","o4-mini"];function Ci(){return Ce().ai.openaiApiKey}function us(){return Ce().ai.openaiModel}function Ud(t){pt({ai:{openaiApiKey:t}})}function Dd(t){if(!cs.includes(t))throw new Error(`Invalid model: ${t}. Must be one of: ${cs.join(", ")}`);pt({ai:{openaiModel:t}})}function qd(){var n;const t=document.getElementById("openai-key-input"),e=document.getElementById("openai-model-select"),i=document.getElementById("config-save"),s=document.querySelectorAll("#config-close, #config-close-bottom");t.value=Ci(),e.value=us(),i.addEventListener("click",()=>{var r;Ud(t.value),Dd(e.value),Od(),(r=document.getElementById("userconfig-modal"))==null||r.classList.add("hidden")}),s.forEach(r=>{r.addEventListener("click",()=>{var a;t.value=Ci(),e.value=us(),(a=document.getElementById("userconfig-modal"))==null||a.classList.add("hidden")})}),(n=document.getElementById("key-not-set-ok"))==null||n.addEventListener("click",()=>{var r;(r=document.getElementById("openai-key-not-set-modal"))==null||r.classList.add("hidden")})}const Jd=["Darkroom","Seashell","Cyberpunk","Classic Blue","Midnight"],Hd=["Track Color","Note Velocity","Pitch Class Contrast","Scriabin","Octave Bands"];function $d(){const t=document.getElementById("grid-color-select"),e=document.getElementById("note-color-select");if(!t||!e)return;for(const s of Jd){const n=document.createElement("option");n.value=s,n.textContent=s,t.appendChild(n)}for(const s of Hd){const n=document.createElement("option");n.value=s,n.textContent=s,e.appendChild(n)}const i=Ce();t.value=i.theme.gridColorScheme,e.value=i.theme.noteColorScheme,t.addEventListener("change",s=>{const n=s.target;pt({theme:{gridColorScheme:n.value}}),te().forEach(r=>{var a;return(a=r.matrix)==null?void 0:a.requestRedraw()})}),e.addEventListener("change",s=>{const n=s.target;pt({theme:{noteColorScheme:n.value}}),te().forEach(r=>{var a;return(a=r.matrix)==null?void 0:a.requestRedraw()})})}function Kd(){const t=document.getElementById("userconfig-modal"),e=document.querySelectorAll(".settings-tab"),i=document.querySelectorAll(".settings-section");if(!t)return;function s(){e.forEach(n=>{const r=n.dataset.tab;if(!r)return;const a=document.getElementById(r),o=a!==null&&!a.classList.contains("hidden");n.classList.toggle("text-purple-500",o),n.classList.toggle("opacity-100",o),n.classList.toggle("text-gray-500",!o),n.classList.toggle("opacity-50",!o)})}e.forEach(n=>{n.addEventListener("click",()=>{const r=n.dataset.tab;if(!r)return;i.forEach(o=>o.classList.add("hidden"));const a=document.getElementById(r);a&&a.classList.remove("hidden"),s()})}),s(),qd(),$d()}let fs=!1,ke=!1,Ae=!1;function zd({getSequencers:t,onPlay:e,onStop:i,onPause:s,onResume:n,onDurationChange:r,onSnapChange:a,onToggleLoop:o,onTempoChange:c,onSave:d,onLoad:l,onMeasuresChange:u,onBeatsPerMeasureChange:h}){if(fs)return;fs=!0;const f=document.getElementById("play-button"),p=f.querySelector("use"),g=document.getElementById("stop-button"),y=document.getElementById("snap-resolution"),m=document.getElementById("loop-toggle"),_=document.getElementById("tempo-input"),v=document.getElementById("save-button"),b=document.getElementById("load-button"),S=document.getElementById("measures-input"),N=document.getElementById("beats-per-measure-input"),C=document.getElementById("config-button"),M=document.getElementById("export-modal"),E=document.getElementById("export-json"),k=document.getElementById("export-wav"),L=document.getElementById("export-midi"),F=document.getElementById("export-cancel");y.value=String(z.snapResolution||.25);const A=document.getElementById("import-modal"),U=document.getElementById("import-json"),D=document.getElementById("import-midi"),q=document.getElementById("import-cancel"),P=document.getElementById("load-input");b.addEventListener("click",()=>{A==null||A.classList.remove("hidden")}),P&&P.addEventListener("change",G=>{var ie;const J=G.target,R=(ie=J.files)==null?void 0:ie[0];R&&l(R),J.value=""}),U&&U.addEventListener("click",()=>{A==null||A.classList.add("hidden"),P&&(P.setAttribute("accept",".json"),P.click())}),D&&D.addEventListener("click",()=>{A==null||A.classList.add("hidden"),P&&(P.setAttribute("accept",".mid,.midi"),P.click())}),q&&q.addEventListener("click",()=>{A==null||A.classList.add("hidden")}),p.setAttribute("href","#icon-play"),f.addEventListener("click",()=>{!ke&&!Ae?(ke=!0,Ae=!1,e(),p.setAttribute("href","#icon-pause")):ke?(ke=!1,Ae=!0,s(),p.setAttribute("href","#icon-play")):Ae&&(ke=!0,Ae=!1,n(),p.setAttribute("href","#icon-pause"))}),g.addEventListener("click",()=>{i(),ke=!1,Ae=!1,p.setAttribute("href","#icon-play")}),window.addEventListener("keydown",G=>{var ie;if(document.querySelector(".ai-modal:not(.hidden)"))return;const R=(ie=document.activeElement)==null?void 0:ie.tagName;if(!(R==="INPUT"||R==="TEXTAREA")){if(G.code==="Space"){G.preventDefault(),f.click();return}if((G.metaKey||G.ctrlKey)&&G.key.toLowerCase()==="r"){G.preventDefault();return}if(G.key==="v"&&!G.ctrlKey&&!G.metaKey&&!G.altKey&&!Dr()){const Xe=Hi();if(!Xe||Xe.selectedNotes.length===0){xr("No notes selected. Please select notes before adjusting velocity.");return}G.preventDefault(),Rr(Xe.selectedNotes);return}}}),y.addEventListener("change",G=>{const R=G.target.value;Object.prototype.hasOwnProperty.call(Uo,R)&&(z.snapResolution=parseFloat(R),y.value=String(R),a(z.snapResolution))}),m.addEventListener("change",G=>{const J=G.target;o(J.checked)}),_.addEventListener("change",G=>{const J=G.target,R=parseInt(J.value,10);J.blur(),isNaN(R)||c(R)}),v.addEventListener("click",()=>{M?M.classList.remove("hidden"):d("json")}),E&&E.addEventListener("click",()=>{M==null||M.classList.add("hidden"),d==null||d("json")}),k&&k.addEventListener("click",()=>{M==null||M.classList.add("hidden"),requestAnimationFrame(()=>{d==null||d("wav")})}),L&&L.addEventListener("click",()=>{M==null||M.classList.add("hidden"),d==null||d("midi")}),F&&F.addEventListener("click",()=>{M==null||M.classList.add("hidden")}),C==null||C.addEventListener("click",()=>{const G=document.getElementById("userconfig-modal");G==null||G.classList.remove("hidden")}),Kd(),S&&(S.value=String(We())),N&&(N.value=String(bt())),S==null||S.addEventListener("change",G=>{const J=G.target,R=parseInt(J.value,10);!isNaN(R)&&R>0&&(u==null||u(R))}),N==null||N.addEventListener("change",G=>{const J=G.target,R=parseInt(J.value,10);!isNaN(R)&&R>0&&(h==null||h(R))})}function Wd(){ke=!1,Ae=!1;const t=document.getElementById("play-button"),e=t==null?void 0:t.querySelector("use");e&&e.setAttribute("href","#icon-play")}function Xd(){var u;const t=document.getElementById("global-mini-expand-btn"),e=document.getElementById("global-mini-contour"),i=document.getElementById("global-mini-playhead"),s=(u=e==null?void 0:e.parentElement)==null?void 0:u.parentElement,n=e==null?void 0:e.parentElement,r=t==null?void 0:t.querySelector("svg use"),a=document.querySelector(".footer-spacer"),o=40;let c=!1;function d(h,f){const p=h.offsetWidth;h.style.height=`${f}px`,h.height=f,h.width=p}if(!t||!e||!i||!s||!n||!r||!a){console.warn("FooterUI: One or more elements not found.");return}s.style.height=`${o}px`,n.style.height=`${o}px`,d(e,o),d(i,o),Se(e,te());function l(){c=!c;const h=c?200:40;!s||!n||!e||!i||!r||!a||(s.style.height=`${h}px`,n.style.height=`${h}px`,d(e,h),d(i,h),r.setAttribute("href",c?"#icon-caret-down":"#icon-caret-up"),a.style.height=`${h-40+140}px`,Se(e,te()))}t.addEventListener("click",l)}function Vd(t){if(!t.sequencers.length)throw new Error("No tracks to export.");const e=t.tempo,i=t.timeSignature[0],s=t.totalMeasures,n={v:3,t:new Date().toISOString(),c:{b:e,bpm:i,tm:s},i:t.sequencers.map(a=>a.instrument||"sf2/fluidr3-gm/acoustic_grand_piano"),vlm:t.sequencers.map(a=>a.volume??100/127),pan:t.sequencers.map(a=>a.pan??0),tr:t.sequencers.map(a=>({n:a.notes.map(o=>[o.pitch,o.start,o.duration,o.velocity??100])}))},r=new Blob([JSON.stringify(n)],{type:"application/json"});return{url:URL.createObjectURL(r),filename:`session-${Date.now()}.json`}}async function jd(t,e={sampleRate:44100,includePan:!0}){if(!t.tracks||t.tracks.length===0)throw new Error("No tracks to export.");const i=e.sampleRate,s=e.includePan?2:1,n=new AbortController;let r=!1;rt("Exporting Session","Rendering your session offline...",()=>{r=!0,n.abort()},!0);try{const o=60/me(),c=Math.max(...t.tracks.flatMap(p=>p.notes.map(g=>(g.start+g.duration)*o+.2))),d=new OfflineAudioContext(s,Math.ceil(i*c),i);for(const p of t.tracks){if(r)return;const g=p.instrument||"sf2/fluidr3-gm/acoustic_grand_piano";if(await new qt(null,p.config,d,d.destination,g,!0).exportToOffline(n.signal,p.notes),r)return}if(r)return;rt("Rendering Audio","Rendering audio buffer",void 0,!0);const l=await d.startRendering();rt("Converting to WAV","Converting to WAV format",void 0,!0);const u=Yd(l);rt("Downloading WAV","Please wait...",void 0,!0);const h=URL.createObjectURL(u),f=document.createElement("a");f.href=h,f.download=`session-${Date.now()}.wav`,f.click(),URL.revokeObjectURL(h)}catch(a){r?console.warn("Export operation was cancelled by the user."):console.error("Error during export:",a)}finally{Ot(!0)}}function Yd(t){const e=t.numberOfChannels,i=t.length*e*2,s=new DataView(new ArrayBuffer(44+i)),n=(a,o)=>{for(let c=0;c<o.length;c++)s.setUint8(a+c,o.charCodeAt(c))};n(0,"RIFF"),s.setUint32(4,36+i,!0),n(8,"WAVE"),n(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,e,!0),s.setUint32(24,t.sampleRate,!0),s.setUint32(28,t.sampleRate*e*2,!0),s.setUint16(32,e*2,!0),s.setUint16(34,16,!0),n(36,"data"),s.setUint32(40,i,!0);let r=44;for(let a=0;a<t.length;a++)for(let o=0;o<e;o++){const c=t.getChannelData(o)[a],d=Math.max(-1,Math.min(1,c));s.setInt16(r,d*32767,!0),r+=2}return new Blob([s.buffer],{type:"audio/wav"})}function Zd(){document.getElementById("save-wav-options-modal").classList.remove("hidden")}function Hr(){document.getElementById("save-wav-options-modal").classList.add("hidden")}async function Qd(){var n;const t=parseInt(document.getElementById("save-wav-sample-rate").value,10),e=((n=document.getElementById("save-wav-include-pan"))==null?void 0:n.checked)??!0;Hr();const i=Ne(),s={globalConfig:{bpm:i.tempo,beatsPerMeasure:i.timeSignature[0],totalMeasures:i.totalMeasures},tracks:T.map(r=>({notes:r.notes,instrument:r.instrumentName,config:r.config,volume:r.volume,pan:r.pan}))};try{await jd(s,{sampleRate:t,includePan:e})}catch(r){console.error("[SaveWav] Export failed:",r)}}function ec(){Hr()}function tc(){const t=document.getElementById("save-wav-options-apply-btn"),e=document.getElementById("save-wav-options-cancel-btn");t&&t.addEventListener("click",Qd),e&&e.addEventListener("click",ec)}function ic(t){if(Object.prototype.hasOwnProperty.call(t,"__esModule"))return t;var e=t.default;if(typeof e=="function"){var i=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var n=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(i,s,n.get?n:{enumerable:!0,get:function(){return t[s]}})}),i}var Me={},Et={},di,hs;function sc(){if(hs)return di;hs=1;function t(n){var r=new s(n),a=r.readChunk();if(a.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var o=e(a.data),c=[],d=0;!r.eof()&&d<o.numTracks;d++){var l=r.readChunk();if(l.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+l.id+"'";var u=i(l.data);c.push(u)}return{header:o,tracks:c}}function e(n){var r=new s(n),a=r.readUInt16(),o=r.readUInt16(),c={format:a,numTracks:o},d=r.readUInt16();return d&32768?(c.framesPerSecond=256-(d>>8),c.ticksPerFrame=d&255):c.ticksPerBeat=d,c}function i(n){for(var r=new s(n),a=[];!r.eof();){var o=d();a.push(o)}return a;var c;function d(){var l={};l.deltaTime=r.readVarInt();var u=r.readUInt8();if((u&240)===240)if(u===255){l.meta=!0;var h=r.readUInt8(),f=r.readVarInt();switch(h){case 0:if(l.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return l.number=r.readUInt16(),l;case 1:return l.type="text",l.text=r.readString(f),l;case 2:return l.type="copyrightNotice",l.text=r.readString(f),l;case 3:return l.type="trackName",l.text=r.readString(f),l;case 4:return l.type="instrumentName",l.text=r.readString(f),l;case 5:return l.type="lyrics",l.text=r.readString(f),l;case 6:return l.type="marker",l.text=r.readString(f),l;case 7:return l.type="cuePoint",l.text=r.readString(f),l;case 32:if(l.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return l.channel=r.readUInt8(),l;case 33:if(l.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return l.port=r.readUInt8(),l;case 47:if(l.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return l;case 81:if(l.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return l.microsecondsPerBeat=r.readUInt24(),l;case 84:if(l.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var p=r.readUInt8(),g={0:24,32:25,64:29,96:30};return l.frameRate=g[p&96],l.hour=p&31,l.min=r.readUInt8(),l.sec=r.readUInt8(),l.frame=r.readUInt8(),l.subFrame=r.readUInt8(),l;case 88:if(l.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return l.numerator=r.readUInt8(),l.denominator=1<<r.readUInt8(),f===4?(l.metronome=r.readUInt8(),l.thirtyseconds=r.readUInt8()):(l.metronome=36,l.thirtyseconds=8),l;case 89:if(l.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return l.key=r.readInt8(),l.scale=r.readUInt8(),l;case 127:return l.type="sequencerSpecific",l.data=r.readBytes(f),l;default:return l.type="unknownMeta",l.data=r.readBytes(f),l.metatypeByte=h,l}}else if(u==240){l.type="sysEx";var f=r.readVarInt();return l.data=r.readBytes(f),l}else if(u==247){l.type="endSysEx";var f=r.readVarInt();return l.data=r.readBytes(f),l}else throw"Unrecognised MIDI event type byte: "+u;else{var y;if((u&128)===0){if(c===null)throw"Running status byte encountered before status byte";y=u,u=c,l.running=!0}else y=r.readUInt8(),c=u;var m=u>>4;switch(l.channel=u&15,m){case 8:return l.type="noteOff",l.noteNumber=y,l.velocity=r.readUInt8(),l;case 9:var _=r.readUInt8();return l.type=_===0?"noteOff":"noteOn",l.noteNumber=y,l.velocity=_,_===0&&(l.byte9=!0),l;case 10:return l.type="noteAftertouch",l.noteNumber=y,l.amount=r.readUInt8(),l;case 11:return l.type="controller",l.controllerType=y,l.value=r.readUInt8(),l;case 12:return l.type="programChange",l.programNumber=y,l;case 13:return l.type="channelAftertouch",l.amount=y,l;case 14:return l.type="pitchBend",l.value=y+(r.readUInt8()<<7)-8192,l;default:throw"Unrecognised MIDI event type: "+m}}}}function s(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},s.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},s.prototype.readUInt16=function(){var n=this.readUInt8(),r=this.readUInt8();return(n<<8)+r},s.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},s.prototype.readUInt24=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8();return(n<<16)+(r<<8)+a},s.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},s.prototype.readUInt32=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8(),o=this.readUInt8();return(n<<24)+(r<<16)+(a<<8)+o},s.prototype.readBytes=function(n){var r=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,r},s.prototype.readString=function(n){var r=this.readBytes(n);return String.fromCharCode.apply(null,r)},s.prototype.readVarInt=function(){for(var n=0;!this.eof();){var r=this.readUInt8();if(r&128)n+=r&127,n<<=7;else return n+r}return n},s.prototype.readChunk=function(){var n=this.readString(4),r=this.readUInt32(),a=this.readBytes(r);return{id:n,length:r,data:a}},di=t,di}var ci,ms;function rc(){if(ms)return ci;ms=1;function t(r,a){if(typeof r!="object")throw"Invalid MIDI data";a=a||{};var o=r.header||{},c=r.tracks||[],d,l=c.length,u=new n;for(e(u,o,l),d=0;d<l;d++)i(u,c[d],a);return u.buffer}function e(r,a,o){var c=a.format==null?1:a.format,d=128;a.timeDivision?d=a.timeDivision:a.ticksPerFrame&&a.framesPerSecond?d=-(a.framesPerSecond&255)<<8|a.ticksPerFrame&255:a.ticksPerBeat&&(d=a.ticksPerBeat&32767);var l=new n;l.writeUInt16(c),l.writeUInt16(o),l.writeUInt16(d),r.writeChunk("MThd",l.buffer)}function i(r,a,o){var c=new n,d,l=a.length,u=null;for(d=0;d<l;d++)(o.running===!1||!o.running&&!a[d].running)&&(u=null),u=s(c,a[d],u,o.useByte9ForNoteOff);r.writeChunk("MTrk",c.buffer)}function s(r,a,o,c){var d=a.type,l=a.deltaTime,u=a.text||"",h=a.data||[],f=null;switch(r.writeVarInt(l),d){case"sequenceNumber":r.writeUInt8(255),r.writeUInt8(0),r.writeVarInt(2),r.writeUInt16(a.number);break;case"text":r.writeUInt8(255),r.writeUInt8(1),r.writeVarInt(u.length),r.writeString(u);break;case"copyrightNotice":r.writeUInt8(255),r.writeUInt8(2),r.writeVarInt(u.length),r.writeString(u);break;case"trackName":r.writeUInt8(255),r.writeUInt8(3),r.writeVarInt(u.length),r.writeString(u);break;case"instrumentName":r.writeUInt8(255),r.writeUInt8(4),r.writeVarInt(u.length),r.writeString(u);break;case"lyrics":r.writeUInt8(255),r.writeUInt8(5),r.writeVarInt(u.length),r.writeString(u);break;case"marker":r.writeUInt8(255),r.writeUInt8(6),r.writeVarInt(u.length),r.writeString(u);break;case"cuePoint":r.writeUInt8(255),r.writeUInt8(7),r.writeVarInt(u.length),r.writeString(u);break;case"channelPrefix":r.writeUInt8(255),r.writeUInt8(32),r.writeVarInt(1),r.writeUInt8(a.channel);break;case"portPrefix":r.writeUInt8(255),r.writeUInt8(33),r.writeVarInt(1),r.writeUInt8(a.port);break;case"endOfTrack":r.writeUInt8(255),r.writeUInt8(47),r.writeVarInt(0);break;case"setTempo":r.writeUInt8(255),r.writeUInt8(81),r.writeVarInt(3),r.writeUInt24(a.microsecondsPerBeat);break;case"smpteOffset":r.writeUInt8(255),r.writeUInt8(84),r.writeVarInt(5);var p={24:0,25:32,29:64,30:96},g=a.hour&31|p[a.frameRate];r.writeUInt8(g),r.writeUInt8(a.min),r.writeUInt8(a.sec),r.writeUInt8(a.frame),r.writeUInt8(a.subFrame);break;case"timeSignature":r.writeUInt8(255),r.writeUInt8(88),r.writeVarInt(4),r.writeUInt8(a.numerator);var y=Math.floor(Math.log(a.denominator)/Math.LN2)&255;r.writeUInt8(y),r.writeUInt8(a.metronome),r.writeUInt8(a.thirtyseconds||8);break;case"keySignature":r.writeUInt8(255),r.writeUInt8(89),r.writeVarInt(2),r.writeInt8(a.key),r.writeUInt8(a.scale);break;case"sequencerSpecific":r.writeUInt8(255),r.writeUInt8(127),r.writeVarInt(h.length),r.writeBytes(h);break;case"unknownMeta":a.metatypeByte!=null&&(r.writeUInt8(255),r.writeUInt8(a.metatypeByte),r.writeVarInt(h.length),r.writeBytes(h));break;case"sysEx":r.writeUInt8(240),r.writeVarInt(h.length),r.writeBytes(h);break;case"endSysEx":r.writeUInt8(247),r.writeVarInt(h.length),r.writeBytes(h);break;case"noteOff":var m=c!==!1&&a.byte9||c&&a.velocity==0?144:128;f=m|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteOn":f=144|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteAftertouch":f=160|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.amount);break;case"controller":f=176|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.controllerType),r.writeUInt8(a.value);break;case"programChange":f=192|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.programNumber);break;case"channelAftertouch":f=208|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.amount);break;case"pitchBend":f=224|a.channel,f!==o&&r.writeUInt8(f);var _=8192+a.value,v=_&127,b=_>>7&127;r.writeUInt8(v),r.writeUInt8(b);break;default:throw"Unrecognized event type: "+d}return f}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(r){this.buffer.push(r&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(r){var a=r>>8&255,o=r&255;this.writeUInt8(a),this.writeUInt8(o)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(r){var a=r>>16&255,o=r>>8&255,c=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(c)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(r){var a=r>>24&255,o=r>>16&255,c=r>>8&255,d=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(c),this.writeUInt8(d)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(r){this.buffer=this.buffer.concat(Array.prototype.slice.call(r,0))},n.prototype.writeString=function(r){var a,o=r.length,c=[];for(a=0;a<o;a++)c.push(r.codePointAt(a));this.writeBytes(c)},n.prototype.writeVarInt=function(r){if(r<0)throw"Cannot write negative variable-length integer";if(r<=127)this.writeUInt8(r);else{var a=r,o=[];for(o.push(a&127),a>>=7;a;){var c=a&127|128;o.push(c),a>>=7}this.writeBytes(o.reverse())}},n.prototype.writeChunk=function(r,a){this.writeString(r),this.writeUInt32(a.length),this.writeBytes(a)},ci=t,ci}var ps;function $r(){return ps||(ps=1,Et.parseMidi=sc(),Et.writeMidi=rc()),Et}var ui={},Be={},ys;function Kr(){if(ys)return Be;ys=1,Object.defineProperty(Be,"__esModule",{value:!0}),Be.insert=Be.search=void 0;function t(i,s,n){n===void 0&&(n="ticks");var r=0,a=i.length,o=a;if(a>0&&i[a-1][n]<=s)return a-1;for(;r<o;){var c=Math.floor(r+(o-r)/2),d=i[c],l=i[c+1];if(d[n]===s){for(var u=c;u<i.length;u++){var h=i[u];h[n]===s&&(c=u)}return c}else{if(d[n]<s&&l[n]>s)return c;d[n]>s?o=c:d[n]<s&&(r=c+1)}}return-1}Be.search=t;function e(i,s,n){if(n===void 0&&(n="ticks"),i.length){var r=t(i,s[n],n);i.splice(r+1,0,s)}else i.push(s)}return Be.insert=e,Be}var _s;function Mi(){return _s||(_s=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var e=Kr(),i=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function n(r){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),r){i.set(this,r.header.ticksPerBeat),r.tracks.forEach(function(c){c.forEach(function(d){d.meta&&(d.type==="timeSignature"?a.timeSignatures.push({ticks:d.absoluteTime,timeSignature:[d.numerator,d.denominator]}):d.type==="setTempo"?a.tempos.push({bpm:6e7/d.microsecondsPerBeat,ticks:d.absoluteTime}):d.type==="keySignature"&&a.keySignatures.push({key:t.keySignatureKeys[d.key+7],scale:d.scale===0?"major":"minor",ticks:d.absoluteTime}))})});var o=0;r.tracks[0].forEach(function(c){o+=c.deltaTime,c.meta&&(c.type==="trackName"?a.name=c.text:(c.type==="text"||c.type==="cuePoint"||c.type==="marker"||c.type==="lyrics")&&a.meta.push({text:c.text,ticks:o,type:c.type}))}),this.update()}}return n.prototype.update=function(){var r=this,a=0,o=0;this.tempos.sort(function(c,d){return c.ticks-d.ticks}),this.tempos.forEach(function(c,d){var l=d>0?r.tempos[d-1].bpm:r.tempos[0].bpm,u=c.ticks/r.ppq-o,h=60/l*u;c.time=h+a,a=c.time,o+=u}),this.timeSignatures.sort(function(c,d){return c.ticks-d.ticks}),this.timeSignatures.forEach(function(c,d){var l=d>0?r.timeSignatures[d-1]:r.timeSignatures[0],u=(c.ticks-l.ticks)/r.ppq,h=u/l.timeSignature[0]/(l.timeSignature[1]/4);l.measures=l.measures||0,c.measures=h+l.measures})},n.prototype.ticksToSeconds=function(r){var a=(0,e.search)(this.tempos,r);if(a!==-1){var o=this.tempos[a],c=o.time,d=(r-o.ticks)/this.ppq;return c+60/o.bpm*d}else{var l=r/this.ppq;return 60/120*l}},n.prototype.ticksToMeasures=function(r){var a=(0,e.search)(this.timeSignatures,r);if(a!==-1){var o=this.timeSignatures[a],c=(r-o.ticks)/this.ppq;return o.measures+c/(o.timeSignature[0]/o.timeSignature[1])/4}else return r/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(r){var a=(0,e.search)(this.tempos,r,"time");if(a!==-1){var o=this.tempos[a],c=o.time,d=r-c,l=d/(60/o.bpm);return Math.round(o.ticks+l*this.ppq)}else{var u=r/.5;return Math.round(u*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(r){return{bpm:r.bpm,ticks:r.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(r){this.name=r.name,this.tempos=r.tempos.map(function(a){return Object.assign({},a)}),this.timeSignatures=r.timeSignatures.map(function(a){return Object.assign({},a)}),this.keySignatures=r.keySignatures.map(function(a){return Object.assign({},a)}),this.meta=r.meta.map(function(a){return Object.assign({},a)}),i.set(this,r.ppq),this.update()},n.prototype.setTempo=function(r){this.tempos=[{bpm:r,ticks:0}],this.update()},n}();t.Header=s}(ui)),ui}var Ve={},fi={},gs;function zr(){return gs||(gs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce(function(n,r){return n[t.controlChangeNames[r]]=r,n},{});var e=new WeakMap,i=new WeakMap,s=function(){function n(r,a){e.set(this,a),i.set(this,r.controllerType),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(n.prototype,"number",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var r=e.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var a=e.get(this);this.ticks=a.secondsToTicks(r)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();t.ControlChange=s}(fi)),fi}var je={},bs;function nc(){if(bs)return je;bs=1,Object.defineProperty(je,"__esModule",{value:!0}),je.createControlChanges=void 0;var t=zr();function e(){return new Proxy({},{get:function(i,s){if(i[s])return i[s];if(t.controlChangeIds.hasOwnProperty(s))return i[t.controlChangeIds[s]]},set:function(i,s,n){return t.controlChangeIds.hasOwnProperty(s)?i[t.controlChangeIds[s]]=n:i[s]=n,!0}})}return je.createControlChanges=e,je}var Ye={},vs;function ac(){if(vs)return Ye;vs=1,Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.PitchBend=void 0;var t=new WeakMap,e=function(){function i(s,n){t.set(this,n),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(i.prototype,"time",{get:function(){var s=t.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=t.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),i.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},i}();return Ye.PitchBend=e,Ye}var Ze={},oe={},Ss;function oc(){return Ss||(Ss=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.DrumKitByPatchID=oe.InstrumentFamilyByID=oe.instrumentByPatchID=void 0,oe.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],oe.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],oe.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),oe}var Ns;function lc(){if(Ns)return Ze;Ns=1,Object.defineProperty(Ze,"__esModule",{value:!0}),Ze.Instrument=void 0;var t=oc(),e=new WeakMap,i=function(){function s(n,r){if(this.number=0,e.set(this,r),this.number=0,n){var a=n.find(function(o){return o.type==="programChange"});a&&(this.number=a.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?t.DrumKitByPatchID[this.number]:t.instrumentByPatchID[this.number]},set:function(n){var r=t.instrumentByPatchID.indexOf(n);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":t.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var n=e.get(this);return n.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(n){this.number=n.number},s}();return Ze.Instrument=i,Ze}var Qe={},Cs;function dc(){if(Cs)return Qe;Cs=1,Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.Note=void 0;function t(a){var o=Math.floor(a/12)-1;return e(a)+o.toString()}function e(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],c=a%12;return o[c]}function i(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(a)}var s=function(){var a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(c){var d=a.exec(c),l=d[1],u=d[2],h=o[l.toLowerCase()];return h+(parseInt(u,10)+1)*12}}(),n=new WeakMap,r=function(){function a(o,c,d){n.set(this,d),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=c.velocity,this.ticks=o.ticks,this.durationTicks=c.ticks-o.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return t(this.midi)},set:function(o){this.midi=s(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var c=o-this.octave;this.midi+=c*12},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(o){this.midi=12*(this.octave+1)+i(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var c=n.get(this),d=c.secondsToTicks(this.time+o);this.durationTicks=d-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var c=n.get(this);this.ticks=c.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){var o=n.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return Qe.Note=r,Qe}var Ms;function Bs(){if(Ms)return Ve;Ms=1,Object.defineProperty(Ve,"__esModule",{value:!0}),Ve.Track=void 0;var t=Kr(),e=zr(),i=nc(),s=ac(),n=lc(),r=dc(),a=new WeakMap,o=function(){function c(d,l){var u=this;if(this.name="",this.notes=[],this.controlChanges=(0,i.createControlChanges)(),this.pitchBends=[],a.set(this,l),d){var h=d.find(function(b){return b.type==="trackName"});this.name=h?h.text:""}if(this.instrument=new n.Instrument(d,this),this.channel=0,d){for(var f=d.filter(function(b){return b.type==="noteOn"}),p=d.filter(function(b){return b.type==="noteOff"}),g=function(){var b=f.shift();y.channel=b.channel;var S=p.findIndex(function(C){return C.noteNumber===b.noteNumber&&C.absoluteTime>=b.absoluteTime});if(S!==-1){var N=p.splice(S,1)[0];y.addNote({durationTicks:N.absoluteTime-b.absoluteTime,midi:b.noteNumber,noteOffVelocity:N.velocity/127,ticks:b.absoluteTime,velocity:b.velocity/127})}},y=this;f.length;)g();var m=d.filter(function(b){return b.type==="controller"});m.forEach(function(b){u.addCC({number:b.controllerType,ticks:b.absoluteTime,value:b.value/127})});var _=d.filter(function(b){return b.type==="pitchBend"});_.forEach(function(b){u.addPitchBend({ticks:b.absoluteTime,value:b.value/Math.pow(2,13)})});var v=d.find(function(b){return b.type==="endOfTrack"});this.endOfTrackTicks=v!==void 0?v.absoluteTime:void 0}}return c.prototype.addNote=function(d){var l=a.get(this),u=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},l);return Object.assign(u,d),(0,t.insert)(this.notes,u,"ticks"),this},c.prototype.addCC=function(d){var l=a.get(this),u=new e.ControlChange({controllerType:d.number},l);return delete d.number,Object.assign(u,d),Array.isArray(this.controlChanges[u.number])||(this.controlChanges[u.number]=[]),(0,t.insert)(this.controlChanges[u.number],u,"ticks"),this},c.prototype.addPitchBend=function(d){var l=a.get(this),u=new s.PitchBend({},l);return Object.assign(u,d),(0,t.insert)(this.pitchBends,u,"ticks"),this},Object.defineProperty(c.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,l=0;l<this.notes.length-1;l++){var u=this.notes[l].time+this.notes[l].duration;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,l=0;l<this.notes.length-1;l++){var u=this.notes[l].ticks+this.notes[l].durationTicks;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),c.prototype.fromJSON=function(d){var l=this;this.name=d.name,this.channel=d.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(d.instrument),d.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=d.endOfTrackTicks);for(var u in d.controlChanges)d.controlChanges[u]&&d.controlChanges[u].forEach(function(h){l.addCC({number:h.number,ticks:h.ticks,value:h.value})});d.notes.forEach(function(h){l.addNote({durationTicks:h.durationTicks,midi:h.midi,ticks:h.ticks,velocity:h.velocity})})},c.prototype.toJSON=function(){for(var d={},l=0;l<127;l++)this.controlChanges.hasOwnProperty(l)&&(d[l]=this.controlChanges[l].map(function(h){return h.toJSON()}));var u={channel:this.channel,controlChanges:d,pitchBends:this.pitchBends.map(function(h){return h.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(h){return h.toJSON()})};return this.endOfTrackTicks!==void 0&&(u.endOfTrackTicks=this.endOfTrackTicks),u},c}();return Ve.Track=o,Ve}var we={};function cc(t){var e=[];return Wr(t,e),e}function Wr(t,e){for(var i=0;i<t.length;i++){var s=t[i];Array.isArray(s)?Wr(s,e):e.push(s)}}const uc=Object.freeze(Object.defineProperty({__proto__:null,flatten:cc},Symbol.toStringTag,{value:"Module"})),fc=ic(uc);var ws;function hc(){if(ws)return we;ws=1;var t=we&&we.__spreadArray||function(m,_,v){if(v||arguments.length===2)for(var b=0,S=_.length,N;b<S;b++)(N||!(b in _))&&(N||(N=Array.prototype.slice.call(_,0,b)),N[b]=_[b]);return m.concat(N||Array.prototype.slice.call(_))};Object.defineProperty(we,"__esModule",{value:!0}),we.encode=void 0;var e=$r(),i=Mi(),s=fc;function n(m,_){return[{absoluteTime:m.ticks,channel:_,deltaTime:0,noteNumber:m.midi,type:"noteOn",velocity:Math.floor(m.velocity*127)},{absoluteTime:m.ticks+m.durationTicks,channel:_,deltaTime:0,noteNumber:m.midi,type:"noteOff",velocity:Math.floor(m.noteOffVelocity*127)}]}function r(m){return(0,s.flatten)(m.notes.map(function(_){return n(_,m.channel)}))}function a(m,_){return{absoluteTime:m.ticks,channel:_,controllerType:m.number,deltaTime:0,type:"controller",value:Math.floor(m.value*127)}}function o(m){for(var _=[],v=0;v<127;v++)m.controlChanges.hasOwnProperty(v)&&m.controlChanges[v].forEach(function(b){_.push(a(b,m.channel))});return _}function c(m,_){return{absoluteTime:m.ticks,channel:_,deltaTime:0,type:"pitchBend",value:m.value}}function d(m){var _=[];return m.pitchBends.forEach(function(v){_.push(c(v,m.channel))}),_}function l(m){return{absoluteTime:0,channel:m.channel,deltaTime:0,programNumber:m.instrument.number,type:"programChange"}}function u(m){return{absoluteTime:0,deltaTime:0,meta:!0,text:m,type:"trackName"}}function h(m){return{absoluteTime:m.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/m.bpm),type:"setTempo"}}function f(m){return{absoluteTime:m.ticks,deltaTime:0,denominator:m.timeSignature[1],meta:!0,metronome:24,numerator:m.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function p(m){var _=i.keySignatureKeys.indexOf(m.key);return{absoluteTime:m.ticks,deltaTime:0,key:_+7,meta:!0,scale:m.scale==="major"?0:1,type:"keySignature"}}function g(m){return{absoluteTime:m.ticks,deltaTime:0,meta:!0,text:m.text,type:m.type}}function y(m){var _={header:{format:1,numTracks:m.tracks.length+1,ticksPerBeat:m.header.ppq},tracks:t([t(t(t(t([{absoluteTime:0,deltaTime:0,meta:!0,text:m.header.name,type:"trackName"}],m.header.keySignatures.map(function(v){return p(v)}),!0),m.header.meta.map(function(v){return g(v)}),!0),m.header.tempos.map(function(v){return h(v)}),!0),m.header.timeSignatures.map(function(v){return f(v)}),!0)],m.tracks.map(function(v){return t(t(t([u(v.name),l(v)],r(v),!0),o(v),!0),d(v),!0)}),!0)};return _.tracks=_.tracks.map(function(v){v=v.sort(function(S,N){return S.absoluteTime-N.absoluteTime});var b=0;return v.forEach(function(S){S.deltaTime=S.absoluteTime-b,b=S.absoluteTime,delete S.absoluteTime}),v.push({deltaTime:0,meta:!0,type:"endOfTrack"}),v}),new Uint8Array((0,e.writeMidi)(_))}return we.encode=y,we}var Ls;function mc(){return Ls||(Ls=1,function(t){var e=Me&&Me.__awaiter||function(u,h,f,p){function g(y){return y instanceof f?y:new f(function(m){m(y)})}return new(f||(f=Promise))(function(y,m){function _(S){try{b(p.next(S))}catch(N){m(N)}}function v(S){try{b(p.throw(S))}catch(N){m(N)}}function b(S){S.done?y(S.value):g(S.value).then(_,v)}b((p=p.apply(u,h||[])).next())})},i=Me&&Me.__generator||function(u,h){var f={label:0,sent:function(){if(y[0]&1)throw y[1];return y[1]},trys:[],ops:[]},p,g,y,m;return m={next:_(0),throw:_(1),return:_(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function _(b){return function(S){return v([b,S])}}function v(b){if(p)throw new TypeError("Generator is already executing.");for(;f;)try{if(p=1,g&&(y=b[0]&2?g.return:b[0]?g.throw||((y=g.return)&&y.call(g),0):g.next)&&!(y=y.call(g,b[1])).done)return y;switch(g=0,y&&(b=[b[0]&2,y.value]),b[0]){case 0:case 1:y=b;break;case 4:return f.label++,{value:b[1],done:!1};case 5:f.label++,g=b[1],b=[0];continue;case 7:b=f.ops.pop(),f.trys.pop();continue;default:if(y=f.trys,!(y=y.length>0&&y[y.length-1])&&(b[0]===6||b[0]===2)){f=0;continue}if(b[0]===3&&(!y||b[1]>y[0]&&b[1]<y[3])){f.label=b[1];break}if(b[0]===6&&f.label<y[1]){f.label=y[1],y=b;break}if(y&&f.label<y[2]){f.label=y[2],f.ops.push(b);break}y[2]&&f.ops.pop(),f.trys.pop();continue}b=h.call(u,f)}catch(S){b=[6,S],g=0}finally{p=y=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var s=$r(),n=Mi(),r=Bs(),a=hc(),o=function(){function u(h){var f=this,p=null;if(h){var g=h instanceof ArrayBuffer?new Uint8Array(h):h;p=(0,s.parseMidi)(g),p.tracks.forEach(function(y){var m=0;y.forEach(function(_){m+=_.deltaTime,_.absoluteTime=m})}),p.tracks=l(p.tracks)}this.header=new n.Header(p),this.tracks=[],h&&(this.tracks=p.tracks.map(function(y){return new r.Track(y,f.header)}),p.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return u.fromUrl=function(h){return e(this,void 0,void 0,function(){var f,p;return i(this,function(g){switch(g.label){case 0:return[4,fetch(h)];case 1:return f=g.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return p=g.sent(),[2,new u(p)];case 3:throw new Error("Could not load '".concat(h,"'"))}})})},Object.defineProperty(u.prototype,"name",{get:function(){return this.header.name},set:function(h){this.header.name=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var h=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){var h=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),u.prototype.addTrack=function(){var h=new r.Track(void 0,this.header);return this.tracks.push(h),h},u.prototype.toArray=function(){return(0,a.encode)(this)},u.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(h){return h.toJSON()})}},u.prototype.fromJSON=function(h){var f=this;this.header=new n.Header,this.header.fromJSON(h.header),this.tracks=h.tracks.map(function(p){var g=new r.Track(void 0,f.header);return g.fromJSON(p),g})},u.prototype.clone=function(){var h=new u;return h.fromJSON(this.toJSON()),h},u}();t.Midi=o;var c=Bs();Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return c.Track}});var d=Mi();Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return d.Header}});function l(u){for(var h=[],f=0;f<u.length;f++)for(var p=h.length,g=new Map,y=Array(16).fill(0),m=0,_=u[f];m<_.length;m++){var v=_[m],b=p,S=v.channel;if(S!==void 0){v.type==="programChange"&&(y[S]=v.programNumber);var N=y[S],C="".concat(N," ").concat(S);g.has(C)?b=g.get(C):(b=p+g.size,g.set(C,b))}h[b]||h.push([]),h[b].push(v)}return h}}(Me)),Me}var Xr=mc();const Vr=["acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honkytonk_piano","electric_piano_1","electric_piano_2","harpsichord","clavinet","celesta","glockenspiel","music_box","vibraphone","marimba","xylophone","tubular_bells","dulcimer","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","guitar_harmonics","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass","slap_bass_1","slap_bass_2","synth_bass_1","synth_bass_2","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synth_strings_1","synth_strings_2","choir_aahs","voice_oohs","synth_choir","orchestra_hit","trumpet","trombone","tuba","muted_trumpet","french_horn","brass_section","synth_brass_1","synth_brass_2","soprano_sax","alto_sax","tenor_sax","baritone_sax","oboe","english_horn","bassoon","clarinet","piccolo","flute","recorder","pan_flute","blown_bottle","shakuhachi","whistle","ocarina","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","sitar","banjo","shamisen","koto","kalimba","bagpipe","fiddle","shanai","tinkle_bell","agogo","steel_drums","woodblock","taiko_drum","melodic_tom","synth_drum","reverse_cymbal","guitar_fret_noise","breath_noise","seashore","bird_tweet","telephone_ring","helicopter","applause","gunshot"];function pc(t){const e=t.split("/"),s=e[e.length-1].trim().toLowerCase().replace(/\s+/g,"_"),n=Vr.findIndex(r=>r===s);return n!==-1?n:(s.includes("drum")||s.includes("drummachine"),0)}async function yc(t){if(!t.sequencers.length)throw new Error("No tracks to export.");const e=new Xr.Midi;e.header.setTempo(t.tempo),e.header.timeSignatures.push({ticks:0,timeSignature:t.timeSignature});for(const[n,r]of t.sequencers.entries()){const a=e.addTrack(),o=r.instrument.toLowerCase().includes("drum");a.channel=o?9:n%16;const c=pc(r.instrument);if(a.instrument.number=c,typeof r.volume=="number"&&a.addCC({number:7,time:0,value:Math.max(0,Math.min(1,r.volume))}),typeof r.pan=="number"){const d=(r.pan+1)/2;a.addCC({number:10,time:0,value:Math.max(0,Math.min(1,d))})}for(const d of r.notes){const l=K(d.pitch),u=Math.max(.01,Math.min(1,(d.velocity??100)/127));if(l===null)continue;const h=Gs(d.start,t.tempo),f=Gs(d.duration,t.tempo);a.addNote({midi:l,time:h,duration:f,velocity:u})}}const i=new Blob([e.toArray()],{type:"audio/midi"});return{url:URL.createObjectURL(i),filename:`session-${Date.now()}.mid`}}function Gs(t,e){return 60/e*t}async function _c(t){var c,d,l;const e=await t.text();let i;try{i=JSON.parse(e)}catch{throw new Error("Invalid JSON format.")}if(!Array.isArray(i.tr))throw new Error("Missing or invalid `tr` (tracks) array.");const s={bpm:((c=i.c)==null?void 0:c.b)??120,beatsPerMeasure:((d=i.c)==null?void 0:d.bpm)??4,totalMeasures:((l=i.c)==null?void 0:l.tm)??8},n=Array.isArray(i.i)?i.i:[],r=Array.isArray(i.vlm)?i.vlm:[],a=Array.isArray(i.pan)?i.pan:[],o=i.tr.map((u,h)=>{if(!Array.isArray(u.n))throw new Error(`Track ${h} missing \`n\` (notes) array.`);const f=u.n.map(([m,_,v,b])=>({pitch:m,start:_,duration:v,velocity:b??100})),p=n[h]||"sf2/fluidr3-gm/acoustic_grand_piano",g=r[h],y=a[h];return{notes:f,instrument:p,volume:typeof g=="number"?g:void 0,pan:typeof y=="number"?y:void 0,config:{}}});return{globalConfig:s,tracks:o}}async function gc(t){var f;const e=await t.arrayBuffer(),i=new Xr.Midi(e),s=i.header.tempos[0],n=i.header.timeSignatures[0],r=(s==null?void 0:s.bpm)??120,a=((f=n==null?void 0:n.timeSignature)==null?void 0:f[0])??4,c=Math.max(0,...i.tracks.flatMap(p=>p.notes.map(g=>g.time+g.duration)))*(r/60),d=Math.ceil(c/a)||8,l={bpm:r,beatsPerMeasure:a,totalMeasures:d},u=await ga(),h=i.tracks.map(p=>{const g=p.notes.map(N=>({pitch:N.name,start:N.time*(r/60),duration:N.duration*(r/60),velocity:Math.max(1,Math.min(127,Math.round(N.velocity*127)))}));let y=p.instrument.number;(y===void 0||y===0)&&(y=p.channel===9?0:p.channel%128);const m=p.controlChanges[7]||[],_=p.controlChanges[10]||[],v=m.length>0?m[0].value:void 0,b=_.length>0?_[0].value*2-1:void 0;let S;if(p.channel===9){const N=Ea(y);N?S=`webaudiofont/${N.library}/${N.displayName}`:S=`sf2/drummachines/${u.includes("LM-2")?"LM-2":u[0]??"TR-808"}`}else S=`sf2/fluidr3-gm/${Vr[y]||"acoustic_grand_piano"}`;return{notes:g,instrument:S,volume:v,pan:b,config:{}}});return{globalConfig:l,tracks:h}}function bc(){for(const t of T){const e=t.container;if(!e)continue;const i=e.querySelector(".sequencer-body"),s=e.querySelector("canvas.mini-contour"),n=e.querySelector(".collapse-btn use");!i||!s||i.classList.contains("hidden")||requestAnimationFrame(()=>{i.classList.add("hidden"),s.classList.remove("hidden"),n==null||n.setAttribute("href","#icon-caret-up"),t.setCollapsed(!0),vt(s,t.notes,t.config,t.colorIndex)})}}let ce=null,Ht=null;function vc(t){Ht=t,ce=Ht.getContext("2d")}function ti(t){if(!ce||!Ht)return;const{width:e,height:i}=Ht;ce.clearRect(0,0,e,i);const s=Math.round(t)+.5;ce.strokeStyle="#ff00ff",ce.lineWidth=1,ce.beginPath(),ce.moveTo(s,0),ce.lineTo(s,i),ce.stroke()}function Es(t,e){I.isActive()&&I.pause(),xi(e.bpm),Ui(e.beatsPerMeasure),Di(e.totalMeasures);const i=document.getElementById("tempo-input");i&&(i.value=String(me()));const s=document.getElementById("measures-input");s&&(s.value=String(We())),td();for(const[r,a]of t.entries()){const o=r,c=a.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",d=a.notes||[],l=a.volume,u=a.pan;O({type:"CREATE_SEQUENCER",id:o,instrument:c,notes:structuredClone(d),volume:l,pan:u,config:{...a.config||{}}},Ti(o))}O(Ri("Session Loaded"),yr("Session Loaded")),I.setSequencers(T),bc();const n=document.getElementById("global-mini-contour");n&&Wo(n,T),ti(0)}const Is={Digit1:4,Digit2:2,Digit3:1,Digit4:.5,Digit5:.25,Digit6:.125};function Sc(){const t=document.querySelectorAll(".note-duration-btn"),e=document.getElementById("note-duration"),i=document.getElementById("dotted-note-btn"),s=document.getElementById("triplet-note-btn");let n=!1,r=!1;function a(d){let l=d;n?l=d*1.5:r&&(l=d*(2/3)),z.currentDuration=l,T.forEach(h=>{var f;h.config.currentDuration=l,(f=h.matrix)==null||f.requestRedraw()});let u=Array.from(e.options).find(h=>Math.abs(parseFloat(h.value)-l)<1e-4);u||(u=new Option(l.toString(),l.toString()),e.add(u)),e.value=u.value,e.dispatchEvent(new Event("change",{bubbles:!0,cancelable:!0})),o(d)}function o(d){t.forEach(l=>{const u=parseFloat(l.dataset.value??"0");l.classList.remove("bg-purple-700","bg-gray-800"),u===d?l.classList.add("bg-purple-700"):l.classList.add("bg-gray-800")})}function c(){const d=document.querySelector(".note-duration-btn.bg-purple-700");if(d){const l=parseFloat(d.dataset.value);a(l)}}t.forEach(d=>{d.addEventListener("click",()=>{const l=parseFloat(d.dataset.value);a(l)})}),i.addEventListener("click",()=>{r&&(r=!1,s.classList.remove("bg-purple-700")),n=!n,i.classList.toggle("bg-purple-700"),c()}),s.addEventListener("click",()=>{n&&(n=!1,i.classList.remove("bg-purple-700")),r=!r,s.classList.toggle("bg-purple-700"),z.isTripletMode=r,T.forEach(d=>{d.config.isTripletMode=r}),c()}),document.addEventListener("keydown",d=>{const l=d.target;if(!(l.tagName==="INPUT"||l.tagName==="TEXTAREA"||l.isContentEditable||Dr())){if(Object.prototype.hasOwnProperty.call(Is,d.code)){d.preventDefault();const u=Is[d.code],h=Array.from(t).find(f=>parseFloat(f.dataset.value??"-1")===u);h&&h.click();return}if(d.key==="."){d.preventDefault(),i==null||i.click();return}if(d.key==="/"){d.preventDefault(),s==null||s.click();return}}}),a(z.currentDuration||1)}function jr(t,e){var i;for(const s of t.sequencers){const n=s.matrix;if(!n)continue;const r=(i=n.getPixelsPerBeat)==null?void 0:i.call(n);if(!r)continue;const a=e*r;n.setPlayheadPixelX(a)}}let ft=null;function Yr(t){const i=ae();function s(){if(!t.isActive())return;const n=t.getCurrentBeat(),r=n/i*1260;ti(r),jr(t,n),ft=requestAnimationFrame(s)}Bi(),ft=requestAnimationFrame(s)}function Bi(){ft!==null&&(cancelAnimationFrame(ft),ft=null)}function Nc(t){var e;ti(0);for(const i of t.sequencers)(e=i.matrix)==null||e.setPlayheadPixelX(0)}function Cc(t,e){const i=e.snapResolution||.25,s=e.isTripletMode?i*(2/3):i;return Math.round(t/s)*s}let $t=!1,ye=null,wi=null,Li=!1;function Mc(t,e){ye=t,wi=e,ye.addEventListener("mousedown",Bc),window.addEventListener("mousemove",wc),window.addEventListener("mouseup",Lc)}function Bc(t){I.isActive()&&(I.pause(),Li=!0),$t=!0,Wi(t)}function wc(t){$t&&Wi(t)}function Lc(t){$t&&(Wi(t),$t=!1,Li&&(I.resume(),Li=!1))}function Wi(t){if(!ye||!wi)return;const e=ye.getBoundingClientRect(),i=ye.width/e.width;let s=(t.clientX-e.left)*i;s=Math.max(0,Math.min(ye.width,s));const n=ae(),r=s/ye.width*n,a=Cc(r,wi),o=a/n*ye.width;I.seek(a),jr(I,I.getCurrentBeat()),ti(o)}const Xi={maxBeatsContext:32,extendBeatsAmount:16};function qc(){return Xi.maxBeatsContext}function Jc(){return Xi.extendBeatsAmount}function Gi(t,e,i,s){const n=ae(),r=s/n*e;t.clearRect(0,0,e,i);const a=Xi.maxBeatsContext,c=Math.max(0,s-a)/n*e,d=r-c;t.fillStyle="rgba(85, 187, 255, 0.55)",t.fillRect(c,0,d,i),t.strokeStyle="#ffffff",t.lineWidth=2,t.beginPath(),t.moveTo(r,0),t.lineTo(r,i),t.stroke()}let ks=!1,hi=!1,ht=0;function Hc(){return ht}function As(){if(!ks){ks=!0;const s=document.getElementById("extend-use-tags"),n=document.getElementById("extend-tags");if(s&&n){let d=function(){const h=l.checked;u.disabled=!h,u.classList.toggle("opacity-50",!h),u.classList.toggle("cursor-not-allowed",!h)};const l=s,u=n;d(),l.addEventListener("change",d)}const r=document.getElementById("extend-start-help-btn"),a=document.getElementById("extend-start-help-popup"),o=document.getElementById("extend-start-help-close");r&&a&&o&&(r.addEventListener("click",()=>a.classList.remove("hidden")),o.addEventListener("click",()=>a.classList.add("hidden")),document.addEventListener("click",d=>{d.target instanceof Node&&!a.contains(d.target)&&d.target!==r&&a.classList.add("hidden")}));const c=document.querySelector("#ai-extend-modal .generate-btn");c&&c.addEventListener("click",async()=>{const{extendTracksWithAI:d}=await sn(async()=>{const{extendTracksWithAI:l}=await import("./extendTracks-JIj-plVC.js");return{extendTracksWithAI:l}},__vite__mapDeps([0,1]));await d()})}const t=document.getElementById("extend-track-checkboxes"),e=document.getElementById("extend-select-all"),i=document.getElementById("extend-deselect-all");t&&e&&i&&(t.innerHTML="",te().forEach((n,r)=>{const a=`extend-track-${r}`,o=document.createElement("div");o.className="flex items-center gap-2";const c=document.createElement("input");c.type="checkbox",c.id=a,c.dataset.index=r.toString(),c.checked=!0,c.className="w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-600 focus:ring-purple-500";const d=document.createElement("label");d.htmlFor=a,d.className="text-sm text-gray-200",d.textContent=`Track ${r+1}`,c.addEventListener("change",()=>{ot()}),o.appendChild(c),o.appendChild(d),t.appendChild(o)}),e.addEventListener("click",()=>{t.querySelectorAll('input[type="checkbox"]').forEach(n=>n.checked=!0),ot()}),i.addEventListener("click",()=>{t.querySelectorAll('input[type="checkbox"]').forEach(n=>n.checked=!1),ot()}),ot())}function Gc(){const t=document.getElementById("extend-mini-contour"),e=document.getElementById("extend-mini-playhead");if(!t||!e)return;const i=e.getContext("2d");if(!i)return;const s=t.clientWidth,n=t.clientHeight;t.width=s,t.height=n,e.width=s,e.height=n,ot(),Gi(i,s,n,ht),e.addEventListener("mousedown",a=>{hi=!0,r(a.offsetX)}),window.addEventListener("mouseup",()=>{hi=!1}),window.addEventListener("mousemove",a=>{if(!hi)return;const o=e.getBoundingClientRect();r(a.clientX-o.left)});function r(a){if(!i)return;const o=ae(),c=Math.max(0,Math.min(a,s));ht=Math.round(c/s*o),Gi(i,s,n,ht)}}function ot(){const t=document.getElementById("extend-mini-contour"),e=document.getElementById("extend-mini-playhead");if(!t||!e)return;const i=e.getContext("2d");if(!i)return;const s=e.width,n=e.height,r=document.querySelectorAll('#extend-track-checkboxes input[type="checkbox"]'),a=Array.from(r).filter(c=>c.checked).map(c=>parseInt(c.dataset.index||"0",10)),o=te().filter((c,d)=>a.includes(d));Se(t,o),Gi(i,s,n,ht)}function Ec(){const t=document.getElementById("note-placement-options-btn"),e=document.getElementById("note-editing-options-btn"),i=document.getElementById("note-duration-controls"),s=document.getElementById("note-editing-controls"),n=document.getElementById("velocity-mode-controls");if(!t||!e||!i||!s||!n){console.error("Missing essential UI elements for edit mode switching.");return}function r(o){[t,e].forEach(c=>{c&&(c.classList.remove("bg-purple-600"),c.classList.add("bg-gray-800"))}),o.classList.remove("bg-gray-800"),o.classList.add("bg-purple-600")}function a(o){[i,s,n].forEach(c=>{c&&c.classList.add("hidden")}),o.classList.remove("hidden")}t.addEventListener("click",()=>{r(t),a(i)}),e.addEventListener("click",()=>{r(e),a(s)}),window.addEventListener("keydown",o=>{var l;const c=(l=document.activeElement)==null?void 0:l.tagName;if(!(c==="INPUT"||c==="TEXTAREA"||document.querySelector(".ai-modal:not(.hidden)")))switch(o.key.toLowerCase()){case"q":t.click();break;case"w":e.click();break;default:return}}),r(t),a(i)}function Ic(){var h,f,p;const t=document.getElementById("note-mode-btn"),e=document.getElementById("ai-mode-btn"),i=document.getElementById("note-duration-panel"),s=document.getElementById("ai-control-panel");if(!t||!e||!i||!s){console.error("Missing essential elements for control mode switching.");return}function n(){document.querySelectorAll(".sequencer").forEach(g=>{const y=g.querySelector(".delete-btn"),m=g.querySelector(".collapse-btn"),_=m==null?void 0:m.querySelector("use"),v=g.querySelector(".sequencer-body"),b=g.querySelector(".mini-contour");!y||!m||!_||!v||!b||(y.classList.add("button-locked"),m.classList.add("button-locked"),Sr(g,!1),v.classList.contains("hidden")||(v.classList.add("hidden"),b.classList.remove("hidden"),_.setAttribute("href","#icon-caret-up")))})}function r(){document.querySelectorAll(".sequencer").forEach(g=>{const y=g.querySelector(".delete-btn"),m=g.querySelector(".collapse-btn");y==null||y.classList.remove("button-locked"),m==null||m.classList.remove("button-locked")})}function a(){!t||!e||!i||!s||(t.classList.replace("bg-gray-800","bg-blue-600"),e.classList.replace("bg-purple-600","bg-gray-800"),i.classList.remove("hidden"),s.classList.add("hidden"),r())}function o(){if(!Ci()){const g=document.getElementById("openai-key-not-set-modal");g==null||g.classList.remove("hidden");return}!t||!e||!i||!s||(e.classList.replace("bg-gray-800","bg-purple-600"),t.classList.replace("bg-blue-600","bg-gray-800"),i.classList.add("hidden"),s.classList.remove("hidden"),n())}t.addEventListener("click",a),e.addEventListener("click",o);const c=document.getElementById("ai-inpaint-modal"),d=document.getElementById("ai-extend-modal"),l=document.getElementById("ai-generate-modal");function u(g){if(!g)return;const y=g.querySelector(".cancel-btn");y==null||y.addEventListener("click",()=>{g.classList.add("hidden")})}u(c),u(d),u(l),As(),(h=document.getElementById("ai-inpaint-btn"))==null||h.addEventListener("click",()=>{c==null||c.classList.remove("hidden")}),(f=document.getElementById("ai-extend-btn"))==null||f.addEventListener("click",()=>{d==null||d.classList.remove("hidden"),Gc(),As()}),(p=document.getElementById("ai-generate-btn"))==null||p.addEventListener("click",()=>{l==null||l.classList.remove("hidden")}),Ec()}function kc(t,e,i,s=!0){const n=t.getInteractionStore();let r=new Set;if(s){const a=n.getSelectedNotes();r=new Set(a.map(o=>`${o.pitch}:${o.start}:${o.duration}:${o.velocity}`))}if(t.setNotes(structuredClone(e)),t.getNoteManager().rebuildIndex(),s&&r.size>0){const a=t.notes.filter(o=>r.has(`${o.pitch}:${o.start}:${o.duration}:${o.velocity}`));n.setSelectedNotes(a)}if(I!=null&&I.isActive()){const a=I.getStartTime(),o=I.getStartBeat();i.reschedulePlayback(a,o)}t.requestRedraw()}function Ac(t,e){return t!==void 0&&e!==void 0&&t===e}function Pc(t=Ne()){var i;xi(t.tempo,!1),Ui(t.timeSignature[0],!1),Di(t.totalMeasures,!1);for(const s of T)s.updateTotalMeasures();for(const s of t.sequencers){const n=T.find(r=>Ac(r.id,s.id));if(n){n.instrumentName=s.instrument,typeof s.volume=="number"&&(n.volume=s.volume),typeof s.pan=="number"&&(n.pan=s.pan);const r=(i=n.container)==null?void 0:i.querySelector("canvas.mini-contour");r&&vt(r,s.notes,n.config,n.colorIndex),n.matrix&&kc(n.matrix,s.notes,n,!0)}else{const r={id:s.id,instrument:s.instrument,notes:structuredClone(s.notes),volume:s.volume,pan:s.pan};Ar(r)}}const e=document.getElementById("global-mini-contour");e&&Se(e,T)}class Fc{constructor(e){this.startTime=0,this.startBeat=0,this.isPlaying=!1,this.animationFrameId=null,this.onResumeCallback=null,this.tick=()=>{if(!this.isPlaying)return;const i=this.getCurrentBeat(),s=ae();if(i>=s)if(qo())this.seek(0),this.start();else{this.stop();return}this.animationFrameId=requestAnimationFrame(this.tick)},this.context=X(),this.sequencers=e}setOnResumeCallback(e){this.onResumeCallback=e}getCurrentBeat(){if(!this.isPlaying)return this.startBeat;const e=60/me();return(this.context.currentTime-this.startTime)/e+this.startBeat}async start(){const e=this.context.currentTime+.1;this.startTime=e,this.startBeat=0,this.isPlaying=!0,await this.scheduleAll(e,this.startBeat),this.context.state==="suspended"&&await this.context.resume(),this.animationFrameId=requestAnimationFrame(this.tick)}syncAfterTempoChange(e){const i=this.context.currentTime,s=60/e,n=(i-this.startTime)/s+this.startBeat;this.startBeat=n,this.startTime=i}async pause(){if(!this.isPlaying)return;const e=this.getCurrentBeat();for(const i of this.sequencers)i.stopScheduledNotes();await this.context.suspend(),this.startBeat=e,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}async resume(){var s;if(this.isPlaying)return;await this.context.resume();const i=this.context.currentTime+.05;this.startTime=i,await this.scheduleAll(i,this.startBeat),this.isPlaying=!0,(s=this.onResumeCallback)==null||s.call(this),this.animationFrameId=requestAnimationFrame(this.tick)}async scheduleAll(e,i){for(const s of this.sequencers)s.shouldPlay?await s.preparePlayback(e,i):s.stopScheduledNotes()}stop(){for(const e of this.sequencers)e.stopScheduledNotes();this.isPlaying=!1,this.startBeat=0,this.startTime=0,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),Wd()}seek(e){this.startBeat=e,this.startTime=this.context.currentTime,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}setSequencers(e){this.sequencers=e}isActive(){return this.isPlaying}getStartTime(){return this.startTime}getStartBeat(){return this.startBeat}}ca();ld();const I=new Fc(te());I.setOnResumeCallback(()=>Yr(I));Po(Pc);Hl();function Tc(){const t=document.getElementById("global-mini-contour");t&&Se(t,T)}document.getElementById("global-mini-contour");const Zr=document.getElementById("global-mini-playhead");vc(Zr);Mc(Zr,z);const Ps=0,Rc="sf2/fluidr3-gm/acoustic_grand_piano";O(cr(Ps,Rc),Ti(Ps));const Oc=document.getElementById("piano");Pd(Oc);const xc=document.getElementById("waveform"),Uc=document.getElementById("visualizer-mode");Td(xc,Uc);O(Ri("Initial App State"),yr("Initial App State"));cd(Ro,Oo);Tc();Rd();Sc();Sd();bd();tc();Ic();Xd();Ld();Gd();dd();zd({getSequencers:()=>T,onPlay:async()=>{await I.start(),Yr(I)},onPause:async()=>{await I.pause(),Bi()},onResume:async()=>{await I.resume()},onStop:()=>{I.stop(),Bi(),Nc(I)},onDurationChange:t=>{z.currentDuration=t,T.forEach(e=>e.config.currentDuration=t)},onSnapChange:t=>{z.snapResolution=t,T.forEach(e=>e.config.snapResolution=t)},onToggleLoop:t=>{z.loopEnabled=t,T.forEach(e=>e.config.loopEnabled=t),Do(t)},onTempoChange:t=>{xi(t)},onSave:async t=>{const e=Ne();if(t==="json"){const{url:i,filename:s}=Vd(e),n=document.createElement("a");n.href=i,n.download=s,n.click(),URL.revokeObjectURL(i)}else if(t==="wav")Zd();else if(t==="midi"){const{url:i,filename:s}=await yc(e),n=document.createElement("a");n.href=i,n.download=s,n.click(),URL.revokeObjectURL(i)}},onLoad:async t=>{var e;try{const i=(e=t.name.split(".").pop())==null?void 0:e.toLowerCase();if(i==="json"){const{tracks:s,globalConfig:n}=await _c(t);Es(s,n)}else if(i==="mid"||i==="midi"){const{tracks:s,globalConfig:n}=await gc(t);Es(s,n)}else throw new Error("Unsupported file type.")}catch(i){i instanceof Error?alert("Failed to load file: "+i.message):alert("Failed to load file: Unknown error")}},onMeasuresChange:t=>{Di(t);const e=document.getElementById("global-mini-contour");e&&Se(e,T)},onBeatsPerMeasureChange:t=>{Ui(t);const e=document.getElementById("global-mini-contour");e&&Se(e,T)}});ua();Rs("Sequenzia initialized");Q("Current config: ",z);Q("Current sequencers: ",T[0]);Q("Current state: ",Ne());const $c=Object.freeze(Object.defineProperty({__proto__:null,engine:I},Symbol.toStringTag,{value:"Module"}));export{us as a,te as b,Hc as c,qc as d,Jc as e,bt as f,Ci as g,vt as h,Se as i,$c as m,Di as u};
