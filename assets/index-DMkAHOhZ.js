import{g as bs,S as Pr,a as Dr,M as qr,D as Kr,b as Hr,c as zr,d as $r,e as Jr,f as Wr,i as jr,h as Xr,P as Vr,j as vs}from"./vendor-BrbinlG8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function Yr(){return new Date().toISOString()}function yt(i,e=2){var s,n;if(i===null||typeof i!="object")return i;if(e<=0){const r=((s=i.constructor)==null?void 0:s.name)||"Object",a=Object.keys(i).length;return`[${r} object, ${a} keys]`}if(Array.isArray(i))return i.length>10?[...i.slice(0,10).map(r=>yt(r,e-1)),`...(${i.length} total)`]:i.map(r=>yt(r,e-1));const t={_type:((n=i.constructor)==null?void 0:n.name)||"Object"};for(const r in i){if(!Object.prototype.hasOwnProperty.call(i,r))continue;const a=i[r];if(a instanceof HTMLElement)t[r]=`[HTMLElement: ${a.tagName}]`;else if(a instanceof AudioContext||a instanceof AudioNode)t[r]="[AudioNode]";else if(typeof a=="function")t[r]="[Function]";else if(typeof a=="object"){const l=Object.keys(a).length>3?e-1:e;t[r]=yt(a,l)}else t[r]=a}return t}function Zr(i){try{const e=yt(i,2);return JSON.stringify(e,null,2)}catch(e){return JSON.stringify({error:"Could not serialize log payload",reason:e.message,type:typeof i},null,2)}}function Ss(i,e,t="log"){const n={timestamp:Yr(),level:t,message:i};e!==void 0&&(n.data=e);const r=Zr(n);switch(t){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;case"debug":console.debug(r);break;case"log":default:console.log(r);break}}const ui="SEQUENZIA_DEV";let et=!1;typeof window<"u"&&(et=localStorage.getItem(ui)==="true");function Ti(){et=!0,typeof window<"u"&&localStorage.setItem(ui,"true")}function Qr(){et=!1,typeof window<"u"&&localStorage.removeItem(ui)}function Rt(){return et}function F(i,e,t="log"){et&&Ss(i,e,t)}class he{constructor(){this.reloadCallbacks=[]}static getInstance(){return he.instance||(he.instance=new he),he.instance}registerReloadable(e){this.reloadCallbacks.push(e)}unregisterReloadable(e){this.reloadCallbacks=this.reloadCallbacks.filter(t=>t!==e)}reloadAll(){this.reloadCallbacks.forEach(e=>e())}}function en(){const i=document.getElementById("splash-modal");return i?!i.classList.contains("hidden"):!1}function Cs(i){const e=[];for(const t of i)Array.isArray(t)?e.push(...Cs(t)):t!=null&&t!==!1&&e.push(t);return e}function m(i,e={},...t){const s=document.createElement(i);for(const[r,a]of Object.entries(e))if(!(a==null||a===!1))if(r==="class"||r==="className")s.className=a;else if(r==="style"&&typeof a=="object")for(const[o,l]of Object.entries(a))l!=null&&(s.style[o]=l);else if(r==="dataset"&&typeof a=="object")for(const[o,l]of Object.entries(a))s.dataset[o]=String(l);else r.startsWith("data-")?s.setAttribute(r,String(a)):r.startsWith("on")&&typeof a=="function"?s.addEventListener(r.slice(2).toLowerCase(),a):r in s?s[r]=a:s.setAttribute(r,String(a));const n=Cs(t);for(const r of n)s.appendChild(typeof r=="string"?document.createTextNode(r):r);return s}const tn={global:{noteToolMode:"express"},theme:{gridColorScheme:"Darkroom",noteColorScheme:"Track Color",skin:"Default"},ai:{openaiApiKey:"",openaiModel:"gpt-4o"}},Ns={name:"Default",appBackground:"bg-black",menuBackground:"bg-gradient-to-br from-gray-800 to-gray-900",surfaceBackground:"bg-gray-900",accentColor:"bg-purple-700",textColor:"text-white",borderColor:"border-purple-950",buttonPrimaryColor:"bg-purple-700",buttonPrimaryColorHover:"hover:bg-purple-600",buttonSecondaryColor:"bg-gray-800",buttonSecondaryColorHover:"hover:bg-gray-700",buttonTertiaryColor:"bg-blue-700",buttonTertiaryColorHover:"hover:bg-blue-600",toggleTrackBase:"bg-gray-700",toggleTrackChecked:"peer-checked:bg-purple-600",toggleKnobBase:"after:border-gray-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#a6a09b",whiteKeyColor:"#292524",volumeGradientFrom:"from-purple-600",volumeGradientTo:"to-purple-400",volumeThumbColor:"bg-purple-500",panGradientFrom:"from-indigo-600",panGradientTo:"to-indigo-400",panThumbColor:"bg-indigo-500",snapMarkerColor:"bg-purple-300/50"},sn={name:"Blue Dream",appBackground:"bg-gradient-to-b from-blue-900 to-gray-900",menuBackground:"bg-gradient-to-br from-blue-800 to-blue-900",surfaceBackground:"bg-blue-950/80",accentColor:"bg-cyan-400",textColor:"text-white",borderColor:"border-cyan-400",buttonPrimaryColor:"bg-cyan-600",buttonPrimaryColorHover:"hover:bg-cyan-500",buttonSecondaryColor:"bg-blue-800",buttonSecondaryColorHover:"hover:bg-blue-700",buttonTertiaryColor:"bg-indigo-600",buttonTertiaryColorHover:"hover:bg-indigo-500",toggleTrackBase:"bg-blue-700",toggleTrackChecked:"peer-checked:bg-cyan-400",toggleKnobBase:"after:border-blue-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#1b1f5f",whiteKeyColor:"#c0e7ff",volumeGradientFrom:"from-cyan-500",volumeGradientTo:"to-cyan-300",volumeThumbColor:"bg-cyan-400",panGradientFrom:"from-indigo-500",panGradientTo:"to-indigo-300",panThumbColor:"bg-indigo-400",snapMarkerColor:"bg-cyan-400/50"},rn={name:"Modern Light",appBackground:"bg-white",menuBackground:"bg-gray-100",surfaceBackground:"bg-gray-200",accentColor:"bg-blue-600",textColor:"text-gray-900",borderColor:"border-blue-600",buttonPrimaryColor:"bg-blue-600",buttonPrimaryColorHover:"hover:bg-blue-500",buttonSecondaryColor:"bg-gray-200",buttonSecondaryColorHover:"hover:bg-gray-300",buttonTertiaryColor:"bg-gray-300",buttonTertiaryColorHover:"hover:bg-gray-400",toggleTrackBase:"bg-gray-300",toggleTrackChecked:"peer-checked:bg-blue-600",toggleKnobBase:"after:border-gray-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#111111",whiteKeyColor:"#ffffff",volumeGradientFrom:"from-blue-500",volumeGradientTo:"to-blue-300",volumeThumbColor:"bg-blue-400",panGradientFrom:"from-sky-500",panGradientTo:"to-sky-300",panThumbColor:"bg-sky-400",snapMarkerColor:"bg-blue-400/50"},nn={name:"Synthwave",appBackground:"bg-gradient-to-br from-black via-gray-900 to-purple-950",menuBackground:"bg-gradient-to-br from-purple-800 to-pink-900",surfaceBackground:"bg-gray-900/80",accentColor:"bg-fuchsia-500",textColor:"text-neon-green",borderColor:"border-fuchsia-500",buttonPrimaryColor:"bg-pink-700",buttonPrimaryColorHover:"hover:bg-pink-600",buttonSecondaryColor:"bg-purple-800",buttonSecondaryColorHover:"hover:bg-purple-700",buttonTertiaryColor:"bg-gray-800",buttonTertiaryColorHover:"hover:bg-gray-700",toggleTrackBase:"bg-pink-800",toggleTrackChecked:"peer-checked:bg-fuchsia-500",toggleKnobBase:"after:border-pink-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#d946ef",whiteKeyColor:"#f5d0fe",volumeGradientFrom:"from-fuchsia-500",volumeGradientTo:"to-pink-400",volumeThumbColor:"bg-fuchsia-400",panGradientFrom:"from-purple-600",panGradientTo:"to-purple-400",panThumbColor:"bg-purple-500",snapMarkerColor:"bg-fuchsia-300/50"},an={name:"Verdant Alloy",appBackground:"bg-gradient-to-b from-gray-900 to-green-950",menuBackground:"bg-gradient-to-tr from-emerald-800 to-lime-700",surfaceBackground:"bg-emerald-950/70",accentColor:"bg-lime-400",textColor:"text-lime-100",borderColor:"border-lime-400",buttonPrimaryColor:"bg-emerald-600",buttonPrimaryColorHover:"hover:bg-emerald-500",buttonSecondaryColor:"bg-lime-700",buttonSecondaryColorHover:"hover:bg-lime-600",buttonTertiaryColor:"bg-gray-700",buttonTertiaryColorHover:"hover:bg-gray-600",toggleTrackBase:"bg-emerald-700",toggleTrackChecked:"peer-checked:bg-lime-400",toggleKnobBase:"after:border-lime-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#143016",whiteKeyColor:"#dbf4dc",volumeGradientFrom:"from-emerald-500",volumeGradientTo:"to-emerald-300",volumeThumbColor:"bg-emerald-400",panGradientFrom:"from-lime-500",panGradientTo:"to-lime-300",panThumbColor:"bg-lime-400",snapMarkerColor:"bg-lime-300/50"},on={name:"Sunset",appBackground:"bg-gradient-to-br from-orange-900 via-red-800 to-purple-900",menuBackground:"bg-gradient-to-bl from-rose-800 to-orange-700",surfaceBackground:"bg-orange-950/70",accentColor:"bg-yellow-400",textColor:"text-yellow-100",borderColor:"border-yellow-400",buttonPrimaryColor:"bg-amber-600",buttonPrimaryColorHover:"hover:bg-amber-500",buttonSecondaryColor:"bg-red-700",buttonSecondaryColorHover:"hover:bg-red-600",buttonTertiaryColor:"bg-purple-700",buttonTertiaryColorHover:"hover:bg-purple-600",toggleTrackBase:"bg-red-700",toggleTrackChecked:"peer-checked:bg-yellow-400",toggleKnobBase:"after:border-orange-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#45122c",whiteKeyColor:"#fff3e0",volumeGradientFrom:"from-amber-500",volumeGradientTo:"to-amber-300",volumeThumbColor:"bg-amber-400",panGradientFrom:"from-rose-500",panGradientTo:"to-rose-300",panThumbColor:"bg-rose-400",snapMarkerColor:"bg-amber-300/50"},ln={Default:Ns,"Blue Dream":sn,"Modern Light":rn,Synthwave:nn,"Verdant Alloy":an,Sunset:on};function cn(i){return ln[i]||Ns}const tt=structuredClone(tn);tt.theme.skin;function z(){return tt}function ws(){return tt.ai.openaiApiKey}function O(){return cn(tt.theme.skin)}function le(i){Ms(tt,i);try{const e=K();if(e.length>0)for(const t of e)t.redraw()}catch(e){console.warn("[updateUserConfig] Skipped sequencer UI refresh (store not ready yet).",e)}}function Ms(i,e){for(const t in e)e[t]&&typeof e[t]=="object"&&!Array.isArray(e[t])?(i[t]||(i[t]={}),Ms(i[t],e[t])):i[t]=e[t]}const dn={sm:{widthClass:"w-[300px]",maxWidthClass:"max-w-sm"},md:{widthClass:"w-[500px]",maxWidthClass:"max-w-md"},lg:{widthClass:"w-[700px]",maxWidthClass:"max-w-lg"},xl:{widthClass:"w-[900px]",maxWidthClass:"max-w-xl"},full:{widthClass:"w-full",maxWidthClass:"max-w-full"}};function te(i,e,t={}){const s=O(),n=t.sizePreset?dn[t.sizePreset]:void 0,r=t.widthClass||(n==null?void 0:n.widthClass)||"w-[500px]",a=t.maxWidthClass||(n==null?void 0:n.maxWidthClass)||"max-w-full",o=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),l=m("div",{class:["relative flex flex-col",s.menuBackground,"border border-purple-700 shadow-2xl rounded-2xl","px-10 py-8 animate-fade-in text-white",r,a].join(" ")},o,...Array.isArray(e)?e:[e]);return m("div",{id:i,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},l)}function P({id:i,text:e,kind:t="primary",onClick:s,additionalClasses:n=""}){const r=O(),a={primary:r.buttonPrimaryColor,secondary:r.buttonSecondaryColor,tertiary:r.buttonTertiaryColor}[t],o={primary:r.buttonPrimaryColorHover,secondary:r.buttonSecondaryColorHover,tertiary:r.buttonTertiaryColorHover}[t];return m("button",{id:i,class:["cursor-pointer flex-1 py-2 rounded-lg transition-all text-sm",a,o,r.textColor,n].join(" "),textContent:e,onclick:s})}function un(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("h2",{class:"text-xl font-semibold mb-4 text-center tracking-wide z-10",textContent:"Oops!"}),t=m("div",{id:"error-message-content",class:["bg-gray-700 text-gray-100 rounded-xl px-4 py-3 text-sm whitespace-pre-wrap","z-10 max-h-[240px] overflow-y-auto text-center"].join(" ")}),s=P({id:"error-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"});return te("error-modal",[i,e,t,s],{widthClass:"w-[420px]",maxWidthClass:"max-w-full"})}function hn(i){const e=i.querySelector("#error-close-btn"),t=i.querySelector("div.relative"),s=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=r=>{t&&(t.contains(r.target)||s())};return e==null||e.addEventListener("click",s),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",s),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class fn{constructor(){this.detachFn=null,this.modal=un(),this.messageBox=this.modal.querySelector("#error-message-content"),document.body.appendChild(this.modal);const e=hn(this.modal);this.detachFn=e.detach}show(e){this.messageBox.textContent=e,this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function pn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"text-[100px] mb-4 z-10 animate-bounce text-center",textContent:"üõ†Ô∏è"}),t=m("div",{class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Feature Not Implemented"}),s=m("div",{class:"text-sm text-gray-400 mt-2 z-10 text-center",innerHTML:"This part of Sequenzia is still under construction.<br />Check back soon!"}),n=P({id:"feature-modal-close-btn",text:"Got it",kind:"primary",additionalClasses:"mt-6 self-center z-10 px-6 py-2 text-base"});return te("feature-not-implemented-modal",[i,e,t,s,n],{widthClass:"w-[400px]",maxWidthClass:"max-w-full"})}function mn(i){const e=i.querySelector("#feature-modal-close-btn"),t=i.querySelector("div.relative"),s=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=r=>{t&&(t.contains(r.target)||s())};return e==null||e.addEventListener("click",s),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",s),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class yn{constructor(){this.detachFn=null,this.modal=pn(),document.body.appendChild(this.modal);const e=mn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function gn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"flex justify-center items-center space-x-3 mb-6 z-10"},m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=m("div",{id:"loading-modal-title",class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Loading Sounds..."}),s=m("div",{id:"loading-modal-subtext",class:"text-sm text-gray-400 mt-2 z-10 text-center",textContent:"Please wait while we dial it in."}),n=m("button",{id:"loading-modal-cancel",class:"cursor-pointer mt-6 z-10 text-sm text-purple-400 hover:text-purple-300 underline hidden",textContent:"Cancel"});return te("loading-modal",[i,e,t,s,n],{widthClass:"w-[360px]",maxWidthClass:"max-w-full"})}function _n(i,e){const t=i.querySelector("#loading-modal-cancel"),s=()=>{e()};return t==null||t.addEventListener("click",s),{detach:()=>{t==null||t.removeEventListener("click",s)},refreshUI:()=>{}}}class bn{constructor(e){this.detachFn=null,this.modal=gn(),this.titleEl=this.modal.querySelector("#loading-modal-title"),this.subtextEl=this.modal.querySelector("#loading-modal-subtext"),this.cancelBtn=this.modal.querySelector("#loading-modal-cancel"),document.body.appendChild(this.modal);const t=_n(this.modal,e);this.detachFn=t.detach}show(e){e!=null&&e.title&&(this.titleEl.textContent=e.title),e!=null&&e.subtext&&(this.subtextEl.textContent=e.subtext),this.cancelBtn.classList.toggle("hidden",!(e!=null&&e.cancelable)),this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function ie(i){const e=i.startsWith("/")?i.substring(1):i;return(window.location.pathname.startsWith("/sequenzia")?"/sequenzia/":"./")+e}function vn(){const i=m("div",{class:"mb-8"},m("img",{id:"splash-logo",src:ie("static/svg/sequenzia-logo.svg"),alt:"Sequenzia",class:"w-[300px] h-auto animate-fade-in rounded-xl"})),e=m("div",{class:"flex items-center space-x-2 mb-4"},m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=m("div",{class:"text-white text-xl font-medium"},"Loading Sequenzia ",m("span",{class:"animate-pulse"},"...")),s=m("div",{class:"relative flex flex-col items-center"},i,e,t);return m("div",{id:"splash-modal",class:"fixed inset-0 bg-black/90 flex items-center justify-center z-[9999] hidden"},s)}function Sn(i){return{detach:()=>{},refreshUI:()=>{}}}class Cn{constructor(){this.detachFn=null,this.modal=vn(),document.body.appendChild(this.modal);const e=Sn(this.modal);this.detachFn=e.detach,this.footerMain=document.getElementById("footer-main"),this.contentMain=document.getElementById("content-main"),this.splashLogo=this.modal.querySelector("#splash-logo")}show(){var e,t,s,n;this.splashLogo&&(this.splashLogo.src=ie("static/logo.png")),this.modal.classList.remove("hidden"),this.modal.style.opacity="1",(e=this.footerMain)==null||e.classList.remove("content-visible"),(t=this.footerMain)==null||t.classList.add("content-hidden"),(s=this.contentMain)==null||s.classList.remove("content-visible"),(n=this.contentMain)==null||n.classList.add("content-hidden")}hide(e=1e3){setTimeout(()=>{this.modal.style.opacity="0",this.modal.style.transition="opacity 0.5s ease-out",setTimeout(()=>{var t,s,n,r;this.modal.classList.add("hidden"),this.modal.style.opacity="1",(t=this.footerMain)==null||t.classList.remove("content-hidden"),(s=this.footerMain)==null||s.classList.add("content-visible"),(n=this.contentMain)==null||n.classList.remove("content-hidden"),(r=this.contentMain)==null||r.classList.add("content-visible")},500)},e)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Nn(){const i=m("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"API Key Required"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"In order to use AI Features, you must add an OpenAI API Key in the config."}),t=P({id:"key-not-set-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),s=m("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return m("div",{id:"openai-key-not-set-modal",class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"},s)}function wn(i){const e=i.querySelector("#key-not-set-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class Mn{constructor(){this.detachFn=null,this.modal=Nn(),document.body.appendChild(this.modal);const e=wn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function xn(){const i=m("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=m("div",{class:"text-[100px] mb-6 animate-bounce z-10",textContent:"ü§ñ"}),t=m("div",{class:"flex items-center space-x-3 mb-6 z-10"},m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),m("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),s=m("div",{class:"text-sm text-gray-400 mt-4 z-10 text-center",textContent:"AI is Generating..."}),n=m("div",{class:"relative flex flex-col items-center bg-gradient-to-br from-gray-800 to-gray-900 border border-purple-700 shadow-2xl rounded-2xl px-10 py-8 animate-fade-in w-[360px] max-w-full"},i,e,t,s);return m("div",{id:"ai-working-modal",class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},n)}function Ln(i){return{detach:()=>{},refreshUI:()=>{}}}class kn{constructor(){this.detachFn=null,this.modal=xn(),document.body.appendChild(this.modal);const e=Ln(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Gn(){const i=m("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"AI Generation Failed"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"Unable to generate AI content. Please try again."}),t=P({id:"generation-failed-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),s=m("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return m("div",{id:"ai-generation-failed-modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"},s)}function Bn(i){const e=i.querySelector("#generation-failed-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class En{constructor(){this.detachFn=null,this.modal=Gn(),document.body.appendChild(this.modal);const e=Bn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class An{constructor(e){this.onCancelLoading=e,this.initialize()}initialize(){this.errorModal=new fn,this.featureModal=new yn,this.loadingModal=new bn(this.onCancelLoading),this.splashModal=new Cn,this.openAIKeyNotSetModal=new Mn,this.aiWorkingModal=new kn,this.aiGenerationFailedModal=new En}showError(e){this.errorModal.show(e)}showFeatureBlocked(){this.featureModal.show()}showOpenAIKeyNotSet(){this.openAIKeyNotSetModal.show()}showAIWorking(){this.aiWorkingModal.show()}hideAIWorking(){this.aiWorkingModal.hide()}showAIGenerationFailed(){this.aiGenerationFailedModal.show()}showLoading(e){this.loadingModal.show(e)}hideLoading(){this.loadingModal.hide()}showSplashScreen(){this.splashModal.show()}hideSplashScreen(){this.splashModal.hide()}destroy(){var e,t,s,n,r,a,o;(e=this.errorModal)==null||e.destroy(),(t=this.featureModal)==null||t.destroy(),(s=this.loadingModal)==null||s.destroy(),(n=this.splashModal)==null||n.destroy(),(r=this.openAIKeyNotSetModal)==null||r.destroy(),(a=this.aiWorkingModal)==null||a.destroy(),(o=this.aiGenerationFailedModal)==null||o.destroy()}reload(){this.destroy(),this.initialize()}}let Ft=null;function J(){return Ft||(Ft=new An(()=>{console.warn("User cancelled loading.")})),Ft}let xs=!1;function ze(i="Loading Sounds...",e="Please wait while we dial it in.",t,s){if(en()||ks()&&!s)return;s&&(hi(),Ls(!0));const n=J();n.showLoading({title:i,subtext:e,cancelable:!!t}),t&&(n.destroy(),n.reload())}function hi(i){i&&Ls(!1),ks()||J().hideLoading()}function Ls(i){xs=i}function ks(){return xs}let Je=0;function Gs(){Je++,Je===1&&ze()}function Bs(){Je--,Je<=0&&(Je=0,hi())}async function Tn(i){Gs();try{return await i}finally{Bs()}}const Ot=new Map;async function In(i,e){e?await i.load:await Pn(i.load)}async function St(i,e=X(),t=null,s,n,r,a=!0){var C;const o=i.split("/");let l="sf2",d="musyngkite",c="acoustic_grand_piano";o.length===3?[l,d,c]=o:o.length===2?[d,c]=o:o.length===1&&(c=o[0]);const u=e instanceof OfflineAudioContext;Ot.has(e)||Ot.set(e,new Map);const h=Ot.get(e),f=String(e??X()),y=`${d}/${c}@${f}`;if(a&&h.has(y))return h.get(y);const b=Math.max(0,Math.min(127,Math.round((s??1)*127))),g=e.createStereoPanner();n!==void 0&&(g.pan.value=n);const p=e.createGain();p.connect(g),t&&t.context!==e&&(console.warn("[loadInstrument] Ignoring mismatched destination from different context"),t=null),g.connect(t||Ee(e));const v={instrument:c,volume:b,destination:p,disableScheduler:u};let S;if(d==="smolken")S=new Pr(e,v);else if(d==="splendidgrandpiano")S=new Dr(e,v);else if(d==="mallets")S=new qr(e,v);else if(d==="drummachines")S=new Kr(e,v);else{const w={"fluidr3-gm":"FluidR3_GM",fatboy:"FatBoy",musyngkite:"MusyngKite"}[d.toLowerCase()]||"MusyngKite",G=`https://gleitz.github.io/midi-js-soundfonts/${w}/${c}-ogg.js`;S=new Hr(e,{...v,instrumentUrl:G,kit:w})}if(await In(S,r??!1),d==="drummachines"){const N=((C=S.getSampleNames)==null?void 0:C.call(S))??[],w=new Map;N.forEach((L,G)=>{const E=36+G;w.set(E,L)}),S.__midiMap=w}const _=S;return _.setVolume=N=>{var L;const w=Math.max(0,Math.min(127,Math.round(N*127)));"output"in _&&typeof((L=_.output)==null?void 0:L.setVolume)=="function"&&_.output.setVolume(w)},_.setPan=N=>{g.pan.value=Math.max(-1,Math.min(1,N))},a&&h.set(y,_),_}async function Rn(){const e=Fn().map(s=>{switch(s){case"FluidR3_GM":return"fluidr3-gm";case"FatBoy":return"fatboy";case"MusyngKite":return"musyngkite";default:return s.toLowerCase()}}),t=["splendidgrandpiano","mallets","drummachines","smolken"];return[...new Set([...e,...t])]}function Fn(){const e=[...Wr()];return e.includes("FatBoy")||e.push("FatBoy"),e}async function On(i){const e=i.toLowerCase();return e==="splendidgrandpiano"?["splendidgrandpiano"]:e==="mallets"?zr():e==="drummachines"?bs():e==="smolken"?$r():(await St(`${i}/acoustic_grand_piano`,X(),null,0,0,!0),Jr()??[])}function Un(){return bs()}async function Pn(i){Gs();try{await i}finally{Bs()}}function Dn(){return{name:"sf2",loadInstrument:St,getAvailableLibraries:Rn,getAvailableInstruments:On}}let Ut=null,dt=null;function xe(){return Ut||(Ut=new AudioContext),Ut}function qn(){if(!dt){const i=xe();dt=i.createGain(),dt.connect(i.destination)}return dt}const Kn={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function W(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,s,n]=e,r=t.toUpperCase(),a=Kn[r];if(a===void 0)return null;const o=[...s].reduce((d,c)=>c==="#"?d+1:c==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}let re=null,ti=null;async function Hn(i){if(ti===i)return;re=await St(i,xe()),ti=i}function zn(){return ti}function $n(i,e=100,t=!1){var o;if(!re)return null;const n=xe().currentTime,r=W(i);if(r===null)return null;const a=((o=re.__midiMap)==null?void 0:o.get(r))??r;return re.start({note:a,stopId:a,velocity:e,time:n,loop:t}),()=>{re==null||re.stop({stopId:a})}}function Jn(i){var s;if(!re)return;const e=W(i);if(e===null)return;const t=((s=re.__midiMap)==null?void 0:s.get(e))??e;re.stop({stopId:t})}async function Wn(i,e,t,s=100,n=!1,r=null,a=null,o=null,l,d){var y;const c=a||X(),u=await St(i,c,o,l,d);l!==void 0&&u.setVolume&&u.setVolume(l),d!==void 0&&u.setPan&&u.setPan(d);const h=W(e);if(h===null)return null;const f=((y=u.__midiMap)==null?void 0:y.get(h))??h;return u.start({note:f,duration:t,velocity:s,loop:n,time:r??c.currentTime}),null}function jn(){return{name:"sf2",setActiveInstrument:Hn,getActiveInstrumentName:zn,playNote:$n,stopNoteByPitch:Jn,loadAndPlayNote:Wn}}const Xe=[{id:"0000_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Grand Piano"},{id:"0000_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Grand Piano"},{id:"0000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Grand Piano"},{id:"0000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Grand Piano"},{id:"0000_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Grand Piano"},{id:"0000_SBLive_sf2",library:"SBLive",displayName:"Acoustic Grand Piano"},{id:"0000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Grand Piano"},{id:"0010_Aspirin_sf2_file",library:"Aspirin",displayName:"Bright Acoustic Piano"},{id:"0010_Chaos_sf2_file",library:"Chaos",displayName:"Bright Acoustic Piano"},{id:"0010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bright Acoustic Piano"},{id:"0010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bright Acoustic Piano"},{id:"0010_JCLive_sf2_file",library:"JCLive",displayName:"Bright Acoustic Piano"},{id:"0010_SBLive_sf2",library:"SBLive",displayName:"Bright Acoustic Piano"},{id:"0010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bright Acoustic Piano"},{id:"0020_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Grand Piano"},{id:"0020_Chaos_sf2_file",library:"Chaos",displayName:"Electric Grand Piano"},{id:"0020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Grand Piano"},{id:"0020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Grand Piano"},{id:"0020_JCLive_sf2_file",library:"JCLive",displayName:"Electric Grand Piano"},{id:"0020_SBLive_sf2",library:"SBLive",displayName:"Electric Grand Piano"},{id:"0020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Grand Piano"},{id:"0050_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Piano 2"},{id:"0050_Chaos_sf2_file",library:"Chaos",displayName:"Electric Piano 2"},{id:"0050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Piano 2"},{id:"0050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Piano 2"},{id:"0050_JCLive_sf2_file",library:"JCLive",displayName:"Electric Piano 2"},{id:"0050_SBLive_sf2",library:"SBLive",displayName:"Electric Piano 2"},{id:"0050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Piano 2"},{id:"0060_Aspirin_sf2_file",library:"Aspirin",displayName:"Harpsichord"},{id:"0060_Chaos_sf2_file",library:"Chaos",displayName:"Harpsichord"},{id:"0060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harpsichord"},{id:"0060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harpsichord"},{id:"0060_JCLive_sf2_file",library:"JCLive",displayName:"Harpsichord"},{id:"0060_SBLive_sf2",library:"SBLive",displayName:"Harpsichord"},{id:"0060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harpsichord"},{id:"0070_Aspirin_sf2_file",library:"Aspirin",displayName:"Clavinet"},{id:"0070_Chaos_sf2_file",library:"Chaos",displayName:"Clavinet"},{id:"0070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clavinet"},{id:"0070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clavinet"},{id:"0070_JCLive_sf2_file",library:"JCLive",displayName:"Clavinet"},{id:"0070_SBLive_sf2",library:"SBLive",displayName:"Clavinet"},{id:"0070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clavinet"},{id:"0080_Aspirin_sf2_file",library:"Aspirin",displayName:"Celesta"},{id:"0080_Chaos_sf2_file",library:"Chaos",displayName:"Celesta"},{id:"0080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Celesta"},{id:"0080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Celesta"},{id:"0080_JCLive_sf2_file",library:"JCLive",displayName:"Celesta"},{id:"0080_SBLive_sf2",library:"SBLive",displayName:"Celesta"},{id:"0080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Celesta"},{id:"0090_Aspirin_sf2_file",library:"Aspirin",displayName:"Glockenspiel"},{id:"0090_Chaos_sf2_file",library:"Chaos",displayName:"Glockenspiel"},{id:"0090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Glockenspiel"},{id:"0090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Glockenspiel"},{id:"0090_JCLive_sf2_file",library:"JCLive",displayName:"Glockenspiel"},{id:"0090_SBLive_sf2",library:"SBLive",displayName:"Glockenspiel"},{id:"0090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Glockenspiel"},{id:"0100_Aspirin_sf2_file",library:"Aspirin",displayName:"Music Box"},{id:"0100_Chaos_sf2_file",library:"Chaos",displayName:"Music Box"},{id:"0100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Music Box"},{id:"0100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Music Box"},{id:"0100_JCLive_sf2_file",library:"JCLive",displayName:"Music Box"},{id:"0100_SBLive_sf2",library:"SBLive",displayName:"Music Box"},{id:"0100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Music Box"},{id:"0110_Aspirin_sf2_file",library:"Aspirin",displayName:"Vibraphone"},{id:"0110_Chaos_sf2_file",library:"Chaos",displayName:"Vibraphone"},{id:"0110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Vibraphone"},{id:"0110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Vibraphone"},{id:"0110_JCLive_sf2_file",library:"JCLive",displayName:"Vibraphone"},{id:"0110_SBLive_sf2",library:"SBLive",displayName:"Vibraphone"},{id:"0110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Vibraphone"},{id:"0120_Aspirin_sf2_file",library:"Aspirin",displayName:"Marimba"},{id:"0120_Chaos_sf2_file",library:"Chaos",displayName:"Marimba"},{id:"0120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Marimba"},{id:"0120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Marimba"},{id:"0120_JCLive_sf2_file",library:"JCLive",displayName:"Marimba"},{id:"0120_SBLive_sf2",library:"SBLive",displayName:"Marimba"},{id:"0120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Marimba"},{id:"0130_Aspirin_sf2_file",library:"Aspirin",displayName:"Xylophone"},{id:"0130_Chaos_sf2_file",library:"Chaos",displayName:"Xylophone"},{id:"0130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Xylophone"},{id:"0130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Xylophone"},{id:"0130_JCLive_sf2_file",library:"JCLive",displayName:"Xylophone"},{id:"0130_SBLive_sf2",library:"SBLive",displayName:"Xylophone"},{id:"0130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Xylophone"},{id:"0140_Aspirin_sf2_file",library:"Aspirin",displayName:"Tubular Bells"},{id:"0140_Chaos_sf2_file",library:"Chaos",displayName:"Tubular Bells"},{id:"0140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tubular Bells"},{id:"0140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tubular Bells"},{id:"0140_JCLive_sf2_file",library:"JCLive",displayName:"Tubular Bells"},{id:"0140_SBLive_sf2",library:"SBLive",displayName:"Tubular Bells"},{id:"0140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tubular Bells"},{id:"0150_Aspirin_sf2_file",library:"Aspirin",displayName:"Dulcimer"},{id:"0150_Chaos_sf2_file",library:"Chaos",displayName:"Dulcimer"},{id:"0150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Dulcimer"},{id:"0150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Dulcimer"},{id:"0150_JCLive_sf2_file",library:"JCLive",displayName:"Dulcimer"},{id:"0150_SBLive_sf2",library:"SBLive",displayName:"Dulcimer"},{id:"0150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Dulcimer"},{id:"0160_Aspirin_sf2_file",library:"Aspirin",displayName:"Drawbar Organ"},{id:"0160_Chaos_sf2_file",library:"Chaos",displayName:"Drawbar Organ"},{id:"0160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drawbar Organ"},{id:"0160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Drawbar Organ"},{id:"0160_JCLive_sf2_file",library:"JCLive",displayName:"Drawbar Organ"},{id:"0160_SBLive_sf2",library:"SBLive",displayName:"Drawbar Organ"},{id:"0160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Drawbar Organ"},{id:"0170_Aspirin_sf2_file",library:"Aspirin",displayName:"Percussive Organ"},{id:"0170_Chaos_sf2_file",library:"Chaos",displayName:"Percussive Organ"},{id:"0170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Percussive Organ"},{id:"0170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Percussive Organ"},{id:"0170_JCLive_sf2_file",library:"JCLive",displayName:"Percussive Organ"},{id:"0170_SBLive_sf2",library:"SBLive",displayName:"Percussive Organ"},{id:"0170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Percussive Organ"},{id:"0180_Aspirin_sf2_file",library:"Aspirin",displayName:"Rock Organ"},{id:"0180_Chaos_sf2_file",library:"Chaos",displayName:"Rock Organ"},{id:"0180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Rock Organ"},{id:"0180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Rock Organ"},{id:"0180_JCLive_sf2_file",library:"JCLive",displayName:"Rock Organ"},{id:"0180_SBLive_sf2",library:"SBLive",displayName:"Rock Organ"},{id:"0180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Rock Organ"},{id:"0190_Aspirin_sf2_file",library:"Aspirin",displayName:"Church Organ"},{id:"0190_Chaos_sf2_file",library:"Chaos",displayName:"Church Organ"},{id:"0190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Church Organ"},{id:"0190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Church Organ"},{id:"0190_JCLive_sf2_file",library:"JCLive",displayName:"Church Organ"},{id:"0190_SBLive_sf2",library:"SBLive",displayName:"Church Organ"},{id:"0190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Church Organ"},{id:"0200_Aspirin_sf2_file",library:"Aspirin",displayName:"Reed Organ"},{id:"0200_Chaos_sf2_file",library:"Chaos",displayName:"Reed Organ"},{id:"0200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reed Organ"},{id:"0200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reed Organ"},{id:"0200_JCLive_sf2_file",library:"JCLive",displayName:"Reed Organ"},{id:"0200_SBLive_sf2",library:"SBLive",displayName:"Reed Organ"},{id:"0200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reed Organ"},{id:"0210_Aspirin_sf2_file",library:"Aspirin",displayName:"Accordion"},{id:"0210_Chaos_sf2_file",library:"Chaos",displayName:"Accordion"},{id:"0210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Accordion"},{id:"0210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Accordion"},{id:"0210_JCLive_sf2_file",library:"JCLive",displayName:"Accordion"},{id:"0210_SBLive_sf2",library:"SBLive",displayName:"Accordion"},{id:"0210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Accordion"},{id:"0220_Aspirin_sf2_file",library:"Aspirin",displayName:"Harmonica"},{id:"0220_Chaos_sf2_file",library:"Chaos",displayName:"Harmonica"},{id:"0220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harmonica"},{id:"0220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harmonica"},{id:"0220_JCLive_sf2_file",library:"JCLive",displayName:"Harmonica"},{id:"0220_SBLive_sf2",library:"SBLive",displayName:"Harmonica"},{id:"0220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harmonica"},{id:"0230_Aspirin_sf2_file",library:"Aspirin",displayName:"Tango Accordion"},{id:"0230_Chaos_sf2_file",library:"Chaos",displayName:"Tango Accordion"},{id:"0230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tango Accordion"},{id:"0230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tango Accordion"},{id:"0230_JCLive_sf2_file",library:"JCLive",displayName:"Tango Accordion"},{id:"0230_SBLive_sf2",library:"SBLive",displayName:"Tango Accordion"},{id:"0230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tango Accordion"},{id:"0240_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (nylon)"},{id:"0240_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (nylon)"},{id:"0240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (nylon)"},{id:"0240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (nylon)"},{id:"0240_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (nylon)"},{id:"0250_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (steel)"},{id:"0250_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (steel)"},{id:"0250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (steel)"},{id:"0250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (steel)"},{id:"0250_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (steel)"},{id:"0260_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (jazz)"},{id:"0260_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (jazz)"},{id:"0260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (jazz)"},{id:"0260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (jazz)"},{id:"0260_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (jazz)"},{id:"0270_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (clean)"},{id:"0270_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (clean)"},{id:"0270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (clean)"},{id:"0270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (clean)"},{id:"0270_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (clean)"},{id:"0270_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (clean)"},{id:"0270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (clean)"},{id:"0280_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (muted)"},{id:"0280_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (muted)"},{id:"0280_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (muted)"},{id:"0280_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (muted)"},{id:"0280_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (muted)"},{id:"0280_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (muted)"},{id:"0280_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (muted)"},{id:"0290_Aspirin_sf2_file",library:"Aspirin",displayName:"Overdriven Guitar"},{id:"0290_Chaos_sf2_file",library:"Chaos",displayName:"Overdriven Guitar"},{id:"0290_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Overdriven Guitar"},{id:"0290_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Overdriven Guitar"},{id:"0290_JCLive_sf2_file",library:"JCLive",displayName:"Overdriven Guitar"},{id:"0290_SBLive_sf2",library:"SBLive",displayName:"Overdriven Guitar"},{id:"0290_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Overdriven Guitar"},{id:"0300_Aspirin_sf2_file",library:"Aspirin",displayName:"Distortion Guitar"},{id:"0300_Chaos_sf2_file",library:"Chaos",displayName:"Distortion Guitar"},{id:"0300_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Distortion Guitar"},{id:"0300_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Distortion Guitar"},{id:"0300_JCLive_sf2_file",library:"JCLive",displayName:"Distortion Guitar"},{id:"0300_SBLive_sf2",library:"SBLive",displayName:"Distortion Guitar"},{id:"0300_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Distortion Guitar"},{id:"0310_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Harmonics"},{id:"0310_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Harmonics"},{id:"0310_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Harmonics"},{id:"0310_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Harmonics"},{id:"0310_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Harmonics"},{id:"0310_SBLive_sf2",library:"SBLive",displayName:"Guitar Harmonics"},{id:"0310_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Harmonics"},{id:"0320_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Bass"},{id:"0320_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Bass"},{id:"0320_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Bass"},{id:"0320_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Bass"},{id:"0320_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Bass"},{id:"0320_SBLive_sf2",library:"SBLive",displayName:"Acoustic Bass"},{id:"0320_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Bass"},{id:"0330_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (finger)"},{id:"0330_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (finger)"},{id:"0330_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (finger)"},{id:"0330_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (finger)"},{id:"0330_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (finger)"},{id:"0330_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (finger)"},{id:"0330_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (finger)"},{id:"0340_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (pick)"},{id:"0340_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (pick)"},{id:"0340_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (pick)"},{id:"0340_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (pick)"},{id:"0340_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (pick)"},{id:"0340_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (pick)"},{id:"0340_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (pick)"},{id:"0350_Aspirin_sf2_file",library:"Aspirin",displayName:"Fretless Bass"},{id:"0350_Chaos_sf2_file",library:"Chaos",displayName:"Fretless Bass"},{id:"0350_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fretless Bass"},{id:"0350_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fretless Bass"},{id:"0350_JCLive_sf2_file",library:"JCLive",displayName:"Fretless Bass"},{id:"0350_SBLive_sf2",library:"SBLive",displayName:"Fretless Bass"},{id:"0350_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fretless Bass"},{id:"0360_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 1"},{id:"0360_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 1"},{id:"0360_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 1"},{id:"0360_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 1"},{id:"0360_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 1"},{id:"0360_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 1"},{id:"0360_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 1"},{id:"0370_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 2"},{id:"0370_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 2"},{id:"0370_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 2"},{id:"0370_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 2"},{id:"0370_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 2"},{id:"0370_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 2"},{id:"0370_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 2"},{id:"0380_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 1"},{id:"0380_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 1"},{id:"0380_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 1"},{id:"0380_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 1"},{id:"0380_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 1"},{id:"0380_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 1"},{id:"0380_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 1"},{id:"0390_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 2"},{id:"0390_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 2"},{id:"0390_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 2"},{id:"0390_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 2"},{id:"0390_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 2"},{id:"0390_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 2"},{id:"0390_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 2"},{id:"0400_Aspirin_sf2_file",library:"Aspirin",displayName:"Violin"},{id:"0400_Chaos_sf2_file",library:"Chaos",displayName:"Violin"},{id:"0400_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Violin"},{id:"0400_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Violin"},{id:"0400_JCLive_sf2_file",library:"JCLive",displayName:"Violin"},{id:"0400_SBLive_sf2",library:"SBLive",displayName:"Violin"},{id:"0400_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Violin"},{id:"0410_Aspirin_sf2_file",library:"Aspirin",displayName:"Viola"},{id:"0410_Chaos_sf2_file",library:"Chaos",displayName:"Viola"},{id:"0410_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Viola"},{id:"0410_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Viola"},{id:"0410_JCLive_sf2_file",library:"JCLive",displayName:"Viola"},{id:"0410_SBLive_sf2",library:"SBLive",displayName:"Viola"},{id:"0410_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Viola"},{id:"0420_Aspirin_sf2_file",library:"Aspirin",displayName:"Cello"},{id:"0420_Chaos_sf2_file",library:"Chaos",displayName:"Cello"},{id:"0420_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Cello"},{id:"0420_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Cello"},{id:"0420_JCLive_sf2_file",library:"JCLive",displayName:"Cello"},{id:"0420_SBLive_sf2",library:"SBLive",displayName:"Cello"},{id:"0420_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Cello"},{id:"0430_Aspirin_sf2_file",library:"Aspirin",displayName:"Contrabass"},{id:"0430_Chaos_sf2_file",library:"Chaos",displayName:"Contrabass"},{id:"0430_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Contrabass"},{id:"0430_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Contrabass"},{id:"0430_JCLive_sf2_file",library:"JCLive",displayName:"Contrabass"},{id:"0430_SBLive_sf2",library:"SBLive",displayName:"Contrabass"},{id:"0430_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Contrabass"},{id:"0440_Aspirin_sf2_file",library:"Aspirin",displayName:"Tremolo Strings"},{id:"0440_Chaos_sf2_file",library:"Chaos",displayName:"Tremolo Strings"},{id:"0440_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tremolo Strings"},{id:"0440_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tremolo Strings"},{id:"0440_JCLive_sf2_file",library:"JCLive",displayName:"Tremolo Strings"},{id:"0440_SBLive_sf2",library:"SBLive",displayName:"Tremolo Strings"},{id:"0440_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tremolo Strings"},{id:"0450_Aspirin_sf2_file",library:"Aspirin",displayName:"Pizzicato Strings"},{id:"0450_Chaos_sf2_file",library:"Chaos",displayName:"Pizzicato Strings"},{id:"0450_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pizzicato Strings"},{id:"0450_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pizzicato Strings"},{id:"0450_JCLive_sf2_file",library:"JCLive",displayName:"Pizzicato Strings"},{id:"0450_SBLive_sf2",library:"SBLive",displayName:"Pizzicato Strings"},{id:"0450_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pizzicato Strings"},{id:"0460_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestral Harp"},{id:"0460_Chaos_sf2_file",library:"Chaos",displayName:"Orchestral Harp"},{id:"0460_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestral Harp"},{id:"0460_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestral Harp"},{id:"0460_JCLive_sf2_file",library:"JCLive",displayName:"Orchestral Harp"},{id:"0460_SBLive_sf2",library:"SBLive",displayName:"Orchestral Harp"},{id:"0460_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestral Harp"},{id:"0470_Aspirin_sf2_file",library:"Aspirin",displayName:"Timpani"},{id:"0470_Chaos_sf2_file",library:"Chaos",displayName:"Timpani"},{id:"0470_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Timpani"},{id:"0470_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Timpani"},{id:"0470_JCLive_sf2_file",library:"JCLive",displayName:"Timpani"},{id:"0470_SBLive_sf2",library:"SBLive",displayName:"Timpani"},{id:"0470_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Timpani"},{id:"0480_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 1"},{id:"0480_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 1"},{id:"0480_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 1"},{id:"0480_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 1"},{id:"0480_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 1"},{id:"0480_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 1"},{id:"0480_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 1"},{id:"0490_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 2"},{id:"0490_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 2"},{id:"0490_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 2"},{id:"0490_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 2"},{id:"0490_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 2"},{id:"0490_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 2"},{id:"0490_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 2"},{id:"0500_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 1"},{id:"0500_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 1"},{id:"0500_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 1"},{id:"0500_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 1"},{id:"0500_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 1"},{id:"0500_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 1"},{id:"0500_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 1"},{id:"0510_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 2"},{id:"0510_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 2"},{id:"0510_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 2"},{id:"0510_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 2"},{id:"0510_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 2"},{id:"0510_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 2"},{id:"0510_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 2"},{id:"0520_Aspirin_sf2_file",library:"Aspirin",displayName:"Choir Aahs"},{id:"0520_Chaos_sf2_file",library:"Chaos",displayName:"Choir Aahs"},{id:"0520_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Choir Aahs"},{id:"0520_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Choir Aahs"},{id:"0520_JCLive_sf2_file",library:"JCLive",displayName:"Choir Aahs"},{id:"0520_SBLive_sf2",library:"SBLive",displayName:"Choir Aahs"},{id:"0520_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Choir Aahs"},{id:"0530_Aspirin_sf2_file",library:"Aspirin",displayName:"Voice Oohs"},{id:"0530_Chaos_sf2_file",library:"Chaos",displayName:"Voice Oohs"},{id:"0530_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Voice Oohs"},{id:"0530_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Voice Oohs"},{id:"0530_JCLive_sf2_file",library:"JCLive",displayName:"Voice Oohs"},{id:"0530_SBLive_sf2",library:"SBLive",displayName:"Voice Oohs"},{id:"0530_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Voice Oohs"},{id:"0540_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Choir"},{id:"0540_Chaos_sf2_file",library:"Chaos",displayName:"Synth Choir"},{id:"0540_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Choir"},{id:"0540_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Choir"},{id:"0540_JCLive_sf2_file",library:"JCLive",displayName:"Synth Choir"},{id:"0540_SBLive_sf2",library:"SBLive",displayName:"Synth Choir"},{id:"0540_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Choir"},{id:"0550_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestra Hit"},{id:"0550_Chaos_sf2_file",library:"Chaos",displayName:"Orchestra Hit"},{id:"0550_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestra Hit"},{id:"0550_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestra Hit"},{id:"0550_JCLive_sf2_file",library:"JCLive",displayName:"Orchestra Hit"},{id:"0550_SBLive_sf2",library:"SBLive",displayName:"Orchestra Hit"},{id:"0550_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestra Hit"},{id:"0560_Aspirin_sf2_file",library:"Aspirin",displayName:"Trumpet"},{id:"0560_Chaos_sf2_file",library:"Chaos",displayName:"Trumpet"},{id:"0560_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trumpet"},{id:"0560_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trumpet"},{id:"0560_JCLive_sf2_file",library:"JCLive",displayName:"Trumpet"},{id:"0560_SBLive_sf2",library:"SBLive",displayName:"Trumpet"},{id:"0560_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trumpet"},{id:"0570_Aspirin_sf2_file",library:"Aspirin",displayName:"Trombone"},{id:"0570_Chaos_sf2_file",library:"Chaos",displayName:"Trombone"},{id:"0570_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trombone"},{id:"0570_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trombone"},{id:"0570_JCLive_sf2_file",library:"JCLive",displayName:"Trombone"},{id:"0570_SBLive_sf2",library:"SBLive",displayName:"Trombone"},{id:"0570_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trombone"},{id:"0580_Aspirin_sf2_file",library:"Aspirin",displayName:"Tuba"},{id:"0580_Chaos_sf2_file",library:"Chaos",displayName:"Tuba"},{id:"0580_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tuba"},{id:"0580_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tuba"},{id:"0580_JCLive_sf2_file",library:"JCLive",displayName:"Tuba"},{id:"0580_SBLive_sf2",library:"SBLive",displayName:"Tuba"},{id:"0580_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tuba"},{id:"0590_Aspirin_sf2_file",library:"Aspirin",displayName:"Muted Trumpet"},{id:"0590_Chaos_sf2_file",library:"Chaos",displayName:"Muted Trumpet"},{id:"0590_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Muted Trumpet"},{id:"0590_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Muted Trumpet"},{id:"0590_JCLive_sf2_file",library:"JCLive",displayName:"Muted Trumpet"},{id:"0590_SBLive_sf2",library:"SBLive",displayName:"Muted Trumpet"},{id:"0590_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Muted Trumpet"},{id:"0600_Aspirin_sf2_file",library:"Aspirin",displayName:"French Horn"},{id:"0600_Chaos_sf2_file",library:"Chaos",displayName:"French Horn"},{id:"0600_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"French Horn"},{id:"0600_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"French Horn"},{id:"0600_JCLive_sf2_file",library:"JCLive",displayName:"French Horn"},{id:"0600_SBLive_sf2",library:"SBLive",displayName:"French Horn"},{id:"0600_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"French Horn"},{id:"0610_Aspirin_sf2_file",library:"Aspirin",displayName:"Brass Section"},{id:"0610_Chaos_sf2_file",library:"Chaos",displayName:"Brass Section"},{id:"0610_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Brass Section"},{id:"0610_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Brass Section"},{id:"0610_JCLive_sf2_file",library:"JCLive",displayName:"Brass Section"},{id:"0610_SBLive_sf2",library:"SBLive",displayName:"Brass Section"},{id:"0610_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Brass Section"},{id:"0620_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 1"},{id:"0620_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 1"},{id:"0620_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 1"},{id:"0620_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 1"},{id:"0620_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 1"},{id:"0620_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 1"},{id:"0620_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 1"},{id:"0630_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 2"},{id:"0630_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 2"},{id:"0630_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 2"},{id:"0630_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 2"},{id:"0630_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 2"},{id:"0630_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 2"},{id:"0630_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 2"},{id:"0640_Aspirin_sf2_file",library:"Aspirin",displayName:"Soprano Sax"},{id:"0640_Chaos_sf2_file",library:"Chaos",displayName:"Soprano Sax"},{id:"0640_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Soprano Sax"},{id:"0640_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Soprano Sax"},{id:"0640_JCLive_sf2_file",library:"JCLive",displayName:"Soprano Sax"},{id:"0640_SBLive_sf2",library:"SBLive",displayName:"Soprano Sax"},{id:"0640_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Soprano Sax"},{id:"0650_Aspirin_sf2_file",library:"Aspirin",displayName:"Alto Sax"},{id:"0650_Chaos_sf2_file",library:"Chaos",displayName:"Alto Sax"},{id:"0650_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Alto Sax"},{id:"0650_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Alto Sax"},{id:"0650_JCLive_sf2_file",library:"JCLive",displayName:"Alto Sax"},{id:"0650_SBLive_sf2",library:"SBLive",displayName:"Alto Sax"},{id:"0650_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Alto Sax"},{id:"0660_Aspirin_sf2_file",library:"Aspirin",displayName:"Tenor Sax"},{id:"0660_Chaos_sf2_file",library:"Chaos",displayName:"Tenor Sax"},{id:"0660_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tenor Sax"},{id:"0660_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tenor Sax"},{id:"0660_JCLive_sf2_file",library:"JCLive",displayName:"Tenor Sax"},{id:"0660_SBLive_sf2",library:"SBLive",displayName:"Tenor Sax"},{id:"0660_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tenor Sax"},{id:"0670_Aspirin_sf2_file",library:"Aspirin",displayName:"Baritone Sax"},{id:"0670_Chaos_sf2_file",library:"Chaos",displayName:"Baritone Sax"},{id:"0670_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Baritone Sax"},{id:"0670_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Baritone Sax"},{id:"0670_JCLive_sf2_file",library:"JCLive",displayName:"Baritone Sax"},{id:"0670_SBLive_sf2",library:"SBLive",displayName:"Baritone Sax"},{id:"0670_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Baritone Sax"},{id:"0680_Aspirin_sf2_file",library:"Aspirin",displayName:"Oboe"},{id:"0680_Chaos_sf2_file",library:"Chaos",displayName:"Oboe"},{id:"0680_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Oboe"},{id:"0680_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Oboe"},{id:"0680_JCLive_sf2_file",library:"JCLive",displayName:"Oboe"},{id:"0680_SBLive_sf2",library:"SBLive",displayName:"Oboe"},{id:"0680_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Oboe"},{id:"0690_Aspirin_sf2_file",library:"Aspirin",displayName:"English Horn"},{id:"0690_Chaos_sf2_file",library:"Chaos",displayName:"English Horn"},{id:"0690_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"English Horn"},{id:"0690_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"English Horn"},{id:"0690_JCLive_sf2_file",library:"JCLive",displayName:"English Horn"},{id:"0690_SBLive_sf2",library:"SBLive",displayName:"English Horn"},{id:"0690_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"English Horn"},{id:"0700_Aspirin_sf2_file",library:"Aspirin",displayName:"Bassoon"},{id:"0700_Chaos_sf2_file",library:"Chaos",displayName:"Bassoon"},{id:"0700_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bassoon"},{id:"0700_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bassoon"},{id:"0700_JCLive_sf2_file",library:"JCLive",displayName:"Bassoon"},{id:"0700_SBLive_sf2",library:"SBLive",displayName:"Bassoon"},{id:"0700_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bassoon"},{id:"0710_Aspirin_sf2_file",library:"Aspirin",displayName:"Clarinet"},{id:"0710_Chaos_sf2_file",library:"Chaos",displayName:"Clarinet"},{id:"0710_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clarinet"},{id:"0710_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clarinet"},{id:"0710_JCLive_sf2_file",library:"JCLive",displayName:"Clarinet"},{id:"0710_SBLive_sf2",library:"SBLive",displayName:"Clarinet"},{id:"0710_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clarinet"},{id:"0720_Aspirin_sf2_file",library:"Aspirin",displayName:"Piccolo"},{id:"0720_Chaos_sf2_file",library:"Chaos",displayName:"Piccolo"},{id:"0720_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Piccolo"},{id:"0720_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Piccolo"},{id:"0720_JCLive_sf2_file",library:"JCLive",displayName:"Piccolo"},{id:"0720_SBLive_sf2",library:"SBLive",displayName:"Piccolo"},{id:"0720_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Piccolo"},{id:"0730_Aspirin_sf2_file",library:"Aspirin",displayName:"Flute"},{id:"0730_Chaos_sf2_file",library:"Chaos",displayName:"Flute"},{id:"0730_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Flute"},{id:"0730_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Flute"},{id:"0730_JCLive_sf2_file",library:"JCLive",displayName:"Flute"},{id:"0730_SBLive_sf2",library:"SBLive",displayName:"Flute"},{id:"0730_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Flute"},{id:"0740_Aspirin_sf2_file",library:"Aspirin",displayName:"Recorder"},{id:"0740_Chaos_sf2_file",library:"Chaos",displayName:"Recorder"},{id:"0740_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Recorder"},{id:"0740_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Recorder"},{id:"0740_JCLive_sf2_file",library:"JCLive",displayName:"Recorder"},{id:"0740_SBLive_sf2",library:"SBLive",displayName:"Recorder"},{id:"0740_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Recorder"},{id:"0750_Aspirin_sf2_file",library:"Aspirin",displayName:"Pan Flute"},{id:"0750_Chaos_sf2_file",library:"Chaos",displayName:"Pan Flute"},{id:"0750_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pan Flute"},{id:"0750_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pan Flute"},{id:"0750_JCLive_sf2_file",library:"JCLive",displayName:"Pan Flute"},{id:"0750_SBLive_sf2",library:"SBLive",displayName:"Pan Flute"},{id:"0750_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pan Flute"},{id:"0760_Aspirin_sf2_file",library:"Aspirin",displayName:"Blown Bottle"},{id:"0760_Chaos_sf2_file",library:"Chaos",displayName:"Blown Bottle"},{id:"0760_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Blown Bottle"},{id:"0760_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Blown Bottle"},{id:"0760_JCLive_sf2_file",library:"JCLive",displayName:"Blown Bottle"},{id:"0760_SBLive_sf2",library:"SBLive",displayName:"Blown Bottle"},{id:"0760_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Blown Bottle"},{id:"0770_Aspirin_sf2_file",library:"Aspirin",displayName:"Shakuhachi"},{id:"0770_Chaos_sf2_file",library:"Chaos",displayName:"Shakuhachi"},{id:"0770_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shakuhachi"},{id:"0770_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shakuhachi"},{id:"0770_JCLive_sf2_file",library:"JCLive",displayName:"Shakuhachi"},{id:"0770_SBLive_sf2",library:"SBLive",displayName:"Shakuhachi"},{id:"0770_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shakuhachi"},{id:"0780_Aspirin_sf2_file",library:"Aspirin",displayName:"Whistle"},{id:"0780_Chaos_sf2_file",library:"Chaos",displayName:"Whistle"},{id:"0780_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Whistle"},{id:"0780_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Whistle"},{id:"0780_JCLive_sf2_file",library:"JCLive",displayName:"Whistle"},{id:"0780_SBLive_sf2",library:"SBLive",displayName:"Whistle"},{id:"0780_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Whistle"},{id:"0790_Aspirin_sf2_file",library:"Aspirin",displayName:"Ocarina"},{id:"0790_Chaos_sf2_file",library:"Chaos",displayName:"Ocarina"},{id:"0790_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Ocarina"},{id:"0790_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Ocarina"},{id:"0790_JCLive_sf2_file",library:"JCLive",displayName:"Ocarina"},{id:"0790_SBLive_sf2",library:"SBLive",displayName:"Ocarina"},{id:"0790_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Ocarina"},{id:"0800_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 1 (square)"},{id:"0800_Chaos_sf2_file",library:"Chaos",displayName:"Lead 1 (square)"},{id:"0800_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 1 (square)"},{id:"0800_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 1 (square)"},{id:"0800_JCLive_sf2_file",library:"JCLive",displayName:"Lead 1 (square)"},{id:"0800_SBLive_sf2",library:"SBLive",displayName:"Lead 1 (square)"},{id:"0800_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 1 (square)"},{id:"0810_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 2 (sawtooth)"},{id:"0810_Chaos_sf2_file",library:"Chaos",displayName:"Lead 2 (sawtooth)"},{id:"0810_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 2 (sawtooth)"},{id:"0810_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 2 (sawtooth)"},{id:"0810_JCLive_sf2_file",library:"JCLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SBLive_sf2",library:"SBLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 2 (sawtooth)"},{id:"0820_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 3 (calliope)"},{id:"0820_Chaos_sf2_file",library:"Chaos",displayName:"Lead 3 (calliope)"},{id:"0820_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 3 (calliope)"},{id:"0820_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 3 (calliope)"},{id:"0820_JCLive_sf2_file",library:"JCLive",displayName:"Lead 3 (calliope)"},{id:"0820_SBLive_sf2",library:"SBLive",displayName:"Lead 3 (calliope)"},{id:"0820_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 3 (calliope)"},{id:"0830_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 4 (chiff)"},{id:"0830_Chaos_sf2_file",library:"Chaos",displayName:"Lead 4 (chiff)"},{id:"0830_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 4 (chiff)"},{id:"0830_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 4 (chiff)"},{id:"0830_JCLive_sf2_file",library:"JCLive",displayName:"Lead 4 (chiff)"},{id:"0830_SBLive_sf2",library:"SBLive",displayName:"Lead 4 (chiff)"},{id:"0830_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 4 (chiff)"},{id:"0840_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 5 (charang)"},{id:"0840_Chaos_sf2_file",library:"Chaos",displayName:"Lead 5 (charang)"},{id:"0840_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 5 (charang)"},{id:"0840_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 5 (charang)"},{id:"0840_JCLive_sf2_file",library:"JCLive",displayName:"Lead 5 (charang)"},{id:"0840_SBLive_sf2",library:"SBLive",displayName:"Lead 5 (charang)"},{id:"0840_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 5 (charang)"},{id:"0850_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 6 (voice)"},{id:"0850_Chaos_sf2_file",library:"Chaos",displayName:"Lead 6 (voice)"},{id:"0850_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 6 (voice)"},{id:"0850_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 6 (voice)"},{id:"0850_JCLive_sf2_file",library:"JCLive",displayName:"Lead 6 (voice)"},{id:"0850_SBLive_sf2",library:"SBLive",displayName:"Lead 6 (voice)"},{id:"0850_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 6 (voice)"},{id:"0860_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 7 (fifths)"},{id:"0860_Chaos_sf2_file",library:"Chaos",displayName:"Lead 7 (fifths)"},{id:"0860_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 7 (fifths)"},{id:"0860_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 7 (fifths)"},{id:"0860_JCLive_sf2_file",library:"JCLive",displayName:"Lead 7 (fifths)"},{id:"0860_SBLive_sf2",library:"SBLive",displayName:"Lead 7 (fifths)"},{id:"0860_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 7 (fifths)"},{id:"0870_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 8 (bass + lead)"},{id:"0870_Chaos_sf2_file",library:"Chaos",displayName:"Lead 8 (bass + lead)"},{id:"0870_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 8 (bass + lead)"},{id:"0870_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 8 (bass + lead)"},{id:"0870_JCLive_sf2_file",library:"JCLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SBLive_sf2",library:"SBLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 8 (bass + lead)"},{id:"0880_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 1 (new age)"},{id:"0880_Chaos_sf2_file",library:"Chaos",displayName:"Pad 1 (new age)"},{id:"0880_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 1 (new age)"},{id:"0880_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 1 (new age)"},{id:"0880_JCLive_sf2_file",library:"JCLive",displayName:"Pad 1 (new age)"},{id:"0880_SBLive_sf2",library:"SBLive",displayName:"Pad 1 (new age)"},{id:"0880_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 1 (new age)"},{id:"0890_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 2 (warm)"},{id:"0890_Chaos_sf2_file",library:"Chaos",displayName:"Pad 2 (warm)"},{id:"0890_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 2 (warm)"},{id:"0890_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 2 (warm)"},{id:"0890_JCLive_sf2_file",library:"JCLive",displayName:"Pad 2 (warm)"},{id:"0890_SBLive_sf2",library:"SBLive",displayName:"Pad 2 (warm)"},{id:"0890_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 2 (warm)"},{id:"0900_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 3 (polysynth)"},{id:"0900_Chaos_sf2_file",library:"Chaos",displayName:"Pad 3 (polysynth)"},{id:"0900_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 3 (polysynth)"},{id:"0900_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 3 (polysynth)"},{id:"0900_JCLive_sf2_file",library:"JCLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SBLive_sf2",library:"SBLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 3 (polysynth)"},{id:"0910_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 4 (choir)"},{id:"0910_Chaos_sf2_file",library:"Chaos",displayName:"Pad 4 (choir)"},{id:"0910_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 4 (choir)"},{id:"0910_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 4 (choir)"},{id:"0910_JCLive_sf2_file",library:"JCLive",displayName:"Pad 4 (choir)"},{id:"0910_SBLive_sf2",library:"SBLive",displayName:"Pad 4 (choir)"},{id:"0910_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 4 (choir)"},{id:"0920_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 5 (bowed)"},{id:"0920_Chaos_sf2_file",library:"Chaos",displayName:"Pad 5 (bowed)"},{id:"0920_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 5 (bowed)"},{id:"0920_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 5 (bowed)"},{id:"0920_JCLive_sf2_file",library:"JCLive",displayName:"Pad 5 (bowed)"},{id:"0920_SBLive_sf2",library:"SBLive",displayName:"Pad 5 (bowed)"},{id:"0920_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 5 (bowed)"},{id:"0930_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 6 (metallic)"},{id:"0930_Chaos_sf2_file",library:"Chaos",displayName:"Pad 6 (metallic)"},{id:"0930_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 6 (metallic)"},{id:"0930_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 6 (metallic)"},{id:"0930_JCLive_sf2_file",library:"JCLive",displayName:"Pad 6 (metallic)"},{id:"0930_SBLive_sf2",library:"SBLive",displayName:"Pad 6 (metallic)"},{id:"0930_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 6 (metallic)"},{id:"0940_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 7 (halo)"},{id:"0940_Chaos_sf2_file",library:"Chaos",displayName:"Pad 7 (halo)"},{id:"0940_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 7 (halo)"},{id:"0940_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 7 (halo)"},{id:"0940_JCLive_sf2_file",library:"JCLive",displayName:"Pad 7 (halo)"},{id:"0940_SBLive_sf2",library:"SBLive",displayName:"Pad 7 (halo)"},{id:"0940_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 7 (halo)"},{id:"0950_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 8 (sweep)"},{id:"0950_Chaos_sf2_file",library:"Chaos",displayName:"Pad 8 (sweep)"},{id:"0950_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 8 (sweep)"},{id:"0950_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 8 (sweep)"},{id:"0950_JCLive_sf2_file",library:"JCLive",displayName:"Pad 8 (sweep)"},{id:"0950_SBLive_sf2",library:"SBLive",displayName:"Pad 8 (sweep)"},{id:"0950_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 8 (sweep)"},{id:"0960_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 1 (rain)"},{id:"0960_Chaos_sf2_file",library:"Chaos",displayName:"FX 1 (rain)"},{id:"0960_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 1 (rain)"},{id:"0960_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 1 (rain)"},{id:"0960_JCLive_sf2_file",library:"JCLive",displayName:"FX 1 (rain)"},{id:"0960_SBLive_sf2",library:"SBLive",displayName:"FX 1 (rain)"},{id:"0960_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 1 (rain)"},{id:"0970_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 2 (soundtrack)"},{id:"0970_Chaos_sf2_file",library:"Chaos",displayName:"FX 2 (soundtrack)"},{id:"0970_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 2 (soundtrack)"},{id:"0970_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 2 (soundtrack)"},{id:"0970_JCLive_sf2_file",library:"JCLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SBLive_sf2",library:"SBLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 2 (soundtrack)"},{id:"0980_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 3 (crystal)"},{id:"0980_Chaos_sf2_file",library:"Chaos",displayName:"FX 3 (crystal)"},{id:"0980_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 3 (crystal)"},{id:"0980_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 3 (crystal)"},{id:"0980_JCLive_sf2_file",library:"JCLive",displayName:"FX 3 (crystal)"},{id:"0980_SBLive_sf2",library:"SBLive",displayName:"FX 3 (crystal)"},{id:"0980_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 3 (crystal)"},{id:"0990_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 4 (atmosphere)"},{id:"0990_Chaos_sf2_file",library:"Chaos",displayName:"FX 4 (atmosphere)"},{id:"0990_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 4 (atmosphere)"},{id:"0990_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 4 (atmosphere)"},{id:"0990_JCLive_sf2_file",library:"JCLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SBLive_sf2",library:"SBLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 4 (atmosphere)"},{id:"1000_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 5 (brightness)"},{id:"1000_Chaos_sf2_file",library:"Chaos",displayName:"FX 5 (brightness)"},{id:"1000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 5 (brightness)"},{id:"1000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 5 (brightness)"},{id:"1000_JCLive_sf2_file",library:"JCLive",displayName:"FX 5 (brightness)"},{id:"1000_SBLive_sf2",library:"SBLive",displayName:"FX 5 (brightness)"},{id:"1000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 5 (brightness)"},{id:"1010_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 6 (goblins)"},{id:"1010_Chaos_sf2_file",library:"Chaos",displayName:"FX 6 (goblins)"},{id:"1010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 6 (goblins)"},{id:"1010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 6 (goblins)"},{id:"1010_JCLive_sf2_file",library:"JCLive",displayName:"FX 6 (goblins)"},{id:"1010_SBLive_sf2",library:"SBLive",displayName:"FX 6 (goblins)"},{id:"1010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 6 (goblins)"},{id:"1020_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 7 (echoes)"},{id:"1020_Chaos_sf2_file",library:"Chaos",displayName:"FX 7 (echoes)"},{id:"1020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 7 (echoes)"},{id:"1020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 7 (echoes)"},{id:"1020_JCLive_sf2_file",library:"JCLive",displayName:"FX 7 (echoes)"},{id:"1020_SBLive_sf2",library:"SBLive",displayName:"FX 7 (echoes)"},{id:"1020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 7 (echoes)"},{id:"1030_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 8 (sci-fi)"},{id:"1030_Chaos_sf2_file",library:"Chaos",displayName:"FX 8 (sci-fi)"},{id:"1030_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 8 (sci-fi)"},{id:"1030_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 8 (sci-fi)"},{id:"1030_JCLive_sf2_file",library:"JCLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SBLive_sf2",library:"SBLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 8 (sci-fi)"},{id:"1040_Aspirin_sf2_file",library:"Aspirin",displayName:"Sitar"},{id:"1040_Chaos_sf2_file",library:"Chaos",displayName:"Sitar"},{id:"1040_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Sitar"},{id:"1040_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Sitar"},{id:"1040_JCLive_sf2_file",library:"JCLive",displayName:"Sitar"},{id:"1040_SBLive_sf2",library:"SBLive",displayName:"Sitar"},{id:"1040_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Sitar"},{id:"1050_Aspirin_sf2_file",library:"Aspirin",displayName:"Banjo"},{id:"1050_Chaos_sf2_file",library:"Chaos",displayName:"Banjo"},{id:"1050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Banjo"},{id:"1050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Banjo"},{id:"1050_JCLive_sf2_file",library:"JCLive",displayName:"Banjo"},{id:"1050_SBLive_sf2",library:"SBLive",displayName:"Banjo"},{id:"1050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Banjo"},{id:"1060_Aspirin_sf2_file",library:"Aspirin",displayName:"Shamisen"},{id:"1060_Chaos_sf2_file",library:"Chaos",displayName:"Shamisen"},{id:"1060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shamisen"},{id:"1060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shamisen"},{id:"1060_JCLive_sf2_file",library:"JCLive",displayName:"Shamisen"},{id:"1060_SBLive_sf2",library:"SBLive",displayName:"Shamisen"},{id:"1060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shamisen"},{id:"1070_Aspirin_sf2_file",library:"Aspirin",displayName:"Koto"},{id:"1070_Chaos_sf2_file",library:"Chaos",displayName:"Koto"},{id:"1070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Koto"},{id:"1070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Koto"},{id:"1070_JCLive_sf2_file",library:"JCLive",displayName:"Koto"},{id:"1070_SBLive_sf2",library:"SBLive",displayName:"Koto"},{id:"1070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Koto"},{id:"1080_Aspirin_sf2_file",library:"Aspirin",displayName:"Kalimba"},{id:"1080_Chaos_sf2_file",library:"Chaos",displayName:"Kalimba"},{id:"1080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Kalimba"},{id:"1080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Kalimba"},{id:"1080_JCLive_sf2_file",library:"JCLive",displayName:"Kalimba"},{id:"1080_SBLive_sf2",library:"SBLive",displayName:"Kalimba"},{id:"1080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Kalimba"},{id:"1090_Aspirin_sf2_file",library:"Aspirin",displayName:"Bagpipe"},{id:"1090_Chaos_sf2_file",library:"Chaos",displayName:"Bagpipe"},{id:"1090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bagpipe"},{id:"1090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bagpipe"},{id:"1090_JCLive_sf2_file",library:"JCLive",displayName:"Bagpipe"},{id:"1090_SBLive_sf2",library:"SBLive",displayName:"Bagpipe"},{id:"1090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bagpipe"},{id:"1100_Aspirin_sf2_file",library:"Aspirin",displayName:"Fiddle"},{id:"1100_Chaos_sf2_file",library:"Chaos",displayName:"Fiddle"},{id:"1100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fiddle"},{id:"1100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fiddle"},{id:"1100_JCLive_sf2_file",library:"JCLive",displayName:"Fiddle"},{id:"1100_SBLive_sf2",library:"SBLive",displayName:"Fiddle"},{id:"1100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fiddle"},{id:"1110_Aspirin_sf2_file",library:"Aspirin",displayName:"Shanai"},{id:"1110_Chaos_sf2_file",library:"Chaos",displayName:"Shanai"},{id:"1110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shanai"},{id:"1110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shanai"},{id:"1110_JCLive_sf2_file",library:"JCLive",displayName:"Shanai"},{id:"1110_SBLive_sf2",library:"SBLive",displayName:"Shanai"},{id:"1110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shanai"},{id:"1120_Aspirin_sf2_file",library:"Aspirin",displayName:"Tinkle Bell"},{id:"1120_Chaos_sf2_file",library:"Chaos",displayName:"Tinkle Bell"},{id:"1120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tinkle Bell"},{id:"1120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tinkle Bell"},{id:"1120_JCLive_sf2_file",library:"JCLive",displayName:"Tinkle Bell"},{id:"1120_SBLive_sf2",library:"SBLive",displayName:"Tinkle Bell"},{id:"1120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tinkle Bell"},{id:"1130_Aspirin_sf2_file",library:"Aspirin",displayName:"Agogo"},{id:"1130_Chaos_sf2_file",library:"Chaos",displayName:"Agogo"},{id:"1130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Agogo"},{id:"1130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Agogo"},{id:"1130_JCLive_sf2_file",library:"JCLive",displayName:"Agogo"},{id:"1130_SBLive_sf2",library:"SBLive",displayName:"Agogo"},{id:"1130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Agogo"},{id:"1140_Aspirin_sf2_file",library:"Aspirin",displayName:"Steel Drums"},{id:"1140_Chaos_sf2_file",library:"Chaos",displayName:"Steel Drums"},{id:"1140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Steel Drums"},{id:"1140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Steel Drums"},{id:"1140_JCLive_sf2_file",library:"JCLive",displayName:"Steel Drums"},{id:"1140_SBLive_sf2",library:"SBLive",displayName:"Steel Drums"},{id:"1140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Steel Drums"},{id:"1150_Aspirin_sf2_file",library:"Aspirin",displayName:"Woodblock"},{id:"1150_Chaos_sf2_file",library:"Chaos",displayName:"Woodblock"},{id:"1150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Woodblock"},{id:"1150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Woodblock"},{id:"1150_JCLive_sf2_file",library:"JCLive",displayName:"Woodblock"},{id:"1150_SBLive_sf2",library:"SBLive",displayName:"Woodblock"},{id:"1150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Woodblock"},{id:"1160_Aspirin_sf2_file",library:"Aspirin",displayName:"Taiko Drum"},{id:"1160_Chaos_sf2_file",library:"Chaos",displayName:"Taiko Drum"},{id:"1160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Taiko Drum"},{id:"1160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Taiko Drum"},{id:"1160_JCLive_sf2_file",library:"JCLive",displayName:"Taiko Drum"},{id:"1160_SBLive_sf2",library:"SBLive",displayName:"Taiko Drum"},{id:"1160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Taiko Drum"},{id:"1170_Aspirin_sf2_file",library:"Aspirin",displayName:"Melodic Tom"},{id:"1170_Chaos_sf2_file",library:"Chaos",displayName:"Melodic Tom"},{id:"1170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Melodic Tom"},{id:"1170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Melodic Tom"},{id:"1170_JCLive_sf2_file",library:"JCLive",displayName:"Melodic Tom"},{id:"1170_SBLive_sf2",library:"SBLive",displayName:"Melodic Tom"},{id:"1170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Melodic Tom"},{id:"1180_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Drum"},{id:"1180_Chaos_sf2_file",library:"Chaos",displayName:"Synth Drum"},{id:"1180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Drum"},{id:"1180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Drum"},{id:"1180_JCLive_sf2_file",library:"JCLive",displayName:"Synth Drum"},{id:"1180_SBLive_sf2",library:"SBLive",displayName:"Synth Drum"},{id:"1180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Drum"},{id:"1190_Aspirin_sf2_file",library:"Aspirin",displayName:"Reverse Cymbal"},{id:"1190_Chaos_sf2_file",library:"Chaos",displayName:"Reverse Cymbal"},{id:"1190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reverse Cymbal"},{id:"1190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reverse Cymbal"},{id:"1190_JCLive_sf2_file",library:"JCLive",displayName:"Reverse Cymbal"},{id:"1190_SBLive_sf2",library:"SBLive",displayName:"Reverse Cymbal"},{id:"1190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reverse Cymbal"},{id:"1200_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Fret Noise"},{id:"1200_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Fret Noise"},{id:"1200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Fret Noise"},{id:"1200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Fret Noise"},{id:"1200_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Fret Noise"},{id:"1200_SBLive_sf2",library:"SBLive",displayName:"Guitar Fret Noise"},{id:"1200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Fret Noise"},{id:"1210_Aspirin_sf2_file",library:"Aspirin",displayName:"Breath Noise"},{id:"1210_Chaos_sf2_file",library:"Chaos",displayName:"Breath Noise"},{id:"1210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Breath Noise"},{id:"1210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Breath Noise"},{id:"1210_JCLive_sf2_file",library:"JCLive",displayName:"Breath Noise"},{id:"1210_SBLive_sf2",library:"SBLive",displayName:"Breath Noise"},{id:"1210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Breath Noise"},{id:"1220_Aspirin_sf2_file",library:"Aspirin",displayName:"Seashore"},{id:"1220_Chaos_sf2_file",library:"Chaos",displayName:"Seashore"},{id:"1220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Seashore"},{id:"1220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Seashore"},{id:"1220_JCLive_sf2_file",library:"JCLive",displayName:"Seashore"},{id:"1220_SBLive_sf2",library:"SBLive",displayName:"Seashore"},{id:"1220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Seashore"},{id:"1230_Aspirin_sf2_file",library:"Aspirin",displayName:"Bird Tweet"},{id:"1230_Chaos_sf2_file",library:"Chaos",displayName:"Bird Tweet"},{id:"1230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bird Tweet"},{id:"1230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bird Tweet"},{id:"1230_JCLive_sf2_file",library:"JCLive",displayName:"Bird Tweet"},{id:"1230_SBLive_sf2",library:"SBLive",displayName:"Bird Tweet"},{id:"1230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bird Tweet"},{id:"1240_Aspirin_sf2_file",library:"Aspirin",displayName:"Telephone Ring"},{id:"1240_Chaos_sf2_file",library:"Chaos",displayName:"Telephone Ring"},{id:"1240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Telephone Ring"},{id:"1240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Telephone Ring"},{id:"1240_JCLive_sf2_file",library:"JCLive",displayName:"Telephone Ring"},{id:"1240_SBLive_sf2",library:"SBLive",displayName:"Telephone Ring"},{id:"1240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Telephone Ring"},{id:"1250_Aspirin_sf2_file",library:"Aspirin",displayName:"Helicopter"},{id:"1250_Chaos_sf2_file",library:"Chaos",displayName:"Helicopter"},{id:"1250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Helicopter"},{id:"1250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Helicopter"},{id:"1250_JCLive_sf2_file",library:"JCLive",displayName:"Helicopter"},{id:"1250_SBLive_sf2",library:"SBLive",displayName:"Helicopter"},{id:"1250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Helicopter"},{id:"1260_Aspirin_sf2_file",library:"Aspirin",displayName:"Applause"},{id:"1260_Chaos_sf2_file",library:"Chaos",displayName:"Applause"},{id:"1260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Applause"},{id:"1260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Applause"},{id:"1260_JCLive_sf2_file",library:"JCLive",displayName:"Applause"},{id:"1260_SBLive_sf2",library:"SBLive",displayName:"Applause"},{id:"1260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Applause"},{id:"1270_Aspirin_sf2_file",library:"Aspirin",displayName:"Gunshot"},{id:"1270_Chaos_sf2_file",library:"Chaos",displayName:"Gunshot"},{id:"1270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Gunshot"},{id:"1270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Gunshot"},{id:"1270_JCLive_sf2_file",library:"JCLive",displayName:"Gunshot"},{id:"1270_SBLive_sf2",library:"SBLive",displayName:"Gunshot"},{id:"1270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Gunshot"},{id:"12835_1_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 1"},{id:"12835_1_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 1"},{id:"12835_1_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 1"},{id:"12835_1_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 1"},{id:"12835_2_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 2"},{id:"12835_2_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 2"},{id:"12835_2_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 2"},{id:"12835_2_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 2"},{id:"12835_3_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 3"},{id:"12835_3_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 3"},{id:"12835_3_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 3"},{id:"12835_3_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 3"},{id:"12835_4_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 4"},{id:"12835_4_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 4"},{id:"12835_4_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 4"},{id:"12835_4_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 4"},{id:"12835_5_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 5"},{id:"12835_5_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 5"},{id:"12835_5_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 5"},{id:"12835_5_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 5"},{id:"12835_6_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 6"},{id:"12835_6_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 6"},{id:"12835_6_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 6"},{id:"12835_6_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 6"},{id:"12835_7_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 7"},{id:"12835_7_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 7"},{id:"12835_7_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 7"},{id:"12835_7_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 7"},{id:"12835_8_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 8"},{id:"12835_8_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 8"},{id:"12835_8_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 8"},{id:"12835_8_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 8"},{id:"12835_9_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 9"},{id:"12835_9_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 9"},{id:"12835_9_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 9"},{id:"12835_10_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 10"},{id:"12835_10_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 10"},{id:"12835_10_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 10"},{id:"12835_11_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 11"},{id:"12835_11_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 11"},{id:"12835_11_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 11"},{id:"12835_12_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 12"},{id:"12835_12_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 12"},{id:"12835_13_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 13"},{id:"12835_13_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 13"},{id:"12835_14_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 14"},{id:"12835_14_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 14"},{id:"12835_15_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 15"},{id:"12835_15_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 15"},{id:"12835_16_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 16"},{id:"12835_16_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 16"},{id:"12835_17_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 17"},{id:"12835_17_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 17"},{id:"12835_18_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 18"},{id:"12835_18_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 18"}];function Xn(i){const e=1+i%18,t=Xe.find(n=>n.id.startsWith(`12835_${e}_`)&&n.library==="FluidR3_GM");if(t)return{library:t.library,displayName:t.displayName};const s=Xe.find(n=>n.id.startsWith(`12835_${e}_`));return s?{library:s.library,displayName:s.displayName}:null}const Vn=Array.from({length:47},(i,e)=>35+e),Yn={35:"kick2",36:"kick1",37:"rim",38:"snare1",39:"clap",40:"snare2",41:"lowtom2",42:"hh_closed",43:"lowtom1",44:"hh_pedal",45:"midtom2",46:"hh_open",47:"midtom1",48:"hitom2",49:"crash1",50:"hitom1",51:"ride1",52:"china",53:"ride_bell",54:"tamb",55:"splash",56:"cowbell",57:"crash2",58:"vibraslap",59:"ride2",60:"bongo_hi",61:"bongo_lo",62:"conga_hi_mute",63:"conga_hi_open",64:"conga_lo",65:"timbale_hi",66:"timbale_lo",67:"agogo_hi",68:"agogo_lo",69:"cabasa",70:"maracas",71:"whistle_short",72:"whistle_long",73:"guiro_short",74:"guiro_long",75:"claves",76:"woodblock_hi",77:"woodblock_lo",78:"cuica_mute",79:"cuica_open",80:"triangle_mute",81:"triangle_open"},Ii=Tn,Pt=new Map;let se=null;function Ri(i){return Math.max(i,1e-4)}async function gt(i){return new Promise((e,t)=>{const s=document.createElement("script");s.src=i,s.onload=()=>e(),s.onerror=()=>t(new Error(`Failed to load script: ${i}`)),document.body.appendChild(s)})}async function Zn(){se||(await gt("https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"),se=new window.WebAudioFontPlayer)}async function fi(i,e=X(),t=null,s,n,r,a=!0){const[o,l]=i.split("/"),d=String(e),c=`${o}/${l}@${d}`;Pt.has(e)||Pt.set(e,new Map);const u=Pt.get(e);if(a&&u.has(c))return u.get(c);if(await Zn(),se.resumeContext){const w=se.resumeContext;se.resumeContext=L=>{if(!(L instanceof OfflineAudioContext))return w.call(se,L)}}const h=Xe.find(w=>w.library===o&&w.displayName===l);if(!h)throw new Error(`Could not find WebAudioFont entry for library=${o} and instrument=${l}`);t&&t.context!==e&&(console.warn("[WebAudioFont] Ignoring mismatched destination from another context"),t=null);const f=t||Ee(e),y=e.createStereoPanner();if(y.pan.value=n??0,y.connect(f),!h.displayName.startsWith("Drum Kit")){const w=`_tone_${h.id}`,L=`https://surikov.github.io/webaudiofontdata/sound/${h.id}.js`;r?await gt(L):await Ii(gt(L));const G=window[w];if(!G)throw new Error(`Missing preset: ${w}`);if(se.loader.decodeAfterLoading(e,w),e instanceof OfflineAudioContext){const M=(G==null?void 0:G.zones)??[];for(const x of M)if(x.file&&!x.buffer){const B=atob(x.file),I=new ArrayBuffer(B.length),R=new Uint8Array(I);for(let q=0;q<B.length;q++)R[q]=B.charCodeAt(q);x.buffer=await new Promise((q,Q)=>e.decodeAudioData(I,q,Q))}}const E={_preset:G,_volume:s??1,_activeEnvelopes:[],start({note:M,duration:x=1,velocity:B=100,time:I}){const R=typeof M=="string"?W(M):M;if(R==null||typeof R!="number")return;const q=typeof I=="number"?I:0,Q=Math.max(.01,Math.min(1,B/127)),be=Ri(E._volume),It=Math.max(.01,Math.min(1,be*Q)),ct=se.queueWaveTable(e,y||Ee(),G,q,R,x,It);E._activeEnvelopes.push(ct)},stop(){var M;for(const x of E._activeEnvelopes)try{x.cancel?x.cancel():(M=x.audioBufferSourceNode)!=null&&M.stop&&x.audioBufferSourceNode.stop()}catch(B){console.warn("Failed to stop envelope:",B)}E._activeEnvelopes=[]},setVolume(M){E._volume=Math.max(0,Math.min(1,M))},setPan(M){y.pan.value=Math.max(-1,Math.min(1,M))},load:Promise.resolve()};return a&&u.set(c,E),E}const g=h.id.match(/^12835_(\d+)_([A-Za-z0-9_]+)_sf2_file$/);if(!g)throw new Error(`Invalid drum ID format in catalogue: ${h.id}`);const[,p,v]=g,S=parseInt(p,10),_={},C=async()=>{for(const w of Vn){const L=`_drum_${w}_${S}_${v}_sf2_file`,G=`https://surikov.github.io/webaudiofontdata/sound/${12800+w}_${S}_${v}_sf2_file.js`;try{await gt(G);const E=window[L];if(!E){console.warn(`Missing drum preset: ${L}`);continue}se.loader.decodeAfterLoading(e,L),_[w]=E}catch(E){console.warn(`Failed to load drum preset ${w}: ${E}`)}}};r??!1?await C():await Ii(C());const N={_preset:_,_volume:s??1,_activeEnvelopes:[],start({note:w,duration:L=1,velocity:G=100,time:E}){const M=typeof w=="string"?W(w):w;if(M==null||typeof M!="number"){console.warn(`Invalid MIDI pitch: ${w}`);return}const x=_[M];if(!x){console.warn(`No drum preset loaded for MIDI ${M}`);return}const B=typeof E=="number"?E:0,I=Ri(N._volume),R=se.queueWaveTable(e,y||Ee(),x,B,M,L,I);N._activeEnvelopes.push(R)},stop(){var w;for(const L of N._activeEnvelopes)try{L.cancel?L.cancel():(w=L.audioBufferSourceNode)!=null&&w.stop&&L.audioBufferSourceNode.stop()}catch(G){console.warn("Failed to stop envelope:",G)}N._activeEnvelopes=[]},load:Promise.resolve(),setVolume(w){N._volume=Math.max(0,Math.min(1,w))},setPan(w){y.pan.value=Math.max(-1,Math.min(1,w))}};return a&&u.set(c,N),N}async function Qn(){const i=new Set;for(const e of Xe)i.add(e.library);return Array.from(i)}async function ea(i){return Xe.filter(e=>e.library===i).map(e=>e.displayName)}function ta(){return{name:"webaudiofont",loadInstrument:fi,getAvailableLibraries:Qn,getAvailableInstruments:ea}}let ii=null,si=null;async function ia(i){if(si===i)return;const[,e,t]=i.split("/");ii=await fi(`${e}/${t}`,xe()),si=i}function sa(){return si}function ra(i,e=100,t=!1){if(!ii)return null;const n=xe().currentTime,r=W(i);return r===null?null:(ii.start({note:r,velocity:e,time:n,duration:1.5,loop:t}),()=>{})}function na(i){}async function aa(i,e,t,s=100,n=!1,r=null,a=null,o=null,l,d){const c=a||X(),[,u,h]=i.split("/"),f=await fi(`${u}/${h}`,c,o,l,d);l!==void 0&&f.setVolume&&f.setVolume(l),d!==void 0&&f.setPan&&f.setPan(d);const y=W(e);return y===null||f.start({note:y,duration:t,velocity:s,loop:n,time:r??c.currentTime}),null}function oa(){return{name:"webaudiofont",setActiveInstrument:ia,getActiveInstrumentName:sa,playNote:ra,stopNoteByPitch:na,loadAndPlayNote:aa}}function Es(i=3){const r=["C","D","E","F","G","A","B"],a=["C#","D#","","F#","G#","A#",""],o=[i,i+1,i+2],l={};let d=0;for(const c of o)r.forEach(u=>{const h=`${u}${c}`;l[h]={note:h,x:d,width:60,height:200,isBlack:!1},d+=60});d=0;for(const c of o)a.forEach((u,h)=>{if(u===""){d+=60;return}const f=`${u}${c}`;l[f]={note:f,x:d+60-40/2,width:40,height:120,isBlack:!0},d+=60});return l}let _t="sf2/fluidr3-gm/acoustic_grand_piano",pi=3,As=!1,Ts=Es(pi);function la(){_t="sf2/fluidr3-gm/acoustic_grand_piano",yi(_t)}function ca(i){yi(i),_t=i}function mi(){return _t}function da(){const i=document.getElementById("instrument-loop-toggle");return(i==null?void 0:i.checked)??!1}function Dt(){return pi}function Fi(i){pi=i}function Ne(){return As}function ua(i){As=i}function Be(){return Ts}function ha(i){Ts=i}const it={sf2:jn(),webaudiofont:oa()};async function yi(i){if(!i.includes("/"))throw new Error(`Invalid instrument name: "${i}". Expected "<engine>/<library>/<instrument>"`);const e=i.split("/")[0],t=it[e];if(!t)throw new Error(`Engine "${e}" not available`);await t.setActiveInstrument(i)}function Is(i,e=100,t=!1){const s=mi();if(!s)return null;const n=s.split("/")[0],r=it[n];if(!r)throw new Error(`Engine "${n}" not available`);return r.playNote(i,e,t)}function fa(i){const e=mi();if(!e)return;const t=e.split("/")[0],s=it[t];if(!s)throw new Error(`Engine "${t}" not available`);s.stopNoteByPitch(i)}async function pa(i,e,t=1,s=100,n=!1,r=null,a=null,o=null,l,d){const c=i.split("/")[0],u=it[c];if(!u)throw new Error(`Engine "${c}" not available`);let h=a??X(),f=o;return h.state==="suspended"&&(console.warn("[loadAndPlayNote] Using preview context due to suspended main context"),h=xe(),f=qn()),await u.loadAndPlayNote(i,e,t,s,n,r,h,f,l,d)}let qt=null;function X(){return qt||(qt=new(window.AudioContext||window.webkitAudioContext)),qt}const Kt=new WeakMap,Ht=new WeakMap;function Rs(i=X()){if(!Ht.has(i)){const e=i.createAnalyser();e.fftSize=2048,Ht.set(i,e)}return Ht.get(i)}function Ee(i=X()){if(!Kt.has(i)){const e=i.createGain(),t=Rs(i);e.connect(t),t.connect(i.destination),Kt.set(i,e)}return Kt.get(i)}function ma(i){try{const e=Is(i,100,!1);return e?{stop:e,forceStop:e}:null}catch(e){return console.error("[playNote] Failed to play note",i,e),null}}function ya(i,e){const t=structuredClone(i);return t.tempo=e.bpm,t}function Fs(i){return{type:"CHANGE_TEMPO",bpm:i}}function ga(i){return Fs(i)}function _a(i,e){const t=structuredClone(i);return t.timeSignature=[e.beats,4],t}function Os(i){return{type:"SET_TIME_SIGNATURE",beats:i}}function ba(i){return Os(i)}function va(i,e){const t=structuredClone(i);return t.totalMeasures=e.measures,t}function Us(i){return{type:"SET_TOTAL_MEASURES",measures:i}}function Sa(i){return Us(i)}const Ca=new Set(["C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#","Cb"]),Na=new Set(["M","m"]);function wa(i){const e=i.slice(0,-1),t=i.slice(-1);if(!Ca.has(e)||!Na.has(t))return null;const s=t==="M"?"major":"minor",n=jr.get(`${e} ${s}`);return n.empty?null:n.notes}const Ma=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],xa=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ps={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function La(i){return i.includes("#")}function $(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,s,n]=e,r=t.toUpperCase(),a=Ps[r];if(a===void 0)return null;const o=[...s].reduce((d,c)=>c==="#"?d+1:c==="b"?d-1:d,0);return 12*(parseInt(n,10)+1)+(a+o)}function ne(i){return $(i)}const ka=i=>{const e=$(i);return e!==null?e%12:0};function gi(i,e=21,t){const s=$(i);if(s===null)return null;const n=t-e+1,r=s-e,a=n-1-r;return a>=0&&a<n?a:null}function Z(i,e,t){const n=t-e+1-1-i,r=e+n;return Te(r)}function Te(i,e=!1){const s=(e?xa:Ma)[i%12],n=Math.floor(i/12)-1;return`${s}${n}`}function Ds(i,e){const t=new Map;for(let s=i;s<=e;s++)t.set(s,La(Te(s)));return t}function Ga(i,e){const t=$(i),s=$(e);if(t===null||s===null)throw new Error(`Invalid pitches provided: ${i}, ${e}`);return t-s}function qs(i){const e=wa(i),t=new Map;if(!e)return t;const s=new Set(e.map(n=>Ps[n]%12));for(let n=0;n<=127;n++){const r=n%12;t.set(n,s.has(r))}return t}function Ks(){return typeof window<"u"&&typeof localStorage<"u"}function Ct(i,e){Ks()&&localStorage.setItem(i,JSON.stringify(e))}function st(i){if(!Ks())return null;const e=localStorage.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error(`Error parsing localStorage key "${i}":`,t),null}}const Hs="grid-key-highlighting",zs="grid-snap-enabled",$s="snap-to-in-key",Ba="CM";let Js=st(Hs)??!1,Ws=st(zs)??!0,js=st($s)??!1,Xs=qs(Ba),Vs=!1;function Ys(){return Js}function Ea(i){Js=i,Ct(Hs,i)}function Zs(){return Ws}function Aa(i){Ws=i,Ct(zs,i)}function Nt(){return js}function Ta(i){js=i,Ct($s,i)}function wt(){return Xs}function Ia(i){Xs=qs(i)}function Ve(){return Vs}function Oi(i){Vs=i}function Ra(i,e){const t=structuredClone(i);return t.songKey=e.songKey,Ia(e.songKey),t}function Qs(i){return{type:"CHANGE_SONG_KEY",songKey:i}}function Fa(i){return Qs(i)}function Oa(i,e){const t=structuredClone(i);return t.snapResolution=e.snapResolution,t}function er(i){return{type:"CHANGE_SNAP_RESOLUTION",snapResolution:i}}function Ua(i){return er(i)}function Pa(i,e){const t=structuredClone(i);return t.noteDuration=e.noteDuration,t}function tr(i){return{type:"CHANGE_NOTE_DURATION",noteDuration:i}}function Da(i){return tr(i)}function qa(i,e){const t=structuredClone(i);return t.isTripletMode=e.triplet,t.isDottedMode=e.dotted,t}function ir(i,e){return{type:"SET_NOTE_MODIFIER_MODE",triplet:i,dotted:e}}function Ka(i,e){return ir(i,e)}const _i={sf2:Dn(),webaudiofont:ta()},sr="sf2";async function rr(i,e,t,s,n,r,a=!0){const o=i.split("/");if(o.length!==3)throw new Error(`Invalid instrument fullName format: "${i}". Expected format "engine/library/instrument"`);const[l,d,c]=o,u=_i[l];if(!u)throw new Error(`Engine "${l}" not available`);return await u.loadInstrument(`${d}/${c}`,e,t,s,n,r,a)}async function Ha(i,e,t,s,n,r,a){if(!s||s.length===0)return;const o=60/me();if(a!=null&&a.aborted)return;const l=await rr(i,e,t,n,r);if(!(a!=null&&a.aborted))for(const d of s){if(a!=null&&a.aborted)return;const c=d.start*o,u=Math.max(.01,c),h=d.duration*o,f=d.velocity??100,y=$(d.pitch);if(y==null)continue;const b=i.split("/"),p=(b.length>=3?b[1]:b[0])==="drummachines"&&l.__midiMap?l.__midiMap.get(y)??y:y;try{l.start({note:p,duration:h,velocity:f,time:u,loop:!1})}catch(v){console.warn("[exportNotesToOffline] Failed to start note:",d,v)}}}function Ui(i){if(!i.container)return;const e=i.container.querySelector(".mute-btn"),t=i.container.querySelector(".solo-btn"),s=i.container.querySelector(".sequencer-body"),n=i.container.querySelector(".mini-contour");e==null||e.classList.toggle("bg-red-600",i.mute),e==null||e.classList.toggle("bg-gray-700",!i.mute),t==null||t.classList.toggle("bg-yellow-200",i.solo),t==null||t.classList.toggle("bg-gray-700",!i.solo);const r=i.mute&&!i.solo;s==null||s.classList.toggle("opacity-40",r),s==null||s.classList.toggle("opacity-100",!r),n==null||n.classList.toggle("opacity-40",r),n==null||n.classList.toggle("opacity-100",!r)}const Ie=["#ff006e","#3a86ff","#ffbe0b","#8338ec","#06d6a0","#ef476f","#118ab2","#ffd166","#073b4c","#8ac926","#0077b6","#00b4d8","#005f73","#03045e","#023e8a"];function Mt(i,e,t,s=0){const n=i.getContext("2d");if(!n)return;n.imageSmoothingEnabled=!1;const r=i.width,a=i.height;if(n.clearRect(0,0,r,a),!e.length)return;const o=Ie[s%Ie.length];n.fillStyle=o;const l=ce(),d=e.map(p=>W(p.pitch)).filter(p=>p!==null);if(!d.length)return;let c=Math.min(...d),u=Math.max(...d),h=Math.max(1,u-c);for(;a%h!==0;)u++,h=u-c;const f=a/h;for(const p of e){const v=W(p.pitch);if(v==null)continue;const S=p.start/l*r,_=p.duration/l*r,C=(v-c)/h,N=a-C*a-f/2,w=Math.round(S),L=Math.max(1,Math.round(_)),G=Math.round(N);n.fillRect(w,G,L,f)}const y=Fe(),b=Gi();n.save();let g=1;b>256?g=16:b>128?g=8:b>32&&(g=4);for(let p=0;p<=b;p++){if(p%g!==0)continue;const S=p*y/l*r,_=Math.round(S)+.5;n.beginPath(),n.moveTo(_,0),n.lineTo(_,a);const C=g===1||p%(g*2)===0;n.strokeStyle=C?"rgba(255, 255, 255, 0.12)":"rgba(255, 255, 255, 0.04)",n.lineWidth=.2,n.stroke()}n.restore()}function ri(i,e){const{config:t,container:s,matrix:n,colorIndex:r,getNotes:a}=i,[o,l]=e,d=$(o),c=$(l);if(d===null||c===null){console.warn(`Invalid note range: ${e}`);return}if(d>=c){console.warn("Invalid note range: low note must be lower than high note");return}t.noteRange=e,t.visibleNotes=Ga(l,o)+1;const u=s==null?void 0:s.querySelector(".mini-contour");u&&Mt(u,a(),t,r),n.setNoteRange(d,c)}function za(i){i.instrumentName.toLowerCase().includes("drum kit")?(ri(i,["B1","A5"]),i.matrix.setCustomLabels(Yn)):(ri(i,["A0","C9"]),i.matrix.setCustomLabels(null))}const xt=new Map;function $a(){xt.clear()}function Ja(i,e){xt.set(i,e)}function Wa(i){xt.delete(i)}function nr(i){return xt.get(i)}function bt(i,e=!0,t=null){var o;const s=nr(i.id);if(!s)return;const n=H.getInstance(),r=s.getMatrixContainer(),a=s.getMiniContourCanvas();if(!(!r||!a)){if(i.collapsed=e,s.collapsed=e,r.classList.toggle("hidden",e),a.classList.toggle("hidden",!e),t){const l=t.querySelector("img");if(l){const d=e?"icon-caret-up":"icon-caret-down";l.src=ie(`static/svg/${d}.svg`)}}if(e){s.toggleZoomControls(!1),s.toggleGripHandle(!1);for(const l of i.scheduledAnimations)clearTimeout(l);i.scheduledAnimations=[],Mt(a,i.notes,i.config,i.colorIndex)}else s.toggleZoomControls(!0),s.toggleGripHandle(!0),(o=i.matrix)==null||o.resize(),n.isActive()&&i.resumeAnimationsFromCurrentTime(n.getStartTime(),n.getStartBeat())}}function ja(){for(const i of K())bt(i,!0)}const Xa={totalMeasures:16,beatsPerMeasure:4,layout:{labelWidthColumns:1,headerHeightRows:2,footerHeightRows:1,labelWidth:80,headerHeight:40,footerHeight:40,baseCellWidth:70,minCellWidth:10,maxCellWidth:200,verticalCellRatio:4,highestMidi:108,lowestMidi:21},display:{showMeasureLines:!0,showBeatLines:!0,showHoveredCell:!0,highlightCurrentMeasure:!0},behavior:{zoom:1,scrollMargin:48,enableSnapping:!0,snapDivisions:4,maxZoom:1.6,minZoom:.5}};function Va(){return structuredClone(Xa)}function Ya(i,e){return{...i,...e,layout:{...i.layout,...e.layout??{}},display:{...i.display,...e.display??{}},behavior:{...i.behavior,...e.behavior??{}}}}const bi={Midnight:{whiteKey:"#1e1e1e",blackKey:"#2a103b",labelWhite:"#2c2c2c",labelBlack:"#3a1d4d",textWhite:"#cfcfcf",textBlack:"#e6d9ff",gridLine:"#333",beatLine:"#4e3d63",measureLine:"#8561c2",outOfKey:"rgb(255, 1, 1)"},Seashell:{whiteKey:"#fefefe",blackKey:"#f1e7dc",labelWhite:"#dddddd",labelBlack:"#d4cfc9",textWhite:"#444",textBlack:"#663300",gridLine:"#ccc",beatLine:"#bbb",measureLine:"#999",outOfKey:"rgba(255, 255, 255, 0.05)"},Cyberpunk:{whiteKey:"#162447",blackKey:"#1b1b2f",labelWhite:"#1f4068",labelBlack:"#1f4068",textWhite:"#e43f5a",textBlack:"#e43f5a",gridLine:"#1f4068",beatLine:"#e43f5a",measureLine:"#ffcc00",outOfKey:"rgba(255, 255, 255, 0.05)"},"Classic Blue":{whiteKey:"#f5faff",blackKey:"#dceeff",labelWhite:"#aaccee",labelBlack:"#88bbdd",textWhite:"#002244",textBlack:"#001122",gridLine:"#99bbdd",beatLine:"#88aacc",measureLine:"#336699",outOfKey:"rgba(255, 255, 255, 0.05)"},Darkroom:{whiteKey:"#2c2c2c",blackKey:"#1e1e1e",labelWhite:"#2a2a2a",labelBlack:"#383838",textWhite:"#e0e0e0",textBlack:"#a0a0a0",gridLine:"#404040",beatLine:"#606060",measureLine:"#808080",outOfKey:"rgba(255, 255, 255, 0.05)"}};class Za{constructor(e,t,s,n,r){this.getBlackKeyMap=n,this.getInKeyMap=r,this.scroll=e,this.config=t,this.interactionStore=s}draw(e){const{totalMeasures:t,beatsPerMeasure:s,layout:{baseCellWidth:n,verticalCellRatio:r,labelWidth:a,headerHeight:o},behavior:{zoom:l}}=this.config,{gridColorScheme:d}=z().theme,c=bi[d],u=this.config.layout.highestMidi-this.config.layout.lowestMidi+1,h=n*l,f=h/r,y=this.scroll.getX(),b=this.scroll.getY();(e.canvas.width-a)/h;const g=t*s;e.save(),e.translate(a-y,o-b);const p=Math.max(0,Math.floor((y-a)/h)),v=Ys(),S=this.getInKeyMap();for(let _=0;_<u;_++){const C=_*f,N=this.config.layout.highestMidi-_;let w;v?w=S.get(N)?c.whiteKey:c.blackKey:w=this.getBlackKeyMap().get(N)?c.blackKey:c.whiteKey,e.fillStyle=w,e.fillRect(0,C,g*h,f),e.strokeStyle=c.gridLine,e.beginPath(),e.moveTo(0,C),e.lineTo(g*h,C),e.stroke()}for(let _=p;_<=g;_++){if(_<0)continue;const C=_*h;e.strokeStyle=_%s===0?c.measureLine:c.beatLine,e.beginPath(),e.moveTo(C,0),e.lineTo(C,u*f),e.stroke()}e.restore()}}function Qa(i){const{layout:{labelWidth:e,baseCellWidth:t},totalMeasures:s,beatsPerMeasure:n,behavior:{zoom:r}}=i,a=t*r;return e+s*n*a}function eo(i){const{layout:{baseCellWidth:e,verticalCellRatio:t,highestMidi:s,lowestMidi:n,headerHeight:r},behavior:{zoom:a}}=i,o=s-n+1,l=e*a/t;return o*l+r}class to{constructor(e,t){this.scrollX=0,this.scrollY=0,this.canvas=e,this.config=t}getX(){return this.scrollX}getY(){return this.scrollY}setScroll(e,t){this.scrollX=this.clampX(e),this.scrollY=this.clampY(t)}recalculateBounds(){}getMaxScrollX(){const e=this.canvas.offsetWidth;return Math.max(0,this.getContentWidth()-e)}getMaxScrollY(){const e=this.canvas.offsetHeight-this.config.layout.headerHeight;return Math.max(0,this.getContentHeight()-e)}clampX(e){return Math.max(0,Math.min(e,this.getMaxScrollX()))}clampY(e){return Math.max(0,Math.min(e,this.getMaxScrollY()))}getContentWidth(){return Qa(this.config)}getContentHeight(){return eo(this.config)}}function rt(i,e){const t=e.getBoundingClientRect();return{x:i.clientX-t.left,y:i.clientY-t.top}}function ar(i,e,t,s){const n=e.getBoundingClientRect();return{x:i.clientX-n.left+t.getX()-s.layout.labelWidth,y:i.clientY-n.top+t.getY()-s.layout.headerHeight}}function io(i,e,t,s,n){const r=t.getBoundingClientRect();return{x:i-r.left+s.getX()-n.layout.labelWidth,y:e-r.top+s.getY()-n.layout.headerHeight}}function nt(i,e,t,s,n=!1){const{layout:{labelWidth:r,headerHeight:a,baseCellWidth:o,verticalCellRatio:l,highestMidi:d,lowestMidi:c},behavior:{zoom:u}}=t,h=d-c+1,f=o*u,y=f/l,b=(i.x+e.getX()-r)/f;let g=Math.floor((i.y+e.getY()-a)/y);const p=n?s*(2/3):s,v=Math.floor(b/p)*p;if(v<0||g<0||g>=h)return null;if(Nt()&&!Ve()){const S=wt(),_=d-g;let C=null,N=1/0;for(let w=-12;w<=12;w++){const L=_+w;if(L<c||L>d||!S.get(L))continue;const G=d-L,E=Math.abs(G-g);if(E<N&&(N=E,C=G),E===0)break}C!==null&&(g=C)}return{x:v,y:g}}class so{constructor(e,t){this.notes=[],this.noteIndex=new Map,this.pitchIndex=new Map,this.config=e,this.playNote=t}set(e){this.notes=e}getAll(){return this.notes}add(e){this.notes.push(e)}getTrackedNotes(e){const t=e.getHoveredNoteKey(),s=r=>e.isNoteHighlighted(r),n=new Set(e.getSelectedNotes().map(r=>`${r.pitch}:${r.start}`));return this.notes.map(r=>{const a=`${r.pitch}:${r.start}`;return{note:r,state:{hovered:a===t,selected:n.has(a),highlighted:s(r)}}})}remove(e){const t=`${e.pitch}:${e.start}`;this.notes=this.notes.filter(s=>!(s.pitch===e.pitch&&s.start===e.start)),this.noteIndex.delete(t)}removeAll(e){const t=new Set(e.map(s=>`${s.pitch}:${s.start}`));this.notes=this.notes.filter(s=>!t.has(`${s.pitch}:${s.start}`));for(const s of t)this.noteIndex.delete(s)}rebuildIndex(){this.noteIndex.clear(),this.pitchIndex.clear();for(const e of this.notes){const t=`${e.pitch}:${e.start}`;this.noteIndex.set(t,e),this.pitchIndex.has(e.pitch)||this.pitchIndex.set(e.pitch,[]),this.pitchIndex.get(e.pitch).push(e)}for(const e of this.pitchIndex.values())e.sort((t,s)=>t.start-s.start)}findNoteAtMousePosition(e,t,s,n,r){const a=rt(e,t);F("Raw mouse pos (grid-relative)",a);const o=At(),l=nt(a,s,n,o);if(!l){F("Snapped position is invalid",{mouse:a,snap:o});return}const d=Z(l.y,n.layout.lowestMidi,n.layout.highestMidi),c=l.x;F("Snapped grid position",l),F("Computed pitch and beat",{pitch:d,beat:c});const u=r.findNoteUnderCursor(d,c);return F("Note under cursor (if any)",u),u}findAtPosition(e,t){return this.noteIndex.get(`${e}:${t}`)}findNoteUnderCursor(e,t){const s=this.pitchIndex.get(e);if(!s||s.length===0)return;let n=0,r=s.length-1,a=-1;for(;n<=r;){const o=Math.floor((n+r)/2);s[o].start<=t?(a=o,n=o+1):r=o-1}if(a!==-1)for(let o=a;o>=0;o--){const l=s[o];if(t>=l.start&&t<l.start+l.duration)return l;if(l.start+l.duration<t)break}}findNoteEdgeAtCursor(e,t,s=.25){const n=this.pitchIndex.get(e);if(!n||n.length===0)return;let r=0,a=n.length-1,o=-1;for(;r<=a;){const l=Math.floor((r+a)/2);n[l].start<=t?(o=l,r=l+1):a=l-1}if(o!==-1)for(let l=o;l>=0;l--){const d=n[l],c=d.start+d.duration*(1-s),u=d.start+d.duration;if(t>=c&&t<=u)return d;if(d.start+d.duration<t)break}}mergeSelections(e,t){const s=new Set,n=[];for(const r of[...e,...t]){const a=`${r.pitch}:${r.start}`;s.has(a)||(s.add(a),n.push(r))}return n}previewNote(e,t,s=100,n=!1){this.playNote(e,t,s,n)}}function Re(i,e,t,s,n,r=4){i.beginPath(),i.moveTo(e+r,t),i.lineTo(e+s-r,t),i.quadraticCurveTo(e+s,t,e+s,t+r),i.lineTo(e+s,t+n-r),i.quadraticCurveTo(e+s,t+n,e+s-r,t+n),i.lineTo(e+r,t+n),i.quadraticCurveTo(e,t+n,e,t+n-r),i.lineTo(e,t+r),i.quadraticCurveTo(e,t,e+r,t),i.closePath()}function ro(i,e,t,s){const{layout:{baseCellWidth:n,verticalCellRatio:r,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=t,d=a-o+1,c=n*l,u=c/r,h=s.offsetWidth,f=s.offsetHeight,y=0,b=i/c-y,g=(i+h)/c+y,p=Math.floor(e/u),v=Math.min(d-1,Math.ceil((e+f)/u)+y),S=new Map;return _=>_.filter(({note:C})=>{if(C.start+C.duration<b||C.start>g)return!1;let w=S.get(C.pitch);if(w==null){const L=gi(C.pitch,o,a);if(L==null||L<0||L>=d)return!1;w=L,S.set(C.pitch,w)}return w>=p&&w<=v})}function no(i){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;i=i.replace(e,(u,h,f,y)=>h+h+f+f+y+y);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(!t)return null;const s=parseInt(t[1],16)/255,n=parseInt(t[2],16)/255,r=parseInt(t[3],16)/255,a=Math.max(s,n,r),o=Math.min(s,n,r);let l=0,d=0,c=(a+o)/2;if(a!==o){const u=a-o;switch(d=c>.5?u/(2-a-o):u/(a+o),a){case s:l=(n-r)/u+(n<r?6:0);break;case n:l=(r-s)/u+2;break;case r:l=(s-n)/u+4;break}l*=60}return{h:Math.round(l),s:Math.round(d*100),l:Math.round(c*100)}}const ao=["#FF0000","#9400D3","#FFFF00","#FF69B4","#00FF00","#00FFFF","#0000FF","#8A2BE2","#FF8C00","#FFD700","#ADFF2F","#DC143C"];function oo(i,e){const t=no(i);if(!t)return"#999";const n=10+(e??100)/127*50;return`hsl(${t.h}, ${t.s}%, ${n}%)`}function ut(i){return(e,t)=>{const s=i(e,t);return oo(s,e.velocity)}}function lo(i){const e=$(i.pitch);if(e==null)return"#999";const t=e*3%360,s=100,n=60,a=.2+(i.velocity??100)/127*.8;return`hsla(${t}, ${s}%, ${n}%, ${a})`}const co={Scriabin:ut((i,{getPitchClass:e}={})=>{const t=e?e(i.pitch):0;return ao[t]||"#999"}),"Track Color":ut((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#999"),"Note Velocity":ut((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#ff0000"),"Octave Bands":lo,"Pitch Class Contrast":ut((i,{getPitchClass:e}={})=>{const t=$(i.pitch);if(t==null)return"#999";const s=t%12;return["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"][s]||"#999"})};function uo(i){return i<0&&(console.error(`Invalid trackId: ${i}. Using default color.`),i=0),Ie[i%Ie.length]}class ho{constructor(e,t,s,n,r){this.scroll=e,this.config=t,this.noteManager=s,this.interactionStore=n,this.sequencerId=r}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r},behavior:{zoom:a}}=this.config,{noteColorScheme:o}=z().theme,l=co[o]||(()=>"#999"),d={getPitchClass:ka,getTrackColor:()=>uo(this.sequencerId)},c=t*a,u=c/s,h=this.scroll.getX(),f=this.scroll.getY(),y=e.canvas,b=this.noteManager.getTrackedNotes(this.interactionStore);e.save(),e.translate(n-h,r-f);const p=ro(h,f,this.config,y)(b);for(const{note:v,state:S}of p){const C=gi(v.pitch,this.config.layout.lowestMidi,this.config.layout.highestMidi)*u,N=v.start*c,w=v.duration*c,L=u,G=l(v,d);e.fillStyle=G,Re(e,N,C,w,L,4),e.fill(),(S.selected||S.hovered||S.highlighted)&&(e.lineWidth=2,e.strokeStyle=S.selected?"#ffffff":S.hovered?"#ff9933":"#33ff99",Re(e,N,C,w,L,4),e.stroke())}e.restore()}}class fo{constructor(e,t,s,n){this.scroll=e,this.config=t,this.store=s,this.getNoteDuration=n}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=t*l,c=d/s;e.save(),e.translate(n-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(100, 180, 255, 0.5)";const u=this.store.getPreviewNotes();if(u.length>0){const p=o-a+1;for(const v of u){const S=ne(v.pitch);if(S===null)continue;const _=p-1-(S-a),C=v.start*d,N=_*c,w=v.duration*d;Re(e,C,N,w,c,3),e.fill()}e.restore();return}const h=this.store.getSnappedCursorGridPosition();if(!h){e.restore();return}const f=this.getNoteDuration(),y=h.x*d,b=h.y*c,g=d*f;Re(e,y,b,g,c,3),e.fill(),e.restore()}}let $e=!1,vi=[];const ni=new Set;function Pi(){return $e=!$e,ni.forEach(i=>i($e)),$e}function po(i){return ni.add(i),i($e),()=>ni.delete(i)}function mo(i){vi=i}function Ye(){return vi}function Si(){vi=[]}class yo{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=t*l,c=d/s;e.save(),e.translate(n-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(255, 100, 180, 0.4)";const u=Ye();if(u.length>0){const h=o-a+1;for(const f of u){const y=ne(f.pitch);if(y===null)continue;const b=h-1-(y-a),g=f.start*d,p=b*c,v=f.duration*d;Re(e,g,p,v,c,3),e.fill()}e.restore();return}e.restore()}}class go{constructor(e,t){this.scroll=e,this.config=t,this.animations=[]}playNote(e){const t=performance.now(),s=me();let n=e.duration*6e4/s;n=Math.max(100,Math.min(n,1600));const a=($(e.pitch)||0)*5%360;this.animations.push({note:e,startTime:t,duration:n,hue:a})}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=this.scroll.getX(),c=this.scroll.getY(),u=t*l,h=u/s,f=performance.now();e.clearRect(0,0,e.canvas.width,e.canvas.height),this.animations=this.animations.filter(y=>{const b=(f-y.startTime)/y.duration;if(b>1)return!1;const{note:g,hue:p}=y,v=$(g.pitch);if(v==null||v<a||v>o)return!0;const S=o-v,_=g.start*u+n-d,C=S*h+r-c,N=g.duration*u,w=h-1,L=_+N/2,G=C+w/2,E=Math.sin(b*Math.PI),M=`hsla(${p}, 100%, 70%, ${.4*E})`;e.save(),e.globalAlpha=1,e.fillStyle=M,e.beginPath(),e.roundRect(_,C,N,w,4),e.fill();const x=2,B=50;for(let I=0;I<x;I++){const R=I*B,q=Math.max(0,Math.min(1,(f-y.startTime-R)/(y.duration-R))),Q=Math.sin(q*Math.PI),be=1+(.1+I*.1)*Q,It=(1-q)*.3;e.globalAlpha=It,e.strokeStyle=`hsl(${p}, 100%, 65%)`,e.lineWidth=1.5;const ct=N*be,Ai=w*be;e.beginPath(),e.roundRect(L-ct/2,G-Ai/2,ct,Ai,4),e.stroke()}return e.restore(),!0}),this.animations.length>0&&requestAnimationFrame(()=>this.draw(e))}}class _o{constructor(e,t,s){this.scroll=e,this.config=t,this.ctx=s,this.isAnimating=!1,this.acceptanceAnimations=[],this.activeBarIndex=null,this.renderFrame=n=>{if(!this.isAnimating)return;this.draw(n);const r=this.acceptanceAnimations.length>0,a=Ye().length>0,o=this.activeBarIndex!==null;r||a||o?requestAnimationFrame(this.renderFrame):this.isAnimating=!1}}start(){this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}stop(){this.isAnimating=!1}setActiveAutocompleteBar(e){this.activeBarIndex=e}invalidate(){this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}playNoteAcceptance(e){const t=performance.now();for(const s of e){const r=($(s.pitch)||0)*5%360;this.acceptanceAnimations.push({note:s,startTime:t,duration:800,hue:r})}this.isAnimating||(this.isAnimating=!0,requestAnimationFrame(this.renderFrame))}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,d=this.scroll.getX(),c=this.scroll.getY(),u=t*l,h=u/s,f=this.ctx;f.clearRect(0,0,f.canvas.width,f.canvas.height);const y=o-a+1;if(this.activeBarIndex!==null){const p=.5+.5*Math.sin(e*.005),{layout:{baseCellWidth:v,verticalCellRatio:S,labelWidth:_,headerHeight:C,lowestMidi:N,highestMidi:w},behavior:{zoom:L}}=this.config,G=this.scroll.getX(),E=this.scroll.getY(),M=v*L,x=M/S,B=this.activeBarIndex*M*(Fe()??4)+_-G,I=B+(Fe()??4)*M,R=C-E,q=(w-N+1)*x;this.ctx.save(),this.ctx.globalAlpha=.2*p,this.ctx.fillStyle="rgba(180, 255, 255, 1)",this.ctx.fillRect(B,R,I-B,q),this.ctx.restore()}const b=Ye();if(b.length>0){const p=.5+.5*Math.sin(e*.005);f.save(),f.translate(n-d,r-c);for(const v of b){const S=ne(v.pitch);if(S===null)continue;const _=y-1-(S-a),C=v.start*u,N=_*h,w=v.duration*u;f.fillStyle=`rgba(255, 100, 180, ${.2*p})`,f.beginPath(),f.roundRect(C,N,w,h,3),f.fill(),f.lineWidth=1.5,f.strokeStyle=`rgba(255, 100, 180, ${.3*p})`,f.beginPath(),f.roundRect(C,N,w,h,3),f.stroke()}f.restore()}const g=performance.now();this.acceptanceAnimations=this.acceptanceAnimations.filter(p=>{const v=(g-p.startTime)/p.duration;if(v>1)return!1;const{note:S,hue:_}=p,C=ne(S.pitch);if(C===null||C<a||C>o)return!0;const N=y-1-(C-a),w=S.start*u+n-d,L=N*h+r-c,G=S.duration*u,E=h-1,M=w+G/2,x=L+E/2,I=1+.5*Math.sin(v*Math.PI),R=(1-v)*.5;f.save(),f.globalAlpha=R,f.strokeStyle=`hsl(${_}, 100%, 65%)`,f.lineWidth=2.5;const q=G*I,Q=E*I;return f.beginPath(),f.roundRect(M-q/2,x-Q/2,q,Q,4),f.stroke(),f.restore(),!0})}}class bo{constructor(e,t){this.scroll=e,this.config=t,this.x=null}setPlayheadX(e){this.x=e}clear(){this.x=null}draw(e){if(this.x==null)return;const{layout:{verticalCellRatio:t,baseCellWidth:s,labelWidth:n,headerHeight:r,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=this.config,d=a-o+1,c=this.scroll.getX(),u=this.scroll.getY(),h=s*l/t,f=d*h+r,y=this.x;e.save(),e.translate(n-c,-u),e.lineWidth=2,e.strokeStyle="rgba(168, 85, 247, 1.0)",e.shadowColor="rgba(168, 85, 247, 0.5)",e.shadowBlur=6,e.beginPath(),e.moveTo(y,0),e.lineTo(y,f),e.stroke(),e.restore()}}class Le{constructor(e,t=!0){this.canvas=e,this.dpr=t&&window.devicePixelRatio||1;const s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.ctx=s}resize(){const e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,s=Math.floor(e*this.dpr),n=Math.floor(t*this.dpr);(this.canvas.width!==s||this.canvas.height!==n)&&(this.canvas.width=s,this.canvas.height=n,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr))}getContext(){return this.ctx}withContext(e){e(this.ctx)}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}destroy(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Di{constructor(e,t,s,n,r){this.thumb=e,this.isHorizontal=t,this.scroll=s,this.interactionStore=n,this.requestRedraw=r,this.onMouseEnter=()=>this.interactionStore.setIsOnScrollbar(!0),this.onMouseLeave=()=>this.interactionStore.setIsOnScrollbar(!1),this.onThumbMouseDown=o=>this.handleMouseDown(o),this.onMouseMove=null,this.onMouseUp=null;const a=this.thumb.parentElement;if(!a)throw new Error("Scrollbar thumb must have a parent track element.");this.track=a,this.attachDragHandler()}attachDragHandler(){this.track.addEventListener("mouseenter",this.onMouseEnter),this.track.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mouseenter",this.onMouseEnter),this.thumb.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mousedown",this.onThumbMouseDown)}handleMouseDown(e){e.preventDefault(),this.interactionStore.setIsScrolling(!0),this.onMouseMove=t=>{const s=this.track.getBoundingClientRect(),n=this.isHorizontal?this.track.offsetWidth:this.track.offsetHeight,a=(this.isHorizontal?t.clientX:t.clientY)-(this.isHorizontal?s.left:s.top),o=this.isHorizontal?this.thumb.offsetWidth:this.thumb.offsetHeight,l=n-o,d=Math.max(0,Math.min(a-o/2,l)),c=l>0?d/l:0,u=this.isHorizontal?this.scroll.getMaxScrollX():this.scroll.getMaxScrollY(),h=c*u;this.isHorizontal?this.scroll.setScroll(h,this.scroll.getY()):this.scroll.setScroll(this.scroll.getX(),h),this.requestRedraw()},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.interactionStore.setIsScrolling(!1),this.onMouseMove=null,this.onMouseUp=null},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){this.track.removeEventListener("mouseenter",this.onMouseEnter),this.track.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mouseenter",this.onMouseEnter),this.thumb.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mousedown",this.onThumbMouseDown),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&document.removeEventListener("mouseup",this.onMouseUp),this.onMouseMove=null,this.onMouseUp=null}}let qi=!1;function vo(){if(qi)return;const i=document.createElement("style");i.textContent=`
    .grid-scrollbars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .grid-scrollbar {
      position: absolute;
      background: #1f1f1f;
      pointer-events: all;
    }

    .grid-scrollbar-thumb {
      position: absolute;
      background: #888;
      border-radius: 6px;
      cursor: pointer;
    }

    .grid-scrollbar-corner {
      position: absolute;
      width: 12px;
      height: 12px;
      bottom: 0;
      right: 0;
      background: #1f1f1f;
      z-index: 2;
      pointer-events: none;
    }
  `,document.head.appendChild(i),qi=!0}class So{constructor(e,t,s,n,r){this.container=e,this.scroll=t,this.config=s,this.interactionStore=n,this.requestRedraw=r,this.trackThickness=16,vo(),this.createDOM(),this.attachEvents(),this.config=this.config,this.interactionStore=n}createDOM(){const e=this.hScrollbar=document.createElement("div"),t=this.hThumb=document.createElement("div"),s=this.vScrollbar=document.createElement("div"),n=this.vThumb=document.createElement("div"),r=this.corner=document.createElement("div");e.className="grid-scrollbar",s.className="grid-scrollbar",t.className="grid-scrollbar-thumb",n.className="grid-scrollbar-thumb",r.className="grid-scrollbar-corner",e.style.position=s.style.position=r.style.position="absolute",e.style.zIndex=s.style.zIndex=r.style.zIndex="5",e.style.bottom="0",e.style.left="0",e.style.right=`${this.trackThickness}px`,e.style.height=`${this.trackThickness}px`,s.style.top="0",s.style.right="0",s.style.bottom=`${this.trackThickness}px`,s.style.width=`${this.trackThickness}px`,r.style.width=`${this.trackThickness}px`,r.style.height=`${this.trackThickness}px`,r.style.right="0",r.style.bottom="0",r.style.background="#333",r.style.position="absolute",t.style.zIndex=n.style.zIndex="6",t.style.position=n.style.position="absolute",t.style.background="#7e22ce",n.style.background="#7e22ce",t.style.borderRadius=n.style.borderRadius="8px",t.style.height="100%",n.style.width="100%",e.appendChild(t),s.appendChild(n),this.container.appendChild(e),this.container.appendChild(s),this.container.appendChild(r)}attachEvents(){this.hDragHandler=new Di(this.hThumb,!0,this.scroll,this.interactionStore,this.requestRedraw),this.vDragHandler=new Di(this.vThumb,!1,this.scroll,this.interactionStore,this.requestRedraw)}update(){const{width:e,height:t}=this.container.getBoundingClientRect(),s=this.scroll.getContentWidth(),n=this.scroll.getContentHeight(),r=this.scroll.getX(),a=this.scroll.getY(),o=this.scroll.getMaxScrollX(),l=this.scroll.getMaxScrollY(),d=e-this.trackThickness,c=this.config.layout.labelWidth,u=Math.max(40,(e-c)/s*d),h=r/o*(d-u);this.hThumb.style.width=`${u}px`,this.hThumb.style.left=`${Math.max(0,h)}px`;const f=t-this.trackThickness,y=this.config.layout.headerHeight,b=Math.max(40,(t-y)/n*f),g=a/l*(f-b);this.vThumb.style.height=`${b}px`,this.vThumb.style.top=`${Math.max(0,g)}px`}destroy(){this.hDragHandler.destroy(),this.vDragHandler.destroy(),this.hScrollbar.remove(),this.vScrollbar.remove(),this.corner.remove(),this.hScrollbar=null,this.vScrollbar=null,this.corner=null}}var k=(i=>(i[i.NoteTool=0]="NoteTool",i[i.Selecting=1]="Selecting",i[i.SelectedIdle=2]="SelectedIdle",i[i.Dragging=3]="Dragging",i[i.Pasting=4]="Pasting",i[i.Sizing=5]="Sizing",i))(k||{});function Me(i,e,t,s,n){const r=rt(i,e),a=t.getSnapResolution(),o=t.isTripletMode();return nt(r,s,n,a,o)}function ge(i,e,t,s){const{baseCellWidth:n}=s.layout,{zoom:r}=s.behavior,a=ar(i,e,t,s),o=n*r;return a.x/o}var U=(i=>(i.Default="default",i.Pointer="pointer",i.Crosshair="crosshair",i.Grabbing="grabbing",i.Grab="grab",i.ResizeHorizontal="ew-resize",i.ResizeVertical="ns-resize",i.Move="move",i.NotAllowed="not-allowed",i.Custom="url(cursor.png), auto",i))(U||{});function Ze(i,e,t,s){return!i||i.x>=ce()?(e.setSnappedCursorGridPosition(null),e.setHoveredNoteKey(null),t.set(U.Default),s(),!0):!1}function Co(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),_e(e.sequencerId),t):i}function Lt(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}function kt(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function No(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),_e(e.sequencerId),t}function ae(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function oe(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}class wo{constructor(e,t,s,n,r,a,o,l,d,c,u,h){this.canvas=e,this.noteManager=t,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(Ze(t,this.store,this.cursorController,this.requestRedraw))return;const s=ge(e,this.canvas,this.scroll,this.config);if(t){const n=Z(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s),a=this.store.getHoveredNoteKey();if(r&&a===`${r.pitch}:${r.start}`){this.store.setSelectedNotes([r]),this.controller.transitionTo(k.Sizing);return}}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()){const c=this.store.getHoveredNoteKey();if(c&&n>=this.dragThreshold){const[u,h]=c.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}}if(n>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const r=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!r||Ze(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=Z(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=ge(e,this.canvas,this.scroll,this.config),l=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(l){const c=`${l.pitch}:${l.start}`;this.store.setHoveredNoteKey(c),this.store.setSnappedCursorGridPosition(null),d===l?this.cursorController.set(U.ResizeHorizontal):this.cursorController.set(U.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set(U.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0)return;if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}this.store.isDraggingToSelect()&&this.store.endSelectionDrag();const t=this.store.getHoveredNoteKey();if(t){if(performance.now()-this.store.getLastDeletionTime()<100)return;const[d,c]=t.split(":"),u=this.noteManager.findAtPosition(d,Number(c));if(u){this.noteManager.previewNote(u.pitch,.25),this.store.setSelectedNotes([u]),this.controller.transitionTo(k.SelectedIdle);return}}const s=this.store.getSnappedCursorGridPosition();if(!s)return;const{layout:n}=this.config,r=this.grid.getNoteDuration(),a=Z(s.y,n.lowestMidi,n.highestMidi);if(!a||this.noteManager.findAtPosition(a,s.x))return;const l={start:s.x,duration:r,pitch:a,velocity:100};T(Lt(this.getSequencerId(),[l]),kt(this.getSequencerId(),[l])),this.noteManager.previewNote(a,r),this.playNoteAnimation({start:s.x,duration:r,pitch:a,velocity:100})}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(T(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting)}}onEnter(){F("DefaultNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}function Ki(i,e,t,s,n){const{layout:{baseCellWidth:r,verticalCellRatio:a,lowestMidi:o,highestMidi:l},behavior:{zoom:d}}=s,c=r*d,u=c/a,h=Math.min(e.startX,e.currentX+c/2),f=Math.max(e.startX,e.currentX+c/2),y=Math.min(e.startY,e.currentY),b=Math.max(e.startY,e.currentY),g=n.getSnapResolution(),p=Math.floor(h/c/g)*g,v=Math.floor(f/c/g)*g,S=Math.floor(y/u),_=Math.floor(b/u),C=Math.min(S,_),N=Math.max(S,_);return i.filter(w=>{const L=gi(w.pitch,o,l);if(L==null)return!1;const G=L>=C&&L<=N,E=w.start+w.duration,M=w.start>=p&&E<=v;return G&&M})}class Mo{constructor(e,t,s,n,r,a,o,l){this.canvas=e,this.config=t,this.scroll=s,this.grid=n,this.store=r,this.controller=a,this.noteManager=o,this.requestRedraw=l}onEnter(){const e=io(this.controller.getLastMouseX(),this.controller.getLastMouseY(),this.canvas,this.scroll,this.config);this.store.setMarqueeBox({startX:e.x,startY:e.y,currentX:e.x,currentY:e.y})}onMouseMove(e){const t=this.store.getMarqueeBox();if(!t)return;const s=ar(e,this.canvas,this.scroll,this.config);t.currentX=s.x,t.currentY=s.y,this.store.setMarqueeBox({...t});const n=Ki(this.noteManager.getAll(),t,this.scroll,this.config,this.grid);this.store.setHighlightedNotes(n),this.requestRedraw()}onMouseUp(e){const t=this.store.getMarqueeBox();if(!t){this.controller.transitionTo(k.NoteTool);return}const s=Ki(this.noteManager.getAll(),t,this.scroll,this.config,this.grid),r=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(s.length>0){const a=this.store.getSelectedNotes(),o=r?this.noteManager.mergeSelections(a,s):s;this.store.setSelectedNotes(o),this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(k.SelectedIdle)}else this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(k.NoteTool)}onExit(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.requestRedraw()}}class xo{constructor(e,t,s,n,r,a,o,l,d,c,u,h){this.canvas=e,this.config=t,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!t)return;const s=ge(e,this.canvas,this.scroll,this.config),n=Z(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s);if(r){const a=`${r.pitch}:${r.start}`;new Set(this.store.getSelectedNotes().map(l=>`${l.pitch}:${l.start}`)).has(a)||this.store.setSelectedNotes([r]),this.controller.transitionTo(k.Sizing);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),g=parseFloat(b),p=this.noteManager.findAtPosition(y,g);if(!p)return;this.store.getSelectedNotes().some(_=>_.pitch===p.pitch&&_.start===p.start)||this.store.setSelectedNotes([p]),this.store.setDragAnchorNoteKey(`${p.pitch}:${p.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}if(!f&&n>=this.dragThreshold){!e.ctrlKey&&!e.metaKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const r=rt(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),l=nt(r,this.scroll,this.config,a,o);if(!l){this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default),this.requestRedraw();return}const d=ge(e,this.canvas,this.scroll,this.config),c=Z(l.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(c,d),h=this.noteManager.findNoteEdgeAtCursor(c,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(U.ResizeHorizontal):this.cursorController.set(U.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const s=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),r=n.some(l=>`${l.pitch}:${l.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const l=n.filter(d=>`${d.pitch}:${d.start}`!==s);this.store.setSelectedNotes(l)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(k.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(k.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),l=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&l?T(ae(this.getSequencerId(),o),oe(this.getSequencerId(),o)):T(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),T(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting);return}if(e.key==="Delete"){if(!t.length)return;T(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}}}function Lo({notes:i,anchorBeat:e,anchorMidi:t,targetBeat:s,targetMidi:n,lowestMidi:r,highestMidi:a}){const o=s-e,l=i.map(g=>g.start+o),d=i.map(g=>g.start+o+g.duration),c=Math.min(...l),u=Math.max(...d),h=Math.min(0,c),f=Math.max(0,u-ce()),y=o-h-f;if(!Nt()||Ve()){const g=n-t;return i.flatMap(p=>{const v=ne(p.pitch);if(v==null)return[];let S=v+g;S<r&&(S=r),S>a&&(S=a);const _=Te(S);return _?[{pitch:_,start:p.start+y,duration:p.duration,velocity:p.velocity??100}]:[]})}else{const g=wt(),p=[];for(let C=a;C>=r;C--)g.get(C)&&p.push(C);const v=p.indexOf(t),S=p.indexOf(n);if(v===-1||S===-1)return[];const _=S-v;return i.flatMap(C=>{const N=ne(C.pitch);if(N==null)return[];const w=p.indexOf(N);if(w===-1)return[];const L=w+_;if(L<0||L>=p.length)return[];const G=p[L],E=Te(G);return E?[{pitch:E,start:C.start+y,duration:C.duration,velocity:C.velocity??100}]:[]})}}class ko{constructor(e,t,s,n,r,a,o,l,d,c){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.grid=r,this.requestRedraw=a,this.getSequencerId=o,this.controller=l,this.cursorController=d,this.getClipboard=c}onMouseMove(e){const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!t||Ze(t,this.store,this.cursorController,this.requestRedraw))return;const s=this.getClipboard();if(!s.notes.length)return;const{lowestMidi:n,highestMidi:r}=this.config.layout,a=r-n+1,o=n+(a-1-t.y),l=t.x,d=Lo({notes:s.notes,anchorBeat:s.anchorBeat,anchorMidi:s.anchorMidi,targetBeat:l,targetMidi:o,lowestMidi:n,highestMidi:r});this.store.setPreviewNotes(d),this.cursorController.set(U.Pointer),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=this.store.getPreviewNotes();t.length&&(T(Lt(this.getSequencerId(),t),kt(this.getSequencerId(),t)),this.store.clearPreviewNotes(),this.controller.transitionTo(k.NoteTool))}onMouseLeave(){this.store.clearPreviewNotes(),this.controller.transitionTo(k.NoteTool)}onExit(){this.store.clearPreviewNotes(),this.requestRedraw()}}function Go({originalNotes:i,anchorNote:e,targetPitch:t,targetBeat:s,lowestMidi:n,highestMidi:r}){const a=ne(t),o=ne(e.pitch);if(a==null||o==null)return[];const l=s-e.start,d=i.map(p=>p.start+l),c=i.map(p=>p.start+l+p.duration),u=Math.min(...d),h=Math.max(...c),f=Math.min(0,u),y=Math.max(0,h-ce()),b=l-f-y;if(!Nt()||Ve()){const p=a-o;return i.flatMap(v=>{const S=ne(v.pitch);if(S==null)return[];let _=S+p;_<n&&(_=n),_>r&&(_=r);const C=Te(_);return C?[{pitch:C,start:v.start+b,duration:v.duration,velocity:v.velocity??100}]:[]})}else{const p=wt(),v=[];for(let N=r;N>=n;N--)p.get(N)&&v.push(N);const S=v.indexOf(o),_=v.indexOf(a);if(S===-1||_===-1)return[];const C=_-S;return i.flatMap(N=>{const w=ne(N.pitch);if(w==null)return[];const L=v.indexOf(w);if(L===-1)return[];const G=L+C;if(G<0||G>=v.length)return[];const E=v[G],M=Te(E);return M?[{pitch:M,start:N.start+b,duration:N.duration,velocity:N.velocity??100}]:[]})}}function Bo(i,e){const t=structuredClone(i),s=t.sequencers.find(a=>a.id===e.sequencerId);if(!s)return i;const n=e.from,r=e.to;for(let a=0;a<n.length;a++){const o=n[a],l=r[a],d=s.notes.findIndex(c=>c.pitch===o.pitch&&c.start===o.start&&c.duration===o.duration);d!==-1&&(s.notes[d].pitch=l.pitch,s.notes[d].start=l.start)}return _e(e.sequencerId),t}function or(i,e,t){return{type:"MOVE_NOTES",sequencerId:i,from:structuredClone(e),to:structuredClone(t)}}function Eo(i,e,t){return or(i,t,e)}class Ao{constructor(e,t,s,n,r,a,o,l,d,c){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=l,this.cursorController=d,this.getSequencerId=c,this.originalNotes=[],this.anchorNote=null,this.hasMoved=!1,this.lastPreviewedPitch=null}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(k.NoteTool);return}this.originalNotes=e.map(n=>({...n}));const t=this.store.getDragAnchorNoteKey(),s=t?e.find(n=>`${n.pitch}:${n.start}`===t):e[0];this.anchorNote=s??e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasMoved=!1,this.requestRedraw()}onMouseMove(e){const t=rt(e,this.canvas),s=this.grid.getSnapResolution(),n=this.grid.isTripletMode(),r=nt(t,this.scroll,this.config,s,n);if(!r||!this.anchorNote)return;const{layout:a}=this.config,o=Z(r.y,a.lowestMidi,a.highestMidi);if(!o)return;const l=Go({originalNotes:this.originalNotes,anchorNote:this.anchorNote,targetPitch:o,targetBeat:r.x,lowestMidi:a.lowestMidi,highestMidi:a.highestMidi});this.store.setPreviewNotes(l),this.hasMoved=!0,this.cursorController.set(U.Grabbing),o!==this.lastPreviewedPitch&&(this.noteManager.previewNote(o,.25),this.lastPreviewedPitch=o),this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote)return;const t=this.store.getPreviewNotes();if(this.hasMoved&&t.some((n,r)=>n.start!==this.originalNotes[r].start||n.pitch!==this.originalNotes[r].pitch))T(or(this.getSequencerId(),this.originalNotes,t),Eo(this.getSequencerId(),this.originalNotes,t));else for(const n of this.originalNotes)this.noteManager.add(n);this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.hasMoved=!1,this.controller.transitionTo(k.NoteTool)}onExit(){if(!this.hasMoved&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.store.setDragAnchorNoteKey(null),this.requestRedraw()}}function To(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=e.resizes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start);a&&(a.duration=r.newDuration)}return _e(e.sequencerId),t}function Io(i,e){return{type:"RESIZE_NOTES",sequencerId:i,resizes:structuredClone(e)}}function Ro(i,e){const t=e.map(s=>({pitch:s.pitch,start:s.start,newDuration:s.oldDuration}));return{type:"RESIZE_NOTES",sequencerId:i,resizes:t}}class Fo{constructor(e,t,s,n,r,a,o,l,d,c){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=l,this.cursorController=d,this.getSequencerId=c,this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.hasResized=!1,this.hasMoved=!1,this.initialMouseX=0,this.accumulatedDelta=0}onEnter(){const e=this.store.getSelectedNotes();if(this.cursorController.set(U.ResizeHorizontal),!e.length){this.controller.transitionTo(k.NoteTool);return}this.originalNotes=e.map(s=>({...s}));const t=this.store.getHoveredNoteKey();this.anchorNote=t?e.find(s=>`${s.pitch}:${s.start}`===t)??null:e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasResized=!1,this.hasMoved=!1,this.accumulatedDelta=0,this.initialMouseX=this.controller.getLastMouseX(),this.requestRedraw()}onMouseMove(e){if(!this.anchorNote)return;const t=this.grid.getSnapResolution(),n=this.grid.isTripletMode()?t*(2/3):t,r=e.clientX-this.initialMouseX,o=this.config.layout.baseCellWidth*this.config.behavior.zoom*n,l=r/o,d=Math.round(l);if(d===this.accumulatedDelta)return;this.accumulatedDelta=d;const c=d*n,u=this.originalNotes.map(h=>{const f=Math.max(n,h.duration+c);return{...h,duration:f}});this.previewNotes=u,this.store.setPreviewNotes(u),this.hasResized=!0,this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote||!this.hasResized)return;const t=this.originalNotes,n=this.previewNotes.map((a,o)=>({pitch:a.pitch,start:a.start,newDuration:a.duration})),r=t.map((a,o)=>({pitch:a.pitch,start:a.start,oldDuration:a.duration}));T(Io(this.getSequencerId(),n),Ro(this.getSequencerId(),r)),this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onMouseLeave(){this.controller.transitionTo(k.NoteTool)}onExit(){if(!this.hasResized&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.cursorController.set(U.Default),this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.requestRedraw()}}class Oo{constructor(e,t,s,n,r,a,o,l,d,c,u,h){this.canvas=e,this.noteManager=t,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(!this.store.isOnNonGridElement())if(e.button!==0)this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;else{const t=Me(e,this.canvas,this.grid,this.scroll,this.config);if(Ze(t,this.store,this.cursorController,this.requestRedraw)||!t)return;const s=ge(e,this.canvas,this.scroll,this.config),n=Z(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!n)return;const r=this.noteManager.findNoteUnderCursor(n,s),a=this.noteManager.findNoteEdgeAtCursor(n,s);if(a&&r&&`${r.pitch}:${r.start}`==`${a.pitch}:${a.start}`){this.store.setSelectedNotes([a]),this.controller.transitionTo(k.Sizing);return}if(r){this.noteManager.previewNote(r.pitch,.25),this.store.setSelectedNotes([r]),this.store.suppressNextMouseUpEvent(),this.controller.transitionTo(k.SelectedIdle);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;const o=this.grid.getNoteDuration();if(this.noteManager.findAtPosition(n,t.x))return;const d={start:t.x,duration:o,pitch:n,velocity:100};T(Lt(this.getSequencerId(),[d]),kt(this.getSequencerId(),[d])),this.noteManager.previewNote(n,o),this.playNoteAnimation(d)}}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(e.buttons===1&&this.store.isDraggingToSelect()){const c=this.store.getHoveredNoteKey();if(c&&n>=this.dragThreshold){const[u,h]=c.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(k.Sizing);return}}}if(e.buttons===2&&this.store.isDraggingToSelect()){const c=e.clientX-this.initialMouseX,u=e.clientY-this.initialMouseY;if(Math.sqrt(c*c+u*u)>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}}const r=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!r||Ze(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=Z(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=ge(e,this.canvas,this.scroll,this.config),l=this.noteManager.findNoteUnderCursor(a,o),d=this.noteManager.findNoteEdgeAtCursor(a,o);if(l){const c=`${l.pitch}:${l.start}`;this.store.setHoveredNoteKey(c),this.store.setSnappedCursorGridPosition(null),d===l?this.cursorController.set(U.ResizeHorizontal):this.cursorController.set(U.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set(U.Default);this.requestRedraw()}onMouseUp(e){this.store.endSelectionDrag()}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(T(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting)}}onEnter(){F("ExpressNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}class Uo{constructor(e,t,s,n,r,a,o,l,d,c,u,h){this.canvas=e,this.config=t,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=d,this.cursorController=c,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){var e;if(window&&((e=window.event)==null?void 0:e.buttons)&1){this.store.beginSelectionDrag();const t=window.event;this.initialMouseX=t.clientX,this.initialMouseY=t.clientY}}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(this.store.isOnNonGridElement())return;const t=e.button===0,s=e.button===2,n=Me(e,this.canvas,this.grid,this.scroll,this.config);if(!n){s&&this.beginSelectionDrag(e);return}const r=Z(n.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!r){s&&this.beginSelectionDrag(e);return}const a=ge(e,this.canvas,this.scroll,this.config),o=this.noteManager.findNoteUnderCursor(r,a);if(t){const l=this.noteManager.findNoteEdgeAtCursor(r,a);if(l){const d=`${l.pitch}:${l.start}`;new Set(this.store.getSelectedNotes().map(u=>`${u.pitch}:${u.start}`)).has(d)||this.store.setSelectedNotes([l]),this.controller.transitionTo(k.Sizing);return}o&&(this.beginSelectionDrag(e),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY)}if(s)if(o){const l=`${o.pitch}:${o.start}`;this.store.setHoveredNoteKey(l)}else this.store.setHoveredNoteKey(null),this.beginSelectionDrag(e)}beginSelectionDrag(e){this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()&&e.buttons&1){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),g=parseFloat(b),p=this.noteManager.findAtPosition(y,g);if(!p)return;this.store.getSelectedNotes().some(_=>_.pitch===p.pitch&&_.start===p.start)||this.store.setSelectedNotes([p]),this.store.setDragAnchorNoteKey(`${p.pitch}:${p.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(k.Dragging);return}}else if(this.store.isDraggingToSelect()&&e.buttons&2&&!this.store.getHoveredNoteKey()&&n>=this.dragThreshold){!e.metaKey&&!e.shiftKey&&!e.ctrlKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(k.Selecting);return}const r=rt(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),l=nt(r,this.scroll,this.config,a,o);if(!l){this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default),this.requestRedraw();return}const d=ge(e,this.canvas,this.scroll,this.config),c=Z(l.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(c,d),h=this.noteManager.findNoteEdgeAtCursor(c,d);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(U.ResizeHorizontal):this.cursorController.set(U.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(U.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement()||this.store.consumeSuppressMouseUpFlag())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const s=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),r=n.some(l=>`${l.pitch}:${l.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const l=n.filter(d=>`${d.pitch}:${d.start}`!==s);this.store.setSelectedNotes(l)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(k.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(k.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),l=o.some(d=>d.pitch===a.pitch&&d.start===a.start);o.length>0&&l?T(ae(this.getSequencerId(),o),oe(this.getSequencerId(),o)):T(ae(this.getSequencerId(),[a]),oe(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),T(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(k.Pasting);return}if(e.key==="Delete"){if(!t.length)return;T(ae(this.getSequencerId(),t),oe(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(k.NoteTool)}}}class Po{constructor(e){this.data=e,this.mode=k.NoteTool,this.activeHandler=null,this.lastMouseX=0,this.lastMouseY=0,this.transitionTo(k.NoteTool)}handleMouseDown(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseDown)==null||s.call(t,e)}handleMouseMove(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseMove)==null||s.call(t,e)}handleMouseUp(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseUp)==null||s.call(t,e)}handleContextMenu(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onContextMenu)==null||s.call(t,e)}handleMouseLeave(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onMouseLeave)==null||t.call(e)}handleMouseEnter(e){var t,s;(s=(t=this.activeHandler)==null?void 0:t.onMouseEnter)==null||s.call(t,e)}handleKeyDown(e){var t,s;(s=(t=this.activeHandler)==null?void 0:t.onKeyDown)==null||s.call(t,e)}transitionTo(e){var t,s,n,r;F(`Transitioning to mode: ${k[e]} from ${k[this.mode]}`),(s=(t=this.activeHandler)==null?void 0:t.onExit)==null||s.call(t),this.mode=e,this.activeHandler=this.createHandlerForMode(e),(r=(n=this.activeHandler)==null?void 0:n.onEnter)==null||r.call(n)}reset(){this.transitionTo(k.NoteTool)}createHandlerForMode(e){const t={transitionTo:s=>this.transitionTo(s),getLastMouseX:()=>this.lastMouseX,getLastMouseY:()=>this.lastMouseY};switch(e){case k.NoteTool:{const{global:{noteToolMode:s}}=z(),n=s==="express"?Oo:wo,r=[this.data.canvas,this.data.noteManager,this.data.scroll,this.data.config,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard,this.data.playNoteAnimation];return new n(...r)}case k.Selecting:return new Mo(this.data.canvas,this.data.config,this.data.scroll,this.data.grid,this.data.store,t,this.data.noteManager,this.data.requestRedraw);case k.SelectedIdle:{const{global:{noteToolMode:s}}=z(),n=s==="express"?Uo:xo,r=[this.data.canvas,this.data.config,this.data.scroll,this.data.noteManager,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.setClipboard,this.data.getClipboard];return new n(...r)}case k.Pasting:return new ko(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard);case k.Dragging:return new Ao(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());case k.Sizing:return new Fo(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());default:return{}}}destroy(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onExit)==null||t.call(e),this.activeHandler=null}}class Do{constructor(e){this.current=U.Default,this.canvas=e}set(e){this.current!==e&&(this.canvas.style.cursor=e,this.current=e)}reset(){this.set(U.Default)}}class qo{constructor(e,t){this.context=e,this.canvas=t,this.onMouseMove=s=>{this.context.handleMouseMove(s)},this.onMouseDown=s=>{this.context.handleMouseDown(s)},this.onMouseUp=s=>{this.context.handleMouseUp(s)},this.onMouseLeave=()=>{this.context.handleMouseLeave()},this.onMouseEnter=s=>{var n,r;(r=(n=this.context).handleMouseEnter)==null||r.call(n,s)},this.onContextMenu=s=>{this.context.handleContextMenu(s)},this.onKeyDown=s=>{this.context.handleKeyDown(s)},this.attachListeners(),this.canvas.style.pointerEvents="auto"}attachListeners(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("contextmenu",this.onContextMenu),window.addEventListener("keydown",this.onKeyDown)}destroy(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("keydown",this.onKeyDown)}}class Ko{constructor(e,t,s){this.canvas=e,this.scroll=t,this.requestRedraw=s,this.SCROLL_SPEED_X=1,this.SCROLL_SPEED_Y=1,this.onWheel=n=>{n.preventDefault();const r=n.shiftKey||Math.abs(n.deltaX)>Math.abs(n.deltaY),a=n.deltaX||n.deltaY;if(r){const o=this.scroll.getX()+a*this.SCROLL_SPEED_X;this.scroll.setScroll(o,this.scroll.getY())}else{const o=this.scroll.getY()+n.deltaY*this.SCROLL_SPEED_Y;this.scroll.setScroll(this.scroll.getX(),o)}this.requestRedraw()},this.attachListeners()}attachListeners(){this.canvas.addEventListener("wheel",this.onWheel,{passive:!1})}destroy(){this.canvas.removeEventListener("wheel",this.onWheel)}}class Ho{constructor(){this.snappedCursorGridPosition=null,this.previewNotes=[],this.hoveredNoteKey=null,this.marqueeBox=null,this.highlightedNoteKeys=new Set,this.suppressNextMouseUp=!1,this.selectedNotes=[],this.dragAnchorNoteKey=null,this.isOnScrollbar=!1,this.isScrolling=!1,this.isInitiatingSelectionDrag=!1,this.isDraggingNotes=!1,this.lastDeletionTime=0}setSnappedCursorGridPosition(e){this.snappedCursorGridPosition=e}getSnappedCursorGridPosition(){return this.snappedCursorGridPosition}setPreviewNotes(e){this.previewNotes=e}getPreviewNotes(){return this.previewNotes}clearPreviewNotes(){this.previewNotes=[]}setHoveredNoteKey(e){this.hoveredNoteKey=e}getHoveredNoteKey(){return this.hoveredNoteKey}setMarqueeBox(e){this.marqueeBox=e}getMarqueeBox(){return this.marqueeBox}hasMarquee(){return this.marqueeBox!==null}setHighlightedNotes(e){this.highlightedNoteKeys=new Set(e.map(t=>`${t.pitch}:${t.start}`))}clearHighlightedNotes(){this.highlightedNoteKeys.clear()}isNoteHighlighted(e){return this.highlightedNoteKeys.has(`${e.pitch}:${e.start}`)}suppressNextMouseUpEvent(){this.suppressNextMouseUp=!0}consumeSuppressMouseUpFlag(){const e=this.suppressNextMouseUp;return this.suppressNextMouseUp=!1,e}getSelectedNotes(){return this.selectedNotes}setSelectedNotes(e){this.selectedNotes=e}clearSelection(){this.selectedNotes=[]}hasSelection(){return this.selectedNotes.length>0}setDragAnchorNoteKey(e){this.dragAnchorNoteKey=e}getDragAnchorNoteKey(){return this.dragAnchorNoteKey}setIsOnScrollbar(e){this.isOnScrollbar=e}getIsOnScrollbar(){return this.isOnScrollbar}setIsScrolling(e){this.isScrolling=e}isOnNonGridElement(){return this.isOnScrollbar||this.isScrolling}beginSelectionDrag(){this.isInitiatingSelectionDrag=!0}endSelectionDrag(){this.isInitiatingSelectionDrag=!1}isDraggingToSelect(){return this.isInitiatingSelectionDrag}setIsDraggingNotes(e){this.isDraggingNotes=e}getIsDraggingNotes(){return this.isDraggingNotes}isActivelyDragging(){return this.isDraggingNotes||this.isInitiatingSelectionDrag}setLastDeletionTime(){this.lastDeletionTime=performance.now()}getLastDeletionTime(){return this.lastDeletionTime}}class zo{constructor(e){this.container=this.createContainer(),e.appendChild(this.container),this.gridCanvas=this.createCanvas("gridCanvas"),this.noteCanvas=this.createCanvas("noteCanvas"),this.animationCanvas=this.createCanvas("animationCanvas"),this.playheadCanvas=this.createCanvas("playheadCanvas"),this.aipreviewCanvas=this.createCanvas("aipreviewCanvas"),this.aiAnimationCanvas=this.createCanvas("aiAnimationCanvas"),this.container.appendChild(this.gridCanvas),this.container.appendChild(this.noteCanvas),this.container.appendChild(this.animationCanvas),this.container.appendChild(this.playheadCanvas),this.container.appendChild(this.aipreviewCanvas),this.container.appendChild(this.aiAnimationCanvas),this.gridCtx=this.getCtx(this.gridCanvas),this.noteCtx=this.getCtx(this.noteCanvas),this.animationCtx=this.getCtx(this.animationCanvas),this.playheadCtx=this.getCtx(this.playheadCanvas),this.aipreviewCtx=this.getCtx(this.aipreviewCanvas),this.aiAnimationCtx=this.getCtx(this.aiAnimationCanvas),this.injectContainerStyles(),this.injectCanvasStyles()}createContainer(){const e=document.createElement("div");return e.id="grid-container",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="#222",e.style.border="1px solid #333",e.style.overflow="hidden",e.style.boxShadow="0 0 20px rgba(0,0,0,0.4)",e.style.borderRadius="6px",e}createCanvas(e){const t=document.createElement("canvas");return t.id=e,t.style.display="block",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t}getCtx(e){const t=e.getContext("2d");if(!t)throw new Error(`2D context not available for canvas with id: ${e.id}`);return t}injectContainerStyles(){const e=document.createElement("style");e.textContent=`
        #grid-container canvas {
          z-index: 0;
        }
        #grid-container canvas#noteCanvas {
          z-index: 1;
        }
        #grid-container canvas#aipreviewCanvas {
          z-index: 2;
        }
        #grid-container canvas#aiAnimationCanvas {
          z-index: 3;
        }
        #grid-container canvas#animationCanvas {
          z-index: 4;
        }
        #grid-container canvas#playheadCanvas {
          z-index: 5;
        }
      `,document.head.appendChild(e)}injectCanvasStyles(){}}class $o{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,headerHeight:s,labelWidth:n},totalMeasures:r,beatsPerMeasure:a,behavior:{zoom:o}}=this.config,{gridColorScheme:l}=z().theme,d=bi[l],c=t*o,u=this.scroll.getX(),h=e.canvas.offsetWidth;e.save(),e.translate(n-u,0);const f=e.createLinearGradient(0,0,0,s);f.addColorStop(0,d.labelWhite),f.addColorStop(1,d.labelBlack),e.fillStyle=f,e.fillRect(-n+u,0,h,s);for(let y=0;y<=r;y++){const g=y*a*c,p=y%4===0;e.strokeStyle=p?d.measureLine:d.beatLine,e.lineWidth=p?2:1,e.beginPath(),e.moveTo(g,0),e.lineTo(g,s),e.stroke(),e.textAlign="center",e.textBaseline="top",e.fillStyle=p?d.textWhite:d.textBlack,e.font=`${p?"bold":""} ${Math.floor(s*.5)}px 'Inter', sans-serif`;const v=g+a*c/2;e.fillText(`${y+1}`,v,4)}e.restore()}}class Jo{constructor(e,t,s,n){this.scroll=e,this.config=t,this.getCustomLabels=s,this.getBlackKeyMap=n;const{lowestMidi:r,highestMidi:a}=t.layout;this.blackKeyMap=Ds(r,a)}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,headerHeight:n,labelWidth:r,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=this.config,{gridColorScheme:d}=z().theme,c=bi[d],u=a-o+1,h=this.scroll.getY(),y=t*l/s,b=e.canvas.offsetHeight??u*y+n;e.save(),e.translate(0,-h);const g=e.createLinearGradient(0,0,0,b);g.addColorStop(0,c.labelWhite),g.addColorStop(1,c.labelBlack),e.fillStyle=g,e.fillRect(0,h,r,b),e.font=`${Math.floor(y*.6)}px 'Inter', sans-serif`,e.textAlign="right",e.textBaseline="middle",e.strokeStyle=c.gridLine,e.lineWidth=1,e.beginPath(),e.moveTo(r-.5,h),e.lineTo(r-.5,h+b),e.stroke();const p=this.getCustomLabels();for(let v=0;v<u;v++){const S=v*y+n,_=a-v,C=(p==null?void 0:p[_])??Z(v,o,a),N=this.getBlackKeyMap().get(_)??!1;e.fillStyle=N?c.textBlack:c.textWhite,e.fillText(C,r-8,S+y/2)}e.restore()}}class Wo{constructor(e,t,s){this.scroll=e,this.config=t,this.interactionStore=s}draw(e){const t=this.interactionStore.getMarqueeBox();if(!t)return;const{layout:{baseCellWidth:s,verticalCellRatio:n},behavior:{zoom:r}}=this.config,a=this.scroll.getX(),o=this.scroll.getY(),l=Math.min(t.startX,t.currentX),d=Math.min(t.startY,t.currentY),c=Math.abs(t.currentX-t.startX),u=Math.abs(t.currentY-t.startY);c<1||u<1||(e.save(),e.translate(this.config.layout.labelWidth-a,this.config.layout.headerHeight-o),e.strokeStyle="rgba(128, 90, 213, 1.0)",e.lineWidth=2,e.setLineDash([5,5]),Re(e,l,d,c,u,3),e.stroke(),e.restore())}}const at={cellWidth:40,cellHeight:20,visibleNotes:36,noteRange:["C1","B9"],currentDuration:1,snapResolution:1,isTripletMode:!1,loopEnabled:!1,useEqualTemperament:!0};let lr={notes:[],anchorBeat:0,anchorMidi:0};function jo(i){if(i.length===0)return;const e=i[0],t=e.start,s=W(e.pitch)??0;lr={notes:i.map(n=>({pitch:n.pitch,start:n.start,duration:n.duration,velocity:n.velocity??100})),anchorBeat:t,anchorMidi:s}}function Xo(){return lr}class Vo{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t)}off(e,t){var s;(s=this.listeners[e])==null||s.delete(t)}emit(e,t){var s;(s=this.listeners[e])==null||s.forEach(n=>n(t))}clear(e){var t;(t=this.listeners[e])==null||t.clear()}removeAllListeners(){var e;for(const t in this.listeners)(e=this.listeners[t])==null||e.clear()}}class Yo{constructor(e,t={},s){this.sequencerConfig=at,this.needsRedraw=!0,this.customLabels=null,this.blackKeyMap=new Map,this.isDestroyed=!1,this.onWindowResize=()=>this.resize(),this.config=Ya(Va(),t),this.sequencerContext=s,this.recalculateLabelAndHeader(),this.gridManager=new zo(e);const{gridCanvas:n,noteCanvas:r,animationCanvas:a,playheadCanvas:o,aipreviewCanvas:l,aiAnimationCanvas:d}=this.gridManager;this.gridCanvasManager=new Le(n),this.noteCanvasManager=new Le(r),this.animationCanvasManager=new Le(a),this.playheadCanvasManager=new Le(o),this.aipreviewCanvasManager=new Le(l),this.aiAnimationCanvasManager=new Le(d);const c=this.gridManager.container;this.noteManager=new so(this.config,this.sequencerContext.playNote),this.interactionStore=new Ho,this.emitter=new Vo,this.scroll=new to(c,this.config),this.scrollbars=new So(c,this.scroll,this.config,this.interactionStore,()=>this.requestRedraw()),this.wheelHandler=new Ko(c,this.scroll,()=>this.requestRedraw()),this.cursorController=new Do(c);const u={canvas:r,noteManager:this.noteManager,scroll:this.scroll,config:this.config,store:this.interactionStore,grid:this,addNote:h=>this.noteManager.add(h),requestRedraw:()=>this.requestRedraw(),sequencerContext:s,cursorController:this.cursorController,setClipboard:jo,getClipboard:Xo,playNoteAnimation:h=>this.playNoteAnimation(h)};this.interactionContext=new Po(u),this.inputTracker=new qo(this.interactionContext,c),this.gridRenderer=new Za(this.scroll,this.config,this.interactionStore,()=>this.getBlackKeyMap(),()=>wt()),this.noteRenderer=new ho(this.scroll,this.config,this.noteManager,this.interactionStore,this.sequencerContext.getId()),this.notePreviewRenderer=new fo(this.scroll,this.config,this.interactionStore,()=>this.getNoteDuration()),this.animationRenderer=new go(this.scroll,this.config),this.headerRenderer=new $o(this.scroll,this.config),this.labelRenderer=new Jo(this.scroll,this.config,()=>this.customLabels,()=>this.getBlackKeyMap()),this.playheadRenderer=new bo(this.scroll,this.config),this.marqueeRenderer=new Wo(this.scroll,this.config,this.interactionStore),this.aiAutocompletePreviewRenderer=new yo(this.scroll,this.config),this.aiAnimationRenderer=new _o(this.scroll,this.config,this.aiAnimationCanvasManager.getContext()),this.initialZoom=this.zoom,this.customLabels=null,requestAnimationFrame(()=>this.resize()),this.playheadRenderer.setPlayheadX(0),this.attachListeners(),this.renderLoop()}attachListeners(){window.addEventListener("resize",this.onWindowResize)}detachListeners(){window.removeEventListener("resize",this.onWindowResize)}renderLoop(){this.isDestroyed||(this.needsRedraw&&(this.render(),this.needsRedraw=!1),requestAnimationFrame(()=>this.renderLoop()))}recalculateLabelAndHeader(){const{baseCellWidth:e,verticalCellRatio:t,labelWidthColumns:s,headerHeightRows:n}=this.config.layout,r=this.zoom,a=e*r,o=a/t;this.config.layout.labelWidth=s*a,this.config.layout.headerHeight=n*o}get zoom(){return this.config.behavior.zoom}set zoom(e){this.config.behavior.zoom=e}get notes(){const e=this.noteManager.getAll();return e||[]}render(){this.gridCanvasManager.clear(),this.noteCanvasManager.clear(),this.animationCanvasManager.clear(),this.playheadCanvasManager.clear(),this.aipreviewCanvasManager.clear();const e=this.gridCanvasManager.getContext(),t=this.noteCanvasManager.getContext(),s=this.animationCanvasManager.getContext(),n=this.playheadCanvasManager.getContext(),r=this.aipreviewCanvasManager.getContext();this.gridRenderer.draw(e),this.noteRenderer.draw(t),this.notePreviewRenderer.draw(t),this.animationRenderer.draw(s),this.labelRenderer.draw(e),this.headerRenderer.draw(e),this.playheadRenderer.draw(n),this.aiAutocompletePreviewRenderer.draw(r),this.interactionStore.hasMarquee()&&this.marqueeRenderer.draw(s),this.scrollbars.update()}requestRedraw(){this.needsRedraw=!0}resize(){this.gridCanvasManager.resize(),this.noteCanvasManager.resize(),this.animationCanvasManager.resize(),this.playheadCanvasManager.resize(),this.aipreviewCanvasManager.resize(),this.aiAnimationCanvasManager.resize(),this.scroll.recalculateBounds(),this.scrollbars.update(),this.requestRedraw()}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}setPlayheadPixelX(e){this.playheadRenderer.setPlayheadX(e),this.requestRedraw()}getPixelsPerBeat(){return this.config.layout.baseCellWidth*this.config.behavior.zoom}setNotes(e){this.noteManager.set(e),this.requestRedraw()}playNoteAnimation(e){this.animationRenderer.playNote(e)}invalidateAIAutocompleteRenderer(){this.aiAnimationRenderer.invalidate()}startAIAutocompleteAnimationLoop(){this.aiAnimationRenderer.start()}stopAIAutocompleteAnimationLoop(){this.aiAnimationRenderer.stop()}setActiveAutocompleteBar(e){this.aiAnimationRenderer.setActiveAutocompleteBar(e),requestAnimationFrame(this.aiAnimationRenderer.renderFrame)}playNoteAcceptanceAnimation(e){this.aiAnimationRenderer.playNoteAcceptance(e)}getTrackedNotes(){return this.noteManager.getTrackedNotes(this.interactionStore)}scrollTo(e,t){this.scroll.setScroll(e,t),this.scrollbars.update(),this.requestRedraw()}setZoom(e){this.zoom=e,this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.requestRedraw()}getZoom(){return this.zoom}resetZoom(){this.setZoom(this.initialZoom)}zoomIn(){this.setZoom(Math.min(this.config.behavior.maxZoom,this.zoom+.1))}zoomOut(){this.setZoom(Math.max(this.config.behavior.minZoom,this.zoom-.1))}setCustomLabels(e){this.customLabels=e,this.requestRedraw()}getMeasures(){return this.config.totalMeasures}setMeasures(e){this.config.totalMeasures=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getBeatsPerMeasure(){return this.config.beatsPerMeasure}setBeatsPerMeasure(e){this.config.beatsPerMeasure=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getTotalBeats(){return this.config.totalMeasures*this.config.beatsPerMeasure}setNoteRange(e,t){this.config.layout.lowestMidi=e,this.config.layout.highestMidi=t,this.blackKeyMap=Ds(e,t),this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.resize(),this.requestRedraw()}refreshNoteRange(){this.setNoteRange(this.config.layout.lowestMidi,this.config.layout.highestMidi)}getBlackKeyMap(){return this.blackKeyMap}isTripletMode(){return oi()}getNoteDuration(){return this.sequencerConfig.currentDuration}getSnapResolution(){return At()}getInteractionStore(){return this.interactionStore}getNoteManager(){return this.noteManager}getInteractionContext(){return this.interactionContext}emit(e,t){this.emitter.emit(e,t)}destroy(){this.inputTracker.destroy(),this.wheelHandler.destroy(),this.scrollbars.destroy(),this.aiAnimationRenderer.stop(),this.gridManager.container.remove(),this.gridCanvasManager.destroy(),this.noteCanvasManager.destroy(),this.animationCanvasManager.destroy(),this.playheadCanvasManager.destroy(),this.aipreviewCanvasManager.destroy(),this.aiAnimationCanvasManager.destroy(),this.detachListeners(),this.emitter.removeAllListeners(),this.interactionContext.destroy(),this.isDestroyed=!0}}function Zo(i,e,t){return new Yo(i,e,t)}function cr({instrument:i,midi:e,time:t,duration:s,velocity:n}){var a;const r=((a=i.__midiMap)==null?void 0:a.get(e))??e;if(!(i!=null&&i.start)){console.warn("[startInstrumentNote] Instrument missing start() method");return}try{i.start({note:r,time:t,duration:s,velocity:n})}catch(o){console.warn("[startInstrumentNote] Failed to start instrument note",{midi:e,resolved:r,err:o})}}function Ci(i,e){var t;(t=i==null?void 0:i.stop)==null||t.call(i);for(const s of e)clearTimeout(s);e.length=0}async function Qo(i,e,t,s,n,r,a,o=0){if(!n)return;if(i||await e(),Ci(i,r),!(i!=null&&i.start)){console.warn("[playback] Instrument does not support scheduled playback.");return}const d=60/me(),c=performance.now();t.sort((h,f)=>h.start-f.start);let u=0;for(;u<t.length&&t[u].start<o;)u++;for(;u<t.length;u++){const h=t[u],f=$(h.pitch);if(f==null)continue;const y=h.start-o,b=a+y*d,g=h.duration*d,p=h.velocity??100;if(cr({instrument:i,midi:f,time:b,duration:g,velocity:p}),!s){const v=c+y*d*1e3,S=Math.max(0,v-performance.now()),_=setTimeout(()=>{n==null||n.playNoteAnimation(h)},S);r.push(_)}}}function el(i,e,t,s,n,r){if(!s||n)return;const o=60/me();performance.now();const c=(X().currentTime-e)/o,u=t+c;for(const h of i){if(h.start<u)continue;const y=(h.start-u)*o*1e3;if(y>=0){const b=setTimeout(()=>{s==null||s.playNoteAnimation(h)},y);r.push(b)}}}async function tl(i,e,t,s,n,r,a,o,l,d=0){if(!s||(Ci(i,o),i||await e(),r||!a||!(i!=null&&i.start)))return;const u=60/me(),h=performance.now(),f=X().currentTime,y=t.filter(b=>b.start>=d);for(const b of y){const g=$(b.pitch);if(g==null)continue;const p=b.start-d,v=l+p*u;if(v<=f+.01)continue;const S=b.duration*u,_=b.velocity??100;if(cr({instrument:i,midi:g,time:v,duration:S,velocity:_}),!n){const C=h+p*u*1e3,N=Math.max(0,C-performance.now()),w=setTimeout(()=>{s==null||s.playNoteAnimation(b)},N);o.push(w)}}}class dr{constructor(e,t,s=X(),n=Ee(),r="sf2/fluidr3-gm/acoustic_grand_piano",a=!1,o=0){if(this.colorIndex=0,this.id=0,this.mute=!1,this.solo=!1,this.collapsed=!1,this.miniContour=null,this.body=null,this.collapseIcon=null,this._scheduledAnimations=[],this._volume=100/127,this._pan=0,this._instrument=null,this.id=o,this.container=e,this.config={...t},this.context=s,this.destination=n,this.instrumentName=r,this.squelchLoadingScreen=a,this.container){const l=this.container.querySelector(".sequencer-body");this.matrix=Zo(l,{},{playNote:this.playNote.bind(this),getId:()=>this.id}),this.matrix.refreshNoteRange()}}async initInstrument(){try{this._instrument=await rr(this.instrumentName,this.context,this.destination,this._volume,this._pan,!1,!1),this.updateToDrumNoteRange()}catch(e){console.warn(`[SEQ:${this.id}] Failed to load instrument '${this.instrumentName}':`,e)}}setInstrument(e){this.instrumentName=e,this.updateTrackLabel(),this.initInstrument()}updateTrackLabel(){var t;const e=(t=this.container)==null?void 0:t.querySelector(".track-name");e&&(e.textContent=`${this.id+1}: ${this.instrumentName}`)}get notes(){var e;return((e=this.matrix)==null?void 0:e.notes)??[]}get volume(){return this._volume}set volume(e){var t;this._volume=Math.max(0,Math.min(1,e)),(t=this._instrument)!=null&&t.setVolume&&this._instrument.setVolume(this._volume)}get pan(){return this._pan}set pan(e){var t;this._pan=Math.max(-1,Math.min(1,e)),(t=this._instrument)!=null&&t.setPan&&this._instrument.setPan(this._pan)}get shouldPlay(){return oc()?this.solo:!this.mute}get scheduledAnimations(){return this._scheduledAnimations}set scheduledAnimations(e){this._scheduledAnimations=e}toggleMute(){const e=H.getInstance();this.mute=!this.mute,this.mute&&(this.solo=!1),this.stopScheduledNotes(),Ui(this),e.isActive()&&Ji()}toggleSolo(){const e=H.getInstance();this.solo=!this.solo,this.solo&&(this.mute=!1),Ui(this),e.isActive()&&Ji()}setCollapsed(e){this.collapsed=e}resetInteractionMode(){var e;(e=this.matrix)==null||e.getInteractionContext().reset()}async preparePlayback(e,t=0){var s;await Qo(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.collapsed,this.matrix??null,this._scheduledAnimations,e,t)}stopScheduledNotes(){Ci(this._instrument,this._scheduledAnimations)}resumeAnimationsFromCurrentTime(e,t){var s;el(((s=this.matrix)==null?void 0:s.notes)??[],e,t,this.matrix??null,this.collapsed,this._scheduledAnimations)}async reschedulePlayback(e,t=0){var s;await tl(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.matrix??null,this.collapsed,this.mute,this.shouldPlay,this._scheduledAnimations,e,t)}async exportToOffline(e,t){var n;const s=t??((n=this.matrix)==null?void 0:n.notes);!s||s.length===0||await Ha(this.instrumentName,this.context,this.destination,s,this._volume,this._pan,e)}playNote(e,t,s=100,n=!1){return pa(this.instrumentName,e,t,s,n,null,xe(),this.destination,this.volume,this.pan)}updateTotalMeasures(){this.matrix&&this.matrix.setMeasures(Gi())}updateBeatsPerMeasure(){this.matrix&&this.matrix.setBeatsPerMeasure(Fe())}redraw(){var e;(e=this.matrix)==null||e.requestRedraw()}getState(){return this.matrix?{notes:[...this.matrix.notes],config:{...this.config},instrument:this.instrumentName}:{notes:[],config:this.config,instrument:this.instrumentName}}setState({notes:e,config:t,instrument:s,volume:n,pan:r,collapsed:a}){this.matrix&&(this.matrix.setNotes(e),Object.assign(this.config,t),typeof n=="number"&&(this.volume=n),typeof r=="number"&&(this.pan=r),bt(this,a),s&&(this.instrumentName=s),this.redraw())}updateNotesFromTrackMap(e){this.matrix&&this.matrix.notes.splice(0,this.matrix.notes.length,...e.n.map(([t,s,n,r=100])=>({pitch:t,start:s,duration:n,velocity:r})))}updateNoteRange(e){ri({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var t;return((t=this.matrix)==null?void 0:t.notes)??[]}},e)}updateToDrumNoteRange(){za({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var e;return((e=this.matrix)==null?void 0:e.notes)??[]}})}destroy(){var e,t;this.stopScheduledNotes(),(e=this.matrix)==null||e.destroy(),(t=this.container)==null||t.remove(),nc(this.id),H.getInstance().removeSequencer(this),this._instrument=null,this.matrix=void 0,this.container=null,this.refreshPanUI=void 0,this.refreshVolumeUI=void 0}}function il(i,e){const t=structuredClone(i);t.sequencers=t.sequencers.filter(n=>n.id!==e.id);const s=nr(e.id);return s?s.destroy():console.warn(`DELETE_SEQUENCER: No controller found for id ${e.id}`),_e(null),t}function ur(i,e,t=[],s,n,r){return{type:"DELETE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:s,pan:n,collapsed:r}}function hr(i,e,t=[],s,n,r){return{type:"CREATE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:s,pan:n,collapsed:r}}function sl(i,e,t){const s={id:t,...at},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",r=new dr(i,s,X(),Ee(),n,!0,t);r.id=t,r.colorIndex=t,r.mute=!1,r.solo=!1,r.volume=100/127,e.notes&&r.matrix&&r.matrix.setNotes(e.notes),e&&r.setState({notes:e.notes,config:{},instrument:e.instrument,volume:e.volume,pan:e.pan,collapsed:e.collapsed});const a=i.querySelector("canvas.mini-contour");return r.miniContour=a,Mt(a,r.notes,r.config,r.colorIndex),r.updateTrackLabel(),r.initInstrument(),rc(r.id,r),H.getInstance().addSequencer(r),{seq:r}}function rl(){var i,e;for(const t of K().slice())T(ur(t.id,t.instrumentName,((i=t.matrix)==null?void 0:i.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed),hr(t.id,t.instrumentName,((e=t.matrix)==null?void 0:e.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed));ac(),$a(),H.getInstance().clearSequencers()}function A(i,e){return m("img",{src:ie(`static/svg/${i}.svg`),class:"w-6 h-6",alt:e})}function nl(){const i=O(),e=m("div",{class:`sequencer-header flex justify-between items-center ${i.textColor}`}),t=m("canvas",{class:"mini-contour w-full h-10 mb-2 bg-gray-800 rounded hidden"}),s=m("div",{class:`sequencer-body flex pt-2 h-[720px] border-t ${i.borderColor}`}),n=m("div",{class:"grip-handle group flex justify-center items-center h-6 cursor-grab hover:bg-gray-800 rounded"},A("icon-grip","Drag Track"));return{element:m("div",{class:`sequencer flex flex-col space-y-2 p-4 rounded ${i.surfaceBackground}`},e,t,s,n),topBarContainer:e,miniContourCanvas:t,matrixContainer:s,gripHandleContainer:n}}function al(){const i=O(),e=m("div",{class:"sequencer-left-group-wrapper flex items-center gap-2"}),t=m("div",{class:"sequencer-volume-wrapper"}),s=m("div",{class:"sequencer-pan-wrapper"}),n=m("div",{class:"sequencer-zoom-wrapper flex items-center gap-2"}),r=m("div",{class:"sequencer-right-controls-wrapper flex items-center gap-2"}),a=m("div",{class:"sequencer-right-group-container flex items-center gap-3"},t,s,n,r);return{element:m("div",{class:`sequencer-header flex justify-between items-center w-full px-2 ${i.textColor}`},e,a),leftGroup:e,volumeWrapper:t,panWrapper:s,zoomWrapper:n,rightControlsWrapper:r}}function ol(){const i=O(),e=m("button",{class:["instrument-select-btn","side-button-primary","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonPrimaryColor,i.buttonPrimaryColorHover,i.textColor].join(" "),title:"Change Instrument"},A("icon-list-instrument","Change Instrument")),t=m("span",{class:`track-name font-semibold ${i.textColor}`},"Track");return{button:e,label:t}}function ll(){const i=O(),e=m("div",{class:`volume-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.volumeGradientFrom} ${i.volumeGradientTo}`,style:"width: 60%;"}),t=m("div",{class:`volume-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 78.74%;"}),s=m("div",{class:["volume-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.volumeThumbColor].join(" "),style:"left: calc(60% - 5px);"});return{element:m("div",{class:`volume-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,s),fill:e,snapMarker:t,thumb:s}}function cl(){const i=O(),e=m("div",{class:`pan-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.panGradientFrom} ${i.panGradientTo}`,style:"width: 50%;"}),t=m("div",{class:`pan-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 50%;"}),s=m("div",{class:["pan-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.panThumbColor].join(" "),style:"left: calc(50% - 5px);"});return{element:m("div",{class:`pan-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,s),fill:e,snapMarker:t,thumb:s}}function dl(){const i=O(),e=m("button",{class:["zoom-in-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom In"},A("icon-zoom-in","Zoom In")),t=m("button",{class:["zoom-out-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom Out"},A("icon-zoom-out","Zoom Out")),s=m("button",{class:["zoom-reset-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Reset Zoom"},A("icon-reset","Reset Zoom")),n=m("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`}),r=m("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`});return{element:m("div",{class:"flex items-center gap-2"},n,e,t,s,r),leadingDivider:n,zoomInBtn:e,zoomOutBtn:t,zoomResetBtn:s,trailingDivider:r}}function ul(){const i=O(),e=["side-button-secondary cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor],t=m("button",{class:[...e,"mute-btn"].join(" "),title:"Mute Track"},A("icon-volume-mute","Mute Track")),s=m("button",{class:[...e,"solo-btn"].join(" "),title:"Solo Track"},A("icon-headphones","Solo Track")),n=m("button",{class:[...e,"collapse-btn"].join(" "),title:"Expand/Collapse Track"},A("icon-caret-down","Expand/Collapse")),r=m("button",{class:[...e,"delete-btn hover:bg-red-600"].join(" "),title:"Delete Track"},A("icon-close-circle","Delete Track"));return{element:m("div",{class:"flex items-center gap-2"},t,s,n,r),muteBtn:t,soloBtn:s,collapseBtn:n,deleteBtn:r}}function hl(i,e,t){let s=!1,n=0,r=0;const a=150,o=1e3,l=u=>{s=!0,n=u.clientY,r=e.offsetHeight,i.classList.replace("cursor-grab","cursor-grabbing"),document.body.style.userSelect="none"},d=u=>{if(!s)return;const h=u.clientY-n;let f=r+h;f=Math.max(a,Math.min(o,f)),e.style.height=`${f}px`,t.resize()},c=()=>{s&&(s=!1,i.classList.replace("cursor-grabbing","cursor-grab"),document.body.style.userSelect="")};return i.addEventListener("mousedown",l),window.addEventListener("mousemove",d),window.addEventListener("mouseup",c),{detach:()=>{i.removeEventListener("mousedown",l),window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",c)},refreshUI:()=>{}}}const fl={sm:"text-base",md:"text-lg",lg:"text-xl",xl:"text-2xl"};function pe(i){const e=O();if(typeof i=="string")return m("h2",{class:["text-lg font-semibold mb-4",e.textColor].join(" "),textContent:i});const{text:t,size:s="md",additionalClasses:n=""}=i;return m("h2",{class:[fl[s],"font-semibold mb-4",e.textColor,n].join(" "),textContent:t})}function pl(){const i=pe({text:"Delete Track",size:"lg",additionalClasses:"text-center mb-4"}),e=m("p",{class:"mb-6 text-center text-sm",textContent:"Are you sure you want to delete this track?"}),t=P({id:"delete-confirm",text:"Delete",kind:"tertiary",additionalClasses:"flex-1 py-2"}),s=P({id:"delete-cancel",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2"}),n=m("div",{class:"flex gap-3 w-full"},t,s);return te("delete-confirm-modal",[i,e,n],{sizePreset:"sm"})}function ml(i,e,t){const s=i.querySelector("#delete-confirm"),n=i.querySelector("#delete-cancel"),r=()=>{e(),i.classList.add("hidden")},a=()=>{t(),i.classList.add("hidden")};return s==null||s.addEventListener("click",r),n==null||n.addEventListener("click",a),{detach:()=>{s==null||s.removeEventListener("click",r),n==null||n.removeEventListener("click",a)},refreshUI:()=>{}}}class yl{constructor(){this.detachFn=null,this.modal=pl(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const s=ml(this.modal,e,t);this.detachFn=s.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function we(i){const{id:e,label:t,stateA:s,stateB:n,tooltipTrigger:r,inline:a}=i,o=O(),l=s?m("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:s}):null,d=m("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:n}),c=m("input",{id:e,type:"checkbox",class:"sr-only peer"}),u=m("div",{class:["w-11 h-6 rounded-full peer relative",o.toggleTrackBase,o.toggleTrackChecked,'after:content-[""] after:absolute after:top-[2px] after:left-[2px]',"after:bg-white after:border after:rounded-full","after:h-5 after:w-5 after:transition-all",o.toggleKnobBase,o.toggleKnobChecked,"peer-checked:after:translate-x-full"].join(" ")}),h=()=>{const g=c.checked;l&&(l.style.opacity=g?"0.5":"1"),d.style.opacity=g?"1":"0.5"};c.addEventListener("change",h);const f=[];l&&f.push(l),f.push(m("label",{class:"relative inline-flex items-center cursor-pointer"},c,u)),f.push(d),r&&f.push(r);const y=m("div",{class:"flex items-center gap-3"},...f),b=a?y:m("div",{class:"mb-6"},t?m("label",{class:`block text-sm font-medium mb-2 ${o.textColor}`,textContent:t}):null,y);return requestAnimationFrame(h),{element:b,input:c,setChecked:g=>{c.checked=g,h()},getChecked:()=>c.checked,update:h}}function Y(i,e){const t=O();if(typeof i=="string")return m("label",{class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},i,e??null);const{text:s,for:n,trailingElement:r}=i;return m("label",{...n?{htmlFor:n}:{},class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},s,r??null)}function gl(){const i=O(),e=pe({text:"Select Instrument",size:"xl",additionalClasses:"text-center mb-6 z-10"}),t=(h,f)=>{const y=m("select",{id:h,class:["w-full bg-gray-700 border border-gray-600 rounded px-3 py-2","focus:outline-none focus:border-purple-500 cursor-pointer",i.textColor].join(" ")});return m("div",{class:"mb-4 z-10 w-full"},Y({text:f,for:h}),y)},s=t("instrument-engine-select","Engine"),n=t("instrument-library-select","Instrument Library"),r=t("instrument-select","Instrument"),a=we({id:"instrument-loop-toggle",label:"Loop instrument sound",stateB:"On"}),o=P({id:"instrument-select-confirm",text:"Select",kind:"primary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),l=P({id:"instrument-cancel-btn",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),d=m("div",{class:"flex gap-3 z-10 w-full"},o,l),c=[e,s,n,r,a.element,d];return te("instrument-select-modal",c,{sizePreset:"md"})}function _l(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s&&e.instrument&&(s.instrument=e.instrument),t}function bl(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}function vl(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}async function Sl(i,e){if(e!=null){const t=lt(e);t?(T(bl(t.id,i),vl(t.id,t.instrumentName)),t.setInstrument(i)):console.warn(`Failed to find sequencer with ID ${e}`)}else try{await yi(i),ca(i),window.dispatchEvent(new CustomEvent("global-instrument-selected",{detail:{fullName:i}}))}catch(t){console.error("Failed to load global instrument:",i,t)}}function Cl(){return Object.keys(it)}async function Nl(i=sr){const e=_i[i];if(!e)throw new Error(`Engine "${i}" not available`);return await e.getAvailableLibraries()}async function wl(i,e=sr){const t=_i[e];if(!t)throw new Error(`Engine "${e}" not available`);return await t.getAvailableInstruments(i)}function Ml(i,e){const t=i.querySelector("#instrument-engine-select"),s=i.querySelector("#instrument-library-select"),n=i.querySelector("#instrument-select"),r=i.querySelector("#instrument-loop-toggle"),a=i.querySelector("#instrument-select-confirm"),o=i.querySelector("#instrument-cancel-btn"),{currentInstrument:l}=e;let d=null,c=null,u=null;if(l){const S=l.split("/");d=S[0]||null,c=S[1]||null,u=S[2]||null}const h=()=>{const S=Cl();t&&(t.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,t.appendChild(C)}),d&&S.includes(d)&&(t.value=d))},f=async()=>{if(!t)return;const S=await Nl(t.value);s&&(s.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,s.appendChild(C)}),c&&S.includes(c)?s.value=c:S.length>0&&(s.value=S[0]))},y=async()=>{if(!t||!s)return;const S=await wl(s.value,t.value);n&&(n.innerHTML="",S.forEach(_=>{const C=document.createElement("option");C.value=_,C.textContent=_,n.appendChild(C)}),u&&S.includes(u)&&(n.value=u))},b=async()=>{await f(),await y()},g=()=>{y()},p=async()=>{if(!t||!s||!n||!r)return;const S=`${t.value}/${s.value}/${n.value}`;await Sl(S,e.sequencerId),e.hide()},v=()=>{e.hide()};return(async()=>(h(),await f(),await y()))(),t==null||t.addEventListener("change",b),s==null||s.addEventListener("change",g),a==null||a.addEventListener("click",p),o==null||o.addEventListener("click",v),{detach:()=>{t==null||t.removeEventListener("change",b),s==null||s.removeEventListener("change",g),a==null||a.removeEventListener("click",p),o==null||o.removeEventListener("click",v)},refreshUI:async()=>{h(),await f(),await y()}}}class xl{constructor(){this.detachFn=null,this.modal=gl(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const s=Ml(this.modal,{sequencerId:e,currentInstrument:t,hide:()=>this.hide()});this.detachFn=s.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class Ll{constructor(){this.initialize()}initialize(){this.deleteConfirmModal=new yl,this.instrumentSelectModal=new xl}showInstrumentSelectModal(e,t){this.instrumentSelectModal.show(e,t)}showDeleteConfirmModal(e,t){this.deleteConfirmModal.show(e,t)}destroy(){var e,t;(e=this.deleteConfirmModal)==null||e.destroy(),(t=this.instrumentSelectModal)==null||t.destroy()}reload(){this.destroy(),this.initialize()}}let zt=null;function Gt(){return zt||(zt=new Ll),zt}function kl(i,e){const t=()=>{Gt().showInstrumentSelectModal(e.id,e.instrumentName)};return i.addEventListener("click",t),{detach:()=>{i.removeEventListener("click",t)},refreshUI:()=>{}}}function Gl(i,e){var n;const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.id);if(s&&typeof e.volume=="number"){s.volume=e.volume;const a=K().find(o=>o.id===e.id);a&&(a.volume=e.volume,(n=a.refreshVolumeUI)==null||n.call(a))}return t}function Bl(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function El(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function Al(i,e){const{element:t,fill:s,thumb:n}=i;let r=!1,a=!1,o=!1,l=null;const d=100/127,c=.1;function u(){const p=Math.max(0,Math.min(1,e.volume)),v=t.clientWidth,S=14,_=0,C=v-S,N=p*v,w=Math.max(_,Math.min(C,N-S/2));s.style.width=`${Math.round(p*100)}%`,n.style.left=`${w}px`;const L=Math.round(p/d*100);t.setAttribute("title",`Volume: ${L}%`);const G=p>d;s.classList.toggle("overdrive",G),n.classList.toggle("overdrive",G)}function h(){s.classList.toggle("precise",a),n.classList.toggle("precise",a)}function f(p){const v=t.getBoundingClientRect(),S=p-v.left;let _=Math.max(0,Math.min(1,S/v.width));return!a&&Math.abs(_-d)<c?(_=d,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.volume=_,u(),_}const y=p=>{r=!0,a=p.shiftKey,l=e.volume,h(),f(p.clientX),p.preventDefault()},b=p=>{r&&(a=p.shiftKey,h(),f(p.clientX))},g=p=>{if(!r)return;r=!1;const v=f(p.clientX);l!==null&&v!==l&&T(Bl(e.id,v),El(e.id,l)),l=null,a=!1,o=!1,h(),u()};return t.addEventListener("mousedown",y),window.addEventListener("mousemove",b),window.addEventListener("mouseup",g),{detach:()=>{t.removeEventListener("mousedown",y),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",g)},refreshUI:u}}function Tl(i,e){var n;const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.id);if(s&&typeof e.pan=="number"){s.pan=e.pan;const a=K().find(o=>o.id===e.id);a&&(a.pan=e.pan,(n=a.refreshPanUI)==null||n.call(a))}return t}function Il(i,e){return{type:"SET_PAN",id:i,pan:e}}function Rl(i,e){return{type:"SET_PAN",id:i,pan:e}}function Fl(i,e){const{element:t,fill:s,thumb:n}=i;let r=!1,a=!1,o=!1,l=null;function d(){const b=Math.max(-1,Math.min(1,e.pan)),g=(b+1)/2,p=t.clientWidth,v=14,S=0,_=p-v,C=g*p,N=Math.max(S,Math.min(_,C-v/2));s.style.width=`${Math.round(g*100)}%`,n.style.left=`${N}px`;const w=Math.round(b*100);t.setAttribute("title",`Pan: ${w}%`)}function c(){s.classList.toggle("precise",a),n.classList.toggle("precise",a)}function u(b){const g=t.getBoundingClientRect(),p=b-g.left;let S=Math.max(0,Math.min(1,p/g.width))*2-1;const _=0;return!a&&Math.abs(S-_)<.05?(S=_,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.pan=S,d(),S}const h=b=>{r=!0,a=b.shiftKey,l=e.pan,c(),u(b.clientX),b.preventDefault()},f=b=>{r&&(a=b.shiftKey,c(),u(b.clientX))},y=b=>{if(!r)return;r=!1;const g=u(b.clientX);l!==null&&g!==l&&T(Il(e.id,g),Rl(e.id,l)),l=null,a=!1,o=!1,c(),d()};return t.addEventListener("mousedown",h),window.addEventListener("mousemove",f),window.addEventListener("mouseup",y),{detach:()=>{t.removeEventListener("mousedown",h),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",y)},refreshUI:d}}function Ol(i,{onZoomIn:e,onZoomOut:t,onResetZoom:s}){const{zoomInBtn:n,zoomOutBtn:r,zoomResetBtn:a,trailingDivider:o}=i,l=()=>{n.classList.toggle("hidden",!0),r.classList.toggle("hidden",!0),a.classList.toggle("hidden",!0),o.classList.toggle("hidden",!0)};return n.addEventListener("click",e),r.addEventListener("click",t),a.addEventListener("click",s),{detach:()=>{n.removeEventListener("click",e),r.removeEventListener("click",t),a.removeEventListener("click",s)},refreshUI:l}}function Ul(i,e,t,s,n){const{muteBtn:r,soloBtn:a,collapseBtn:o,deleteBtn:l}=i,d=()=>{r.classList.toggle("side-button-activated",e.mute),a.classList.toggle("side-button-activated",e.solo)},c=()=>{e.toggleMute(),d()},u=()=>{e.toggleSolo(),d()},h=()=>{s(!n())},f=()=>{Gt().showDeleteConfirmModal(()=>{T(ur(e.id,e.instrumentName,e.notes,e.volume,e.pan),hr(e.id,e.instrumentName,e.notes,e.volume,e.pan)),e.destroy()},()=>{console.log("Delete cancelled")})};return r.addEventListener("click",c),a.addEventListener("click",u),o.addEventListener("click",h),l.addEventListener("click",f),{detach:()=>{r.removeEventListener("click",c),a.removeEventListener("click",u),o.removeEventListener("click",h),l.removeEventListener("click",f)},refreshUI:()=>{d()}}}class Pl{constructor(e,t,s){this.id=null,this.zoomUI=null,this._collapsed=!1,this.detachFns=[],this.refreshFns=[],this.id=s??null,this.initializeUI(e,t),this.toggleZoomControls(!0),this.boundReload=this.reload.bind(this)}initializeUI(e,t){const s=nl(),n=al();this.rootEl=s.element,s.topBarContainer.appendChild(n.element),e.appendChild(this.rootEl);const r=ol(),a=ll(),o=cl(),l=dl(),d=ul();this.collapseBtn=d.collapseBtn,n.leftGroup.appendChild(r.button),n.leftGroup.appendChild(r.label),n.volumeWrapper.appendChild(a.element),n.panWrapper.appendChild(o.element),n.zoomWrapper.appendChild(l.element),n.rightControlsWrapper.appendChild(d.element);const{seq:c}=sl(this.rootEl,t,this.id);this.body=s,this.zoomUI=l,this.sequencer=c,this.grid=c.matrix;const u=hl(s.gripHandleContainer,s.matrixContainer,this.grid),h=kl(r.button,this.sequencer),f=Al(a,this.sequencer),y=Fl(o,this.sequencer),b=Ol(l,{onZoomIn:()=>this.grid.zoomIn(),onZoomOut:()=>this.grid.zoomOut(),onResetZoom:()=>this.grid.resetZoom()}),g=Ul(d,this.sequencer,s.matrixContainer,p=>this.collapse(p),()=>this.collapsed);this.detachFns=[u.detach,h.detach,f.detach,y.detach,b.detach,g.detach],this.refreshFns=[u.refreshUI,h.refreshUI,f.refreshUI,y.refreshUI,b.refreshUI,g.refreshUI],bt(this.sequencer,t.collapsed),this.refreshUI()}get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e}collapse(e=!0){return bt(this.sequencer,e,this.collapseBtn),this._collapsed}getMiniContourCanvas(){return this.body.miniContourCanvas}getMatrixContainer(){return this.body.matrixContainer}getElement(){return this.rootEl}refreshUI(){this.refreshFns.forEach(e=>e())}destroy(){this.detachFns.forEach(e=>e()),this.rootEl.remove(),this.sequencer.destroy(),Wa(this.sequencer.id),he.getInstance().unregisterReloadable(this.boundReload)}reload(){if(this.id===null||this.id===void 0){console.error("[SequencerController] Cannot reload without a valid ID.");return}const e={id:this.sequencer.id,instrument:this.sequencer.instrumentName,notes:structuredClone(this.sequencer.notes),volume:this.sequencer.volume,pan:this.sequencer.pan,collapsed:this._collapsed};this.detachFns.forEach(s=>s()),this.rootEl.remove(),this.sequencer.destroy();const t=document.getElementById("sequencers-container");if(!t){console.error("[SequencerController] Cannot reload - parent container missing.");return}this.initializeUI(t,e)}toggleZoomControls(e){if(!this.zoomUI)return;const{leadingDivider:t,zoomInBtn:s,zoomOutBtn:n,zoomResetBtn:r,trailingDivider:a}=this.zoomUI;t.classList.toggle("hidden",!e),s.classList.toggle("hidden",!e),n.classList.toggle("hidden",!e),r.classList.toggle("hidden",!e),a.classList.toggle("hidden",!e)}toggleGripHandle(e){const t=this.body.gripHandleContainer;t==null||t.classList.toggle("hidden",!e)}}function fr(i,e){const t=e.id,s=new Pl(i,e,t);return Ja(t,s),he.getInstance().registerReloadable(s.boundReload),s}function Dl(i,e){const t=structuredClone(i);if(t.sequencers.push({id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed}),!lt(e.id)){const n={id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed},r=document.getElementById("sequencers-container");if(!r)return console.error("Sequencer container not found!"),t;fr(r,n)}return t}function pr(i,e,t,s,n){return{type:"CREATE_SEQUENCER",id:i,instrument:e,volume:t,pan:s,collapsed:n}}function Ni(i){return{type:"DELETE_SEQUENCER",id:i}}function ql(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),_e(e.sequencerId),t}function Kl(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),_e(e.sequencerId),t):i}function Hl(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=e.notes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start&&o.duration===r.duration);a&&(a.velocity=r.velocity)}return _e(e.sequencerId),t}function zl(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function $l(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function Jl(i,e){return structuredClone(i)}function wi(i=""){return{type:"CHECKPOINT",label:i}}function mr(i=""){return wi(i)}const Wl=Object.freeze(Object.defineProperty({__proto__:null,CHANGE_NOTE_DURATION:Pa,CHANGE_SNAP_RESOLUTION:Oa,CHANGE_SONG_KEY:Ra,CHANGE_TEMPO:ya,CHECKPOINT:Jl,CREATE_SEQUENCER:Dl,CUT_NOTES:ql,DELETE_NOTES:No,DELETE_SEQUENCER:il,MOVE_NOTES:Bo,PASTE_NOTES:Kl,PLACE_NOTES:Co,RESIZE_NOTES:To,SET_INSTRUMENT:_l,SET_NOTE_MODIFIER_MODE:qa,SET_NOTE_VELOCITY:Hl,SET_PAN:Tl,SET_TIME_SIGNATURE:_a,SET_TOTAL_MEASURES:va,SET_VOLUME:Gl},Symbol.toStringTag,{value:"Module"}));function Mi(i){const e=Wl[i.type];if(!e)throw new Error(`Unknown diff type: ${i.type}`);const t=e(D(),i);Zl(t)}const ai=new Set;function Bt(i){return ai.add(i),()=>ai.delete(i)}function Et(i){for(const e of ai)e(i)}const ye=[];let fe=-1;const jl=100;function Xl({forwardDiff:i,reverseDiff:e}){ye.splice(fe+1),ye.push({forwardDiff:i,reverseDiff:e}),fe=ye.length-1,ye.length>jl&&(ye.shift(),fe--)}function Vl(){var i;if(fe<0)return null;for(let e=fe;e>=0;e--){const t=ye[e];if(((i=t==null?void 0:t.forwardDiff)==null?void 0:i.type)==="CHECKPOINT")return null;if(t!=null&&t.reverseDiff)return fe=e-1,Mi(t.reverseDiff),Et(D()),t.reverseDiff}return null}function Yl(){if(fe>=ye.length-1)return null;fe++;const i=ye[fe];return!i||!i.forwardDiff?null:(Mi(i.forwardDiff),Et(D()),i.forwardDiff)}let vt={tempo:120,timeSignature:[4,4],totalMeasures:8,sequencers:[],songKey:"CM",snapResolution:1,noteDuration:1,isTripletMode:!1,isDottedMode:!1};function D(){return vt}function Zl(i){vt=structuredClone(i),Et(vt)}function T(i,e){Mi(i),Xl({forwardDiff:i,reverseDiff:e}),Et(vt)}let yr=500,gr=!1;function ce(){return D().totalMeasures*D().timeSignature[0]}function me(){return 60/(yr/1e3)}function xi(i,e=!0){const t=me();if(e){T(Fs(i),ga(t));return}const s=H.getInstance();performance.now(),s.getCurrentBeat(),yr=60/i*1e3,s.isActive()&&s.syncAfterTempoChange(t)}function Li(i,e=!0){const t=D().timeSignature[0];if(e){T(Os(i),ba(t));return}K().forEach(s=>s.updateBeatsPerMeasure())}function ki(i,e=!0){const t=D().totalMeasures;if(e){T(Us(i),Sa(t));return}}function _r(i,e=!0){const t=D().songKey;e&&T(Qs(i),Fa(t))}function At(){return Zs()?D().snapResolution:.001}function Hi(i,e=!0){const t=At();if(e){T(er(i),Ua(t));return}}function Ql(i,e=!0){const t=D().noteDuration;if(e){T(tr(i),Da(t));return}}function zi(i,e,t=!0){const s=D(),n=s.isTripletMode,r=s.isDottedMode;if(t){T(ir(i,e),Ka(n,r));return}}function oi(){return D().isTripletMode}function $i(){return D().isDottedMode}function ec(){return D().noteDuration}function Fe(){return D().timeSignature[0]}function Gi(){return D().totalMeasures}function Bi(){return D().songKey}function tc(i){gr=i}function ic(){return gr}let ht=null;function sc(){return H.getInstance()}class H{constructor(e){this.startTime=0,this.startBeat=0,this.isPlaying=!1,this.animationFrameId=null,this.onResumeCallback=null,this.onStopCallback=null,this.tick=()=>{var n;if(!this.isPlaying)return;const t=this.getCurrentBeat(),s=ce();if(t>=s)if(ic())this.seek(0),this.start();else{this.stop(),(n=this.onStopCallback)==null||n.call(this);return}this.animationFrameId=requestAnimationFrame(this.tick)},this.context=X(),this.sequencers=e}static initialize(e){if(ht){console.warn("[PlaybackEngine] Instance already exists. Ignoring re-initialization.");return}ht=new H(e)}static getInstance(){if(!ht)throw new Error("[PlaybackEngine] Instance not initialized. Call initialize() first.");return ht}setOnResumeCallback(e){this.onResumeCallback=e}setOnStopCallback(e){this.onStopCallback=e}getCurrentBeat(){if(!this.isPlaying)return this.startBeat;const e=60/me();return(this.context.currentTime-this.startTime)/e+this.startBeat}async start(){const e=this.context.currentTime+.1;this.startTime=e,this.startBeat=0,this.isPlaying=!0,await this.scheduleAll(e,this.startBeat),this.context.state==="suspended"&&await this.context.resume(),this.animationFrameId=requestAnimationFrame(this.tick)}async pause(){if(!this.isPlaying)return;const e=this.getCurrentBeat();for(const t of this.sequencers)t.stopScheduledNotes();await this.context.suspend(),this.startBeat=e,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}async resume(){var s;if(this.isPlaying)return;await this.context.resume();const t=this.context.currentTime+.05;this.startTime=t,await this.scheduleAll(t,this.startBeat),this.isPlaying=!0,(s=this.onResumeCallback)==null||s.call(this),this.animationFrameId=requestAnimationFrame(this.tick)}stop(){for(const e of this.sequencers)e.stopScheduledNotes();this.isPlaying=!1,this.startBeat=0,this.startTime=0,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}seek(e){this.startBeat=e,this.startTime=this.context.currentTime;const t=this.isPlaying;if(this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t){const s=this.context.currentTime+.05;this.startTime=s,this.scheduleAll(s,this.startBeat).then(()=>{this.animationFrameId=requestAnimationFrame(this.tick)}),this.context.state==="suspended"&&this.context.resume(),this.isPlaying=!0}else this.isPlaying=!1}syncAfterTempoChange(e){const t=this.context.currentTime,s=60/e,n=(t-this.startTime)/s+this.startBeat;this.startBeat=n,this.startTime=t}setSequencers(e){this.sequencers=e}addSequencer(e){this.sequencers.includes(e)||this.sequencers.push(e)}removeSequencer(e){this.sequencers=this.sequencers.filter(t=>t!==e)}clearSequencers(){this.stop(),this.sequencers=[]}isActive(){return this.isPlaying}getStartTime(){return this.startTime}getStartBeat(){return this.startBeat}async scheduleAll(e,t){for(const s of this.sequencers)s.shouldPlay?await s.preparePlayback(e,t):s.stopScheduledNotes()}}const ot=new Map;let br=null;function rc(i,e){ot.set(i,e)}function nc(i){ot.delete(i)}function lt(i){return ot.get(i)}function K(){return Array.from(ot.values())}function vr(){return br}function _e(i){Si(),br=i}function ac(){ot.clear()}function oc(){return K().some(i=>i.solo)}function Ji(){const i=H.getInstance();if(!i.isActive())return;const e=i.getStartTime(),t=i.getStartBeat();for(const s of K())s.stopScheduledNotes(),s.shouldPlay&&(s.reschedulePlayback(e,t),s.resumeAnimationsFromCurrentTime(e,t))}function Sr(){return K()}function lc(){F("Sequencer Dump",Sr())}const cc=Object.freeze(Object.defineProperty({__proto__:null,dumpSequencers:lc,getSequencers:Sr},Symbol.toStringTag,{value:"Module"}));function Cr(){return D()}function dc(){F("App State Dump",Cr())}const uc=Object.freeze(Object.defineProperty({__proto__:null,dumpState:dc,getAppState:Cr},Symbol.toStringTag,{value:"Module"}));function hc(){return structuredClone(z())}function fc(i,e){const t=i.split(".");if(t.length===0){console.warn("Invalid path provided to setUserConfigProperty.");return}let s={},n=s;for(let a=0;a<t.length-1;a++){const o=t[a];n[o]={},n=n[o]}const r=t[t.length-1];n[r]=e,le(s),F(`[UserConfig] Set ${i} =`,e)}function pc(i){const e=i.split(".");let t=z();for(const s of e)if(t&&typeof t=="object"&&s in t)t=t[s];else{console.warn(`getUserConfigProperty: Path "${i}" not found.`);return}return t}const mc=Object.freeze(Object.defineProperty({__proto__:null,getUserConfigProperty:pc,getUserConfigSnapshot:hc,setUserConfigProperty:fc},Symbol.toStringTag,{value:"Module"}));function yc(){const i=Object.create(null);return Object.assign(i,cc,uc,mc),i}const gc="SEQUENZIA_DEV";function _c(){if(typeof window>"u")return;localStorage.getItem(gc)==="true"&&!Rt()&&(Ti(),console.info("[SEQUENZIA] Dev mode re-enabled from localStorage")),window.toggleDevMode=()=>{const e=!Rt();e?Ti():Qr(),console.info(`[SEQUENZIA] Dev mode ${e?"enabled":"disabled"}`),e?Wi():delete window.DEVTOOLS},Rt()&&Wi()}function Wi(){window.DEVTOOLS=yc()}function bc(){window.addEventListener("contextmenu",i=>i.preventDefault()),window.addEventListener("dragstart",i=>i.preventDefault()),window.addEventListener("selectstart",i=>i.preventDefault()),window.addEventListener("drop",i=>i.preventDefault()),window.addEventListener("dragover",i=>i.preventDefault()),window.addEventListener("keydown",i=>{const e=[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Home","End","PageUp","PageDown"],t=i.metaKey,s=i.ctrlKey;(e.includes(i.key)||(t||s)&&["s","p"].includes(i.key.toLowerCase()))&&i.preventDefault()})}function Nr(i,e){const t=i.getContext("2d");if(!t)return;const s=window.devicePixelRatio||1,n=i.width/s,r=i.height/s;t.clearRect(0,0,n,r);const a=ce();for(const o of e){const{notes:l,config:d}=o;if(!(l!=null&&l.length))continue;const c=Ie[e.indexOf(o)%Ie.length];t.fillStyle=c;const u=W(d.noteRange[0]),h=W(d.noteRange[1]);if(u==null||h==null)continue;const f=h-u||1,y=Math.max(2,r/f);for(const b of l){const g=W(b.pitch);if(g==null)continue;const p=b.start/a*n,v=Math.max(1,b.duration/a*n),S=(g-u)/f,_=r-S*r-y/2;t.fillRect(p,_,v,y)}}}function vc(i,e){Nr(i,e)}function wr(){const i=document.getElementById("global-mini-contour");if(!i)return;const e=K();Nr(i,e)}function Sc(i,e,t,s=!0){const n=i.getInteractionStore();let r=new Set;if(s){const o=n.getSelectedNotes();r=new Set(o.map(l=>`${l.pitch}:${l.start}:${l.duration}:${l.velocity}`))}if(i.setNotes(structuredClone(e)),i.getNoteManager().rebuildIndex(),s&&r.size>0){const o=i.notes.filter(l=>r.has(`${l.pitch}:${l.start}:${l.duration}:${l.velocity}`));n.setSelectedNotes(o)}const a=H.getInstance();if(a!=null&&a.isActive()){const o=a.getStartTime(),l=a.getStartBeat();t.reschedulePlayback(o,l)}i.requestRedraw()}function Cc(i,e){return i!==void 0&&e!==void 0&&i===e}function Nc(i=D()){var n;xi(i.tempo,!1),Li(i.timeSignature[0],!1),ki(i.totalMeasures,!1);const e=K();for(const r of e)r.updateTotalMeasures();const t=document.getElementById("sequencers-container");if(!t){console.error("resyncFromState: Missing #sequencers-container");return}console.log("State.sequencers length is: ",i.sequencers.length);for(const r of i.sequencers){const a=e.find(o=>Cc(o.id,r.id));if(console.log("Live sequencer ID: and serialized ID: ",a==null?void 0:a.id,r.id),a){a.instrumentName=r.instrument,typeof r.volume=="number"&&(a.volume=r.volume),typeof r.pan=="number"&&(a.pan=r.pan);const o=(n=a.container)==null?void 0:n.querySelector("canvas.mini-contour");o&&Mt(o,r.notes,a.config,a.colorIndex),a.matrix&&Sc(a.matrix,r.notes,a,!0)}else{const o={id:r.id,instrument:r.instrument,notes:structuredClone(r.notes),volume:r.volume,pan:r.pan,collapsed:r.collapsed};console.log("No sequencer found, creating one with ID: ",r.id),fr(t,o)}}document.getElementById("global-mini-contour")&&wr()}const Mr="userConfig";function wc(){const i=z();Ct(Mr,i)}function Mc(){const i=st(Mr);i&&le(i)}function xc(i,e=[],t="w-[1276px]"){const s=i.id||"bottom-drawer",n=i.ariaLabel||"Bottom drawer",r=i.edgeOffsetClass||"bottom-[60px]",a=i.drawerClassOverride||"",o=t.toString(),l=O(),d=m("div",{id:s,class:["fixed bottom-0 left-1/2 translate-x-[-50%] z-40",o,"overflow-y-auto","rounded-t-lg",l.menuBackground,l.textColor,"transition-transform","translate-y-0","border-t border-gray-200 dark:border-gray-700 pb-[20px]",r,a].join(" "),"aria-labelledby":`${s}-label`,"data-drawer-placement":"bottom","data-drawer-edge":"true","data-drawer-edge-offset":r}),c=m("div",{class:[i.toggleHandleHeightClass,"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"].join(" ")},m("span",{class:"absolute w-8 h-1 -translate-x-1/2 bg-gray-300 rounded-lg top-3 left-1/2 dark:bg-gray-600"}),m("h5",{id:`${s}-label`,class:"inline-flex items-center text-base text-gray-500 dark:text-gray-400 font-medium"},n));d.appendChild(c),e.forEach(h=>d.appendChild(h));const u=new Xr(d,{placement:"bottom",edge:!0,edgeOffset:r,backdrop:!1,bodyScrolling:!0},{id:s,override:!0});return u.show(),c.addEventListener("click",()=>{u.toggle()}),d}const Lc="w-[1260px]",$t=1100,kc=[{value:"4",label:"ùÖù",title:"Whole"},{value:"2",label:"ùÖóùÖ•",title:"Half"},{value:"1",label:"ùÖòùÖ•",title:"Quarter"},{value:"0.5",label:"‚ô™",title:"Eighth"},{value:"0.25",label:"‚ô¨",title:"Sixteenth"},{value:"0.125",label:"ùÖòùÖ•ùÖ∞",title:"32nd"}];class Gc{constructor(){this.globalPlayheadRow=m("div",{id:"global-playhead-row",class:"w-full mb-2"}),this.globalToolsRow=m("div",{id:"global-tools-row",class:"w-full mb-2"}),this.globalTransportRow=m("div",{id:"global-transport-row",class:"w-full"});const e=xc({id:"global-controls-drawer",ariaLabel:" ",edgeOffsetClass:"bottom-[40px]",toggleHandleHeightClass:"py-2"},[this.globalPlayheadRow,this.globalToolsRow,this.globalTransportRow],Lc);this.drawer=e;const t=document.getElementById("footer-main");t?t.appendChild(this.drawer):console.warn("footer-main container not found. GlobalControls not injected.")}render(){return this.drawer}destroy(){this.drawer.remove()}getGlobalPlayheadRow(){return this.globalPlayheadRow}getGlobalToolsRow(){return this.globalToolsRow}getGlobalTransportRow(){return this.globalTransportRow}}function ft(i,e,t){const s=window.devicePixelRatio||1;i.width=e*s,i.height=t*s,i.style.width=`${e}px`,i.style.height=`${t}px`;const n=i.getContext("2d");n&&n.scale(s,s)}const Bc=ie("static/svg/icon-caret-up.svg");function Ec(){const i=`w-[${$t}px]`,e="h-[75px]",t=m("div",{class:"relative flex justify-center w-full mt-4"}),s=m("canvas",{id:"global-mini-contour",class:`absolute top-0 left-0 ${i} ${e} z-0`}),n=m("canvas",{id:"global-mini-playhead",class:`absolute top-0 left-0 ${i} ${e} z-10`,style:"cursor: pointer;"}),r=m("div",{class:`relative ${i} ${e} bg-gray-900/80 backdrop-blur-sm shadow-md rounded-xl`},s,n);ft(s,$t,75),ft(n,$t,75),new ResizeObserver(()=>{const d=r.getBoundingClientRect(),c=Math.round(d.width),u=Math.round(d.height);ft(s,c,u),ft(n,c,u),wr()}).observe(r);const o=m("img",{id:"global-mini-collapse-icon",src:Bc,class:"w-4 h-4",alt:"Expand Mini Contour"}),l=m("button",{id:"global-mini-collapse-btn",class:"absolute right-[calc(50%-600px)] bottom-0 mb-2 p-2 bg-purple-700 text-white text-sm rounded hover:bg-purple-600 transition-colors",style:"cursor: pointer;",title:"Expand Mini Contour"},o);return t.appendChild(r),t.appendChild(l),m("div",{id:"globalControls-miniContour-body",class:"w-full max-w-[1260px] mx-auto"},t)}let j=null;function Ac(){return(j==null?void 0:j.disabled)??!1}function Tc(i){j=i}function Ic(){j&&(j.disabled=!0,j.classList.add("opacity-50","cursor-not-allowed"),Fc())}function Rc(){j&&(j.disabled=!1,j.classList.remove("opacity-50","cursor-not-allowed"),Oc())}function Fc(){if(!j)return;const i=j.querySelector("img");i&&(i.src=ie("static/svg/icon-cog.svg"),i.classList.add("img-spin"),i.alt="Generating...")}function Oc(){if(!j)return;const i=j.querySelector("img");i&&(i.src=ie("static/svg/icon-cursor-arrow-rays.svg"),i.classList.remove("img-spin"),i.alt="Toggle Autocomplete")}function Ei(i,e=[],t={}){const s=O(),n=t.id||`popover-${Math.random().toString(36).slice(2,9)}`,r=m("div",{id:n,"data-popover":"",role:"tooltip",class:["absolute z-[9999] inline-block w-64 text-sm transition-opacity duration-300","border rounded-lg shadow-xs opacity-0 invisible",s.menuBackground,s.textColor,s.borderColor,"bg-white dark:bg-gray-800"].join(" ")});if(t.title){const u=m("div",{class:["px-3 py-2 border-b rounded-t-lg","bg-gray-100 dark:bg-gray-700","border-gray-200 dark:border-gray-600"].join(" ")},m("h3",{class:"font-semibold text-gray-900 dark:text-white",textContent:t.title}));r.appendChild(u)}const a=m("div",{class:"px-3 py-2"},...e);r.appendChild(a),document.body.appendChild(r);const o={placement:t.placement||"bottom",triggerType:t.triggerType||"click",offset:t.offset??10,onShow:t.onShow??(()=>{}),onHide:t.onHide??(()=>{}),onToggle:t.onToggle??(()=>{})},l={id:n,override:t.overrideInstance??!0},d=new Vr(r,i,o,l);let c=null;return d.updateOnShow(()=>{var u;c=h=>{(h.key==="Escape"||h.key.length===1)&&d.hide()},document.addEventListener("keydown",c,{once:!0}),(u=o.onShow)==null||u.call(o,d)}),d.updateOnHide(()=>{var u;c&&(document.removeEventListener("keydown",c),c=null),(u=o.onHide)==null||u.call(o,d)}),{trigger:i,content:r,instance:d}}const Uc=[{id:"velocity-tool",label:"Velocity Tool",iconName:"icon-cog",hotkey:"V"},{id:"quantize-tool",label:"Quantize Tool",iconName:"icon-cog",hotkey:"Q",disabled:!0},{id:"transpose-tool",label:"Transpose Tool",iconName:"icon-cog",hotkey:"T",disabled:!0},{id:"chordifier",label:"Chordifier",iconName:"icon-adjustments-vertical",hotkey:"Shift+C",disabled:!0},{id:"humanizer",label:"Humanizer",iconName:"icon-adjustments-vertical",hotkey:"Shift+H",disabled:!0}];function Pc(){const i=O(),e=m("button",{id:"note-editing-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Tools"},A("icon-chart-bar","Editing"));let t;const s=[m("div",{class:"max-h-72 overflow-y-auto flex flex-col gap-1"},...Uc.flatMap((a,o)=>{const l=o===2,d=m("button",{class:["flex items-center justify-between gap-2 px-3 py-2 text-sm rounded text-left transition-colors",a.disabled?"text-gray-500 bg-gray-700/30 cursor-not-allowed opacity-50":"text-white hover:bg-purple-700 cursor-pointer"].join(" "),...a.disabled?{}:{onClick:()=>{const c=new CustomEvent("editor-invoke",{detail:{editorId:a.id},bubbles:!0});e.dispatchEvent(c),requestAnimationFrame(()=>{t==null||t.hide()})}}},m("div",{class:"flex items-center gap-2"},A(a.iconName,a.label),m("span",{textContent:a.label})),a.hotkey?m("span",{class:"text-xs text-gray-400 font-mono",textContent:a.hotkey}):null);return l?[d,m("div",{class:`my-2 border-t ${i.borderColor} mx-2`})]:[d]}))];t=Ei(e,s,{title:"Tools",placement:"bottom",triggerType:"click"}).instance;let r=null;return t.updateOnShow(()=>{r=a=>{(a.key==="Escape"||a.key.length===1)&&(t==null||t.hide())},document.addEventListener("keydown",r,{once:!0})}),t.updateOnHide(()=>{r&&(document.removeEventListener("keydown",r),r=null)}),e}function Ge(i){const e=O();return m("span",{class:`font-semibold ${e.accentColor} rounded text-xs`,textContent:i})}function V(...i){const e=O();return m("p",{class:`text-sm leading-relaxed ${e.textColor}`},...i)}function Ae(i,e="?",t){const s=O(),n=m("span",{"data-tooltip-target":i,tabIndex:-1,class:[`${s.textColor} border border-white/40`,"hover:bg-white/10","font-medium rounded-full text-xs px-2 py-[2px]","pointer-events-auto select-none","cursor-default","focus:outline-none focus:ring-0","aria-hidden"].join(" ")},e),r=Array.isArray(t)?t.map(o=>typeof o=="string"?V(o):o):[typeof t=="string"?V(t):t],a=m("div",{id:i,role:"tooltip",class:["absolute z-10 invisible inline-block max-w-xs px-4 py-3 text-sm",`${s.textColor} transition-opacity duration-300 ${s.surfaceBackground} rounded-lg shadow-xs`,"opacity-0 tooltip"].join(" ")},m("div",{class:"space-y-2"},...r),m("div",{class:"tooltip-arrow","data-popper-arrow":""}));return{trigger:n,tooltip:a}}function Dc(){const i=O(),e=m("button",{id:"note-placement-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",title:"Grid Settings",style:"cursor: pointer;"},A("icon-music","Placement")),t=Ae("tooltip-grid-guides","?",[V(Ge("Key Grid Highlighting:")," colors each piano roll row based on the current song key."),V("In-key notes are shown as white rows. Out-of-key notes are shown as black rows.")]),s=we({id:"toggle-grid-guides",stateA:"Off",stateB:"Transpose Grid to Key",inline:!0,tooltipTrigger:t.trigger});s.input.addEventListener("change",()=>{Ea(s.getChecked())});const n=Ae("tooltip-snap-to-key","?",[V(Ge("Snap to Key:")," constrains vertical note placement to notes in the current key."),V("Hold ",Ge("CTRL")," while placing notes to temporarily allow chromatic input.")]),r=we({id:"toggle-snap-key",stateA:"Off",stateB:"Snap Notes to Key",inline:!0,tooltipTrigger:n.trigger});r.input.addEventListener("change",()=>{Ta(r.getChecked())});const a=Ae("tooltip-snap-to-grid","?",[V(Ge("Snap to Grid:")," constrains horizontal note placement to musical durations."),V("Notes will align to the selected beat value (e.g. quarter, eighth, sixteenth).")]),o=we({id:"toggle-snap-grid",stateA:"Off",stateB:"Snap Notes to Grid",inline:!0,tooltipTrigger:a.trigger});o.input.addEventListener("change",()=>{Aa(o.getChecked())});const l=()=>{s.setChecked(Ys()),r.setChecked(Nt()),o.setChecked(Zs())},d=[m("div",{class:"mb-1"},s.element),t.tooltip,m("div",{class:`my-2 border-t ${i.borderColor} mb-3 mx-2`}),m("div",{class:"mb-1"},r.element),n.tooltip,m("div",{class:"mt-1"},o.element),a.tooltip];return Ei(e,d,{title:"Grid Settings",placement:"bottom",triggerType:"click",onShow:()=>requestAnimationFrame(l)}),{trigger:e,refreshToggles:l}}function qc(){const i=Dc(),e=m("div",{class:"flex flex-wrap justify-center items-center gap-4 p-4"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},m("button",{id:"note-mode-btn",class:"bg-blue-600 px-3 py-1 rounded text-white hover:bg-blue-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Drawing Toolbar (Q)"},A("icon-pen","Note Mode")),m("button",{id:"ai-mode-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"AI Toolbar (W)"},A("icon-brain-white","AI Mode")))),t=m("div",{class:"flex gap-4"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},i.trigger,Pc()),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},...kc.map((r,a)=>m("button",{class:["bg-transparent hover:bg-gray-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl","w-[52px] h-[42px] flex items-center justify-center"].join(" "),"data-value":r.value,title:`${r.title} (${a+1} or Shift+${a+1})`},r.label))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"dotted-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Dotted Note (.)"},"‚Ä¢"),m("button",{id:"triplet-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Triplet (/)"},"¬≥"))),s=m("button",{id:"autocomplete-toggle-btn",class:"bg-transparent hover:bg-purple-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Autocomplete (G/Shift+G)"},A("icon-cursor-arrow-rays","Toggle Autocomplete"));Tc(s);const n=m("div",{class:"flex gap-4 hidden"},m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-tools-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Tools"},A("icon-chip","AI Tools"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},s,m("button",{id:"autocomplete-approve-btn",class:"bg-transparent hover:bg-green-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"Approve (Tab)"},A("icon-thumbs-up","Approve Autocomplete"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-extend-before-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Extend Before (SHIFT+1)"},A("icon-double-arrow-left","AI Extend Before")),m("button",{id:"ai-paint-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Paint Tool (SHIFT+2)"},A("icon-paint-brush","AI Paint")),m("button",{id:"ai-extend-after-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Extend After (SHIFT+3)"},A("icon-double-arrow-right","AI Extend After"))),m("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("button",{id:"ai-adjust-prompt-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"Adjust AI Prompt Settings"},A("icon-adjust-ai-prompt","Adjust AI Prompt")),m("button",{id:"ai-debugger-btn",class:"bg-transparent hover:bg-gray-700 text-white cursor-pointer px-3 py-1 rounded w-[52px] h-[42px] flex items-center justify-center",title:"AI Debugger"},A("icon-command-line","AI Debugger"))));return e.appendChild(t),e.appendChild(n),{element:e,refreshGridSettings:i.refreshToggles,noteOptionsGroup:t,aiOptionsGroup:n}}function Kc(){const i=m("div",{class:"fixed left-[calc(50%-678px)] bottom-[20px] flex flex-col gap-2 z-[9999]"},m("button",{id:"footer-help-btn",class:"side-button side-button-info",title:"Help / Documentation"},A("icon-lightbulb","Help")),m("button",{id:"footer-whats-new-btn",class:"side-button side-button-info",title:"What's New / Release Notes"},A("icon-circle-plus","What's New")));return document.body.appendChild(i),i}function ji(){const i=O();return m("div",{class:["h-12 w-px",i.accentColor,"shadow-inner","rounded-full"].join(" ")})}function ke(i,e,t,s,n){return m("button",{id:i,title:e,class:["w-12 h-12 flex items-center justify-center rounded-full cursor-pointer shadow transition-all hover:scale-110","text-white",s,n].join(" ")},t)}function Jt(i){const{id:e,value:t,min:s,max:n,onInput:r}=i,a=O();return m("input",{id:e,type:"number",value:String(t),min:s==null?void 0:s.toString(),max:n==null?void 0:n.toString(),class:["w-[72px] h-[40px] px-2 rounded text-sm font-semibold",a.surfaceBackground,a.textColor,a.borderColor].join(" "),oninput:r})}function Ue(i="4"){return m("div",{class:`inline-block w-${i}`})}function Hc(){const i=O();return m("div",{class:["w-full h-px",i.accentColor,"shadow-inner","rounded-full","my-2"].join(" ")})}const zc=["C","D","E","F","G","A","B"],$c=["C#","D#","","F#","G#","A#",""];function Jc(){return Bi()??"CM"}function Wt(i){const e=i.endsWith("m")?"m":"M";return[i.slice(0,i.length-1),e]}function Wc(){O();let[i,e]=Wt(Jc());const t=P({id:"key-selector-trigger",text:`${i}${e}`,kind:"secondary",additionalClasses:"w-14 px-2 py-[10px] text-center truncate"}),s=(c,u)=>{if(c==="")return;i=c,e=u;const h=`${c}${u}`;_r(h),t.textContent=h,l()},n=m("div",{class:"flex w-full mt-2 gap-[6px]"},...zc.map(c=>m("button",{class:jt(c,i),onClick:()=>s(c,e)},c))),r=m("div",{class:"flex w-full mb-1 gap-[6px] translate-x-[22px]"},...$c.map(c=>c===""?m("div",{class:"w-8"}):m("button",{class:jt(c,i),onClick:()=>s(c,e)},c))),a=we({id:"key-mode-toggle",stateA:"Major",stateB:"Minor",inline:!0});a.setChecked(e==="m"),a.input.addEventListener("change",()=>{const c=a.getChecked()?"m":"M";s(i,c)});const o=[r,n,Hc(),a.element],l=()=>{[...n.children,...r.children].forEach(u=>{if(!(u instanceof HTMLButtonElement))return;const h=u.textContent||"";u.className=jt(h,i)}),a.setChecked(e==="m")};return Ei(t,o,{title:"Key Selector",placement:"bottom",triggerType:"click"}),Bt(c=>{const[u,h]=Wt(c.songKey);i=u,e=h,t.textContent=c.songKey,l()}),{trigger:t,refreshUI:()=>{const[c,u]=Wt(Bi());i=c,e=u,t.textContent=`${c}${u}`,l()}}}function jt(i,e){return["w-8 h-8 rounded-full text-xs flex items-center justify-center","transition-all duration-150","cursor-pointer focus:outline-none","text-white",i===e?"bg-cyan-600 ring-2 ring-white":"bg-gray-600 hover:bg-gray-500 hover:ring-1 hover:ring-white"].join(" ")}function jc(){const i=we({id:"loop-toggle",stateB:"Loop",inline:!0}),e=Wc();return{element:m("div",{class:"flex justify-center items-center gap-4 flex-wrap"},m("div",{class:"flex items-center gap-2"},ke("play-button","Play/Pause",A("icon-play","Play"),"bg-blue-600","hover:bg-blue-700"),ke("stop-button","Stop",A("icon-stop","Stop"),"bg-blue-600","hover:bg-blue-700"),Ue("4"),ke("record-button","Record",A("icon-record","Record"),"bg-red-600","hover:bg-red-700"),Ue("4"),i.element,Ue("4"),ji()),m("div",{class:"flex items-center gap-4 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},m("div",{class:"flex flex-col items-start gap-1"},Y("Key"),e.trigger),m("div",{class:"flex flex-col items-start gap-1"},Y("Tempo"),Jt({id:"tempo-input",min:20,max:300,value:120})),m("div",{class:"flex flex-col items-start gap-1"},Y("Measures"),Jt({id:"measures-input",min:1,max:1e3,value:8})),m("div",{class:"flex flex-col items-start gap-1"},Y("Beats"),Jt({id:"beats-per-measure-input",min:1,max:16,value:4}))),ji(),m("div",{class:"flex items-center gap-2"},Ue("4"),ke("save-button","Save",A("icon-save","Save"),"bg-green-600","hover:bg-green-700"),ke("load-button","Load",A("icon-load","Load"),"bg-yellow-600","hover:bg-yellow-700"),Ue("4"),ke("config-button","User Settings",A("icon-user-settings","Settings"),"bg-purple-600","hover:bg-purple-700"))),refreshToggles:()=>{e.refreshUI()}}}const Xc=ie("static/svg/icon-caret-up.svg"),Vc=ie("static/svg/icon-caret-down.svg");function Yc(i){var d;const e=()=>{},t=(d=i.querySelector("#global-mini-contour"))==null?void 0:d.parentElement,s=i.querySelector("#global-mini-collapse-btn"),n=i.querySelector("#global-mini-collapse-icon"),r=300,a=75;let o=!0;const l=()=>{if(!t||!s||!n)return;o=!o,t.style.height=o?`${a}px`:`${r}px`,t.querySelectorAll("canvas").forEach(u=>{u.style.height=o?`${a}px`:`${r}px`}),n.src=o?Xc:Vc,s.title=o?"Expand Mini Contour":"Collapse Mini Contour"};return s==null||s.addEventListener("click",l),{detach:()=>{s==null||s.removeEventListener("click",l)},refreshUI:e}}function Xi(i,e={}){const{beatsPerBar:t=4,stepsPerBeat:s=4,quantizeDurations:n=!0,ignoreVelocity:r=!1}=e,a=[],o=[...i].sort((d,c)=>d.start-c.start);let l=-1;for(const d of o){const c=Math.floor(d.start/t),u=d.start%t,h=Math.round(u*s);c!==l&&(a.push({type:"Bar",value:c}),l=c),a.push({type:"Position",value:h}),a.push({type:"Pitch",value:d.pitch});const f=n?Math.max(1,Math.round(d.duration*s)):d.duration;if(a.push({type:"Duration",value:f}),!r){const y=d.velocity??100;a.push({type:"Velocity",value:y})}}return a}function Zc(i,e={}){const{beatsPerBar:t=4,stepsPerBeat:s=4,quantizeDurations:n=!0,ignoreVelocity:r=!1}=e;let a=0,o=0,l=!1;const d=[];for(let c=0;c<i.length;c++){const u=i[c];switch(u.type){case"Bar":a=u.value;break;case"Position":o=u.value,l=!0;break;case"Pitch":{if(!l){F(`REMI decode: Pitch token at index ${c} has no preceding Position`,u,"warn");continue}const h=i[c+1],f=p=>typeof p=="number"&&!Number.isNaN(p)&&Number.isFinite(p);if(!h||h.type!=="Duration"||!f(h.value)){F(`REMI decode: Missing or invalid Duration token after Pitch at index ${c}`,{pitchToken:u,durationToken:h},"warn");continue}let y=100;if(!r){const p=i[c+2];if(!p||p.type!=="Velocity"||!f(p.value)){F(`REMI decode: Missing or invalid Velocity token after Duration at index ${c}`,{pitchToken:u,velocityToken:p},"warn");continue}y=p.value}const b=a*t+o/s,g=n?h.value/s:h.value;d.push({pitch:u.value,start:b,duration:g,velocity:y}),l=!1,c+=r?1:2;break}}}return d}function Qc(i,e,t,s,n){const r=c=>c.start>=t&&c.start<s,a=e.find(c=>c.id===i);if(!a)throw new Error(`Sequencer with id ${i} not found.`);const o=a.notes.filter(r),l=Xi(o,n),d=e.filter(c=>c.id!==i).map(c=>{const u=c.notes.filter(r);return Xi(u,n)});return F("[AutoComplete] Extracted Context:",{primaryTrackRemi:l,otherTracksRemi:d,startBeat:t,endBeat:s}),{primaryTrackRemi:l,otherTracksRemi:d,startBeat:t,endBeat:s}}function ed(i,e,t){const s=[];let n=0,r=null,a=!1;F("[AutoComplete] Clipping LLM Continuation:",{llmContinuationRemi:i,clipAfterBar:e,clipAfterPosition:t});for(const o of i){if(o.type==="Bar"){r=o,n=o.value;continue}if(o.type==="Position"){a=n>e||n===e&&o.value>=t,a&&(r&&(s.push(r),r=null),s.push(o));continue}a&&s.push(o)}return F("[AutoComplete] Clipped LLM Continuation:",s),s}function td(i,e,t){const s=e*t,n=[];let r=0;for(const a of i){if(a.type==="Bar"){r=a.value,n.push(a);continue}if(a.type==="Position"){const o=a.value,l=Math.floor(o/s),d=o%s,c=r+l,u=n[n.length-1];(!u||u.type!=="Bar"||u.value!==c)&&n.push({type:"Bar",value:c}),n.push({type:"Position",value:d})}else n.push(a)}return n}const id="llmSettings",sd={promptTuning:{styleInstruction:"",additionalInstructions:"",avoidStyles:""},context:{useMultiTrackContext:!0,contextBeats:32}};let rd=st(id)??sd;function li(){return rd}function xr(){return{beatsPerBar:Fe(),stepsPerBeat:4,quantizeDurations:!0,ignoreVelocity:!0}}function Lr(i){const t=li().context.contextBeats,s=i.notes;if(s.length===0)return[0,t];const n=s.reduce((l,d)=>{const c=l.start+l.duration;return d.start+d.duration>c?d:l}),r=n.start+n.duration,a=Math.ceil(r);return[Math.max(0,a-t),a]}function nd(i,e,t){const s=Math.floor(i/e),n=Math.round(i%e*t);return F("[AutoComplete] Computed Clip Boundary:",{endBeat:i,beatsPerBar:e,stepsPerBeat:t,clipAfterBar:s,clipAfterPosition:n}),{clipAfterBar:s,clipAfterPosition:n}}function ad(i){const[,e]=Lr(i),t=xr(),s=(t==null?void 0:t.beatsPerBar)??4;return Math.floor(e/s)}function od(i){const e=[];for(const s of i){if(s.match(/(Bar_|Position_|Pitch_|Duration_|Velocity_)/i)){const n=s.split(/(?=Bar_|Position_|Pitch_|Duration_|Velocity_)/i);e.push(...n.map(r=>r.replace(/_/g," ").trim()).filter(Boolean));continue}if(s.match(/(Bar\s|Position\s|Pitch\s|Duration\s|Velocity\s)/i)&&s.split(" ").length>2){const n=s.split(/(?=Bar\s|Position\s|Pitch\s|Duration\s|Velocity\s)/i);e.push(...n.map(r=>r.trim()).filter(Boolean));continue}e.push(s)}const t=[];for(let s=0;s<e.length;s++){const n=e[s],r=e[s+1],a=n.match(/^(bar|position|pitch|duration|velocity)$/i),o=a?a[0][0].toUpperCase()+a[0].slice(1).toLowerCase():null;o&&r!==void 0?(t.push(`${o} ${r}`),s++):t.push(n)}return t}function ld(i){const e=[],t=od(i);for(const s of t){const n=s.match(/^(\w+)\s+(.+)$/);if(!n){console.warn(`Invalid REMI token format: '${s}'`);continue}const[,r,a]=n,o=r;switch(o){case"Bar":case"Position":case"Duration":case"Velocity":{const l=Number(a);if(isNaN(l)){console.warn(`Invalid numeric value in REMI token: '${s}'`);continue}e.push({type:o,value:l});break}case"Pitch":e.push({type:o,value:a});break;default:console.warn(`Unknown REMI token type: '${o}' in token '${s}'`);break}}return F("[RemiTokenParser] Parsed RemiEvents:",e),e}function cd(i){if(!i||typeof i!="string")return"Unknown Key";const e=i.trim().toUpperCase();if(e==="CM"||e==="C")return"C Major";if(e.endsWith("M")&&e.length===2)return`${e[0]} Major`;const t=i.endsWith("m")||i.endsWith("M");return`${i.slice(0,-1).toUpperCase()} ${t?"Minor":"Major"}`}class dd{logPrompt(e){F(`[${this.name}] Generated Prompt:`,e)}}class ud extends dd{constructor(){super(...arguments),this.name="Remi Autocomplete Prompt"}buildPrompt(e,t){const{continuationBeats:s,llmSettings:n}=t,{styleInstruction:r}=n.promptTuning,{primaryTrackRemi:a,otherTracksRemi:o}=e,l=f=>f.map(y=>`${y.type} ${y.value}`).join(" "),d=o.map((f,y)=>`Track ${y+1}: ${l(f)}`).join(`
`),c=`Primary Track: ${l(a)}`,h=["Song Key:",cd(Bi()),...r?["","STYLE INSTRUCTION:",r]:[],"Background Tracks Context (Can be empty):",d,"","Track to continue from:",c,"",`${s} beat PRIMARY TRACK CONTINUATION:`].join(`
`);return this.logPrompt(h),h}}async function hd(i,e,t){const s=ws();if(!s)throw new Error("OpenAI API key is not set.");const n="https://api.openai.com/v1/responses",r=t.schema,a={model:e,input:[{role:"user",content:i}],text:{format:{type:"json_schema",name:t.name,schema:r,strict:!0}}},o=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(a)});if(!o.ok){const d=await o.text();throw console.error("OpenAI Responses API Error:",d),new Error(`OpenAI request failed: ${o.status}`)}const l=await o.json();return fd(l)}function fd(i){var n,r,a;const e=(n=i.output)==null?void 0:n.find(o=>o.type==="message"),t=(a=(r=e==null?void 0:e.content)==null?void 0:r.find(o=>o.type==="output_text"))==null?void 0:a.text;if(F("[OpenAI] Raw Output:",t),!t)throw new Error("Missing output_text in OpenAI response.");const s=JSON.parse(t);if(!Array.isArray(s.result))throw new Error("Invalid result format.");return s.result}async function pd(i,e,t){if(i.startsWith("gpt-")||i.startsWith("o3")||i.startsWith("o4"))return hd(e,i,t);throw new Error(`Unsupported LLM model: ${i}`)}const md={name:"remi_tokens",schema:{type:"object",properties:{result:{type:"array",items:{type:"string"},description:"REMI token sequence"}},required:["result"],additionalProperties:!1}};async function Vi(i="unknown"){var a,o,l,d,c;const e=vr();if(e===null){console.warn("No active sequencer to apply autocomplete to.");return}const t=lt(e);if(!t){console.error(`Sequencer with id ${e} not found.`);return}Ic(),Si(),(a=t.matrix)==null||a.invalidateAIAutocompleteRenderer();const[s,n]=Lr(t);F(`[AutoComplete] Running autocomplete for beats ${s} to ${n} on sequencer ${e} via ${i}`);const r=ad(t);(o=t.matrix)==null||o.setActiveAutocompleteBar(r),(l=t.matrix)==null||l.startAIAutocompleteAnimationLoop();try{await yd(e,K(),s,n)}catch(u){console.error("Autocomplete failed:",u)}finally{Rc(),Ye().length===0&&(F("[AutoComplete] No preview notes generated. Stopping animation loop."),(d=t.matrix)==null||d.stopAIAutocompleteAnimationLoop()),(c=t.matrix)==null||c.setActiveAutocompleteBar(null)}}async function yd(i,e,t,s,n="gpt-4o",r=4){const a=xr();F("[AutoComplete] Running REMI Continuation Pipeline with LLM settings:",li());const o=Qc(i,e,t,s,a),d=new ud().buildPrompt(o,{continuationBeats:r,llmSettings:li()}),c=a.beatsPerBar??4,u=a.stepsPerBeat??4,{clipAfterBar:h,clipAfterPosition:f}=nd(s,c,u),y=2;for(let b=1;b<=y;b++){const g=await pd(n,d,md),p=ld(g),v=td(p,c,u),S=ed(v,h,f),_=Zc(S,a);if(F(`[AutoComplete] Attempt ${b}: Decoded Notes:`,_),_.length>0){F("[AutoComplete] Final Decoded Notes:",_),mo(_);const C=lt(i);C&&C.redraw();return}F(`[AutoComplete] Attempt ${b}: No new notes after clip boundary. Retrying...`)}F("[AutoComplete] All retry attempts failed to generate new continuation notes.")}function gd(i){var s,n;const e=Ye();T(Lt(i,e),kt(i,e)),Si();const t=lt(i);t?((s=t.matrix)==null||s.stopAIAutocompleteAnimationLoop(),(n=t.matrix)==null||n.playNoteAcceptanceAnimation(e)):console.warn(`Could not stop AI animation: sequencer ${i} not found.`)}const Yi={Digit1:4,Digit2:2,Digit3:1,Digit4:.5,Digit5:.25,Digit6:.125};function _d(i){const{rootElement:e,noteOptionsGroup:t,aiOptionsGroup:s}=i,n=e.querySelectorAll("button[data-value]"),r=e.querySelector("#dotted-note-btn"),a=e.querySelector("#triplet-note-btn"),o=e.querySelector("#note-mode-btn"),l=e.querySelector("#ai-mode-btn"),d=e.querySelector("#autocomplete-toggle-btn"),c=e.querySelector("#autocomplete-approve-btn"),u=e.querySelector("#autocomplete-reject-btn"),h=e.querySelector("#ai-tools-btn"),f=e.querySelector("#ai-extend-before-btn"),y=e.querySelector("#ai-paint-btn"),b=e.querySelector("#ai-extend-after-btn"),g=e.querySelector("#ai-adjust-prompt-btn"),p=e.querySelector("#ai-debugger-btn"),v=M=>{if(M==="ai"&&!ws()){J().showOpenAIKeyNotSet();return}const x=M==="note";t.classList.toggle("hidden",!x),s.classList.toggle("hidden",x),o==null||o.classList.toggle("bg-blue-600",x),o==null||o.classList.toggle("bg-gray-800",!x),l==null||l.classList.toggle("bg-purple-700",!x),l==null||l.classList.toggle("bg-gray-800",x)};o==null||o.addEventListener("click",()=>v("note")),l==null||l.addEventListener("click",()=>v("ai")),d==null||d.addEventListener("click",M=>{M.button===0&&Vi("GlobalToolbarListeners")}),d==null||d.addEventListener("contextmenu",M=>{M.preventDefault(),Pi(),console.log("Toggled Autocomplete Mode")}),c==null||c.addEventListener("click",()=>{console.log("Approved Autocompleted Notes");const M=vr();if(M===null){console.warn("No active sequencer to apply autocomplete to.");return}gd(M)}),h==null||h.addEventListener("click",()=>{J().showFeatureBlocked(),console.log("AI Tools Popover Triggered (placeholder)")}),f==null||f.addEventListener("click",()=>{J().showFeatureBlocked(),console.log("AI Extend Before Triggered (placeholder)")}),y==null||y.addEventListener("click",()=>{J().showFeatureBlocked(),console.log("AI Paint Tool Activated (placeholder)")}),b==null||b.addEventListener("click",()=>{J().showFeatureBlocked(),console.log("AI Extend After Triggered (placeholder)")}),g==null||g.addEventListener("click",()=>{J().showFeatureBlocked(),console.log("AI Prompt Settings Modal Opened (placeholder)")}),p==null||p.addEventListener("click",()=>{J().showFeatureBlocked(),console.log("AI Debugger Panel Opened (placeholder)")});const S=()=>{const M=At(),x=ec();n.forEach(B=>{const I=parseFloat(B.dataset.value??"-1");B.classList.remove("bg-purple-700","bg-blue-700","bg-gray-800"),B.classList.add("bg-transparent"),I===x?(B.classList.add("bg-purple-700"),B.classList.remove("bg-transparent")):I===M?(B.classList.add("bg-blue-700"),B.classList.remove("bg-transparent")):B.classList.add("bg-gray-800")})},_=Bt(M=>{S(),r==null||r.classList.toggle("bg-purple-700",M.isDottedMode),r==null||r.classList.toggle("bg-transparent",!M.isDottedMode),a==null||a.classList.toggle("bg-purple-700",M.isTripletMode),a==null||a.classList.toggle("bg-transparent",!M.isTripletMode),N(M.noteDuration,!1)}),C=po(M=>{d==null||d.classList.toggle("bg-pink-400",M),d==null||d.classList.toggle("bg-transparent",!M)}),N=(M,x=!0)=>{const B=$i(),I=oi();let R=M;B?R*=1.5:I&&(R*=2/3),at.currentDuration=R,K().forEach(Q=>{var be;Q.config.currentDuration=R,(be=Q.matrix)==null||be.requestRedraw()}),Ql(M,x)},w=(M=!0)=>{const x=e.querySelector("button[data-value].bg-purple-700");if(x){const B=parseFloat(x.dataset.value);N(B,M)}},L=()=>{S()};n.forEach(M=>{M.classList.add("note-duration-btn"),M.addEventListener("click",x=>{if(x.button===0){const B=parseFloat(M.dataset.value);N(B)}}),M.addEventListener("contextmenu",x=>{x.preventDefault();const B=parseFloat(M.dataset.value);Hi(B,!0)})}),a==null||a.addEventListener("click",()=>{const M=!oi();zi(M,!1),w(!1)}),r==null||r.addEventListener("click",()=>{const M=!$i();zi(!1,M),w(!1)});const G=M=>{const x=M.target;if(!(x.tagName==="INPUT"||x.tagName==="TEXTAREA"||x.isContentEditable||Ne())){if(Yi.hasOwnProperty(M.code)){M.preventDefault();const B=Yi[M.code];M.shiftKey?Hi(B,!0):N(B);return}if(M.key==="."){M.preventDefault(),r==null||r.click();return}if(M.key==="/"){M.preventDefault(),a==null||a.click();return}switch(M.code){case"KeyG":M.preventDefault(),M.shiftKey?(Pi(),console.log("Toggled Autocomplete Mode via Shift+G")):Ac()||Vi("GlobalToolbarListeners");return;case"Tab":M.preventDefault(),c==null||c.click();return;case"KeyQ":M.preventDefault(),o==null||o.click();return;case"KeyW":M.preventDefault(),l==null||l.click();return}}};return window.addEventListener("keydown",G),L(),{detach:()=>{window.removeEventListener("keydown",G),_(),C(),[o,l,d,c,u,h,f,y,b,g,p].forEach(I=>{I&&I.replaceWith(I.cloneNode(!0))}),n.forEach(I=>{const R=I.cloneNode(!0);I.replaceWith(R)});const x=r==null?void 0:r.cloneNode(!0);x&&(r!=null&&r.parentNode)&&r.parentNode.replaceChild(x,r);const B=a==null?void 0:a.cloneNode(!0);B&&(a!=null&&a.parentNode)&&a.parentNode.replaceChild(B,a)},refreshUI:L}}function bd(i,e){const t=i.querySelector("#footer-help-btn"),s=i.querySelector("#footer-whats-new-btn"),n=()=>{},r=()=>{window.open("https://github.com/alacrity-ai/sequenzia","_blank")},a=()=>{e.show()};return t==null||t.addEventListener("click",r),s==null||s.addEventListener("click",a),{detach:()=>{t==null||t.removeEventListener("click",r),s==null||s.removeEventListener("click",a)},refreshUI:n}}function vd(i,e,t,s,n){const r=i.querySelector("#play-button"),a=i.querySelector("#stop-button"),o=i.querySelector("#record-button"),l=i.querySelector("#loop-toggle"),d=i.querySelector("#tempo-input"),c=i.querySelector("#measures-input"),u=i.querySelector("#beats-per-measure-input"),h=i.querySelector("#save-button"),f=i.querySelector("#load-button"),y=i.querySelector("#config-button"),b=x=>{if(!r)return;r.classList.toggle("bg-blue-800",x),r.classList.toggle("bg-blue-600",!x);const B=x?"icon-pause":"icon-play",I=ie(`static/svg/${B}.svg`),R=r.querySelector("img");if((R==null?void 0:R.getAttribute("src"))!==I){const q=A(B,x?"Pause":"Play");R?r.replaceChild(q,R):r.appendChild(q)}},g=()=>{b(e.isPlaying())};e.setOnStopCallback(()=>{b(!1)});const p=()=>{const x=!e.isPlaying();e.toggle(),b(x)},v=()=>{e.stop(),b(!1)},S=()=>{},_=()=>{const x=d==null?void 0:d.valueAsNumber;x&&x>=20&&x<=300&&xi(x,!0)},C=()=>{const x=c==null?void 0:c.valueAsNumber;x&&x>=1&&x<=1e3&&ki(x,!0)},N=()=>{const x=u==null?void 0:u.valueAsNumber;x&&x>=1&&x<=16&&Li(x,!0)};Bt(x=>{d&&(d.value=String(x.tempo)),c&&(c.value=String(x.totalMeasures)),u&&(u.value=String(x.timeSignature[0]))});const w=()=>{tc((l==null?void 0:l.checked)??!1)},L=()=>{s.show()},G=()=>{n.show()},E=()=>{t.show()},M=x=>{var R;const B=(R=document.activeElement)==null?void 0:R.tagName,I=B==="INPUT"||B==="TEXTAREA";x.key===" "&&!I&&(x.preventDefault(),x.shiftKey?v():p())};return r==null||r.addEventListener("click",p),a==null||a.addEventListener("click",v),o==null||o.addEventListener("click",S),d==null||d.addEventListener("change",_),c==null||c.addEventListener("change",C),u==null||u.addEventListener("change",N),l==null||l.addEventListener("change",w),h==null||h.addEventListener("click",L),f==null||f.addEventListener("click",G),y==null||y.addEventListener("click",E),window.addEventListener("keydown",M),{detach:()=>{r==null||r.removeEventListener("click",p),a==null||a.removeEventListener("click",v),o==null||o.removeEventListener("click",S),d==null||d.removeEventListener("change",_),c==null||c.removeEventListener("change",C),u==null||u.removeEventListener("change",N),l==null||l.removeEventListener("change",w),h==null||h.removeEventListener("click",L),f==null||f.removeEventListener("click",G),y==null||y.removeEventListener("click",E),window.removeEventListener("keydown",M)},refreshUI:g}}function kr(i,e){var t;for(const s of i.sequencers){const n=s.matrix;if(!n)continue;const r=(t=n.getPixelsPerBeat)==null?void 0:t.call(n);if(!r)continue;const a=e*r;n.setPlayheadPixelX(a)}}let ue=null,We=null;function Sd(i){We=i,ue=We.getContext("2d")}function Tt(i){if(!ue||!We)return;const e=window.devicePixelRatio||1,t=We.width/e,s=We.height/e;ue.clearRect(0,0,t,s);const n=Math.round(i)+.5;ue.strokeStyle="#ff00ff",ue.lineWidth=1,ue.beginPath(),ue.moveTo(n,0),ue.lineTo(n,s),ue.stroke()}function Cd(i,e){const t=e.snapResolution||.25,s=e.isTripletMode?t*(2/3):t;return Math.round(i/s)*s}let pt=!1,ee=null,Xt=!1;function Nd(i){if(ee=i.querySelector("#global-mini-playhead"),!ee)throw new Error("Playhead canvas not found in container.");const e=H.getInstance(),t=(l,d=!0)=>{const c=ce(),u=Cd(l,at),h=Math.max(0,Math.min(c,u)),f=e.isActive();if(e.seek(h),d&&f&&e.resume(),kr(e,h),ee){const y=window.devicePixelRatio||1,b=ee.width/y,g=h/c*b;Tt(g)}},s=l=>{if(!ee)return;const d=window.devicePixelRatio||1,c=ee.getBoundingClientRect(),u=ee.width/d;let h=(l.clientX-c.left)*(u/c.width);h=Math.max(0,Math.min(u,h));const f=ce(),y=h/u*f;t(y,!1)},n=l=>{var f;const d=(f=document.activeElement)==null?void 0:f.tagName;if(d==="INPUT"||d==="TEXTAREA"||!l.shiftKey)return;const c=ce(),u=Fe();let h=e.getCurrentBeat();switch(l.key.toLowerCase()){case"a":h-=1;break;case"d":h+=1;break;case"s":{const y=Math.floor(h),b=Math.floor(y/u)*u;h=y===b?Math.max(0,b-u):b;break}case"w":{const y=Math.floor(h),g=Math.floor(y/u)*u+u;h=Math.min(c,g);break}default:return}l.preventDefault(),t(h)},r=async l=>{e.isActive()&&(await e.pause(),Xt=!0),pt=!0,s(l)},a=l=>{pt&&s(l)},o=l=>{pt&&(s(l),pt=!1,Xt&&(e.resume(),Xt=!1))};return ee.addEventListener("mousedown",l=>void r(l)),window.addEventListener("mousemove",a),window.addEventListener("mouseup",o),window.addEventListener("keydown",n),{detach:()=>{ee==null||ee.removeEventListener("mousedown",r),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",o),window.removeEventListener("keydown",n)},refreshUI:()=>{}}}function Gr(){const i=K();for(const e of i){const t=e.matrix;if(!t)continue;const s=t.getInteractionStore();if(s.hasSelection())return{sequencerId:e.id,selectedNotes:s.getSelectedNotes()}}return null}function wd(i){const e=()=>{const o=J(),l=Gr();if(!l||l.selectedNotes.length===0){o.showError("No notes selected. Please select notes before adjusting velocity.");return}i.velocity.show(l.selectedNotes)},t=o=>{var u;if(o.key.toLowerCase()!=="v"||o.ctrlKey||o.metaKey||o.altKey)return;const l=(u=document.activeElement)==null?void 0:u.tagName,d=l==="INPUT"||l==="TEXTAREA",c=Ne();d||c||(o.preventDefault(),e())},s=o=>{o.type==="keydown"&&o.ctrlKey&&!Ve()&&Oi(!0),o.type==="keyup"&&o.key==="Control"&&Ve()&&Oi(!1)},n=o=>{t(o),s(o)},r=o=>{s(o)},a=o=>{const{editorId:l}=o.detail;l==="velocity-tool"&&e()};return window.addEventListener("keydown",n),window.addEventListener("keyup",r),document.body.addEventListener("editor-invoke",a),{detach:()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",r),document.body.removeEventListener("editor-invoke",a)},refreshUI:()=>{}}}let je=null;function Zi(i,e){const t=ce(),s=window.devicePixelRatio||1,n=e/s;function r(){if(!i.isActive())return;const a=i.getCurrentBeat(),o=a/t*n;Tt(o),kr(i,a),je=requestAnimationFrame(r)}ci(),je=requestAnimationFrame(r)}function ci(){je!==null&&(cancelAnimationFrame(je),je=null)}function Md(i){var e;Tt(0);for(const t of i.sequencers)(e=t.matrix)==null||e.setPlayheadPixelX(0)}class xd{constructor(){this.onStop=null,this.engine=H.getInstance(),this.playheadCanvasWidth=300,this.engine.setOnResumeCallback(()=>{Zi(this.engine,this.playheadCanvasWidth)}),this.engine.setOnStopCallback(()=>{var e;(e=this.onStop)==null||e.call(this)})}play(){this.engine.start(),Zi(this.engine,this.playheadCanvasWidth)}stop(){this.engine.stop(),ci(),Md(this.engine)}setOnStopCallback(e){this.onStop=e}async pause(){await this.engine.pause(),ci()}async resume(){await this.engine.resume()}toggle(){this.engine.isActive()?this.pause():this.resume()}isPlaying(){return this.engine.isActive()}getEngine(){return this.engine}setSequencers(e){this.engine.setSequencers(e)}setPlayheadCanvasWidth(e){this.playheadCanvasWidth=e}}function Ld(){const i=pe("üíæ Export"),e=P({id:"export-json",text:"Save Project",kind:"primary"}),t=m("div",{class:"h-px bg-gray-600"}),s=P({id:"export-wav",text:"Export as WAV",kind:"secondary",additionalClasses:"bg-green-600 hover:bg-green-700"}),n=P({id:"export-midi",text:"Export as MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),r=P({id:"export-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),a=m("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,s,n);return te("export-modal",[i,a,r])}let Br=0;function kd(i,e){const t=Br++,s={id:t,...at},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",r=new dr(null,s,i,i.destination,n,!0,t);return r.id=t,r.colorIndex=t,r.mute=!1,r.solo=!1,r.volume=e.volume??100/127,r.pan=e.pan??0,e.notes&&r.matrix&&r.matrix.setNotes(e.notes),r.setState({notes:e.notes,config:e.config||{},instrument:e.instrument,volume:e.volume,pan:e.pan}),r.initInstrument(),r}function Gd(){Br=0}function Bd(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=i.tempo,t=i.timeSignature[0],s=i.totalMeasures,n=i.songKey,r={v:3,t:new Date().toISOString(),c:{b:e,bpm:t,tm:s,sk:n},i:i.sequencers.map(o=>o.instrument||"sf2/fluidr3-gm/acoustic_grand_piano"),vlm:i.sequencers.map(o=>o.volume??100/127),pan:i.sequencers.map(o=>o.pan??0),tr:i.sequencers.map(o=>({n:o.notes.map(l=>[l.pitch,l.start,l.duration,l.velocity??100])}))},a=new Blob([JSON.stringify(r)],{type:"application/json"});return{url:URL.createObjectURL(a),filename:`session-${Date.now()}.json`}}async function Ed(i,e={sampleRate:44100,includePan:!0}){if(!i.tracks||i.tracks.length===0)throw new Error("No tracks to export.");const t=e.sampleRate,s=e.includePan?2:1,n=new AbortController;let r=!1;ze("Exporting Session","Rendering your session offline...",()=>{r=!0,n.abort()},!0);try{const o=60/me(),l=Math.max(...i.tracks.flatMap(y=>y.notes.map(b=>(b.start+b.duration)*o+.2))),d=new OfflineAudioContext(s,Math.ceil(t*l),t);Gd();for(const y of i.tracks)if(r||(await kd(d,y).exportToOffline(n.signal,y.notes),r))return;if(r)return;ze("Rendering Audio","Rendering audio buffer‚Ä¶",void 0,!0);const c=await d.startRendering();ze("Converting to WAV","Converting to WAV format‚Ä¶",void 0,!0);const u=Ad(c);ze("Downloading WAV","Please wait...",void 0,!0);const h=URL.createObjectURL(u),f=document.createElement("a");f.href=h,f.download=`session-${Date.now()}.wav`,f.click(),URL.revokeObjectURL(h)}catch(a){r?console.warn("Export operation was cancelled by the user."):console.error("Error during export:",a)}finally{hi(!0)}}function Ad(i){const e=i.numberOfChannels,t=i.length*e*2,s=new DataView(new ArrayBuffer(44+t)),n=(a,o)=>{for(let l=0;l<o.length;l++)s.setUint8(a+l,o.charCodeAt(l))};n(0,"RIFF"),s.setUint32(4,36+t,!0),n(8,"WAVE"),n(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,e,!0),s.setUint32(24,i.sampleRate,!0),s.setUint32(28,i.sampleRate*e*2,!0),s.setUint16(32,e*2,!0),s.setUint16(34,16,!0),n(36,"data"),s.setUint32(40,t,!0);let r=44;for(let a=0;a<i.length;a++)for(let o=0;o<e;o++){const l=i.getChannelData(o)[a],d=Math.max(-1,Math.min(1,l));s.setInt16(r,d*32767,!0),r+=2}return new Blob([s.buffer],{type:"audio/wav"})}async function Td(i){var l,d,c,u;const e=await i.text();let t;try{t=JSON.parse(e)}catch{throw new Error("Invalid JSON format.")}if(!Array.isArray(t.tr))throw new Error("Missing or invalid `tr` (tracks) array.");const s={bpm:((l=t.c)==null?void 0:l.b)??120,beatsPerMeasure:((d=t.c)==null?void 0:d.bpm)??4,totalMeasures:((c=t.c)==null?void 0:c.tm)??8,songKey:((u=t.c)==null?void 0:u.sk)??"CM"},n=Array.isArray(t.i)?t.i:[],r=Array.isArray(t.vlm)?t.vlm:[],a=Array.isArray(t.pan)?t.pan:[],o=t.tr.map((h,f)=>{if(!Array.isArray(h.n))throw new Error(`Track ${f} missing \`n\` (notes) array.`);const y=h.n.map(([v,S,_,C])=>({pitch:v,start:S,duration:_,velocity:C??100})),b=n[f]||"sf2/fluidr3-gm/acoustic_grand_piano",g=r[f],p=a[f];return{notes:y,instrument:b,volume:typeof g=="number"?g:void 0,pan:typeof p=="number"?p:void 0,config:{}}});return{globalConfig:s,tracks:o}}function Id(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var n=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return i[s]}})}),t}var ve={},mt={},Vt,Qi;function Rd(){if(Qi)return Vt;Qi=1;function i(n){var r=new s(n),a=r.readChunk();if(a.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var o=e(a.data),l=[],d=0;!r.eof()&&d<o.numTracks;d++){var c=r.readChunk();if(c.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var u=t(c.data);l.push(u)}return{header:o,tracks:l}}function e(n){var r=new s(n),a=r.readUInt16(),o=r.readUInt16(),l={format:a,numTracks:o},d=r.readUInt16();return d&32768?(l.framesPerSecond=256-(d>>8),l.ticksPerFrame=d&255):l.ticksPerBeat=d,l}function t(n){for(var r=new s(n),a=[];!r.eof();){var o=d();a.push(o)}return a;var l;function d(){var c={};c.deltaTime=r.readVarInt();var u=r.readUInt8();if((u&240)===240)if(u===255){c.meta=!0;var h=r.readUInt8(),f=r.readVarInt();switch(h){case 0:if(c.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return c.number=r.readUInt16(),c;case 1:return c.type="text",c.text=r.readString(f),c;case 2:return c.type="copyrightNotice",c.text=r.readString(f),c;case 3:return c.type="trackName",c.text=r.readString(f),c;case 4:return c.type="instrumentName",c.text=r.readString(f),c;case 5:return c.type="lyrics",c.text=r.readString(f),c;case 6:return c.type="marker",c.text=r.readString(f),c;case 7:return c.type="cuePoint",c.text=r.readString(f),c;case 32:if(c.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return c.channel=r.readUInt8(),c;case 33:if(c.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return c.port=r.readUInt8(),c;case 47:if(c.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return c;case 81:if(c.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return c.microsecondsPerBeat=r.readUInt24(),c;case 84:if(c.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var y=r.readUInt8(),b={0:24,32:25,64:29,96:30};return c.frameRate=b[y&96],c.hour=y&31,c.min=r.readUInt8(),c.sec=r.readUInt8(),c.frame=r.readUInt8(),c.subFrame=r.readUInt8(),c;case 88:if(c.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return c.numerator=r.readUInt8(),c.denominator=1<<r.readUInt8(),f===4?(c.metronome=r.readUInt8(),c.thirtyseconds=r.readUInt8()):(c.metronome=36,c.thirtyseconds=8),c;case 89:if(c.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return c.key=r.readInt8(),c.scale=r.readUInt8(),c;case 127:return c.type="sequencerSpecific",c.data=r.readBytes(f),c;default:return c.type="unknownMeta",c.data=r.readBytes(f),c.metatypeByte=h,c}}else if(u==240){c.type="sysEx";var f=r.readVarInt();return c.data=r.readBytes(f),c}else if(u==247){c.type="endSysEx";var f=r.readVarInt();return c.data=r.readBytes(f),c}else throw"Unrecognised MIDI event type byte: "+u;else{var g;if((u&128)===0){if(l===null)throw"Running status byte encountered before status byte";g=u,u=l,c.running=!0}else g=r.readUInt8(),l=u;var p=u>>4;switch(c.channel=u&15,p){case 8:return c.type="noteOff",c.noteNumber=g,c.velocity=r.readUInt8(),c;case 9:var v=r.readUInt8();return c.type=v===0?"noteOff":"noteOn",c.noteNumber=g,c.velocity=v,v===0&&(c.byte9=!0),c;case 10:return c.type="noteAftertouch",c.noteNumber=g,c.amount=r.readUInt8(),c;case 11:return c.type="controller",c.controllerType=g,c.value=r.readUInt8(),c;case 12:return c.type="programChange",c.programNumber=g,c;case 13:return c.type="channelAftertouch",c.amount=g,c;case 14:return c.type="pitchBend",c.value=g+(r.readUInt8()<<7)-8192,c;default:throw"Unrecognised MIDI event type: "+p}}}}function s(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},s.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},s.prototype.readUInt16=function(){var n=this.readUInt8(),r=this.readUInt8();return(n<<8)+r},s.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},s.prototype.readUInt24=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8();return(n<<16)+(r<<8)+a},s.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},s.prototype.readUInt32=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8(),o=this.readUInt8();return(n<<24)+(r<<16)+(a<<8)+o},s.prototype.readBytes=function(n){var r=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,r},s.prototype.readString=function(n){var r=this.readBytes(n);return String.fromCharCode.apply(null,r)},s.prototype.readVarInt=function(){for(var n=0;!this.eof();){var r=this.readUInt8();if(r&128)n+=r&127,n<<=7;else return n+r}return n},s.prototype.readChunk=function(){var n=this.readString(4),r=this.readUInt32(),a=this.readBytes(r);return{id:n,length:r,data:a}},Vt=i,Vt}var Yt,es;function Fd(){if(es)return Yt;es=1;function i(r,a){if(typeof r!="object")throw"Invalid MIDI data";a=a||{};var o=r.header||{},l=r.tracks||[],d,c=l.length,u=new n;for(e(u,o,c),d=0;d<c;d++)t(u,l[d],a);return u.buffer}function e(r,a,o){var l=a.format==null?1:a.format,d=128;a.timeDivision?d=a.timeDivision:a.ticksPerFrame&&a.framesPerSecond?d=-(a.framesPerSecond&255)<<8|a.ticksPerFrame&255:a.ticksPerBeat&&(d=a.ticksPerBeat&32767);var c=new n;c.writeUInt16(l),c.writeUInt16(o),c.writeUInt16(d),r.writeChunk("MThd",c.buffer)}function t(r,a,o){var l=new n,d,c=a.length,u=null;for(d=0;d<c;d++)(o.running===!1||!o.running&&!a[d].running)&&(u=null),u=s(l,a[d],u,o.useByte9ForNoteOff);r.writeChunk("MTrk",l.buffer)}function s(r,a,o,l){var d=a.type,c=a.deltaTime,u=a.text||"",h=a.data||[],f=null;switch(r.writeVarInt(c),d){case"sequenceNumber":r.writeUInt8(255),r.writeUInt8(0),r.writeVarInt(2),r.writeUInt16(a.number);break;case"text":r.writeUInt8(255),r.writeUInt8(1),r.writeVarInt(u.length),r.writeString(u);break;case"copyrightNotice":r.writeUInt8(255),r.writeUInt8(2),r.writeVarInt(u.length),r.writeString(u);break;case"trackName":r.writeUInt8(255),r.writeUInt8(3),r.writeVarInt(u.length),r.writeString(u);break;case"instrumentName":r.writeUInt8(255),r.writeUInt8(4),r.writeVarInt(u.length),r.writeString(u);break;case"lyrics":r.writeUInt8(255),r.writeUInt8(5),r.writeVarInt(u.length),r.writeString(u);break;case"marker":r.writeUInt8(255),r.writeUInt8(6),r.writeVarInt(u.length),r.writeString(u);break;case"cuePoint":r.writeUInt8(255),r.writeUInt8(7),r.writeVarInt(u.length),r.writeString(u);break;case"channelPrefix":r.writeUInt8(255),r.writeUInt8(32),r.writeVarInt(1),r.writeUInt8(a.channel);break;case"portPrefix":r.writeUInt8(255),r.writeUInt8(33),r.writeVarInt(1),r.writeUInt8(a.port);break;case"endOfTrack":r.writeUInt8(255),r.writeUInt8(47),r.writeVarInt(0);break;case"setTempo":r.writeUInt8(255),r.writeUInt8(81),r.writeVarInt(3),r.writeUInt24(a.microsecondsPerBeat);break;case"smpteOffset":r.writeUInt8(255),r.writeUInt8(84),r.writeVarInt(5);var y={24:0,25:32,29:64,30:96},b=a.hour&31|y[a.frameRate];r.writeUInt8(b),r.writeUInt8(a.min),r.writeUInt8(a.sec),r.writeUInt8(a.frame),r.writeUInt8(a.subFrame);break;case"timeSignature":r.writeUInt8(255),r.writeUInt8(88),r.writeVarInt(4),r.writeUInt8(a.numerator);var g=Math.floor(Math.log(a.denominator)/Math.LN2)&255;r.writeUInt8(g),r.writeUInt8(a.metronome),r.writeUInt8(a.thirtyseconds||8);break;case"keySignature":r.writeUInt8(255),r.writeUInt8(89),r.writeVarInt(2),r.writeInt8(a.key),r.writeUInt8(a.scale);break;case"sequencerSpecific":r.writeUInt8(255),r.writeUInt8(127),r.writeVarInt(h.length),r.writeBytes(h);break;case"unknownMeta":a.metatypeByte!=null&&(r.writeUInt8(255),r.writeUInt8(a.metatypeByte),r.writeVarInt(h.length),r.writeBytes(h));break;case"sysEx":r.writeUInt8(240),r.writeVarInt(h.length),r.writeBytes(h);break;case"endSysEx":r.writeUInt8(247),r.writeVarInt(h.length),r.writeBytes(h);break;case"noteOff":var p=l!==!1&&a.byte9||l&&a.velocity==0?144:128;f=p|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteOn":f=144|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteAftertouch":f=160|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.amount);break;case"controller":f=176|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.controllerType),r.writeUInt8(a.value);break;case"programChange":f=192|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.programNumber);break;case"channelAftertouch":f=208|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.amount);break;case"pitchBend":f=224|a.channel,f!==o&&r.writeUInt8(f);var v=8192+a.value,S=v&127,_=v>>7&127;r.writeUInt8(S),r.writeUInt8(_);break;default:throw"Unrecognized event type: "+d}return f}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(r){this.buffer.push(r&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(r){var a=r>>8&255,o=r&255;this.writeUInt8(a),this.writeUInt8(o)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(r){var a=r>>16&255,o=r>>8&255,l=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(l)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(r){var a=r>>24&255,o=r>>16&255,l=r>>8&255,d=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(l),this.writeUInt8(d)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(r){this.buffer=this.buffer.concat(Array.prototype.slice.call(r,0))},n.prototype.writeString=function(r){var a,o=r.length,l=[];for(a=0;a<o;a++)l.push(r.codePointAt(a));this.writeBytes(l)},n.prototype.writeVarInt=function(r){if(r<0)throw"Cannot write negative variable-length integer";if(r<=127)this.writeUInt8(r);else{var a=r,o=[];for(o.push(a&127),a>>=7;a;){var l=a&127|128;o.push(l),a>>=7}this.writeBytes(o.reverse())}},n.prototype.writeChunk=function(r,a){this.writeString(r),this.writeUInt32(a.length),this.writeBytes(a)},Yt=i,Yt}var ts;function Er(){return ts||(ts=1,mt.parseMidi=Rd(),mt.writeMidi=Fd()),mt}var Zt={},Se={},is;function Ar(){if(is)return Se;is=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.insert=Se.search=void 0;function i(t,s,n){n===void 0&&(n="ticks");var r=0,a=t.length,o=a;if(a>0&&t[a-1][n]<=s)return a-1;for(;r<o;){var l=Math.floor(r+(o-r)/2),d=t[l],c=t[l+1];if(d[n]===s){for(var u=l;u<t.length;u++){var h=t[u];h[n]===s&&(l=u)}return l}else{if(d[n]<s&&c[n]>s)return l;d[n]>s?o=l:d[n]<s&&(r=l+1)}}return-1}Se.search=i;function e(t,s,n){if(n===void 0&&(n="ticks"),t.length){var r=i(t,s[n],n);t.splice(r+1,0,s)}else t.push(s)}return Se.insert=e,Se}var ss;function di(){return ss||(ss=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.keySignatureKeys=void 0;var e=Ar(),t=new WeakMap;i.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function n(r){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",t.set(this,480),r){t.set(this,r.header.ticksPerBeat),r.tracks.forEach(function(l){l.forEach(function(d){d.meta&&(d.type==="timeSignature"?a.timeSignatures.push({ticks:d.absoluteTime,timeSignature:[d.numerator,d.denominator]}):d.type==="setTempo"?a.tempos.push({bpm:6e7/d.microsecondsPerBeat,ticks:d.absoluteTime}):d.type==="keySignature"&&a.keySignatures.push({key:i.keySignatureKeys[d.key+7],scale:d.scale===0?"major":"minor",ticks:d.absoluteTime}))})});var o=0;r.tracks[0].forEach(function(l){o+=l.deltaTime,l.meta&&(l.type==="trackName"?a.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&a.meta.push({text:l.text,ticks:o,type:l.type}))}),this.update()}}return n.prototype.update=function(){var r=this,a=0,o=0;this.tempos.sort(function(l,d){return l.ticks-d.ticks}),this.tempos.forEach(function(l,d){var c=d>0?r.tempos[d-1].bpm:r.tempos[0].bpm,u=l.ticks/r.ppq-o,h=60/c*u;l.time=h+a,a=l.time,o+=u}),this.timeSignatures.sort(function(l,d){return l.ticks-d.ticks}),this.timeSignatures.forEach(function(l,d){var c=d>0?r.timeSignatures[d-1]:r.timeSignatures[0],u=(l.ticks-c.ticks)/r.ppq,h=u/c.timeSignature[0]/(c.timeSignature[1]/4);c.measures=c.measures||0,l.measures=h+c.measures})},n.prototype.ticksToSeconds=function(r){var a=(0,e.search)(this.tempos,r);if(a!==-1){var o=this.tempos[a],l=o.time,d=(r-o.ticks)/this.ppq;return l+60/o.bpm*d}else{var c=r/this.ppq;return 60/120*c}},n.prototype.ticksToMeasures=function(r){var a=(0,e.search)(this.timeSignatures,r);if(a!==-1){var o=this.timeSignatures[a],l=(r-o.ticks)/this.ppq;return o.measures+l/(o.timeSignature[0]/o.timeSignature[1])/4}else return r/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(r){var a=(0,e.search)(this.tempos,r,"time");if(a!==-1){var o=this.tempos[a],l=o.time,d=r-l,c=d/(60/o.bpm);return Math.round(o.ticks+c*this.ppq)}else{var u=r/.5;return Math.round(u*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(r){return{bpm:r.bpm,ticks:r.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(r){this.name=r.name,this.tempos=r.tempos.map(function(a){return Object.assign({},a)}),this.timeSignatures=r.timeSignatures.map(function(a){return Object.assign({},a)}),this.keySignatures=r.keySignatures.map(function(a){return Object.assign({},a)}),this.meta=r.meta.map(function(a){return Object.assign({},a)}),t.set(this,r.ppq),this.update()},n.prototype.setTempo=function(r){this.tempos=[{bpm:r,ticks:0}],this.update()},n}();i.Header=s}(Zt)),Zt}var Pe={},Qt={},rs;function Tr(){return rs||(rs=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ControlChange=i.controlChangeIds=i.controlChangeNames=void 0,i.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},i.controlChangeIds=Object.keys(i.controlChangeNames).reduce(function(n,r){return n[i.controlChangeNames[r]]=r,n},{});var e=new WeakMap,t=new WeakMap,s=function(){function n(r,a){e.set(this,a),t.set(this,r.controllerType),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(n.prototype,"number",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return i.controlChangeNames[this.number]?i.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var r=e.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var a=e.get(this);this.ticks=a.secondsToTicks(r)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();i.ControlChange=s}(Qt)),Qt}var De={},ns;function Od(){if(ns)return De;ns=1,Object.defineProperty(De,"__esModule",{value:!0}),De.createControlChanges=void 0;var i=Tr();function e(){return new Proxy({},{get:function(t,s){if(t[s])return t[s];if(i.controlChangeIds.hasOwnProperty(s))return t[i.controlChangeIds[s]]},set:function(t,s,n){return i.controlChangeIds.hasOwnProperty(s)?t[i.controlChangeIds[s]]=n:t[s]=n,!0}})}return De.createControlChanges=e,De}var qe={},as;function Ud(){if(as)return qe;as=1,Object.defineProperty(qe,"__esModule",{value:!0}),qe.PitchBend=void 0;var i=new WeakMap,e=function(){function t(s,n){i.set(this,n),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(t.prototype,"time",{get:function(){var s=i.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=i.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return qe.PitchBend=e,qe}var Ke={},de={},os;function Pd(){return os||(os=1,Object.defineProperty(de,"__esModule",{value:!0}),de.DrumKitByPatchID=de.InstrumentFamilyByID=de.instrumentByPatchID=void 0,de.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],de.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],de.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),de}var ls;function Dd(){if(ls)return Ke;ls=1,Object.defineProperty(Ke,"__esModule",{value:!0}),Ke.Instrument=void 0;var i=Pd(),e=new WeakMap,t=function(){function s(n,r){if(this.number=0,e.set(this,r),this.number=0,n){var a=n.find(function(o){return o.type==="programChange"});a&&(this.number=a.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?i.DrumKitByPatchID[this.number]:i.instrumentByPatchID[this.number]},set:function(n){var r=i.instrumentByPatchID.indexOf(n);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":i.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var n=e.get(this);return n.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(n){this.number=n.number},s}();return Ke.Instrument=t,Ke}var He={},cs;function qd(){if(cs)return He;cs=1,Object.defineProperty(He,"__esModule",{value:!0}),He.Note=void 0;function i(a){var o=Math.floor(a/12)-1;return e(a)+o.toString()}function e(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=a%12;return o[l]}function t(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(a)}var s=function(){var a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(l){var d=a.exec(l),c=d[1],u=d[2],h=o[c.toLowerCase()];return h+(parseInt(u,10)+1)*12}}(),n=new WeakMap,r=function(){function a(o,l,d){n.set(this,d),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=l.velocity,this.ticks=o.ticks,this.durationTicks=l.ticks-o.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return i(this.midi)},set:function(o){this.midi=s(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var l=o-this.octave;this.midi+=l*12},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(o){this.midi=12*(this.octave+1)+t(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var l=n.get(this),d=l.secondsToTicks(this.time+o);this.durationTicks=d-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var l=n.get(this);this.ticks=l.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){var o=n.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return He.Note=r,He}var ds;function us(){if(ds)return Pe;ds=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.Track=void 0;var i=Ar(),e=Tr(),t=Od(),s=Ud(),n=Dd(),r=qd(),a=new WeakMap,o=function(){function l(d,c){var u=this;if(this.name="",this.notes=[],this.controlChanges=(0,t.createControlChanges)(),this.pitchBends=[],a.set(this,c),d){var h=d.find(function(_){return _.type==="trackName"});this.name=h?h.text:""}if(this.instrument=new n.Instrument(d,this),this.channel=0,d){for(var f=d.filter(function(_){return _.type==="noteOn"}),y=d.filter(function(_){return _.type==="noteOff"}),b=function(){var _=f.shift();g.channel=_.channel;var C=y.findIndex(function(w){return w.noteNumber===_.noteNumber&&w.absoluteTime>=_.absoluteTime});if(C!==-1){var N=y.splice(C,1)[0];g.addNote({durationTicks:N.absoluteTime-_.absoluteTime,midi:_.noteNumber,noteOffVelocity:N.velocity/127,ticks:_.absoluteTime,velocity:_.velocity/127})}},g=this;f.length;)b();var p=d.filter(function(_){return _.type==="controller"});p.forEach(function(_){u.addCC({number:_.controllerType,ticks:_.absoluteTime,value:_.value/127})});var v=d.filter(function(_){return _.type==="pitchBend"});v.forEach(function(_){u.addPitchBend({ticks:_.absoluteTime,value:_.value/Math.pow(2,13)})});var S=d.find(function(_){return _.type==="endOfTrack"});this.endOfTrackTicks=S!==void 0?S.absoluteTime:void 0}}return l.prototype.addNote=function(d){var c=a.get(this),u=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},c);return Object.assign(u,d),(0,i.insert)(this.notes,u,"ticks"),this},l.prototype.addCC=function(d){var c=a.get(this),u=new e.ControlChange({controllerType:d.number},c);return delete d.number,Object.assign(u,d),Array.isArray(this.controlChanges[u.number])||(this.controlChanges[u.number]=[]),(0,i.insert)(this.controlChanges[u.number],u,"ticks"),this},l.prototype.addPitchBend=function(d){var c=a.get(this),u=new s.PitchBend({},c);return Object.assign(u,d),(0,i.insert)(this.pitchBends,u,"ticks"),this},Object.defineProperty(l.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,c=0;c<this.notes.length-1;c++){var u=this.notes[c].time+this.notes[c].duration;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var d=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,c=0;c<this.notes.length-1;c++){var u=this.notes[c].ticks+this.notes[c].durationTicks;d<u&&(d=u)}return d},enumerable:!1,configurable:!0}),l.prototype.fromJSON=function(d){var c=this;this.name=d.name,this.channel=d.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(d.instrument),d.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=d.endOfTrackTicks);for(var u in d.controlChanges)d.controlChanges[u]&&d.controlChanges[u].forEach(function(h){c.addCC({number:h.number,ticks:h.ticks,value:h.value})});d.notes.forEach(function(h){c.addNote({durationTicks:h.durationTicks,midi:h.midi,ticks:h.ticks,velocity:h.velocity})})},l.prototype.toJSON=function(){for(var d={},c=0;c<127;c++)this.controlChanges.hasOwnProperty(c)&&(d[c]=this.controlChanges[c].map(function(h){return h.toJSON()}));var u={channel:this.channel,controlChanges:d,pitchBends:this.pitchBends.map(function(h){return h.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(h){return h.toJSON()})};return this.endOfTrackTicks!==void 0&&(u.endOfTrackTicks=this.endOfTrackTicks),u},l}();return Pe.Track=o,Pe}var Ce={};function Kd(i){var e=[];return Ir(i,e),e}function Ir(i,e){for(var t=0;t<i.length;t++){var s=i[t];Array.isArray(s)?Ir(s,e):e.push(s)}}const Hd=Object.freeze(Object.defineProperty({__proto__:null,flatten:Kd},Symbol.toStringTag,{value:"Module"})),zd=Id(Hd);var hs;function $d(){if(hs)return Ce;hs=1;var i=Ce&&Ce.__spreadArray||function(p,v,S){if(S||arguments.length===2)for(var _=0,C=v.length,N;_<C;_++)(N||!(_ in v))&&(N||(N=Array.prototype.slice.call(v,0,_)),N[_]=v[_]);return p.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(Ce,"__esModule",{value:!0}),Ce.encode=void 0;var e=Er(),t=di(),s=zd;function n(p,v){return[{absoluteTime:p.ticks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOn",velocity:Math.floor(p.velocity*127)},{absoluteTime:p.ticks+p.durationTicks,channel:v,deltaTime:0,noteNumber:p.midi,type:"noteOff",velocity:Math.floor(p.noteOffVelocity*127)}]}function r(p){return(0,s.flatten)(p.notes.map(function(v){return n(v,p.channel)}))}function a(p,v){return{absoluteTime:p.ticks,channel:v,controllerType:p.number,deltaTime:0,type:"controller",value:Math.floor(p.value*127)}}function o(p){for(var v=[],S=0;S<127;S++)p.controlChanges.hasOwnProperty(S)&&p.controlChanges[S].forEach(function(_){v.push(a(_,p.channel))});return v}function l(p,v){return{absoluteTime:p.ticks,channel:v,deltaTime:0,type:"pitchBend",value:p.value}}function d(p){var v=[];return p.pitchBends.forEach(function(S){v.push(l(S,p.channel))}),v}function c(p){return{absoluteTime:0,channel:p.channel,deltaTime:0,programNumber:p.instrument.number,type:"programChange"}}function u(p){return{absoluteTime:0,deltaTime:0,meta:!0,text:p,type:"trackName"}}function h(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/p.bpm),type:"setTempo"}}function f(p){return{absoluteTime:p.ticks,deltaTime:0,denominator:p.timeSignature[1],meta:!0,metronome:24,numerator:p.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function y(p){var v=t.keySignatureKeys.indexOf(p.key);return{absoluteTime:p.ticks,deltaTime:0,key:v+7,meta:!0,scale:p.scale==="major"?0:1,type:"keySignature"}}function b(p){return{absoluteTime:p.ticks,deltaTime:0,meta:!0,text:p.text,type:p.type}}function g(p){var v={header:{format:1,numTracks:p.tracks.length+1,ticksPerBeat:p.header.ppq},tracks:i([i(i(i(i([{absoluteTime:0,deltaTime:0,meta:!0,text:p.header.name,type:"trackName"}],p.header.keySignatures.map(function(S){return y(S)}),!0),p.header.meta.map(function(S){return b(S)}),!0),p.header.tempos.map(function(S){return h(S)}),!0),p.header.timeSignatures.map(function(S){return f(S)}),!0)],p.tracks.map(function(S){return i(i(i([u(S.name),c(S)],r(S),!0),o(S),!0),d(S),!0)}),!0)};return v.tracks=v.tracks.map(function(S){S=S.sort(function(C,N){return C.absoluteTime-N.absoluteTime});var _=0;return S.forEach(function(C){C.deltaTime=C.absoluteTime-_,_=C.absoluteTime,delete C.absoluteTime}),S.push({deltaTime:0,meta:!0,type:"endOfTrack"}),S}),new Uint8Array((0,e.writeMidi)(v))}return Ce.encode=g,Ce}var fs;function Jd(){return fs||(fs=1,function(i){var e=ve&&ve.__awaiter||function(u,h,f,y){function b(g){return g instanceof f?g:new f(function(p){p(g)})}return new(f||(f=Promise))(function(g,p){function v(C){try{_(y.next(C))}catch(N){p(N)}}function S(C){try{_(y.throw(C))}catch(N){p(N)}}function _(C){C.done?g(C.value):b(C.value).then(v,S)}_((y=y.apply(u,h||[])).next())})},t=ve&&ve.__generator||function(u,h){var f={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},y,b,g,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(_){return function(C){return S([_,C])}}function S(_){if(y)throw new TypeError("Generator is already executing.");for(;f;)try{if(y=1,b&&(g=_[0]&2?b.return:_[0]?b.throw||((g=b.return)&&g.call(b),0):b.next)&&!(g=g.call(b,_[1])).done)return g;switch(b=0,g&&(_=[_[0]&2,g.value]),_[0]){case 0:case 1:g=_;break;case 4:return f.label++,{value:_[1],done:!1};case 5:f.label++,b=_[1],_=[0];continue;case 7:_=f.ops.pop(),f.trys.pop();continue;default:if(g=f.trys,!(g=g.length>0&&g[g.length-1])&&(_[0]===6||_[0]===2)){f=0;continue}if(_[0]===3&&(!g||_[1]>g[0]&&_[1]<g[3])){f.label=_[1];break}if(_[0]===6&&f.label<g[1]){f.label=g[1],g=_;break}if(g&&f.label<g[2]){f.label=g[2],f.ops.push(_);break}g[2]&&f.ops.pop(),f.trys.pop();continue}_=h.call(u,f)}catch(C){_=[6,C],b=0}finally{y=g=0}if(_[0]&5)throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.Track=i.Midi=void 0;var s=Er(),n=di(),r=us(),a=$d(),o=function(){function u(h){var f=this,y=null;if(h){var b=h instanceof ArrayBuffer?new Uint8Array(h):h;y=(0,s.parseMidi)(b),y.tracks.forEach(function(g){var p=0;g.forEach(function(v){p+=v.deltaTime,v.absoluteTime=p})}),y.tracks=c(y.tracks)}this.header=new n.Header(y),this.tracks=[],h&&(this.tracks=y.tracks.map(function(g){return new r.Track(g,f.header)}),y.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return u.fromUrl=function(h){return e(this,void 0,void 0,function(){var f,y;return t(this,function(b){switch(b.label){case 0:return[4,fetch(h)];case 1:return f=b.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return y=b.sent(),[2,new u(y)];case 3:throw new Error("Could not load '".concat(h,"'"))}})})},Object.defineProperty(u.prototype,"name",{get:function(){return this.header.name},set:function(h){this.header.name=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var h=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){var h=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),u.prototype.addTrack=function(){var h=new r.Track(void 0,this.header);return this.tracks.push(h),h},u.prototype.toArray=function(){return(0,a.encode)(this)},u.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(h){return h.toJSON()})}},u.prototype.fromJSON=function(h){var f=this;this.header=new n.Header,this.header.fromJSON(h.header),this.tracks=h.tracks.map(function(y){var b=new r.Track(void 0,f.header);return b.fromJSON(y),b})},u.prototype.clone=function(){var h=new u;return h.fromJSON(this.toJSON()),h},u}();i.Midi=o;var l=us();Object.defineProperty(i,"Track",{enumerable:!0,get:function(){return l.Track}});var d=di();Object.defineProperty(i,"Header",{enumerable:!0,get:function(){return d.Header}});function c(u){for(var h=[],f=0;f<u.length;f++)for(var y=h.length,b=new Map,g=Array(16).fill(0),p=0,v=u[f];p<v.length;p++){var S=v[p],_=y,C=S.channel;if(C!==void 0){S.type==="programChange"&&(g[C]=S.programNumber);var N=g[C],w="".concat(N," ").concat(C);b.has(w)?_=b.get(w):(_=y+b.size,b.set(w,_))}h[_]||h.push([]),h[_].push(S)}return h}}(ve)),ve}var Rr=Jd();const Fr=["acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honkytonk_piano","electric_piano_1","electric_piano_2","harpsichord","clavinet","celesta","glockenspiel","music_box","vibraphone","marimba","xylophone","tubular_bells","dulcimer","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","guitar_harmonics","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass","slap_bass_1","slap_bass_2","synth_bass_1","synth_bass_2","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synth_strings_1","synth_strings_2","choir_aahs","voice_oohs","synth_choir","orchestra_hit","trumpet","trombone","tuba","muted_trumpet","french_horn","brass_section","synth_brass_1","synth_brass_2","soprano_sax","alto_sax","tenor_sax","baritone_sax","oboe","english_horn","bassoon","clarinet","piccolo","flute","recorder","pan_flute","blown_bottle","shakuhachi","whistle","ocarina","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","sitar","banjo","shamisen","koto","kalimba","bagpipe","fiddle","shanai","tinkle_bell","agogo","steel_drums","woodblock","taiko_drum","melodic_tom","synth_drum","reverse_cymbal","guitar_fret_noise","breath_noise","seashore","bird_tweet","telephone_ring","helicopter","applause","gunshot"];function Wd(i){const e=i.split("/"),s=e[e.length-1].trim().toLowerCase().replace(/\s+/g,"_"),n=Fr.findIndex(r=>r===s);return n!==-1?n:(s.includes("drum")||s.includes("drummachine"),0)}async function jd(i){var f;const e=await i.arrayBuffer(),t=new Rr.Midi(e),s=t.header.tempos[0],n=t.header.timeSignatures[0],r=(s==null?void 0:s.bpm)??120,a=((f=n==null?void 0:n.timeSignature)==null?void 0:f[0])??4,l=Math.max(0,...t.tracks.flatMap(y=>y.notes.map(b=>b.time+b.duration)))*(r/60),d=Math.ceil(l/a)||8,c={bpm:r,beatsPerMeasure:a,totalMeasures:d,songKey:"CM"},u=await Un(),h=t.tracks.map(y=>{const b=y.notes.map(N=>({pitch:N.name,start:N.time*(r/60),duration:N.duration*(r/60),velocity:Math.max(1,Math.min(127,Math.round(N.velocity*127)))}));let g=y.instrument.number;(g===void 0||g===0)&&(g=y.channel===9?0:y.channel%128);const p=y.controlChanges[7]||[],v=y.controlChanges[10]||[],S=p.length>0?p[0].value:void 0,_=v.length>0?v[0].value*2-1:void 0;let C;if(y.channel===9){const N=Xn(g);N?C=`webaudiofont/${N.library}/${N.displayName}`:C=`sf2/drummachines/${u.includes("LM-2")?"LM-2":u[0]??"TR-808"}`}else C=`sf2/fluidr3-gm/${Fr[g]||"acoustic_grand_piano"}`;return{notes:b,instrument:C,volume:S,pan:_,config:{}}});return{globalConfig:c,tracks:h}}async function Xd(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=new Rr.Midi;e.header.setTempo(i.tempo),e.header.timeSignatures.push({ticks:0,timeSignature:i.timeSignature});for(const[n,r]of i.sequencers.entries()){const a=e.addTrack(),o=r.instrument.toLowerCase().includes("drum");a.channel=o?9:n%16;const l=Wd(r.instrument);if(a.instrument.number=l,typeof r.volume=="number"&&a.addCC({number:7,time:0,value:Math.max(0,Math.min(1,r.volume))}),typeof r.pan=="number"){const d=(r.pan+1)/2;a.addCC({number:10,time:0,value:Math.max(0,Math.min(1,d))})}for(const d of r.notes){const c=W(d.pitch),u=Math.max(.01,Math.min(1,(d.velocity??100)/127));if(c===null)continue;const h=ps(d.start,i.tempo),f=ps(d.duration,i.tempo);a.addNote({midi:c,time:h,duration:f,velocity:u})}}const t=new Blob([e.toArray()],{type:"audio/midi"});return{url:URL.createObjectURL(t),filename:`session-${Date.now()}.mid`}}function ps(i,e){return 60/e*i}function ms(i,e){const t=H.getInstance();t.isActive()&&t.pause(),xi(e.bpm),Li(e.beatsPerMeasure),ki(e.totalMeasures),_r(e.songKey);const s=document.getElementById("tempo-input");s&&(s.value=String(me()));const n=document.getElementById("measures-input");n&&(n.value=String(Gi())),rl();for(const[o,l]of i.entries()){const d=o,c=l.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",u=l.notes||[],h=l.volume,f=l.pan;T({type:"CREATE_SEQUENCER",id:d,instrument:c,notes:structuredClone(u),volume:h,pan:f,config:{...l.config||{}}},Ni(d))}T(wi("Session Loaded"),mr("Session Loaded"));const r=K();ja();const a=document.getElementById("global-mini-contour");a&&vc(a,r),Tt(0)}class Oe{static async save(e){const t=D();if(e==="json"){const{url:s,filename:n}=Bd(t);Oe.download(s,n)}else if(e==="midi"){const{url:s,filename:n}=await Xd(t);Oe.download(s,n)}else throw new Error("Unsupported export format.")}static async saveWavWithOptions(e){const t=D(),s=K();try{const n={globalConfig:{bpm:t.tempo,beatsPerMeasure:t.timeSignature[0],totalMeasures:t.totalMeasures,songKey:t.songKey},tracks:s.map(r=>({notes:r.notes,instrument:r.instrumentName,config:r.config,volume:r.volume,pan:r.pan}))};await Ed(n,e)}catch(n){alert("Failed to export WAV: "+(n instanceof Error?n.message:"Unknown error"))}}static async load(e){var t;try{const s=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();if(s==="json"){const{tracks:n,globalConfig:r}=await Td(e);ms(n,r)}else if(s==="mid"||s==="midi"){const{tracks:n,globalConfig:r}=await jd(e);ms(n,r)}else throw new Error("Unsupported file type.")}catch(s){alert("Failed to load file: "+(s.message||"Unknown error"))}}static download(e,t){const s=document.createElement("a");s.href=e,s.download=t,s.click(),URL.revokeObjectURL(e)}}function Vd(i,e){const t=i.querySelector("#export-cancel"),s=i.querySelector("#export-json"),n=i.querySelector("#export-wav"),r=i.querySelector("#export-midi"),a=()=>{i.classList.add("hidden")},o=async l=>{l==="wav"?(a(),e()):(await Oe.save(l),a())};return t==null||t.addEventListener("click",a),s==null||s.addEventListener("click",()=>o("json")),n==null||n.addEventListener("click",()=>o("wav")),r==null||r.addEventListener("click",()=>o("midi")),{detach:()=>{t==null||t.removeEventListener("click",a),s==null||s.removeEventListener("click",()=>o("json")),n==null||n.removeEventListener("click",()=>o("wav")),r==null||r.removeEventListener("click",()=>o("midi"))},refreshUI:()=>{}}}class Yd{constructor(e){this.detachFn=null,this.modal=Ld(),document.body.appendChild(this.modal);const t=Vd(this.modal,e);this.detachFn=t.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Zd({id:i,label:e,options:t}){const s=O(),n=m("select",{id:i,class:["w-[80px] h-[40px] text-sm font-semibold rounded px-2 cursor-pointer",s.surfaceBackground,s.textColor,s.borderColor].join(" ")},...t.map(r=>m("option",{value:r.value},r.label)));return e?m("div",{class:"flex flex-col items-start gap-1"},Y(e),n):n}class Qd{constructor(){const e=O();this.sampleRateSelect=Zd({id:"save-wav-sample-rate",options:[{value:"44100",label:"44,100 Hz (CD Quality)"},{value:"32000",label:"32,000 Hz"},{value:"22050",label:"22,050 Hz (Faster Export)"}]}),this.includePanCheckbox=m("input",{id:"save-wav-include-pan",type:"checkbox",checked:!0,class:"accent-purple-500"}),this.cancelButton=P({id:"save-wav-options-cancel-btn",text:"Cancel",kind:"secondary"}),this.applyButton=P({id:"save-wav-options-apply-btn",text:"Export",kind:"primary"});const t=[pe("Export Settings"),V("Choose your WAV export parameters."),m("div",{class:"z-10 mb-4 w-full"},Y({text:"Sample Rate",for:"save-wav-sample-rate"}),this.sampleRateSelect),m("div",{class:"z-10 mb-6"},m("label",{class:`flex items-center gap-2 text-sm ${e.textColor}`},this.includePanCheckbox,"Include Panning in Export")),m("div",{class:"flex justify-end gap-4 z-10"},this.cancelButton,this.applyButton)];this.modalEl=te("save-wav-options-modal",t,{sizePreset:"md"}),document.body.appendChild(this.modalEl),this.attachListeners()}attachListeners(){this.cancelButton.addEventListener("click",()=>this.hide()),this.applyButton.addEventListener("click",()=>{const e=parseInt(this.sampleRateSelect.value,10),t=this.includePanCheckbox.checked;this.hide(),Oe.saveWavWithOptions({sampleRate:e,includePan:t})})}show(){this.modalEl.classList.remove("hidden")}hide(){this.modalEl.classList.add("hidden")}destroy(){this.modalEl.remove()}}function eu(){const i=pe("üìÅ Load Project"),e=P({id:"import-json",text:"Load Project",kind:"primary"}),t=m("div",{class:"h-px bg-gray-600"}),s=P({id:"import-midi",text:"Import MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),n=P({id:"import-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),r=m("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,s);return te("import-modal",[i,r,n])}function tu(i){const e=i.querySelector("#import-cancel"),t=i.querySelector("#import-json"),s=i.querySelector("#import-midi"),n=()=>{i.classList.add("hidden")},r=async l=>{const d=document.createElement("input");d.type="file",d.accept=l.join(","),d.onchange=async()=>{var c;(c=d.files)!=null&&c[0]&&(await Oe.load(d.files[0]),n())},d.click()},a=()=>r([".json"]),o=()=>r([".mid",".midi"]);return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",a),s==null||s.addEventListener("click",o),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",a),s==null||s.removeEventListener("click",o)},refreshUI:()=>{}}}class iu{constructor(){this.detachFn=null,this.modal=eu(),document.body.appendChild(this.modal);const e=tu(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function su(){const i=m("h2",{class:"text-xl font-semibold mb-2 z-10 text-center",textContent:"Adjust Velocity"}),e=m("p",{class:"text-sm text-gray-400 mb-4 text-center z-10",textContent:"Apply a velocity transformation to the selected notes."}),t=m("input",{id:"velocity-set-toggle",type:"checkbox",class:"accent-purple-500",checked:!0}),s=m("label",{class:"flex items-center gap-2 text-sm mb-2"},t,"Set base velocity to"),n=m("select",{id:"velocity-action-select",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},m("option",{value:"set"},"Set Velocity To"),m("option",{value:"increase"},"Increase Velocity By"),m("option",{value:"decrease"},"Decrease Velocity By")),r=m("input",{id:"velocity-value-input",type:"number",value:"100",min:"1",max:"127",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),a=m("div",{id:"velocity-set-fields",class:"flex items-center gap-3"},n,r),o=m("div",{class:"z-10 mb-4"},s,a),l=m("input",{id:"velocity-ramp-toggle",type:"checkbox",class:"accent-purple-500"}),d=m("label",{class:"flex items-center gap-2 text-sm mb-2"},l,"Enable velocity ramp"),c=m("select",{id:"velocity-ramp-direction",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},m("option",{value:"up"},"Ramp Up"),m("option",{value:"down"},"Ramp Down")),u=m("input",{id:"velocity-ramp-amount",type:"number",value:"10",min:"1",max:"127",placeholder:"Œî per note",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),h=m("div",{class:"flex items-center gap-2 mb-4 text-sm text-gray-300"},m("label",{class:"flex items-center gap-1"},m("input",{type:"radio",name:"ramp-mode",value:"linear",checked:!0,class:"accent-purple-500"}),"Linear"),m("label",{class:"flex items-center gap-1"},m("input",{type:"radio",name:"ramp-mode",value:"exponential",class:"accent-purple-500"}),"Exponential")),f=m("div",{id:"velocity-ramp-fields",class:"opacity-50 pointer-events-none"},m("div",{class:"flex items-center gap-3 mb-2"},c,u),h),y=m("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},d,f),b=m("input",{id:"velocity-randomize-toggle",type:"checkbox",class:"accent-purple-500"}),g=m("label",{class:"flex items-center gap-2 text-sm mb-2"},b,"Add random variation"),p=m("input",{id:"velocity-random-range",type:"number",value:"5",min:"1",max:"64",class:"w-[80px] bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm focus:outline-none focus:border-purple-500"}),v=m("div",{id:"velocity-random-fields",class:"flex items-center gap-2 text-sm text-gray-300 opacity-50 pointer-events-none"},m("span",{textContent:"¬±"}),p),S=m("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},g,v),_=m("div",{id:"velocity-preview-summary",class:"mt-6 text-sm text-gray-400 text-center z-10"}),C=P({id:"velocity-apply-btn",text:"Apply",kind:"primary"}),N=P({id:"velocity-cancel-btn",text:"Cancel",kind:"tertiary"}),w=m("div",{class:"flex gap-3 mt-6 z-10"},C,N);return te("velocity-modal",[i,e,o,y,S,_,w])}function ru(i){const e=Gr();if(!e){console.warn("No active note selection to apply velocity changes.");return}const{sequencerId:t,selectedNotes:s}=e;if(s.length===0){console.warn("No notes selected in the active sequencer.");return}const n=K().find(p=>p.id===t);if(!(n!=null&&n.matrix)){console.warn(`Could not find matrix for sequencer ID ${t}.`);return}const r=s.map(p=>({...p})),{mode:a,value:o,rampDirection:l="none",rampAmount:d=0,rampMode:c="linear",randomize:u=!1,randomRange:h=0}=i,f=s.map((p,v)=>({note:p,originalIndex:v}));f.sort((p,v)=>p.note.start-v.note.start);const y=new Map;for(const p of f){const v=p.note.start;y.has(v)||y.set(v,[]),y.get(v).push(p)}Array.from(y.entries()).sort((p,v)=>p[0]-v[0]).map(([,p])=>p).forEach((p,v)=>{let S=c==="linear"?v:Math.pow(v,1.3),_=d*S;l==="down"&&(_=-_);for(const{note:C}of p){let N;switch(a){case"set":N=Math.max(1,o);break;case"increase":N=(C.velocity??100)+o;break;case"decrease":N=(C.velocity??100)-o;break;case"none":default:N=C.velocity??100;break}let w=N+_;if(u&&h>0){const L=(Math.random()*2-1)*h;w+=L}C.velocity=Math.max(1,Math.min(127,Math.round(w)))}});const g=f.sort((p,v)=>p.originalIndex-v.originalIndex).map(({note:p})=>({...p}));T(zl(t,g),$l(t,r))}function nu(i){const e=document.getElementById("velocity-modal");e&&e.classList.remove("hidden")}function ei(){const i=document.getElementById("velocity-modal");i&&i.classList.add("hidden")}function au(i){var f;const e=i.querySelector("#velocity-apply-btn"),t=i.querySelector("#velocity-cancel-btn"),s=i.querySelector("#velocity-set-toggle"),n=((f=i.querySelector("#velocity-action-select"))==null?void 0:f.parentElement)??null,r=i.querySelector("#velocity-ramp-toggle"),a=i.querySelector("#velocity-ramp-fields"),o=i.querySelector("#velocity-randomize-toggle"),l=i.querySelector("#velocity-random-fields");function d(y,b){if(!y||!b)return;const g=y.checked;b.classList.toggle("opacity-50",!g),b.classList.toggle("pointer-events-none",!g)}function c(){s==null||s.addEventListener("change",()=>d(s,n)),r==null||r.addEventListener("change",()=>d(r,a)),o==null||o.addEventListener("change",()=>d(o,l)),d(s,n),d(r,a),d(o,l)}function u(){var L,G,E,M,x,B;const y=(s==null?void 0:s.checked)??!0,b=(r==null?void 0:r.checked)??!1,g=(o==null?void 0:o.checked)??!1,p=y?(L=i.querySelector("#velocity-action-select"))==null?void 0:L.value:"none",v=parseInt(((G=i.querySelector("#velocity-value-input"))==null?void 0:G.value)??"",10),S=isNaN(v)?100:Math.max(1,Math.min(127,v)),_=b?(E=i.querySelector("#velocity-ramp-direction"))==null?void 0:E.value:"none",C=b?parseInt(((M=i.querySelector("#velocity-ramp-amount"))==null?void 0:M.value)??"0",10):0,N=b?(x=i.querySelector('input[name="ramp-mode"]:checked'))==null?void 0:x.value:"linear",w=g?parseInt(((B=i.querySelector("#velocity-random-range"))==null?void 0:B.value)??"0",10):0;ru({mode:p,value:S,rampDirection:_,rampAmount:C,rampMode:N,randomize:g,randomRange:w}),ei()}const h=()=>{t==null||t.removeEventListener("click",ei),e==null||e.removeEventListener("click",u),s==null||s.removeEventListener("change",()=>d(s,n)),r==null||r.removeEventListener("change",()=>d(r,a)),o==null||o.removeEventListener("change",()=>d(o,l))};return t==null||t.addEventListener("click",ei),e==null||e.addEventListener("click",u),c(),{detach:h,refreshUI:()=>{}}}class ou{constructor(){this.detachFn=null,this.modal=su(),document.body.appendChild(this.modal);const e=au(this.modal);this.detachFn=e.detach}show(e){nu()}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}const lu="v0.1.1",cu="May 13, 2025",du=["‚ú® New Features","- ü§ñ Added AI Autocomplete for seamless melody continuation (OpenAI API Key required; more AI features rolling out soon)","- üé® Improved skin system with expanded customization options (available in User Settings)","- üêõ Fixed numerous bugs and polished UI behavior for a smoother experience","üêû Known Issues","- üö´ Note placement during live playback of large sequences causes performance issues","üõ£Ô∏è Roadmap","- ü§ñ Continous enhancing and implementation of AI features"];function uu(){const i=Y({text:`${lu} ‚Äî Updated ${cu}`});i.id="whats-new-metadata",i.classList.add("italic","text-gray-400","text-center","self-center","mb-4");const e=m("ul",{id:"whats-new-content",class:"list-disc list-inside text-left space-y-2 text-md w-full"});let t=null;for(const a of du)if(a.startsWith("‚ú®")||a.startsWith("üêû")||a.startsWith("üõ£Ô∏è")){const o=m("li",{class:"font-bold mt-6 text-lg",textContent:a});e.appendChild(o),t=m("ul",{class:"list-disc list-inside ml-6 mt-2 space-y-1"}),e.appendChild(t)}else if(t){const o=m("li",{textContent:a.replace(/^- /,"")});t.appendChild(o)}const s=m("img",{src:ie("static/logo.png"),alt:"Sequenzia",class:"w-[180px] h-auto rounded-xl mb-6 self-center"}),n=P({id:"whats-new-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"}),r=pe({text:"üÜï What's New in Sequenzia",size:"xl",additionalClasses:"text-center self-center"});return te("whats-new-modal",[s,r,i,e,n],{sizePreset:"xl"})}function hu(i){const e=i.querySelector("#whats-new-close-btn"),t=()=>{i.style.opacity="0",i.style.transition="opacity 0.4s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},400)};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class fu{constructor(){this.detachFn=null,this.modal=uu(),document.body.appendChild(this.modal);const e=hu(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.style.opacity="0",this.modal.style.transition="opacity 0.4s ease-out",setTimeout(()=>{this.modal.classList.add("hidden"),this.modal.style.opacity="1"},400)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class pu{constructor(e,t){this.contour=null,this.miniCanvas=null,this.sideButtons=null,this.detachFns=[],this.refreshFns=[],this.engine=e,this.userConfigModalController=t,this.playbackService=new xd,this.initializeUI()}initializeUI(){this.controls=new Gc,this.wavOptionsModal=new Qd,this.saveModal=new Yd(()=>this.wavOptionsModal.show()),this.loadModal=new iu,this.velocityModal=new ou,this.whatsNewModal=new fu;const e=Ec(),t=qc(),s=jc(),n=Kc();this.controls.getGlobalPlayheadRow().appendChild(e),this.controls.getGlobalToolsRow().appendChild(t.element),this.controls.getGlobalTransportRow().appendChild(s.element);const r=document.getElementById("footer-main");r&&r.appendChild(n),this.miniCanvas=this.getGlobalMiniContourCanvas(),this.sideButtons=n,this.contour=e;const a=Yc(e),o=_d({rootElement:t.element,noteOptionsGroup:t.noteOptionsGroup,aiOptionsGroup:t.aiOptionsGroup}),l=vd(s.element,this.playbackService,this.userConfigModalController,this.saveModal,this.loadModal),d=bd(n,this.whatsNewModal),c=Nd(this.controls.getGlobalPlayheadRow()),u=wd({velocity:this.velocityModal});this.detachFns=[a.detach,o.detach,l.detach,d.detach,c.detach,u.detach,t.refreshGridSettings],this.refreshFns=[a.refreshUI,o.refreshUI,l.refreshUI,d.refreshUI,c.refreshUI,u.refreshUI,s.refreshToggles],vs(),this.initPlayhead()}initPlayhead(){if(!this.contour)return;const e=this.contour.querySelector("#global-mini-playhead");e&&(Sd(e),this.playbackService.setPlayheadCanvasWidth(e.width))}getPlaybackService(){return this.playbackService}getGlobalMiniContourCanvas(){var e;return((e=this.contour)==null?void 0:e.querySelector("#global-mini-contour"))??null}show(){this.refreshFns.forEach(e=>e()),this.controls.render().classList.remove("hidden")}hide(){this.controls.render().classList.add("hidden")}destroy(){var e,t,s,n,r,a;this.detachFns.forEach(o=>o()),this.controls.destroy(),(e=this.sideButtons)!=null&&e.parentNode&&this.sideButtons.parentNode.removeChild(this.sideButtons),this.sideButtons=null,(t=this.wavOptionsModal)==null||t.destroy(),(s=this.saveModal)==null||s.destroy(),(n=this.loadModal)==null||n.destroy(),(r=this.velocityModal)==null||r.destroy(),(a=this.whatsNewModal)==null||a.destroy()}reload(){this.destroy(),this.initializeUI()}}function mu(i,e){window.addEventListener("keydown",t=>{const s=(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="z",n=(t.ctrlKey||t.metaKey)&&(t.key.toLowerCase()==="y"||t.shiftKey&&t.key.toLowerCase()==="z");if(!s&&!n)return;t.preventDefault(),t.target instanceof HTMLElement&&t.target.matches('input, textarea, [contenteditable="true"]')||(s?i():e())},{capture:!0})}function yu(){const i=m("canvas",{id:"waveform",width:1260,height:100,class:"rounded border border-purple-800 bg-gray-900"}),e=m("button",{id:"visualizer-mode",class:"side-button side-button-primary",title:"Change visualizer mode",textContent:"üìä"}),t=m("div",{class:"flex flex-col gap-2"},e),s=m("div",{class:"flex items-start gap-2"},i,t),n=document.getElementById("visualizer-container");return n&&n.appendChild(s),s}function gu(i,e){const t=e.getContext("2d");if(!t)throw new Error("Canvas 2D context not available");const s=e.width,n=e.height,r=new Uint8Array(i.fftSize),a=new Uint8Array(i.frequencyBinCount),o=document.createElement("canvas");o.width=s,o.height=n;const l=o.getContext("2d");if(!l)throw new Error("Offscreen canvas 2D context not available");let d="frequency";function c(){if(!t)return;i.getByteTimeDomainData(r),t.fillStyle="#000",t.fillRect(0,0,s,n),t.lineWidth=2,t.strokeStyle="#00ffcc",t.beginPath();const y=s/r.length;let b=0;for(let g=0;g<r.length;g++){const v=r[g]/128*n/2;g===0?t.moveTo(b,v):t.lineTo(b,v),b+=y}t.lineTo(s,n/2),t.stroke()}function u(){if(i.getByteFrequencyData(a),!t)return;t.fillStyle="#000",t.fillRect(0,0,s,n),t.fillStyle="rgba(255,255,255,0.2)",t.fillRect(0,0,1,n),t.fillRect(s-1,0,1,n);const y=128,b=2,g=[];for(let p=0;p<y;p++)g.push(p*s/(y-1));g[g.length-1]=s-1;for(let p=0;p<y;p++){const v=g[p],S=p<y-1?g[p+1]:s,_=Math.max(1,S-v-b),C=20,N=2e4,w=p/(y-1),L=C*Math.pow(N/C,w),E=Math.min(a.length-1,Math.floor(L/22050*a.length)),M=a[E]/255,x=Math.max(1,M*n),B=240-w*240;t.fillStyle=`hsl(${B}, ${80+M*20}%, ${40+M*40}%)`,t.fillRect(v,n-x,_,x)}}function h(){if(i.getByteFrequencyData(a),!l)return;o.initialized||(l.fillStyle="#000",l.fillRect(0,0,s,n),o.initialized=!0),l.drawImage(o,-1,0),l.fillStyle="#000",l.fillRect(s-1,0,1,n);const y=128,b=20,g=2e4;for(let p=0;p<y;p++){const v=p/(y-1),S=b*Math.pow(g/b,v),C=Math.min(a.length-1,Math.floor(S/22050*a.length)),N=a[C]/255,w=n-1-Math.floor(p*n/y);if(N<.05)continue;const L=Math.floor(N*255),G=Math.floor(N*(255-v*200)),E=Math.floor(N*(100+v*155));l.fillStyle=`rgb(${L}, ${G}, ${E})`,l.fillRect(s-1,w,1,1)}t&&(t.fillStyle="#000",t.fillRect(0,0,s,n),t.drawImage(o,0,0))}function f(){switch(requestAnimationFrame(f),d){case"frequency":u();break;case"spectrogram":h();break;case"waveform":default:c()}}return f(),{setMode(y){["waveform","frequency","spectrogram"].includes(y)&&(d=y,t.clearRect(0,0,s,n),d==="spectrogram"&&l.clearRect(0,0,s,n))}}}function _u(i){const e=i.querySelector("#waveform"),t=i.querySelector("#visualizer-mode");if(!e||!t)return console.warn("Visualizer setup failed: missing canvas or button"),{detach:()=>{},refreshUI:()=>{}};const s=gu(Rs(),e),n=[{name:"waveform",emoji:"üåä"},{name:"frequency",emoji:"üìä"},{name:"spectrogram",emoji:"üåà"}];let r=0;function a(){if(!t)return;r=(r+1)%n.length;const{name:o,emoji:l}=n[r];s.setMode(o),t.textContent=l,t.title=`Mode: ${o}`}return t.addEventListener("click",a),a(),{detach:()=>{t.removeEventListener("click",a)},refreshUI:()=>{t.textContent=n[r].emoji,t.title=`Mode: ${n[r].name}`}}}class bu{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=yu();const e=_u(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function vu(){const i=m("div",{id:"left-sidebutton-column",class:"absolute left-[-46px] flex flex-col gap-2 z-10"},m("button",{id:"piano-toggle-btn",class:"side-button side-button-info",title:"Toggle Piano View",textContent:"üéπ"}),m("button",{id:"mixer-toggle-btn",class:"side-button side-button-info",title:"Toggle Mixer View",textContent:"üéõÔ∏è"}),m("button",{id:"ai-toggle-btn",class:"side-button side-button-info",title:"Toggle AI View",textContent:"ü§ñ"})),e=document.getElementById("top-controls-container");return e?e.appendChild(i):console.warn("[SideMenuUI] #top-controls-container not found."),i}function Su(i){const e=i.querySelector("#piano-toggle-btn"),t=i.querySelector("#mixer-toggle-btn"),s=i.querySelector("#ai-toggle-btn"),n=()=>{J().showFeatureBlocked()},r=()=>{J().showFeatureBlocked()},a=()=>{J().showFeatureBlocked()};return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",r),s==null||s.addEventListener("click",a),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",r),s==null||s.removeEventListener("click",a)},refreshUI:()=>{}}}class Cu{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=vu();const e=Su(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function Nu(){const i=m("canvas",{id:"piano",width:1260,height:200,class:"rounded shadow-lg border border-purple-700"}),e=m("button",{id:"octave-up",class:"side-button side-button-primary",title:"Octave Up"},A("icon-arrow-up","Octave Up")),t=m("button",{id:"octave-down",class:"side-button side-button-primary",title:"Octave Down"},A("icon-arrow-down","Octave Down")),s=m("button",{id:"global-instrument-select-btn",class:"side-button side-button-primary",title:"Select Instrument"},A("icon-list-instrument","Instrument")),n=m("button",{id:"disable-keyboard-inputs",class:"side-button side-button-secondary",title:"Toggle Keyboard Input"},A("icon-keyboard","Keyboard Input")),r=m("div",{class:"flex flex-col gap-2"},e,t,s,n);return{wrapper:m("div",{class:"flex items-start gap-2"},i,r),canvas:i}}function ys(i,e){const t=parseInt(i.replace("#",""),16),s=Math.round(2.55*e),n=Math.max(0,Math.min(255,(t>>16)+s)),r=Math.max(0,Math.min(255,(t>>8&255)+s)),a=Math.max(0,Math.min(255,(t&255)+s));return`rgb(${n},${r},${a})`}function Qe(i,e,t=new Set,s=null){i.clearRect(0,0,i.canvas.width,i.canvas.height);const{whiteKeyColor:n,blackKeyColor:r}=O(),a={};if(s)for(const[o,l]of Object.entries(s))a[l]=o;for(const o of Object.values(e))if(!o.isBlack){const l=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(l.addColorStop(0,"#99cfff"),l.addColorStop(1,"#cce0ff")):(l.addColorStop(0,ys(n,-20)),l.addColorStop(1,n)),gs(i,{...o,fill:l,stroke:"#333",radius:6}),i.fillStyle="#333",i.font="12px sans-serif",i.textAlign="center",a[o.note]&&(i.fillStyle="#7c3aed",i.fillText(a[o.note],o.x+o.width/2,o.height-24),i.fillStyle="#333"),i.fillText(o.note,o.x+o.width/2,o.height-8)}for(const o of Object.values(e))if(o.isBlack){const l=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(l.addColorStop(0,"#3040ff"),l.addColorStop(1,"#4a60ff")):(l.addColorStop(0,ys(r,-20)),l.addColorStop(1,r)),gs(i,{...o,fill:l,stroke:"#000000",radius:4}),a[o.note]&&(i.fillStyle="#c084fc",i.font="10px sans-serif",i.textAlign="center",i.fillText(a[o.note],o.x+o.width/2,o.height-28))}}function gs(i,e){const{x:t,width:s,height:n,fill:r,stroke:a,radius:o=8}=e;i.beginPath(),i.moveTo(t,0),i.lineTo(t,n-o),i.quadraticCurveTo(t,n,t+o,n),i.lineTo(t+s-o,n),i.quadraticCurveTo(t+s,n,t+s,n-o),i.lineTo(t+s,0),i.closePath(),i.fillStyle=r,i.fill(),i.strokeStyle=a,i.lineWidth=1,i.stroke()}function wu(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Map,s=new Set;let n=!1;function r(f,y){const b=Be();for(const g of Object.values(b))if(g.isBlack&&f>=g.x&&f<=g.x+g.width&&y>=0&&y<=g.height)return g.note;for(const g of Object.values(b))if(!g.isBlack&&f>=g.x&&f<=g.x+g.width&&y>=0&&y<=g.height)return g.note;return null}function a(f){if(!f||s.has(f)||!e)return;const y=ma(f);y&&(t.set(f,y),s.add(f),Qe(e,Be(),s,void 0))}function o(f){if(!s.has(f)||!e)return;const y=t.get(f);y&&(y.stop(),t.delete(f)),s.delete(f),Qe(e,Be(),s,void 0)}function l(){for(const f of s)o(f)}const d=f=>{n=!0;const y=i.getBoundingClientRect(),b=f.clientX-y.left,g=f.clientY-y.top,p=r(b,g);a(p)},c=f=>{if(!n)return;const y=i.getBoundingClientRect(),b=f.clientX-y.left,g=f.clientY-y.top,p=r(b,g);a(p)},u=()=>{n=!1,l()},h=()=>{n=!1,l()};return i.addEventListener("mousedown",d),i.addEventListener("mousemove",c),i.addEventListener("mouseup",u),i.addEventListener("mouseleave",h),{detach:()=>{i.removeEventListener("mousedown",d),i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",u),i.removeEventListener("mouseleave",h)},refreshUI:()=>{}}}const Or=[..."qwertyuiop[zxcvbnm,./"],Ur=["2","3","5","6","7","9","0","=","s","d","g","h","k","l",";"];function Mu(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Set,s=new Set,n=new Map;function r(){const c=Be(),u=Object.values(c).filter(y=>!y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),h=Object.values(c).filter(y=>y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),f={};return Or.forEach((y,b)=>{u[b]&&(f[y]=u[b])}),Ur.forEach((y,b)=>{h[b]&&(f[y]=h[b])}),f}function a(c){const u=r(),h=u[c];if(!(!h||t.has(c)||!e)){if(t.add(c),!s.has(h)){const f=Is(h,100,da());f&&(n.set(h,{stop:f}),s.add(h))}Qe(e,Be(),s,u)}}function o(c){const u=r(),h=u[c];!h||!e||(t.delete(c),s.has(h)&&(fa(h),n.delete(h),s.delete(h)),Qe(e,Be(),s,u))}const l=c=>{c.repeat||!Ne()||a(c.key)},d=c=>{Ne()&&o(c.key)};return window.addEventListener("keydown",l),window.addEventListener("keyup",d),{detach:()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",d)},refreshUI:()=>{}}}function _s(i,e){e?(i.classList.remove("side-button-secondary","side-button-primary"),i.classList.add("side-button-activated")):(i.classList.remove("side-button-activated"),i.classList.add("side-button-secondary"))}function xu(i){const e=Object.values(i).filter(n=>!n.isBlack).sort((n,r)=>n.x-r.x).map(n=>n.note),t=Object.values(i).filter(n=>n.isBlack).sort((n,r)=>n.x-r.x).map(n=>n.note),s={};return Or.forEach((n,r)=>{e[r]&&(s[n]=e[r])}),Ur.forEach((n,r)=>{t[r]&&(s[n]=t[r])}),s}function Lu(i){const e=i.querySelector("#piano"),t=e==null?void 0:e.getContext("2d");if(!e||!t)throw new Error("Keyboard canvas not available");const s=i.querySelector("#octave-up"),n=i.querySelector("#octave-down"),r=i.querySelector("#disable-keyboard-inputs"),a=i.querySelector("#global-instrument-select-btn");function o(){if(!t)return;const h=Dt(),f=Es(h);ha(f),r&&_s(r,Ne());const y=Ne()?xu(f):null;Qe(t,f,new Set,y??void 0)}const l=()=>{const h=Dt();h<7&&(Fi(h+1),o())},d=()=>{const h=Dt();h>1&&(Fi(h-1),o())},c=()=>{const h=Ne();ua(!h),o(),r&&_s(r,!h)},u=()=>{const h=mi()||"sf2/fluidr3-gm/acoustic_grand_piano";Gt().showInstrumentSelectModal(null,h)};return s==null||s.addEventListener("click",l),n==null||n.addEventListener("click",d),r==null||r.addEventListener("click",c),a==null||a.addEventListener("click",u),{detach:()=>{s==null||s.removeEventListener("click",l),n==null||n.removeEventListener("click",d),r==null||r.removeEventListener("click",c),a==null||a.removeEventListener("click",u)},refreshUI:o}}class ku{constructor(){this.detachFns=[],this.refreshFns=[];const{wrapper:e,canvas:t}=Nu();this.wrapper=e,this.canvas=t}render(){return this.wrapper}initialize(){la();const e=wu(this.canvas),t=Mu(this.canvas),s=Lu(this.wrapper);this.detachFns=[e.detach,t.detach,s.detach],this.refreshFns=[e.refreshUI,t.refreshUI,s.refreshUI],this.refresh()}refresh(){this.refreshFns.forEach(e=>e())}hide(){this.wrapper.classList.add("hidden")}show(){this.wrapper.classList.remove("hidden"),this.refresh()}destroy(){this.detachFns.forEach(e=>e()),this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)}}class Gu{constructor(){this.activeMode="keyboard",this.activeElement=null,this.detachFns=[];const e=document.getElementById("top-controls-container");if(!e)throw new Error("#top-controls-container not found in DOM");this.container=e,this.initialize()}initialize(){this.sideMenuController=new Cu,this.keyboardController=new ku,this.setMode("keyboard")}setMode(e){if(this.activeElement){if(this.activeMode===e)return;this.container.removeChild(this.activeElement),this.activeElement=null}switch(this.activeMode=e,e){case"keyboard":this.activeElement=this.keyboardController.render(),this.container.appendChild(this.activeElement),this.keyboardController.initialize();break;case"ai":this.activeElement=this.createStub("AI View not implemented"),this.container.appendChild(this.activeElement);break;case"mixer":this.activeElement=this.createStub("Mixer View not implemented"),this.container.appendChild(this.activeElement);break}}getCurrentMode(){return this.activeMode}destroy(){var e,t,s;this.detachFns.forEach(n=>n()),this.detachFns=[],(e=this.sideMenuController)==null||e.destroy(),(t=this.keyboardController)==null||t.destroy(),((s=this.activeElement)==null?void 0:s.parentNode)===this.container&&this.container.removeChild(this.activeElement),this.activeElement=null}reload(){this.destroy(),this.initialize()}createStub(e){const t=document.createElement("div");return t.className="text-gray-400 text-sm p-4 border border-gray-600 rounded",t.textContent=e,t}}function Bu(i){return m("div",{class:"flex justify-between items-center mb-6 border-b border-purple-700 pb-2 z-10"},m("div",{class:"flex gap-4 text-xl select-none"},...i.map(e=>m("span",{class:["settings-tab","hover:text-white hover:scale-110 transition-all duration-150 cursor-pointer",e.isActive?"text-purple-500":"text-gray-300"].join(" "),dataset:{tab:e.key},title:e.title,textContent:e.icon}))))}class Eu{constructor(){this.globalSection=m("div",{id:"userconfig-global-settings",class:"settings-section z-10"}),this.themeSection=m("div",{id:"userconfig-theme-settings",class:"settings-section hidden z-10"}),this.aiSection=m("div",{id:"userconfig-ai-settings",class:"settings-section hidden z-10"});const e=Bu([{key:"global-settings",icon:"‚öôÔ∏è",title:"Global Settings",isActive:!0},{key:"theme-settings",icon:"üéπ",title:"Theme Settings"},{key:"ai-settings",icon:"ü§ñ",title:"AI Settings"}]);this.saveButton=P({id:"userconfig-save",text:"Save",kind:"primary"}),this.closeButton=P({id:"userconfig-close-bottom",text:"Cancel",kind:"secondary"});const t=m("div",{class:"flex gap-3 mt-4 z-10"},this.saveButton,this.closeButton);this.modal=te("userconfig-modal",[e,this.globalSection,this.themeSection,this.aiSection,t]),document.body.appendChild(this.modal)}render(){return this.modal}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){this.modal.remove()}getSectionContainer(e){switch(e){case"global":return this.globalSection;case"theme":return this.themeSection;case"ai":return this.aiSection}}getSaveButton(){return this.saveButton}getCloseButton(){return this.closeButton}getTabs(){return this.modal.querySelectorAll(".settings-tab")}getSections(){return this.modal.querySelectorAll(".settings-section")}}function Au(){const{trigger:i,tooltip:e}=Ae("tooltip-note-mode","?",[V(Ge("Default Mode:")," gesture-based note placement. Allows click-and-drag selection and edit gestures."),V(Ge("Express Mode:")," notes are placed immediately on mouse down. Holding allows drag-resizing. Right-click initiates multi-note selection.")]),t=we({id:"note-tool-toggle",label:"Note Placement:",stateA:"Classic",stateB:"Express",tooltipTrigger:i});t.input.addEventListener("change",()=>{const r=t.getChecked()?"express":"default";le({global:{noteToolMode:r}})});const s=()=>{const r=z().global.noteToolMode;t.setChecked(r==="express")};return{element:m("div",{},pe("Global Settings"),t.element,e),refreshToggle:s}}const Tu=["Default","Blue Dream","Modern Light","Synthwave","Verdant Alloy","Sunset"],Iu=["Darkroom","Seashell","Cyberpunk","Classic Blue","Midnight"],Ru=["Track Color","Note Velocity","Pitch Class Contrast","Scriabin","Octave Bands"];function Fu(){const i=Iu.map(s=>m("option",{value:s,textContent:s})),e=Ru.map(s=>m("option",{value:s,textContent:s})),t=Tu.map(s=>m("option",{value:s,textContent:s}));return m("div",{},pe("Theme Settings"),m("div",{className:"mb-6"},Y("Interface Skin"),m("select",{id:"skin-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...t)),m("div",{className:"mb-6"},Y("Grid Color Scheme"),m("select",{id:"grid-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i)),m("div",{className:"mb-6"},Y("Note Color Scheme"),m("select",{id:"note-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...e)))}const Ou=[{value:"gpt-4o",label:"gpt-4o"},{value:"gpt-4o-mini",label:"gpt-4o-mini"},{value:"gpt-4.1",label:"gpt-4.1"},{value:"gpt-4.1-mini",label:"gpt-4.1-mini"},{value:"o3-mini",label:"o3-mini"},{value:"o4-mini",label:"o4-mini",className:"bg-green-700 text-white"}];function Uu(){const i=Ou.map(r=>m("option",{value:r.value,className:r.className,textContent:r.label})),{trigger:e,tooltip:t}=Ae("tooltip-openai-key","?",["You must provide an OpenAI API key to use AI features.",V("Visit ",m("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",class:"text-blue-400 underline hover:text-blue-300"},"platform.openai.com")," to manage your key.")]),{trigger:s,tooltip:n}=Ae("tooltip-openai-model","?",["Different models offer varying performance and response quality.",V("Models marked in ",m("span",{class:"text-green-400 font-semibold"},"green")," are recommended for best results."),"We will add support for new models as they become available."]);return m("div",{},pe("AI Configuration"),m("div",{class:"mb-6"},Y("OpenAI API Key",e),m("input",{type:"password",id:"openai-key-input",placeholder:"sk-...",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500"}),t),m("div",{class:"mb-8"},Y("OpenAI Model",s),m("select",{id:"openai-model-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i),n))}function Pu(i,e={}){const t=i.getTabs(),s=i.getSections(),n=i.getCloseButton(),r=i.getSaveButton(),a=c=>{s.forEach(h=>{h.classList.add("hidden")});const u=document.getElementById(`userconfig-${c}`);u&&u.classList.remove("hidden"),t.forEach(h=>{const f=h.dataset.tab===c;h.classList.toggle("text-purple-500",f),h.classList.toggle("opacity-100",f),h.classList.toggle("text-gray-300",!f),h.classList.toggle("opacity-50",!f)})},o=[];t.forEach(c=>{const u=c.dataset.tab;if(!u)return;const h=()=>a(u);c.addEventListener("click",h),o.push(()=>c.removeEventListener("click",h))});const l=()=>{var c;(c=e.onClose)==null||c.call(e),i.hide()},d=()=>{var u;(u=e.onSave)==null||u.call(e);const c=O();c.name,he.getInstance().reloadAll(),i.hide()};return n.addEventListener("click",l),r.addEventListener("click",d),(()=>{const c=Array.from(t).find(u=>u.classList.contains("text-purple-500"));c!=null&&c.dataset.tab&&a(c.dataset.tab)})(),()=>{o.forEach(c=>c()),n.removeEventListener("click",l),r.removeEventListener("click",d)}}function Du(i){const e=i.querySelector("#openai-key-input"),t=i.querySelector("#openai-model-select"),s=()=>{var o;const a=z();e&&(e.value=a.ai.openaiApiKey||""),t&&(t.value=a.ai.openaiModel||((o=t.options[0])==null?void 0:o.value)||"")},n=a=>{const o=a.target;le({ai:{openaiApiKey:o.value}})},r=a=>{const o=a.target;le({ai:{openaiModel:o.value}})};return e==null||e.addEventListener("input",n),t==null||t.addEventListener("change",r),s(),{detach:()=>{e==null||e.removeEventListener("input",n),t==null||t.removeEventListener("change",r)},refreshUI:s}}function qu(i){const e=i.querySelector("#grid-color-select"),t=i.querySelector("#note-color-select"),s=i.querySelector("#skin-select"),n=()=>{var d,c,u;const l=z();e&&(e.value=l.theme.gridColorScheme||((d=e.options[0])==null?void 0:d.value)||""),t&&(t.value=l.theme.noteColorScheme||((c=t.options[0])==null?void 0:c.value)||""),s&&(s.value=l.theme.skin||((u=s.options[0])==null?void 0:u.value)||"")},r=l=>{const d=l.target;le({theme:{gridColorScheme:d.value}})},a=l=>{const d=l.target;le({theme:{noteColorScheme:d.value}})},o=l=>{const d=l.target;H.getInstance().stop(),le({theme:{skin:d.value}})};return e==null||e.addEventListener("change",r),t==null||t.addEventListener("change",a),s==null||s.addEventListener("change",o),n(),{detach:()=>{e==null||e.removeEventListener("change",r),t==null||t.removeEventListener("change",a),s==null||s.removeEventListener("change",o)},refreshUI:n}}function Ku(i){const e=i.querySelector("#note-tool-toggle");if(!e)return console.warn("[GlobalSettings] Toggle input not found."),{detach:()=>{},refreshUI:()=>{}};const t=()=>{const n=z();e.checked=n.global.noteToolMode==="express"},s=n=>{const a=n.target.checked?"express":"default";le({global:{noteToolMode:a}}),K().forEach(o=>o.resetInteractionMode())};return e.addEventListener("change",s),t(),{detach:()=>e.removeEventListener("change",s),refreshUI:t}}class Hu{constructor(){this.modal=null,this.detachFns=[],this.refreshFns=[],this.initialSnapshot=structuredClone(z()),this.initializeUI()}initializeUI(){this.modal=new Eu;const e=Au(),t=Fu(),s=Uu();this.modal.getSectionContainer("global").appendChild(e.element),this.modal.getSectionContainer("theme").appendChild(t),this.modal.getSectionContainer("ai").appendChild(s);const n=Pu(this.modal,{onSave:()=>wc(),onClose:()=>le(this.initialSnapshot)}),r=Ku(e.element),a=qu(t),o=Du(s);this.detachFns.push(n,r.detach,a.detach,o.detach),this.refreshFns.push(r.refreshUI,a.refreshUI,o.refreshUI,e.refreshToggle),vs(),document.body.appendChild(this.modal.render())}show(){var e;this.initialSnapshot=structuredClone(z()),this.refreshFns.forEach(t=>t()),(e=this.modal)==null||e.show()}hide(){var e;(e=this.modal)==null||e.hide()}destroy(){var e;this.detachFns.forEach(t=>t()),(e=this.modal)==null||e.destroy(),this.modal=null,this.detachFns=[],this.refreshFns=[]}reload(){this.destroy(),this.initializeUI()}}function zu(){document.getElementById("add-sequencer").addEventListener("click",()=>{const e=K().length;T(pr(e,"sf2/fluidr3-gm/acoustic_grand_piano"),Ni(e))})}function $u(){const i=J();i.showSplashScreen(),Mc(),_c(),bc(),H.initialize(K());const e=new Hu,t=Gt(),s=new Gu,n=new pu(sc(),e),r=new bu;n.show(),r.show();const a=he.getInstance();a.registerReloadable(()=>r.reload()),a.registerReloadable(()=>s.reload()),a.registerReloadable(()=>e.reload()),a.registerReloadable(()=>n.reload()),a.registerReloadable(()=>i.reload()),a.registerReloadable(()=>t.reload()),Bt(Nc),F("Setting up additional UI..."),mu(Vl,Yl),zu();const o=0;T(pr(o,"sf2/fluidr3-gm/acoustic_grand_piano"),Ni(o)),T(wi("Initial App State"),mr("Initial App State")),i.hideSplashScreen(),Ss("Sequenzia initialized"),F("Current state: ",D())}requestAnimationFrame(()=>{$u()});
