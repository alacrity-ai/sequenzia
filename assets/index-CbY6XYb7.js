import{g as as,S as Nr,a as wr,M as Mr,D as Lr,b as xr,c as Gr,d as kr,e as Br,f as Er,i as Tr,h as Ir,P as Ar,j as os}from"./vendor-BrbinlG8.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=t(n);fetch(n.href,r)}})();function Rr(){return new Date().toISOString()}function jt(i,e=1){var s,n;if(i===null||typeof i!="object")return i;if(e===0){const r=((s=i.constructor)==null?void 0:s.name)||"Object",a=Object.keys(i).length;return`[${r} object, ${a} keys]`}if(Array.isArray(i))return i.map(r=>jt(r,e-1));const t={_type:((n=i.constructor)==null?void 0:n.name)||"Object"};for(const r in i){if(!Object.prototype.hasOwnProperty.call(i,r))continue;const a=i[r];if(a instanceof HTMLElement)t[r]=`[HTMLElement: ${a.tagName}]`;else if(a instanceof AudioContext||a instanceof AudioNode)t[r]="[AudioNode]";else if(typeof a=="function")t[r]="[Function]";else if(typeof a=="object")try{t[r]=jt(a,e-1)}catch{t[r]="[Unserializable Object]"}else t[r]=a}return t}function Fr(i){try{const e=jt(i,2);return JSON.stringify(e,null,2)}catch(e){return JSON.stringify({error:"Could not serialize log payload",reason:e.message,type:typeof i},null,2)}}function ls(i,e,t="log"){const n={timestamp:Rr(),level:t,message:i};e!==void 0&&(n.data=e);const r=Fr(n);switch(t){case"warn":console.warn(r);break;case"error":console.error(r);break;case"info":console.info(r);break;case"debug":console.debug(r);break;case"log":default:console.log(r);break}}const ii="SEQUENZIA_DEV";let We=!1;typeof window<"u"&&(We=localStorage.getItem(ii)==="true");function wi(){We=!0,typeof window<"u"&&localStorage.setItem(ii,"true")}function Or(){We=!1,typeof window<"u"&&localStorage.removeItem(ii)}function xt(){return We}function X(i,e,t="log"){We&&ls(i,e,t)}class ae{constructor(){this.reloadCallbacks=[]}static getInstance(){return ae.instance||(ae.instance=new ae),ae.instance}registerReloadable(e){this.reloadCallbacks.push(e)}unregisterReloadable(e){this.reloadCallbacks=this.reloadCallbacks.filter(t=>t!==e)}reloadAll(){this.reloadCallbacks.forEach(e=>e())}}function Ur(){const i=document.getElementById("splash-modal");return i?!i.classList.contains("hidden"):!1}function ds(i){const e=[];for(const t of i)Array.isArray(t)?e.push(...ds(t)):t!=null&&t!==!1&&e.push(t);return e}function p(i,e={},...t){const s=document.createElement(i);for(const[r,a]of Object.entries(e))if(!(a==null||a===!1))if(r==="class"||r==="className")s.className=a;else if(r==="style"&&typeof a=="object")for(const[o,l]of Object.entries(a))l!=null&&(s.style[o]=l);else if(r==="dataset"&&typeof a=="object")for(const[o,l]of Object.entries(a))s.dataset[o]=String(l);else r.startsWith("data-")?s.setAttribute(r,String(a)):r.startsWith("on")&&typeof a=="function"?s.addEventListener(r.slice(2).toLowerCase(),a):r in s?s[r]=a:s.setAttribute(r,String(a));const n=ds(t);for(const r of n)s.appendChild(typeof r=="string"?document.createTextNode(r):r);return s}const Dr={global:{noteToolMode:"express"},theme:{gridColorScheme:"Darkroom",noteColorScheme:"Track Color",skin:"Default"},ai:{openaiApiKey:"",openaiModel:"gpt-4o"}},cs={name:"Default",appBackground:"bg-black",menuBackground:"bg-gradient-to-br from-gray-800 to-gray-900",surfaceBackground:"bg-gray-900",accentColor:"bg-purple-700",textColor:"text-white",borderColor:"border-purple-950",buttonPrimaryColor:"bg-purple-700",buttonPrimaryColorHover:"hover:bg-purple-600",buttonSecondaryColor:"bg-gray-800",buttonSecondaryColorHover:"hover:bg-gray-700",buttonTertiaryColor:"bg-blue-700",buttonTertiaryColorHover:"hover:bg-blue-600",toggleTrackBase:"bg-gray-700",toggleTrackChecked:"peer-checked:bg-purple-600",toggleKnobBase:"after:border-gray-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#a6a09b",whiteKeyColor:"#292524",volumeGradientFrom:"from-purple-600",volumeGradientTo:"to-purple-400",volumeThumbColor:"bg-purple-500",panGradientFrom:"from-indigo-600",panGradientTo:"to-indigo-400",panThumbColor:"bg-indigo-500",snapMarkerColor:"bg-purple-300/50"},Pr={name:"Blue Dream",appBackground:"bg-gradient-to-b from-blue-900 to-gray-900",menuBackground:"bg-gradient-to-br from-blue-800 to-blue-900",surfaceBackground:"bg-blue-950/80",accentColor:"bg-cyan-400",textColor:"text-white",borderColor:"border-cyan-400",buttonPrimaryColor:"bg-cyan-600",buttonPrimaryColorHover:"hover:bg-cyan-500",buttonSecondaryColor:"bg-blue-800",buttonSecondaryColorHover:"hover:bg-blue-700",buttonTertiaryColor:"bg-indigo-600",buttonTertiaryColorHover:"hover:bg-indigo-500",toggleTrackBase:"bg-blue-700",toggleTrackChecked:"peer-checked:bg-cyan-400",toggleKnobBase:"after:border-blue-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#1b1f5f",whiteKeyColor:"#c0e7ff",volumeGradientFrom:"from-cyan-500",volumeGradientTo:"to-cyan-300",volumeThumbColor:"bg-cyan-400",panGradientFrom:"from-indigo-500",panGradientTo:"to-indigo-300",panThumbColor:"bg-indigo-400",snapMarkerColor:"bg-cyan-400/50"},qr={name:"Modern Light",appBackground:"bg-white",menuBackground:"bg-gray-100",surfaceBackground:"bg-gray-200",accentColor:"bg-blue-600",textColor:"text-gray-900",borderColor:"border-blue-600",buttonPrimaryColor:"bg-blue-600",buttonPrimaryColorHover:"hover:bg-blue-500",buttonSecondaryColor:"bg-gray-200",buttonSecondaryColorHover:"hover:bg-gray-300",buttonTertiaryColor:"bg-gray-300",buttonTertiaryColorHover:"hover:bg-gray-400",toggleTrackBase:"bg-gray-300",toggleTrackChecked:"peer-checked:bg-blue-600",toggleKnobBase:"after:border-gray-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#111111",whiteKeyColor:"#ffffff",volumeGradientFrom:"from-blue-500",volumeGradientTo:"to-blue-300",volumeThumbColor:"bg-blue-400",panGradientFrom:"from-sky-500",panGradientTo:"to-sky-300",panThumbColor:"bg-sky-400",snapMarkerColor:"bg-blue-400/50"},Kr={name:"Synthwave",appBackground:"bg-gradient-to-br from-black via-gray-900 to-purple-950",menuBackground:"bg-gradient-to-br from-purple-800 to-pink-900",surfaceBackground:"bg-gray-900/80",accentColor:"bg-fuchsia-500",textColor:"text-neon-green",borderColor:"border-fuchsia-500",buttonPrimaryColor:"bg-pink-700",buttonPrimaryColorHover:"hover:bg-pink-600",buttonSecondaryColor:"bg-purple-800",buttonSecondaryColorHover:"hover:bg-purple-700",buttonTertiaryColor:"bg-gray-800",buttonTertiaryColorHover:"hover:bg-gray-700",toggleTrackBase:"bg-pink-800",toggleTrackChecked:"peer-checked:bg-fuchsia-500",toggleKnobBase:"after:border-pink-400",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#d946ef",whiteKeyColor:"#f5d0fe",volumeGradientFrom:"from-fuchsia-500",volumeGradientTo:"to-pink-400",volumeThumbColor:"bg-fuchsia-400",panGradientFrom:"from-purple-600",panGradientTo:"to-purple-400",panThumbColor:"bg-purple-500",snapMarkerColor:"bg-fuchsia-300/50"},Hr={name:"Verdant Alloy",appBackground:"bg-gradient-to-b from-gray-900 to-green-950",menuBackground:"bg-gradient-to-tr from-emerald-800 to-lime-700",surfaceBackground:"bg-emerald-950/70",accentColor:"bg-lime-400",textColor:"text-lime-100",borderColor:"border-lime-400",buttonPrimaryColor:"bg-emerald-600",buttonPrimaryColorHover:"hover:bg-emerald-500",buttonSecondaryColor:"bg-lime-700",buttonSecondaryColorHover:"hover:bg-lime-600",buttonTertiaryColor:"bg-gray-700",buttonTertiaryColorHover:"hover:bg-gray-600",toggleTrackBase:"bg-emerald-700",toggleTrackChecked:"peer-checked:bg-lime-400",toggleKnobBase:"after:border-lime-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#143016",whiteKeyColor:"#dbf4dc",volumeGradientFrom:"from-emerald-500",volumeGradientTo:"to-emerald-300",volumeThumbColor:"bg-emerald-400",panGradientFrom:"from-lime-500",panGradientTo:"to-lime-300",panThumbColor:"bg-lime-400",snapMarkerColor:"bg-lime-300/50"},zr={name:"Sunset",appBackground:"bg-gradient-to-br from-orange-900 via-red-800 to-purple-900",menuBackground:"bg-gradient-to-bl from-rose-800 to-orange-700",surfaceBackground:"bg-orange-950/70",accentColor:"bg-yellow-400",textColor:"text-yellow-100",borderColor:"border-yellow-400",buttonPrimaryColor:"bg-amber-600",buttonPrimaryColorHover:"hover:bg-amber-500",buttonSecondaryColor:"bg-red-700",buttonSecondaryColorHover:"hover:bg-red-600",buttonTertiaryColor:"bg-purple-700",buttonTertiaryColorHover:"hover:bg-purple-600",toggleTrackBase:"bg-red-700",toggleTrackChecked:"peer-checked:bg-yellow-400",toggleKnobBase:"after:border-orange-300",toggleKnobChecked:"peer-checked:after:border-white",blackKeyColor:"#45122c",whiteKeyColor:"#fff3e0",volumeGradientFrom:"from-amber-500",volumeGradientTo:"to-amber-300",volumeThumbColor:"bg-amber-400",panGradientFrom:"from-rose-500",panGradientTo:"to-rose-300",panThumbColor:"bg-rose-400",snapMarkerColor:"bg-amber-300/50"},Jr={Default:cs,"Blue Dream":Pr,"Modern Light":qr,Synthwave:Kr,"Verdant Alloy":Hr,Sunset:zr};function $r(i){return Jr[i]||cs}const ft=structuredClone(Dr);ft.theme.skin;function j(){return ft}function T(){return $r(ft.theme.skin)}function oe(i){us(ft,i);try{const e=D();if(e.length>0)for(const t of e)t.redraw()}catch(e){console.warn("[updateUserConfig] Skipped sequencer UI refresh (store not ready yet).",e)}}function us(i,e){for(const t in e)e[t]&&typeof e[t]=="object"&&!Array.isArray(e[t])?(i[t]||(i[t]={}),us(i[t],e[t])):i[t]=e[t]}const Wr={sm:{widthClass:"w-[300px]",maxWidthClass:"max-w-sm"},md:{widthClass:"w-[500px]",maxWidthClass:"max-w-md"},lg:{widthClass:"w-[700px]",maxWidthClass:"max-w-lg"},xl:{widthClass:"w-[900px]",maxWidthClass:"max-w-xl"},full:{widthClass:"w-full",maxWidthClass:"max-w-full"}};function Z(i,e,t={}){const s=T(),n=t.sizePreset?Wr[t.sizePreset]:void 0,r=t.widthClass||(n==null?void 0:n.widthClass)||"w-[500px]",a=t.maxWidthClass||(n==null?void 0:n.maxWidthClass)||"max-w-full",o=p("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),l=p("div",{class:["relative flex flex-col",s.menuBackground,"border border-purple-700 shadow-2xl rounded-2xl","px-10 py-8 animate-fade-in text-white",r,a].join(" ")},o,...Array.isArray(e)?e:[e]);return p("div",{id:i,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},l)}function R({id:i,text:e,kind:t="primary",onClick:s,additionalClasses:n=""}){const r=T(),a={primary:r.buttonPrimaryColor,secondary:r.buttonSecondaryColor,tertiary:r.buttonTertiaryColor}[t],o={primary:r.buttonPrimaryColorHover,secondary:r.buttonSecondaryColorHover,tertiary:r.buttonTertiaryColorHover}[t];return p("button",{id:i,class:["cursor-pointer flex-1 py-2 rounded-lg transition-all text-sm",a,o,r.textColor,n].join(" "),textContent:e,onclick:s})}function jr(){const i=p("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=p("h2",{class:"text-xl font-semibold mb-4 text-center tracking-wide z-10",textContent:"Oops!"}),t=p("div",{id:"error-message-content",class:["bg-gray-700 text-gray-100 rounded-xl px-4 py-3 text-sm whitespace-pre-wrap","z-10 max-h-[240px] overflow-y-auto text-center"].join(" ")}),s=R({id:"error-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"});return Z("error-modal",[i,e,t,s],{widthClass:"w-[420px]",maxWidthClass:"max-w-full"})}function Xr(i){const e=i.querySelector("#error-close-btn"),t=i.querySelector("div.relative"),s=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=r=>{t&&(t.contains(r.target)||s())};return e==null||e.addEventListener("click",s),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",s),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class Vr{constructor(){this.detachFn=null,this.modal=jr(),this.messageBox=this.modal.querySelector("#error-message-content"),document.body.appendChild(this.modal);const e=Xr(this.modal);this.detachFn=e.detach}show(e){this.messageBox.textContent=e,this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function Yr(){const i=p("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=p("div",{class:"text-[100px] mb-4 z-10 animate-bounce text-center",textContent:"🛠️"}),t=p("div",{class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Feature Not Implemented"}),s=p("div",{class:"text-sm text-gray-400 mt-2 z-10 text-center",innerHTML:"This part of Sequenzia is still under construction.<br />Check back soon!"}),n=R({id:"feature-modal-close-btn",text:"Got it",kind:"primary",additionalClasses:"mt-6 self-center z-10 px-6 py-2 text-base"});return Z("feature-not-implemented-modal",[i,e,t,s,n],{widthClass:"w-[400px]",maxWidthClass:"max-w-full"})}function Zr(i){const e=i.querySelector("#feature-modal-close-btn"),t=i.querySelector("div.relative"),s=()=>{i.style.opacity="0",i.style.transition="opacity 0.3s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},300)},n=r=>{t&&(t.contains(r.target)||s())};return e==null||e.addEventListener("click",s),i.addEventListener("mousedown",n),{detach:()=>{e==null||e.removeEventListener("click",s),i.removeEventListener("mousedown",n)},refreshUI:()=>{}}}class Qr{constructor(){this.detachFn=null,this.modal=Yr(),document.body.appendChild(this.modal);const e=Zr(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function en(){const i=p("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=p("div",{class:"flex justify-center items-center space-x-3 mb-6 z-10"},p("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),p("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),p("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=p("div",{id:"loading-modal-title",class:"text-xl font-semibold text-white z-10 tracking-wide text-center",textContent:"Loading Sounds..."}),s=p("div",{id:"loading-modal-subtext",class:"text-sm text-gray-400 mt-2 z-10 text-center",textContent:"Please wait while we dial it in."}),n=p("button",{id:"loading-modal-cancel",class:"cursor-pointer mt-6 z-10 text-sm text-purple-400 hover:text-purple-300 underline hidden",textContent:"Cancel"});return Z("loading-modal",[i,e,t,s,n],{widthClass:"w-[360px]",maxWidthClass:"max-w-full"})}function tn(i,e){const t=i.querySelector("#loading-modal-cancel"),s=()=>{e()};return t==null||t.addEventListener("click",s),{detach:()=>{t==null||t.removeEventListener("click",s)},refreshUI:()=>{}}}class sn{constructor(e){this.detachFn=null,this.modal=en(),this.titleEl=this.modal.querySelector("#loading-modal-title"),this.subtextEl=this.modal.querySelector("#loading-modal-subtext"),this.cancelBtn=this.modal.querySelector("#loading-modal-cancel"),document.body.appendChild(this.modal);const t=tn(this.modal,e);this.detachFn=t.detach}show(e){e!=null&&e.title&&(this.titleEl.textContent=e.title),e!=null&&e.subtext&&(this.subtextEl.textContent=e.subtext),this.cancelBtn.classList.toggle("hidden",!(e!=null&&e.cancelable)),this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.classList.add("hidden"),this.modal.style.opacity="1"}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function de(i){const e=i.startsWith("/")?i.substring(1):i;return(window.location.pathname.startsWith("/sequenzia")?"/sequenzia/":"./")+e}function rn(){const i=p("div",{class:"mb-8"},p("img",{id:"splash-logo",src:de("static/svg/sequenzia-logo.svg"),alt:"Sequenzia",class:"w-[300px] h-auto animate-fade-in rounded-xl"})),e=p("div",{class:"flex items-center space-x-2 mb-4"},p("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0s"}),p("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),p("div",{class:"w-3 h-3 bg-blue-500 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),t=p("div",{class:"text-white text-xl font-medium"},"Loading Sequenzia ",p("span",{class:"animate-pulse"},"...")),s=p("div",{class:"relative flex flex-col items-center"},i,e,t);return p("div",{id:"splash-modal",class:"fixed inset-0 bg-black/90 flex items-center justify-center z-[9999] hidden"},s)}function nn(i){return{detach:()=>{},refreshUI:()=>{}}}class an{constructor(){this.detachFn=null,this.modal=rn(),document.body.appendChild(this.modal);const e=nn(this.modal);this.detachFn=e.detach,this.footerMain=document.getElementById("footer-main"),this.contentMain=document.getElementById("content-main"),this.splashLogo=this.modal.querySelector("#splash-logo")}show(){var e,t,s,n;this.splashLogo&&(this.splashLogo.src=de("static/logo.png")),this.modal.classList.remove("hidden"),this.modal.style.opacity="1",(e=this.footerMain)==null||e.classList.remove("content-visible"),(t=this.footerMain)==null||t.classList.add("content-hidden"),(s=this.contentMain)==null||s.classList.remove("content-visible"),(n=this.contentMain)==null||n.classList.add("content-hidden")}hide(e=1e3){setTimeout(()=>{this.modal.style.opacity="0",this.modal.style.transition="opacity 0.5s ease-out",setTimeout(()=>{var t,s,n,r;this.modal.classList.add("hidden"),this.modal.style.opacity="1",(t=this.footerMain)==null||t.classList.remove("content-hidden"),(s=this.footerMain)==null||s.classList.add("content-visible"),(n=this.contentMain)==null||n.classList.remove("content-hidden"),(r=this.contentMain)==null||r.classList.add("content-visible")},500)},e)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function on(){const i=p("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"API Key Required"}),e=p("p",{class:"mb-6 text-center text-sm",textContent:"In order to use AI Features, you must add an OpenAI API Key in the config."}),t=R({id:"key-not-set-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),s=p("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return p("div",{id:"openai-key-not-set-modal",class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"},s)}function ln(i){const e=i.querySelector("#key-not-set-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class dn{constructor(){this.detachFn=null,this.modal=on(),document.body.appendChild(this.modal);const e=ln(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function cn(){const i=p("div",{class:"absolute inset-0 rounded-2xl border-2 border-purple-500 opacity-30 blur-xl animate-pulse pointer-events-none"}),e=p("div",{class:"text-[100px] mb-6 animate-bounce z-10",textContent:"🤖"}),t=p("div",{class:"flex items-center space-x-3 mb-6 z-10"},p("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0s"}),p("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.1s"}),p("div",{class:"w-4 h-4 bg-purple-400 rounded-full animate-bounce",style:"animation-delay: 0.2s"})),s=p("div",{class:"text-sm text-gray-400 mt-4 z-10 text-center",textContent:"AI is Generating..."}),n=p("div",{class:"relative flex flex-col items-center bg-gradient-to-br from-gray-800 to-gray-900 border border-purple-700 shadow-2xl rounded-2xl px-10 py-8 animate-fade-in w-[360px] max-w-full"},i,e,t,s);return p("div",{id:"ai-working-modal",class:"fixed inset-0 bg-black/70 flex items-center justify-center z-[9999] hidden"},n)}function un(i){return{detach:()=>{},refreshUI:()=>{}}}class hn{constructor(){this.detachFn=null,this.modal=cn(),document.body.appendChild(this.modal);const e=un(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function fn(){const i=p("h2",{class:"text-lg font-semibold mb-4 text-center",textContent:"AI Generation Failed"}),e=p("p",{class:"mb-6 text-center text-sm",textContent:"Unable to generate AI content. Please try again."}),t=R({id:"generation-failed-ok",text:"OK",kind:"secondary",additionalClasses:"w-full py-2"}),s=p("div",{class:"bg-gray-800 text-white rounded-lg shadow-xl p-6 w-96 flex flex-col items-center"},i,e,t);return p("div",{id:"ai-generation-failed-modal",class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden"},s)}function pn(i){const e=i.querySelector("#generation-failed-ok"),t=()=>{i.classList.add("hidden")};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class mn{constructor(){this.detachFn=null,this.modal=fn(),document.body.appendChild(this.modal);const e=pn(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class yn{constructor(e){this.onCancelLoading=e,this.initialize()}initialize(){this.errorModal=new Vr,this.featureModal=new Qr,this.loadingModal=new sn(this.onCancelLoading),this.splashModal=new an,this.openAIKeyNotSetModal=new dn,this.aiWorkingModal=new hn,this.aiGenerationFailedModal=new mn}showError(e){this.errorModal.show(e)}showFeatureBlocked(){this.featureModal.show()}showOpenAIKeyNotSet(){this.openAIKeyNotSetModal.show()}showAIWorking(){this.aiWorkingModal.show()}hideAIWorking(){this.aiWorkingModal.hide()}showAIGenerationFailed(){this.aiGenerationFailedModal.show()}showLoading(e){this.loadingModal.show(e)}hideLoading(){this.loadingModal.hide()}showSplashScreen(){this.splashModal.show()}hideSplashScreen(){this.splashModal.hide()}destroy(){var e,t,s,n,r,a,o;(e=this.errorModal)==null||e.destroy(),(t=this.featureModal)==null||t.destroy(),(s=this.loadingModal)==null||s.destroy(),(n=this.splashModal)==null||n.destroy(),(r=this.openAIKeyNotSetModal)==null||r.destroy(),(a=this.aiWorkingModal)==null||a.destroy(),(o=this.aiGenerationFailedModal)==null||o.destroy()}reload(){this.destroy(),this.initialize()}}let Gt=null;function fe(){return Gt||(Gt=new yn(()=>{console.warn("User cancelled loading.")})),Gt}let hs=!1;function Ue(i="Loading Sounds...",e="Please wait while we dial it in.",t,s){if(Ur()||ps()&&!s)return;s&&(si(),fs(!0));const n=fe();n.showLoading({title:i,subtext:e,cancelable:!!t}),t&&(n.destroy(),n.reload())}function si(i){i&&fs(!1),ps()||fe().hideLoading()}function fs(i){hs=i}function ps(){return hs}let De=0;function ms(){De++,De===1&&Ue()}function ys(){De--,De<=0&&(De=0,si())}async function _n(i){ms();try{return await i}finally{ys()}}const kt=new Map;async function gn(i,e){e?await i.load:await Nn(i.load)}async function pt(i,e=z(),t=null,s,n,r,a=!0){var C;const o=i.split("/");let l="sf2",c="musyngkite",d="acoustic_grand_piano";o.length===3?[l,c,d]=o:o.length===2?[c,d]=o:o.length===1&&(d=o[0]);const u=e instanceof OfflineAudioContext;kt.has(e)||kt.set(e,new Map);const h=kt.get(e),f=String(e??z()),y=`${c}/${d}@${f}`;if(a&&h.has(y))return h.get(y);const b=Math.max(0,Math.min(127,Math.round((s??1)*127))),_=e.createStereoPanner();n!==void 0&&(_.pan.value=n);const m=e.createGain();m.connect(_),t&&t.context!==e&&(console.warn("[loadInstrument] Ignoring mismatched destination from different context"),t=null),_.connect(t||Le(e));const v={instrument:d,volume:b,destination:m,disableScheduler:u};let S;if(c==="smolken")S=new Nr(e,v);else if(c==="splendidgrandpiano")S=new wr(e,v);else if(c==="mallets")S=new Mr(e,v);else if(c==="drummachines")S=new Lr(e,v);else{const w={"fluidr3-gm":"FluidR3_GM",fatboy:"FatBoy",musyngkite:"MusyngKite"}[c.toLowerCase()]||"MusyngKite",G=`https://gleitz.github.io/midi-js-soundfonts/${w}/${d}-ogg.js`;S=new xr(e,{...v,instrumentUrl:G,kit:w})}if(await gn(S,r??!1),c==="drummachines"){const N=((C=S.getSampleNames)==null?void 0:C.call(S))??[],w=new Map;N.forEach((M,G)=>{const k=36+G;w.set(k,M)}),S.__midiMap=w}const g=S;return g.setVolume=N=>{var M;const w=Math.max(0,Math.min(127,Math.round(N*127)));"output"in g&&typeof((M=g.output)==null?void 0:M.setVolume)=="function"&&g.output.setVolume(w)},g.setPan=N=>{_.pan.value=Math.max(-1,Math.min(1,N))},a&&h.set(y,g),g}async function bn(){const e=vn().map(s=>{switch(s){case"FluidR3_GM":return"fluidr3-gm";case"FatBoy":return"fatboy";case"MusyngKite":return"musyngkite";default:return s.toLowerCase()}}),t=["splendidgrandpiano","mallets","drummachines","smolken"];return[...new Set([...e,...t])]}function vn(){const e=[...Er()];return e.includes("FatBoy")||e.push("FatBoy"),e}async function Sn(i){const e=i.toLowerCase();return e==="splendidgrandpiano"?["splendidgrandpiano"]:e==="mallets"?Gr():e==="drummachines"?as():e==="smolken"?kr():(await pt(`${i}/acoustic_grand_piano`,z(),null,0,0,!0),Br()??[])}function Cn(){return as()}async function Nn(i){ms();try{await i}finally{ys()}}function wn(){return{name:"sf2",loadInstrument:pt,getAvailableLibraries:bn,getAvailableInstruments:Sn}}let Bt=null,tt=null;function Ce(){return Bt||(Bt=new AudioContext),Bt}function Mn(){if(!tt){const i=Ce();tt=i.createGain(),tt.connect(i.destination)}return tt}const Ln={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function H(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,s,n]=e,r=t.toUpperCase(),a=Ln[r];if(a===void 0)return null;const o=[...s].reduce((c,d)=>d==="#"?c+1:d==="b"?c-1:c,0);return 12*(parseInt(n,10)+1)+(a+o)}let ee=null,Xt=null;async function xn(i){if(Xt===i)return;ee=await pt(i,Ce()),Xt=i}function Gn(){return Xt}function kn(i,e=100,t=!1){var o;if(!ee)return null;const n=Ce().currentTime,r=H(i);if(r===null)return null;const a=((o=ee.__midiMap)==null?void 0:o.get(r))??r;return ee.start({note:a,stopId:a,velocity:e,time:n,loop:t}),()=>{ee==null||ee.stop({stopId:a})}}function Bn(i){var s;if(!ee)return;const e=H(i);if(e===null)return;const t=((s=ee.__midiMap)==null?void 0:s.get(e))??e;ee.stop({stopId:t})}async function En(i,e,t,s=100,n=!1,r=null,a=null,o=null,l,c){var y;const d=a||z(),u=await pt(i,d,o,l,c);l!==void 0&&u.setVolume&&u.setVolume(l),c!==void 0&&u.setPan&&u.setPan(c);const h=H(e);if(h===null)return null;const f=((y=u.__midiMap)==null?void 0:y.get(h))??h;return u.start({note:f,duration:t,velocity:s,loop:n,time:r??d.currentTime}),null}function Tn(){return{name:"sf2",setActiveInstrument:xn,getActiveInstrumentName:Gn,playNote:kn,stopNoteByPitch:Bn,loadAndPlayNote:En}}const Ke=[{id:"0000_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Grand Piano"},{id:"0000_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Grand Piano"},{id:"0000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Grand Piano"},{id:"0000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Grand Piano"},{id:"0000_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Grand Piano"},{id:"0000_SBLive_sf2",library:"SBLive",displayName:"Acoustic Grand Piano"},{id:"0000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Grand Piano"},{id:"0010_Aspirin_sf2_file",library:"Aspirin",displayName:"Bright Acoustic Piano"},{id:"0010_Chaos_sf2_file",library:"Chaos",displayName:"Bright Acoustic Piano"},{id:"0010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bright Acoustic Piano"},{id:"0010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bright Acoustic Piano"},{id:"0010_JCLive_sf2_file",library:"JCLive",displayName:"Bright Acoustic Piano"},{id:"0010_SBLive_sf2",library:"SBLive",displayName:"Bright Acoustic Piano"},{id:"0010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bright Acoustic Piano"},{id:"0020_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Grand Piano"},{id:"0020_Chaos_sf2_file",library:"Chaos",displayName:"Electric Grand Piano"},{id:"0020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Grand Piano"},{id:"0020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Grand Piano"},{id:"0020_JCLive_sf2_file",library:"JCLive",displayName:"Electric Grand Piano"},{id:"0020_SBLive_sf2",library:"SBLive",displayName:"Electric Grand Piano"},{id:"0020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Grand Piano"},{id:"0050_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Piano 2"},{id:"0050_Chaos_sf2_file",library:"Chaos",displayName:"Electric Piano 2"},{id:"0050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Piano 2"},{id:"0050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Piano 2"},{id:"0050_JCLive_sf2_file",library:"JCLive",displayName:"Electric Piano 2"},{id:"0050_SBLive_sf2",library:"SBLive",displayName:"Electric Piano 2"},{id:"0050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Piano 2"},{id:"0060_Aspirin_sf2_file",library:"Aspirin",displayName:"Harpsichord"},{id:"0060_Chaos_sf2_file",library:"Chaos",displayName:"Harpsichord"},{id:"0060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harpsichord"},{id:"0060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harpsichord"},{id:"0060_JCLive_sf2_file",library:"JCLive",displayName:"Harpsichord"},{id:"0060_SBLive_sf2",library:"SBLive",displayName:"Harpsichord"},{id:"0060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harpsichord"},{id:"0070_Aspirin_sf2_file",library:"Aspirin",displayName:"Clavinet"},{id:"0070_Chaos_sf2_file",library:"Chaos",displayName:"Clavinet"},{id:"0070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clavinet"},{id:"0070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clavinet"},{id:"0070_JCLive_sf2_file",library:"JCLive",displayName:"Clavinet"},{id:"0070_SBLive_sf2",library:"SBLive",displayName:"Clavinet"},{id:"0070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clavinet"},{id:"0080_Aspirin_sf2_file",library:"Aspirin",displayName:"Celesta"},{id:"0080_Chaos_sf2_file",library:"Chaos",displayName:"Celesta"},{id:"0080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Celesta"},{id:"0080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Celesta"},{id:"0080_JCLive_sf2_file",library:"JCLive",displayName:"Celesta"},{id:"0080_SBLive_sf2",library:"SBLive",displayName:"Celesta"},{id:"0080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Celesta"},{id:"0090_Aspirin_sf2_file",library:"Aspirin",displayName:"Glockenspiel"},{id:"0090_Chaos_sf2_file",library:"Chaos",displayName:"Glockenspiel"},{id:"0090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Glockenspiel"},{id:"0090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Glockenspiel"},{id:"0090_JCLive_sf2_file",library:"JCLive",displayName:"Glockenspiel"},{id:"0090_SBLive_sf2",library:"SBLive",displayName:"Glockenspiel"},{id:"0090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Glockenspiel"},{id:"0100_Aspirin_sf2_file",library:"Aspirin",displayName:"Music Box"},{id:"0100_Chaos_sf2_file",library:"Chaos",displayName:"Music Box"},{id:"0100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Music Box"},{id:"0100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Music Box"},{id:"0100_JCLive_sf2_file",library:"JCLive",displayName:"Music Box"},{id:"0100_SBLive_sf2",library:"SBLive",displayName:"Music Box"},{id:"0100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Music Box"},{id:"0110_Aspirin_sf2_file",library:"Aspirin",displayName:"Vibraphone"},{id:"0110_Chaos_sf2_file",library:"Chaos",displayName:"Vibraphone"},{id:"0110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Vibraphone"},{id:"0110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Vibraphone"},{id:"0110_JCLive_sf2_file",library:"JCLive",displayName:"Vibraphone"},{id:"0110_SBLive_sf2",library:"SBLive",displayName:"Vibraphone"},{id:"0110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Vibraphone"},{id:"0120_Aspirin_sf2_file",library:"Aspirin",displayName:"Marimba"},{id:"0120_Chaos_sf2_file",library:"Chaos",displayName:"Marimba"},{id:"0120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Marimba"},{id:"0120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Marimba"},{id:"0120_JCLive_sf2_file",library:"JCLive",displayName:"Marimba"},{id:"0120_SBLive_sf2",library:"SBLive",displayName:"Marimba"},{id:"0120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Marimba"},{id:"0130_Aspirin_sf2_file",library:"Aspirin",displayName:"Xylophone"},{id:"0130_Chaos_sf2_file",library:"Chaos",displayName:"Xylophone"},{id:"0130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Xylophone"},{id:"0130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Xylophone"},{id:"0130_JCLive_sf2_file",library:"JCLive",displayName:"Xylophone"},{id:"0130_SBLive_sf2",library:"SBLive",displayName:"Xylophone"},{id:"0130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Xylophone"},{id:"0140_Aspirin_sf2_file",library:"Aspirin",displayName:"Tubular Bells"},{id:"0140_Chaos_sf2_file",library:"Chaos",displayName:"Tubular Bells"},{id:"0140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tubular Bells"},{id:"0140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tubular Bells"},{id:"0140_JCLive_sf2_file",library:"JCLive",displayName:"Tubular Bells"},{id:"0140_SBLive_sf2",library:"SBLive",displayName:"Tubular Bells"},{id:"0140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tubular Bells"},{id:"0150_Aspirin_sf2_file",library:"Aspirin",displayName:"Dulcimer"},{id:"0150_Chaos_sf2_file",library:"Chaos",displayName:"Dulcimer"},{id:"0150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Dulcimer"},{id:"0150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Dulcimer"},{id:"0150_JCLive_sf2_file",library:"JCLive",displayName:"Dulcimer"},{id:"0150_SBLive_sf2",library:"SBLive",displayName:"Dulcimer"},{id:"0150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Dulcimer"},{id:"0160_Aspirin_sf2_file",library:"Aspirin",displayName:"Drawbar Organ"},{id:"0160_Chaos_sf2_file",library:"Chaos",displayName:"Drawbar Organ"},{id:"0160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drawbar Organ"},{id:"0160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Drawbar Organ"},{id:"0160_JCLive_sf2_file",library:"JCLive",displayName:"Drawbar Organ"},{id:"0160_SBLive_sf2",library:"SBLive",displayName:"Drawbar Organ"},{id:"0160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Drawbar Organ"},{id:"0170_Aspirin_sf2_file",library:"Aspirin",displayName:"Percussive Organ"},{id:"0170_Chaos_sf2_file",library:"Chaos",displayName:"Percussive Organ"},{id:"0170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Percussive Organ"},{id:"0170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Percussive Organ"},{id:"0170_JCLive_sf2_file",library:"JCLive",displayName:"Percussive Organ"},{id:"0170_SBLive_sf2",library:"SBLive",displayName:"Percussive Organ"},{id:"0170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Percussive Organ"},{id:"0180_Aspirin_sf2_file",library:"Aspirin",displayName:"Rock Organ"},{id:"0180_Chaos_sf2_file",library:"Chaos",displayName:"Rock Organ"},{id:"0180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Rock Organ"},{id:"0180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Rock Organ"},{id:"0180_JCLive_sf2_file",library:"JCLive",displayName:"Rock Organ"},{id:"0180_SBLive_sf2",library:"SBLive",displayName:"Rock Organ"},{id:"0180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Rock Organ"},{id:"0190_Aspirin_sf2_file",library:"Aspirin",displayName:"Church Organ"},{id:"0190_Chaos_sf2_file",library:"Chaos",displayName:"Church Organ"},{id:"0190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Church Organ"},{id:"0190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Church Organ"},{id:"0190_JCLive_sf2_file",library:"JCLive",displayName:"Church Organ"},{id:"0190_SBLive_sf2",library:"SBLive",displayName:"Church Organ"},{id:"0190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Church Organ"},{id:"0200_Aspirin_sf2_file",library:"Aspirin",displayName:"Reed Organ"},{id:"0200_Chaos_sf2_file",library:"Chaos",displayName:"Reed Organ"},{id:"0200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reed Organ"},{id:"0200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reed Organ"},{id:"0200_JCLive_sf2_file",library:"JCLive",displayName:"Reed Organ"},{id:"0200_SBLive_sf2",library:"SBLive",displayName:"Reed Organ"},{id:"0200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reed Organ"},{id:"0210_Aspirin_sf2_file",library:"Aspirin",displayName:"Accordion"},{id:"0210_Chaos_sf2_file",library:"Chaos",displayName:"Accordion"},{id:"0210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Accordion"},{id:"0210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Accordion"},{id:"0210_JCLive_sf2_file",library:"JCLive",displayName:"Accordion"},{id:"0210_SBLive_sf2",library:"SBLive",displayName:"Accordion"},{id:"0210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Accordion"},{id:"0220_Aspirin_sf2_file",library:"Aspirin",displayName:"Harmonica"},{id:"0220_Chaos_sf2_file",library:"Chaos",displayName:"Harmonica"},{id:"0220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Harmonica"},{id:"0220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Harmonica"},{id:"0220_JCLive_sf2_file",library:"JCLive",displayName:"Harmonica"},{id:"0220_SBLive_sf2",library:"SBLive",displayName:"Harmonica"},{id:"0220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Harmonica"},{id:"0230_Aspirin_sf2_file",library:"Aspirin",displayName:"Tango Accordion"},{id:"0230_Chaos_sf2_file",library:"Chaos",displayName:"Tango Accordion"},{id:"0230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tango Accordion"},{id:"0230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tango Accordion"},{id:"0230_JCLive_sf2_file",library:"JCLive",displayName:"Tango Accordion"},{id:"0230_SBLive_sf2",library:"SBLive",displayName:"Tango Accordion"},{id:"0230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tango Accordion"},{id:"0240_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (nylon)"},{id:"0240_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (nylon)"},{id:"0240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (nylon)"},{id:"0240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (nylon)"},{id:"0240_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (nylon)"},{id:"0240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (nylon)"},{id:"0250_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Guitar (steel)"},{id:"0250_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Guitar (steel)"},{id:"0250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Guitar (steel)"},{id:"0250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Guitar (steel)"},{id:"0250_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SBLive_sf2",library:"SBLive",displayName:"Acoustic Guitar (steel)"},{id:"0250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Guitar (steel)"},{id:"0260_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (jazz)"},{id:"0260_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (jazz)"},{id:"0260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (jazz)"},{id:"0260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (jazz)"},{id:"0260_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (jazz)"},{id:"0260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (jazz)"},{id:"0270_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (clean)"},{id:"0270_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (clean)"},{id:"0270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (clean)"},{id:"0270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (clean)"},{id:"0270_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (clean)"},{id:"0270_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (clean)"},{id:"0270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (clean)"},{id:"0280_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Guitar (muted)"},{id:"0280_Chaos_sf2_file",library:"Chaos",displayName:"Electric Guitar (muted)"},{id:"0280_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Guitar (muted)"},{id:"0280_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Guitar (muted)"},{id:"0280_JCLive_sf2_file",library:"JCLive",displayName:"Electric Guitar (muted)"},{id:"0280_SBLive_sf2",library:"SBLive",displayName:"Electric Guitar (muted)"},{id:"0280_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Guitar (muted)"},{id:"0290_Aspirin_sf2_file",library:"Aspirin",displayName:"Overdriven Guitar"},{id:"0290_Chaos_sf2_file",library:"Chaos",displayName:"Overdriven Guitar"},{id:"0290_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Overdriven Guitar"},{id:"0290_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Overdriven Guitar"},{id:"0290_JCLive_sf2_file",library:"JCLive",displayName:"Overdriven Guitar"},{id:"0290_SBLive_sf2",library:"SBLive",displayName:"Overdriven Guitar"},{id:"0290_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Overdriven Guitar"},{id:"0300_Aspirin_sf2_file",library:"Aspirin",displayName:"Distortion Guitar"},{id:"0300_Chaos_sf2_file",library:"Chaos",displayName:"Distortion Guitar"},{id:"0300_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Distortion Guitar"},{id:"0300_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Distortion Guitar"},{id:"0300_JCLive_sf2_file",library:"JCLive",displayName:"Distortion Guitar"},{id:"0300_SBLive_sf2",library:"SBLive",displayName:"Distortion Guitar"},{id:"0300_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Distortion Guitar"},{id:"0310_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Harmonics"},{id:"0310_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Harmonics"},{id:"0310_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Harmonics"},{id:"0310_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Harmonics"},{id:"0310_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Harmonics"},{id:"0310_SBLive_sf2",library:"SBLive",displayName:"Guitar Harmonics"},{id:"0310_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Harmonics"},{id:"0320_Aspirin_sf2_file",library:"Aspirin",displayName:"Acoustic Bass"},{id:"0320_Chaos_sf2_file",library:"Chaos",displayName:"Acoustic Bass"},{id:"0320_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Acoustic Bass"},{id:"0320_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Acoustic Bass"},{id:"0320_JCLive_sf2_file",library:"JCLive",displayName:"Acoustic Bass"},{id:"0320_SBLive_sf2",library:"SBLive",displayName:"Acoustic Bass"},{id:"0320_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Acoustic Bass"},{id:"0330_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (finger)"},{id:"0330_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (finger)"},{id:"0330_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (finger)"},{id:"0330_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (finger)"},{id:"0330_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (finger)"},{id:"0330_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (finger)"},{id:"0330_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (finger)"},{id:"0340_Aspirin_sf2_file",library:"Aspirin",displayName:"Electric Bass (pick)"},{id:"0340_Chaos_sf2_file",library:"Chaos",displayName:"Electric Bass (pick)"},{id:"0340_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Electric Bass (pick)"},{id:"0340_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Electric Bass (pick)"},{id:"0340_JCLive_sf2_file",library:"JCLive",displayName:"Electric Bass (pick)"},{id:"0340_SBLive_sf2",library:"SBLive",displayName:"Electric Bass (pick)"},{id:"0340_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Electric Bass (pick)"},{id:"0350_Aspirin_sf2_file",library:"Aspirin",displayName:"Fretless Bass"},{id:"0350_Chaos_sf2_file",library:"Chaos",displayName:"Fretless Bass"},{id:"0350_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fretless Bass"},{id:"0350_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fretless Bass"},{id:"0350_JCLive_sf2_file",library:"JCLive",displayName:"Fretless Bass"},{id:"0350_SBLive_sf2",library:"SBLive",displayName:"Fretless Bass"},{id:"0350_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fretless Bass"},{id:"0360_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 1"},{id:"0360_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 1"},{id:"0360_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 1"},{id:"0360_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 1"},{id:"0360_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 1"},{id:"0360_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 1"},{id:"0360_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 1"},{id:"0370_Aspirin_sf2_file",library:"Aspirin",displayName:"Slap Bass 2"},{id:"0370_Chaos_sf2_file",library:"Chaos",displayName:"Slap Bass 2"},{id:"0370_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Slap Bass 2"},{id:"0370_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Slap Bass 2"},{id:"0370_JCLive_sf2_file",library:"JCLive",displayName:"Slap Bass 2"},{id:"0370_SBLive_sf2",library:"SBLive",displayName:"Slap Bass 2"},{id:"0370_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Slap Bass 2"},{id:"0380_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 1"},{id:"0380_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 1"},{id:"0380_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 1"},{id:"0380_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 1"},{id:"0380_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 1"},{id:"0380_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 1"},{id:"0380_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 1"},{id:"0390_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Bass 2"},{id:"0390_Chaos_sf2_file",library:"Chaos",displayName:"Synth Bass 2"},{id:"0390_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Bass 2"},{id:"0390_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Bass 2"},{id:"0390_JCLive_sf2_file",library:"JCLive",displayName:"Synth Bass 2"},{id:"0390_SBLive_sf2",library:"SBLive",displayName:"Synth Bass 2"},{id:"0390_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Bass 2"},{id:"0400_Aspirin_sf2_file",library:"Aspirin",displayName:"Violin"},{id:"0400_Chaos_sf2_file",library:"Chaos",displayName:"Violin"},{id:"0400_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Violin"},{id:"0400_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Violin"},{id:"0400_JCLive_sf2_file",library:"JCLive",displayName:"Violin"},{id:"0400_SBLive_sf2",library:"SBLive",displayName:"Violin"},{id:"0400_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Violin"},{id:"0410_Aspirin_sf2_file",library:"Aspirin",displayName:"Viola"},{id:"0410_Chaos_sf2_file",library:"Chaos",displayName:"Viola"},{id:"0410_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Viola"},{id:"0410_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Viola"},{id:"0410_JCLive_sf2_file",library:"JCLive",displayName:"Viola"},{id:"0410_SBLive_sf2",library:"SBLive",displayName:"Viola"},{id:"0410_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Viola"},{id:"0420_Aspirin_sf2_file",library:"Aspirin",displayName:"Cello"},{id:"0420_Chaos_sf2_file",library:"Chaos",displayName:"Cello"},{id:"0420_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Cello"},{id:"0420_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Cello"},{id:"0420_JCLive_sf2_file",library:"JCLive",displayName:"Cello"},{id:"0420_SBLive_sf2",library:"SBLive",displayName:"Cello"},{id:"0420_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Cello"},{id:"0430_Aspirin_sf2_file",library:"Aspirin",displayName:"Contrabass"},{id:"0430_Chaos_sf2_file",library:"Chaos",displayName:"Contrabass"},{id:"0430_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Contrabass"},{id:"0430_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Contrabass"},{id:"0430_JCLive_sf2_file",library:"JCLive",displayName:"Contrabass"},{id:"0430_SBLive_sf2",library:"SBLive",displayName:"Contrabass"},{id:"0430_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Contrabass"},{id:"0440_Aspirin_sf2_file",library:"Aspirin",displayName:"Tremolo Strings"},{id:"0440_Chaos_sf2_file",library:"Chaos",displayName:"Tremolo Strings"},{id:"0440_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tremolo Strings"},{id:"0440_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tremolo Strings"},{id:"0440_JCLive_sf2_file",library:"JCLive",displayName:"Tremolo Strings"},{id:"0440_SBLive_sf2",library:"SBLive",displayName:"Tremolo Strings"},{id:"0440_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tremolo Strings"},{id:"0450_Aspirin_sf2_file",library:"Aspirin",displayName:"Pizzicato Strings"},{id:"0450_Chaos_sf2_file",library:"Chaos",displayName:"Pizzicato Strings"},{id:"0450_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pizzicato Strings"},{id:"0450_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pizzicato Strings"},{id:"0450_JCLive_sf2_file",library:"JCLive",displayName:"Pizzicato Strings"},{id:"0450_SBLive_sf2",library:"SBLive",displayName:"Pizzicato Strings"},{id:"0450_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pizzicato Strings"},{id:"0460_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestral Harp"},{id:"0460_Chaos_sf2_file",library:"Chaos",displayName:"Orchestral Harp"},{id:"0460_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestral Harp"},{id:"0460_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestral Harp"},{id:"0460_JCLive_sf2_file",library:"JCLive",displayName:"Orchestral Harp"},{id:"0460_SBLive_sf2",library:"SBLive",displayName:"Orchestral Harp"},{id:"0460_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestral Harp"},{id:"0470_Aspirin_sf2_file",library:"Aspirin",displayName:"Timpani"},{id:"0470_Chaos_sf2_file",library:"Chaos",displayName:"Timpani"},{id:"0470_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Timpani"},{id:"0470_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Timpani"},{id:"0470_JCLive_sf2_file",library:"JCLive",displayName:"Timpani"},{id:"0470_SBLive_sf2",library:"SBLive",displayName:"Timpani"},{id:"0470_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Timpani"},{id:"0480_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 1"},{id:"0480_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 1"},{id:"0480_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 1"},{id:"0480_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 1"},{id:"0480_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 1"},{id:"0480_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 1"},{id:"0480_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 1"},{id:"0490_Aspirin_sf2_file",library:"Aspirin",displayName:"String Ensemble 2"},{id:"0490_Chaos_sf2_file",library:"Chaos",displayName:"String Ensemble 2"},{id:"0490_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"String Ensemble 2"},{id:"0490_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"String Ensemble 2"},{id:"0490_JCLive_sf2_file",library:"JCLive",displayName:"String Ensemble 2"},{id:"0490_SBLive_sf2",library:"SBLive",displayName:"String Ensemble 2"},{id:"0490_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"String Ensemble 2"},{id:"0500_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 1"},{id:"0500_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 1"},{id:"0500_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 1"},{id:"0500_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 1"},{id:"0500_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 1"},{id:"0500_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 1"},{id:"0500_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 1"},{id:"0510_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Strings 2"},{id:"0510_Chaos_sf2_file",library:"Chaos",displayName:"Synth Strings 2"},{id:"0510_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Strings 2"},{id:"0510_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Strings 2"},{id:"0510_JCLive_sf2_file",library:"JCLive",displayName:"Synth Strings 2"},{id:"0510_SBLive_sf2",library:"SBLive",displayName:"Synth Strings 2"},{id:"0510_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Strings 2"},{id:"0520_Aspirin_sf2_file",library:"Aspirin",displayName:"Choir Aahs"},{id:"0520_Chaos_sf2_file",library:"Chaos",displayName:"Choir Aahs"},{id:"0520_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Choir Aahs"},{id:"0520_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Choir Aahs"},{id:"0520_JCLive_sf2_file",library:"JCLive",displayName:"Choir Aahs"},{id:"0520_SBLive_sf2",library:"SBLive",displayName:"Choir Aahs"},{id:"0520_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Choir Aahs"},{id:"0530_Aspirin_sf2_file",library:"Aspirin",displayName:"Voice Oohs"},{id:"0530_Chaos_sf2_file",library:"Chaos",displayName:"Voice Oohs"},{id:"0530_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Voice Oohs"},{id:"0530_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Voice Oohs"},{id:"0530_JCLive_sf2_file",library:"JCLive",displayName:"Voice Oohs"},{id:"0530_SBLive_sf2",library:"SBLive",displayName:"Voice Oohs"},{id:"0530_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Voice Oohs"},{id:"0540_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Choir"},{id:"0540_Chaos_sf2_file",library:"Chaos",displayName:"Synth Choir"},{id:"0540_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Choir"},{id:"0540_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Choir"},{id:"0540_JCLive_sf2_file",library:"JCLive",displayName:"Synth Choir"},{id:"0540_SBLive_sf2",library:"SBLive",displayName:"Synth Choir"},{id:"0540_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Choir"},{id:"0550_Aspirin_sf2_file",library:"Aspirin",displayName:"Orchestra Hit"},{id:"0550_Chaos_sf2_file",library:"Chaos",displayName:"Orchestra Hit"},{id:"0550_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Orchestra Hit"},{id:"0550_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Orchestra Hit"},{id:"0550_JCLive_sf2_file",library:"JCLive",displayName:"Orchestra Hit"},{id:"0550_SBLive_sf2",library:"SBLive",displayName:"Orchestra Hit"},{id:"0550_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Orchestra Hit"},{id:"0560_Aspirin_sf2_file",library:"Aspirin",displayName:"Trumpet"},{id:"0560_Chaos_sf2_file",library:"Chaos",displayName:"Trumpet"},{id:"0560_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trumpet"},{id:"0560_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trumpet"},{id:"0560_JCLive_sf2_file",library:"JCLive",displayName:"Trumpet"},{id:"0560_SBLive_sf2",library:"SBLive",displayName:"Trumpet"},{id:"0560_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trumpet"},{id:"0570_Aspirin_sf2_file",library:"Aspirin",displayName:"Trombone"},{id:"0570_Chaos_sf2_file",library:"Chaos",displayName:"Trombone"},{id:"0570_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Trombone"},{id:"0570_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Trombone"},{id:"0570_JCLive_sf2_file",library:"JCLive",displayName:"Trombone"},{id:"0570_SBLive_sf2",library:"SBLive",displayName:"Trombone"},{id:"0570_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Trombone"},{id:"0580_Aspirin_sf2_file",library:"Aspirin",displayName:"Tuba"},{id:"0580_Chaos_sf2_file",library:"Chaos",displayName:"Tuba"},{id:"0580_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tuba"},{id:"0580_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tuba"},{id:"0580_JCLive_sf2_file",library:"JCLive",displayName:"Tuba"},{id:"0580_SBLive_sf2",library:"SBLive",displayName:"Tuba"},{id:"0580_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tuba"},{id:"0590_Aspirin_sf2_file",library:"Aspirin",displayName:"Muted Trumpet"},{id:"0590_Chaos_sf2_file",library:"Chaos",displayName:"Muted Trumpet"},{id:"0590_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Muted Trumpet"},{id:"0590_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Muted Trumpet"},{id:"0590_JCLive_sf2_file",library:"JCLive",displayName:"Muted Trumpet"},{id:"0590_SBLive_sf2",library:"SBLive",displayName:"Muted Trumpet"},{id:"0590_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Muted Trumpet"},{id:"0600_Aspirin_sf2_file",library:"Aspirin",displayName:"French Horn"},{id:"0600_Chaos_sf2_file",library:"Chaos",displayName:"French Horn"},{id:"0600_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"French Horn"},{id:"0600_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"French Horn"},{id:"0600_JCLive_sf2_file",library:"JCLive",displayName:"French Horn"},{id:"0600_SBLive_sf2",library:"SBLive",displayName:"French Horn"},{id:"0600_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"French Horn"},{id:"0610_Aspirin_sf2_file",library:"Aspirin",displayName:"Brass Section"},{id:"0610_Chaos_sf2_file",library:"Chaos",displayName:"Brass Section"},{id:"0610_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Brass Section"},{id:"0610_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Brass Section"},{id:"0610_JCLive_sf2_file",library:"JCLive",displayName:"Brass Section"},{id:"0610_SBLive_sf2",library:"SBLive",displayName:"Brass Section"},{id:"0610_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Brass Section"},{id:"0620_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 1"},{id:"0620_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 1"},{id:"0620_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 1"},{id:"0620_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 1"},{id:"0620_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 1"},{id:"0620_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 1"},{id:"0620_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 1"},{id:"0630_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Brass 2"},{id:"0630_Chaos_sf2_file",library:"Chaos",displayName:"Synth Brass 2"},{id:"0630_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Brass 2"},{id:"0630_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Brass 2"},{id:"0630_JCLive_sf2_file",library:"JCLive",displayName:"Synth Brass 2"},{id:"0630_SBLive_sf2",library:"SBLive",displayName:"Synth Brass 2"},{id:"0630_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Brass 2"},{id:"0640_Aspirin_sf2_file",library:"Aspirin",displayName:"Soprano Sax"},{id:"0640_Chaos_sf2_file",library:"Chaos",displayName:"Soprano Sax"},{id:"0640_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Soprano Sax"},{id:"0640_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Soprano Sax"},{id:"0640_JCLive_sf2_file",library:"JCLive",displayName:"Soprano Sax"},{id:"0640_SBLive_sf2",library:"SBLive",displayName:"Soprano Sax"},{id:"0640_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Soprano Sax"},{id:"0650_Aspirin_sf2_file",library:"Aspirin",displayName:"Alto Sax"},{id:"0650_Chaos_sf2_file",library:"Chaos",displayName:"Alto Sax"},{id:"0650_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Alto Sax"},{id:"0650_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Alto Sax"},{id:"0650_JCLive_sf2_file",library:"JCLive",displayName:"Alto Sax"},{id:"0650_SBLive_sf2",library:"SBLive",displayName:"Alto Sax"},{id:"0650_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Alto Sax"},{id:"0660_Aspirin_sf2_file",library:"Aspirin",displayName:"Tenor Sax"},{id:"0660_Chaos_sf2_file",library:"Chaos",displayName:"Tenor Sax"},{id:"0660_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tenor Sax"},{id:"0660_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tenor Sax"},{id:"0660_JCLive_sf2_file",library:"JCLive",displayName:"Tenor Sax"},{id:"0660_SBLive_sf2",library:"SBLive",displayName:"Tenor Sax"},{id:"0660_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tenor Sax"},{id:"0670_Aspirin_sf2_file",library:"Aspirin",displayName:"Baritone Sax"},{id:"0670_Chaos_sf2_file",library:"Chaos",displayName:"Baritone Sax"},{id:"0670_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Baritone Sax"},{id:"0670_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Baritone Sax"},{id:"0670_JCLive_sf2_file",library:"JCLive",displayName:"Baritone Sax"},{id:"0670_SBLive_sf2",library:"SBLive",displayName:"Baritone Sax"},{id:"0670_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Baritone Sax"},{id:"0680_Aspirin_sf2_file",library:"Aspirin",displayName:"Oboe"},{id:"0680_Chaos_sf2_file",library:"Chaos",displayName:"Oboe"},{id:"0680_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Oboe"},{id:"0680_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Oboe"},{id:"0680_JCLive_sf2_file",library:"JCLive",displayName:"Oboe"},{id:"0680_SBLive_sf2",library:"SBLive",displayName:"Oboe"},{id:"0680_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Oboe"},{id:"0690_Aspirin_sf2_file",library:"Aspirin",displayName:"English Horn"},{id:"0690_Chaos_sf2_file",library:"Chaos",displayName:"English Horn"},{id:"0690_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"English Horn"},{id:"0690_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"English Horn"},{id:"0690_JCLive_sf2_file",library:"JCLive",displayName:"English Horn"},{id:"0690_SBLive_sf2",library:"SBLive",displayName:"English Horn"},{id:"0690_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"English Horn"},{id:"0700_Aspirin_sf2_file",library:"Aspirin",displayName:"Bassoon"},{id:"0700_Chaos_sf2_file",library:"Chaos",displayName:"Bassoon"},{id:"0700_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bassoon"},{id:"0700_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bassoon"},{id:"0700_JCLive_sf2_file",library:"JCLive",displayName:"Bassoon"},{id:"0700_SBLive_sf2",library:"SBLive",displayName:"Bassoon"},{id:"0700_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bassoon"},{id:"0710_Aspirin_sf2_file",library:"Aspirin",displayName:"Clarinet"},{id:"0710_Chaos_sf2_file",library:"Chaos",displayName:"Clarinet"},{id:"0710_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Clarinet"},{id:"0710_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Clarinet"},{id:"0710_JCLive_sf2_file",library:"JCLive",displayName:"Clarinet"},{id:"0710_SBLive_sf2",library:"SBLive",displayName:"Clarinet"},{id:"0710_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Clarinet"},{id:"0720_Aspirin_sf2_file",library:"Aspirin",displayName:"Piccolo"},{id:"0720_Chaos_sf2_file",library:"Chaos",displayName:"Piccolo"},{id:"0720_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Piccolo"},{id:"0720_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Piccolo"},{id:"0720_JCLive_sf2_file",library:"JCLive",displayName:"Piccolo"},{id:"0720_SBLive_sf2",library:"SBLive",displayName:"Piccolo"},{id:"0720_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Piccolo"},{id:"0730_Aspirin_sf2_file",library:"Aspirin",displayName:"Flute"},{id:"0730_Chaos_sf2_file",library:"Chaos",displayName:"Flute"},{id:"0730_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Flute"},{id:"0730_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Flute"},{id:"0730_JCLive_sf2_file",library:"JCLive",displayName:"Flute"},{id:"0730_SBLive_sf2",library:"SBLive",displayName:"Flute"},{id:"0730_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Flute"},{id:"0740_Aspirin_sf2_file",library:"Aspirin",displayName:"Recorder"},{id:"0740_Chaos_sf2_file",library:"Chaos",displayName:"Recorder"},{id:"0740_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Recorder"},{id:"0740_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Recorder"},{id:"0740_JCLive_sf2_file",library:"JCLive",displayName:"Recorder"},{id:"0740_SBLive_sf2",library:"SBLive",displayName:"Recorder"},{id:"0740_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Recorder"},{id:"0750_Aspirin_sf2_file",library:"Aspirin",displayName:"Pan Flute"},{id:"0750_Chaos_sf2_file",library:"Chaos",displayName:"Pan Flute"},{id:"0750_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pan Flute"},{id:"0750_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pan Flute"},{id:"0750_JCLive_sf2_file",library:"JCLive",displayName:"Pan Flute"},{id:"0750_SBLive_sf2",library:"SBLive",displayName:"Pan Flute"},{id:"0750_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pan Flute"},{id:"0760_Aspirin_sf2_file",library:"Aspirin",displayName:"Blown Bottle"},{id:"0760_Chaos_sf2_file",library:"Chaos",displayName:"Blown Bottle"},{id:"0760_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Blown Bottle"},{id:"0760_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Blown Bottle"},{id:"0760_JCLive_sf2_file",library:"JCLive",displayName:"Blown Bottle"},{id:"0760_SBLive_sf2",library:"SBLive",displayName:"Blown Bottle"},{id:"0760_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Blown Bottle"},{id:"0770_Aspirin_sf2_file",library:"Aspirin",displayName:"Shakuhachi"},{id:"0770_Chaos_sf2_file",library:"Chaos",displayName:"Shakuhachi"},{id:"0770_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shakuhachi"},{id:"0770_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shakuhachi"},{id:"0770_JCLive_sf2_file",library:"JCLive",displayName:"Shakuhachi"},{id:"0770_SBLive_sf2",library:"SBLive",displayName:"Shakuhachi"},{id:"0770_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shakuhachi"},{id:"0780_Aspirin_sf2_file",library:"Aspirin",displayName:"Whistle"},{id:"0780_Chaos_sf2_file",library:"Chaos",displayName:"Whistle"},{id:"0780_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Whistle"},{id:"0780_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Whistle"},{id:"0780_JCLive_sf2_file",library:"JCLive",displayName:"Whistle"},{id:"0780_SBLive_sf2",library:"SBLive",displayName:"Whistle"},{id:"0780_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Whistle"},{id:"0790_Aspirin_sf2_file",library:"Aspirin",displayName:"Ocarina"},{id:"0790_Chaos_sf2_file",library:"Chaos",displayName:"Ocarina"},{id:"0790_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Ocarina"},{id:"0790_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Ocarina"},{id:"0790_JCLive_sf2_file",library:"JCLive",displayName:"Ocarina"},{id:"0790_SBLive_sf2",library:"SBLive",displayName:"Ocarina"},{id:"0790_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Ocarina"},{id:"0800_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 1 (square)"},{id:"0800_Chaos_sf2_file",library:"Chaos",displayName:"Lead 1 (square)"},{id:"0800_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 1 (square)"},{id:"0800_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 1 (square)"},{id:"0800_JCLive_sf2_file",library:"JCLive",displayName:"Lead 1 (square)"},{id:"0800_SBLive_sf2",library:"SBLive",displayName:"Lead 1 (square)"},{id:"0800_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 1 (square)"},{id:"0810_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 2 (sawtooth)"},{id:"0810_Chaos_sf2_file",library:"Chaos",displayName:"Lead 2 (sawtooth)"},{id:"0810_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 2 (sawtooth)"},{id:"0810_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 2 (sawtooth)"},{id:"0810_JCLive_sf2_file",library:"JCLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SBLive_sf2",library:"SBLive",displayName:"Lead 2 (sawtooth)"},{id:"0810_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 2 (sawtooth)"},{id:"0820_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 3 (calliope)"},{id:"0820_Chaos_sf2_file",library:"Chaos",displayName:"Lead 3 (calliope)"},{id:"0820_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 3 (calliope)"},{id:"0820_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 3 (calliope)"},{id:"0820_JCLive_sf2_file",library:"JCLive",displayName:"Lead 3 (calliope)"},{id:"0820_SBLive_sf2",library:"SBLive",displayName:"Lead 3 (calliope)"},{id:"0820_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 3 (calliope)"},{id:"0830_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 4 (chiff)"},{id:"0830_Chaos_sf2_file",library:"Chaos",displayName:"Lead 4 (chiff)"},{id:"0830_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 4 (chiff)"},{id:"0830_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 4 (chiff)"},{id:"0830_JCLive_sf2_file",library:"JCLive",displayName:"Lead 4 (chiff)"},{id:"0830_SBLive_sf2",library:"SBLive",displayName:"Lead 4 (chiff)"},{id:"0830_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 4 (chiff)"},{id:"0840_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 5 (charang)"},{id:"0840_Chaos_sf2_file",library:"Chaos",displayName:"Lead 5 (charang)"},{id:"0840_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 5 (charang)"},{id:"0840_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 5 (charang)"},{id:"0840_JCLive_sf2_file",library:"JCLive",displayName:"Lead 5 (charang)"},{id:"0840_SBLive_sf2",library:"SBLive",displayName:"Lead 5 (charang)"},{id:"0840_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 5 (charang)"},{id:"0850_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 6 (voice)"},{id:"0850_Chaos_sf2_file",library:"Chaos",displayName:"Lead 6 (voice)"},{id:"0850_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 6 (voice)"},{id:"0850_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 6 (voice)"},{id:"0850_JCLive_sf2_file",library:"JCLive",displayName:"Lead 6 (voice)"},{id:"0850_SBLive_sf2",library:"SBLive",displayName:"Lead 6 (voice)"},{id:"0850_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 6 (voice)"},{id:"0860_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 7 (fifths)"},{id:"0860_Chaos_sf2_file",library:"Chaos",displayName:"Lead 7 (fifths)"},{id:"0860_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 7 (fifths)"},{id:"0860_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 7 (fifths)"},{id:"0860_JCLive_sf2_file",library:"JCLive",displayName:"Lead 7 (fifths)"},{id:"0860_SBLive_sf2",library:"SBLive",displayName:"Lead 7 (fifths)"},{id:"0860_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 7 (fifths)"},{id:"0870_Aspirin_sf2_file",library:"Aspirin",displayName:"Lead 8 (bass + lead)"},{id:"0870_Chaos_sf2_file",library:"Chaos",displayName:"Lead 8 (bass + lead)"},{id:"0870_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Lead 8 (bass + lead)"},{id:"0870_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Lead 8 (bass + lead)"},{id:"0870_JCLive_sf2_file",library:"JCLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SBLive_sf2",library:"SBLive",displayName:"Lead 8 (bass + lead)"},{id:"0870_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Lead 8 (bass + lead)"},{id:"0880_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 1 (new age)"},{id:"0880_Chaos_sf2_file",library:"Chaos",displayName:"Pad 1 (new age)"},{id:"0880_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 1 (new age)"},{id:"0880_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 1 (new age)"},{id:"0880_JCLive_sf2_file",library:"JCLive",displayName:"Pad 1 (new age)"},{id:"0880_SBLive_sf2",library:"SBLive",displayName:"Pad 1 (new age)"},{id:"0880_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 1 (new age)"},{id:"0890_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 2 (warm)"},{id:"0890_Chaos_sf2_file",library:"Chaos",displayName:"Pad 2 (warm)"},{id:"0890_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 2 (warm)"},{id:"0890_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 2 (warm)"},{id:"0890_JCLive_sf2_file",library:"JCLive",displayName:"Pad 2 (warm)"},{id:"0890_SBLive_sf2",library:"SBLive",displayName:"Pad 2 (warm)"},{id:"0890_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 2 (warm)"},{id:"0900_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 3 (polysynth)"},{id:"0900_Chaos_sf2_file",library:"Chaos",displayName:"Pad 3 (polysynth)"},{id:"0900_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 3 (polysynth)"},{id:"0900_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 3 (polysynth)"},{id:"0900_JCLive_sf2_file",library:"JCLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SBLive_sf2",library:"SBLive",displayName:"Pad 3 (polysynth)"},{id:"0900_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 3 (polysynth)"},{id:"0910_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 4 (choir)"},{id:"0910_Chaos_sf2_file",library:"Chaos",displayName:"Pad 4 (choir)"},{id:"0910_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 4 (choir)"},{id:"0910_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 4 (choir)"},{id:"0910_JCLive_sf2_file",library:"JCLive",displayName:"Pad 4 (choir)"},{id:"0910_SBLive_sf2",library:"SBLive",displayName:"Pad 4 (choir)"},{id:"0910_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 4 (choir)"},{id:"0920_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 5 (bowed)"},{id:"0920_Chaos_sf2_file",library:"Chaos",displayName:"Pad 5 (bowed)"},{id:"0920_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 5 (bowed)"},{id:"0920_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 5 (bowed)"},{id:"0920_JCLive_sf2_file",library:"JCLive",displayName:"Pad 5 (bowed)"},{id:"0920_SBLive_sf2",library:"SBLive",displayName:"Pad 5 (bowed)"},{id:"0920_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 5 (bowed)"},{id:"0930_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 6 (metallic)"},{id:"0930_Chaos_sf2_file",library:"Chaos",displayName:"Pad 6 (metallic)"},{id:"0930_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 6 (metallic)"},{id:"0930_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 6 (metallic)"},{id:"0930_JCLive_sf2_file",library:"JCLive",displayName:"Pad 6 (metallic)"},{id:"0930_SBLive_sf2",library:"SBLive",displayName:"Pad 6 (metallic)"},{id:"0930_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 6 (metallic)"},{id:"0940_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 7 (halo)"},{id:"0940_Chaos_sf2_file",library:"Chaos",displayName:"Pad 7 (halo)"},{id:"0940_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 7 (halo)"},{id:"0940_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 7 (halo)"},{id:"0940_JCLive_sf2_file",library:"JCLive",displayName:"Pad 7 (halo)"},{id:"0940_SBLive_sf2",library:"SBLive",displayName:"Pad 7 (halo)"},{id:"0940_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 7 (halo)"},{id:"0950_Aspirin_sf2_file",library:"Aspirin",displayName:"Pad 8 (sweep)"},{id:"0950_Chaos_sf2_file",library:"Chaos",displayName:"Pad 8 (sweep)"},{id:"0950_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Pad 8 (sweep)"},{id:"0950_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Pad 8 (sweep)"},{id:"0950_JCLive_sf2_file",library:"JCLive",displayName:"Pad 8 (sweep)"},{id:"0950_SBLive_sf2",library:"SBLive",displayName:"Pad 8 (sweep)"},{id:"0950_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Pad 8 (sweep)"},{id:"0960_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 1 (rain)"},{id:"0960_Chaos_sf2_file",library:"Chaos",displayName:"FX 1 (rain)"},{id:"0960_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 1 (rain)"},{id:"0960_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 1 (rain)"},{id:"0960_JCLive_sf2_file",library:"JCLive",displayName:"FX 1 (rain)"},{id:"0960_SBLive_sf2",library:"SBLive",displayName:"FX 1 (rain)"},{id:"0960_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 1 (rain)"},{id:"0970_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 2 (soundtrack)"},{id:"0970_Chaos_sf2_file",library:"Chaos",displayName:"FX 2 (soundtrack)"},{id:"0970_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 2 (soundtrack)"},{id:"0970_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 2 (soundtrack)"},{id:"0970_JCLive_sf2_file",library:"JCLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SBLive_sf2",library:"SBLive",displayName:"FX 2 (soundtrack)"},{id:"0970_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 2 (soundtrack)"},{id:"0980_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 3 (crystal)"},{id:"0980_Chaos_sf2_file",library:"Chaos",displayName:"FX 3 (crystal)"},{id:"0980_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 3 (crystal)"},{id:"0980_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 3 (crystal)"},{id:"0980_JCLive_sf2_file",library:"JCLive",displayName:"FX 3 (crystal)"},{id:"0980_SBLive_sf2",library:"SBLive",displayName:"FX 3 (crystal)"},{id:"0980_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 3 (crystal)"},{id:"0990_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 4 (atmosphere)"},{id:"0990_Chaos_sf2_file",library:"Chaos",displayName:"FX 4 (atmosphere)"},{id:"0990_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 4 (atmosphere)"},{id:"0990_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 4 (atmosphere)"},{id:"0990_JCLive_sf2_file",library:"JCLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SBLive_sf2",library:"SBLive",displayName:"FX 4 (atmosphere)"},{id:"0990_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 4 (atmosphere)"},{id:"1000_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 5 (brightness)"},{id:"1000_Chaos_sf2_file",library:"Chaos",displayName:"FX 5 (brightness)"},{id:"1000_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 5 (brightness)"},{id:"1000_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 5 (brightness)"},{id:"1000_JCLive_sf2_file",library:"JCLive",displayName:"FX 5 (brightness)"},{id:"1000_SBLive_sf2",library:"SBLive",displayName:"FX 5 (brightness)"},{id:"1000_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 5 (brightness)"},{id:"1010_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 6 (goblins)"},{id:"1010_Chaos_sf2_file",library:"Chaos",displayName:"FX 6 (goblins)"},{id:"1010_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 6 (goblins)"},{id:"1010_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 6 (goblins)"},{id:"1010_JCLive_sf2_file",library:"JCLive",displayName:"FX 6 (goblins)"},{id:"1010_SBLive_sf2",library:"SBLive",displayName:"FX 6 (goblins)"},{id:"1010_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 6 (goblins)"},{id:"1020_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 7 (echoes)"},{id:"1020_Chaos_sf2_file",library:"Chaos",displayName:"FX 7 (echoes)"},{id:"1020_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 7 (echoes)"},{id:"1020_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 7 (echoes)"},{id:"1020_JCLive_sf2_file",library:"JCLive",displayName:"FX 7 (echoes)"},{id:"1020_SBLive_sf2",library:"SBLive",displayName:"FX 7 (echoes)"},{id:"1020_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 7 (echoes)"},{id:"1030_Aspirin_sf2_file",library:"Aspirin",displayName:"FX 8 (sci-fi)"},{id:"1030_Chaos_sf2_file",library:"Chaos",displayName:"FX 8 (sci-fi)"},{id:"1030_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"FX 8 (sci-fi)"},{id:"1030_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"FX 8 (sci-fi)"},{id:"1030_JCLive_sf2_file",library:"JCLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SBLive_sf2",library:"SBLive",displayName:"FX 8 (sci-fi)"},{id:"1030_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"FX 8 (sci-fi)"},{id:"1040_Aspirin_sf2_file",library:"Aspirin",displayName:"Sitar"},{id:"1040_Chaos_sf2_file",library:"Chaos",displayName:"Sitar"},{id:"1040_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Sitar"},{id:"1040_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Sitar"},{id:"1040_JCLive_sf2_file",library:"JCLive",displayName:"Sitar"},{id:"1040_SBLive_sf2",library:"SBLive",displayName:"Sitar"},{id:"1040_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Sitar"},{id:"1050_Aspirin_sf2_file",library:"Aspirin",displayName:"Banjo"},{id:"1050_Chaos_sf2_file",library:"Chaos",displayName:"Banjo"},{id:"1050_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Banjo"},{id:"1050_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Banjo"},{id:"1050_JCLive_sf2_file",library:"JCLive",displayName:"Banjo"},{id:"1050_SBLive_sf2",library:"SBLive",displayName:"Banjo"},{id:"1050_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Banjo"},{id:"1060_Aspirin_sf2_file",library:"Aspirin",displayName:"Shamisen"},{id:"1060_Chaos_sf2_file",library:"Chaos",displayName:"Shamisen"},{id:"1060_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shamisen"},{id:"1060_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shamisen"},{id:"1060_JCLive_sf2_file",library:"JCLive",displayName:"Shamisen"},{id:"1060_SBLive_sf2",library:"SBLive",displayName:"Shamisen"},{id:"1060_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shamisen"},{id:"1070_Aspirin_sf2_file",library:"Aspirin",displayName:"Koto"},{id:"1070_Chaos_sf2_file",library:"Chaos",displayName:"Koto"},{id:"1070_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Koto"},{id:"1070_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Koto"},{id:"1070_JCLive_sf2_file",library:"JCLive",displayName:"Koto"},{id:"1070_SBLive_sf2",library:"SBLive",displayName:"Koto"},{id:"1070_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Koto"},{id:"1080_Aspirin_sf2_file",library:"Aspirin",displayName:"Kalimba"},{id:"1080_Chaos_sf2_file",library:"Chaos",displayName:"Kalimba"},{id:"1080_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Kalimba"},{id:"1080_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Kalimba"},{id:"1080_JCLive_sf2_file",library:"JCLive",displayName:"Kalimba"},{id:"1080_SBLive_sf2",library:"SBLive",displayName:"Kalimba"},{id:"1080_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Kalimba"},{id:"1090_Aspirin_sf2_file",library:"Aspirin",displayName:"Bagpipe"},{id:"1090_Chaos_sf2_file",library:"Chaos",displayName:"Bagpipe"},{id:"1090_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bagpipe"},{id:"1090_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bagpipe"},{id:"1090_JCLive_sf2_file",library:"JCLive",displayName:"Bagpipe"},{id:"1090_SBLive_sf2",library:"SBLive",displayName:"Bagpipe"},{id:"1090_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bagpipe"},{id:"1100_Aspirin_sf2_file",library:"Aspirin",displayName:"Fiddle"},{id:"1100_Chaos_sf2_file",library:"Chaos",displayName:"Fiddle"},{id:"1100_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Fiddle"},{id:"1100_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Fiddle"},{id:"1100_JCLive_sf2_file",library:"JCLive",displayName:"Fiddle"},{id:"1100_SBLive_sf2",library:"SBLive",displayName:"Fiddle"},{id:"1100_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Fiddle"},{id:"1110_Aspirin_sf2_file",library:"Aspirin",displayName:"Shanai"},{id:"1110_Chaos_sf2_file",library:"Chaos",displayName:"Shanai"},{id:"1110_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Shanai"},{id:"1110_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Shanai"},{id:"1110_JCLive_sf2_file",library:"JCLive",displayName:"Shanai"},{id:"1110_SBLive_sf2",library:"SBLive",displayName:"Shanai"},{id:"1110_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Shanai"},{id:"1120_Aspirin_sf2_file",library:"Aspirin",displayName:"Tinkle Bell"},{id:"1120_Chaos_sf2_file",library:"Chaos",displayName:"Tinkle Bell"},{id:"1120_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Tinkle Bell"},{id:"1120_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Tinkle Bell"},{id:"1120_JCLive_sf2_file",library:"JCLive",displayName:"Tinkle Bell"},{id:"1120_SBLive_sf2",library:"SBLive",displayName:"Tinkle Bell"},{id:"1120_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Tinkle Bell"},{id:"1130_Aspirin_sf2_file",library:"Aspirin",displayName:"Agogo"},{id:"1130_Chaos_sf2_file",library:"Chaos",displayName:"Agogo"},{id:"1130_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Agogo"},{id:"1130_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Agogo"},{id:"1130_JCLive_sf2_file",library:"JCLive",displayName:"Agogo"},{id:"1130_SBLive_sf2",library:"SBLive",displayName:"Agogo"},{id:"1130_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Agogo"},{id:"1140_Aspirin_sf2_file",library:"Aspirin",displayName:"Steel Drums"},{id:"1140_Chaos_sf2_file",library:"Chaos",displayName:"Steel Drums"},{id:"1140_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Steel Drums"},{id:"1140_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Steel Drums"},{id:"1140_JCLive_sf2_file",library:"JCLive",displayName:"Steel Drums"},{id:"1140_SBLive_sf2",library:"SBLive",displayName:"Steel Drums"},{id:"1140_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Steel Drums"},{id:"1150_Aspirin_sf2_file",library:"Aspirin",displayName:"Woodblock"},{id:"1150_Chaos_sf2_file",library:"Chaos",displayName:"Woodblock"},{id:"1150_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Woodblock"},{id:"1150_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Woodblock"},{id:"1150_JCLive_sf2_file",library:"JCLive",displayName:"Woodblock"},{id:"1150_SBLive_sf2",library:"SBLive",displayName:"Woodblock"},{id:"1150_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Woodblock"},{id:"1160_Aspirin_sf2_file",library:"Aspirin",displayName:"Taiko Drum"},{id:"1160_Chaos_sf2_file",library:"Chaos",displayName:"Taiko Drum"},{id:"1160_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Taiko Drum"},{id:"1160_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Taiko Drum"},{id:"1160_JCLive_sf2_file",library:"JCLive",displayName:"Taiko Drum"},{id:"1160_SBLive_sf2",library:"SBLive",displayName:"Taiko Drum"},{id:"1160_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Taiko Drum"},{id:"1170_Aspirin_sf2_file",library:"Aspirin",displayName:"Melodic Tom"},{id:"1170_Chaos_sf2_file",library:"Chaos",displayName:"Melodic Tom"},{id:"1170_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Melodic Tom"},{id:"1170_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Melodic Tom"},{id:"1170_JCLive_sf2_file",library:"JCLive",displayName:"Melodic Tom"},{id:"1170_SBLive_sf2",library:"SBLive",displayName:"Melodic Tom"},{id:"1170_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Melodic Tom"},{id:"1180_Aspirin_sf2_file",library:"Aspirin",displayName:"Synth Drum"},{id:"1180_Chaos_sf2_file",library:"Chaos",displayName:"Synth Drum"},{id:"1180_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Synth Drum"},{id:"1180_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Synth Drum"},{id:"1180_JCLive_sf2_file",library:"JCLive",displayName:"Synth Drum"},{id:"1180_SBLive_sf2",library:"SBLive",displayName:"Synth Drum"},{id:"1180_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Synth Drum"},{id:"1190_Aspirin_sf2_file",library:"Aspirin",displayName:"Reverse Cymbal"},{id:"1190_Chaos_sf2_file",library:"Chaos",displayName:"Reverse Cymbal"},{id:"1190_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Reverse Cymbal"},{id:"1190_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Reverse Cymbal"},{id:"1190_JCLive_sf2_file",library:"JCLive",displayName:"Reverse Cymbal"},{id:"1190_SBLive_sf2",library:"SBLive",displayName:"Reverse Cymbal"},{id:"1190_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Reverse Cymbal"},{id:"1200_Aspirin_sf2_file",library:"Aspirin",displayName:"Guitar Fret Noise"},{id:"1200_Chaos_sf2_file",library:"Chaos",displayName:"Guitar Fret Noise"},{id:"1200_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Guitar Fret Noise"},{id:"1200_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Guitar Fret Noise"},{id:"1200_JCLive_sf2_file",library:"JCLive",displayName:"Guitar Fret Noise"},{id:"1200_SBLive_sf2",library:"SBLive",displayName:"Guitar Fret Noise"},{id:"1200_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Guitar Fret Noise"},{id:"1210_Aspirin_sf2_file",library:"Aspirin",displayName:"Breath Noise"},{id:"1210_Chaos_sf2_file",library:"Chaos",displayName:"Breath Noise"},{id:"1210_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Breath Noise"},{id:"1210_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Breath Noise"},{id:"1210_JCLive_sf2_file",library:"JCLive",displayName:"Breath Noise"},{id:"1210_SBLive_sf2",library:"SBLive",displayName:"Breath Noise"},{id:"1210_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Breath Noise"},{id:"1220_Aspirin_sf2_file",library:"Aspirin",displayName:"Seashore"},{id:"1220_Chaos_sf2_file",library:"Chaos",displayName:"Seashore"},{id:"1220_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Seashore"},{id:"1220_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Seashore"},{id:"1220_JCLive_sf2_file",library:"JCLive",displayName:"Seashore"},{id:"1220_SBLive_sf2",library:"SBLive",displayName:"Seashore"},{id:"1220_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Seashore"},{id:"1230_Aspirin_sf2_file",library:"Aspirin",displayName:"Bird Tweet"},{id:"1230_Chaos_sf2_file",library:"Chaos",displayName:"Bird Tweet"},{id:"1230_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Bird Tweet"},{id:"1230_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Bird Tweet"},{id:"1230_JCLive_sf2_file",library:"JCLive",displayName:"Bird Tweet"},{id:"1230_SBLive_sf2",library:"SBLive",displayName:"Bird Tweet"},{id:"1230_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Bird Tweet"},{id:"1240_Aspirin_sf2_file",library:"Aspirin",displayName:"Telephone Ring"},{id:"1240_Chaos_sf2_file",library:"Chaos",displayName:"Telephone Ring"},{id:"1240_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Telephone Ring"},{id:"1240_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Telephone Ring"},{id:"1240_JCLive_sf2_file",library:"JCLive",displayName:"Telephone Ring"},{id:"1240_SBLive_sf2",library:"SBLive",displayName:"Telephone Ring"},{id:"1240_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Telephone Ring"},{id:"1250_Aspirin_sf2_file",library:"Aspirin",displayName:"Helicopter"},{id:"1250_Chaos_sf2_file",library:"Chaos",displayName:"Helicopter"},{id:"1250_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Helicopter"},{id:"1250_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Helicopter"},{id:"1250_JCLive_sf2_file",library:"JCLive",displayName:"Helicopter"},{id:"1250_SBLive_sf2",library:"SBLive",displayName:"Helicopter"},{id:"1250_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Helicopter"},{id:"1260_Aspirin_sf2_file",library:"Aspirin",displayName:"Applause"},{id:"1260_Chaos_sf2_file",library:"Chaos",displayName:"Applause"},{id:"1260_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Applause"},{id:"1260_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Applause"},{id:"1260_JCLive_sf2_file",library:"JCLive",displayName:"Applause"},{id:"1260_SBLive_sf2",library:"SBLive",displayName:"Applause"},{id:"1260_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Applause"},{id:"1270_Aspirin_sf2_file",library:"Aspirin",displayName:"Gunshot"},{id:"1270_Chaos_sf2_file",library:"Chaos",displayName:"Gunshot"},{id:"1270_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Gunshot"},{id:"1270_GeneralUserGS_sf2_file",library:"GeneralUserGS",displayName:"Gunshot"},{id:"1270_JCLive_sf2_file",library:"JCLive",displayName:"Gunshot"},{id:"1270_SBLive_sf2",library:"SBLive",displayName:"Gunshot"},{id:"1270_SoundBlasterOld_sf2",library:"SoundBlasterOld",displayName:"Gunshot"},{id:"12835_1_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 1"},{id:"12835_1_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 1"},{id:"12835_1_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 1"},{id:"12835_1_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 1"},{id:"12835_2_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 2"},{id:"12835_2_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 2"},{id:"12835_2_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 2"},{id:"12835_2_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 2"},{id:"12835_3_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 3"},{id:"12835_3_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 3"},{id:"12835_3_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 3"},{id:"12835_3_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 3"},{id:"12835_4_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 4"},{id:"12835_4_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 4"},{id:"12835_4_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 4"},{id:"12835_4_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 4"},{id:"12835_5_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 5"},{id:"12835_5_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 5"},{id:"12835_5_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 5"},{id:"12835_5_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 5"},{id:"12835_6_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 6"},{id:"12835_6_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 6"},{id:"12835_6_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 6"},{id:"12835_6_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 6"},{id:"12835_7_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 7"},{id:"12835_7_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 7"},{id:"12835_7_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 7"},{id:"12835_7_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 7"},{id:"12835_8_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 8"},{id:"12835_8_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 8"},{id:"12835_8_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 8"},{id:"12835_8_SBLive_sf2_file",library:"SBLive",displayName:"Drum Kit 8"},{id:"12835_9_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 9"},{id:"12835_9_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 9"},{id:"12835_9_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 9"},{id:"12835_10_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 10"},{id:"12835_10_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 10"},{id:"12835_10_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 10"},{id:"12835_11_Chaos_sf2_file",library:"Chaos",displayName:"Drum Kit 11"},{id:"12835_11_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 11"},{id:"12835_11_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 11"},{id:"12835_12_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 12"},{id:"12835_12_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 12"},{id:"12835_13_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 13"},{id:"12835_13_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 13"},{id:"12835_14_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 14"},{id:"12835_14_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 14"},{id:"12835_15_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 15"},{id:"12835_15_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 15"},{id:"12835_16_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 16"},{id:"12835_16_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 16"},{id:"12835_17_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 17"},{id:"12835_17_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 17"},{id:"12835_18_FluidR3_GM_sf2_file",library:"FluidR3_GM",displayName:"Drum Kit 18"},{id:"12835_18_JCLive_sf2_file",library:"JCLive",displayName:"Drum Kit 18"}];function In(i){const e=1+i%18,t=Ke.find(n=>n.id.startsWith(`12835_${e}_`)&&n.library==="FluidR3_GM");if(t)return{library:t.library,displayName:t.displayName};const s=Ke.find(n=>n.id.startsWith(`12835_${e}_`));return s?{library:s.library,displayName:s.displayName}:null}const An=Array.from({length:47},(i,e)=>35+e),Rn={35:"kick2",36:"kick1",37:"rim",38:"snare1",39:"clap",40:"snare2",41:"lowtom2",42:"hh_closed",43:"lowtom1",44:"hh_pedal",45:"midtom2",46:"hh_open",47:"midtom1",48:"hitom2",49:"crash1",50:"hitom1",51:"ride1",52:"china",53:"ride_bell",54:"tamb",55:"splash",56:"cowbell",57:"crash2",58:"vibraslap",59:"ride2",60:"bongo_hi",61:"bongo_lo",62:"conga_hi_mute",63:"conga_hi_open",64:"conga_lo",65:"timbale_hi",66:"timbale_lo",67:"agogo_hi",68:"agogo_lo",69:"cabasa",70:"maracas",71:"whistle_short",72:"whistle_long",73:"guiro_short",74:"guiro_long",75:"claves",76:"woodblock_hi",77:"woodblock_lo",78:"cuica_mute",79:"cuica_open",80:"triangle_mute",81:"triangle_open"},Mi=_n,Et=new Map;let Q=null;function Li(i){return Math.max(i,1e-4)}async function lt(i){return new Promise((e,t)=>{const s=document.createElement("script");s.src=i,s.onload=()=>e(),s.onerror=()=>t(new Error(`Failed to load script: ${i}`)),document.body.appendChild(s)})}async function Fn(){Q||(await lt("https://surikov.github.io/webaudiofont/npm/dist/WebAudioFontPlayer.js"),Q=new window.WebAudioFontPlayer)}async function ri(i,e=z(),t=null,s,n,r,a=!0){const[o,l]=i.split("/"),c=String(e),d=`${o}/${l}@${c}`;Et.has(e)||Et.set(e,new Map);const u=Et.get(e);if(a&&u.has(d))return u.get(d);if(await Fn(),Q.resumeContext){const w=Q.resumeContext;Q.resumeContext=M=>{if(!(M instanceof OfflineAudioContext))return w.call(Q,M)}}const h=Ke.find(w=>w.library===o&&w.displayName===l);if(!h)throw new Error(`Could not find WebAudioFont entry for library=${o} and instrument=${l}`);t&&t.context!==e&&(console.warn("[WebAudioFont] Ignoring mismatched destination from another context"),t=null);const f=t||Le(e),y=e.createStereoPanner();if(y.pan.value=n??0,y.connect(f),!h.displayName.startsWith("Drum Kit")){const w=`_tone_${h.id}`,M=`https://surikov.github.io/webaudiofontdata/sound/${h.id}.js`;r?await lt(M):await Mi(lt(M));const G=window[w];if(!G)throw new Error(`Missing preset: ${w}`);if(Q.loader.decodeAfterLoading(e,w),e instanceof OfflineAudioContext){const B=(G==null?void 0:G.zones)??[];for(const x of B)if(x.file&&!x.buffer){const F=atob(x.file),q=new ArrayBuffer(F.length),U=new Uint8Array(q);for(let K=0;K<F.length;K++)U[K]=F.charCodeAt(K);x.buffer=await new Promise((K,Ee)=>e.decodeAudioData(q,K,Ee))}}const k={_preset:G,_volume:s??1,_activeEnvelopes:[],start({note:B,duration:x=1,velocity:F=100,time:q}){const U=typeof B=="string"?H(B):B;if(U==null||typeof U!="number")return;const K=typeof q=="number"?q:0,Ee=Math.max(.01,Math.min(1,F/127)),Qe=Li(k._volume),Lt=Math.max(.01,Math.min(1,Qe*Ee)),et=Q.queueWaveTable(e,y||Le(),G,K,U,x,Lt);k._activeEnvelopes.push(et)},stop(){var B;for(const x of k._activeEnvelopes)try{x.cancel?x.cancel():(B=x.audioBufferSourceNode)!=null&&B.stop&&x.audioBufferSourceNode.stop()}catch(F){console.warn("Failed to stop envelope:",F)}k._activeEnvelopes=[]},setVolume(B){k._volume=Math.max(0,Math.min(1,B))},setPan(B){y.pan.value=Math.max(-1,Math.min(1,B))},load:Promise.resolve()};return a&&u.set(d,k),k}const _=h.id.match(/^12835_(\d+)_([A-Za-z0-9_]+)_sf2_file$/);if(!_)throw new Error(`Invalid drum ID format in catalogue: ${h.id}`);const[,m,v]=_,S=parseInt(m,10),g={},C=async()=>{for(const w of An){const M=`_drum_${w}_${S}_${v}_sf2_file`,G=`https://surikov.github.io/webaudiofontdata/sound/${12800+w}_${S}_${v}_sf2_file.js`;try{await lt(G);const k=window[M];if(!k){console.warn(`Missing drum preset: ${M}`);continue}Q.loader.decodeAfterLoading(e,M),g[w]=k}catch(k){console.warn(`Failed to load drum preset ${w}: ${k}`)}}};r??!1?await C():await Mi(C());const N={_preset:g,_volume:s??1,_activeEnvelopes:[],start({note:w,duration:M=1,velocity:G=100,time:k}){const B=typeof w=="string"?H(w):w;if(B==null||typeof B!="number"){console.warn(`Invalid MIDI pitch: ${w}`);return}const x=g[B];if(!x){console.warn(`No drum preset loaded for MIDI ${B}`);return}const F=typeof k=="number"?k:0,q=Li(N._volume),U=Q.queueWaveTable(e,y||Le(),x,F,B,M,q);N._activeEnvelopes.push(U)},stop(){var w;for(const M of N._activeEnvelopes)try{M.cancel?M.cancel():(w=M.audioBufferSourceNode)!=null&&w.stop&&M.audioBufferSourceNode.stop()}catch(G){console.warn("Failed to stop envelope:",G)}N._activeEnvelopes=[]},load:Promise.resolve(),setVolume(w){N._volume=Math.max(0,Math.min(1,w))},setPan(w){y.pan.value=Math.max(-1,Math.min(1,w))}};return a&&u.set(d,N),N}async function On(){const i=new Set;for(const e of Ke)i.add(e.library);return Array.from(i)}async function Un(i){return Ke.filter(e=>e.library===i).map(e=>e.displayName)}function Dn(){return{name:"webaudiofont",loadInstrument:ri,getAvailableLibraries:On,getAvailableInstruments:Un}}let Vt=null,Yt=null;async function Pn(i){if(Yt===i)return;const[,e,t]=i.split("/");Vt=await ri(`${e}/${t}`,Ce()),Yt=i}function qn(){return Yt}function Kn(i,e=100,t=!1){if(!Vt)return null;const n=Ce().currentTime,r=H(i);return r===null?null:(Vt.start({note:r,velocity:e,time:n,duration:1.5,loop:t}),()=>{})}function Hn(i){}async function zn(i,e,t,s=100,n=!1,r=null,a=null,o=null,l,c){const d=a||z(),[,u,h]=i.split("/"),f=await ri(`${u}/${h}`,d,o,l,c);l!==void 0&&f.setVolume&&f.setVolume(l),c!==void 0&&f.setPan&&f.setPan(c);const y=H(e);return y===null||f.start({note:y,duration:t,velocity:s,loop:n,time:r??d.currentTime}),null}function Jn(){return{name:"webaudiofont",setActiveInstrument:Pn,getActiveInstrumentName:qn,playNote:Kn,stopNoteByPitch:Hn,loadAndPlayNote:zn}}function _s(i=3){const r=["C","D","E","F","G","A","B"],a=["C#","D#","","F#","G#","A#",""],o=[i,i+1,i+2],l={};let c=0;for(const d of o)r.forEach(u=>{const h=`${u}${d}`;l[h]={note:h,x:c,width:60,height:200,isBlack:!1},c+=60});c=0;for(const d of o)a.forEach((u,h)=>{if(u===""){c+=60;return}const f=`${u}${d}`;l[f]={note:f,x:c+60-40/2,width:40,height:120,isBlack:!0},c+=60});return l}let ct="sf2/fluidr3-gm/acoustic_grand_piano",ni=3,gs=!1,bs=_s(ni);function $n(){ct="sf2/fluidr3-gm/acoustic_grand_piano",oi(ct)}function Wn(i){oi(i),ct=i}function ai(){return ct}function jn(){const i=document.getElementById("instrument-loop-toggle");return(i==null?void 0:i.checked)??!1}function Tt(){return ni}function xi(i){ni=i}function be(){return gs}function Xn(i){gs=i}function Me(){return bs}function Vn(i){bs=i}const je={sf2:Tn(),webaudiofont:Jn()};async function oi(i){if(!i.includes("/"))throw new Error(`Invalid instrument name: "${i}". Expected "<engine>/<library>/<instrument>"`);const e=i.split("/")[0],t=je[e];if(!t)throw new Error(`Engine "${e}" not available`);await t.setActiveInstrument(i)}function vs(i,e=100,t=!1){const s=ai();if(!s)return null;const n=s.split("/")[0],r=je[n];if(!r)throw new Error(`Engine "${n}" not available`);return r.playNote(i,e,t)}function Yn(i){const e=ai();if(!e)return;const t=e.split("/")[0],s=je[t];if(!s)throw new Error(`Engine "${t}" not available`);s.stopNoteByPitch(i)}async function Zn(i,e,t=1,s=100,n=!1,r=null,a=null,o=null,l,c){const d=i.split("/")[0],u=je[d];if(!u)throw new Error(`Engine "${d}" not available`);let h=a??z(),f=o;return h.state==="suspended"&&(console.warn("[loadAndPlayNote] Using preview context due to suspended main context"),h=Ce(),f=Mn()),await u.loadAndPlayNote(i,e,t,s,n,r,h,f,l,c)}let It=null;function z(){return It||(It=new(window.AudioContext||window.webkitAudioContext)),It}const At=new WeakMap,Rt=new WeakMap;function Ss(i=z()){if(!Rt.has(i)){const e=i.createAnalyser();e.fftSize=2048,Rt.set(i,e)}return Rt.get(i)}function Le(i=z()){if(!At.has(i)){const e=i.createGain(),t=Ss(i);e.connect(t),t.connect(i.destination),At.set(i,e)}return At.get(i)}function Qn(i){try{const e=vs(i,100,!1);return e?{stop:e,forceStop:e}:null}catch(e){return console.error("[playNote] Failed to play note",i,e),null}}function ea(i,e){const t=structuredClone(i);return t.tempo=e.bpm,t}function Cs(i){return{type:"CHANGE_TEMPO",bpm:i}}function ta(i){return Cs(i)}function ia(i,e){const t=structuredClone(i);return t.timeSignature=[e.beats,4],t}function Ns(i){return{type:"SET_TIME_SIGNATURE",beats:i}}function sa(i){return Ns(i)}function ra(i,e){const t=structuredClone(i);return t.totalMeasures=e.measures,t}function ws(i){return{type:"SET_TOTAL_MEASURES",measures:i}}function na(i){return ws(i)}const aa=new Set(["C","C#","Db","D","D#","Eb","E","E#","Fb","F","F#","Gb","G","G#","Ab","A","A#","Bb","B","B#","Cb"]),oa=new Set(["M","m"]);function la(i){const e=i.slice(0,-1),t=i.slice(-1);if(!aa.has(e)||!oa.has(t))return null;const s=t==="M"?"major":"minor",n=Tr.get(`${e} ${s}`);return n.empty?null:n.notes}const da=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],ca=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],Ms={C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,Fb:4,"E#":5,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11,Cb:11,"B#":0};function ua(i){return i.includes("#")}function J(i){const e=i==null?void 0:i.match(/^([A-Ga-g])([#b]*)(-?\d+)$/);if(!e)return null;const[,t,s,n]=e,r=t.toUpperCase(),a=Ms[r];if(a===void 0)return null;const o=[...s].reduce((c,d)=>d==="#"?c+1:d==="b"?c-1:c,0);return 12*(parseInt(n,10)+1)+(a+o)}function ge(i){return J(i)}const ha=i=>{const e=J(i);return e!==null?e%12:0};function li(i,e=21,t){const s=J(i);if(s===null)return null;const n=t-e+1,r=s-e,a=n-1-r;return a>=0&&a<n?a:null}function V(i,e,t){const n=t-e+1-1-i,r=e+n;return Ge(r)}function Ge(i,e=!1){const s=(e?ca:da)[i%12],n=Math.floor(i/12)-1;return`${s}${n}`}function Ls(i,e){const t=new Map;for(let s=i;s<=e;s++)t.set(s,ua(Ge(s)));return t}function fa(i,e){const t=J(i),s=J(e);if(t===null||s===null)throw new Error(`Invalid pitches provided: ${i}, ${e}`);return t-s}function xs(i){const e=la(i),t=new Map;if(!e)return t;const s=new Set(e.map(n=>Ms[n]%12));for(let n=0;n<=127;n++){const r=n%12;t.set(n,s.has(r))}return t}function Gs(){return typeof window<"u"&&typeof localStorage<"u"}function mt(i,e){Gs()&&localStorage.setItem(i,JSON.stringify(e))}function yt(i){if(!Gs())return null;const e=localStorage.getItem(i);if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error(`Error parsing localStorage key "${i}":`,t),null}}const ks="grid-key-highlighting",Bs="grid-snap-enabled",Es="snap-to-in-key",pa="CM";let Ts=yt(ks)??!1,Is=yt(Bs)??!0,As=yt(Es)??!1,Rs=xs(pa),Fs=!1;function Os(){return Ts}function ma(i){Ts=i,mt(ks,i)}function Us(){return Is}function ya(i){Is=i,mt(Bs,i)}function _t(){return As}function _a(i){As=i,mt(Es,i)}function gt(){return Rs}function ga(i){Rs=xs(i)}function He(){return Fs}function Gi(i){Fs=i}function ba(i,e){const t=structuredClone(i);return t.songKey=e.songKey,ga(e.songKey),t}function Ds(i){return{type:"CHANGE_SONG_KEY",songKey:i}}function va(i){return Ds(i)}function Sa(i,e){const t=structuredClone(i);return t.snapResolution=e.snapResolution,t}function Ps(i){return{type:"CHANGE_SNAP_RESOLUTION",snapResolution:i}}function Ca(i){return Ps(i)}function Na(i,e){const t=structuredClone(i);return t.noteDuration=e.noteDuration,t}function qs(i){return{type:"CHANGE_NOTE_DURATION",noteDuration:i}}function wa(i){return qs(i)}function Ma(i,e){const t=structuredClone(i);return t.isTripletMode=e.triplet,t.isDottedMode=e.dotted,t}function Ks(i,e){return{type:"SET_NOTE_MODIFIER_MODE",triplet:i,dotted:e}}function La(i,e){return Ks(i,e)}const di={sf2:wn(),webaudiofont:Dn()},Hs="sf2";async function zs(i,e,t,s,n,r,a=!0){const o=i.split("/");if(o.length!==3)throw new Error(`Invalid instrument fullName format: "${i}". Expected format "engine/library/instrument"`);const[l,c,d]=o,u=di[l];if(!u)throw new Error(`Engine "${l}" not available`);return await u.loadInstrument(`${c}/${d}`,e,t,s,n,r,a)}async function xa(i,e,t,s,n,r,a){if(!s||s.length===0)return;const o=60/ue();if(a!=null&&a.aborted)return;const l=await zs(i,e,t,n,r);if(!(a!=null&&a.aborted))for(const c of s){if(a!=null&&a.aborted)return;const d=c.start*o,u=Math.max(.01,d),h=c.duration*o,f=c.velocity??100,y=J(c.pitch);if(y==null)continue;const b=i.split("/"),m=(b.length>=3?b[1]:b[0])==="drummachines"&&l.__midiMap?l.__midiMap.get(y)??y:y;try{l.start({note:m,duration:h,velocity:f,time:u,loop:!1})}catch(v){console.warn("[exportNotesToOffline] Failed to start note:",c,v)}}}function ki(i){if(!i.container)return;const e=i.container.querySelector(".mute-btn"),t=i.container.querySelector(".solo-btn"),s=i.container.querySelector(".sequencer-body"),n=i.container.querySelector(".mini-contour");e==null||e.classList.toggle("bg-red-600",i.mute),e==null||e.classList.toggle("bg-gray-700",!i.mute),t==null||t.classList.toggle("bg-yellow-200",i.solo),t==null||t.classList.toggle("bg-gray-700",!i.solo);const r=i.mute&&!i.solo;s==null||s.classList.toggle("opacity-40",r),s==null||s.classList.toggle("opacity-100",!r),n==null||n.classList.toggle("opacity-40",r),n==null||n.classList.toggle("opacity-100",!r)}const ke=["#ff006e","#3a86ff","#ffbe0b","#8338ec","#06d6a0","#ef476f","#118ab2","#ffd166","#073b4c","#8ac926","#0077b6","#00b4d8","#005f73","#03045e","#023e8a"];function bt(i,e,t,s=0){const n=i.getContext("2d");if(!n)return;n.imageSmoothingEnabled=!1;const r=i.width,a=i.height;if(n.clearRect(0,0,r,a),!e.length)return;const o=ke[s%ke.length];n.fillStyle=o;const l=se(),c=e.map(m=>H(m.pitch)).filter(m=>m!==null);if(!c.length)return;let d=Math.min(...c),u=Math.max(...c),h=Math.max(1,u-d);for(;a%h!==0;)u++,h=u-d;const f=a/h;for(const m of e){const v=H(m.pitch);if(v==null)continue;const S=m.start/l*r,g=m.duration/l*r,C=(v-d)/h,N=a-C*a-f/2,w=Math.round(S),M=Math.max(1,Math.round(g)),G=Math.round(N);n.fillRect(w,G,M,f)}const y=vi(),b=Si();n.save();let _=1;b>256?_=16:b>128?_=8:b>32&&(_=4);for(let m=0;m<=b;m++){if(m%_!==0)continue;const S=m*y/l*r,g=Math.round(S)+.5;n.beginPath(),n.moveTo(g,0),n.lineTo(g,a);const C=_===1||m%(_*2)===0;n.strokeStyle=C?"rgba(255, 255, 255, 0.12)":"rgba(255, 255, 255, 0.04)",n.lineWidth=.2,n.stroke()}n.restore()}function Zt(i,e){const{config:t,container:s,matrix:n,colorIndex:r,getNotes:a}=i,[o,l]=e,c=J(o),d=J(l);if(c===null||d===null){console.warn(`Invalid note range: ${e}`);return}if(c>=d){console.warn("Invalid note range: low note must be lower than high note");return}t.noteRange=e,t.visibleNotes=fa(l,o)+1;const u=s==null?void 0:s.querySelector(".mini-contour");u&&bt(u,a(),t,r),n.setNoteRange(c,d)}function Ga(i){i.instrumentName.toLowerCase().includes("drum kit")?(Zt(i,["B1","A5"]),i.matrix.setCustomLabels(Rn)):(Zt(i,["A0","C9"]),i.matrix.setCustomLabels(null))}const vt=new Map;function ka(){vt.clear()}function Ba(i,e){vt.set(i,e)}function Ea(i){vt.delete(i)}function Js(i){return vt.get(i)}function ut(i,e=!0,t=null){var o;const s=Js(i.id);if(!s)return;const n=P.getInstance(),r=s.getMatrixContainer(),a=s.getMiniContourCanvas();if(!(!r||!a)){if(i.collapsed=e,s.collapsed=e,r.classList.toggle("hidden",e),a.classList.toggle("hidden",!e),t){const l=t.querySelector("img");if(l){const c=e?"icon-caret-up":"icon-caret-down";l.src=de(`static/svg/${c}.svg`)}}if(e){s.toggleZoomControls(!1),s.toggleGripHandle(!1);for(const l of i.scheduledAnimations)clearTimeout(l);i.scheduledAnimations=[],bt(a,i.notes,i.config,i.colorIndex)}else s.toggleZoomControls(!0),s.toggleGripHandle(!0),(o=i.matrix)==null||o.resize(),n.isActive()&&i.resumeAnimationsFromCurrentTime(n.getStartTime(),n.getStartBeat())}}function Ta(){for(const i of D())ut(i,!0)}const Ia={totalMeasures:16,beatsPerMeasure:4,layout:{labelWidthColumns:1,headerHeightRows:2,footerHeightRows:1,labelWidth:80,headerHeight:40,footerHeight:40,baseCellWidth:70,minCellWidth:10,maxCellWidth:200,verticalCellRatio:4,highestMidi:108,lowestMidi:21},display:{showMeasureLines:!0,showBeatLines:!0,showHoveredCell:!0,highlightCurrentMeasure:!0},behavior:{zoom:1,scrollMargin:48,enableSnapping:!0,snapDivisions:4,maxZoom:1.6,minZoom:.5}};function Aa(){return structuredClone(Ia)}function Ra(i,e){return{...i,...e,layout:{...i.layout,...e.layout??{}},display:{...i.display,...e.display??{}},behavior:{...i.behavior,...e.behavior??{}}}}const ci={Midnight:{whiteKey:"#1e1e1e",blackKey:"#2a103b",labelWhite:"#2c2c2c",labelBlack:"#3a1d4d",textWhite:"#cfcfcf",textBlack:"#e6d9ff",gridLine:"#333",beatLine:"#4e3d63",measureLine:"#8561c2",outOfKey:"rgb(255, 1, 1)"},Seashell:{whiteKey:"#fefefe",blackKey:"#f1e7dc",labelWhite:"#dddddd",labelBlack:"#d4cfc9",textWhite:"#444",textBlack:"#663300",gridLine:"#ccc",beatLine:"#bbb",measureLine:"#999",outOfKey:"rgba(255, 255, 255, 0.05)"},Cyberpunk:{whiteKey:"#162447",blackKey:"#1b1b2f",labelWhite:"#1f4068",labelBlack:"#1f4068",textWhite:"#e43f5a",textBlack:"#e43f5a",gridLine:"#1f4068",beatLine:"#e43f5a",measureLine:"#ffcc00",outOfKey:"rgba(255, 255, 255, 0.05)"},"Classic Blue":{whiteKey:"#f5faff",blackKey:"#dceeff",labelWhite:"#aaccee",labelBlack:"#88bbdd",textWhite:"#002244",textBlack:"#001122",gridLine:"#99bbdd",beatLine:"#88aacc",measureLine:"#336699",outOfKey:"rgba(255, 255, 255, 0.05)"},Darkroom:{whiteKey:"#2c2c2c",blackKey:"#1e1e1e",labelWhite:"#2a2a2a",labelBlack:"#383838",textWhite:"#e0e0e0",textBlack:"#a0a0a0",gridLine:"#404040",beatLine:"#606060",measureLine:"#808080",outOfKey:"rgba(255, 255, 255, 0.05)"}};class Fa{constructor(e,t,s,n,r){this.getBlackKeyMap=n,this.getInKeyMap=r,this.scroll=e,this.config=t,this.interactionStore=s}draw(e){const{totalMeasures:t,beatsPerMeasure:s,layout:{baseCellWidth:n,verticalCellRatio:r,labelWidth:a,headerHeight:o},behavior:{zoom:l}}=this.config,{gridColorScheme:c}=j().theme,d=ci[c],u=this.config.layout.highestMidi-this.config.layout.lowestMidi+1,h=n*l,f=h/r,y=this.scroll.getX(),b=this.scroll.getY();(e.canvas.width-a)/h;const _=t*s;e.save(),e.translate(a-y,o-b);const m=Math.max(0,Math.floor((y-a)/h)),v=Os(),S=this.getInKeyMap();for(let g=0;g<u;g++){const C=g*f,N=this.config.layout.highestMidi-g;let w;v?w=S.get(N)?d.whiteKey:d.blackKey:w=this.getBlackKeyMap().get(N)?d.blackKey:d.whiteKey,e.fillStyle=w,e.fillRect(0,C,_*h,f),e.strokeStyle=d.gridLine,e.beginPath(),e.moveTo(0,C),e.lineTo(_*h,C),e.stroke()}for(let g=m;g<=_;g++){if(g<0)continue;const C=g*h;e.strokeStyle=g%s===0?d.measureLine:d.beatLine,e.beginPath(),e.moveTo(C,0),e.lineTo(C,u*f),e.stroke()}e.restore()}}function Oa(i){const{layout:{labelWidth:e,baseCellWidth:t},totalMeasures:s,beatsPerMeasure:n,behavior:{zoom:r}}=i,a=t*r;return e+s*n*a}function Ua(i){const{layout:{baseCellWidth:e,verticalCellRatio:t,highestMidi:s,lowestMidi:n,headerHeight:r},behavior:{zoom:a}}=i,o=s-n+1,l=e*a/t;return o*l+r}class Da{constructor(e,t){this.scrollX=0,this.scrollY=0,this.canvas=e,this.config=t}getX(){return this.scrollX}getY(){return this.scrollY}setScroll(e,t){this.scrollX=this.clampX(e),this.scrollY=this.clampY(t)}recalculateBounds(){}getMaxScrollX(){const e=this.canvas.offsetWidth;return Math.max(0,this.getContentWidth()-e)}getMaxScrollY(){const e=this.canvas.offsetHeight-this.config.layout.headerHeight;return Math.max(0,this.getContentHeight()-e)}clampX(e){return Math.max(0,Math.min(e,this.getMaxScrollX()))}clampY(e){return Math.max(0,Math.min(e,this.getMaxScrollY()))}getContentWidth(){return Oa(this.config)}getContentHeight(){return Ua(this.config)}}function Xe(i,e){const t=e.getBoundingClientRect();return{x:i.clientX-t.left,y:i.clientY-t.top}}function $s(i,e,t,s){const n=e.getBoundingClientRect();return{x:i.clientX-n.left+t.getX()-s.layout.labelWidth,y:i.clientY-n.top+t.getY()-s.layout.headerHeight}}function Pa(i,e,t,s,n){const r=t.getBoundingClientRect();return{x:i-r.left+s.getX()-n.layout.labelWidth,y:e-r.top+s.getY()-n.layout.headerHeight}}function Ve(i,e,t,s,n=!1){const{layout:{labelWidth:r,headerHeight:a,baseCellWidth:o,verticalCellRatio:l,highestMidi:c,lowestMidi:d},behavior:{zoom:u}}=t,h=c-d+1,f=o*u,y=f/l,b=(i.x+e.getX()-r)/f;let _=Math.floor((i.y+e.getY()-a)/y);const m=n?s*(2/3):s,v=Math.floor(b/m)*m;if(v<0||_<0||_>=h)return null;if(_t()&&!He()){const S=gt(),g=c-_;let C=null,N=1/0;for(let w=-12;w<=12;w++){const M=g+w;if(M<d||M>c||!S.get(M))continue;const G=c-M,k=Math.abs(G-_);if(k<N&&(N=k,C=G),k===0)break}C!==null&&(_=C)}return{x:v,y:_}}class qa{constructor(e,t){this.notes=[],this.noteIndex=new Map,this.pitchIndex=new Map,this.config=e,this.playNote=t}set(e){this.notes=e}getAll(){return this.notes}add(e){this.notes.push(e)}getTrackedNotes(e){const t=e.getHoveredNoteKey(),s=r=>e.isNoteHighlighted(r),n=new Set(e.getSelectedNotes().map(r=>`${r.pitch}:${r.start}`));return this.notes.map(r=>{const a=`${r.pitch}:${r.start}`;return{note:r,state:{hovered:a===t,selected:n.has(a),highlighted:s(r)}}})}remove(e){const t=`${e.pitch}:${e.start}`;this.notes=this.notes.filter(s=>!(s.pitch===e.pitch&&s.start===e.start)),this.noteIndex.delete(t)}removeAll(e){const t=new Set(e.map(s=>`${s.pitch}:${s.start}`));this.notes=this.notes.filter(s=>!t.has(`${s.pitch}:${s.start}`));for(const s of t)this.noteIndex.delete(s)}rebuildIndex(){this.noteIndex.clear(),this.pitchIndex.clear();for(const e of this.notes){const t=`${e.pitch}:${e.start}`;this.noteIndex.set(t,e),this.pitchIndex.has(e.pitch)||this.pitchIndex.set(e.pitch,[]),this.pitchIndex.get(e.pitch).push(e)}for(const e of this.pitchIndex.values())e.sort((t,s)=>t.start-s.start)}findNoteAtMousePosition(e,t,s,n,r){const a=Xe(e,t);X("Raw mouse pos (grid-relative)",a);const o=wt(),l=Ve(a,s,n,o);if(!l){X("Snapped position is invalid",{mouse:a,snap:o});return}const c=V(l.y,n.layout.lowestMidi,n.layout.highestMidi),d=l.x;X("Snapped grid position",l),X("Computed pitch and beat",{pitch:c,beat:d});const u=r.findNoteUnderCursor(c,d);return X("Note under cursor (if any)",u),u}findAtPosition(e,t){return this.noteIndex.get(`${e}:${t}`)}findNoteUnderCursor(e,t){const s=this.pitchIndex.get(e);if(!s||s.length===0)return;let n=0,r=s.length-1,a=-1;for(;n<=r;){const o=Math.floor((n+r)/2);s[o].start<=t?(a=o,n=o+1):r=o-1}if(a!==-1)for(let o=a;o>=0;o--){const l=s[o];if(t>=l.start&&t<l.start+l.duration)return l;if(l.start+l.duration<t)break}}findNoteEdgeAtCursor(e,t,s=.25){const n=this.pitchIndex.get(e);if(!n||n.length===0)return;let r=0,a=n.length-1,o=-1;for(;r<=a;){const l=Math.floor((r+a)/2);n[l].start<=t?(o=l,r=l+1):a=l-1}if(o!==-1)for(let l=o;l>=0;l--){const c=n[l],d=c.start+c.duration*(1-s),u=c.start+c.duration;if(t>=d&&t<=u)return c;if(c.start+c.duration<t)break}}mergeSelections(e,t){const s=new Set,n=[];for(const r of[...e,...t]){const a=`${r.pitch}:${r.start}`;s.has(a)||(s.add(a),n.push(r))}return n}previewNote(e,t,s=100,n=!1){this.playNote(e,t,s,n)}}function ze(i,e,t,s,n,r=4){i.beginPath(),i.moveTo(e+r,t),i.lineTo(e+s-r,t),i.quadraticCurveTo(e+s,t,e+s,t+r),i.lineTo(e+s,t+n-r),i.quadraticCurveTo(e+s,t+n,e+s-r,t+n),i.lineTo(e+r,t+n),i.quadraticCurveTo(e,t+n,e,t+n-r),i.lineTo(e,t+r),i.quadraticCurveTo(e,t,e+r,t),i.closePath()}function Ka(i,e,t,s){const{layout:{baseCellWidth:n,verticalCellRatio:r,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=t,c=a-o+1,d=n*l,u=d/r,h=s.offsetWidth,f=s.offsetHeight,y=0,b=i/d-y,_=(i+h)/d+y,m=Math.floor(e/u),v=Math.min(c-1,Math.ceil((e+f)/u)+y),S=new Map;return g=>g.filter(({note:C})=>{if(C.start+C.duration<b||C.start>_)return!1;let w=S.get(C.pitch);if(w==null){const M=li(C.pitch,o,a);if(M==null||M<0||M>=c)return!1;w=M,S.set(C.pitch,w)}return w>=m&&w<=v})}function Ha(i){const e=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;i=i.replace(e,(u,h,f,y)=>h+h+f+f+y+y);const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);if(!t)return null;const s=parseInt(t[1],16)/255,n=parseInt(t[2],16)/255,r=parseInt(t[3],16)/255,a=Math.max(s,n,r),o=Math.min(s,n,r);let l=0,c=0,d=(a+o)/2;if(a!==o){const u=a-o;switch(c=d>.5?u/(2-a-o):u/(a+o),a){case s:l=(n-r)/u+(n<r?6:0);break;case n:l=(r-s)/u+2;break;case r:l=(s-n)/u+4;break}l*=60}return{h:Math.round(l),s:Math.round(c*100),l:Math.round(d*100)}}const za=["#FF0000","#9400D3","#FFFF00","#FF69B4","#00FF00","#00FFFF","#0000FF","#8A2BE2","#FF8C00","#FFD700","#ADFF2F","#DC143C"];function Ja(i,e){const t=Ha(i);if(!t)return"#999";const n=10+(e??100)/127*50;return`hsl(${t.h}, ${t.s}%, ${n}%)`}function it(i){return(e,t)=>{const s=i(e,t);return Ja(s,e.velocity)}}function $a(i){const e=J(i.pitch);if(e==null)return"#999";const t=e*3%360,s=100,n=60,a=.2+(i.velocity??100)/127*.8;return`hsla(${t}, ${s}%, ${n}%, ${a})`}const Wa={Scriabin:it((i,{getPitchClass:e}={})=>{const t=e?e(i.pitch):0;return za[t]||"#999"}),"Track Color":it((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#999"),"Note Velocity":it((i,{getTrackColor:e}={})=>(e==null?void 0:e())||"#ff0000"),"Octave Bands":$a,"Pitch Class Contrast":it((i,{getPitchClass:e}={})=>{const t=J(i.pitch);if(t==null)return"#999";const s=t%12;return["#ff0000","#ff7f00","#ffff00","#7fff00","#00ff00","#00ff7f","#00ffff","#007fff","#0000ff","#7f00ff","#ff00ff","#ff007f"][s]||"#999"})};function ja(i){return i<0&&(console.error(`Invalid trackId: ${i}. Using default color.`),i=0),ke[i%ke.length]}class Xa{constructor(e,t,s,n,r){this.scroll=e,this.config=t,this.noteManager=s,this.interactionStore=n,this.sequencerId=r}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r},behavior:{zoom:a}}=this.config,{noteColorScheme:o}=j().theme,l=Wa[o]||(()=>"#999"),c={getPitchClass:ha,getTrackColor:()=>ja(this.sequencerId)},d=t*a,u=d/s,h=this.scroll.getX(),f=this.scroll.getY(),y=e.canvas,b=this.noteManager.getTrackedNotes(this.interactionStore);e.save(),e.translate(n-h,r-f);const m=Ka(h,f,this.config,y)(b);for(const{note:v,state:S}of m){const C=li(v.pitch,this.config.layout.lowestMidi,this.config.layout.highestMidi)*u,N=v.start*d,w=v.duration*d,M=u,G=l(v,c);e.fillStyle=G,ze(e,N,C,w,M,4),e.fill(),(S.selected||S.hovered||S.highlighted)&&(e.lineWidth=2,e.strokeStyle=S.selected?"#ffffff":S.hovered?"#ff9933":"#33ff99",ze(e,N,C,w,M,4),e.stroke())}e.restore()}}class Va{constructor(e,t,s,n){this.scroll=e,this.config=t,this.store=s,this.getNoteDuration=n}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,c=t*l,d=c/s;e.save(),e.translate(n-this.scroll.getX(),r-this.scroll.getY()),e.fillStyle="rgba(100, 180, 255, 0.5)";const u=this.store.getPreviewNotes();if(u.length>0){const m=o-a+1;for(const v of u){const S=ge(v.pitch);if(S===null)continue;const g=m-1-(S-a),C=v.start*c,N=g*d,w=v.duration*c;ze(e,C,N,w,d,3),e.fill()}e.restore();return}const h=this.store.getSnappedCursorGridPosition();if(!h){e.restore();return}const f=this.getNoteDuration(),y=h.x*c,b=h.y*d,_=c*f;ze(e,y,b,_,d,3),e.fill(),e.restore()}}class Ya{constructor(e,t){this.scroll=e,this.config=t,this.animations=[]}playNote(e){const t=performance.now(),s=ue();let n=e.duration*6e4/s;n=Math.max(100,Math.min(n,1600));const a=(J(e.pitch)||0)*5%360;this.animations.push({note:e,startTime:t,duration:n,hue:a})}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,labelWidth:n,headerHeight:r,lowestMidi:a,highestMidi:o},behavior:{zoom:l}}=this.config,c=this.scroll.getX(),d=this.scroll.getY(),u=t*l,h=u/s,f=performance.now();e.clearRect(0,0,e.canvas.width,e.canvas.height),this.animations=this.animations.filter(y=>{const b=(f-y.startTime)/y.duration;if(b>1)return!1;const{note:_,hue:m}=y,v=J(_.pitch);if(v==null||v<a||v>o)return!0;const S=o-v,g=_.start*u+n-c,C=S*h+r-d,N=_.duration*u,w=h-1,M=g+N/2,G=C+w/2,k=Math.sin(b*Math.PI),B=`hsla(${m}, 100%, 70%, ${.4*k})`;e.save(),e.globalAlpha=1,e.fillStyle=B,e.beginPath(),e.roundRect(g,C,N,w,4),e.fill();const x=2,F=50;for(let q=0;q<x;q++){const U=q*F,K=Math.max(0,Math.min(1,(f-y.startTime-U)/(y.duration-U))),Ee=Math.sin(K*Math.PI),Qe=1+(.1+q*.1)*Ee,Lt=(1-K)*.3;e.globalAlpha=Lt,e.strokeStyle=`hsl(${m}, 100%, 65%)`,e.lineWidth=1.5;const et=N*Qe,Ni=w*Qe;e.beginPath(),e.roundRect(M-et/2,G-Ni/2,et,Ni,4),e.stroke()}return e.restore(),!0}),this.animations.length>0&&requestAnimationFrame(()=>this.draw(e))}}class Za{constructor(e,t){this.scroll=e,this.config=t,this.x=null}setPlayheadX(e){this.x=e}clear(){this.x=null}draw(e){if(this.x==null)return;const{layout:{verticalCellRatio:t,baseCellWidth:s,labelWidth:n,headerHeight:r,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=this.config,c=a-o+1,d=this.scroll.getX(),u=this.scroll.getY(),h=s*l/t,f=c*h+r,y=this.x;e.save(),e.translate(n-d,-u),e.lineWidth=2,e.strokeStyle="rgba(168, 85, 247, 1.0)",e.shadowColor="rgba(168, 85, 247, 0.5)",e.shadowBlur=6,e.beginPath(),e.moveTo(y,0),e.lineTo(y,f),e.stroke(),e.restore()}}class st{constructor(e,t=!0){this.canvas=e,this.dpr=t&&window.devicePixelRatio||1;const s=this.canvas.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.ctx=s}resize(){const e=this.canvas.offsetWidth,t=this.canvas.offsetHeight,s=Math.floor(e*this.dpr),n=Math.floor(t*this.dpr);(this.canvas.width!==s||this.canvas.height!==n)&&(this.canvas.width=s,this.canvas.height=n,this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(this.dpr,this.dpr))}getContext(){return this.ctx}withContext(e){e(this.ctx)}clear(){this.ctx.clearRect(0,0,this.canvas.offsetWidth,this.canvas.offsetHeight)}destroy(){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.canvas.width=0,this.canvas.height=0,this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}}class Bi{constructor(e,t,s,n,r){this.thumb=e,this.isHorizontal=t,this.scroll=s,this.interactionStore=n,this.requestRedraw=r,this.onMouseEnter=()=>this.interactionStore.setIsOnScrollbar(!0),this.onMouseLeave=()=>this.interactionStore.setIsOnScrollbar(!1),this.onThumbMouseDown=o=>this.handleMouseDown(o),this.onMouseMove=null,this.onMouseUp=null;const a=this.thumb.parentElement;if(!a)throw new Error("Scrollbar thumb must have a parent track element.");this.track=a,this.attachDragHandler()}attachDragHandler(){this.track.addEventListener("mouseenter",this.onMouseEnter),this.track.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mouseenter",this.onMouseEnter),this.thumb.addEventListener("mouseleave",this.onMouseLeave),this.thumb.addEventListener("mousedown",this.onThumbMouseDown)}handleMouseDown(e){e.preventDefault(),this.interactionStore.setIsScrolling(!0),this.onMouseMove=t=>{const s=this.track.getBoundingClientRect(),n=this.isHorizontal?this.track.offsetWidth:this.track.offsetHeight,a=(this.isHorizontal?t.clientX:t.clientY)-(this.isHorizontal?s.left:s.top),o=this.isHorizontal?this.thumb.offsetWidth:this.thumb.offsetHeight,l=n-o,c=Math.max(0,Math.min(a-o/2,l)),d=l>0?c/l:0,u=this.isHorizontal?this.scroll.getMaxScrollX():this.scroll.getMaxScrollY(),h=d*u;this.isHorizontal?this.scroll.setScroll(h,this.scroll.getY()):this.scroll.setScroll(this.scroll.getX(),h),this.requestRedraw()},this.onMouseUp=()=>{document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp),this.interactionStore.setIsScrolling(!1),this.onMouseMove=null,this.onMouseUp=null},document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}destroy(){this.track.removeEventListener("mouseenter",this.onMouseEnter),this.track.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mouseenter",this.onMouseEnter),this.thumb.removeEventListener("mouseleave",this.onMouseLeave),this.thumb.removeEventListener("mousedown",this.onThumbMouseDown),this.onMouseMove&&document.removeEventListener("mousemove",this.onMouseMove),this.onMouseUp&&document.removeEventListener("mouseup",this.onMouseUp),this.onMouseMove=null,this.onMouseUp=null}}let Ei=!1;function Qa(){if(Ei)return;const i=document.createElement("style");i.textContent=`
    .grid-scrollbars {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .grid-scrollbar {
      position: absolute;
      background: #1f1f1f;
      pointer-events: all;
    }

    .grid-scrollbar-thumb {
      position: absolute;
      background: #888;
      border-radius: 6px;
      cursor: pointer;
    }

    .grid-scrollbar-corner {
      position: absolute;
      width: 12px;
      height: 12px;
      bottom: 0;
      right: 0;
      background: #1f1f1f;
      z-index: 2;
      pointer-events: none;
    }
  `,document.head.appendChild(i),Ei=!0}class eo{constructor(e,t,s,n,r){this.container=e,this.scroll=t,this.config=s,this.interactionStore=n,this.requestRedraw=r,this.trackThickness=16,Qa(),this.createDOM(),this.attachEvents(),this.config=this.config,this.interactionStore=n}createDOM(){const e=this.hScrollbar=document.createElement("div"),t=this.hThumb=document.createElement("div"),s=this.vScrollbar=document.createElement("div"),n=this.vThumb=document.createElement("div"),r=this.corner=document.createElement("div");e.className="grid-scrollbar",s.className="grid-scrollbar",t.className="grid-scrollbar-thumb",n.className="grid-scrollbar-thumb",r.className="grid-scrollbar-corner",e.style.position=s.style.position=r.style.position="absolute",e.style.zIndex=s.style.zIndex=r.style.zIndex="5",e.style.bottom="0",e.style.left="0",e.style.right=`${this.trackThickness}px`,e.style.height=`${this.trackThickness}px`,s.style.top="0",s.style.right="0",s.style.bottom=`${this.trackThickness}px`,s.style.width=`${this.trackThickness}px`,r.style.width=`${this.trackThickness}px`,r.style.height=`${this.trackThickness}px`,r.style.right="0",r.style.bottom="0",r.style.background="#333",r.style.position="absolute",t.style.zIndex=n.style.zIndex="6",t.style.position=n.style.position="absolute",t.style.background="#7e22ce",n.style.background="#7e22ce",t.style.borderRadius=n.style.borderRadius="8px",t.style.height="100%",n.style.width="100%",e.appendChild(t),s.appendChild(n),this.container.appendChild(e),this.container.appendChild(s),this.container.appendChild(r)}attachEvents(){this.hDragHandler=new Bi(this.hThumb,!0,this.scroll,this.interactionStore,this.requestRedraw),this.vDragHandler=new Bi(this.vThumb,!1,this.scroll,this.interactionStore,this.requestRedraw)}update(){const{width:e,height:t}=this.container.getBoundingClientRect(),s=this.scroll.getContentWidth(),n=this.scroll.getContentHeight(),r=this.scroll.getX(),a=this.scroll.getY(),o=this.scroll.getMaxScrollX(),l=this.scroll.getMaxScrollY(),c=e-this.trackThickness,d=this.config.layout.labelWidth,u=Math.max(40,(e-d)/s*c),h=r/o*(c-u);this.hThumb.style.width=`${u}px`,this.hThumb.style.left=`${Math.max(0,h)}px`;const f=t-this.trackThickness,y=this.config.layout.headerHeight,b=Math.max(40,(t-y)/n*f),_=a/l*(f-b);this.vThumb.style.height=`${b}px`,this.vThumb.style.top=`${Math.max(0,_)}px`}destroy(){this.hDragHandler.destroy(),this.vDragHandler.destroy(),this.hScrollbar.remove(),this.vScrollbar.remove(),this.corner.remove(),this.hScrollbar=null,this.vScrollbar=null,this.corner=null}}var L=(i=>(i[i.NoteTool=0]="NoteTool",i[i.Selecting=1]="Selecting",i[i.SelectedIdle=2]="SelectedIdle",i[i.Dragging=3]="Dragging",i[i.Pasting=4]="Pasting",i[i.Sizing=5]="Sizing",i))(L||{});function Se(i,e,t,s,n){const r=Xe(i,e),a=t.getSnapResolution(),o=t.isTripletMode();return Ve(r,s,n,a,o)}function pe(i,e,t,s){const{baseCellWidth:n}=s.layout,{zoom:r}=s.behavior,a=$s(i,e,t,s),o=n*r;return a.x/o}var A=(i=>(i.Default="default",i.Pointer="pointer",i.Crosshair="crosshair",i.Grabbing="grabbing",i.Grab="grab",i.ResizeHorizontal="ew-resize",i.ResizeVertical="ns-resize",i.Move="move",i.NotAllowed="not-allowed",i.Custom="url(cursor.png), auto",i))(A||{});function Je(i,e,t,s){return!i||i.x>=se()?(e.setSnappedCursorGridPosition(null),e.setHoveredNoteKey(null),t.set(A.Default),s(),!0):!1}function to(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),t):i}function ui(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}function hi(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function io(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),t}function te(i,e){return{type:"DELETE_NOTES",sequencerId:i,notes:structuredClone(e)}}function ie(i,e){return{type:"PLACE_NOTES",sequencerId:i,notes:structuredClone(e)}}class so{constructor(e,t,s,n,r,a,o,l,c,d,u,h){this.canvas=e,this.noteManager=t,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=c,this.cursorController=d,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Se(e,this.canvas,this.grid,this.scroll,this.config);if(Je(t,this.store,this.cursorController,this.requestRedraw))return;const s=pe(e,this.canvas,this.scroll,this.config);if(t){const n=V(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s),a=this.store.getHoveredNoteKey();if(r&&a===`${r.pitch}:${r.start}`){this.store.setSelectedNotes([r]),this.controller.transitionTo(L.Sizing);return}}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()){const d=this.store.getHoveredNoteKey();if(d&&n>=this.dragThreshold){const[u,h]=d.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(L.Dragging);return}}if(n>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(L.Selecting);return}}const r=Se(e,this.canvas,this.grid,this.scroll,this.config);if(!r||Je(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=V(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=pe(e,this.canvas,this.scroll,this.config),l=this.noteManager.findNoteUnderCursor(a,o),c=this.noteManager.findNoteEdgeAtCursor(a,o);if(l){const d=`${l.pitch}:${l.start}`;this.store.setHoveredNoteKey(d),this.store.setSnappedCursorGridPosition(null),c===l?this.cursorController.set(A.ResizeHorizontal):this.cursorController.set(A.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set(A.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0)return;if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}this.store.isDraggingToSelect()&&this.store.endSelectionDrag();const t=this.store.getHoveredNoteKey();if(t){if(performance.now()-this.store.getLastDeletionTime()<100)return;const[c,d]=t.split(":"),u=this.noteManager.findAtPosition(c,Number(d));if(u){this.noteManager.previewNote(u.pitch,.25),this.store.setSelectedNotes([u]),this.controller.transitionTo(L.SelectedIdle);return}}const s=this.store.getSnappedCursorGridPosition();if(!s)return;const{layout:n}=this.config,r=this.grid.getNoteDuration(),a=V(s.y,n.lowestMidi,n.highestMidi);if(!a||this.noteManager.findAtPosition(a,s.x))return;const l={start:s.x,duration:r,pitch:a,velocity:100};E(ui(this.getSequencerId(),[l]),hi(this.getSequencerId(),[l])),this.noteManager.previewNote(a,r),this.playNoteAnimation({start:s.x,duration:r,pitch:a,velocity:100})}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(E(te(this.getSequencerId(),[a]),ie(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(L.Pasting)}}onEnter(){X("DefaultNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}function Ti(i,e,t,s,n){const{layout:{baseCellWidth:r,verticalCellRatio:a,lowestMidi:o,highestMidi:l},behavior:{zoom:c}}=s,d=r*c,u=d/a,h=Math.min(e.startX,e.currentX+d/2),f=Math.max(e.startX,e.currentX+d/2),y=Math.min(e.startY,e.currentY),b=Math.max(e.startY,e.currentY),_=n.getSnapResolution(),m=Math.floor(h/d/_)*_,v=Math.floor(f/d/_)*_,S=Math.floor(y/u),g=Math.floor(b/u),C=Math.min(S,g),N=Math.max(S,g);return i.filter(w=>{const M=li(w.pitch,o,l);if(M==null)return!1;const G=M>=C&&M<=N,k=w.start+w.duration,B=w.start>=m&&k<=v;return G&&B})}class ro{constructor(e,t,s,n,r,a,o,l){this.canvas=e,this.config=t,this.scroll=s,this.grid=n,this.store=r,this.controller=a,this.noteManager=o,this.requestRedraw=l}onEnter(){const e=Pa(this.controller.getLastMouseX(),this.controller.getLastMouseY(),this.canvas,this.scroll,this.config);this.store.setMarqueeBox({startX:e.x,startY:e.y,currentX:e.x,currentY:e.y})}onMouseMove(e){const t=this.store.getMarqueeBox();if(!t)return;const s=$s(e,this.canvas,this.scroll,this.config);t.currentX=s.x,t.currentY=s.y,this.store.setMarqueeBox({...t});const n=Ti(this.noteManager.getAll(),t,this.scroll,this.config,this.grid);this.store.setHighlightedNotes(n),this.requestRedraw()}onMouseUp(e){const t=this.store.getMarqueeBox();if(!t){this.controller.transitionTo(L.NoteTool);return}const s=Ti(this.noteManager.getAll(),t,this.scroll,this.config,this.grid),r=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(s.length>0){const a=this.store.getSelectedNotes(),o=r?this.noteManager.mergeSelections(a,s):s;this.store.setSelectedNotes(o),this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(L.SelectedIdle)}else this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onMouseLeave(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.controller.transitionTo(L.NoteTool)}onExit(){this.store.clearHighlightedNotes(),this.store.setMarqueeBox(null),this.requestRedraw()}}class no{constructor(e,t,s,n,r,a,o,l,c,d,u,h){this.canvas=e,this.config=t,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=c,this.cursorController=d,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=Se(e,this.canvas,this.grid,this.scroll,this.config);if(!t)return;const s=pe(e,this.canvas,this.scroll,this.config),n=V(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),r=this.noteManager.findNoteEdgeAtCursor(n,s);if(r){const a=`${r.pitch}:${r.start}`;new Set(this.store.getSelectedNotes().map(l=>`${l.pitch}:${l.start}`)).has(a)||this.store.setSelectedNotes([r]),this.controller.transitionTo(L.Sizing);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),_=parseFloat(b),m=this.noteManager.findAtPosition(y,_);if(!m)return;this.store.getSelectedNotes().some(g=>g.pitch===m.pitch&&g.start===m.start)||this.store.setSelectedNotes([m]),this.store.setDragAnchorNoteKey(`${m.pitch}:${m.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(L.Dragging);return}if(!f&&n>=this.dragThreshold){!e.ctrlKey&&!e.metaKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(L.Selecting);return}}const r=Xe(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),l=Ve(r,this.scroll,this.config,a,o);if(!l){this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default),this.requestRedraw();return}const c=pe(e,this.canvas,this.scroll,this.config),d=V(l.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(d,c),h=this.noteManager.findNoteEdgeAtCursor(d,c);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(A.ResizeHorizontal):this.cursorController.set(A.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const s=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),r=n.some(l=>`${l.pitch}:${l.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const l=n.filter(c=>`${c.pitch}:${c.start}`!==s);this.store.setSelectedNotes(l)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(L.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(L.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),l=o.some(c=>c.pitch===a.pitch&&c.start===a.start);o.length>0&&l?E(te(this.getSequencerId(),o),ie(this.getSequencerId(),o)):E(te(this.getSequencerId(),[a]),ie(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),E(te(this.getSequencerId(),t),ie(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(L.Pasting);return}if(e.key==="Delete"){if(!t.length)return;E(te(this.getSequencerId(),t),ie(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}}}function ao({notes:i,anchorBeat:e,anchorMidi:t,targetBeat:s,targetMidi:n,lowestMidi:r,highestMidi:a}){const o=s-e,l=i.map(_=>_.start+o),c=i.map(_=>_.start+o+_.duration),d=Math.min(...l),u=Math.max(...c),h=Math.min(0,d),f=Math.max(0,u-se()),y=o-h-f;if(!_t()||He()){const _=n-t;return i.flatMap(m=>{const v=ge(m.pitch);if(v==null)return[];let S=v+_;S<r&&(S=r),S>a&&(S=a);const g=Ge(S);return g?[{pitch:g,start:m.start+y,duration:m.duration,velocity:m.velocity??100}]:[]})}else{const _=gt(),m=[];for(let C=a;C>=r;C--)_.get(C)&&m.push(C);const v=m.indexOf(t),S=m.indexOf(n);if(v===-1||S===-1)return[];const g=S-v;return i.flatMap(C=>{const N=ge(C.pitch);if(N==null)return[];const w=m.indexOf(N);if(w===-1)return[];const M=w+g;if(M<0||M>=m.length)return[];const G=m[M],k=Ge(G);return k?[{pitch:k,start:C.start+y,duration:C.duration,velocity:C.velocity??100}]:[]})}}class oo{constructor(e,t,s,n,r,a,o,l,c,d){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.grid=r,this.requestRedraw=a,this.getSequencerId=o,this.controller=l,this.cursorController=c,this.getClipboard=d}onMouseMove(e){const t=Se(e,this.canvas,this.grid,this.scroll,this.config);if(!t||Je(t,this.store,this.cursorController,this.requestRedraw))return;const s=this.getClipboard();if(!s.notes.length)return;const{lowestMidi:n,highestMidi:r}=this.config.layout,a=r-n+1,o=n+(a-1-t.y),l=t.x,c=ao({notes:s.notes,anchorBeat:s.anchorBeat,anchorMidi:s.anchorMidi,targetBeat:l,targetMidi:o,lowestMidi:n,highestMidi:r});this.store.setPreviewNotes(c),this.cursorController.set(A.Pointer),this.requestRedraw()}onMouseDown(e){if(e.button!==0||this.store.isOnNonGridElement())return;const t=this.store.getPreviewNotes();t.length&&(E(ui(this.getSequencerId(),t),hi(this.getSequencerId(),t)),this.store.clearPreviewNotes(),this.controller.transitionTo(L.NoteTool))}onMouseLeave(){this.store.clearPreviewNotes(),this.controller.transitionTo(L.NoteTool)}onExit(){this.store.clearPreviewNotes(),this.requestRedraw()}}function lo({originalNotes:i,anchorNote:e,targetPitch:t,targetBeat:s,lowestMidi:n,highestMidi:r}){const a=ge(t),o=ge(e.pitch);if(a==null||o==null)return[];const l=s-e.start,c=i.map(m=>m.start+l),d=i.map(m=>m.start+l+m.duration),u=Math.min(...c),h=Math.max(...d),f=Math.min(0,u),y=Math.max(0,h-se()),b=l-f-y;if(!_t()||He()){const m=a-o;return i.flatMap(v=>{const S=ge(v.pitch);if(S==null)return[];let g=S+m;g<n&&(g=n),g>r&&(g=r);const C=Ge(g);return C?[{pitch:C,start:v.start+b,duration:v.duration,velocity:v.velocity??100}]:[]})}else{const m=gt(),v=[];for(let N=r;N>=n;N--)m.get(N)&&v.push(N);const S=v.indexOf(o),g=v.indexOf(a);if(S===-1||g===-1)return[];const C=g-S;return i.flatMap(N=>{const w=ge(N.pitch);if(w==null)return[];const M=v.indexOf(w);if(M===-1)return[];const G=M+C;if(G<0||G>=v.length)return[];const k=v[G],B=Ge(k);return B?[{pitch:B,start:N.start+b,duration:N.duration,velocity:N.velocity??100}]:[]})}}function co(i,e){const t=structuredClone(i),s=t.sequencers.find(a=>a.id===e.sequencerId);if(!s)return i;const n=e.from,r=e.to;for(let a=0;a<n.length;a++){const o=n[a],l=r[a],c=s.notes.findIndex(d=>d.pitch===o.pitch&&d.start===o.start&&d.duration===o.duration);c!==-1&&(s.notes[c].pitch=l.pitch,s.notes[c].start=l.start)}return t}function Ws(i,e,t){return{type:"MOVE_NOTES",sequencerId:i,from:structuredClone(e),to:structuredClone(t)}}function uo(i,e,t){return Ws(i,t,e)}class ho{constructor(e,t,s,n,r,a,o,l,c,d){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=l,this.cursorController=c,this.getSequencerId=d,this.originalNotes=[],this.anchorNote=null,this.hasMoved=!1,this.lastPreviewedPitch=null}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(L.NoteTool);return}this.originalNotes=e.map(n=>({...n}));const t=this.store.getDragAnchorNoteKey(),s=t?e.find(n=>`${n.pitch}:${n.start}`===t):e[0];this.anchorNote=s??e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasMoved=!1,this.requestRedraw()}onMouseMove(e){const t=Xe(e,this.canvas),s=this.grid.getSnapResolution(),n=this.grid.isTripletMode(),r=Ve(t,this.scroll,this.config,s,n);if(!r||!this.anchorNote)return;const{layout:a}=this.config,o=V(r.y,a.lowestMidi,a.highestMidi);if(!o)return;const l=lo({originalNotes:this.originalNotes,anchorNote:this.anchorNote,targetPitch:o,targetBeat:r.x,lowestMidi:a.lowestMidi,highestMidi:a.highestMidi});this.store.setPreviewNotes(l),this.hasMoved=!0,this.cursorController.set(A.Grabbing),o!==this.lastPreviewedPitch&&(this.noteManager.previewNote(o,.25),this.lastPreviewedPitch=o),this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote)return;const t=this.store.getPreviewNotes();if(this.hasMoved&&t.some((n,r)=>n.start!==this.originalNotes[r].start||n.pitch!==this.originalNotes[r].pitch))E(Ws(this.getSequencerId(),this.originalNotes,t),uo(this.getSequencerId(),this.originalNotes,t));else for(const n of this.originalNotes)this.noteManager.add(n);this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onMouseLeave(){this.hasMoved=!1,this.controller.transitionTo(L.NoteTool)}onExit(){if(!this.hasMoved&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.store.setDragAnchorNoteKey(null),this.requestRedraw()}}function fo(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=e.resizes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start);a&&(a.duration=r.newDuration)}return t}function po(i,e){return{type:"RESIZE_NOTES",sequencerId:i,resizes:structuredClone(e)}}function mo(i,e){const t=e.map(s=>({pitch:s.pitch,start:s.start,newDuration:s.oldDuration}));return{type:"RESIZE_NOTES",sequencerId:i,resizes:t}}class yo{constructor(e,t,s,n,r,a,o,l,c,d){this.canvas=e,this.config=t,this.scroll=s,this.store=n,this.noteManager=r,this.grid=a,this.requestRedraw=o,this.controller=l,this.cursorController=c,this.getSequencerId=d,this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.hasResized=!1,this.hasMoved=!1,this.initialMouseX=0,this.accumulatedDelta=0}onEnter(){const e=this.store.getSelectedNotes();if(!e.length){this.controller.transitionTo(L.NoteTool);return}this.originalNotes=e.map(s=>({...s}));const t=this.store.getHoveredNoteKey();this.anchorNote=t?e.find(s=>`${s.pitch}:${s.start}`===t)??null:e[0],this.noteManager.removeAll(e),this.store.setPreviewNotes(this.originalNotes),this.hasResized=!1,this.hasMoved=!1,this.accumulatedDelta=0,this.initialMouseX=this.controller.getLastMouseX(),this.requestRedraw()}onMouseMove(e){if(!this.anchorNote)return;const t=this.grid.getSnapResolution(),n=this.grid.isTripletMode()?t*(2/3):t,r=e.clientX-this.initialMouseX,o=this.config.layout.baseCellWidth*this.config.behavior.zoom*n,l=r/o,c=Math.round(l);if(c===this.accumulatedDelta)return;this.accumulatedDelta=c;const d=c*n,u=this.originalNotes.map(h=>{const f=Math.max(n,h.duration+d);return{...h,duration:f}});this.previewNotes=u,this.store.setPreviewNotes(u),this.cursorController.set(A.ResizeHorizontal),this.hasResized=!0,this.requestRedraw()}onMouseUp(e){if(e.button!==0||!this.anchorNote||!this.hasResized)return;const t=this.originalNotes,n=this.previewNotes.map((a,o)=>({pitch:a.pitch,start:a.start,newDuration:a.duration})),r=t.map((a,o)=>({pitch:a.pitch,start:a.start,oldDuration:a.duration}));E(po(this.getSequencerId(),n),mo(this.getSequencerId(),r)),this.store.clearPreviewNotes(),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onMouseLeave(){this.controller.transitionTo(L.NoteTool)}onExit(){if(!this.hasResized&&this.originalNotes.length>0){for(const e of this.originalNotes)this.noteManager.add(e);this.noteManager.rebuildIndex()}this.originalNotes=[],this.previewNotes=[],this.anchorNote=null,this.store.clearPreviewNotes(),this.store.clearSelection(),this.requestRedraw()}}class _o{constructor(e,t,s,n,r,a,o,l,c,d,u,h){this.canvas=e,this.noteManager=t,this.scroll=s,this.config=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=c,this.cursorController=d,this.getClipboard=u,this.playNoteAnimation=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onMouseDown(e){if(!this.store.isOnNonGridElement())if(e.button!==0)this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;else{const t=Se(e,this.canvas,this.grid,this.scroll,this.config);if(Je(t,this.store,this.cursorController,this.requestRedraw)||!t)return;const s=pe(e,this.canvas,this.scroll,this.config),n=V(t.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!n)return;const r=this.noteManager.findNoteUnderCursor(n,s),a=this.noteManager.findNoteEdgeAtCursor(n,s);if(a&&r&&`${r.pitch}:${r.start}`==`${a.pitch}:${a.start}`){this.store.setSelectedNotes([a]),this.controller.transitionTo(L.Sizing);return}if(r){this.noteManager.previewNote(r.pitch,.25),this.store.setSelectedNotes([r]),this.store.suppressNextMouseUpEvent(),this.controller.transitionTo(L.SelectedIdle);return}this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY;const o=this.grid.getNoteDuration();if(this.noteManager.findAtPosition(n,t.x))return;const c={start:t.x,duration:o,pitch:n,velocity:100};E(ui(this.getSequencerId(),[c]),hi(this.getSequencerId(),[c])),this.noteManager.previewNote(n,o),this.playNoteAnimation(c)}}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(e.buttons===1&&this.store.isDraggingToSelect()){const d=this.store.getHoveredNoteKey();if(d&&n>=this.dragThreshold){const[u,h]=d.split(":"),f=this.noteManager.findAtPosition(u,Number(h));if(f){this.store.setSelectedNotes([f]),this.store.endSelectionDrag(),this.controller.transitionTo(L.Sizing);return}}}if(e.buttons===2&&this.store.isDraggingToSelect()){const d=e.clientX-this.initialMouseX,u=e.clientY-this.initialMouseY;if(Math.sqrt(d*d+u*u)>=this.dragThreshold){this.store.endSelectionDrag(),this.controller.transitionTo(L.Selecting);return}}const r=Se(e,this.canvas,this.grid,this.scroll,this.config);if(!r||Je(r,this.store,this.cursorController,this.requestRedraw))return;this.store.setSnappedCursorGridPosition(r);const a=V(r.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),o=pe(e,this.canvas,this.scroll,this.config),l=this.noteManager.findNoteUnderCursor(a,o),c=this.noteManager.findNoteEdgeAtCursor(a,o);if(l){const d=`${l.pitch}:${l.start}`;this.store.setHoveredNoteKey(d),this.store.setSnappedCursorGridPosition(null),c===l?this.cursorController.set(A.ResizeHorizontal):this.cursorController.set(A.Pointer)}else this.store.setHoveredNoteKey(null),this.store.setSnappedCursorGridPosition(r),this.cursorController.set(A.Default);this.requestRedraw()}onMouseUp(e){this.store.endSelectionDrag()}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n);if(!s||isNaN(r))return;const a=this.noteManager.findAtPosition(s,r);a&&(E(te(this.getSequencerId(),[a]),ie(this.getSequencerId(),[a])),this.store.setLastDeletionTime())}onMouseLeave(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default),this.requestRedraw()}onKeyDown(e){if((navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey)&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(L.Pasting)}}onEnter(){X("ExpressNoteToolHandler entered")}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}}class go{constructor(e,t,s,n,r,a,o,l,c,d,u,h){this.canvas=e,this.config=t,this.scroll=s,this.noteManager=n,this.store=r,this.grid=a,this.requestRedraw=o,this.getSequencerId=l,this.controller=c,this.cursorController=d,this.setClipboard=u,this.getClipboard=h,this.initialMouseX=0,this.initialMouseY=0,this.dragThreshold=3}onEnter(){var e;if(window&&((e=window.event)==null?void 0:e.buttons)&1){this.store.beginSelectionDrag();const t=window.event;this.initialMouseX=t.clientX,this.initialMouseY=t.clientY}}onExit(){this.store.setSnappedCursorGridPosition(null),this.store.setHoveredNoteKey(null),this.requestRedraw()}onMouseDown(e){if(this.store.isOnNonGridElement())return;const t=e.button===0,s=e.button===2,n=Se(e,this.canvas,this.grid,this.scroll,this.config);if(!n){s&&this.beginSelectionDrag(e);return}const r=V(n.y,this.config.layout.lowestMidi,this.config.layout.highestMidi);if(!r){s&&this.beginSelectionDrag(e);return}const a=pe(e,this.canvas,this.scroll,this.config),o=this.noteManager.findNoteUnderCursor(r,a);if(t){const l=this.noteManager.findNoteEdgeAtCursor(r,a);if(l){const c=`${l.pitch}:${l.start}`;new Set(this.store.getSelectedNotes().map(u=>`${u.pitch}:${u.start}`)).has(c)||this.store.setSelectedNotes([l]),this.controller.transitionTo(L.Sizing);return}o&&(this.beginSelectionDrag(e),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY)}if(s)if(o){const l=`${o.pitch}:${o.start}`;this.store.setHoveredNoteKey(l)}else this.store.setHoveredNoteKey(null),this.beginSelectionDrag(e)}beginSelectionDrag(e){this.store.beginSelectionDrag(),this.initialMouseX=e.clientX,this.initialMouseY=e.clientY}onMouseMove(e){if(this.store.isOnNonGridElement()){this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default),this.requestRedraw();return}const t=e.clientX-this.initialMouseX,s=e.clientY-this.initialMouseY,n=Math.sqrt(t*t+s*s);if(this.store.isDraggingToSelect()&&e.buttons&1){const f=this.store.getHoveredNoteKey();if(f&&n>=this.dragThreshold){const[y,b]=f.split(":"),_=parseFloat(b),m=this.noteManager.findAtPosition(y,_);if(!m)return;this.store.getSelectedNotes().some(g=>g.pitch===m.pitch&&g.start===m.start)||this.store.setSelectedNotes([m]),this.store.setDragAnchorNoteKey(`${m.pitch}:${m.start}`),this.store.endSelectionDrag(),this.controller.transitionTo(L.Dragging);return}}else if(this.store.isDraggingToSelect()&&e.buttons&2&&!this.store.getHoveredNoteKey()&&n>=this.dragThreshold){!e.metaKey&&!e.shiftKey&&!e.ctrlKey&&this.store.clearSelection(),this.store.endSelectionDrag(),this.controller.transitionTo(L.Selecting);return}const r=Xe(e,this.canvas),a=this.grid.getSnapResolution(),o=this.grid.isTripletMode(),l=Ve(r,this.scroll,this.config,a,o);if(!l){this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default),this.requestRedraw();return}const c=pe(e,this.canvas,this.scroll,this.config),d=V(l.y,this.config.layout.lowestMidi,this.config.layout.highestMidi),u=this.noteManager.findNoteUnderCursor(d,c),h=this.noteManager.findNoteEdgeAtCursor(d,c);if(u){const f=`${u.pitch}:${u.start}`;this.store.setHoveredNoteKey(f),h&&h===u?this.cursorController.set(A.ResizeHorizontal):this.cursorController.set(A.Pointer)}else this.store.setHoveredNoteKey(null),this.cursorController.set(A.Default);this.requestRedraw()}onMouseUp(e){if(e.button!==0||this.store.isOnNonGridElement()||this.store.consumeSuppressMouseUpFlag())return;this.store.endSelectionDrag();const t=this.noteManager.findNoteAtMousePosition(e,this.canvas,this.scroll,this.config,this.noteManager);if(t){const s=`${t.pitch}:${t.start}`,n=this.store.getSelectedNotes(),r=n.some(l=>`${l.pitch}:${l.start}`===s);if(navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey){if(r){const l=n.filter(c=>`${c.pitch}:${c.start}`!==s);this.store.setSelectedNotes(l)}else this.noteManager.previewNote(t.pitch,.25),this.store.setSelectedNotes([...n,t]);this.controller.transitionTo(L.SelectedIdle);return}this.store.setSelectedNotes([t]),this.noteManager.previewNote(t.pitch,.25),this.controller.transitionTo(L.SelectedIdle);return}this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onContextMenu(e){if(e.preventDefault(),this.store.isOnNonGridElement())return;const t=this.store.getHoveredNoteKey();if(!t)return;const[s,n]=t.split(":"),r=parseFloat(n),a=this.noteManager.findNoteUnderCursor(s,r);if(!a)return;const o=this.store.getSelectedNotes(),l=o.some(c=>c.pitch===a.pitch&&c.start===a.start);o.length>0&&l?E(te(this.getSequencerId(),o),ie(this.getSequencerId(),o)):E(te(this.getSequencerId(),[a]),ie(this.getSequencerId(),[a])),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}onKeyDown(e){const t=this.store.getSelectedNotes(),n=navigator.platform.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey;if(n&&e.key==="c"){t.length&&this.setClipboard(t);return}if(n&&e.key==="x"){if(!t.length)return;this.setClipboard(t),E(te(this.getSequencerId(),t),ie(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool);return}if(n&&e.key==="v"){if(!this.getClipboard().notes.length)return;this.store.clearSelection(),this.controller.transitionTo(L.Pasting);return}if(e.key==="Delete"){if(!t.length)return;E(te(this.getSequencerId(),t),ie(this.getSequencerId(),t)),this.store.clearSelection(),this.controller.transitionTo(L.NoteTool)}}}class bo{constructor(e){this.data=e,this.mode=L.NoteTool,this.activeHandler=null,this.lastMouseX=0,this.lastMouseY=0,this.transitionTo(L.NoteTool)}handleMouseDown(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseDown)==null||s.call(t,e)}handleMouseMove(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseMove)==null||s.call(t,e)}handleMouseUp(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onMouseUp)==null||s.call(t,e)}handleContextMenu(e){var t,s;this.lastMouseX=e.clientX,this.lastMouseY=e.clientY,(s=(t=this.activeHandler)==null?void 0:t.onContextMenu)==null||s.call(t,e)}handleMouseLeave(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onMouseLeave)==null||t.call(e)}handleMouseEnter(e){var t,s;(s=(t=this.activeHandler)==null?void 0:t.onMouseEnter)==null||s.call(t,e)}handleKeyDown(e){var t,s;(s=(t=this.activeHandler)==null?void 0:t.onKeyDown)==null||s.call(t,e)}transitionTo(e){var t,s,n,r;X(`Transitioning to mode: ${L[e]} from ${L[this.mode]}`),(s=(t=this.activeHandler)==null?void 0:t.onExit)==null||s.call(t),this.mode=e,this.activeHandler=this.createHandlerForMode(e),(r=(n=this.activeHandler)==null?void 0:n.onEnter)==null||r.call(n)}reset(){this.transitionTo(L.NoteTool)}createHandlerForMode(e){const t={transitionTo:s=>this.transitionTo(s),getLastMouseX:()=>this.lastMouseX,getLastMouseY:()=>this.lastMouseY};switch(e){case L.NoteTool:{const{global:{noteToolMode:s}}=j(),n=s==="express"?_o:so,r=[this.data.canvas,this.data.noteManager,this.data.scroll,this.data.config,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard,this.data.playNoteAnimation];return new n(...r)}case L.Selecting:return new ro(this.data.canvas,this.data.config,this.data.scroll,this.data.grid,this.data.store,t,this.data.noteManager,this.data.requestRedraw);case L.SelectedIdle:{const{global:{noteToolMode:s}}=j(),n=s==="express"?go:no,r=[this.data.canvas,this.data.config,this.data.scroll,this.data.noteManager,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.setClipboard,this.data.getClipboard];return new n(...r)}case L.Pasting:return new oo(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.grid,this.data.requestRedraw,()=>this.data.sequencerContext.getId(),t,this.data.cursorController,this.data.getClipboard);case L.Dragging:return new ho(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());case L.Sizing:return new yo(this.data.canvas,this.data.config,this.data.scroll,this.data.store,this.data.noteManager,this.data.grid,this.data.requestRedraw,t,this.data.cursorController,()=>this.data.sequencerContext.getId());default:return{}}}destroy(){var e,t;(t=(e=this.activeHandler)==null?void 0:e.onExit)==null||t.call(e),this.activeHandler=null}}class vo{constructor(e){this.current=A.Default,this.canvas=e}set(e){this.current!==e&&(this.canvas.style.cursor=e,this.current=e)}reset(){this.set(A.Default)}}class So{constructor(e,t){this.context=e,this.canvas=t,this.onMouseMove=s=>{this.context.handleMouseMove(s)},this.onMouseDown=s=>{this.context.handleMouseDown(s)},this.onMouseUp=s=>{this.context.handleMouseUp(s)},this.onMouseLeave=()=>{this.context.handleMouseLeave()},this.onMouseEnter=s=>{var n,r;(r=(n=this.context).handleMouseEnter)==null||r.call(n,s)},this.onContextMenu=s=>{this.context.handleContextMenu(s)},this.onKeyDown=s=>{this.context.handleKeyDown(s)},this.attachListeners(),this.canvas.style.pointerEvents="auto"}attachListeners(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter),this.canvas.addEventListener("mousedown",this.onMouseDown),this.canvas.addEventListener("mouseup",this.onMouseUp),this.canvas.addEventListener("contextmenu",this.onContextMenu),window.addEventListener("keydown",this.onKeyDown)}destroy(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseenter",this.onMouseEnter),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mousedown",this.onMouseDown),this.canvas.removeEventListener("mouseup",this.onMouseUp),this.canvas.removeEventListener("contextmenu",this.onContextMenu),this.canvas.removeEventListener("keydown",this.onKeyDown)}}class Co{constructor(e,t,s){this.canvas=e,this.scroll=t,this.requestRedraw=s,this.SCROLL_SPEED_X=1,this.SCROLL_SPEED_Y=1,this.onWheel=n=>{n.preventDefault();const r=n.shiftKey||Math.abs(n.deltaX)>Math.abs(n.deltaY),a=n.deltaX||n.deltaY;if(r){const o=this.scroll.getX()+a*this.SCROLL_SPEED_X;this.scroll.setScroll(o,this.scroll.getY())}else{const o=this.scroll.getY()+n.deltaY*this.SCROLL_SPEED_Y;this.scroll.setScroll(this.scroll.getX(),o)}this.requestRedraw()},this.attachListeners()}attachListeners(){this.canvas.addEventListener("wheel",this.onWheel,{passive:!1})}destroy(){this.canvas.removeEventListener("wheel",this.onWheel)}}class No{constructor(){this.snappedCursorGridPosition=null,this.previewNotes=[],this.hoveredNoteKey=null,this.marqueeBox=null,this.highlightedNoteKeys=new Set,this.suppressNextMouseUp=!1,this.selectedNotes=[],this.dragAnchorNoteKey=null,this.isOnScrollbar=!1,this.isScrolling=!1,this.isInitiatingSelectionDrag=!1,this.isDraggingNotes=!1,this.lastDeletionTime=0}setSnappedCursorGridPosition(e){this.snappedCursorGridPosition=e}getSnappedCursorGridPosition(){return this.snappedCursorGridPosition}setPreviewNotes(e){this.previewNotes=e}getPreviewNotes(){return this.previewNotes}clearPreviewNotes(){this.previewNotes=[]}setHoveredNoteKey(e){this.hoveredNoteKey=e}getHoveredNoteKey(){return this.hoveredNoteKey}setMarqueeBox(e){this.marqueeBox=e}getMarqueeBox(){return this.marqueeBox}hasMarquee(){return this.marqueeBox!==null}setHighlightedNotes(e){this.highlightedNoteKeys=new Set(e.map(t=>`${t.pitch}:${t.start}`))}clearHighlightedNotes(){this.highlightedNoteKeys.clear()}isNoteHighlighted(e){return this.highlightedNoteKeys.has(`${e.pitch}:${e.start}`)}suppressNextMouseUpEvent(){this.suppressNextMouseUp=!0}consumeSuppressMouseUpFlag(){const e=this.suppressNextMouseUp;return this.suppressNextMouseUp=!1,e}getSelectedNotes(){return this.selectedNotes}setSelectedNotes(e){this.selectedNotes=e}clearSelection(){this.selectedNotes=[]}hasSelection(){return this.selectedNotes.length>0}setDragAnchorNoteKey(e){this.dragAnchorNoteKey=e}getDragAnchorNoteKey(){return this.dragAnchorNoteKey}setIsOnScrollbar(e){this.isOnScrollbar=e}getIsOnScrollbar(){return this.isOnScrollbar}setIsScrolling(e){this.isScrolling=e}isOnNonGridElement(){return this.isOnScrollbar||this.isScrolling}beginSelectionDrag(){this.isInitiatingSelectionDrag=!0}endSelectionDrag(){this.isInitiatingSelectionDrag=!1}isDraggingToSelect(){return this.isInitiatingSelectionDrag}setIsDraggingNotes(e){this.isDraggingNotes=e}getIsDraggingNotes(){return this.isDraggingNotes}isActivelyDragging(){return this.isDraggingNotes||this.isInitiatingSelectionDrag}setLastDeletionTime(){this.lastDeletionTime=performance.now()}getLastDeletionTime(){return this.lastDeletionTime}}class wo{constructor(e){this.container=this.createContainer(),e.appendChild(this.container),this.gridCanvas=this.createCanvas("gridCanvas"),this.noteCanvas=this.createCanvas("noteCanvas"),this.animationCanvas=this.createCanvas("animationCanvas"),this.playheadCanvas=this.createCanvas("playheadCanvas"),this.container.appendChild(this.gridCanvas),this.container.appendChild(this.noteCanvas),this.container.appendChild(this.animationCanvas),this.container.appendChild(this.playheadCanvas),this.gridCtx=this.getCtx(this.gridCanvas),this.noteCtx=this.getCtx(this.noteCanvas),this.animationCtx=this.getCtx(this.animationCanvas),this.playheadCtx=this.getCtx(this.playheadCanvas),this.injectContainerStyles(),this.injectCanvasStyles()}createContainer(){const e=document.createElement("div");return e.id="grid-container",e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.background="#222",e.style.border="1px solid #333",e.style.overflow="hidden",e.style.boxShadow="0 0 20px rgba(0,0,0,0.4)",e.style.borderRadius="6px",e}createCanvas(e){const t=document.createElement("canvas");return t.id=e,t.style.display="block",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.pointerEvents="none",t}getCtx(e){const t=e.getContext("2d");if(!t)throw new Error(`2D context not available for canvas with id: ${e.id}`);return t}injectContainerStyles(){const e=document.createElement("style");e.textContent=`
        #grid-container canvas {
          z-index: 0;
        }
        #grid-container canvas#noteCanvas {
          z-index: 1;
        }
        #grid-container canvas#animationCanvas {
          z-index: 2;
        }
        #grid-container canvas#playheadCanvas {
          z-index: 3;
        }
      `,document.head.appendChild(e)}injectCanvasStyles(){}}class Mo{constructor(e,t){this.scroll=e,this.config=t}draw(e){const{layout:{baseCellWidth:t,headerHeight:s,labelWidth:n},totalMeasures:r,beatsPerMeasure:a,behavior:{zoom:o}}=this.config,{gridColorScheme:l}=j().theme,c=ci[l],d=t*o,u=this.scroll.getX(),h=e.canvas.offsetWidth;e.save(),e.translate(n-u,0);const f=e.createLinearGradient(0,0,0,s);f.addColorStop(0,c.labelWhite),f.addColorStop(1,c.labelBlack),e.fillStyle=f,e.fillRect(-n+u,0,h,s);for(let y=0;y<=r;y++){const _=y*a*d,m=y%4===0;e.strokeStyle=m?c.measureLine:c.beatLine,e.lineWidth=m?2:1,e.beginPath(),e.moveTo(_,0),e.lineTo(_,s),e.stroke(),e.textAlign="center",e.textBaseline="top",e.fillStyle=m?c.textWhite:c.textBlack,e.font=`${m?"bold":""} ${Math.floor(s*.5)}px 'Inter', sans-serif`;const v=_+a*d/2;e.fillText(`${y+1}`,v,4)}e.restore()}}class Lo{constructor(e,t,s,n){this.scroll=e,this.config=t,this.getCustomLabels=s,this.getBlackKeyMap=n;const{lowestMidi:r,highestMidi:a}=t.layout;this.blackKeyMap=Ls(r,a)}draw(e){const{layout:{baseCellWidth:t,verticalCellRatio:s,headerHeight:n,labelWidth:r,highestMidi:a,lowestMidi:o},behavior:{zoom:l}}=this.config,{gridColorScheme:c}=j().theme,d=ci[c],u=a-o+1,h=this.scroll.getY(),y=t*l/s,b=e.canvas.offsetHeight??u*y+n;e.save(),e.translate(0,-h);const _=e.createLinearGradient(0,0,0,b);_.addColorStop(0,d.labelWhite),_.addColorStop(1,d.labelBlack),e.fillStyle=_,e.fillRect(0,h,r,b),e.font=`${Math.floor(y*.6)}px 'Inter', sans-serif`,e.textAlign="right",e.textBaseline="middle",e.strokeStyle=d.gridLine,e.lineWidth=1,e.beginPath(),e.moveTo(r-.5,h),e.lineTo(r-.5,h+b),e.stroke();const m=this.getCustomLabels();for(let v=0;v<u;v++){const S=v*y+n,g=a-v,C=(m==null?void 0:m[g])??V(v,o,a),N=this.getBlackKeyMap().get(g)??!1;e.fillStyle=N?d.textBlack:d.textWhite,e.fillText(C,r-8,S+y/2)}e.restore()}}class xo{constructor(e,t,s){this.scroll=e,this.config=t,this.interactionStore=s}draw(e){const t=this.interactionStore.getMarqueeBox();if(!t)return;const{layout:{baseCellWidth:s,verticalCellRatio:n},behavior:{zoom:r}}=this.config,a=this.scroll.getX(),o=this.scroll.getY(),l=Math.min(t.startX,t.currentX),c=Math.min(t.startY,t.currentY),d=Math.abs(t.currentX-t.startX),u=Math.abs(t.currentY-t.startY);d<1||u<1||(e.save(),e.translate(this.config.layout.labelWidth-a,this.config.layout.headerHeight-o),e.strokeStyle="rgba(128, 90, 213, 1.0)",e.lineWidth=2,e.setLineDash([5,5]),ze(e,l,c,d,u,3),e.stroke(),e.restore())}}const Ye={cellWidth:40,cellHeight:20,visibleNotes:36,noteRange:["C1","B9"],currentDuration:1,snapResolution:1,isTripletMode:!1,loopEnabled:!1,useEqualTemperament:!0};let js={notes:[],anchorBeat:0,anchorMidi:0};function Go(i){if(i.length===0)return;const e=i[0],t=e.start,s=H(e.pitch)??0;js={notes:i.map(n=>({pitch:n.pitch,start:n.start,duration:n.duration,velocity:n.velocity??100})),anchorBeat:t,anchorMidi:s}}function ko(){return js}class Bo{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=new Set),this.listeners[e].add(t)}off(e,t){var s;(s=this.listeners[e])==null||s.delete(t)}emit(e,t){var s;(s=this.listeners[e])==null||s.forEach(n=>n(t))}clear(e){var t;(t=this.listeners[e])==null||t.clear()}removeAllListeners(){var e;for(const t in this.listeners)(e=this.listeners[t])==null||e.clear()}}class Eo{constructor(e,t={},s){this.sequencerConfig=Ye,this.needsRedraw=!0,this.customLabels=null,this.blackKeyMap=new Map,this.isDestroyed=!1,this.onWindowResize=()=>this.resize(),this.config=Ra(Aa(),t),this.sequencerContext=s,this.recalculateLabelAndHeader(),this.gridManager=new wo(e);const{gridCanvas:n,noteCanvas:r,animationCanvas:a,playheadCanvas:o}=this.gridManager;this.gridCanvasManager=new st(n),this.noteCanvasManager=new st(r),this.animationCanvasManager=new st(a),this.playheadCanvasManager=new st(o);const l=this.gridManager.container;this.noteManager=new qa(this.config,this.sequencerContext.playNote),this.interactionStore=new No,this.emitter=new Bo,this.scroll=new Da(l,this.config),this.scrollbars=new eo(l,this.scroll,this.config,this.interactionStore,()=>this.requestRedraw()),this.wheelHandler=new Co(l,this.scroll,()=>this.requestRedraw()),this.cursorController=new vo(l);const c={canvas:r,noteManager:this.noteManager,scroll:this.scroll,config:this.config,store:this.interactionStore,grid:this,addNote:d=>this.noteManager.add(d),requestRedraw:()=>this.requestRedraw(),sequencerContext:s,cursorController:this.cursorController,setClipboard:Go,getClipboard:ko,playNoteAnimation:d=>this.playNoteAnimation(d)};this.interactionContext=new bo(c),this.inputTracker=new So(this.interactionContext,l),this.gridRenderer=new Fa(this.scroll,this.config,this.interactionStore,()=>this.getBlackKeyMap(),()=>gt()),this.noteRenderer=new Xa(this.scroll,this.config,this.noteManager,this.interactionStore,this.sequencerContext.getId()),this.notePreviewRenderer=new Va(this.scroll,this.config,this.interactionStore,()=>this.getNoteDuration()),this.animationRenderer=new Ya(this.scroll,this.config),this.headerRenderer=new Mo(this.scroll,this.config),this.labelRenderer=new Lo(this.scroll,this.config,()=>this.customLabels,()=>this.getBlackKeyMap()),this.playheadRenderer=new Za(this.scroll,this.config),this.marqueeRenderer=new xo(this.scroll,this.config,this.interactionStore),this.initialZoom=this.zoom,this.customLabels=null,requestAnimationFrame(()=>this.resize()),this.playheadRenderer.setPlayheadX(0),this.attachListeners(),this.renderLoop()}attachListeners(){window.addEventListener("resize",this.onWindowResize)}detachListeners(){window.removeEventListener("resize",this.onWindowResize)}renderLoop(){this.isDestroyed||(this.needsRedraw&&(this.render(),this.needsRedraw=!1),requestAnimationFrame(()=>this.renderLoop()))}recalculateLabelAndHeader(){const{baseCellWidth:e,verticalCellRatio:t,labelWidthColumns:s,headerHeightRows:n}=this.config.layout,r=this.zoom,a=e*r,o=a/t;this.config.layout.labelWidth=s*a,this.config.layout.headerHeight=n*o}get zoom(){return this.config.behavior.zoom}set zoom(e){this.config.behavior.zoom=e}get notes(){const e=this.noteManager.getAll();return e||[]}render(){this.gridCanvasManager.clear(),this.noteCanvasManager.clear(),this.animationCanvasManager.clear(),this.playheadCanvasManager.clear();const e=this.gridCanvasManager.getContext(),t=this.noteCanvasManager.getContext(),s=this.animationCanvasManager.getContext(),n=this.playheadCanvasManager.getContext();this.gridRenderer.draw(e),this.noteRenderer.draw(t),this.notePreviewRenderer.draw(t),this.animationRenderer.draw(s),this.labelRenderer.draw(e),this.headerRenderer.draw(e),this.playheadRenderer.draw(n),this.interactionStore.hasMarquee()&&this.marqueeRenderer.draw(s),this.scrollbars.update()}requestRedraw(){this.needsRedraw=!0}resize(){this.gridCanvasManager.resize(),this.noteCanvasManager.resize(),this.animationCanvasManager.resize(),this.playheadCanvasManager.resize(),this.scroll.recalculateBounds(),this.scrollbars.update(),this.requestRedraw()}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}setPlayheadPixelX(e){this.playheadRenderer.setPlayheadX(e),this.requestRedraw()}getPixelsPerBeat(){return this.config.layout.baseCellWidth*this.config.behavior.zoom}setNotes(e){this.noteManager.set(e),this.requestRedraw()}playNoteAnimation(e){this.animationRenderer.playNote(e)}getTrackedNotes(){return this.noteManager.getTrackedNotes(this.interactionStore)}scrollTo(e,t){this.scroll.setScroll(e,t),this.scrollbars.update(),this.requestRedraw()}setZoom(e){this.zoom=e,this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.requestRedraw()}getZoom(){return this.zoom}resetZoom(){this.setZoom(this.initialZoom)}zoomIn(){this.setZoom(Math.min(this.config.behavior.maxZoom,this.zoom+.1))}zoomOut(){this.setZoom(Math.max(this.config.behavior.minZoom,this.zoom-.1))}setCustomLabels(e){this.customLabels=e,this.requestRedraw()}getMeasures(){return this.config.totalMeasures}setMeasures(e){this.config.totalMeasures=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getBeatsPerMeasure(){return this.config.beatsPerMeasure}setBeatsPerMeasure(e){this.config.beatsPerMeasure=Math.max(1,e),this.scroll.recalculateBounds(),this.requestRedraw()}getTotalBeats(){return this.config.totalMeasures*this.config.beatsPerMeasure}setNoteRange(e,t){this.config.layout.lowestMidi=e,this.config.layout.highestMidi=t,this.blackKeyMap=Ls(e,t),this.scroll.recalculateBounds(),this.recalculateLabelAndHeader(),this.resize(),this.requestRedraw()}refreshNoteRange(){this.setNoteRange(this.config.layout.lowestMidi,this.config.layout.highestMidi)}getBlackKeyMap(){return this.blackKeyMap}isTripletMode(){return dt()}getNoteDuration(){return this.sequencerConfig.currentDuration}getSnapResolution(){return wt()}getInteractionStore(){return this.interactionStore}getNoteManager(){return this.noteManager}getInteractionContext(){return this.interactionContext}emit(e,t){this.emitter.emit(e,t)}destroy(){this.inputTracker.destroy(),this.wheelHandler.destroy(),this.scrollbars.destroy(),this.gridManager.container.remove(),this.gridCanvasManager.destroy(),this.noteCanvasManager.destroy(),this.animationCanvasManager.destroy(),this.playheadCanvasManager.destroy(),this.detachListeners(),this.emitter.removeAllListeners(),this.interactionContext.destroy(),this.isDestroyed=!0}}function To(i,e,t){return new Eo(i,e,t)}function Xs({instrument:i,midi:e,time:t,duration:s,velocity:n}){var a;const r=((a=i.__midiMap)==null?void 0:a.get(e))??e;if(!(i!=null&&i.start)){console.warn("[startInstrumentNote] Instrument missing start() method");return}try{i.start({note:r,time:t,duration:s,velocity:n})}catch(o){console.warn("[startInstrumentNote] Failed to start instrument note",{midi:e,resolved:r,err:o})}}function fi(i,e){var t;(t=i==null?void 0:i.stop)==null||t.call(i);for(const s of e)clearTimeout(s);e.length=0}async function Io(i,e,t,s,n,r,a,o=0){if(!n)return;if(i||await e(),fi(i,r),!(i!=null&&i.start)){console.warn("[playback] Instrument does not support scheduled playback.");return}const c=60/ue(),d=performance.now();t.sort((h,f)=>h.start-f.start);let u=0;for(;u<t.length&&t[u].start<o;)u++;for(;u<t.length;u++){const h=t[u],f=J(h.pitch);if(f==null)continue;const y=h.start-o,b=a+y*c,_=h.duration*c,m=h.velocity??100;if(Xs({instrument:i,midi:f,time:b,duration:_,velocity:m}),!s){const v=d+y*c*1e3,S=Math.max(0,v-performance.now()),g=setTimeout(()=>{n==null||n.playNoteAnimation(h)},S);r.push(g)}}}function Ao(i,e,t,s,n,r){if(!s||n)return;const o=60/ue();performance.now();const d=(z().currentTime-e)/o,u=t+d;for(const h of i){if(h.start<u)continue;const y=(h.start-u)*o*1e3;if(y>=0){const b=setTimeout(()=>{s==null||s.playNoteAnimation(h)},y);r.push(b)}}}async function Ro(i,e,t,s,n,r,a,o,l,c=0){if(!s||(fi(i,o),i||await e(),r||!a||!(i!=null&&i.start)))return;const u=60/ue(),h=performance.now(),f=z().currentTime,y=t.filter(b=>b.start>=c);for(const b of y){const _=J(b.pitch);if(_==null)continue;const m=b.start-c,v=l+m*u;if(v<=f+.01)continue;const S=b.duration*u,g=b.velocity??100;if(Xs({instrument:i,midi:_,time:v,duration:S,velocity:g}),!n){const C=h+m*u*1e3,N=Math.max(0,C-performance.now()),w=setTimeout(()=>{s==null||s.playNoteAnimation(b)},N);o.push(w)}}}class Vs{constructor(e,t,s=z(),n=Le(),r="sf2/fluidr3-gm/acoustic_grand_piano",a=!1,o=0){if(this.colorIndex=0,this.id=0,this.mute=!1,this.solo=!1,this.collapsed=!1,this.miniContour=null,this.body=null,this.collapseIcon=null,this._scheduledAnimations=[],this._volume=100/127,this._pan=0,this._instrument=null,this.id=o,this.container=e,this.config={...t},this.context=s,this.destination=n,this.instrumentName=r,this.squelchLoadingScreen=a,this.container){const l=this.container.querySelector(".sequencer-body");this.matrix=To(l,{},{playNote:this.playNote.bind(this),getId:()=>this.id}),this.matrix.refreshNoteRange()}}async initInstrument(){try{this._instrument=await zs(this.instrumentName,this.context,this.destination,this._volume,this._pan,!1,!1),this.updateToDrumNoteRange()}catch(e){console.warn(`[SEQ:${this.id}] Failed to load instrument '${this.instrumentName}':`,e)}}setInstrument(e){this.instrumentName=e,this.updateTrackLabel(),this.initInstrument()}updateTrackLabel(){var t;const e=(t=this.container)==null?void 0:t.querySelector(".track-name");e&&(e.textContent=`${this.id+1}: ${this.instrumentName}`)}get notes(){var e;return((e=this.matrix)==null?void 0:e.notes)??[]}get volume(){return this._volume}set volume(e){var t;this._volume=Math.max(0,Math.min(1,e)),(t=this._instrument)!=null&&t.setVolume&&this._instrument.setVolume(this._volume)}get pan(){return this._pan}set pan(e){var t;this._pan=Math.max(-1,Math.min(1,e)),(t=this._instrument)!=null&&t.setPan&&this._instrument.setPan(this._pan)}get shouldPlay(){return ql()?this.solo:!this.mute}get scheduledAnimations(){return this._scheduledAnimations}set scheduledAnimations(e){this._scheduledAnimations=e}toggleMute(){const e=P.getInstance();this.mute=!this.mute,this.mute&&(this.solo=!1),this.stopScheduledNotes(),ki(this),e.isActive()&&Ri()}toggleSolo(){const e=P.getInstance();this.solo=!this.solo,this.solo&&(this.mute=!1),ki(this),e.isActive()&&Ri()}setCollapsed(e){this.collapsed=e}resetInteractionMode(){var e;(e=this.matrix)==null||e.getInteractionContext().reset()}async preparePlayback(e,t=0){var s;await Io(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.collapsed,this.matrix??null,this._scheduledAnimations,e,t)}stopScheduledNotes(){fi(this._instrument,this._scheduledAnimations)}resumeAnimationsFromCurrentTime(e,t){var s;Ao(((s=this.matrix)==null?void 0:s.notes)??[],e,t,this.matrix??null,this.collapsed,this._scheduledAnimations)}async reschedulePlayback(e,t=0){var s;await Ro(this._instrument,()=>this.initInstrument(),((s=this.matrix)==null?void 0:s.notes)??[],this.matrix??null,this.collapsed,this.mute,this.shouldPlay,this._scheduledAnimations,e,t)}async exportToOffline(e,t){var n;const s=t??((n=this.matrix)==null?void 0:n.notes);!s||s.length===0||await xa(this.instrumentName,this.context,this.destination,s,this._volume,this._pan,e)}playNote(e,t,s=100,n=!1){return Zn(this.instrumentName,e,t,s,n,null,Ce(),this.destination,this.volume,this.pan)}updateTotalMeasures(){this.matrix&&this.matrix.setMeasures(Si())}updateBeatsPerMeasure(){this.matrix&&this.matrix.setBeatsPerMeasure(vi())}redraw(){var e;(e=this.matrix)==null||e.requestRedraw()}getState(){return this.matrix?{notes:[...this.matrix.notes],config:{...this.config},instrument:this.instrumentName}:{notes:[],config:this.config,instrument:this.instrumentName}}setState({notes:e,config:t,instrument:s,volume:n,pan:r,collapsed:a}){this.matrix&&(this.matrix.setNotes(e),Object.assign(this.config,t),typeof n=="number"&&(this.volume=n),typeof r=="number"&&(this.pan=r),ut(this,a),s&&(this.instrumentName=s),this.redraw())}updateNotesFromTrackMap(e){this.matrix&&this.matrix.notes.splice(0,this.matrix.notes.length,...e.n.map(([t,s,n,r=100])=>({pitch:t,start:s,duration:n,velocity:r})))}updateNoteRange(e){Zt({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var t;return((t=this.matrix)==null?void 0:t.notes)??[]}},e)}updateToDrumNoteRange(){Ga({config:this.config,container:this.container,matrix:this.matrix,instrumentName:this.instrumentName,colorIndex:this.colorIndex,getNotes:()=>{var e;return((e=this.matrix)==null?void 0:e.notes)??[]}})}destroy(){var e,t;this.stopScheduledNotes(),(e=this.matrix)==null||e.destroy(),(t=this.container)==null||t.remove(),Dl(this.id),P.getInstance().removeSequencer(this),this._instrument=null,this.matrix=void 0,this.container=null,this.refreshPanUI=void 0,this.refreshVolumeUI=void 0}}function Fo(i,e){const t=structuredClone(i);t.sequencers=t.sequencers.filter(n=>n.id!==e.id);const s=Js(e.id);return s?s.destroy():console.warn(`DELETE_SEQUENCER: No controller found for id ${e.id}`),t}function Ys(i,e,t=[],s,n,r){return{type:"DELETE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:s,pan:n,collapsed:r}}function Zs(i,e,t=[],s,n,r){return{type:"CREATE_SEQUENCER",id:i,instrument:e,notes:structuredClone(t),volume:s,pan:n,collapsed:r}}function Oo(i,e,t){const s={id:t,...Ye},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",r=new Vs(i,s,z(),Le(),n,!0,t);r.id=t,r.colorIndex=t,r.mute=!1,r.solo=!1,r.volume=100/127,e.notes&&r.matrix&&r.matrix.setNotes(e.notes),e&&r.setState({notes:e.notes,config:{},instrument:e.instrument,volume:e.volume,pan:e.pan,collapsed:e.collapsed});const a=i.querySelector("canvas.mini-contour");return r.miniContour=a,bt(a,r.notes,r.config,r.colorIndex),r.updateTrackLabel(),r.initInstrument(),Ul(r.id,r),P.getInstance().addSequencer(r),{seq:r}}function Uo(){var i,e;for(const t of D().slice())E(Ys(t.id,t.instrumentName,((i=t.matrix)==null?void 0:i.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed),Zs(t.id,t.instrumentName,((e=t.matrix)==null?void 0:e.getNoteManager().getAll())??[],t.volume,t.pan,t.collapsed));Pl(),ka(),P.getInstance().clearSequencers()}function I(i,e){return p("img",{src:de(`static/svg/${i}.svg`),class:"w-6 h-6",alt:e})}function Do(){const i=T(),e=p("div",{class:`sequencer-header flex justify-between items-center ${i.textColor}`}),t=p("canvas",{class:"mini-contour w-full h-10 mb-2 bg-gray-800 rounded hidden"}),s=p("div",{class:`sequencer-body flex pt-2 h-[720px] border-t ${i.borderColor}`}),n=p("div",{class:"grip-handle group flex justify-center items-center h-6 cursor-grab hover:bg-gray-800 rounded"},I("icon-grip","Drag Track"));return{element:p("div",{class:`sequencer flex flex-col space-y-2 p-4 rounded ${i.surfaceBackground}`},e,t,s,n),topBarContainer:e,miniContourCanvas:t,matrixContainer:s,gripHandleContainer:n}}function Po(){const i=T(),e=p("div",{class:"sequencer-left-group-wrapper flex items-center gap-2"}),t=p("div",{class:"sequencer-volume-wrapper"}),s=p("div",{class:"sequencer-pan-wrapper"}),n=p("div",{class:"sequencer-zoom-wrapper flex items-center gap-2"}),r=p("div",{class:"sequencer-right-controls-wrapper flex items-center gap-2"}),a=p("div",{class:"sequencer-right-group-container flex items-center gap-3"},t,s,n,r);return{element:p("div",{class:`sequencer-header flex justify-between items-center w-full px-2 ${i.textColor}`},e,a),leftGroup:e,volumeWrapper:t,panWrapper:s,zoomWrapper:n,rightControlsWrapper:r}}function qo(){const i=T(),e=p("button",{class:["instrument-select-btn","side-button-primary","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonPrimaryColor,i.buttonPrimaryColorHover,i.textColor].join(" "),title:"Change Instrument"},I("icon-list-instrument","Change Instrument")),t=p("span",{class:`track-name font-semibold ${i.textColor}`},"Track");return{button:e,label:t}}function Ko(){const i=T(),e=p("div",{class:`volume-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.volumeGradientFrom} ${i.volumeGradientTo}`,style:"width: 60%;"}),t=p("div",{class:`volume-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 78.74%;"}),s=p("div",{class:["volume-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.volumeThumbColor].join(" "),style:"left: calc(60% - 5px);"});return{element:p("div",{class:`volume-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,s),fill:e,snapMarker:t,thumb:s}}function Ho(){const i=T(),e=p("div",{class:`pan-fill absolute top-0 left-0 h-full bg-gradient-to-r ${i.panGradientFrom} ${i.panGradientTo}`,style:"width: 50%;"}),t=p("div",{class:`pan-snap-marker absolute top-0 bottom-0 w-[2px] ${i.snapMarkerColor} pointer-events-none`,style:"left: 50%;"}),s=p("div",{class:["pan-thumb absolute top-1/2 -translate-y-1/2 w-[14px] h-[14px]","rounded-full shadow-md border group-hover:scale-110",i.borderColor,i.panThumbColor].join(" "),style:"left: calc(50% - 5px);"});return{element:p("div",{class:`pan-bar relative w-[140px] h-[16px] rounded-full overflow-hidden shadow-inner group cursor-pointer bg-gray-700 border ${i.borderColor}`},e,t,s),fill:e,snapMarker:t,thumb:s}}function zo(){const i=T(),e=p("button",{class:["zoom-in-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom In"},I("icon-zoom-in","Zoom In")),t=p("button",{class:["zoom-out-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Zoom Out"},I("icon-zoom-out","Zoom Out")),s=p("button",{class:["zoom-reset-btn hidden","cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor].join(" "),title:"Reset Zoom"},I("icon-reset","Reset Zoom")),n=p("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`}),r=p("div",{class:`zoom-button-divider hidden border-l mx-2 h-6 ${i.borderColor}`});return{element:p("div",{class:"flex items-center gap-2"},n,e,t,s,r),leadingDivider:n,zoomInBtn:e,zoomOutBtn:t,zoomResetBtn:s,trailingDivider:r}}function Jo(){const i=T(),e=["side-button-secondary cursor-pointer px-2 py-1 rounded w-8","flex items-center justify-center",i.buttonSecondaryColor,i.buttonSecondaryColorHover,i.textColor],t=p("button",{class:[...e,"mute-btn"].join(" "),title:"Mute Track"},I("icon-volume-mute","Mute Track")),s=p("button",{class:[...e,"solo-btn"].join(" "),title:"Solo Track"},I("icon-headphones","Solo Track")),n=p("button",{class:[...e,"collapse-btn"].join(" "),title:"Expand/Collapse Track"},I("icon-caret-down","Expand/Collapse")),r=p("button",{class:[...e,"delete-btn hover:bg-red-600"].join(" "),title:"Delete Track"},I("icon-close-circle","Delete Track"));return{element:p("div",{class:"flex items-center gap-2"},t,s,n,r),muteBtn:t,soloBtn:s,collapseBtn:n,deleteBtn:r}}function $o(i,e,t){let s=!1,n=0,r=0;const a=150,o=1e3,l=u=>{s=!0,n=u.clientY,r=e.offsetHeight,i.classList.replace("cursor-grab","cursor-grabbing"),document.body.style.userSelect="none"},c=u=>{if(!s)return;const h=u.clientY-n;let f=r+h;f=Math.max(a,Math.min(o,f)),e.style.height=`${f}px`,t.resize()},d=()=>{s&&(s=!1,i.classList.replace("cursor-grabbing","cursor-grab"),document.body.style.userSelect="")};return i.addEventListener("mousedown",l),window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),{detach:()=>{i.removeEventListener("mousedown",l),window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",d)},refreshUI:()=>{}}}const Wo={sm:"text-base",md:"text-lg",lg:"text-xl",xl:"text-2xl"};function ce(i){const e=T();if(typeof i=="string")return p("h2",{class:["text-lg font-semibold mb-4",e.textColor].join(" "),textContent:i});const{text:t,size:s="md",additionalClasses:n=""}=i;return p("h2",{class:[Wo[s],"font-semibold mb-4",e.textColor,n].join(" "),textContent:t})}function jo(){const i=ce({text:"Delete Track",size:"lg",additionalClasses:"text-center mb-4"}),e=p("p",{class:"mb-6 text-center text-sm",textContent:"Are you sure you want to delete this track?"}),t=R({id:"delete-confirm",text:"Delete",kind:"tertiary",additionalClasses:"flex-1 py-2"}),s=R({id:"delete-cancel",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2"}),n=p("div",{class:"flex gap-3 w-full"},t,s);return Z("delete-confirm-modal",[i,e,n],{sizePreset:"sm"})}function Xo(i,e,t){const s=i.querySelector("#delete-confirm"),n=i.querySelector("#delete-cancel"),r=()=>{e(),i.classList.add("hidden")},a=()=>{t(),i.classList.add("hidden")};return s==null||s.addEventListener("click",r),n==null||n.addEventListener("click",a),{detach:()=>{s==null||s.removeEventListener("click",r),n==null||n.removeEventListener("click",a)},refreshUI:()=>{}}}class Vo{constructor(){this.detachFn=null,this.modal=jo(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const s=Xo(this.modal,e,t);this.detachFn=s.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function ve(i){const{id:e,label:t,stateA:s,stateB:n,tooltipTrigger:r,inline:a}=i,o=T(),l=s?p("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:s}):null,c=p("span",{class:`text-sm transition-opacity ${o.textColor}`,textContent:n}),d=p("input",{id:e,type:"checkbox",class:"sr-only peer"}),u=p("div",{class:["w-11 h-6 rounded-full peer relative",o.toggleTrackBase,o.toggleTrackChecked,'after:content-[""] after:absolute after:top-[2px] after:left-[2px]',"after:bg-white after:border after:rounded-full","after:h-5 after:w-5 after:transition-all",o.toggleKnobBase,o.toggleKnobChecked,"peer-checked:after:translate-x-full"].join(" ")}),h=()=>{const _=d.checked;l&&(l.style.opacity=_?"0.5":"1"),c.style.opacity=_?"1":"0.5"};d.addEventListener("change",h);const f=[];l&&f.push(l),f.push(p("label",{class:"relative inline-flex items-center cursor-pointer"},d,u)),f.push(c),r&&f.push(r);const y=p("div",{class:"flex items-center gap-3"},...f),b=a?y:p("div",{class:"mb-6"},t?p("label",{class:`block text-sm font-medium mb-2 ${o.textColor}`,textContent:t}):null,y);return requestAnimationFrame(h),{element:b,input:d,setChecked:_=>{d.checked=_,h()},getChecked:()=>d.checked,update:h}}function W(i,e){const t=T();if(typeof i=="string")return p("label",{class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},i,e??null);const{text:s,for:n,trailingElement:r}=i;return p("label",{...n?{htmlFor:n}:{},class:`block text-sm font-medium mb-2 flex items-center gap-2 ${t.textColor}`},s,r??null)}function Yo(){const i=T(),e=ce({text:"Select Instrument",size:"xl",additionalClasses:"text-center mb-6 z-10"}),t=(h,f)=>{const y=p("select",{id:h,class:["w-full bg-gray-700 border border-gray-600 rounded px-3 py-2","focus:outline-none focus:border-purple-500 cursor-pointer",i.textColor].join(" ")});return p("div",{class:"mb-4 z-10 w-full"},W({text:f,for:h}),y)},s=t("instrument-engine-select","Engine"),n=t("instrument-library-select","Instrument Library"),r=t("instrument-select","Instrument"),a=ve({id:"instrument-loop-toggle",label:"Loop instrument sound",stateB:"On"}),o=R({id:"instrument-select-confirm",text:"Select",kind:"primary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),l=R({id:"instrument-cancel-btn",text:"Cancel",kind:"secondary",additionalClasses:"flex-1 py-2 text-sm rounded-lg"}),c=p("div",{class:"flex gap-3 z-10 w-full"},o,l),d=[e,s,n,r,a.element,c];return Z("instrument-select-modal",d,{sizePreset:"md"})}function Zo(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s&&e.instrument&&(s.instrument=e.instrument),t}function Qo(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}function el(i,e){return{type:"SET_INSTRUMENT",sequencerId:i,instrument:e}}async function tl(i,e){if(e!=null){const t=ar(e);t?(E(Qo(t.id,i),el(t.id,t.instrumentName)),t.setInstrument(i)):console.warn(`Failed to find sequencer with ID ${e}`)}else try{await oi(i),Wn(i),window.dispatchEvent(new CustomEvent("global-instrument-selected",{detail:{fullName:i}}))}catch(t){console.error("Failed to load global instrument:",i,t)}}function il(){return Object.keys(je)}async function sl(i=Hs){const e=di[i];if(!e)throw new Error(`Engine "${i}" not available`);return await e.getAvailableLibraries()}async function rl(i,e=Hs){const t=di[e];if(!t)throw new Error(`Engine "${e}" not available`);return await t.getAvailableInstruments(i)}function nl(i,e){const t=i.querySelector("#instrument-engine-select"),s=i.querySelector("#instrument-library-select"),n=i.querySelector("#instrument-select"),r=i.querySelector("#instrument-loop-toggle"),a=i.querySelector("#instrument-select-confirm"),o=i.querySelector("#instrument-cancel-btn"),{currentInstrument:l}=e;let c=null,d=null,u=null;if(l){const S=l.split("/");c=S[0]||null,d=S[1]||null,u=S[2]||null}const h=()=>{const S=il();t&&(t.innerHTML="",S.forEach(g=>{const C=document.createElement("option");C.value=g,C.textContent=g,t.appendChild(C)}),c&&S.includes(c)&&(t.value=c))},f=async()=>{if(!t)return;const S=await sl(t.value);s&&(s.innerHTML="",S.forEach(g=>{const C=document.createElement("option");C.value=g,C.textContent=g,s.appendChild(C)}),d&&S.includes(d)?s.value=d:S.length>0&&(s.value=S[0]))},y=async()=>{if(!t||!s)return;const S=await rl(s.value,t.value);n&&(n.innerHTML="",S.forEach(g=>{const C=document.createElement("option");C.value=g,C.textContent=g,n.appendChild(C)}),u&&S.includes(u)&&(n.value=u))},b=async()=>{await f(),await y()},_=()=>{y()},m=async()=>{if(!t||!s||!n||!r)return;const S=`${t.value}/${s.value}/${n.value}`;await tl(S,e.sequencerId),e.hide()},v=()=>{e.hide()};return(async()=>(h(),await f(),await y()))(),t==null||t.addEventListener("change",b),s==null||s.addEventListener("change",_),a==null||a.addEventListener("click",m),o==null||o.addEventListener("click",v),{detach:()=>{t==null||t.removeEventListener("change",b),s==null||s.removeEventListener("change",_),a==null||a.removeEventListener("click",m),o==null||o.removeEventListener("click",v)},refreshUI:async()=>{h(),await f(),await y()}}}class al{constructor(){this.detachFn=null,this.modal=Yo(),document.body.appendChild(this.modal)}show(e,t){var n;(n=this.detachFn)==null||n.call(this);const s=nl(this.modal,{sequencerId:e,currentInstrument:t,hide:()=>this.hide()});this.detachFn=s.detach,this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class ol{constructor(){this.initialize()}initialize(){this.deleteConfirmModal=new Vo,this.instrumentSelectModal=new al}showInstrumentSelectModal(e,t){this.instrumentSelectModal.show(e,t)}showDeleteConfirmModal(e,t){this.deleteConfirmModal.show(e,t)}destroy(){var e,t;(e=this.deleteConfirmModal)==null||e.destroy(),(t=this.instrumentSelectModal)==null||t.destroy()}reload(){this.destroy(),this.initialize()}}let Ft=null;function St(){return Ft||(Ft=new ol),Ft}function ll(i,e){const t=()=>{St().showInstrumentSelectModal(e.id,e.instrumentName)};return i.addEventListener("click",t),{detach:()=>{i.removeEventListener("click",t)},refreshUI:()=>{}}}function dl(i,e){var n;const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.id);if(s&&typeof e.volume=="number"){s.volume=e.volume;const a=D().find(o=>o.id===e.id);a&&(a.volume=e.volume,(n=a.refreshVolumeUI)==null||n.call(a))}return t}function cl(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function ul(i,e){return{type:"SET_VOLUME",id:i,volume:e}}function hl(i,e){const{element:t,fill:s,thumb:n}=i;let r=!1,a=!1,o=!1,l=null;const c=100/127,d=.1;function u(){const m=Math.max(0,Math.min(1,e.volume)),v=t.clientWidth,S=14,g=0,C=v-S,N=m*v,w=Math.max(g,Math.min(C,N-S/2));s.style.width=`${Math.round(m*100)}%`,n.style.left=`${w}px`;const M=Math.round(m/c*100);t.setAttribute("title",`Volume: ${M}%`);const G=m>c;s.classList.toggle("overdrive",G),n.classList.toggle("overdrive",G)}function h(){s.classList.toggle("precise",a),n.classList.toggle("precise",a)}function f(m){const v=t.getBoundingClientRect(),S=m-v.left;let g=Math.max(0,Math.min(1,S/v.width));return!a&&Math.abs(g-c)<d?(g=c,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.volume=g,u(),g}const y=m=>{r=!0,a=m.shiftKey,l=e.volume,h(),f(m.clientX),m.preventDefault()},b=m=>{r&&(a=m.shiftKey,h(),f(m.clientX))},_=m=>{if(!r)return;r=!1;const v=f(m.clientX);l!==null&&v!==l&&E(cl(e.id,v),ul(e.id,l)),l=null,a=!1,o=!1,h(),u()};return t.addEventListener("mousedown",y),window.addEventListener("mousemove",b),window.addEventListener("mouseup",_),{detach:()=>{t.removeEventListener("mousedown",y),window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",_)},refreshUI:u}}function fl(i,e){var n;const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.id);if(s&&typeof e.pan=="number"){s.pan=e.pan;const a=D().find(o=>o.id===e.id);a&&(a.pan=e.pan,(n=a.refreshPanUI)==null||n.call(a))}return t}function pl(i,e){return{type:"SET_PAN",id:i,pan:e}}function ml(i,e){return{type:"SET_PAN",id:i,pan:e}}function yl(i,e){const{element:t,fill:s,thumb:n}=i;let r=!1,a=!1,o=!1,l=null;function c(){const b=Math.max(-1,Math.min(1,e.pan)),_=(b+1)/2,m=t.clientWidth,v=14,S=0,g=m-v,C=_*m,N=Math.max(S,Math.min(g,C-v/2));s.style.width=`${Math.round(_*100)}%`,n.style.left=`${N}px`;const w=Math.round(b*100);t.setAttribute("title",`Pan: ${w}%`)}function d(){s.classList.toggle("precise",a),n.classList.toggle("precise",a)}function u(b){const _=t.getBoundingClientRect(),m=b-_.left;let S=Math.max(0,Math.min(1,m/_.width))*2-1;const g=0;return!a&&Math.abs(S-g)<.05?(S=g,!o&&navigator.vibrate&&navigator.vibrate(10),o=!0):o=!1,e.pan=S,c(),S}const h=b=>{r=!0,a=b.shiftKey,l=e.pan,d(),u(b.clientX),b.preventDefault()},f=b=>{r&&(a=b.shiftKey,d(),u(b.clientX))},y=b=>{if(!r)return;r=!1;const _=u(b.clientX);l!==null&&_!==l&&E(pl(e.id,_),ml(e.id,l)),l=null,a=!1,o=!1,d(),c()};return t.addEventListener("mousedown",h),window.addEventListener("mousemove",f),window.addEventListener("mouseup",y),{detach:()=>{t.removeEventListener("mousedown",h),window.removeEventListener("mousemove",f),window.removeEventListener("mouseup",y)},refreshUI:c}}function _l(i,{onZoomIn:e,onZoomOut:t,onResetZoom:s}){const{zoomInBtn:n,zoomOutBtn:r,zoomResetBtn:a,trailingDivider:o}=i,l=()=>{n.classList.toggle("hidden",!0),r.classList.toggle("hidden",!0),a.classList.toggle("hidden",!0),o.classList.toggle("hidden",!0)};return n.addEventListener("click",e),r.addEventListener("click",t),a.addEventListener("click",s),{detach:()=>{n.removeEventListener("click",e),r.removeEventListener("click",t),a.removeEventListener("click",s)},refreshUI:l}}function gl(i,e,t,s,n){const{muteBtn:r,soloBtn:a,collapseBtn:o,deleteBtn:l}=i,c=()=>{r.classList.toggle("side-button-activated",e.mute),a.classList.toggle("side-button-activated",e.solo)},d=()=>{e.toggleMute(),c()},u=()=>{e.toggleSolo(),c()},h=()=>{s(!n())},f=()=>{St().showDeleteConfirmModal(()=>{E(Ys(e.id,e.instrumentName,e.notes,e.volume,e.pan),Zs(e.id,e.instrumentName,e.notes,e.volume,e.pan)),e.destroy()},()=>{console.log("Delete cancelled")})};return r.addEventListener("click",d),a.addEventListener("click",u),o.addEventListener("click",h),l.addEventListener("click",f),{detach:()=>{r.removeEventListener("click",d),a.removeEventListener("click",u),o.removeEventListener("click",h),l.removeEventListener("click",f)},refreshUI:()=>{c()}}}class bl{constructor(e,t,s){this.id=null,this.zoomUI=null,this._collapsed=!1,this.detachFns=[],this.refreshFns=[],this.id=s??null,this.initializeUI(e,t),this.toggleZoomControls(!0),this.boundReload=this.reload.bind(this)}initializeUI(e,t){const s=Do(),n=Po();this.rootEl=s.element,s.topBarContainer.appendChild(n.element),e.appendChild(this.rootEl);const r=qo(),a=Ko(),o=Ho(),l=zo(),c=Jo();this.collapseBtn=c.collapseBtn,n.leftGroup.appendChild(r.button),n.leftGroup.appendChild(r.label),n.volumeWrapper.appendChild(a.element),n.panWrapper.appendChild(o.element),n.zoomWrapper.appendChild(l.element),n.rightControlsWrapper.appendChild(c.element);const{seq:d}=Oo(this.rootEl,t,this.id);this.body=s,this.zoomUI=l,this.sequencer=d,this.grid=d.matrix;const u=$o(s.gripHandleContainer,s.matrixContainer,this.grid),h=ll(r.button,this.sequencer),f=hl(a,this.sequencer),y=yl(o,this.sequencer),b=_l(l,{onZoomIn:()=>this.grid.zoomIn(),onZoomOut:()=>this.grid.zoomOut(),onResetZoom:()=>this.grid.resetZoom()}),_=gl(c,this.sequencer,s.matrixContainer,m=>this.collapse(m),()=>this.collapsed);this.detachFns=[u.detach,h.detach,f.detach,y.detach,b.detach,_.detach],this.refreshFns=[u.refreshUI,h.refreshUI,f.refreshUI,y.refreshUI,b.refreshUI,_.refreshUI],ut(this.sequencer,t.collapsed),this.refreshUI()}get collapsed(){return this._collapsed}set collapsed(e){this._collapsed=e}collapse(e=!0){return ut(this.sequencer,e,this.collapseBtn),this._collapsed}getMiniContourCanvas(){return this.body.miniContourCanvas}getMatrixContainer(){return this.body.matrixContainer}getElement(){return this.rootEl}refreshUI(){this.refreshFns.forEach(e=>e())}destroy(){this.detachFns.forEach(e=>e()),this.rootEl.remove(),this.sequencer.destroy(),Ea(this.sequencer.id),ae.getInstance().unregisterReloadable(this.boundReload)}reload(){if(this.id===null||this.id===void 0){console.error("[SequencerController] Cannot reload without a valid ID.");return}const e={id:this.sequencer.id,instrument:this.sequencer.instrumentName,notes:structuredClone(this.sequencer.notes),volume:this.sequencer.volume,pan:this.sequencer.pan,collapsed:this._collapsed};this.detachFns.forEach(s=>s()),this.rootEl.remove(),this.sequencer.destroy();const t=document.getElementById("sequencers-container");if(!t){console.error("[SequencerController] Cannot reload - parent container missing.");return}this.initializeUI(t,e)}toggleZoomControls(e){if(!this.zoomUI)return;const{leadingDivider:t,zoomInBtn:s,zoomOutBtn:n,zoomResetBtn:r,trailingDivider:a}=this.zoomUI;t.classList.toggle("hidden",!e),s.classList.toggle("hidden",!e),n.classList.toggle("hidden",!e),r.classList.toggle("hidden",!e),a.classList.toggle("hidden",!e)}toggleGripHandle(e){const t=this.body.gripHandleContainer;t==null||t.classList.toggle("hidden",!e)}}function Qs(i,e){const t=e.id,s=new bl(i,e,t);return Ba(t,s),ae.getInstance().registerReloadable(s.boundReload),s}function vl(i,e){const t=structuredClone(i);if(t.sequencers.push({id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed}),!ar(e.id)){const n={id:e.id,instrument:e.instrument,notes:e.notes??[],volume:e.volume,pan:e.pan,collapsed:e.collapsed},r=document.getElementById("sequencers-container");if(!r)return console.error("Sequencer container not found!"),t;Qs(r,n)}return t}function er(i,e,t,s,n){return{type:"CREATE_SEQUENCER",id:i,instrument:e,volume:t,pan:s,collapsed:n}}function pi(i){return{type:"DELETE_SEQUENCER",id:i}}function Sl(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=new Set(e.notes.map(r=>`${r.pitch}|${r.start}|${r.duration}`));return s.notes=s.notes.filter(r=>{const a=`${r.pitch}|${r.start}|${r.duration}`;return!n.has(a)}),t}function Cl(i,e){const t=structuredClone(i),s=t.sequencers.find(n=>n.id===e.sequencerId);return s?(s.notes.push(...e.notes),t):i}function Nl(i,e){const t=structuredClone(i),s=t.sequencers.find(r=>r.id===e.sequencerId);if(!s)return i;const n=e.notes;for(const r of n){const a=s.notes.find(o=>o.pitch===r.pitch&&o.start===r.start&&o.duration===r.duration);a&&(a.velocity=r.velocity)}return t}function wl(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function Ml(i,e){return{type:"SET_NOTE_VELOCITY",sequencerId:i,notes:structuredClone(e)}}function Ll(i,e){return structuredClone(i)}function mi(i=""){return{type:"CHECKPOINT",label:i}}function tr(i=""){return mi(i)}const xl=Object.freeze(Object.defineProperty({__proto__:null,CHANGE_NOTE_DURATION:Na,CHANGE_SNAP_RESOLUTION:Sa,CHANGE_SONG_KEY:ba,CHANGE_TEMPO:ea,CHECKPOINT:Ll,CREATE_SEQUENCER:vl,CUT_NOTES:Sl,DELETE_NOTES:io,DELETE_SEQUENCER:Fo,MOVE_NOTES:co,PASTE_NOTES:Cl,PLACE_NOTES:to,RESIZE_NOTES:fo,SET_INSTRUMENT:Zo,SET_NOTE_MODIFIER_MODE:Ma,SET_NOTE_VELOCITY:Nl,SET_PAN:fl,SET_TIME_SIGNATURE:ia,SET_TOTAL_MEASURES:ra,SET_VOLUME:dl},Symbol.toStringTag,{value:"Module"}));function yi(i){const e=xl[i.type];if(!e)throw new Error(`Unknown diff type: ${i.type}`);const t=e(O(),i);Tl(t)}const Qt=new Set;function Ct(i){return Qt.add(i),()=>Qt.delete(i)}function Nt(i){for(const e of Qt)e(i)}const he=[];let le=-1;const Gl=100;function kl({forwardDiff:i,reverseDiff:e}){he.splice(le+1),he.push({forwardDiff:i,reverseDiff:e}),le=he.length-1,he.length>Gl&&(he.shift(),le--)}function Bl(){var i;if(le<0)return null;for(let e=le;e>=0;e--){const t=he[e];if(((i=t==null?void 0:t.forwardDiff)==null?void 0:i.type)==="CHECKPOINT")return null;if(t!=null&&t.reverseDiff)return le=e-1,yi(t.reverseDiff),Nt(O()),t.reverseDiff}return null}function El(){if(le>=he.length-1)return null;le++;const i=he[le];return!i||!i.forwardDiff?null:(yi(i.forwardDiff),Nt(O()),i.forwardDiff)}let ht={tempo:120,timeSignature:[4,4],totalMeasures:8,sequencers:[],songKey:"CM",snapResolution:1,noteDuration:1,isTripletMode:!1,isDottedMode:!1};function O(){return ht}function Tl(i){ht=structuredClone(i),Nt(ht)}function E(i,e){yi(i),kl({forwardDiff:i,reverseDiff:e}),Nt(ht)}let ir=500,sr=!1;function se(){return O().totalMeasures*O().timeSignature[0]}function ue(){return 60/(ir/1e3)}function _i(i,e=!0){const t=ue();if(e){E(Cs(i),ta(t));return}const s=P.getInstance();performance.now(),s.getCurrentBeat(),ir=60/i*1e3,s.isActive()&&s.syncAfterTempoChange(t)}function gi(i,e=!0){const t=O().timeSignature[0];if(e){E(Ns(i),sa(t));return}D().forEach(s=>s.updateBeatsPerMeasure())}function bi(i,e=!0){const t=O().totalMeasures;if(e){E(ws(i),na(t));return}}function rr(i,e=!0){const t=O().songKey;e&&E(Ds(i),va(t))}function wt(){return Us()?O().snapResolution:.001}function Ii(i,e=!0){const t=wt();if(e){E(Ps(i),Ca(t));return}}function Il(i,e=!0){const t=O().noteDuration;if(e){E(qs(i),wa(t));return}}function Ai(i,e,t=!0){const s=O(),n=s.isTripletMode,r=s.isDottedMode;if(t){E(Ks(i,e),La(n,r));return}}function dt(){return O().isTripletMode}function Ot(){return O().isDottedMode}function Al(){return O().noteDuration}function vi(){return O().timeSignature[0]}function Si(){return O().totalMeasures}function nr(){return O().songKey}function Rl(i){sr=i}function Fl(){return sr}let rt=null;function Ol(){return P.getInstance()}class P{constructor(e){this.startTime=0,this.startBeat=0,this.isPlaying=!1,this.animationFrameId=null,this.onResumeCallback=null,this.onStopCallback=null,this.tick=()=>{var n;if(!this.isPlaying)return;const t=this.getCurrentBeat(),s=se();if(t>=s)if(Fl())this.seek(0),this.start();else{this.stop(),(n=this.onStopCallback)==null||n.call(this);return}this.animationFrameId=requestAnimationFrame(this.tick)},this.context=z(),this.sequencers=e}static initialize(e){if(rt){console.warn("[PlaybackEngine] Instance already exists. Ignoring re-initialization.");return}rt=new P(e)}static getInstance(){if(!rt)throw new Error("[PlaybackEngine] Instance not initialized. Call initialize() first.");return rt}setOnResumeCallback(e){this.onResumeCallback=e}setOnStopCallback(e){this.onStopCallback=e}getCurrentBeat(){if(!this.isPlaying)return this.startBeat;const e=60/ue();return(this.context.currentTime-this.startTime)/e+this.startBeat}async start(){const e=this.context.currentTime+.1;this.startTime=e,this.startBeat=0,this.isPlaying=!0,await this.scheduleAll(e,this.startBeat),this.context.state==="suspended"&&await this.context.resume(),this.animationFrameId=requestAnimationFrame(this.tick)}async pause(){if(!this.isPlaying)return;const e=this.getCurrentBeat();for(const t of this.sequencers)t.stopScheduledNotes();await this.context.suspend(),this.startBeat=e,this.isPlaying=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}async resume(){var s;if(this.isPlaying)return;await this.context.resume();const t=this.context.currentTime+.05;this.startTime=t,await this.scheduleAll(t,this.startBeat),this.isPlaying=!0,(s=this.onResumeCallback)==null||s.call(this),this.animationFrameId=requestAnimationFrame(this.tick)}stop(){for(const e of this.sequencers)e.stopScheduledNotes();this.isPlaying=!1,this.startBeat=0,this.startTime=0,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}seek(e){this.startBeat=e,this.startTime=this.context.currentTime;const t=this.isPlaying;if(this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null),t){const s=this.context.currentTime+.05;this.startTime=s,this.scheduleAll(s,this.startBeat).then(()=>{this.animationFrameId=requestAnimationFrame(this.tick)}),this.context.state==="suspended"&&this.context.resume(),this.isPlaying=!0}else this.isPlaying=!1}syncAfterTempoChange(e){const t=this.context.currentTime,s=60/e,n=(t-this.startTime)/s+this.startBeat;this.startBeat=n,this.startTime=t}setSequencers(e){this.sequencers=e}addSequencer(e){this.sequencers.includes(e)||this.sequencers.push(e)}removeSequencer(e){this.sequencers=this.sequencers.filter(t=>t!==e)}clearSequencers(){this.stop(),this.sequencers=[]}isActive(){return this.isPlaying}getStartTime(){return this.startTime}getStartBeat(){return this.startBeat}async scheduleAll(e,t){for(const s of this.sequencers)s.shouldPlay?await s.preparePlayback(e,t):s.stopScheduledNotes()}}const Ze=new Map;function Ul(i,e){Ze.set(i,e)}function Dl(i){Ze.delete(i)}function ar(i){return Ze.get(i)}function D(){return Array.from(Ze.values())}function Pl(){Ze.clear()}function ql(){return D().some(i=>i.solo)}function Ri(){const i=P.getInstance();if(!i.isActive())return;const e=i.getStartTime(),t=i.getStartBeat();for(const s of D())s.stopScheduledNotes(),s.shouldPlay&&(s.reschedulePlayback(e,t),s.resumeAnimationsFromCurrentTime(e,t))}function or(){return D()}function Kl(){X("Sequencer Dump",or())}const Hl=Object.freeze(Object.defineProperty({__proto__:null,dumpSequencers:Kl,getSequencers:or},Symbol.toStringTag,{value:"Module"}));function lr(){return O()}function zl(){X("App State Dump",lr())}const Jl=Object.freeze(Object.defineProperty({__proto__:null,dumpState:zl,getAppState:lr},Symbol.toStringTag,{value:"Module"}));function $l(){const i=Object.create(null);return Object.assign(i,Hl,Jl),i}const Wl="SEQUENZIA_DEV";function jl(){if(typeof window>"u")return;localStorage.getItem(Wl)==="true"&&!xt()&&(wi(),console.info("[SEQUENZIA] Dev mode re-enabled from localStorage")),window.toggleDevMode=()=>{const e=!xt();e?wi():Or(),console.info(`[SEQUENZIA] Dev mode ${e?"enabled":"disabled"}`),e?Fi():delete window.DEVTOOLS},xt()&&Fi()}function Fi(){window.DEVTOOLS=$l()}function Xl(){window.addEventListener("contextmenu",i=>i.preventDefault()),window.addEventListener("dragstart",i=>i.preventDefault()),window.addEventListener("selectstart",i=>i.preventDefault()),window.addEventListener("drop",i=>i.preventDefault()),window.addEventListener("dragover",i=>i.preventDefault()),window.addEventListener("keydown",i=>{const e=[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Home","End","PageUp","PageDown"],t=i.metaKey,s=i.ctrlKey;(e.includes(i.key)||(t||s)&&["s","p"].includes(i.key.toLowerCase()))&&i.preventDefault()})}function dr(i,e){const t=i.getContext("2d");if(!t)return;const s=window.devicePixelRatio||1,n=i.width/s,r=i.height/s;t.clearRect(0,0,n,r);const a=se();for(const o of e){const{notes:l,config:c}=o;if(!(l!=null&&l.length))continue;const d=ke[e.indexOf(o)%ke.length];t.fillStyle=d;const u=H(c.noteRange[0]),h=H(c.noteRange[1]);if(u==null||h==null)continue;const f=h-u||1,y=Math.max(2,r/f);for(const b of l){const _=H(b.pitch);if(_==null)continue;const m=b.start/a*n,v=Math.max(1,b.duration/a*n),S=(_-u)/f,g=r-S*r-y/2;t.fillRect(m,g,v,y)}}}function Vl(i,e){dr(i,e)}function cr(){const i=document.getElementById("global-mini-contour");if(!i)return;const e=D();dr(i,e)}function Yl(i,e,t,s=!0){const n=i.getInteractionStore();let r=new Set;if(s){const o=n.getSelectedNotes();r=new Set(o.map(l=>`${l.pitch}:${l.start}:${l.duration}:${l.velocity}`))}if(i.setNotes(structuredClone(e)),i.getNoteManager().rebuildIndex(),s&&r.size>0){const o=i.notes.filter(l=>r.has(`${l.pitch}:${l.start}:${l.duration}:${l.velocity}`));n.setSelectedNotes(o)}const a=P.getInstance();if(a!=null&&a.isActive()){const o=a.getStartTime(),l=a.getStartBeat();t.reschedulePlayback(o,l)}i.requestRedraw()}function Zl(i,e){return i!==void 0&&e!==void 0&&i===e}function Ql(i=O()){var n;_i(i.tempo,!1),gi(i.timeSignature[0],!1),bi(i.totalMeasures,!1);const e=D();for(const r of e)r.updateTotalMeasures();const t=document.getElementById("sequencers-container");if(!t){console.error("resyncFromState: Missing #sequencers-container");return}console.log("State.sequencers length is: ",i.sequencers.length);for(const r of i.sequencers){const a=e.find(o=>Zl(o.id,r.id));if(console.log("Live sequencer ID: and serialized ID: ",a==null?void 0:a.id,r.id),a){a.instrumentName=r.instrument,typeof r.volume=="number"&&(a.volume=r.volume),typeof r.pan=="number"&&(a.pan=r.pan);const o=(n=a.container)==null?void 0:n.querySelector("canvas.mini-contour");o&&bt(o,r.notes,a.config,a.colorIndex),a.matrix&&Yl(a.matrix,r.notes,a,!0)}else{const o={id:r.id,instrument:r.instrument,notes:structuredClone(r.notes),volume:r.volume,pan:r.pan,collapsed:r.collapsed};console.log("No sequencer found, creating one with ID: ",r.id),Qs(t,o)}}document.getElementById("global-mini-contour")&&cr()}const ur="userConfig";function ed(){const i=j();mt(ur,i)}function td(){const i=yt(ur);i&&oe(i)}function id(i,e=[],t="w-[1276px]"){const s=i.id||"bottom-drawer",n=i.ariaLabel||"Bottom drawer",r=i.edgeOffsetClass||"bottom-[60px]",a=i.drawerClassOverride||"",o=t.toString(),l=T(),c=p("div",{id:s,class:["fixed bottom-0 left-1/2 translate-x-[-50%] z-40",o,"overflow-y-auto","rounded-t-lg",l.menuBackground,l.textColor,"transition-transform","translate-y-0","border-t border-gray-200 dark:border-gray-700 pb-[20px]",r,a].join(" "),"aria-labelledby":`${s}-label`,"data-drawer-placement":"bottom","data-drawer-edge":"true","data-drawer-edge-offset":r}),d=p("div",{class:[i.toggleHandleHeightClass,"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700"].join(" ")},p("span",{class:"absolute w-8 h-1 -translate-x-1/2 bg-gray-300 rounded-lg top-3 left-1/2 dark:bg-gray-600"}),p("h5",{id:`${s}-label`,class:"inline-flex items-center text-base text-gray-500 dark:text-gray-400 font-medium"},n));c.appendChild(d),e.forEach(h=>c.appendChild(h));const u=new Ir(c,{placement:"bottom",edge:!0,edgeOffset:r,backdrop:!1,bodyScrolling:!0},{id:s,override:!0});return u.show(),d.addEventListener("click",()=>{u.toggle()}),c}const sd="w-[1260px]",Ut=1100,rd=[{value:"4",label:"𝅝",title:"Whole"},{value:"2",label:"𝅗𝅥",title:"Half"},{value:"1",label:"𝅘𝅥",title:"Quarter"},{value:"0.5",label:"♪",title:"Eighth"},{value:"0.25",label:"♬",title:"Sixteenth"},{value:"0.125",label:"𝅘𝅥𝅰",title:"32nd"}];class nd{constructor(){this.globalPlayheadRow=p("div",{id:"global-playhead-row",class:"w-full mb-2"}),this.globalToolsRow=p("div",{id:"global-tools-row",class:"w-full mb-2"}),this.globalTransportRow=p("div",{id:"global-transport-row",class:"w-full"});const e=id({id:"global-controls-drawer",ariaLabel:" ",edgeOffsetClass:"bottom-[40px]",toggleHandleHeightClass:"py-2"},[this.globalPlayheadRow,this.globalToolsRow,this.globalTransportRow],sd);this.drawer=e;const t=document.getElementById("footer-main");t?t.appendChild(this.drawer):console.warn("footer-main container not found. GlobalControls not injected.")}render(){return this.drawer}destroy(){this.drawer.remove()}getGlobalPlayheadRow(){return this.globalPlayheadRow}getGlobalToolsRow(){return this.globalToolsRow}getGlobalTransportRow(){return this.globalTransportRow}}function nt(i,e,t){const s=window.devicePixelRatio||1;i.width=e*s,i.height=t*s,i.style.width=`${e}px`,i.style.height=`${t}px`;const n=i.getContext("2d");n&&n.scale(s,s)}const ad=de("static/svg/icon-caret-up.svg");function od(){const i=`w-[${Ut}px]`,e="h-[75px]",t=p("div",{class:"relative flex justify-center w-full mt-4"}),s=p("canvas",{id:"global-mini-contour",class:`absolute top-0 left-0 ${i} ${e} z-0`}),n=p("canvas",{id:"global-mini-playhead",class:`absolute top-0 left-0 ${i} ${e} z-10`,style:"cursor: pointer;"}),r=p("div",{class:`relative ${i} ${e} bg-gray-900/80 backdrop-blur-sm shadow-md rounded-xl`},s,n);nt(s,Ut,75),nt(n,Ut,75),new ResizeObserver(()=>{const c=r.getBoundingClientRect(),d=Math.round(c.width),u=Math.round(c.height);nt(s,d,u),nt(n,d,u),cr()}).observe(r);const o=p("img",{id:"global-mini-collapse-icon",src:ad,class:"w-4 h-4",alt:"Expand Mini Contour"}),l=p("button",{id:"global-mini-collapse-btn",class:"absolute right-[calc(50%-600px)] bottom-0 mb-2 p-2 bg-purple-700 text-white text-sm rounded hover:bg-purple-600 transition-colors",style:"cursor: pointer;",title:"Expand Mini Contour"},o);return t.appendChild(r),t.appendChild(l),p("div",{id:"globalControls-miniContour-body",class:"w-full max-w-[1260px] mx-auto"},t)}function Ci(i,e=[],t={}){const s=T(),n=t.id||`popover-${Math.random().toString(36).slice(2,9)}`,r=p("div",{id:n,"data-popover":"",role:"tooltip",class:["absolute z-[9999] inline-block w-64 text-sm transition-opacity duration-300","border rounded-lg shadow-xs opacity-0 invisible",s.menuBackground,s.textColor,s.borderColor,"bg-white dark:bg-gray-800"].join(" ")});if(t.title){const u=p("div",{class:["px-3 py-2 border-b rounded-t-lg","bg-gray-100 dark:bg-gray-700","border-gray-200 dark:border-gray-600"].join(" ")},p("h3",{class:"font-semibold text-gray-900 dark:text-white",textContent:t.title}));r.appendChild(u)}const a=p("div",{class:"px-3 py-2"},...e);r.appendChild(a),document.body.appendChild(r);const o={placement:t.placement||"bottom",triggerType:t.triggerType||"click",offset:t.offset??10,onShow:t.onShow??(()=>{}),onHide:t.onHide??(()=>{}),onToggle:t.onToggle??(()=>{})},l={id:n,override:t.overrideInstance??!0},c=new Ar(r,i,o,l);let d=null;return c.updateOnShow(()=>{var u;d=h=>{(h.key==="Escape"||h.key.length===1)&&c.hide()},document.addEventListener("keydown",d,{once:!0}),(u=o.onShow)==null||u.call(o,c)}),c.updateOnHide(()=>{var u;d&&(document.removeEventListener("keydown",d),d=null),(u=o.onHide)==null||u.call(o,c)}),{trigger:i,content:r,instance:c}}const ld=[{id:"velocity-tool",label:"Velocity Tool",iconName:"icon-cog",hotkey:"V"},{id:"quantize-tool",label:"Quantize Tool",iconName:"icon-cog",hotkey:"Q",disabled:!0},{id:"transpose-tool",label:"Transpose Tool",iconName:"icon-cog",hotkey:"T",disabled:!0},{id:"chordifier",label:"Chordifier",iconName:"icon-adjustments-vertical",hotkey:"Shift+C",disabled:!0},{id:"humanizer",label:"Humanizer",iconName:"icon-adjustments-vertical",hotkey:"Shift+H",disabled:!0}];function dd(){const i=T(),e=p("button",{id:"note-editing-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Tools"},I("icon-chart-bar","Editing"));let t;const s=[p("div",{class:"max-h-72 overflow-y-auto flex flex-col gap-1"},...ld.flatMap((a,o)=>{const l=o===2,c=p("button",{class:["flex items-center justify-between gap-2 px-3 py-2 text-sm rounded text-left transition-colors",a.disabled?"text-gray-500 bg-gray-700/30 cursor-not-allowed opacity-50":"text-white hover:bg-purple-700 cursor-pointer"].join(" "),...a.disabled?{}:{onClick:()=>{const d=new CustomEvent("editor-invoke",{detail:{editorId:a.id},bubbles:!0});e.dispatchEvent(d),requestAnimationFrame(()=>{t==null||t.hide()})}}},p("div",{class:"flex items-center gap-2"},I(a.iconName,a.label),p("span",{textContent:a.label})),a.hotkey?p("span",{class:"text-xs text-gray-400 font-mono",textContent:a.hotkey}):null);return l?[c,p("div",{class:`my-2 border-t ${i.borderColor} mx-2`})]:[c]}))];t=Ci(e,s,{title:"Tools",placement:"bottom",triggerType:"click"}).instance;let r=null;return t.updateOnShow(()=>{r=a=>{(a.key==="Escape"||a.key.length===1)&&(t==null||t.hide())},document.addEventListener("keydown",r,{once:!0})}),t.updateOnHide(()=>{r&&(document.removeEventListener("keydown",r),r=null)}),e}function we(i){const e=T();return p("span",{class:`font-semibold ${e.accentColor} rounded text-xs`,textContent:i})}function $(...i){const e=T();return p("p",{class:`text-sm leading-relaxed ${e.textColor}`},...i)}function xe(i,e="?",t){const s=T(),n=p("span",{"data-tooltip-target":i,tabIndex:-1,class:[`${s.textColor} border border-white/40`,"hover:bg-white/10","font-medium rounded-full text-xs px-2 py-[2px]","pointer-events-auto select-none","cursor-default","focus:outline-none focus:ring-0","aria-hidden"].join(" ")},e),r=Array.isArray(t)?t.map(o=>typeof o=="string"?$(o):o):[typeof t=="string"?$(t):t],a=p("div",{id:i,role:"tooltip",class:["absolute z-10 invisible inline-block max-w-xs px-4 py-3 text-sm",`${s.textColor} transition-opacity duration-300 ${s.surfaceBackground} rounded-lg shadow-xs`,"opacity-0 tooltip"].join(" ")},p("div",{class:"space-y-2"},...r),p("div",{class:"tooltip-arrow","data-popper-arrow":""}));return{trigger:n,tooltip:a}}function cd(){const i=T(),e=p("button",{id:"note-placement-options-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 w-[52px] h-[42px] flex items-center justify-center",title:"Grid Settings",style:"cursor: pointer;"},I("icon-music","Placement")),t=xe("tooltip-grid-guides","?",[$(we("Key Grid Highlighting:")," colors each piano roll row based on the current song key."),$("In-key notes are shown as white rows. Out-of-key notes are shown as black rows.")]),s=ve({id:"toggle-grid-guides",stateA:"Off",stateB:"Transpose Grid to Key",inline:!0,tooltipTrigger:t.trigger});s.input.addEventListener("change",()=>{ma(s.getChecked())});const n=xe("tooltip-snap-to-key","?",[$(we("Snap to Key:")," constrains vertical note placement to notes in the current key."),$("Hold ",we("CTRL")," while placing notes to temporarily allow chromatic input.")]),r=ve({id:"toggle-snap-key",stateA:"Off",stateB:"Snap Notes to Key",inline:!0,tooltipTrigger:n.trigger});r.input.addEventListener("change",()=>{_a(r.getChecked())});const a=xe("tooltip-snap-to-grid","?",[$(we("Snap to Grid:")," constrains horizontal note placement to musical durations."),$("Notes will align to the selected beat value (e.g. quarter, eighth, sixteenth).")]),o=ve({id:"toggle-snap-grid",stateA:"Off",stateB:"Snap Notes to Grid",inline:!0,tooltipTrigger:a.trigger});o.input.addEventListener("change",()=>{ya(o.getChecked())});const l=()=>{s.setChecked(Os()),r.setChecked(_t()),o.setChecked(Us())},c=[p("div",{class:"mb-1"},s.element),t.tooltip,p("div",{class:`my-2 border-t ${i.borderColor} mb-3 mx-2`}),p("div",{class:"mb-1"},r.element),n.tooltip,p("div",{class:"mt-1"},o.element),a.tooltip];return Ci(e,c,{title:"Grid Settings",placement:"bottom",triggerType:"click",onShow:()=>requestAnimationFrame(l)}),{trigger:e,refreshToggles:l}}function ud(){const i=cd();return{element:p("div",{class:"flex flex-wrap justify-center items-center gap-4 p-4"},p("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},p("button",{id:"note-mode-btn",class:"bg-blue-600 px-3 py-1 rounded text-white hover:bg-blue-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"Note Options Toolbar"},I("icon-pen","Note Mode")),p("button",{id:"ai-mode-btn",class:"bg-gray-800 px-3 py-1 rounded text-white hover:bg-purple-700 text-sm font-semibold w-[52px] h-[42px] flex items-center justify-center",style:"cursor: pointer;",title:"AI Options Toolbar"},I("icon-brain-white","AI Mode"))),p("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md cursor-pointer"},i.trigger,dd()),p("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},...rd.map((t,s)=>p("button",{class:["bg-transparent hover:bg-gray-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl","w-[52px] h-[42px] flex items-center justify-center"].join(" "),"data-value":t.value,title:`${t.title} (${s+1} or Shift+${s+1})`},t.label))),p("div",{class:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},p("button",{id:"dotted-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Dotted Note (.)"},"•"),p("button",{id:"triplet-note-btn",class:["bg-transparent hover:bg-purple-700","text-white","cursor-pointer px-3 py-1 rounded text-2xl font-semibold","w-[52px] h-[42px] flex items-center justify-center"].join(" "),title:"Toggle Triplet (/)"},"³"))),refreshGridSettings:i.refreshToggles}}function hd(){const i=p("div",{class:"fixed left-[calc(50%-678px)] bottom-[20px] flex flex-col gap-2 z-[9999]"},p("button",{id:"footer-help-btn",class:"side-button side-button-info",title:"Help / Documentation"},I("icon-lightbulb","Help")),p("button",{id:"footer-whats-new-btn",class:"side-button side-button-info",title:"What's New / Release Notes"},I("icon-circle-plus","What's New")));return document.body.appendChild(i),i}function Oi(){const i=T();return p("div",{class:["h-12 w-px",i.accentColor,"shadow-inner","rounded-full"].join(" ")})}function Ne(i,e,t,s,n){return p("button",{id:i,title:e,class:["w-12 h-12 flex items-center justify-center rounded-full cursor-pointer shadow transition-all hover:scale-110","text-white",s,n].join(" ")},t)}function Dt(i){const{id:e,value:t,min:s,max:n,onInput:r}=i,a=T();return p("input",{id:e,type:"number",value:String(t),min:s==null?void 0:s.toString(),max:n==null?void 0:n.toString(),class:["w-[72px] h-[40px] px-2 rounded text-sm font-semibold",a.surfaceBackground,a.textColor,a.borderColor].join(" "),oninput:r})}function Te(i="4"){return p("div",{class:`inline-block w-${i}`})}function fd(){const i=T();return p("div",{class:["w-full h-px",i.accentColor,"shadow-inner","rounded-full","my-2"].join(" ")})}const pd=["C","D","E","F","G","A","B"],md=["C#","D#","","F#","G#","A#",""];function yd(){return nr()??"CM"}function Pt(i){const e=i.endsWith("m")?"m":"M";return[i.slice(0,i.length-1),e]}function _d(){T();let[i,e]=Pt(yd());const t=R({id:"key-selector-trigger",text:`${i}${e}`,kind:"secondary",additionalClasses:"w-14 px-2 py-[10px] text-center truncate"}),s=(d,u)=>{if(d==="")return;i=d,e=u;const h=`${d}${u}`;rr(h),t.textContent=h,l()},n=p("div",{class:"flex w-full mt-2 gap-[6px]"},...pd.map(d=>p("button",{class:qt(d,i),onClick:()=>s(d,e)},d))),r=p("div",{class:"flex w-full mb-1 gap-[6px] translate-x-[22px]"},...md.map(d=>d===""?p("div",{class:"w-8"}):p("button",{class:qt(d,i),onClick:()=>s(d,e)},d))),a=ve({id:"key-mode-toggle",stateA:"Major",stateB:"Minor",inline:!0});a.setChecked(e==="m"),a.input.addEventListener("change",()=>{const d=a.getChecked()?"m":"M";s(i,d)});const o=[r,n,fd(),a.element],l=()=>{[...n.children,...r.children].forEach(u=>{if(!(u instanceof HTMLButtonElement))return;const h=u.textContent||"";u.className=qt(h,i)}),a.setChecked(e==="m")};return Ci(t,o,{title:"Key Selector",placement:"bottom",triggerType:"click"}),Ct(d=>{const[u,h]=Pt(d.songKey);i=u,e=h,t.textContent=d.songKey,l()}),{trigger:t,refreshUI:()=>{const[d,u]=Pt(nr());i=d,e=u,t.textContent=`${d}${u}`,l()}}}function qt(i,e){return["w-8 h-8 rounded-full text-xs flex items-center justify-center","transition-all duration-150","cursor-pointer focus:outline-none","text-white",i===e?"bg-cyan-600 ring-2 ring-white":"bg-gray-600 hover:bg-gray-500 hover:ring-1 hover:ring-white"].join(" ")}function gd(){const i=ve({id:"loop-toggle",stateB:"Loop",inline:!0}),e=_d();return{element:p("div",{class:"flex justify-center items-center gap-4 flex-wrap"},p("div",{class:"flex items-center gap-2"},Ne("play-button","Play/Pause",I("icon-play","Play"),"bg-blue-600","hover:bg-blue-700"),Ne("stop-button","Stop",I("icon-stop","Stop"),"bg-blue-600","hover:bg-blue-700"),Te("4"),Ne("record-button","Record",I("icon-record","Record"),"bg-red-600","hover:bg-red-700"),Te("4"),i.element,Te("4"),Oi()),p("div",{class:"flex items-center gap-4 px-3 py-2 rounded-xl bg-gray-900/80 backdrop-blur-sm shadow-md"},p("div",{class:"flex flex-col items-start gap-1"},W("Key"),e.trigger),p("div",{class:"flex flex-col items-start gap-1"},W("Tempo"),Dt({id:"tempo-input",min:20,max:300,value:120})),p("div",{class:"flex flex-col items-start gap-1"},W("Measures"),Dt({id:"measures-input",min:1,max:1e3,value:8})),p("div",{class:"flex flex-col items-start gap-1"},W("Beats"),Dt({id:"beats-per-measure-input",min:1,max:16,value:4}))),Oi(),p("div",{class:"flex items-center gap-2"},Te("4"),Ne("save-button","Save",I("icon-save","Save"),"bg-green-600","hover:bg-green-700"),Ne("load-button","Load",I("icon-load","Load"),"bg-yellow-600","hover:bg-yellow-700"),Te("4"),Ne("config-button","User Settings",I("icon-user-settings","Settings"),"bg-purple-600","hover:bg-purple-700"))),refreshToggles:()=>{e.refreshUI()}}}const bd=de("static/svg/icon-caret-up.svg"),vd=de("static/svg/icon-caret-down.svg");function Sd(i){var c;const e=()=>{},t=(c=i.querySelector("#global-mini-contour"))==null?void 0:c.parentElement,s=i.querySelector("#global-mini-collapse-btn"),n=i.querySelector("#global-mini-collapse-icon"),r=300,a=75;let o=!0;const l=()=>{if(!t||!s||!n)return;o=!o,t.style.height=o?`${a}px`:`${r}px`,t.querySelectorAll("canvas").forEach(u=>{u.style.height=o?`${a}px`:`${r}px`}),n.src=o?bd:vd,s.title=o?"Expand Mini Contour":"Collapse Mini Contour"};return s==null||s.addEventListener("click",l),{detach:()=>{s==null||s.removeEventListener("click",l)},refreshUI:e}}const Ui={Digit1:4,Digit2:2,Digit3:1,Digit4:.5,Digit5:.25,Digit6:.125};function Cd(i){const e=i.querySelectorAll("button[data-value]"),t=i.querySelector("#dotted-note-btn"),s=i.querySelector("#triplet-note-btn"),n=i.querySelector("#ai-mode-btn"),r=()=>{const u=wt(),h=Al();e.forEach(f=>{const y=parseFloat(f.dataset.value??"-1");f.classList.remove("bg-purple-700","bg-blue-700","bg-gray-800"),f.classList.add("bg-transparent"),y===h?(f.classList.add("bg-purple-700"),f.classList.remove("bg-transparent")):y===u?(f.classList.add("bg-blue-700"),f.classList.remove("bg-transparent")):f.classList.add("bg-gray-800")})},a=Ct(u=>{r(),t==null||t.classList.toggle("bg-purple-700",u.isDottedMode),t==null||t.classList.toggle("bg-transparent",!u.isDottedMode),s==null||s.classList.toggle("bg-purple-700",u.isTripletMode),s==null||s.classList.toggle("bg-transparent",!u.isTripletMode),o(u.noteDuration,!1)}),o=(u,h=!0)=>{const f=Ot(),y=dt();let b=u;f?b*=1.5:y&&(b*=2/3),Ye.currentDuration=b,D().forEach(m=>{var v;m.config.currentDuration=b,(v=m.matrix)==null||v.requestRedraw()}),Il(u,h)},l=(u=!0)=>{const h=i.querySelector("button[data-value].bg-purple-700");if(h){const f=parseFloat(h.dataset.value);o(f,u)}},c=()=>{r();const u=Ot(),h=dt();t==null||t.classList.toggle("bg-purple-700",u),t==null||t.classList.toggle("bg-transparent",!u),s==null||s.classList.toggle("bg-purple-700",h),s==null||s.classList.toggle("bg-transparent",!h)};e.forEach(u=>{u.classList.add("note-duration-btn"),u.addEventListener("click",h=>{if(h.button===0){const f=parseFloat(u.dataset.value);o(f)}}),u.addEventListener("contextmenu",h=>{h.preventDefault();const f=parseFloat(u.dataset.value);Ii(f,!0)})}),s==null||s.addEventListener("click",()=>{const u=!dt();Ai(u,!1),l(!1)}),t==null||t.addEventListener("click",()=>{const u=!Ot();Ai(!1,u),l(!1)});const d=u=>{const h=u.target;if(!(h.tagName==="INPUT"||h.tagName==="TEXTAREA"||h.isContentEditable||be())){if(Ui.hasOwnProperty(u.code)){u.preventDefault();const f=Ui[u.code];u.shiftKey?Ii(f,!0):o(f);return}if(u.key==="."){u.preventDefault(),t==null||t.click();return}if(u.key==="/"){u.preventDefault(),s==null||s.click();return}}};return window.addEventListener("keydown",d),n==null||n.addEventListener("click",()=>{fe().showFeatureBlocked()}),c(),{detach:()=>{window.removeEventListener("keydown",d),a(),n&&n.replaceWith(n.cloneNode(!0)),e.forEach(f=>{const y=f.cloneNode(!0);f.replaceWith(y)});const u=t==null?void 0:t.cloneNode(!0);u&&(t!=null&&t.parentNode)&&t.parentNode.replaceChild(u,t);const h=s==null?void 0:s.cloneNode(!0);h&&(s!=null&&s.parentNode)&&s.parentNode.replaceChild(h,s)},refreshUI:c}}function Nd(i,e){const t=i.querySelector("#footer-help-btn"),s=i.querySelector("#footer-whats-new-btn"),n=()=>{},r=()=>{window.open("https://github.com/alacrity-ai/sequenzia","_blank")},a=()=>{e.show()};return t==null||t.addEventListener("click",r),s==null||s.addEventListener("click",a),{detach:()=>{t==null||t.removeEventListener("click",r),s==null||s.removeEventListener("click",a)},refreshUI:n}}function wd(i,e,t,s,n){const r=i.querySelector("#play-button"),a=i.querySelector("#stop-button"),o=i.querySelector("#record-button"),l=i.querySelector("#loop-toggle"),c=i.querySelector("#tempo-input"),d=i.querySelector("#measures-input"),u=i.querySelector("#beats-per-measure-input"),h=i.querySelector("#save-button"),f=i.querySelector("#load-button"),y=i.querySelector("#config-button"),b=x=>{if(!r)return;r.classList.toggle("bg-blue-800",x),r.classList.toggle("bg-blue-600",!x);const F=x?"icon-pause":"icon-play",q=de(`static/svg/${F}.svg`),U=r.querySelector("img");if((U==null?void 0:U.getAttribute("src"))!==q){const K=I(F,x?"Pause":"Play");U?r.replaceChild(K,U):r.appendChild(K)}},_=()=>{b(e.isPlaying())};e.setOnStopCallback(()=>{b(!1)});const m=()=>{const x=!e.isPlaying();e.toggle(),b(x)},v=()=>{e.stop(),b(!1)},S=()=>{},g=()=>{const x=c==null?void 0:c.valueAsNumber;x&&x>=20&&x<=300&&_i(x,!0)},C=()=>{const x=d==null?void 0:d.valueAsNumber;x&&x>=1&&x<=1e3&&bi(x,!0)},N=()=>{const x=u==null?void 0:u.valueAsNumber;x&&x>=1&&x<=16&&gi(x,!0)};Ct(x=>{c&&(c.value=String(x.tempo)),d&&(d.value=String(x.totalMeasures)),u&&(u.value=String(x.timeSignature[0]))});const w=()=>{Rl((l==null?void 0:l.checked)??!1)},M=()=>{s.show()},G=()=>{n.show()},k=()=>{t.show()},B=x=>{var U;const F=(U=document.activeElement)==null?void 0:U.tagName,q=F==="INPUT"||F==="TEXTAREA";x.key===" "&&!q&&(x.preventDefault(),x.shiftKey?v():m())};return r==null||r.addEventListener("click",m),a==null||a.addEventListener("click",v),o==null||o.addEventListener("click",S),c==null||c.addEventListener("change",g),d==null||d.addEventListener("change",C),u==null||u.addEventListener("change",N),l==null||l.addEventListener("change",w),h==null||h.addEventListener("click",M),f==null||f.addEventListener("click",G),y==null||y.addEventListener("click",k),window.addEventListener("keydown",B),{detach:()=>{r==null||r.removeEventListener("click",m),a==null||a.removeEventListener("click",v),o==null||o.removeEventListener("click",S),c==null||c.removeEventListener("change",g),d==null||d.removeEventListener("change",C),u==null||u.removeEventListener("change",N),l==null||l.removeEventListener("change",w),h==null||h.removeEventListener("click",M),f==null||f.removeEventListener("click",G),y==null||y.removeEventListener("click",k),window.removeEventListener("keydown",B)},refreshUI:_}}function hr(i,e){var t;for(const s of i.sequencers){const n=s.matrix;if(!n)continue;const r=(t=n.getPixelsPerBeat)==null?void 0:t.call(n);if(!r)continue;const a=e*r;n.setPlayheadPixelX(a)}}let ne=null,Pe=null;function Md(i){Pe=i,ne=Pe.getContext("2d")}function Mt(i){if(!ne||!Pe)return;const e=window.devicePixelRatio||1,t=Pe.width/e,s=Pe.height/e;ne.clearRect(0,0,t,s);const n=Math.round(i)+.5;ne.strokeStyle="#ff00ff",ne.lineWidth=1,ne.beginPath(),ne.moveTo(n,0),ne.lineTo(n,s),ne.stroke()}function Ld(i,e){const t=e.snapResolution||.25,s=e.isTripletMode?t*(2/3):t;return Math.round(i/s)*s}let at=!1,Y=null,Kt=!1;function xd(i){if(Y=i.querySelector("#global-mini-playhead"),!Y)throw new Error("Playhead canvas not found in container.");const e=P.getInstance(),t=(l,c=!0)=>{const d=se(),u=Ld(l,Ye),h=Math.max(0,Math.min(d,u)),f=e.isActive();if(e.seek(h),c&&f&&e.resume(),hr(e,h),Y){const y=window.devicePixelRatio||1,b=Y.width/y,_=h/d*b;Mt(_)}},s=l=>{if(!Y)return;const c=window.devicePixelRatio||1,d=Y.getBoundingClientRect(),u=Y.width/c;let h=(l.clientX-d.left)*(u/d.width);h=Math.max(0,Math.min(u,h));const f=se(),y=h/u*f;t(y,!1)},n=l=>{var f;const c=(f=document.activeElement)==null?void 0:f.tagName;if(c==="INPUT"||c==="TEXTAREA"||!l.shiftKey)return;const d=se(),u=vi();let h=e.getCurrentBeat();switch(l.key.toLowerCase()){case"a":h-=1;break;case"d":h+=1;break;case"s":{const y=Math.floor(h),b=Math.floor(y/u)*u;h=y===b?Math.max(0,b-u):b;break}case"w":{const y=Math.floor(h),_=Math.floor(y/u)*u+u;h=Math.min(d,_);break}default:return}l.preventDefault(),t(h)},r=async l=>{e.isActive()&&(await e.pause(),Kt=!0),at=!0,s(l)},a=l=>{at&&s(l)},o=l=>{at&&(s(l),at=!1,Kt&&(e.resume(),Kt=!1))};return Y.addEventListener("mousedown",l=>void r(l)),window.addEventListener("mousemove",a),window.addEventListener("mouseup",o),window.addEventListener("keydown",n),{detach:()=>{Y==null||Y.removeEventListener("mousedown",r),window.removeEventListener("mousemove",a),window.removeEventListener("mouseup",o),window.removeEventListener("keydown",n)},refreshUI:()=>{}}}function fr(){const i=D();for(const e of i){const t=e.matrix;if(!t)continue;const s=t.getInteractionStore();if(s.hasSelection())return{sequencerId:e.id,selectedNotes:s.getSelectedNotes()}}return null}function Gd(i){const e=()=>{const o=fe(),l=fr();if(!l||l.selectedNotes.length===0){o.showError("No notes selected. Please select notes before adjusting velocity.");return}i.velocity.show(l.selectedNotes)},t=o=>{var u;if(o.key.toLowerCase()!=="v"||o.ctrlKey||o.metaKey||o.altKey)return;const l=(u=document.activeElement)==null?void 0:u.tagName,c=l==="INPUT"||l==="TEXTAREA",d=be();c||d||(o.preventDefault(),e())},s=o=>{o.type==="keydown"&&o.ctrlKey&&!He()&&Gi(!0),o.type==="keyup"&&o.key==="Control"&&He()&&Gi(!1)},n=o=>{t(o),s(o)},r=o=>{s(o)},a=o=>{const{editorId:l}=o.detail;l==="velocity-tool"&&e()};return window.addEventListener("keydown",n),window.addEventListener("keyup",r),document.body.addEventListener("editor-invoke",a),{detach:()=>{window.removeEventListener("keydown",n),window.removeEventListener("keyup",r),document.body.removeEventListener("editor-invoke",a)},refreshUI:()=>{}}}let qe=null;function Di(i,e){const t=se(),s=window.devicePixelRatio||1,n=e/s;function r(){if(!i.isActive())return;const a=i.getCurrentBeat(),o=a/t*n;Mt(o),hr(i,a),qe=requestAnimationFrame(r)}ei(),qe=requestAnimationFrame(r)}function ei(){qe!==null&&(cancelAnimationFrame(qe),qe=null)}function kd(i){var e;Mt(0);for(const t of i.sequencers)(e=t.matrix)==null||e.setPlayheadPixelX(0)}class Bd{constructor(){this.onStop=null,this.engine=P.getInstance(),this.playheadCanvasWidth=300,this.engine.setOnResumeCallback(()=>{Di(this.engine,this.playheadCanvasWidth)}),this.engine.setOnStopCallback(()=>{var e;(e=this.onStop)==null||e.call(this)})}play(){this.engine.start(),Di(this.engine,this.playheadCanvasWidth)}stop(){this.engine.stop(),ei(),kd(this.engine)}setOnStopCallback(e){this.onStop=e}async pause(){await this.engine.pause(),ei()}async resume(){await this.engine.resume()}toggle(){this.engine.isActive()?this.pause():this.resume()}isPlaying(){return this.engine.isActive()}getEngine(){return this.engine}setSequencers(e){this.engine.setSequencers(e)}setPlayheadCanvasWidth(e){this.playheadCanvasWidth=e}}function Ed(){const i=ce("💾 Export"),e=R({id:"export-json",text:"Save Project",kind:"primary"}),t=p("div",{class:"h-px bg-gray-600"}),s=R({id:"export-wav",text:"Export as WAV",kind:"secondary",additionalClasses:"bg-green-600 hover:bg-green-700"}),n=R({id:"export-midi",text:"Export as MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),r=R({id:"export-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),a=p("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,s,n);return Z("export-modal",[i,a,r])}let pr=0;function Td(i,e){const t=pr++,s={id:t,...Ye},n=e.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",r=new Vs(null,s,i,i.destination,n,!0,t);return r.id=t,r.colorIndex=t,r.mute=!1,r.solo=!1,r.volume=e.volume??100/127,r.pan=e.pan??0,e.notes&&r.matrix&&r.matrix.setNotes(e.notes),r.setState({notes:e.notes,config:e.config||{},instrument:e.instrument,volume:e.volume,pan:e.pan}),r.initInstrument(),r}function Id(){pr=0}function Ad(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=i.tempo,t=i.timeSignature[0],s=i.totalMeasures,n=i.songKey,r={v:3,t:new Date().toISOString(),c:{b:e,bpm:t,tm:s,sk:n},i:i.sequencers.map(o=>o.instrument||"sf2/fluidr3-gm/acoustic_grand_piano"),vlm:i.sequencers.map(o=>o.volume??100/127),pan:i.sequencers.map(o=>o.pan??0),tr:i.sequencers.map(o=>({n:o.notes.map(l=>[l.pitch,l.start,l.duration,l.velocity??100])}))},a=new Blob([JSON.stringify(r)],{type:"application/json"});return{url:URL.createObjectURL(a),filename:`session-${Date.now()}.json`}}async function Rd(i,e={sampleRate:44100,includePan:!0}){if(!i.tracks||i.tracks.length===0)throw new Error("No tracks to export.");const t=e.sampleRate,s=e.includePan?2:1,n=new AbortController;let r=!1;Ue("Exporting Session","Rendering your session offline...",()=>{r=!0,n.abort()},!0);try{const o=60/ue(),l=Math.max(...i.tracks.flatMap(y=>y.notes.map(b=>(b.start+b.duration)*o+.2))),c=new OfflineAudioContext(s,Math.ceil(t*l),t);Id();for(const y of i.tracks)if(r||(await Td(c,y).exportToOffline(n.signal,y.notes),r))return;if(r)return;Ue("Rendering Audio","Rendering audio buffer…",void 0,!0);const d=await c.startRendering();Ue("Converting to WAV","Converting to WAV format…",void 0,!0);const u=Fd(d);Ue("Downloading WAV","Please wait...",void 0,!0);const h=URL.createObjectURL(u),f=document.createElement("a");f.href=h,f.download=`session-${Date.now()}.wav`,f.click(),URL.revokeObjectURL(h)}catch(a){r?console.warn("Export operation was cancelled by the user."):console.error("Error during export:",a)}finally{si(!0)}}function Fd(i){const e=i.numberOfChannels,t=i.length*e*2,s=new DataView(new ArrayBuffer(44+t)),n=(a,o)=>{for(let l=0;l<o.length;l++)s.setUint8(a+l,o.charCodeAt(l))};n(0,"RIFF"),s.setUint32(4,36+t,!0),n(8,"WAVE"),n(12,"fmt "),s.setUint32(16,16,!0),s.setUint16(20,1,!0),s.setUint16(22,e,!0),s.setUint32(24,i.sampleRate,!0),s.setUint32(28,i.sampleRate*e*2,!0),s.setUint16(32,e*2,!0),s.setUint16(34,16,!0),n(36,"data"),s.setUint32(40,t,!0);let r=44;for(let a=0;a<i.length;a++)for(let o=0;o<e;o++){const l=i.getChannelData(o)[a],c=Math.max(-1,Math.min(1,l));s.setInt16(r,c*32767,!0),r+=2}return new Blob([s.buffer],{type:"audio/wav"})}async function Od(i){var l,c,d,u;const e=await i.text();let t;try{t=JSON.parse(e)}catch{throw new Error("Invalid JSON format.")}if(!Array.isArray(t.tr))throw new Error("Missing or invalid `tr` (tracks) array.");const s={bpm:((l=t.c)==null?void 0:l.b)??120,beatsPerMeasure:((c=t.c)==null?void 0:c.bpm)??4,totalMeasures:((d=t.c)==null?void 0:d.tm)??8,songKey:((u=t.c)==null?void 0:u.sk)??"CM"},n=Array.isArray(t.i)?t.i:[],r=Array.isArray(t.vlm)?t.vlm:[],a=Array.isArray(t.pan)?t.pan:[],o=t.tr.map((h,f)=>{if(!Array.isArray(h.n))throw new Error(`Track ${f} missing \`n\` (notes) array.`);const y=h.n.map(([v,S,g,C])=>({pitch:v,start:S,duration:g,velocity:C??100})),b=n[f]||"sf2/fluidr3-gm/acoustic_grand_piano",_=r[f],m=a[f];return{notes:y,instrument:b,volume:typeof _=="number"?_:void 0,pan:typeof m=="number"?m:void 0,config:{}}});return{globalConfig:s,tracks:o}}function Ud(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var n=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(t,s,n.get?n:{enumerable:!0,get:function(){return i[s]}})}),t}var me={},ot={},Ht,Pi;function Dd(){if(Pi)return Ht;Pi=1;function i(n){var r=new s(n),a=r.readChunk();if(a.id!="MThd")throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var o=e(a.data),l=[],c=0;!r.eof()&&c<o.numTracks;c++){var d=r.readChunk();if(d.id!="MTrk")throw"Bad MIDI file.  Expected 'MTrk', got: '"+d.id+"'";var u=t(d.data);l.push(u)}return{header:o,tracks:l}}function e(n){var r=new s(n),a=r.readUInt16(),o=r.readUInt16(),l={format:a,numTracks:o},c=r.readUInt16();return c&32768?(l.framesPerSecond=256-(c>>8),l.ticksPerFrame=c&255):l.ticksPerBeat=c,l}function t(n){for(var r=new s(n),a=[];!r.eof();){var o=c();a.push(o)}return a;var l;function c(){var d={};d.deltaTime=r.readVarInt();var u=r.readUInt8();if((u&240)===240)if(u===255){d.meta=!0;var h=r.readUInt8(),f=r.readVarInt();switch(h){case 0:if(d.type="sequenceNumber",f!==2)throw"Expected length for sequenceNumber event is 2, got "+f;return d.number=r.readUInt16(),d;case 1:return d.type="text",d.text=r.readString(f),d;case 2:return d.type="copyrightNotice",d.text=r.readString(f),d;case 3:return d.type="trackName",d.text=r.readString(f),d;case 4:return d.type="instrumentName",d.text=r.readString(f),d;case 5:return d.type="lyrics",d.text=r.readString(f),d;case 6:return d.type="marker",d.text=r.readString(f),d;case 7:return d.type="cuePoint",d.text=r.readString(f),d;case 32:if(d.type="channelPrefix",f!=1)throw"Expected length for channelPrefix event is 1, got "+f;return d.channel=r.readUInt8(),d;case 33:if(d.type="portPrefix",f!=1)throw"Expected length for portPrefix event is 1, got "+f;return d.port=r.readUInt8(),d;case 47:if(d.type="endOfTrack",f!=0)throw"Expected length for endOfTrack event is 0, got "+f;return d;case 81:if(d.type="setTempo",f!=3)throw"Expected length for setTempo event is 3, got "+f;return d.microsecondsPerBeat=r.readUInt24(),d;case 84:if(d.type="smpteOffset",f!=5)throw"Expected length for smpteOffset event is 5, got "+f;var y=r.readUInt8(),b={0:24,32:25,64:29,96:30};return d.frameRate=b[y&96],d.hour=y&31,d.min=r.readUInt8(),d.sec=r.readUInt8(),d.frame=r.readUInt8(),d.subFrame=r.readUInt8(),d;case 88:if(d.type="timeSignature",f!=2&&f!=4)throw"Expected length for timeSignature event is 4 or 2, got "+f;return d.numerator=r.readUInt8(),d.denominator=1<<r.readUInt8(),f===4?(d.metronome=r.readUInt8(),d.thirtyseconds=r.readUInt8()):(d.metronome=36,d.thirtyseconds=8),d;case 89:if(d.type="keySignature",f!=2)throw"Expected length for keySignature event is 2, got "+f;return d.key=r.readInt8(),d.scale=r.readUInt8(),d;case 127:return d.type="sequencerSpecific",d.data=r.readBytes(f),d;default:return d.type="unknownMeta",d.data=r.readBytes(f),d.metatypeByte=h,d}}else if(u==240){d.type="sysEx";var f=r.readVarInt();return d.data=r.readBytes(f),d}else if(u==247){d.type="endSysEx";var f=r.readVarInt();return d.data=r.readBytes(f),d}else throw"Unrecognised MIDI event type byte: "+u;else{var _;if((u&128)===0){if(l===null)throw"Running status byte encountered before status byte";_=u,u=l,d.running=!0}else _=r.readUInt8(),l=u;var m=u>>4;switch(d.channel=u&15,m){case 8:return d.type="noteOff",d.noteNumber=_,d.velocity=r.readUInt8(),d;case 9:var v=r.readUInt8();return d.type=v===0?"noteOff":"noteOn",d.noteNumber=_,d.velocity=v,v===0&&(d.byte9=!0),d;case 10:return d.type="noteAftertouch",d.noteNumber=_,d.amount=r.readUInt8(),d;case 11:return d.type="controller",d.controllerType=_,d.value=r.readUInt8(),d;case 12:return d.type="programChange",d.programNumber=_,d;case 13:return d.type="channelAftertouch",d.amount=_,d;case 14:return d.type="pitchBend",d.value=_+(r.readUInt8()<<7)-8192,d;default:throw"Unrecognised MIDI event type: "+m}}}}function s(n){this.buffer=n,this.bufferLen=this.buffer.length,this.pos=0}return s.prototype.eof=function(){return this.pos>=this.bufferLen},s.prototype.readUInt8=function(){var n=this.buffer[this.pos];return this.pos+=1,n},s.prototype.readInt8=function(){var n=this.readUInt8();return n&128?n-256:n},s.prototype.readUInt16=function(){var n=this.readUInt8(),r=this.readUInt8();return(n<<8)+r},s.prototype.readInt16=function(){var n=this.readUInt16();return n&32768?n-65536:n},s.prototype.readUInt24=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8();return(n<<16)+(r<<8)+a},s.prototype.readInt24=function(){var n=this.readUInt24();return n&8388608?n-16777216:n},s.prototype.readUInt32=function(){var n=this.readUInt8(),r=this.readUInt8(),a=this.readUInt8(),o=this.readUInt8();return(n<<24)+(r<<16)+(a<<8)+o},s.prototype.readBytes=function(n){var r=this.buffer.slice(this.pos,this.pos+n);return this.pos+=n,r},s.prototype.readString=function(n){var r=this.readBytes(n);return String.fromCharCode.apply(null,r)},s.prototype.readVarInt=function(){for(var n=0;!this.eof();){var r=this.readUInt8();if(r&128)n+=r&127,n<<=7;else return n+r}return n},s.prototype.readChunk=function(){var n=this.readString(4),r=this.readUInt32(),a=this.readBytes(r);return{id:n,length:r,data:a}},Ht=i,Ht}var zt,qi;function Pd(){if(qi)return zt;qi=1;function i(r,a){if(typeof r!="object")throw"Invalid MIDI data";a=a||{};var o=r.header||{},l=r.tracks||[],c,d=l.length,u=new n;for(e(u,o,d),c=0;c<d;c++)t(u,l[c],a);return u.buffer}function e(r,a,o){var l=a.format==null?1:a.format,c=128;a.timeDivision?c=a.timeDivision:a.ticksPerFrame&&a.framesPerSecond?c=-(a.framesPerSecond&255)<<8|a.ticksPerFrame&255:a.ticksPerBeat&&(c=a.ticksPerBeat&32767);var d=new n;d.writeUInt16(l),d.writeUInt16(o),d.writeUInt16(c),r.writeChunk("MThd",d.buffer)}function t(r,a,o){var l=new n,c,d=a.length,u=null;for(c=0;c<d;c++)(o.running===!1||!o.running&&!a[c].running)&&(u=null),u=s(l,a[c],u,o.useByte9ForNoteOff);r.writeChunk("MTrk",l.buffer)}function s(r,a,o,l){var c=a.type,d=a.deltaTime,u=a.text||"",h=a.data||[],f=null;switch(r.writeVarInt(d),c){case"sequenceNumber":r.writeUInt8(255),r.writeUInt8(0),r.writeVarInt(2),r.writeUInt16(a.number);break;case"text":r.writeUInt8(255),r.writeUInt8(1),r.writeVarInt(u.length),r.writeString(u);break;case"copyrightNotice":r.writeUInt8(255),r.writeUInt8(2),r.writeVarInt(u.length),r.writeString(u);break;case"trackName":r.writeUInt8(255),r.writeUInt8(3),r.writeVarInt(u.length),r.writeString(u);break;case"instrumentName":r.writeUInt8(255),r.writeUInt8(4),r.writeVarInt(u.length),r.writeString(u);break;case"lyrics":r.writeUInt8(255),r.writeUInt8(5),r.writeVarInt(u.length),r.writeString(u);break;case"marker":r.writeUInt8(255),r.writeUInt8(6),r.writeVarInt(u.length),r.writeString(u);break;case"cuePoint":r.writeUInt8(255),r.writeUInt8(7),r.writeVarInt(u.length),r.writeString(u);break;case"channelPrefix":r.writeUInt8(255),r.writeUInt8(32),r.writeVarInt(1),r.writeUInt8(a.channel);break;case"portPrefix":r.writeUInt8(255),r.writeUInt8(33),r.writeVarInt(1),r.writeUInt8(a.port);break;case"endOfTrack":r.writeUInt8(255),r.writeUInt8(47),r.writeVarInt(0);break;case"setTempo":r.writeUInt8(255),r.writeUInt8(81),r.writeVarInt(3),r.writeUInt24(a.microsecondsPerBeat);break;case"smpteOffset":r.writeUInt8(255),r.writeUInt8(84),r.writeVarInt(5);var y={24:0,25:32,29:64,30:96},b=a.hour&31|y[a.frameRate];r.writeUInt8(b),r.writeUInt8(a.min),r.writeUInt8(a.sec),r.writeUInt8(a.frame),r.writeUInt8(a.subFrame);break;case"timeSignature":r.writeUInt8(255),r.writeUInt8(88),r.writeVarInt(4),r.writeUInt8(a.numerator);var _=Math.floor(Math.log(a.denominator)/Math.LN2)&255;r.writeUInt8(_),r.writeUInt8(a.metronome),r.writeUInt8(a.thirtyseconds||8);break;case"keySignature":r.writeUInt8(255),r.writeUInt8(89),r.writeVarInt(2),r.writeInt8(a.key),r.writeUInt8(a.scale);break;case"sequencerSpecific":r.writeUInt8(255),r.writeUInt8(127),r.writeVarInt(h.length),r.writeBytes(h);break;case"unknownMeta":a.metatypeByte!=null&&(r.writeUInt8(255),r.writeUInt8(a.metatypeByte),r.writeVarInt(h.length),r.writeBytes(h));break;case"sysEx":r.writeUInt8(240),r.writeVarInt(h.length),r.writeBytes(h);break;case"endSysEx":r.writeUInt8(247),r.writeVarInt(h.length),r.writeBytes(h);break;case"noteOff":var m=l!==!1&&a.byte9||l&&a.velocity==0?144:128;f=m|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteOn":f=144|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.velocity);break;case"noteAftertouch":f=160|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.noteNumber),r.writeUInt8(a.amount);break;case"controller":f=176|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.controllerType),r.writeUInt8(a.value);break;case"programChange":f=192|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.programNumber);break;case"channelAftertouch":f=208|a.channel,f!==o&&r.writeUInt8(f),r.writeUInt8(a.amount);break;case"pitchBend":f=224|a.channel,f!==o&&r.writeUInt8(f);var v=8192+a.value,S=v&127,g=v>>7&127;r.writeUInt8(S),r.writeUInt8(g);break;default:throw"Unrecognized event type: "+c}return f}function n(){this.buffer=[]}return n.prototype.writeUInt8=function(r){this.buffer.push(r&255)},n.prototype.writeInt8=n.prototype.writeUInt8,n.prototype.writeUInt16=function(r){var a=r>>8&255,o=r&255;this.writeUInt8(a),this.writeUInt8(o)},n.prototype.writeInt16=n.prototype.writeUInt16,n.prototype.writeUInt24=function(r){var a=r>>16&255,o=r>>8&255,l=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(l)},n.prototype.writeInt24=n.prototype.writeUInt24,n.prototype.writeUInt32=function(r){var a=r>>24&255,o=r>>16&255,l=r>>8&255,c=r&255;this.writeUInt8(a),this.writeUInt8(o),this.writeUInt8(l),this.writeUInt8(c)},n.prototype.writeInt32=n.prototype.writeUInt32,n.prototype.writeBytes=function(r){this.buffer=this.buffer.concat(Array.prototype.slice.call(r,0))},n.prototype.writeString=function(r){var a,o=r.length,l=[];for(a=0;a<o;a++)l.push(r.codePointAt(a));this.writeBytes(l)},n.prototype.writeVarInt=function(r){if(r<0)throw"Cannot write negative variable-length integer";if(r<=127)this.writeUInt8(r);else{var a=r,o=[];for(o.push(a&127),a>>=7;a;){var l=a&127|128;o.push(l),a>>=7}this.writeBytes(o.reverse())}},n.prototype.writeChunk=function(r,a){this.writeString(r),this.writeUInt32(a.length),this.writeBytes(a)},zt=i,zt}var Ki;function mr(){return Ki||(Ki=1,ot.parseMidi=Dd(),ot.writeMidi=Pd()),ot}var Jt={},ye={},Hi;function yr(){if(Hi)return ye;Hi=1,Object.defineProperty(ye,"__esModule",{value:!0}),ye.insert=ye.search=void 0;function i(t,s,n){n===void 0&&(n="ticks");var r=0,a=t.length,o=a;if(a>0&&t[a-1][n]<=s)return a-1;for(;r<o;){var l=Math.floor(r+(o-r)/2),c=t[l],d=t[l+1];if(c[n]===s){for(var u=l;u<t.length;u++){var h=t[u];h[n]===s&&(l=u)}return l}else{if(c[n]<s&&d[n]>s)return l;c[n]>s?o=l:c[n]<s&&(r=l+1)}}return-1}ye.search=i;function e(t,s,n){if(n===void 0&&(n="ticks"),t.length){var r=i(t,s[n],n);t.splice(r+1,0,s)}else t.push(s)}return ye.insert=e,ye}var zi;function ti(){return zi||(zi=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.keySignatureKeys=void 0;var e=yr(),t=new WeakMap;i.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var s=function(){function n(r){var a=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",t.set(this,480),r){t.set(this,r.header.ticksPerBeat),r.tracks.forEach(function(l){l.forEach(function(c){c.meta&&(c.type==="timeSignature"?a.timeSignatures.push({ticks:c.absoluteTime,timeSignature:[c.numerator,c.denominator]}):c.type==="setTempo"?a.tempos.push({bpm:6e7/c.microsecondsPerBeat,ticks:c.absoluteTime}):c.type==="keySignature"&&a.keySignatures.push({key:i.keySignatureKeys[c.key+7],scale:c.scale===0?"major":"minor",ticks:c.absoluteTime}))})});var o=0;r.tracks[0].forEach(function(l){o+=l.deltaTime,l.meta&&(l.type==="trackName"?a.name=l.text:(l.type==="text"||l.type==="cuePoint"||l.type==="marker"||l.type==="lyrics")&&a.meta.push({text:l.text,ticks:o,type:l.type}))}),this.update()}}return n.prototype.update=function(){var r=this,a=0,o=0;this.tempos.sort(function(l,c){return l.ticks-c.ticks}),this.tempos.forEach(function(l,c){var d=c>0?r.tempos[c-1].bpm:r.tempos[0].bpm,u=l.ticks/r.ppq-o,h=60/d*u;l.time=h+a,a=l.time,o+=u}),this.timeSignatures.sort(function(l,c){return l.ticks-c.ticks}),this.timeSignatures.forEach(function(l,c){var d=c>0?r.timeSignatures[c-1]:r.timeSignatures[0],u=(l.ticks-d.ticks)/r.ppq,h=u/d.timeSignature[0]/(d.timeSignature[1]/4);d.measures=d.measures||0,l.measures=h+d.measures})},n.prototype.ticksToSeconds=function(r){var a=(0,e.search)(this.tempos,r);if(a!==-1){var o=this.tempos[a],l=o.time,c=(r-o.ticks)/this.ppq;return l+60/o.bpm*c}else{var d=r/this.ppq;return 60/120*d}},n.prototype.ticksToMeasures=function(r){var a=(0,e.search)(this.timeSignatures,r);if(a!==-1){var o=this.timeSignatures[a],l=(r-o.ticks)/this.ppq;return o.measures+l/(o.timeSignature[0]/o.timeSignature[1])/4}else return r/this.ppq/4},Object.defineProperty(n.prototype,"ppq",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),n.prototype.secondsToTicks=function(r){var a=(0,e.search)(this.tempos,r,"time");if(a!==-1){var o=this.tempos[a],l=o.time,c=r-l,d=c/(60/o.bpm);return Math.round(o.ticks+d*this.ppq)}else{var u=r/.5;return Math.round(u*this.ppq)}},n.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map(function(r){return{bpm:r.bpm,ticks:r.ticks}}),timeSignatures:this.timeSignatures}},n.prototype.fromJSON=function(r){this.name=r.name,this.tempos=r.tempos.map(function(a){return Object.assign({},a)}),this.timeSignatures=r.timeSignatures.map(function(a){return Object.assign({},a)}),this.keySignatures=r.keySignatures.map(function(a){return Object.assign({},a)}),this.meta=r.meta.map(function(a){return Object.assign({},a)}),t.set(this,r.ppq),this.update()},n.prototype.setTempo=function(r){this.tempos=[{bpm:r,ticks:0}],this.update()},n}();i.Header=s}(Jt)),Jt}var Ie={},$t={},Ji;function _r(){return Ji||(Ji=1,function(i){Object.defineProperty(i,"__esModule",{value:!0}),i.ControlChange=i.controlChangeIds=i.controlChangeNames=void 0,i.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},i.controlChangeIds=Object.keys(i.controlChangeNames).reduce(function(n,r){return n[i.controlChangeNames[r]]=r,n},{});var e=new WeakMap,t=new WeakMap,s=function(){function n(r,a){e.set(this,a),t.set(this,r.controllerType),this.ticks=r.absoluteTime,this.value=r.value}return Object.defineProperty(n.prototype,"number",{get:function(){return t.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return i.controlChangeNames[this.number]?i.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"time",{get:function(){var r=e.get(this);return r.ticksToSeconds(this.ticks)},set:function(r){var a=e.get(this);this.ticks=a.secondsToTicks(r)},enumerable:!1,configurable:!0}),n.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},n}();i.ControlChange=s}($t)),$t}var Ae={},$i;function qd(){if($i)return Ae;$i=1,Object.defineProperty(Ae,"__esModule",{value:!0}),Ae.createControlChanges=void 0;var i=_r();function e(){return new Proxy({},{get:function(t,s){if(t[s])return t[s];if(i.controlChangeIds.hasOwnProperty(s))return t[i.controlChangeIds[s]]},set:function(t,s,n){return i.controlChangeIds.hasOwnProperty(s)?t[i.controlChangeIds[s]]=n:t[s]=n,!0}})}return Ae.createControlChanges=e,Ae}var Re={},Wi;function Kd(){if(Wi)return Re;Wi=1,Object.defineProperty(Re,"__esModule",{value:!0}),Re.PitchBend=void 0;var i=new WeakMap,e=function(){function t(s,n){i.set(this,n),this.ticks=s.absoluteTime,this.value=s.value}return Object.defineProperty(t.prototype,"time",{get:function(){var s=i.get(this);return s.ticksToSeconds(this.ticks)},set:function(s){var n=i.get(this);this.ticks=n.secondsToTicks(s)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();return Re.PitchBend=e,Re}var Fe={},re={},ji;function Hd(){return ji||(ji=1,Object.defineProperty(re,"__esModule",{value:!0}),re.DrumKitByPatchID=re.InstrumentFamilyByID=re.instrumentByPatchID=void 0,re.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],re.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],re.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}),re}var Xi;function zd(){if(Xi)return Fe;Xi=1,Object.defineProperty(Fe,"__esModule",{value:!0}),Fe.Instrument=void 0;var i=Hd(),e=new WeakMap,t=function(){function s(n,r){if(this.number=0,e.set(this,r),this.number=0,n){var a=n.find(function(o){return o.type==="programChange"});a&&(this.number=a.programNumber)}}return Object.defineProperty(s.prototype,"name",{get:function(){return this.percussion?i.DrumKitByPatchID[this.number]:i.instrumentByPatchID[this.number]},set:function(n){var r=i.instrumentByPatchID.indexOf(n);r!==-1&&(this.number=r)},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"family",{get:function(){return this.percussion?"drums":i.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"percussion",{get:function(){var n=e.get(this);return n.channel===9},enumerable:!1,configurable:!0}),s.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},s.prototype.fromJSON=function(n){this.number=n.number},s}();return Fe.Instrument=t,Fe}var Oe={},Vi;function Jd(){if(Vi)return Oe;Vi=1,Object.defineProperty(Oe,"__esModule",{value:!0}),Oe.Note=void 0;function i(a){var o=Math.floor(a/12)-1;return e(a)+o.toString()}function e(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],l=a%12;return o[l]}function t(a){var o=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return o.indexOf(a)}var s=function(){var a=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,o={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(l){var c=a.exec(l),d=c[1],u=c[2],h=o[d.toLowerCase()];return h+(parseInt(u,10)+1)*12}}(),n=new WeakMap,r=function(){function a(o,l,c){n.set(this,c),this.midi=o.midi,this.velocity=o.velocity,this.noteOffVelocity=l.velocity,this.ticks=o.ticks,this.durationTicks=l.ticks-o.ticks}return Object.defineProperty(a.prototype,"name",{get:function(){return i(this.midi)},set:function(o){this.midi=s(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(o){var l=o-this.octave;this.midi+=l*12},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"pitch",{get:function(){return e(this.midi)},set:function(o){this.midi=12*(this.octave+1)+t(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"duration",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks+this.durationTicks)-o.ticksToSeconds(this.ticks)},set:function(o){var l=n.get(this),c=l.secondsToTicks(this.time+o);this.durationTicks=c-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"time",{get:function(){var o=n.get(this);return o.ticksToSeconds(this.ticks)},set:function(o){var l=n.get(this);this.ticks=l.secondsToTicks(o)},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"bars",{get:function(){var o=n.get(this);return o.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),a.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},a}();return Oe.Note=r,Oe}var Yi;function Zi(){if(Yi)return Ie;Yi=1,Object.defineProperty(Ie,"__esModule",{value:!0}),Ie.Track=void 0;var i=yr(),e=_r(),t=qd(),s=Kd(),n=zd(),r=Jd(),a=new WeakMap,o=function(){function l(c,d){var u=this;if(this.name="",this.notes=[],this.controlChanges=(0,t.createControlChanges)(),this.pitchBends=[],a.set(this,d),c){var h=c.find(function(g){return g.type==="trackName"});this.name=h?h.text:""}if(this.instrument=new n.Instrument(c,this),this.channel=0,c){for(var f=c.filter(function(g){return g.type==="noteOn"}),y=c.filter(function(g){return g.type==="noteOff"}),b=function(){var g=f.shift();_.channel=g.channel;var C=y.findIndex(function(w){return w.noteNumber===g.noteNumber&&w.absoluteTime>=g.absoluteTime});if(C!==-1){var N=y.splice(C,1)[0];_.addNote({durationTicks:N.absoluteTime-g.absoluteTime,midi:g.noteNumber,noteOffVelocity:N.velocity/127,ticks:g.absoluteTime,velocity:g.velocity/127})}},_=this;f.length;)b();var m=c.filter(function(g){return g.type==="controller"});m.forEach(function(g){u.addCC({number:g.controllerType,ticks:g.absoluteTime,value:g.value/127})});var v=c.filter(function(g){return g.type==="pitchBend"});v.forEach(function(g){u.addPitchBend({ticks:g.absoluteTime,value:g.value/Math.pow(2,13)})});var S=c.find(function(g){return g.type==="endOfTrack"});this.endOfTrackTicks=S!==void 0?S.absoluteTime:void 0}}return l.prototype.addNote=function(c){var d=a.get(this),u=new r.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},d);return Object.assign(u,c),(0,i.insert)(this.notes,u,"ticks"),this},l.prototype.addCC=function(c){var d=a.get(this),u=new e.ControlChange({controllerType:c.number},d);return delete c.number,Object.assign(u,c),Array.isArray(this.controlChanges[u.number])||(this.controlChanges[u.number]=[]),(0,i.insert)(this.controlChanges[u.number],u,"ticks"),this},l.prototype.addPitchBend=function(c){var d=a.get(this),u=new s.PitchBend({},d);return Object.assign(u,c),(0,i.insert)(this.pitchBends,u,"ticks"),this},Object.defineProperty(l.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var c=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,d=0;d<this.notes.length-1;d++){var u=this.notes[d].time+this.notes[d].duration;c<u&&(c=u)}return c},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var c=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,d=0;d<this.notes.length-1;d++){var u=this.notes[d].ticks+this.notes[d].durationTicks;c<u&&(c=u)}return c},enumerable:!1,configurable:!0}),l.prototype.fromJSON=function(c){var d=this;this.name=c.name,this.channel=c.channel,this.instrument=new n.Instrument(void 0,this),this.instrument.fromJSON(c.instrument),c.endOfTrackTicks!==void 0&&(this.endOfTrackTicks=c.endOfTrackTicks);for(var u in c.controlChanges)c.controlChanges[u]&&c.controlChanges[u].forEach(function(h){d.addCC({number:h.number,ticks:h.ticks,value:h.value})});c.notes.forEach(function(h){d.addNote({durationTicks:h.durationTicks,midi:h.midi,ticks:h.ticks,velocity:h.velocity})})},l.prototype.toJSON=function(){for(var c={},d=0;d<127;d++)this.controlChanges.hasOwnProperty(d)&&(c[d]=this.controlChanges[d].map(function(h){return h.toJSON()}));var u={channel:this.channel,controlChanges:c,pitchBends:this.pitchBends.map(function(h){return h.toJSON()}),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map(function(h){return h.toJSON()})};return this.endOfTrackTicks!==void 0&&(u.endOfTrackTicks=this.endOfTrackTicks),u},l}();return Ie.Track=o,Ie}var _e={};function $d(i){var e=[];return gr(i,e),e}function gr(i,e){for(var t=0;t<i.length;t++){var s=i[t];Array.isArray(s)?gr(s,e):e.push(s)}}const Wd=Object.freeze(Object.defineProperty({__proto__:null,flatten:$d},Symbol.toStringTag,{value:"Module"})),jd=Ud(Wd);var Qi;function Xd(){if(Qi)return _e;Qi=1;var i=_e&&_e.__spreadArray||function(m,v,S){if(S||arguments.length===2)for(var g=0,C=v.length,N;g<C;g++)(N||!(g in v))&&(N||(N=Array.prototype.slice.call(v,0,g)),N[g]=v[g]);return m.concat(N||Array.prototype.slice.call(v))};Object.defineProperty(_e,"__esModule",{value:!0}),_e.encode=void 0;var e=mr(),t=ti(),s=jd;function n(m,v){return[{absoluteTime:m.ticks,channel:v,deltaTime:0,noteNumber:m.midi,type:"noteOn",velocity:Math.floor(m.velocity*127)},{absoluteTime:m.ticks+m.durationTicks,channel:v,deltaTime:0,noteNumber:m.midi,type:"noteOff",velocity:Math.floor(m.noteOffVelocity*127)}]}function r(m){return(0,s.flatten)(m.notes.map(function(v){return n(v,m.channel)}))}function a(m,v){return{absoluteTime:m.ticks,channel:v,controllerType:m.number,deltaTime:0,type:"controller",value:Math.floor(m.value*127)}}function o(m){for(var v=[],S=0;S<127;S++)m.controlChanges.hasOwnProperty(S)&&m.controlChanges[S].forEach(function(g){v.push(a(g,m.channel))});return v}function l(m,v){return{absoluteTime:m.ticks,channel:v,deltaTime:0,type:"pitchBend",value:m.value}}function c(m){var v=[];return m.pitchBends.forEach(function(S){v.push(l(S,m.channel))}),v}function d(m){return{absoluteTime:0,channel:m.channel,deltaTime:0,programNumber:m.instrument.number,type:"programChange"}}function u(m){return{absoluteTime:0,deltaTime:0,meta:!0,text:m,type:"trackName"}}function h(m){return{absoluteTime:m.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/m.bpm),type:"setTempo"}}function f(m){return{absoluteTime:m.ticks,deltaTime:0,denominator:m.timeSignature[1],meta:!0,metronome:24,numerator:m.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function y(m){var v=t.keySignatureKeys.indexOf(m.key);return{absoluteTime:m.ticks,deltaTime:0,key:v+7,meta:!0,scale:m.scale==="major"?0:1,type:"keySignature"}}function b(m){return{absoluteTime:m.ticks,deltaTime:0,meta:!0,text:m.text,type:m.type}}function _(m){var v={header:{format:1,numTracks:m.tracks.length+1,ticksPerBeat:m.header.ppq},tracks:i([i(i(i(i([{absoluteTime:0,deltaTime:0,meta:!0,text:m.header.name,type:"trackName"}],m.header.keySignatures.map(function(S){return y(S)}),!0),m.header.meta.map(function(S){return b(S)}),!0),m.header.tempos.map(function(S){return h(S)}),!0),m.header.timeSignatures.map(function(S){return f(S)}),!0)],m.tracks.map(function(S){return i(i(i([u(S.name),d(S)],r(S),!0),o(S),!0),c(S),!0)}),!0)};return v.tracks=v.tracks.map(function(S){S=S.sort(function(C,N){return C.absoluteTime-N.absoluteTime});var g=0;return S.forEach(function(C){C.deltaTime=C.absoluteTime-g,g=C.absoluteTime,delete C.absoluteTime}),S.push({deltaTime:0,meta:!0,type:"endOfTrack"}),S}),new Uint8Array((0,e.writeMidi)(v))}return _e.encode=_,_e}var es;function Vd(){return es||(es=1,function(i){var e=me&&me.__awaiter||function(u,h,f,y){function b(_){return _ instanceof f?_:new f(function(m){m(_)})}return new(f||(f=Promise))(function(_,m){function v(C){try{g(y.next(C))}catch(N){m(N)}}function S(C){try{g(y.throw(C))}catch(N){m(N)}}function g(C){C.done?_(C.value):b(C.value).then(v,S)}g((y=y.apply(u,h||[])).next())})},t=me&&me.__generator||function(u,h){var f={label:0,sent:function(){if(_[0]&1)throw _[1];return _[1]},trys:[],ops:[]},y,b,_,m;return m={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function v(g){return function(C){return S([g,C])}}function S(g){if(y)throw new TypeError("Generator is already executing.");for(;f;)try{if(y=1,b&&(_=g[0]&2?b.return:g[0]?b.throw||((_=b.return)&&_.call(b),0):b.next)&&!(_=_.call(b,g[1])).done)return _;switch(b=0,_&&(g=[g[0]&2,_.value]),g[0]){case 0:case 1:_=g;break;case 4:return f.label++,{value:g[1],done:!1};case 5:f.label++,b=g[1],g=[0];continue;case 7:g=f.ops.pop(),f.trys.pop();continue;default:if(_=f.trys,!(_=_.length>0&&_[_.length-1])&&(g[0]===6||g[0]===2)){f=0;continue}if(g[0]===3&&(!_||g[1]>_[0]&&g[1]<_[3])){f.label=g[1];break}if(g[0]===6&&f.label<_[1]){f.label=_[1],_=g;break}if(_&&f.label<_[2]){f.label=_[2],f.ops.push(g);break}_[2]&&f.ops.pop(),f.trys.pop();continue}g=h.call(u,f)}catch(C){g=[6,C],b=0}finally{y=_=0}if(g[0]&5)throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}};Object.defineProperty(i,"__esModule",{value:!0}),i.Header=i.Track=i.Midi=void 0;var s=mr(),n=ti(),r=Zi(),a=Xd(),o=function(){function u(h){var f=this,y=null;if(h){var b=h instanceof ArrayBuffer?new Uint8Array(h):h;y=(0,s.parseMidi)(b),y.tracks.forEach(function(_){var m=0;_.forEach(function(v){m+=v.deltaTime,v.absoluteTime=m})}),y.tracks=d(y.tracks)}this.header=new n.Header(y),this.tracks=[],h&&(this.tracks=y.tracks.map(function(_){return new r.Track(_,f.header)}),y.header.format===1&&this.tracks[0].duration===0&&this.tracks.shift())}return u.fromUrl=function(h){return e(this,void 0,void 0,function(){var f,y;return t(this,function(b){switch(b.label){case 0:return[4,fetch(h)];case 1:return f=b.sent(),f.ok?[4,f.arrayBuffer()]:[3,3];case 2:return y=b.sent(),[2,new u(y)];case 3:throw new Error("Could not load '".concat(h,"'"))}})})},Object.defineProperty(u.prototype,"name",{get:function(){return this.header.name},set:function(h){this.header.name=h},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"duration",{get:function(){var h=this.tracks.map(function(f){return f.duration});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),Object.defineProperty(u.prototype,"durationTicks",{get:function(){var h=this.tracks.map(function(f){return f.durationTicks});return Math.max.apply(Math,h)},enumerable:!1,configurable:!0}),u.prototype.addTrack=function(){var h=new r.Track(void 0,this.header);return this.tracks.push(h),h},u.prototype.toArray=function(){return(0,a.encode)(this)},u.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map(function(h){return h.toJSON()})}},u.prototype.fromJSON=function(h){var f=this;this.header=new n.Header,this.header.fromJSON(h.header),this.tracks=h.tracks.map(function(y){var b=new r.Track(void 0,f.header);return b.fromJSON(y),b})},u.prototype.clone=function(){var h=new u;return h.fromJSON(this.toJSON()),h},u}();i.Midi=o;var l=Zi();Object.defineProperty(i,"Track",{enumerable:!0,get:function(){return l.Track}});var c=ti();Object.defineProperty(i,"Header",{enumerable:!0,get:function(){return c.Header}});function d(u){for(var h=[],f=0;f<u.length;f++)for(var y=h.length,b=new Map,_=Array(16).fill(0),m=0,v=u[f];m<v.length;m++){var S=v[m],g=y,C=S.channel;if(C!==void 0){S.type==="programChange"&&(_[C]=S.programNumber);var N=_[C],w="".concat(N," ").concat(C);b.has(w)?g=b.get(w):(g=y+b.size,b.set(w,g))}h[g]||h.push([]),h[g].push(S)}return h}}(me)),me}var br=Vd();const vr=["acoustic_grand_piano","bright_acoustic_piano","electric_grand_piano","honkytonk_piano","electric_piano_1","electric_piano_2","harpsichord","clavinet","celesta","glockenspiel","music_box","vibraphone","marimba","xylophone","tubular_bells","dulcimer","drawbar_organ","percussive_organ","rock_organ","church_organ","reed_organ","accordion","harmonica","tango_accordion","acoustic_guitar_nylon","acoustic_guitar_steel","electric_guitar_jazz","electric_guitar_clean","electric_guitar_muted","overdriven_guitar","distortion_guitar","guitar_harmonics","acoustic_bass","electric_bass_finger","electric_bass_pick","fretless_bass","slap_bass_1","slap_bass_2","synth_bass_1","synth_bass_2","violin","viola","cello","contrabass","tremolo_strings","pizzicato_strings","orchestral_harp","timpani","string_ensemble_1","string_ensemble_2","synth_strings_1","synth_strings_2","choir_aahs","voice_oohs","synth_choir","orchestra_hit","trumpet","trombone","tuba","muted_trumpet","french_horn","brass_section","synth_brass_1","synth_brass_2","soprano_sax","alto_sax","tenor_sax","baritone_sax","oboe","english_horn","bassoon","clarinet","piccolo","flute","recorder","pan_flute","blown_bottle","shakuhachi","whistle","ocarina","lead_1_square","lead_2_sawtooth","lead_3_calliope","lead_4_chiff","lead_5_charang","lead_6_voice","lead_7_fifths","lead_8_bass__lead","pad_1_new_age","pad_2_warm","pad_3_polysynth","pad_4_choir","pad_5_bowed","pad_6_metallic","pad_7_halo","pad_8_sweep","fx_1_rain","fx_2_soundtrack","fx_3_crystal","fx_4_atmosphere","fx_5_brightness","fx_6_goblins","fx_7_echoes","fx_8_scifi","sitar","banjo","shamisen","koto","kalimba","bagpipe","fiddle","shanai","tinkle_bell","agogo","steel_drums","woodblock","taiko_drum","melodic_tom","synth_drum","reverse_cymbal","guitar_fret_noise","breath_noise","seashore","bird_tweet","telephone_ring","helicopter","applause","gunshot"];function Yd(i){const e=i.split("/"),s=e[e.length-1].trim().toLowerCase().replace(/\s+/g,"_"),n=vr.findIndex(r=>r===s);return n!==-1?n:(s.includes("drum")||s.includes("drummachine"),0)}async function Zd(i){var f;const e=await i.arrayBuffer(),t=new br.Midi(e),s=t.header.tempos[0],n=t.header.timeSignatures[0],r=(s==null?void 0:s.bpm)??120,a=((f=n==null?void 0:n.timeSignature)==null?void 0:f[0])??4,l=Math.max(0,...t.tracks.flatMap(y=>y.notes.map(b=>b.time+b.duration)))*(r/60),c=Math.ceil(l/a)||8,d={bpm:r,beatsPerMeasure:a,totalMeasures:c,songKey:"CM"},u=await Cn(),h=t.tracks.map(y=>{const b=y.notes.map(N=>({pitch:N.name,start:N.time*(r/60),duration:N.duration*(r/60),velocity:Math.max(1,Math.min(127,Math.round(N.velocity*127)))}));let _=y.instrument.number;(_===void 0||_===0)&&(_=y.channel===9?0:y.channel%128);const m=y.controlChanges[7]||[],v=y.controlChanges[10]||[],S=m.length>0?m[0].value:void 0,g=v.length>0?v[0].value*2-1:void 0;let C;if(y.channel===9){const N=In(_);N?C=`webaudiofont/${N.library}/${N.displayName}`:C=`sf2/drummachines/${u.includes("LM-2")?"LM-2":u[0]??"TR-808"}`}else C=`sf2/fluidr3-gm/${vr[_]||"acoustic_grand_piano"}`;return{notes:b,instrument:C,volume:S,pan:g,config:{}}});return{globalConfig:d,tracks:h}}async function Qd(i){if(!i.sequencers.length)throw new Error("No tracks to export.");const e=new br.Midi;e.header.setTempo(i.tempo),e.header.timeSignatures.push({ticks:0,timeSignature:i.timeSignature});for(const[n,r]of i.sequencers.entries()){const a=e.addTrack(),o=r.instrument.toLowerCase().includes("drum");a.channel=o?9:n%16;const l=Yd(r.instrument);if(a.instrument.number=l,typeof r.volume=="number"&&a.addCC({number:7,time:0,value:Math.max(0,Math.min(1,r.volume))}),typeof r.pan=="number"){const c=(r.pan+1)/2;a.addCC({number:10,time:0,value:Math.max(0,Math.min(1,c))})}for(const c of r.notes){const d=H(c.pitch),u=Math.max(.01,Math.min(1,(c.velocity??100)/127));if(d===null)continue;const h=ts(c.start,i.tempo),f=ts(c.duration,i.tempo);a.addNote({midi:d,time:h,duration:f,velocity:u})}}const t=new Blob([e.toArray()],{type:"audio/midi"});return{url:URL.createObjectURL(t),filename:`session-${Date.now()}.mid`}}function ts(i,e){return 60/e*i}function is(i,e){const t=P.getInstance();t.isActive()&&t.pause(),_i(e.bpm),gi(e.beatsPerMeasure),bi(e.totalMeasures),rr(e.songKey);const s=document.getElementById("tempo-input");s&&(s.value=String(ue()));const n=document.getElementById("measures-input");n&&(n.value=String(Si())),Uo();for(const[o,l]of i.entries()){const c=o,d=l.instrument||"sf2/fluidr3-gm/acoustic_grand_piano",u=l.notes||[],h=l.volume,f=l.pan;E({type:"CREATE_SEQUENCER",id:c,instrument:d,notes:structuredClone(u),volume:h,pan:f,config:{...l.config||{}}},pi(c))}E(mi("Session Loaded"),tr("Session Loaded"));const r=D();Ta();const a=document.getElementById("global-mini-contour");a&&Vl(a,r),Mt(0)}class Be{static async save(e){const t=O();if(e==="json"){const{url:s,filename:n}=Ad(t);Be.download(s,n)}else if(e==="midi"){const{url:s,filename:n}=await Qd(t);Be.download(s,n)}else throw new Error("Unsupported export format.")}static async saveWavWithOptions(e){const t=O(),s=D();try{const n={globalConfig:{bpm:t.tempo,beatsPerMeasure:t.timeSignature[0],totalMeasures:t.totalMeasures,songKey:t.songKey},tracks:s.map(r=>({notes:r.notes,instrument:r.instrumentName,config:r.config,volume:r.volume,pan:r.pan}))};await Rd(n,e)}catch(n){alert("Failed to export WAV: "+(n instanceof Error?n.message:"Unknown error"))}}static async load(e){var t;try{const s=(t=e.name.split(".").pop())==null?void 0:t.toLowerCase();if(s==="json"){const{tracks:n,globalConfig:r}=await Od(e);is(n,r)}else if(s==="mid"||s==="midi"){const{tracks:n,globalConfig:r}=await Zd(e);is(n,r)}else throw new Error("Unsupported file type.")}catch(s){alert("Failed to load file: "+(s.message||"Unknown error"))}}static download(e,t){const s=document.createElement("a");s.href=e,s.download=t,s.click(),URL.revokeObjectURL(e)}}function ec(i,e){const t=i.querySelector("#export-cancel"),s=i.querySelector("#export-json"),n=i.querySelector("#export-wav"),r=i.querySelector("#export-midi"),a=()=>{i.classList.add("hidden")},o=async l=>{l==="wav"?(a(),e()):(await Be.save(l),a())};return t==null||t.addEventListener("click",a),s==null||s.addEventListener("click",()=>o("json")),n==null||n.addEventListener("click",()=>o("wav")),r==null||r.addEventListener("click",()=>o("midi")),{detach:()=>{t==null||t.removeEventListener("click",a),s==null||s.removeEventListener("click",()=>o("json")),n==null||n.removeEventListener("click",()=>o("wav")),r==null||r.removeEventListener("click",()=>o("midi"))},refreshUI:()=>{}}}class tc{constructor(e){this.detachFn=null,this.modal=Ed(),document.body.appendChild(this.modal);const t=ec(this.modal,e);this.detachFn=t.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function ic({id:i,label:e,options:t}){const s=T(),n=p("select",{id:i,class:["w-[80px] h-[40px] text-sm font-semibold rounded px-2 cursor-pointer",s.surfaceBackground,s.textColor,s.borderColor].join(" ")},...t.map(r=>p("option",{value:r.value},r.label)));return e?p("div",{class:"flex flex-col items-start gap-1"},W(e),n):n}class sc{constructor(){const e=T();this.sampleRateSelect=ic({id:"save-wav-sample-rate",options:[{value:"44100",label:"44,100 Hz (CD Quality)"},{value:"32000",label:"32,000 Hz"},{value:"22050",label:"22,050 Hz (Faster Export)"}]}),this.includePanCheckbox=p("input",{id:"save-wav-include-pan",type:"checkbox",checked:!0,class:"accent-purple-500"}),this.cancelButton=R({id:"save-wav-options-cancel-btn",text:"Cancel",kind:"secondary"}),this.applyButton=R({id:"save-wav-options-apply-btn",text:"Export",kind:"primary"});const t=[ce("Export Settings"),$("Choose your WAV export parameters."),p("div",{class:"z-10 mb-4 w-full"},W({text:"Sample Rate",for:"save-wav-sample-rate"}),this.sampleRateSelect),p("div",{class:"z-10 mb-6"},p("label",{class:`flex items-center gap-2 text-sm ${e.textColor}`},this.includePanCheckbox,"Include Panning in Export")),p("div",{class:"flex justify-end gap-4 z-10"},this.cancelButton,this.applyButton)];this.modalEl=Z("save-wav-options-modal",t,{sizePreset:"md"}),document.body.appendChild(this.modalEl),this.attachListeners()}attachListeners(){this.cancelButton.addEventListener("click",()=>this.hide()),this.applyButton.addEventListener("click",()=>{const e=parseInt(this.sampleRateSelect.value,10),t=this.includePanCheckbox.checked;this.hide(),Be.saveWavWithOptions({sampleRate:e,includePan:t})})}show(){this.modalEl.classList.remove("hidden")}hide(){this.modalEl.classList.add("hidden")}destroy(){this.modalEl.remove()}}function rc(){const i=ce("📁 Load Project"),e=R({id:"import-json",text:"Load Project",kind:"primary"}),t=p("div",{class:"h-px bg-gray-600"}),s=R({id:"import-midi",text:"Import MIDI",kind:"secondary",additionalClasses:"bg-yellow-600 hover:bg-yellow-700"}),n=R({id:"import-cancel",text:"Cancel",kind:"tertiary",additionalClasses:"mt-6 w-full"}),r=p("div",{class:"flex flex-col gap-3 w-full z-10"},e,t,s);return Z("import-modal",[i,r,n])}function nc(i){const e=i.querySelector("#import-cancel"),t=i.querySelector("#import-json"),s=i.querySelector("#import-midi"),n=()=>{i.classList.add("hidden")},r=async l=>{const c=document.createElement("input");c.type="file",c.accept=l.join(","),c.onchange=async()=>{var d;(d=c.files)!=null&&d[0]&&(await Be.load(c.files[0]),n())},c.click()},a=()=>r([".json"]),o=()=>r([".mid",".midi"]);return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",a),s==null||s.addEventListener("click",o),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",a),s==null||s.removeEventListener("click",o)},refreshUI:()=>{}}}class ac{constructor(){this.detachFn=null,this.modal=rc(),document.body.appendChild(this.modal);const e=nc(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}function oc(){const i=p("h2",{class:"text-xl font-semibold mb-2 z-10 text-center",textContent:"Adjust Velocity"}),e=p("p",{class:"text-sm text-gray-400 mb-4 text-center z-10",textContent:"Apply a velocity transformation to the selected notes."}),t=p("input",{id:"velocity-set-toggle",type:"checkbox",class:"accent-purple-500",checked:!0}),s=p("label",{class:"flex items-center gap-2 text-sm mb-2"},t,"Set base velocity to"),n=p("select",{id:"velocity-action-select",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},p("option",{value:"set"},"Set Velocity To"),p("option",{value:"increase"},"Increase Velocity By"),p("option",{value:"decrease"},"Decrease Velocity By")),r=p("input",{id:"velocity-value-input",type:"number",value:"100",min:"1",max:"127",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),a=p("div",{id:"velocity-set-fields",class:"flex items-center gap-3"},n,r),o=p("div",{class:"z-10 mb-4"},s,a),l=p("input",{id:"velocity-ramp-toggle",type:"checkbox",class:"accent-purple-500"}),c=p("label",{class:"flex items-center gap-2 text-sm mb-2"},l,"Enable velocity ramp"),d=p("select",{id:"velocity-ramp-direction",class:"flex-1 bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500 cursor-pointer"},p("option",{value:"up"},"Ramp Up"),p("option",{value:"down"},"Ramp Down")),u=p("input",{id:"velocity-ramp-amount",type:"number",value:"10",min:"1",max:"127",placeholder:"Δ per note",class:"w-[100px] bg-gray-700 border border-gray-600 rounded px-3 py-2 text-sm focus:outline-none focus:border-purple-500"}),h=p("div",{class:"flex items-center gap-2 mb-4 text-sm text-gray-300"},p("label",{class:"flex items-center gap-1"},p("input",{type:"radio",name:"ramp-mode",value:"linear",checked:!0,class:"accent-purple-500"}),"Linear"),p("label",{class:"flex items-center gap-1"},p("input",{type:"radio",name:"ramp-mode",value:"exponential",class:"accent-purple-500"}),"Exponential")),f=p("div",{id:"velocity-ramp-fields",class:"opacity-50 pointer-events-none"},p("div",{class:"flex items-center gap-3 mb-2"},d,u),h),y=p("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},c,f),b=p("input",{id:"velocity-randomize-toggle",type:"checkbox",class:"accent-purple-500"}),_=p("label",{class:"flex items-center gap-2 text-sm mb-2"},b,"Add random variation"),m=p("input",{id:"velocity-random-range",type:"number",value:"5",min:"1",max:"64",class:"w-[80px] bg-gray-700 border border-gray-600 rounded px-2 py-1 text-sm focus:outline-none focus:border-purple-500"}),v=p("div",{id:"velocity-random-fields",class:"flex items-center gap-2 text-sm text-gray-300 opacity-50 pointer-events-none"},p("span",{textContent:"±"}),m),S=p("div",{class:"border-t border-gray-700 pt-4 mt-4 z-10"},_,v),g=p("div",{id:"velocity-preview-summary",class:"mt-6 text-sm text-gray-400 text-center z-10"}),C=R({id:"velocity-apply-btn",text:"Apply",kind:"primary"}),N=R({id:"velocity-cancel-btn",text:"Cancel",kind:"tertiary"}),w=p("div",{class:"flex gap-3 mt-6 z-10"},C,N);return Z("velocity-modal",[i,e,o,y,S,g,w])}function lc(i){const e=fr();if(!e){console.warn("No active note selection to apply velocity changes.");return}const{sequencerId:t,selectedNotes:s}=e;if(s.length===0){console.warn("No notes selected in the active sequencer.");return}const n=D().find(m=>m.id===t);if(!(n!=null&&n.matrix)){console.warn(`Could not find matrix for sequencer ID ${t}.`);return}const r=s.map(m=>({...m})),{mode:a,value:o,rampDirection:l="none",rampAmount:c=0,rampMode:d="linear",randomize:u=!1,randomRange:h=0}=i,f=s.map((m,v)=>({note:m,originalIndex:v}));f.sort((m,v)=>m.note.start-v.note.start);const y=new Map;for(const m of f){const v=m.note.start;y.has(v)||y.set(v,[]),y.get(v).push(m)}Array.from(y.entries()).sort((m,v)=>m[0]-v[0]).map(([,m])=>m).forEach((m,v)=>{let S=d==="linear"?v:Math.pow(v,1.3),g=c*S;l==="down"&&(g=-g);for(const{note:C}of m){let N;switch(a){case"set":N=Math.max(1,o);break;case"increase":N=(C.velocity??100)+o;break;case"decrease":N=(C.velocity??100)-o;break;case"none":default:N=C.velocity??100;break}let w=N+g;if(u&&h>0){const M=(Math.random()*2-1)*h;w+=M}C.velocity=Math.max(1,Math.min(127,Math.round(w)))}});const _=f.sort((m,v)=>m.originalIndex-v.originalIndex).map(({note:m})=>({...m}));E(wl(t,_),Ml(t,r))}function dc(i){const e=document.getElementById("velocity-modal");e&&e.classList.remove("hidden")}function Wt(){const i=document.getElementById("velocity-modal");i&&i.classList.add("hidden")}function cc(i){var f;const e=i.querySelector("#velocity-apply-btn"),t=i.querySelector("#velocity-cancel-btn"),s=i.querySelector("#velocity-set-toggle"),n=((f=i.querySelector("#velocity-action-select"))==null?void 0:f.parentElement)??null,r=i.querySelector("#velocity-ramp-toggle"),a=i.querySelector("#velocity-ramp-fields"),o=i.querySelector("#velocity-randomize-toggle"),l=i.querySelector("#velocity-random-fields");function c(y,b){if(!y||!b)return;const _=y.checked;b.classList.toggle("opacity-50",!_),b.classList.toggle("pointer-events-none",!_)}function d(){s==null||s.addEventListener("change",()=>c(s,n)),r==null||r.addEventListener("change",()=>c(r,a)),o==null||o.addEventListener("change",()=>c(o,l)),c(s,n),c(r,a),c(o,l)}function u(){var M,G,k,B,x,F;const y=(s==null?void 0:s.checked)??!0,b=(r==null?void 0:r.checked)??!1,_=(o==null?void 0:o.checked)??!1,m=y?(M=i.querySelector("#velocity-action-select"))==null?void 0:M.value:"none",v=parseInt(((G=i.querySelector("#velocity-value-input"))==null?void 0:G.value)??"",10),S=isNaN(v)?100:Math.max(1,Math.min(127,v)),g=b?(k=i.querySelector("#velocity-ramp-direction"))==null?void 0:k.value:"none",C=b?parseInt(((B=i.querySelector("#velocity-ramp-amount"))==null?void 0:B.value)??"0",10):0,N=b?(x=i.querySelector('input[name="ramp-mode"]:checked'))==null?void 0:x.value:"linear",w=_?parseInt(((F=i.querySelector("#velocity-random-range"))==null?void 0:F.value)??"0",10):0;lc({mode:m,value:S,rampDirection:g,rampAmount:C,rampMode:N,randomize:_,randomRange:w}),Wt()}const h=()=>{t==null||t.removeEventListener("click",Wt),e==null||e.removeEventListener("click",u),s==null||s.removeEventListener("change",()=>c(s,n)),r==null||r.removeEventListener("change",()=>c(r,a)),o==null||o.removeEventListener("change",()=>c(o,l))};return t==null||t.addEventListener("click",Wt),e==null||e.addEventListener("click",u),d(),{detach:h,refreshUI:()=>{}}}class uc{constructor(){this.detachFn=null,this.modal=oc(),document.body.appendChild(this.modal);const e=cc(this.modal);this.detachFn=e.detach}show(e){dc()}hide(){this.modal.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}const hc="v0.1.1",fc="May 12, 2025",pc=["✨ New Features","- 🎨 Added customizable interface skins via user config","- 🧱 Rewrote sequencer grid from the ground up for responsiveness, faster rendering, and zoomable matrix layout","- 🎹 Introduced Express Note Tool as the new default for intuitive, fast note placement (Classic mode still available)","- 🎼 Added song key selection with support for transposed piano roll and in-key snapping","- 🎛️ Rebuilt transport controls with higher resolution layout and improved submenu behavior","- 🎯 Introduced granular snap controls (toggle snapping, in-key snapping, full off)","- 🎹 Added right-click marquee selection, shift multi-selection, and consistent hover behavior","- 🎹 Enabled drag threshold-aware note dragging directly from selection with improved state tracking","- ⌨️ Implemented keyboard shortcuts for transport, navigation (e.g. Shift+WASD), and tool toggles","🐞 Known Issues","- 🚫 Note placement during live playback of large sequences causes performance issues","🛣️ Roadmap","- 🤖 AI-assisted generation and track extension tools (May rollout)"];function mc(){const i=W({text:`${hc} — Updated ${fc}`});i.id="whats-new-metadata",i.classList.add("italic","text-gray-400","text-center","self-center","mb-4");const e=p("ul",{id:"whats-new-content",class:"list-disc list-inside text-left space-y-2 text-md w-full"});let t=null;for(const a of pc)if(a.startsWith("✨")||a.startsWith("🐞")||a.startsWith("🛣️")){const o=p("li",{class:"font-bold mt-6 text-lg",textContent:a});e.appendChild(o),t=p("ul",{class:"list-disc list-inside ml-6 mt-2 space-y-1"}),e.appendChild(t)}else if(t){const o=p("li",{textContent:a.replace(/^- /,"")});t.appendChild(o)}const s=p("img",{src:de("static/logo.png"),alt:"Sequenzia",class:"w-[180px] h-auto rounded-xl mb-6 self-center"}),n=R({id:"whats-new-close-btn",text:"Close",kind:"primary",additionalClasses:"mt-8 self-center text-base px-6 py-2 font-medium"}),r=ce({text:"🆕 What's New in Sequenzia",size:"xl",additionalClasses:"text-center self-center"});return Z("whats-new-modal",[s,r,i,e,n],{sizePreset:"xl"})}function yc(i){const e=i.querySelector("#whats-new-close-btn"),t=()=>{i.style.opacity="0",i.style.transition="opacity 0.4s ease-out",setTimeout(()=>{i.classList.add("hidden"),i.style.opacity="1"},400)};return e==null||e.addEventListener("click",t),{detach:()=>{e==null||e.removeEventListener("click",t)},refreshUI:()=>{}}}class _c{constructor(){this.detachFn=null,this.modal=mc(),document.body.appendChild(this.modal);const e=yc(this.modal);this.detachFn=e.detach}show(){this.modal.classList.remove("hidden"),this.modal.style.opacity="1"}hide(){this.modal.style.opacity="0",this.modal.style.transition="opacity 0.4s ease-out",setTimeout(()=>{this.modal.classList.add("hidden"),this.modal.style.opacity="1"},400)}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.modal.remove()}}class gc{constructor(e,t){this.contour=null,this.miniCanvas=null,this.sideButtons=null,this.detachFns=[],this.refreshFns=[],this.engine=e,this.userConfigModalController=t,this.playbackService=new Bd,this.initializeUI()}initializeUI(){this.controls=new nd,this.wavOptionsModal=new sc,this.saveModal=new tc(()=>this.wavOptionsModal.show()),this.loadModal=new ac,this.velocityModal=new uc,this.whatsNewModal=new _c;const e=od(),t=ud(),s=gd(),n=hd();this.controls.getGlobalPlayheadRow().appendChild(e),this.controls.getGlobalToolsRow().appendChild(t.element),this.controls.getGlobalTransportRow().appendChild(s.element);const r=document.getElementById("footer-main");r&&r.appendChild(n),this.miniCanvas=this.getGlobalMiniContourCanvas(),this.sideButtons=n,this.contour=e;const a=Sd(e),o=Cd(t.element),l=wd(s.element,this.playbackService,this.userConfigModalController,this.saveModal,this.loadModal),c=Nd(n,this.whatsNewModal),d=xd(this.controls.getGlobalPlayheadRow()),u=Gd({velocity:this.velocityModal});this.detachFns=[a.detach,o.detach,l.detach,c.detach,d.detach,u.detach,t.refreshGridSettings],this.refreshFns=[a.refreshUI,o.refreshUI,l.refreshUI,c.refreshUI,d.refreshUI,u.refreshUI,s.refreshToggles],os(),this.initPlayhead()}initPlayhead(){if(!this.contour)return;const e=this.contour.querySelector("#global-mini-playhead");e&&(Md(e),this.playbackService.setPlayheadCanvasWidth(e.width))}getPlaybackService(){return this.playbackService}getGlobalMiniContourCanvas(){var e;return((e=this.contour)==null?void 0:e.querySelector("#global-mini-contour"))??null}show(){this.refreshFns.forEach(e=>e()),this.controls.render().classList.remove("hidden")}hide(){this.controls.render().classList.add("hidden")}destroy(){var e,t,s,n,r,a;this.detachFns.forEach(o=>o()),this.controls.destroy(),(e=this.sideButtons)!=null&&e.parentNode&&this.sideButtons.parentNode.removeChild(this.sideButtons),this.sideButtons=null,(t=this.wavOptionsModal)==null||t.destroy(),(s=this.saveModal)==null||s.destroy(),(n=this.loadModal)==null||n.destroy(),(r=this.velocityModal)==null||r.destroy(),(a=this.whatsNewModal)==null||a.destroy()}reload(){this.destroy(),this.initializeUI()}}function bc(i,e){window.addEventListener("keydown",t=>{const s=(t.ctrlKey||t.metaKey)&&t.key.toLowerCase()==="z",n=(t.ctrlKey||t.metaKey)&&(t.key.toLowerCase()==="y"||t.shiftKey&&t.key.toLowerCase()==="z");if(!s&&!n)return;t.preventDefault(),t.target instanceof HTMLElement&&t.target.matches('input, textarea, [contenteditable="true"]')||(s?i():e())},{capture:!0})}function vc(){const i=p("canvas",{id:"waveform",width:1260,height:100,class:"rounded border border-purple-800 bg-gray-900"}),e=p("button",{id:"visualizer-mode",class:"side-button side-button-primary",title:"Change visualizer mode",textContent:"📊"}),t=p("div",{class:"flex flex-col gap-2"},e),s=p("div",{class:"flex items-start gap-2"},i,t),n=document.getElementById("visualizer-container");return n&&n.appendChild(s),s}function Sc(i,e){const t=e.getContext("2d");if(!t)throw new Error("Canvas 2D context not available");const s=e.width,n=e.height,r=new Uint8Array(i.fftSize),a=new Uint8Array(i.frequencyBinCount),o=document.createElement("canvas");o.width=s,o.height=n;const l=o.getContext("2d");if(!l)throw new Error("Offscreen canvas 2D context not available");let c="frequency";function d(){if(!t)return;i.getByteTimeDomainData(r),t.fillStyle="#000",t.fillRect(0,0,s,n),t.lineWidth=2,t.strokeStyle="#00ffcc",t.beginPath();const y=s/r.length;let b=0;for(let _=0;_<r.length;_++){const v=r[_]/128*n/2;_===0?t.moveTo(b,v):t.lineTo(b,v),b+=y}t.lineTo(s,n/2),t.stroke()}function u(){if(i.getByteFrequencyData(a),!t)return;t.fillStyle="#000",t.fillRect(0,0,s,n),t.fillStyle="rgba(255,255,255,0.2)",t.fillRect(0,0,1,n),t.fillRect(s-1,0,1,n);const y=128,b=2,_=[];for(let m=0;m<y;m++)_.push(m*s/(y-1));_[_.length-1]=s-1;for(let m=0;m<y;m++){const v=_[m],S=m<y-1?_[m+1]:s,g=Math.max(1,S-v-b),C=20,N=2e4,w=m/(y-1),M=C*Math.pow(N/C,w),k=Math.min(a.length-1,Math.floor(M/22050*a.length)),B=a[k]/255,x=Math.max(1,B*n),F=240-w*240;t.fillStyle=`hsl(${F}, ${80+B*20}%, ${40+B*40}%)`,t.fillRect(v,n-x,g,x)}}function h(){if(i.getByteFrequencyData(a),!l)return;o.initialized||(l.fillStyle="#000",l.fillRect(0,0,s,n),o.initialized=!0),l.drawImage(o,-1,0),l.fillStyle="#000",l.fillRect(s-1,0,1,n);const y=128,b=20,_=2e4;for(let m=0;m<y;m++){const v=m/(y-1),S=b*Math.pow(_/b,v),C=Math.min(a.length-1,Math.floor(S/22050*a.length)),N=a[C]/255,w=n-1-Math.floor(m*n/y);if(N<.05)continue;const M=Math.floor(N*255),G=Math.floor(N*(255-v*200)),k=Math.floor(N*(100+v*155));l.fillStyle=`rgb(${M}, ${G}, ${k})`,l.fillRect(s-1,w,1,1)}t&&(t.fillStyle="#000",t.fillRect(0,0,s,n),t.drawImage(o,0,0))}function f(){switch(requestAnimationFrame(f),c){case"frequency":u();break;case"spectrogram":h();break;case"waveform":default:d()}}return f(),{setMode(y){["waveform","frequency","spectrogram"].includes(y)&&(c=y,t.clearRect(0,0,s,n),c==="spectrogram"&&l.clearRect(0,0,s,n))}}}function Cc(i){const e=i.querySelector("#waveform"),t=i.querySelector("#visualizer-mode");if(!e||!t)return console.warn("Visualizer setup failed: missing canvas or button"),{detach:()=>{},refreshUI:()=>{}};const s=Sc(Ss(),e),n=[{name:"waveform",emoji:"🌊"},{name:"frequency",emoji:"📊"},{name:"spectrogram",emoji:"🌈"}];let r=0;function a(){if(!t)return;r=(r+1)%n.length;const{name:o,emoji:l}=n[r];s.setMode(o),t.textContent=l,t.title=`Mode: ${o}`}return t.addEventListener("click",a),a(),{detach:()=>{t.removeEventListener("click",a)},refreshUI:()=>{t.textContent=n[r].emoji,t.title=`Mode: ${n[r].name}`}}}class Nc{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=vc();const e=Cc(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function wc(){const i=p("div",{id:"left-sidebutton-column",class:"absolute left-[-46px] flex flex-col gap-2 z-10"},p("button",{id:"piano-toggle-btn",class:"side-button side-button-info",title:"Toggle Piano View",textContent:"🎹"}),p("button",{id:"mixer-toggle-btn",class:"side-button side-button-info",title:"Toggle Mixer View",textContent:"🎛️"}),p("button",{id:"ai-toggle-btn",class:"side-button side-button-info",title:"Toggle AI View",textContent:"🤖"})),e=document.getElementById("top-controls-container");return e?e.appendChild(i):console.warn("[SideMenuUI] #top-controls-container not found."),i}function Mc(i){const e=i.querySelector("#piano-toggle-btn"),t=i.querySelector("#mixer-toggle-btn"),s=i.querySelector("#ai-toggle-btn"),n=()=>{fe().showFeatureBlocked()},r=()=>{fe().showFeatureBlocked()},a=()=>{fe().showFeatureBlocked()};return e==null||e.addEventListener("click",n),t==null||t.addEventListener("click",r),s==null||s.addEventListener("click",a),{detach:()=>{e==null||e.removeEventListener("click",n),t==null||t.removeEventListener("click",r),s==null||s.removeEventListener("click",a)},refreshUI:()=>{}}}class Lc{constructor(){this.detachFn=null,this.refreshFn=null,this.initializeUI()}initializeUI(){this.container=wc();const e=Mc(this.container);this.detachFn=e.detach,this.refreshFn=e.refreshUI}show(){var e;this.container.classList.remove("hidden"),(e=this.refreshFn)==null||e.call(this)}hide(){this.container.classList.add("hidden")}destroy(){var e;(e=this.detachFn)==null||e.call(this),this.container.remove()}reload(){this.destroy(),this.initializeUI()}}function xc(){const i=p("canvas",{id:"piano",width:1260,height:200,class:"rounded shadow-lg border border-purple-700"}),e=p("button",{id:"octave-up",class:"side-button side-button-primary",title:"Octave Up"},I("icon-arrow-up","Octave Up")),t=p("button",{id:"octave-down",class:"side-button side-button-primary",title:"Octave Down"},I("icon-arrow-down","Octave Down")),s=p("button",{id:"global-instrument-select-btn",class:"side-button side-button-primary",title:"Select Instrument"},I("icon-list-instrument","Instrument")),n=p("button",{id:"disable-keyboard-inputs",class:"side-button side-button-secondary",title:"Toggle Keyboard Input"},I("icon-keyboard","Keyboard Input")),r=p("div",{class:"flex flex-col gap-2"},e,t,s,n);return{wrapper:p("div",{class:"flex items-start gap-2"},i,r),canvas:i}}function ss(i,e){const t=parseInt(i.replace("#",""),16),s=Math.round(2.55*e),n=Math.max(0,Math.min(255,(t>>16)+s)),r=Math.max(0,Math.min(255,(t>>8&255)+s)),a=Math.max(0,Math.min(255,(t&255)+s));return`rgb(${n},${r},${a})`}function $e(i,e,t=new Set,s=null){i.clearRect(0,0,i.canvas.width,i.canvas.height);const{whiteKeyColor:n,blackKeyColor:r}=T(),a={};if(s)for(const[o,l]of Object.entries(s))a[l]=o;for(const o of Object.values(e))if(!o.isBlack){const l=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(l.addColorStop(0,"#99cfff"),l.addColorStop(1,"#cce0ff")):(l.addColorStop(0,ss(n,-20)),l.addColorStop(1,n)),rs(i,{...o,fill:l,stroke:"#333",radius:6}),i.fillStyle="#333",i.font="12px sans-serif",i.textAlign="center",a[o.note]&&(i.fillStyle="#7c3aed",i.fillText(a[o.note],o.x+o.width/2,o.height-24),i.fillStyle="#333"),i.fillText(o.note,o.x+o.width/2,o.height-8)}for(const o of Object.values(e))if(o.isBlack){const l=i.createLinearGradient(0,0,0,o.height);t.has(o.note)?(l.addColorStop(0,"#3040ff"),l.addColorStop(1,"#4a60ff")):(l.addColorStop(0,ss(r,-20)),l.addColorStop(1,r)),rs(i,{...o,fill:l,stroke:"#000000",radius:4}),a[o.note]&&(i.fillStyle="#c084fc",i.font="10px sans-serif",i.textAlign="center",i.fillText(a[o.note],o.x+o.width/2,o.height-28))}}function rs(i,e){const{x:t,width:s,height:n,fill:r,stroke:a,radius:o=8}=e;i.beginPath(),i.moveTo(t,0),i.lineTo(t,n-o),i.quadraticCurveTo(t,n,t+o,n),i.lineTo(t+s-o,n),i.quadraticCurveTo(t+s,n,t+s,n-o),i.lineTo(t+s,0),i.closePath(),i.fillStyle=r,i.fill(),i.strokeStyle=a,i.lineWidth=1,i.stroke()}function Gc(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Map,s=new Set;let n=!1;function r(f,y){const b=Me();for(const _ of Object.values(b))if(_.isBlack&&f>=_.x&&f<=_.x+_.width&&y>=0&&y<=_.height)return _.note;for(const _ of Object.values(b))if(!_.isBlack&&f>=_.x&&f<=_.x+_.width&&y>=0&&y<=_.height)return _.note;return null}function a(f){if(!f||s.has(f)||!e)return;const y=Qn(f);y&&(t.set(f,y),s.add(f),$e(e,Me(),s,void 0))}function o(f){if(!s.has(f)||!e)return;const y=t.get(f);y&&(y.stop(),t.delete(f)),s.delete(f),$e(e,Me(),s,void 0)}function l(){for(const f of s)o(f)}const c=f=>{n=!0;const y=i.getBoundingClientRect(),b=f.clientX-y.left,_=f.clientY-y.top,m=r(b,_);a(m)},d=f=>{if(!n)return;const y=i.getBoundingClientRect(),b=f.clientX-y.left,_=f.clientY-y.top,m=r(b,_);a(m)},u=()=>{n=!1,l()},h=()=>{n=!1,l()};return i.addEventListener("mousedown",c),i.addEventListener("mousemove",d),i.addEventListener("mouseup",u),i.addEventListener("mouseleave",h),{detach:()=>{i.removeEventListener("mousedown",c),i.removeEventListener("mousemove",d),i.removeEventListener("mouseup",u),i.removeEventListener("mouseleave",h)},refreshUI:()=>{}}}const Sr=[..."qwertyuiop[zxcvbnm,./"],Cr=["2","3","5","6","7","9","0","=","s","d","g","h","k","l",";"];function kc(i){const e=i.getContext("2d");if(!e)throw new Error("Canvas context unavailable.");const t=new Set,s=new Set,n=new Map;function r(){const d=Me(),u=Object.values(d).filter(y=>!y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),h=Object.values(d).filter(y=>y.isBlack).sort((y,b)=>y.x-b.x).map(y=>y.note),f={};return Sr.forEach((y,b)=>{u[b]&&(f[y]=u[b])}),Cr.forEach((y,b)=>{h[b]&&(f[y]=h[b])}),f}function a(d){const u=r(),h=u[d];if(!(!h||t.has(d)||!e)){if(t.add(d),!s.has(h)){const f=vs(h,100,jn());f&&(n.set(h,{stop:f}),s.add(h))}$e(e,Me(),s,u)}}function o(d){const u=r(),h=u[d];!h||!e||(t.delete(d),s.has(h)&&(Yn(h),n.delete(h),s.delete(h)),$e(e,Me(),s,u))}const l=d=>{d.repeat||!be()||a(d.key)},c=d=>{be()&&o(d.key)};return window.addEventListener("keydown",l),window.addEventListener("keyup",c),{detach:()=>{window.removeEventListener("keydown",l),window.removeEventListener("keyup",c)},refreshUI:()=>{}}}function ns(i,e){e?(i.classList.remove("side-button-secondary","side-button-primary"),i.classList.add("side-button-activated")):(i.classList.remove("side-button-activated"),i.classList.add("side-button-secondary"))}function Bc(i){const e=Object.values(i).filter(n=>!n.isBlack).sort((n,r)=>n.x-r.x).map(n=>n.note),t=Object.values(i).filter(n=>n.isBlack).sort((n,r)=>n.x-r.x).map(n=>n.note),s={};return Sr.forEach((n,r)=>{e[r]&&(s[n]=e[r])}),Cr.forEach((n,r)=>{t[r]&&(s[n]=t[r])}),s}function Ec(i){const e=i.querySelector("#piano"),t=e==null?void 0:e.getContext("2d");if(!e||!t)throw new Error("Keyboard canvas not available");const s=i.querySelector("#octave-up"),n=i.querySelector("#octave-down"),r=i.querySelector("#disable-keyboard-inputs"),a=i.querySelector("#global-instrument-select-btn");function o(){if(!t)return;const h=Tt(),f=_s(h);Vn(f),r&&ns(r,be());const y=be()?Bc(f):null;$e(t,f,new Set,y??void 0)}const l=()=>{const h=Tt();h<7&&(xi(h+1),o())},c=()=>{const h=Tt();h>1&&(xi(h-1),o())},d=()=>{const h=be();Xn(!h),o(),r&&ns(r,!h)},u=()=>{const h=ai()||"sf2/fluidr3-gm/acoustic_grand_piano";St().showInstrumentSelectModal(null,h)};return s==null||s.addEventListener("click",l),n==null||n.addEventListener("click",c),r==null||r.addEventListener("click",d),a==null||a.addEventListener("click",u),{detach:()=>{s==null||s.removeEventListener("click",l),n==null||n.removeEventListener("click",c),r==null||r.removeEventListener("click",d),a==null||a.removeEventListener("click",u)},refreshUI:o}}class Tc{constructor(){this.detachFns=[],this.refreshFns=[];const{wrapper:e,canvas:t}=xc();this.wrapper=e,this.canvas=t}render(){return this.wrapper}initialize(){$n();const e=Gc(this.canvas),t=kc(this.canvas),s=Ec(this.wrapper);this.detachFns=[e.detach,t.detach,s.detach],this.refreshFns=[e.refreshUI,t.refreshUI,s.refreshUI],this.refresh()}refresh(){this.refreshFns.forEach(e=>e())}hide(){this.wrapper.classList.add("hidden")}show(){this.wrapper.classList.remove("hidden"),this.refresh()}destroy(){this.detachFns.forEach(e=>e()),this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)}}class Ic{constructor(){this.activeMode="keyboard",this.activeElement=null,this.detachFns=[];const e=document.getElementById("top-controls-container");if(!e)throw new Error("#top-controls-container not found in DOM");this.container=e,this.initialize()}initialize(){this.sideMenuController=new Lc,this.keyboardController=new Tc,this.setMode("keyboard")}setMode(e){if(this.activeElement){if(this.activeMode===e)return;this.container.removeChild(this.activeElement),this.activeElement=null}switch(this.activeMode=e,e){case"keyboard":this.activeElement=this.keyboardController.render(),this.container.appendChild(this.activeElement),this.keyboardController.initialize();break;case"ai":this.activeElement=this.createStub("AI View not implemented"),this.container.appendChild(this.activeElement);break;case"mixer":this.activeElement=this.createStub("Mixer View not implemented"),this.container.appendChild(this.activeElement);break}}getCurrentMode(){return this.activeMode}destroy(){var e,t,s;this.detachFns.forEach(n=>n()),this.detachFns=[],(e=this.sideMenuController)==null||e.destroy(),(t=this.keyboardController)==null||t.destroy(),((s=this.activeElement)==null?void 0:s.parentNode)===this.container&&this.container.removeChild(this.activeElement),this.activeElement=null}reload(){this.destroy(),this.initialize()}createStub(e){const t=document.createElement("div");return t.className="text-gray-400 text-sm p-4 border border-gray-600 rounded",t.textContent=e,t}}function Ac(i){return p("div",{class:"flex justify-between items-center mb-6 border-b border-purple-700 pb-2 z-10"},p("div",{class:"flex gap-4 text-xl select-none"},...i.map(e=>p("span",{class:["settings-tab","hover:text-white hover:scale-110 transition-all duration-150 cursor-pointer",e.isActive?"text-purple-500":"text-gray-300"].join(" "),dataset:{tab:e.key},title:e.title,textContent:e.icon}))))}class Rc{constructor(){this.globalSection=p("div",{id:"userconfig-global-settings",class:"settings-section z-10"}),this.themeSection=p("div",{id:"userconfig-theme-settings",class:"settings-section hidden z-10"}),this.aiSection=p("div",{id:"userconfig-ai-settings",class:"settings-section hidden z-10"});const e=Ac([{key:"global-settings",icon:"⚙️",title:"Global Settings",isActive:!0},{key:"theme-settings",icon:"🎹",title:"Theme Settings"},{key:"ai-settings",icon:"🤖",title:"AI Settings"}]);this.saveButton=R({id:"userconfig-save",text:"Save",kind:"primary"}),this.closeButton=R({id:"userconfig-close-bottom",text:"Cancel",kind:"secondary"});const t=p("div",{class:"flex gap-3 mt-4 z-10"},this.saveButton,this.closeButton);this.modal=Z("userconfig-modal",[e,this.globalSection,this.themeSection,this.aiSection,t]),document.body.appendChild(this.modal)}render(){return this.modal}show(){this.modal.classList.remove("hidden")}hide(){this.modal.classList.add("hidden")}destroy(){this.modal.remove()}getSectionContainer(e){switch(e){case"global":return this.globalSection;case"theme":return this.themeSection;case"ai":return this.aiSection}}getSaveButton(){return this.saveButton}getCloseButton(){return this.closeButton}getTabs(){return this.modal.querySelectorAll(".settings-tab")}getSections(){return this.modal.querySelectorAll(".settings-section")}}function Fc(){const{trigger:i,tooltip:e}=xe("tooltip-note-mode","?",[$(we("Default Mode:")," gesture-based note placement. Allows click-and-drag selection and edit gestures."),$(we("Express Mode:")," notes are placed immediately on mouse down. Holding allows drag-resizing. Right-click initiates multi-note selection.")]),t=ve({id:"note-tool-toggle",label:"Note Placement:",stateA:"Classic",stateB:"Express",tooltipTrigger:i});t.input.addEventListener("change",()=>{const r=t.getChecked()?"express":"default";oe({global:{noteToolMode:r}})});const s=()=>{const r=j().global.noteToolMode;t.setChecked(r==="express")};return{element:p("div",{},ce("Global Settings"),t.element,e),refreshToggle:s}}const Oc=["Default","Blue Dream","Modern Light","Synthwave","Verdant Alloy","Sunset"],Uc=["Darkroom","Seashell","Cyberpunk","Classic Blue","Midnight"],Dc=["Track Color","Note Velocity","Pitch Class Contrast","Scriabin","Octave Bands"];function Pc(){const i=Uc.map(s=>p("option",{value:s,textContent:s})),e=Dc.map(s=>p("option",{value:s,textContent:s})),t=Oc.map(s=>p("option",{value:s,textContent:s}));return p("div",{},ce("Theme Settings"),p("div",{className:"mb-6"},W("Interface Skin"),p("select",{id:"skin-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...t)),p("div",{className:"mb-6"},W("Grid Color Scheme"),p("select",{id:"grid-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i)),p("div",{className:"mb-6"},W("Note Color Scheme"),p("select",{id:"note-color-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...e)))}const qc=[{value:"gpt-4o",label:"gpt-4o"},{value:"gpt-4o-mini",label:"gpt-4o-mini"},{value:"gpt-4.1",label:"gpt-4.1"},{value:"gpt-4.1-mini",label:"gpt-4.1-mini"},{value:"o3-mini",label:"o3-mini"},{value:"o4-mini",label:"o4-mini",className:"bg-green-700 text-white"}];function Kc(){const i=qc.map(r=>p("option",{value:r.value,className:r.className,textContent:r.label})),{trigger:e,tooltip:t}=xe("tooltip-openai-key","?",["You must provide an OpenAI API key to use AI features.",$("Visit ",p("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",class:"text-blue-400 underline hover:text-blue-300"},"platform.openai.com")," to manage your key.")]),{trigger:s,tooltip:n}=xe("tooltip-openai-model","?",["Different models offer varying performance and response quality.",$("Models marked in ",p("span",{class:"text-green-400 font-semibold"},"green")," are recommended for best results."),"We will add support for new models as they become available."]);return p("div",{},ce("AI Configuration"),p("div",{class:"mb-6"},W("OpenAI API Key",e),p("input",{type:"password",id:"openai-key-input",placeholder:"sk-...",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500"}),t),p("div",{class:"mb-8"},W("OpenAI Model",s),p("select",{id:"openai-model-select",className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 focus:outline-none focus:border-purple-500 cursor-pointer"},...i),n))}function Hc(i,e={}){const t=i.getTabs(),s=i.getSections(),n=i.getCloseButton(),r=i.getSaveButton(),a=d=>{s.forEach(h=>{h.classList.add("hidden")});const u=document.getElementById(`userconfig-${d}`);u&&u.classList.remove("hidden"),t.forEach(h=>{const f=h.dataset.tab===d;h.classList.toggle("text-purple-500",f),h.classList.toggle("opacity-100",f),h.classList.toggle("text-gray-300",!f),h.classList.toggle("opacity-50",!f)})},o=[];t.forEach(d=>{const u=d.dataset.tab;if(!u)return;const h=()=>a(u);d.addEventListener("click",h),o.push(()=>d.removeEventListener("click",h))});const l=()=>{var d;(d=e.onClose)==null||d.call(e),i.hide()},c=()=>{var u;(u=e.onSave)==null||u.call(e);const d=T();d.name,ae.getInstance().reloadAll(),i.hide()};return n.addEventListener("click",l),r.addEventListener("click",c),(()=>{const d=Array.from(t).find(u=>u.classList.contains("text-purple-500"));d!=null&&d.dataset.tab&&a(d.dataset.tab)})(),()=>{o.forEach(d=>d()),n.removeEventListener("click",l),r.removeEventListener("click",c)}}function zc(i){const e=i.querySelector("#openai-key-input"),t=i.querySelector("#openai-model-select"),s=()=>{var o;const a=j();e&&(e.value=a.ai.openaiApiKey||""),t&&(t.value=a.ai.openaiModel||((o=t.options[0])==null?void 0:o.value)||"")},n=a=>{const o=a.target;oe({ai:{openaiApiKey:o.value}})},r=a=>{const o=a.target;oe({ai:{openaiModel:o.value}})};return e==null||e.addEventListener("input",n),t==null||t.addEventListener("change",r),s(),{detach:()=>{e==null||e.removeEventListener("input",n),t==null||t.removeEventListener("change",r)},refreshUI:s}}function Jc(i){const e=i.querySelector("#grid-color-select"),t=i.querySelector("#note-color-select"),s=i.querySelector("#skin-select"),n=()=>{var c,d,u;const l=j();e&&(e.value=l.theme.gridColorScheme||((c=e.options[0])==null?void 0:c.value)||""),t&&(t.value=l.theme.noteColorScheme||((d=t.options[0])==null?void 0:d.value)||""),s&&(s.value=l.theme.skin||((u=s.options[0])==null?void 0:u.value)||"")},r=l=>{const c=l.target;oe({theme:{gridColorScheme:c.value}})},a=l=>{const c=l.target;oe({theme:{noteColorScheme:c.value}})},o=l=>{const c=l.target;P.getInstance().stop(),oe({theme:{skin:c.value}})};return e==null||e.addEventListener("change",r),t==null||t.addEventListener("change",a),s==null||s.addEventListener("change",o),n(),{detach:()=>{e==null||e.removeEventListener("change",r),t==null||t.removeEventListener("change",a),s==null||s.removeEventListener("change",o)},refreshUI:n}}function $c(i){const e=i.querySelector("#note-tool-toggle");if(!e)return console.warn("[GlobalSettings] Toggle input not found."),{detach:()=>{},refreshUI:()=>{}};const t=()=>{const n=j();e.checked=n.global.noteToolMode==="express"},s=n=>{const a=n.target.checked?"express":"default";oe({global:{noteToolMode:a}}),D().forEach(o=>o.resetInteractionMode())};return e.addEventListener("change",s),t(),{detach:()=>e.removeEventListener("change",s),refreshUI:t}}class Wc{constructor(){this.modal=null,this.detachFns=[],this.refreshFns=[],this.initialSnapshot=structuredClone(j()),this.initializeUI()}initializeUI(){this.modal=new Rc;const e=Fc(),t=Pc(),s=Kc();this.modal.getSectionContainer("global").appendChild(e.element),this.modal.getSectionContainer("theme").appendChild(t),this.modal.getSectionContainer("ai").appendChild(s);const n=Hc(this.modal,{onSave:()=>ed(),onClose:()=>oe(this.initialSnapshot)}),r=$c(e.element),a=Jc(t),o=zc(s);this.detachFns.push(n,r.detach,a.detach,o.detach),this.refreshFns.push(r.refreshUI,a.refreshUI,o.refreshUI,e.refreshToggle),os(),document.body.appendChild(this.modal.render())}show(){var e;this.initialSnapshot=structuredClone(j()),this.refreshFns.forEach(t=>t()),(e=this.modal)==null||e.show()}hide(){var e;(e=this.modal)==null||e.hide()}destroy(){var e;this.detachFns.forEach(t=>t()),(e=this.modal)==null||e.destroy(),this.modal=null,this.detachFns=[],this.refreshFns=[]}reload(){this.destroy(),this.initializeUI()}}function jc(){document.getElementById("add-sequencer").addEventListener("click",()=>{const e=D().length;E(er(e,"sf2/fluidr3-gm/acoustic_grand_piano"),pi(e))})}function Xc(){const i=fe();i.showSplashScreen(),td(),jl(),Xl(),P.initialize(D());const e=new Wc,t=St(),s=new Ic,n=new gc(Ol(),e),r=new Nc;n.show(),r.show();const a=ae.getInstance();a.registerReloadable(()=>r.reload()),a.registerReloadable(()=>s.reload()),a.registerReloadable(()=>e.reload()),a.registerReloadable(()=>n.reload()),a.registerReloadable(()=>i.reload()),a.registerReloadable(()=>t.reload()),Ct(Ql),X("Setting up additional UI..."),bc(Bl,El),jc();const o=0;E(er(o,"sf2/fluidr3-gm/acoustic_grand_piano"),pi(o)),E(mi("Initial App State"),tr("Initial App State")),i.hideSplashScreen(),ls("Sequenzia initialized"),X("Current state: ",O())}requestAnimationFrame(()=>{Xc()});
